// DEPRECATED: 定位状态初始化已迁移到 map_sdk/location/{domain,adapter}/ 下。
var _locationModuleAdapter = (window.DaxiLocationModules && window.DaxiLocationModules.adapter) || {};
var lastOrientation = _locationModuleAdapter.createLastOrientation
  ? _locationModuleAdapter.createLastOrientation()
  : [0, 0, 0, false];
var globalValues = _locationModuleAdapter.createGlobalValues
  ? _locationModuleAdapter.createGlobalValues()
  : {
      orientationHistory: [],
      gameOrientation: [],
      debugInfo: {},
      headingDelta: 0.0,
      headingWX: 0.0,
      headingH5: 0.0,
      stepCount: 0,
      stepOrient: 0.0,
    };
var RoadMapMatcher = (function getRoadMapMatcher() {
  //region block: polyfills
  (function () {
    if (typeof globalThis === "object") return;
    Object.defineProperty(Object.prototype, "__magic__", {
      get: function () {
        return this;
      },
      configurable: true,
    });
    __magic__.globalThis = __magic__;
    delete Object.prototype.__magic__;
  })();
  if (typeof Math.imul === "undefined") {
    Math.imul = function imul(a, b) {
      return ((a & 4.29490176e9) * (b & 65535) + (a & 65535) * (b | 0)) | 0;
    };
  }
  if (typeof ArrayBuffer.isView === "undefined") {
    ArrayBuffer.isView = function (a) {
      return a != null && a.__proto__ != null && a.__proto__.__proto__ === Int8Array.prototype.__proto__;
    };
  }
  if (typeof Array.prototype.fill === "undefined") {
    // Polyfill from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fill#Polyfill
    Object.defineProperty(Array.prototype, "fill", {
      value: function (value) {
        // Steps 1-2.
        if (this == null) {
          throw new TypeError("this is null or not defined");
        }
        var O = Object(this); // Steps 3-5.
        var len = O.length >>> 0; // Steps 6-7.
        var start = arguments[1];
        var relativeStart = start >> 0; // Step 8.
        var k = relativeStart < 0 ? Math.max(len + relativeStart, 0) : Math.min(relativeStart, len); // Steps 9-10.
        var end = arguments[2];
        var relativeEnd = end === undefined ? len : end >> 0; // Step 11.
        var finalValue = relativeEnd < 0 ? Math.max(len + relativeEnd, 0) : Math.min(relativeEnd, len); // Step 12.
        while (k < finalValue) {
          O[k] = value;
          k++;
        } // Step 13.
        return O;
      },
    });
  }
  [Int8Array, Int16Array, Uint16Array, Int32Array, Float32Array, Float64Array].forEach(function (TypedArray) {
    if (typeof TypedArray.prototype.fill === "undefined") {
      Object.defineProperty(TypedArray.prototype, "fill", { value: Array.prototype.fill });
    }
  });
  if (typeof Math.clz32 === "undefined") {
    Math.clz32 = (function (log, LN2) {
      return function (x) {
        var asUint = x >>> 0;
        if (asUint === 0) {
          return 32;
        }
        return (31 - ((log(asUint) / LN2) | 0)) | 0; // the "| 0" acts like math.floor
      };
    })(Math.log, Math.LN2);
  }
  if (typeof String.prototype.startsWith === "undefined") {
    Object.defineProperty(String.prototype, "startsWith", {
      value: function (searchString, position) {
        position = position || 0;
        return this.lastIndexOf(searchString, position) === position;
      },
    });
  }
  //endregion
  var kotlin_kotlin = (function (_) {
    "use strict";
    //region block: imports
    var imul = Math.imul;
    var isView = ArrayBuffer.isView;
    var clz32 = Math.clz32;
    //endregion
    //region block: pre-declaration
    initMetadataForInterface(CharSequence, "CharSequence");
    initMetadataForInterface(Comparable, "Comparable");
    initMetadataForClass(Number_0, "Number");
    initMetadataForObject(Unit, "Unit");
    initMetadataForClass(_no_name_provided__qut3iv);
    initMetadataForClass(Exception, "Exception", Exception_init_$Create$, Error);
    initMetadataForClass(RuntimeException, "RuntimeException", RuntimeException_init_$Create$, Exception);
    initMetadataForClass(KotlinNothingValueException, "KotlinNothingValueException", KotlinNothingValueException_init_$Create$, RuntimeException);
    initMetadataForCompanion(Companion);
    initMetadataForClass(Char, "Char", VOID, VOID, [Comparable]);
    initMetadataForInterface(Collection, "Collection");
    initMetadataForInterface(KtList, "List", VOID, VOID, [Collection]);
    initMetadataForInterface(KtSet, "Set", VOID, VOID, [Collection]);
    initMetadataForInterface(Entry, "Entry");
    initMetadataForInterface(KtMap, "Map");
    initMetadataForCompanion(Companion_0);
    initMetadataForClass(Enum, "Enum", VOID, VOID, [Comparable]);
    initMetadataForCompanion(Companion_1);
    initMetadataForClass(Long, "Long", VOID, Number_0, [Number_0, Comparable]);
    initMetadataForInterface(FunctionAdapter, "FunctionAdapter");
    initMetadataForClass(arrayIterator$1);
    initMetadataForObject(Digit, "Digit");
    initMetadataForInterface(Comparator, "Comparator");
    initMetadataForClass(AbstractCollection, "AbstractCollection", VOID, VOID, [Collection]);
    initMetadataForClass(AbstractMutableCollection, "AbstractMutableCollection", VOID, AbstractCollection, [AbstractCollection, Collection]);
    initMetadataForClass(IteratorImpl, "IteratorImpl");
    initMetadataForClass(ListIteratorImpl, "ListIteratorImpl", VOID, IteratorImpl);
    initMetadataForClass(AbstractMutableList, "AbstractMutableList", VOID, AbstractMutableCollection, [AbstractMutableCollection, Collection, KtList]);
    initMetadataForClass(AbstractMap, "AbstractMap", VOID, VOID, [KtMap]);
    initMetadataForClass(AbstractMutableMap, "AbstractMutableMap", VOID, AbstractMap, [AbstractMap, KtMap]);
    initMetadataForClass(AbstractMutableSet, "AbstractMutableSet", VOID, AbstractMutableCollection, [AbstractMutableCollection, Collection, KtSet]);
    initMetadataForCompanion(Companion_2);
    initMetadataForClass(ArrayList, "ArrayList", ArrayList_init_$Create$, AbstractMutableList, [AbstractMutableList, Collection, KtList]);
    initMetadataForClass(HashMap, "HashMap", HashMap_init_$Create$, AbstractMutableMap, [AbstractMutableMap, KtMap]);
    initMetadataForClass(HashMapValues, "HashMapValues", VOID, AbstractMutableCollection, [Collection, AbstractMutableCollection]);
    initMetadataForClass(HashMapEntrySetBase, "HashMapEntrySetBase", VOID, AbstractMutableSet, [Collection, KtSet, AbstractMutableSet]);
    initMetadataForClass(HashMapEntrySet, "HashMapEntrySet", VOID, HashMapEntrySetBase);
    initMetadataForClass(HashMapValuesDefault$iterator$1);
    initMetadataForClass(HashMapValuesDefault, "HashMapValuesDefault", VOID, AbstractMutableCollection);
    initMetadataForClass(HashSet, "HashSet", HashSet_init_$Create$, AbstractMutableSet, [AbstractMutableSet, Collection, KtSet]);
    initMetadataForCompanion(Companion_3);
    initMetadataForClass(Itr, "Itr");
    initMetadataForClass(KeysItr, "KeysItr", VOID, Itr);
    initMetadataForClass(ValuesItr, "ValuesItr", VOID, Itr);
    initMetadataForClass(EntriesItr, "EntriesItr", VOID, Itr);
    initMetadataForClass(EntryRef, "EntryRef", VOID, VOID, [Entry]);
    function containsAllEntries(m) {
      var tmp$ret$0;
      $l$block_0: {
        // Inline function 'kotlin.collections.all' call
        var tmp;
        if (isInterface(m, Collection)) {
          tmp = m.i();
        } else {
          tmp = false;
        }
        if (tmp) {
          tmp$ret$0 = true;
          break $l$block_0;
        }
        var tmp0_iterator = m.l();
        while (tmp0_iterator.m()) {
          var element = tmp0_iterator.n();
          // Inline function 'kotlin.collections.InternalMap.containsAllEntries.<anonymous>' call
          // Inline function 'kotlin.js.unsafeCast' call
          // Inline function 'kotlin.js.asDynamic' call
          var entry = element;
          var tmp_0;
          if (!(entry == null) ? isInterface(entry, Entry) : false) {
            tmp_0 = this.v6(entry);
          } else {
            tmp_0 = false;
          }
          if (!tmp_0) {
            tmp$ret$0 = false;
            break $l$block_0;
          }
        }
        tmp$ret$0 = true;
      }
      return tmp$ret$0;
    }
    initMetadataForInterface(InternalMap, "InternalMap");
    initMetadataForClass(InternalHashMap, "InternalHashMap", InternalHashMap_init_$Create$, VOID, [InternalMap]);
    initMetadataForClass(BaseOutput, "BaseOutput");
    initMetadataForClass(NodeJsOutput, "NodeJsOutput", VOID, BaseOutput);
    initMetadataForClass(BufferedOutput, "BufferedOutput", BufferedOutput, BaseOutput);
    initMetadataForClass(BufferedOutputToConsoleLog, "BufferedOutputToConsoleLog", BufferedOutputToConsoleLog, BufferedOutput);
    initMetadataForClass(IllegalArgumentException, "IllegalArgumentException", IllegalArgumentException_init_$Create$, RuntimeException);
    initMetadataForClass(IndexOutOfBoundsException, "IndexOutOfBoundsException", IndexOutOfBoundsException_init_$Create$, RuntimeException);
    initMetadataForClass(IllegalStateException, "IllegalStateException", IllegalStateException_init_$Create$, RuntimeException);
    initMetadataForClass(UnsupportedOperationException, "UnsupportedOperationException", UnsupportedOperationException_init_$Create$, RuntimeException);
    initMetadataForClass(NoSuchElementException, "NoSuchElementException", NoSuchElementException_init_$Create$, RuntimeException);
    initMetadataForClass(ArithmeticException, "ArithmeticException", ArithmeticException_init_$Create$, RuntimeException);
    initMetadataForClass(ConcurrentModificationException, "ConcurrentModificationException", ConcurrentModificationException_init_$Create$, RuntimeException);
    initMetadataForClass(NumberFormatException, "NumberFormatException", NumberFormatException_init_$Create$, IllegalArgumentException);
    initMetadataForClass(NullPointerException, "NullPointerException", NullPointerException_init_$Create$, RuntimeException);
    initMetadataForClass(ClassCastException, "ClassCastException", ClassCastException_init_$Create$, RuntimeException);
    initMetadataForInterface(KProperty0, "KProperty0");
    initMetadataForInterface(KProperty1, "KProperty1");
    initMetadataForClass(StringBuilder, "StringBuilder", StringBuilder_init_$Create$_0, VOID, [CharSequence]);
    initMetadataForCompanion(Companion_4);
    initMetadataForClass(sam$kotlin_Comparator$0, "sam$kotlin_Comparator$0", VOID, VOID, [Comparator, FunctionAdapter]);
    initMetadataForClass(ExceptionTraceBuilder, "ExceptionTraceBuilder", ExceptionTraceBuilder);
    initMetadataForCompanion(Companion_5);
    initMetadataForCompanion(Companion_6);
    initMetadataForCompanion(Companion_7);
    initMetadataForObject(EmptyList, "EmptyList", VOID, VOID, [KtList]);
    initMetadataForClass(ArrayAsCollection, "ArrayAsCollection", VOID, VOID, [Collection]);
    initMetadataForObject(EmptyIterator, "EmptyIterator");
    initMetadataForClass(IntIterator, "IntIterator");
    initMetadataForClass(ReversedList$listIterator$1);
    initMetadataForClass(ReversedList, "ReversedList", VOID, AbstractMutableList);
    initMetadataForInterface(Sequence, "Sequence");
    initMetadataForClass(TransformingSequence$iterator$1);
    initMetadataForClass(TransformingSequence, "TransformingSequence", VOID, VOID, [Sequence]);
    initMetadataForCompanion(Companion_8);
    initMetadataForClass(IntProgression, "IntProgression");
    initMetadataForClass(IntRange, "IntRange", VOID, IntProgression);
    initMetadataForClass(IntProgressionIterator, "IntProgressionIterator", VOID, IntIterator);
    initMetadataForCompanion(Companion_9);
    initMetadataForClass(DelimitedRangesSequence$iterator$1);
    initMetadataForClass(DelimitedRangesSequence, "DelimitedRangesSequence", VOID, VOID, [Sequence]);
    initMetadataForClass(UnsafeLazyImpl, "UnsafeLazyImpl");
    initMetadataForObject(UNINITIALIZED_VALUE, "UNINITIALIZED_VALUE");
    initMetadataForCompanion(Companion_10);
    initMetadataForClass(Failure, "Failure");
    initMetadataForClass(Pair, "Pair");
    initMetadataForClass(Triple, "Triple");
    //endregion
    function CharSequence() {}
    function Comparable() {}
    function Number_0() {}
    function Unit() {}
    protoOf(Unit).toString = function () {
      return "kotlin.Unit";
    };
    var Unit_instance;
    function Unit_getInstance() {
      return Unit_instance;
    }
    function indexOf(_this__u8e3s4, element) {
      if (element == null) {
        var inductionVariable = 0;
        var last = (_this__u8e3s4.length - 1) | 0;
        if (inductionVariable <= last)
          do {
            var index = inductionVariable;
            inductionVariable = (inductionVariable + 1) | 0;
            if (_this__u8e3s4[index] == null) {
              return index;
            }
          } while (inductionVariable <= last);
      } else {
        var inductionVariable_0 = 0;
        var last_0 = (_this__u8e3s4.length - 1) | 0;
        if (inductionVariable_0 <= last_0)
          do {
            var index_0 = inductionVariable_0;
            inductionVariable_0 = (inductionVariable_0 + 1) | 0;
            if (equals(element, _this__u8e3s4[index_0])) {
              return index_0;
            }
          } while (inductionVariable_0 <= last_0);
      }
      return -1;
    }
    function contains(_this__u8e3s4, element) {
      return indexOf(_this__u8e3s4, element) >= 0;
    }
    function get_lastIndex(_this__u8e3s4) {
      return (_this__u8e3s4.length - 1) | 0;
    }
    function single(_this__u8e3s4) {
      var tmp;
      switch (_this__u8e3s4.length) {
        case 0:
          throw NoSuchElementException_init_$Create$_0("Array is empty.");
        case 1:
          tmp = _this__u8e3s4[0];
          break;
        default:
          throw IllegalArgumentException_init_$Create$_0("Array has more than one element.");
      }
      return tmp;
    }
    function joinToString(_this__u8e3s4, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      return joinTo(_this__u8e3s4, StringBuilder_init_$Create$_0(), separator, prefix, postfix, limit, truncated, transform).toString();
    }
    function contains_0(_this__u8e3s4, element) {
      return indexOf_0(_this__u8e3s4, element) >= 0;
    }
    function joinTo(_this__u8e3s4, buffer, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      buffer.e(prefix);
      var count = 0;
      var inductionVariable = 0;
      var last = _this__u8e3s4.length;
      $l$loop: while (inductionVariable < last) {
        var element = _this__u8e3s4[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        count = (count + 1) | 0;
        if (count > 1) {
          buffer.e(separator);
        }
        if (limit < 0 || count <= limit) {
          appendElement(buffer, element, transform);
        } else break $l$loop;
      }
      if (limit >= 0 && count > limit) {
        buffer.e(truncated);
      }
      buffer.e(postfix);
      return buffer;
    }
    function indexOf_0(_this__u8e3s4, element) {
      var inductionVariable = 0;
      var last = (_this__u8e3s4.length - 1) | 0;
      if (inductionVariable <= last)
        do {
          var index = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          if (element === _this__u8e3s4[index]) {
            return index;
          }
        } while (inductionVariable <= last);
      return -1;
    }
    function joinToString_0(_this__u8e3s4, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      return joinTo_0(_this__u8e3s4, StringBuilder_init_$Create$_0(), separator, prefix, postfix, limit, truncated, transform).toString();
    }
    function joinToString_1(_this__u8e3s4, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      return joinTo_1(_this__u8e3s4, StringBuilder_init_$Create$_0(), separator, prefix, postfix, limit, truncated, transform).toString();
    }
    function joinToString_2(_this__u8e3s4, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      return joinTo_2(_this__u8e3s4, StringBuilder_init_$Create$_0(), separator, prefix, postfix, limit, truncated, transform).toString();
    }
    function joinToString_3(_this__u8e3s4, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      return joinTo_3(_this__u8e3s4, StringBuilder_init_$Create$_0(), separator, prefix, postfix, limit, truncated, transform).toString();
    }
    function joinToString_4(_this__u8e3s4, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      return joinTo_4(_this__u8e3s4, StringBuilder_init_$Create$_0(), separator, prefix, postfix, limit, truncated, transform).toString();
    }
    function sliceArray(_this__u8e3s4, indices) {
      if (indices.i()) return copyOfRange(_this__u8e3s4, 0, 0);
      return copyOfRange(_this__u8e3s4, indices.j(), (indices.k() + 1) | 0);
    }
    function min(_this__u8e3s4) {
      // Inline function 'kotlin.collections.isEmpty' call
      if (_this__u8e3s4.length === 0) throw NoSuchElementException_init_$Create$();
      var min = _this__u8e3s4[0];
      var inductionVariable = 1;
      var last = get_lastIndex(_this__u8e3s4);
      if (inductionVariable <= last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var e = _this__u8e3s4[i];
          // Inline function 'kotlin.comparisons.minOf' call
          var a = min;
          min = Math.min(a, e);
        } while (!(i === last));
      return min;
    }
    function joinTo_0(_this__u8e3s4, buffer, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      buffer.e(prefix);
      var count = 0;
      var inductionVariable = 0;
      var last = _this__u8e3s4.length;
      $l$loop: while (inductionVariable < last) {
        var element = _this__u8e3s4[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        count = (count + 1) | 0;
        if (count > 1) {
          buffer.e(separator);
        }
        if (limit < 0 || count <= limit) {
          if (!(transform == null)) {
            buffer.e(transform(element));
          } else {
            buffer.e(element.toString());
          }
        } else break $l$loop;
      }
      if (limit >= 0 && count > limit) {
        buffer.e(truncated);
      }
      buffer.e(postfix);
      return buffer;
    }
    function joinTo_1(_this__u8e3s4, buffer, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      buffer.e(prefix);
      var count = 0;
      var inductionVariable = 0;
      var last = _this__u8e3s4.length;
      $l$loop: while (inductionVariable < last) {
        var element = _this__u8e3s4[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        count = (count + 1) | 0;
        if (count > 1) {
          buffer.e(separator);
        }
        if (limit < 0 || count <= limit) {
          if (!(transform == null)) {
            buffer.e(transform(element));
          } else {
            buffer.e(element.toString());
          }
        } else break $l$loop;
      }
      if (limit >= 0 && count > limit) {
        buffer.e(truncated);
      }
      buffer.e(postfix);
      return buffer;
    }
    function joinTo_2(_this__u8e3s4, buffer, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      buffer.e(prefix);
      var count = 0;
      var inductionVariable = 0;
      var last = _this__u8e3s4.length;
      $l$loop: while (inductionVariable < last) {
        var element = _this__u8e3s4[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        count = (count + 1) | 0;
        if (count > 1) {
          buffer.e(separator);
        }
        if (limit < 0 || count <= limit) {
          if (!(transform == null)) {
            buffer.e(transform(element));
          } else {
            buffer.e(element.toString());
          }
        } else break $l$loop;
      }
      if (limit >= 0 && count > limit) {
        buffer.e(truncated);
      }
      buffer.e(postfix);
      return buffer;
    }
    function joinTo_3(_this__u8e3s4, buffer, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      buffer.e(prefix);
      var count = 0;
      var inductionVariable = 0;
      var last = _this__u8e3s4.length;
      $l$loop: while (inductionVariable < last) {
        var element = _this__u8e3s4[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        count = (count + 1) | 0;
        if (count > 1) {
          buffer.e(separator);
        }
        if (limit < 0 || count <= limit) {
          if (!(transform == null)) {
            buffer.e(transform(element));
          } else {
            buffer.e(element.toString());
          }
        } else break $l$loop;
      }
      if (limit >= 0 && count > limit) {
        buffer.e(truncated);
      }
      buffer.e(postfix);
      return buffer;
    }
    function joinTo_4(_this__u8e3s4, buffer, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      buffer.e(prefix);
      var count = 0;
      var inductionVariable = 0;
      var last = _this__u8e3s4.length;
      $l$loop: while (inductionVariable < last) {
        var element = _this__u8e3s4[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        count = (count + 1) | 0;
        if (count > 1) {
          buffer.e(separator);
        }
        if (limit < 0 || count <= limit) {
          if (!(transform == null)) {
            buffer.e(transform(element));
          } else {
            buffer.e(element.toString());
          }
        } else break $l$loop;
      }
      if (limit >= 0 && count > limit) {
        buffer.e(truncated);
      }
      buffer.e(postfix);
      return buffer;
    }
    function sum(_this__u8e3s4) {
      var sum = 0.0;
      var inductionVariable = 0;
      var last = _this__u8e3s4.length;
      while (inductionVariable < last) {
        var element = _this__u8e3s4[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        sum = sum + element;
      }
      return sum;
    }
    function joinToString_5(_this__u8e3s4, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      return joinTo_5(_this__u8e3s4, StringBuilder_init_$Create$_0(), separator, prefix, postfix, limit, truncated, transform).toString();
    }
    function joinTo_5(_this__u8e3s4, buffer, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      buffer.e(prefix);
      var count = 0;
      var tmp0_iterator = _this__u8e3s4.l();
      $l$loop: while (tmp0_iterator.m()) {
        var element = tmp0_iterator.n();
        count = (count + 1) | 0;
        if (count > 1) {
          buffer.e(separator);
        }
        if (limit < 0 || count <= limit) {
          appendElement(buffer, element, transform);
        } else break $l$loop;
      }
      if (limit >= 0 && count > limit) {
        buffer.e(truncated);
      }
      buffer.e(postfix);
      return buffer;
    }
    function firstOrNull(_this__u8e3s4) {
      return _this__u8e3s4.i() ? null : _this__u8e3s4.o(0);
    }
    function last(_this__u8e3s4) {
      if (_this__u8e3s4.i()) throw NoSuchElementException_init_$Create$_0("List is empty.");
      return _this__u8e3s4.o(get_lastIndex_0(_this__u8e3s4));
    }
    function single_0(_this__u8e3s4) {
      var tmp;
      switch (_this__u8e3s4.p()) {
        case 0:
          throw NoSuchElementException_init_$Create$_0("List is empty.");
        case 1:
          tmp = _this__u8e3s4.o(0);
          break;
        default:
          throw IllegalArgumentException_init_$Create$_0("List has more than one element.");
      }
      return tmp;
    }
    function single_1(_this__u8e3s4) {
      if (isInterface(_this__u8e3s4, KtList)) return single_0(_this__u8e3s4);
      else {
        var iterator = _this__u8e3s4.l();
        if (!iterator.m()) throw NoSuchElementException_init_$Create$_0("Collection is empty.");
        var single = iterator.n();
        if (iterator.m()) throw IllegalArgumentException_init_$Create$_0("Collection has more than one element.");
        return single;
      }
    }
    function first(_this__u8e3s4) {
      if (_this__u8e3s4.i()) throw NoSuchElementException_init_$Create$_0("List is empty.");
      return _this__u8e3s4.o(0);
    }
    function lastOrNull(_this__u8e3s4) {
      return _this__u8e3s4.i() ? null : _this__u8e3s4.o((_this__u8e3s4.p() - 1) | 0);
    }
    function min_0(_this__u8e3s4) {
      var iterator = _this__u8e3s4.l();
      if (!iterator.m()) throw NoSuchElementException_init_$Create$();
      var min = iterator.n();
      while (iterator.m()) {
        var e = iterator.n();
        // Inline function 'kotlin.comparisons.minOf' call
        var a = min;
        min = Math.min(a, e);
      }
      return min;
    }
    function max(_this__u8e3s4) {
      var iterator = _this__u8e3s4.l();
      if (!iterator.m()) throw NoSuchElementException_init_$Create$();
      var max = iterator.n();
      while (iterator.m()) {
        var e = iterator.n();
        // Inline function 'kotlin.comparisons.maxOf' call
        var a = max;
        max = Math.max(a, e);
      }
      return max;
    }
    function first_0(_this__u8e3s4) {
      if (isInterface(_this__u8e3s4, KtList)) return first(_this__u8e3s4);
      else {
        var iterator = _this__u8e3s4.l();
        if (!iterator.m()) throw NoSuchElementException_init_$Create$_0("Collection is empty.");
        return iterator.n();
      }
    }
    function until(_this__u8e3s4, to) {
      if (to <= -2147483648) return Companion_getInstance_8().q_1;
      return numberRangeToNumber(_this__u8e3s4, (to - 1) | 0);
    }
    function downTo(_this__u8e3s4, to) {
      return Companion_instance_9.r(_this__u8e3s4, to, -1);
    }
    function coerceAtLeast(_this__u8e3s4, minimumValue) {
      return _this__u8e3s4 < minimumValue ? minimumValue : _this__u8e3s4;
    }
    function coerceAtMost(_this__u8e3s4, maximumValue) {
      return _this__u8e3s4 > maximumValue ? maximumValue : _this__u8e3s4;
    }
    function coerceIn(_this__u8e3s4, minimumValue, maximumValue) {
      if (minimumValue > maximumValue)
        throw IllegalArgumentException_init_$Create$_0(
          "Cannot coerce value to an empty range: maximum " + maximumValue + " is less than minimum " + minimumValue + ".",
        );
      if (_this__u8e3s4 < minimumValue) return minimumValue;
      if (_this__u8e3s4 > maximumValue) return maximumValue;
      return _this__u8e3s4;
    }
    function coerceAtLeast_0(_this__u8e3s4, minimumValue) {
      return _this__u8e3s4 < minimumValue ? minimumValue : _this__u8e3s4;
    }
    function map(_this__u8e3s4, transform) {
      return new TransformingSequence(_this__u8e3s4, transform);
    }
    function joinToString_6(_this__u8e3s4, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      return joinTo_6(_this__u8e3s4, StringBuilder_init_$Create$_0(), separator, prefix, postfix, limit, truncated, transform).toString();
    }
    function joinTo_6(_this__u8e3s4, buffer, separator, prefix, postfix, limit, truncated, transform) {
      separator = separator === VOID ? ", " : separator;
      prefix = prefix === VOID ? "" : prefix;
      postfix = postfix === VOID ? "" : postfix;
      limit = limit === VOID ? -1 : limit;
      truncated = truncated === VOID ? "..." : truncated;
      transform = transform === VOID ? null : transform;
      buffer.e(prefix);
      var count = 0;
      var tmp0_iterator = _this__u8e3s4.l();
      $l$loop: while (tmp0_iterator.m()) {
        var element = tmp0_iterator.n();
        count = (count + 1) | 0;
        if (count > 1) {
          buffer.e(separator);
        }
        if (limit < 0 || count <= limit) {
          appendElement(buffer, element, transform);
        } else break $l$loop;
      }
      if (limit >= 0 && count > limit) {
        buffer.e(truncated);
      }
      buffer.e(postfix);
      return buffer;
    }
    function asIterable(_this__u8e3s4) {
      // Inline function 'kotlin.collections.Iterable' call
      return new _no_name_provided__qut3iv(_this__u8e3s4);
    }
    function _no_name_provided__qut3iv($this_asIterable) {
      this.s_1 = $this_asIterable;
    }
    protoOf(_no_name_provided__qut3iv).l = function () {
      // Inline function 'kotlin.sequences.asIterable.<anonymous>' call
      return this.s_1.l();
    };
    function take(_this__u8e3s4, n) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(n >= 0)) {
        // Inline function 'kotlin.text.take.<anonymous>' call
        var message = "Requested character count " + n + " is less than zero.";
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      // Inline function 'kotlin.text.substring' call
      var endIndex = coerceAtMost(n, _this__u8e3s4.length);
      // Inline function 'kotlin.js.asDynamic' call
      return _this__u8e3s4.substring(0, endIndex);
    }
    function takeLast(_this__u8e3s4, n) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(n >= 0)) {
        // Inline function 'kotlin.text.takeLast.<anonymous>' call
        var message = "Requested character count " + n + " is less than zero.";
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      var length = _this__u8e3s4.length;
      // Inline function 'kotlin.text.substring' call
      var startIndex = (length - coerceAtMost(n, length)) | 0;
      // Inline function 'kotlin.js.asDynamic' call
      return _this__u8e3s4.substring(startIndex);
    }
    function dropLast(_this__u8e3s4, n) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(n >= 0)) {
        // Inline function 'kotlin.text.dropLast.<anonymous>' call
        var message = "Requested character count " + n + " is less than zero.";
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      return take(_this__u8e3s4, coerceAtLeast((_this__u8e3s4.length - n) | 0, 0));
    }
    function KotlinNothingValueException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      KotlinNothingValueException.call($this);
      return $this;
    }
    function KotlinNothingValueException_init_$Create$() {
      var tmp = KotlinNothingValueException_init_$Init$(objectCreate(protoOf(KotlinNothingValueException)));
      captureStack(tmp, KotlinNothingValueException_init_$Create$);
      return tmp;
    }
    function KotlinNothingValueException() {
      captureStack(this, KotlinNothingValueException);
    }
    function _Char___init__impl__6a9atx(value) {
      return value;
    }
    function _get_value__a43j40($this) {
      return $this;
    }
    function _Char___init__impl__6a9atx_0(code) {
      // Inline function 'kotlin.UShort.toInt' call
      var tmp$ret$0 = _UShort___get_data__impl__g0245(code) & 65535;
      return _Char___init__impl__6a9atx(tmp$ret$0);
    }
    function Char__compareTo_impl_ypi4mb($this, other) {
      return (_get_value__a43j40($this) - _get_value__a43j40(other)) | 0;
    }
    function Char__compareTo_impl_ypi4mb_0($this, other) {
      return Char__compareTo_impl_ypi4mb($this.v_1, other instanceof Char ? other.v_1 : THROW_CCE());
    }
    function Char__minus_impl_a2frrh($this, other) {
      return (_get_value__a43j40($this) - _get_value__a43j40(other)) | 0;
    }
    function Char__toInt_impl_vasixd($this) {
      return _get_value__a43j40($this);
    }
    function toString($this) {
      // Inline function 'kotlin.js.unsafeCast' call
      return String.fromCharCode(_get_value__a43j40($this));
    }
    function Char__equals_impl_x6719k($this, other) {
      if (!(other instanceof Char)) return false;
      return _get_value__a43j40($this) === _get_value__a43j40(other.v_1);
    }
    function Char__hashCode_impl_otmys($this) {
      return _get_value__a43j40($this);
    }
    function Companion() {
      Companion_instance = this;
      this.w_1 = _Char___init__impl__6a9atx(0);
      this.x_1 = _Char___init__impl__6a9atx(65535);
      this.y_1 = _Char___init__impl__6a9atx(55296);
      this.z_1 = _Char___init__impl__6a9atx(56319);
      this.a1_1 = _Char___init__impl__6a9atx(56320);
      this.b1_1 = _Char___init__impl__6a9atx(57343);
      this.c1_1 = _Char___init__impl__6a9atx(55296);
      this.d1_1 = _Char___init__impl__6a9atx(57343);
      this.e1_1 = 2;
      this.f1_1 = 16;
    }
    var Companion_instance;
    function Companion_getInstance() {
      if (Companion_instance == null) new Companion();
      return Companion_instance;
    }
    function Char(value) {
      Companion_getInstance();
      this.v_1 = value;
    }
    protoOf(Char).g1 = function (other) {
      return Char__compareTo_impl_ypi4mb(this.v_1, other);
    };
    protoOf(Char).d = function (other) {
      return Char__compareTo_impl_ypi4mb_0(this, other);
    };
    protoOf(Char).toString = function () {
      return toString(this.v_1);
    };
    protoOf(Char).equals = function (other) {
      return Char__equals_impl_x6719k(this.v_1, other);
    };
    protoOf(Char).hashCode = function () {
      return Char__hashCode_impl_otmys(this.v_1);
    };
    function KtList() {}
    function Collection() {}
    function KtSet() {}
    function Entry() {}
    function KtMap() {}
    function Companion_0() {}
    var Companion_instance_0;
    function Companion_getInstance_0() {
      return Companion_instance_0;
    }
    function Enum(name, ordinal) {
      this.p1_1 = name;
      this.q1_1 = ordinal;
    }
    protoOf(Enum).r1 = function (other) {
      return compareTo(this.q1_1, other.q1_1);
    };
    protoOf(Enum).d = function (other) {
      return this.r1(other instanceof Enum ? other : THROW_CCE());
    };
    protoOf(Enum).equals = function (other) {
      return this === other;
    };
    protoOf(Enum).hashCode = function () {
      return identityHashCode(this);
    };
    protoOf(Enum).toString = function () {
      return this.p1_1;
    };
    function toString_0(_this__u8e3s4) {
      var tmp1_elvis_lhs = _this__u8e3s4 == null ? null : toString_1(_this__u8e3s4);
      return tmp1_elvis_lhs == null ? "null" : tmp1_elvis_lhs;
    }
    function Companion_1() {
      Companion_instance_1 = this;
      this.s1_1 = new Long(0, -2147483648);
      this.t1_1 = new Long(-1, 2147483647);
      this.u1_1 = 8;
      this.v1_1 = 64;
    }
    var Companion_instance_1;
    function Companion_getInstance_1() {
      if (Companion_instance_1 == null) new Companion_1();
      return Companion_instance_1;
    }
    function Long(low, high) {
      Companion_getInstance_1();
      Number_0.call(this);
      this.w1_1 = low;
      this.x1_1 = high;
    }
    protoOf(Long).y1 = function (other) {
      return compare(this, other);
    };
    protoOf(Long).d = function (other) {
      return this.y1(other instanceof Long ? other : THROW_CCE());
    };
    protoOf(Long).z1 = function (other) {
      return add(this, other);
    };
    protoOf(Long).a2 = function (other) {
      return subtract(this, other);
    };
    protoOf(Long).b2 = function (other) {
      return multiply(this, other);
    };
    protoOf(Long).c2 = function (other) {
      return divide(this, other);
    };
    protoOf(Long).d2 = function (other) {
      return modulo(this, other);
    };
    protoOf(Long).e2 = function () {
      return this.z1(new Long(1, 0));
    };
    protoOf(Long).f2 = function () {
      return this.a2(new Long(1, 0));
    };
    protoOf(Long).g2 = function () {
      return this.h2().z1(new Long(1, 0));
    };
    protoOf(Long).h2 = function () {
      return new Long(~this.w1_1, ~this.x1_1);
    };
    protoOf(Long).i2 = function () {
      return this.w1_1;
    };
    protoOf(Long).j2 = function () {
      return toNumber(this);
    };
    protoOf(Long).toString = function () {
      return toStringImpl(this, 10);
    };
    protoOf(Long).equals = function (other) {
      var tmp;
      if (other instanceof Long) {
        tmp = equalsLong(this, other);
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(Long).hashCode = function () {
      return hashCode_0(this);
    };
    protoOf(Long).valueOf = function () {
      return this.j2();
    };
    function implement(interfaces) {
      var maxSize = 1;
      var masks = [];
      var inductionVariable = 0;
      var last = interfaces.length;
      while (inductionVariable < last) {
        var i = interfaces[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        var currentSize = maxSize;
        var tmp1_elvis_lhs = i.prototype.$imask$;
        var imask = tmp1_elvis_lhs == null ? i.$imask$ : tmp1_elvis_lhs;
        if (!(imask == null)) {
          masks.push(imask);
          currentSize = imask.length;
        }
        var iid = i.$metadata$.iid;
        var tmp;
        if (iid == null) {
          tmp = null;
        } else {
          // Inline function 'kotlin.let' call
          // Inline function 'kotlin.contracts.contract' call
          // Inline function 'kotlin.js.implement.<anonymous>' call
          tmp = bitMaskWith(iid);
        }
        var iidImask = tmp;
        if (!(iidImask == null)) {
          masks.push(iidImask);
          currentSize = Math.max(currentSize, iidImask.length);
        }
        if (currentSize > maxSize) {
          maxSize = currentSize;
        }
      }
      return compositeBitMask(maxSize, masks);
    }
    function bitMaskWith(activeBit) {
      var numberIndex = activeBit >> 5;
      var intArray = new Int32Array((numberIndex + 1) | 0);
      var positionInNumber = activeBit & 31;
      var numberWithSettledBit = 1 << positionInNumber;
      intArray[numberIndex] = intArray[numberIndex] | numberWithSettledBit;
      return intArray;
    }
    function compositeBitMask(capacity, masks) {
      var tmp = 0;
      var tmp_0 = new Int32Array(capacity);
      while (tmp < capacity) {
        var tmp_1 = tmp;
        var result = 0;
        var inductionVariable = 0;
        var last = masks.length;
        while (inductionVariable < last) {
          var mask = masks[inductionVariable];
          inductionVariable = (inductionVariable + 1) | 0;
          if (tmp_1 < mask.length) {
            result = result | mask[tmp_1];
          }
        }
        tmp_0[tmp_1] = result;
        tmp = (tmp + 1) | 0;
      }
      return tmp_0;
    }
    function isBitSet(_this__u8e3s4, possibleActiveBit) {
      var numberIndex = possibleActiveBit >> 5;
      if (numberIndex > _this__u8e3s4.length) return false;
      var positionInNumber = possibleActiveBit & 31;
      var numberWithSettledBit = 1 << positionInNumber;
      return !((_this__u8e3s4[numberIndex] & numberWithSettledBit) === 0);
    }
    function FunctionAdapter() {}
    function fillArrayVal(array, initValue) {
      var inductionVariable = 0;
      var last = (array.length - 1) | 0;
      if (inductionVariable <= last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          array[i] = initValue;
        } while (!(i === last));
      return array;
    }
    function arrayIterator(array) {
      return new arrayIterator$1(array);
    }
    function charArray(size) {
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'withType' call
      var type = "CharArray";
      var array = new Uint16Array(size);
      array.$type$ = type;
      return array;
    }
    function charArrayOf(arr) {
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'withType' call
      var type = "CharArray";
      var array = new Uint16Array(arr);
      array.$type$ = type;
      return array;
    }
    function arrayIterator$1($array) {
      this.m2_1 = $array;
      this.l2_1 = 0;
    }
    protoOf(arrayIterator$1).m = function () {
      return !(this.l2_1 === this.m2_1.length);
    };
    protoOf(arrayIterator$1).n = function () {
      var tmp;
      if (!(this.l2_1 === this.m2_1.length)) {
        var tmp1 = this.l2_1;
        this.l2_1 = (tmp1 + 1) | 0;
        tmp = this.m2_1[tmp1];
      } else {
        throw NoSuchElementException_init_$Create$_0("" + this.l2_1);
      }
      return tmp;
    };
    function get_buf() {
      _init_properties_bitUtils_kt__nfcg4k();
      return buf;
    }
    var buf;
    function get_bufFloat64() {
      _init_properties_bitUtils_kt__nfcg4k();
      return bufFloat64;
    }
    var bufFloat64;
    var bufFloat32;
    function get_bufInt32() {
      _init_properties_bitUtils_kt__nfcg4k();
      return bufInt32;
    }
    var bufInt32;
    function get_lowIndex() {
      _init_properties_bitUtils_kt__nfcg4k();
      return lowIndex;
    }
    var lowIndex;
    function get_highIndex() {
      _init_properties_bitUtils_kt__nfcg4k();
      return highIndex;
    }
    var highIndex;
    function getNumberHashCode(obj) {
      _init_properties_bitUtils_kt__nfcg4k();
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.jsBitwiseOr' call
      // Inline function 'kotlin.js.asDynamic' call
      if ((obj | 0) === obj) {
        return numberToInt(obj);
      }
      get_bufFloat64()[0] = obj;
      return (imul(get_bufInt32()[get_highIndex()], 31) + get_bufInt32()[get_lowIndex()]) | 0;
    }
    var properties_initialized_bitUtils_kt_i2bo3e;
    function _init_properties_bitUtils_kt__nfcg4k() {
      if (!properties_initialized_bitUtils_kt_i2bo3e) {
        properties_initialized_bitUtils_kt_i2bo3e = true;
        buf = new ArrayBuffer(8);
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        bufFloat64 = new Float64Array(get_buf());
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        bufFloat32 = new Float32Array(get_buf());
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        bufInt32 = new Int32Array(get_buf());
        // Inline function 'kotlin.run' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlin.js.lowIndex.<anonymous>' call
        get_bufFloat64()[0] = -1.0;
        lowIndex = !(get_bufInt32()[0] === 0) ? 1 : 0;
        highIndex = (1 - get_lowIndex()) | 0;
      }
    }
    function charSequenceGet(a, index) {
      var tmp;
      if (isString(a)) {
        // Inline function 'kotlin.Char' call
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var code = a.charCodeAt(index);
        var tmp_0;
        // Inline function 'kotlin.code' call
        var this_0 = _Char___init__impl__6a9atx(0);
        if (code < Char__toInt_impl_vasixd(this_0)) {
          tmp_0 = true;
        } else {
          // Inline function 'kotlin.code' call
          var this_1 = _Char___init__impl__6a9atx(65535);
          tmp_0 = code > Char__toInt_impl_vasixd(this_1);
        }
        if (tmp_0) {
          throw IllegalArgumentException_init_$Create$_0("Invalid Char code: " + code);
        }
        tmp = numberToChar(code);
      } else {
        tmp = a.b(index);
      }
      return tmp;
    }
    function isString(a) {
      return typeof a === "string";
    }
    function charSequenceLength(a) {
      var tmp;
      if (isString(a)) {
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        tmp = a.length;
      } else {
        tmp = a.a();
      }
      return tmp;
    }
    function charSequenceSubSequence(a, startIndex, endIndex) {
      var tmp;
      if (isString(a)) {
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        tmp = a.substring(startIndex, endIndex);
      } else {
        tmp = a.c(startIndex, endIndex);
      }
      return tmp;
    }
    function arrayToString(array) {
      return joinToString(array, ", ", "[", "]", VOID, VOID, arrayToString$lambda);
    }
    function contentEqualsInternal(_this__u8e3s4, other) {
      // Inline function 'kotlin.js.asDynamic' call
      var a = _this__u8e3s4;
      // Inline function 'kotlin.js.asDynamic' call
      var b = other;
      if (a === b) return true;
      if (a == null || b == null || !isArrayish(b) || a.length != b.length) return false;
      var inductionVariable = 0;
      var last = a.length;
      if (inductionVariable < last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          if (!equals(a[i], b[i])) {
            return false;
          }
        } while (inductionVariable < last);
      return true;
    }
    function arrayToString$lambda(it) {
      return toString_1(it);
    }
    function compareTo(a, b) {
      var tmp;
      switch (typeof a) {
        case "number":
          var tmp_0;
          if (typeof b === "number") {
            tmp_0 = doubleCompareTo(a, b);
          } else {
            if (b instanceof Long) {
              tmp_0 = doubleCompareTo(a, b.j2());
            } else {
              tmp_0 = primitiveCompareTo(a, b);
            }
          }

          tmp = tmp_0;
          break;
        case "string":
        case "boolean":
          tmp = primitiveCompareTo(a, b);
          break;
        default:
          tmp = compareToDoNotIntrinsicify(a, b);
          break;
      }
      return tmp;
    }
    function doubleCompareTo(a, b) {
      var tmp;
      if (a < b) {
        tmp = -1;
      } else if (a > b) {
        tmp = 1;
      } else if (a === b) {
        var tmp_0;
        if (a !== 0) {
          tmp_0 = 0;
        } else {
          // Inline function 'kotlin.js.asDynamic' call
          var ia = 1 / a;
          var tmp_1;
          // Inline function 'kotlin.js.asDynamic' call
          if (ia === 1 / b) {
            tmp_1 = 0;
          } else {
            if (ia < 0) {
              tmp_1 = -1;
            } else {
              tmp_1 = 1;
            }
          }
          tmp_0 = tmp_1;
        }
        tmp = tmp_0;
      } else if (a !== a) {
        tmp = b !== b ? 0 : 1;
      } else {
        tmp = -1;
      }
      return tmp;
    }
    function primitiveCompareTo(a, b) {
      return a < b ? -1 : a > b ? 1 : 0;
    }
    function compareToDoNotIntrinsicify(a, b) {
      return a.d(b);
    }
    function identityHashCode(obj) {
      return getObjectHashCode(obj);
    }
    function getObjectHashCode(obj) {
      // Inline function 'kotlin.js.jsIn' call
      if (!("kotlinHashCodeValue$" in obj)) {
        var hash = calculateRandomHash();
        var descriptor = new Object();
        descriptor.value = hash;
        descriptor.enumerable = false;
        Object.defineProperty(obj, "kotlinHashCodeValue$", descriptor);
      }
      // Inline function 'kotlin.js.unsafeCast' call
      return obj["kotlinHashCodeValue$"];
    }
    function calculateRandomHash() {
      // Inline function 'kotlin.js.jsBitwiseOr' call
      return (Math.random() * 4.294967296e9) | 0;
    }
    function objectCreate(proto) {
      proto = proto === VOID ? null : proto;
      return Object.create(proto);
    }
    function defineProp(obj, name, getter, setter) {
      return Object.defineProperty(obj, name, { configurable: true, get: getter, set: setter });
    }
    function toString_1(o) {
      var tmp;
      if (o == null) {
        tmp = "null";
      } else if (isArrayish(o)) {
        tmp = "[...]";
      } else if (!(typeof o.toString === "function")) {
        tmp = anyToString(o);
      } else {
        // Inline function 'kotlin.js.unsafeCast' call
        tmp = o.toString();
      }
      return tmp;
    }
    function equals(obj1, obj2) {
      if (obj1 == null) {
        return obj2 == null;
      }
      if (obj2 == null) {
        return false;
      }
      if (typeof obj1 === "object" && typeof obj1.equals === "function") {
        return obj1.equals(obj2);
      }
      if (obj1 !== obj1) {
        return obj2 !== obj2;
      }
      if (typeof obj1 === "number" && typeof obj2 === "number") {
        var tmp;
        if (obj1 === obj2) {
          var tmp_0;
          if (obj1 !== 0) {
            tmp_0 = true;
          } else {
            // Inline function 'kotlin.js.asDynamic' call
            var tmp_1 = 1 / obj1;
            // Inline function 'kotlin.js.asDynamic' call
            tmp_0 = tmp_1 === 1 / obj2;
          }
          tmp = tmp_0;
        } else {
          tmp = false;
        }
        return tmp;
      }
      return obj1 === obj2;
    }
    function hashCode(obj) {
      if (obj == null) return 0;
      var typeOf = typeof obj;
      var tmp;
      switch (typeOf) {
        case "object":
          tmp = "function" === typeof obj.hashCode ? obj.hashCode() : getObjectHashCode(obj);
          break;
        case "function":
          tmp = getObjectHashCode(obj);
          break;
        case "number":
          tmp = getNumberHashCode(obj);
          break;
        case "boolean":
          // Inline function 'kotlin.js.unsafeCast' call

          tmp = getBooleanHashCode(obj);
          break;
        case "string":
          tmp = getStringHashCode(String(obj));
          break;
        case "bigint":
          tmp = getBigIntHashCode(obj);
          break;
        case "symbol":
          tmp = getSymbolHashCode(obj);
          break;
        default:
          tmp = (function () {
            throw new Error("Unexpected typeof `" + typeOf + "`");
          })();
          break;
      }
      return tmp;
    }
    function anyToString(o) {
      return Object.prototype.toString.call(o);
    }
    function getBooleanHashCode(value) {
      return value ? 1231 : 1237;
    }
    function getStringHashCode(str) {
      var hash = 0;
      var length = str.length;
      var inductionVariable = 0;
      var last = (length - 1) | 0;
      if (inductionVariable <= last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          // Inline function 'kotlin.js.asDynamic' call
          var code = str.charCodeAt(i);
          hash = (imul(hash, 31) + code) | 0;
        } while (!(i === last));
      return hash;
    }
    function getBigIntHashCode(value) {
      var shiftNumber = BigInt(32);
      var MASK = BigInt(4.294967295e9);
      var bigNumber = value < 0 ? -value : value;
      var hashCode = 0;
      var signum = value < 0 ? -1 : 1;
      while (bigNumber != 0) {
        // Inline function 'kotlin.js.unsafeCast' call
        var chunk = Number(bigNumber & MASK);
        hashCode = (imul(31, hashCode) + chunk) | 0;
        bigNumber = bigNumber >> shiftNumber;
      }
      return imul(hashCode, signum);
    }
    function getSymbolHashCode(value) {
      var hashCodeMap = symbolIsSharable(value) ? getSymbolMap() : getSymbolWeakMap();
      var cachedHashCode = hashCodeMap.get(value);
      if (cachedHashCode !== VOID) return cachedHashCode;
      var hash = calculateRandomHash();
      hashCodeMap.set(value, hash);
      return hash;
    }
    function symbolIsSharable(symbol) {
      return Symbol.keyFor(symbol) != VOID;
    }
    function getSymbolMap() {
      if (symbolMap === VOID) {
        symbolMap = new Map();
      }
      return symbolMap;
    }
    function getSymbolWeakMap() {
      if (symbolWeakMap === VOID) {
        symbolWeakMap = new WeakMap();
      }
      return symbolWeakMap;
    }
    var symbolMap;
    var symbolWeakMap;
    function boxIntrinsic(x) {
      var message = "Should be lowered";
      throw IllegalStateException_init_$Create$_0(toString_1(message));
    }
    function unboxIntrinsic(x) {
      var message = "Should be lowered";
      throw IllegalStateException_init_$Create$_0(toString_1(message));
    }
    function captureStack(instance, constructorFunction) {
      if (Error.captureStackTrace != null) {
        Error.captureStackTrace(instance, constructorFunction);
      } else {
        // Inline function 'kotlin.js.asDynamic' call
        instance.stack = new Error().stack;
      }
    }
    function protoOf(constructor) {
      return constructor.prototype;
    }
    function newThrowable(message, cause) {
      var throwable = new Error();
      var tmp;
      if (isUndefined(message)) {
        var tmp_0;
        if (isUndefined(cause)) {
          tmp_0 = message;
        } else {
          var tmp1_elvis_lhs = cause == null ? null : cause.toString();
          tmp_0 = tmp1_elvis_lhs == null ? VOID : tmp1_elvis_lhs;
        }
        tmp = tmp_0;
      } else {
        tmp = message == null ? VOID : message;
      }
      throwable.message = tmp;
      throwable.cause = cause;
      throwable.name = "Throwable";
      // Inline function 'kotlin.js.unsafeCast' call
      return throwable;
    }
    function isUndefined(value) {
      return value === VOID;
    }
    function extendThrowable(this_, message, cause) {
      Error.call(this_);
      setPropertiesToThrowableInstance(this_, message, cause);
    }
    function setPropertiesToThrowableInstance(this_, message, cause) {
      var errorInfo = calculateErrorInfo(Object.getPrototypeOf(this_));
      if ((errorInfo & 1) === 0) {
        var tmp;
        if (message == null) {
          var tmp_0;
          if (!(message === null)) {
            var tmp1_elvis_lhs = cause == null ? null : cause.toString();
            tmp_0 = tmp1_elvis_lhs == null ? VOID : tmp1_elvis_lhs;
          } else {
            tmp_0 = VOID;
          }
          tmp = tmp_0;
        } else {
          tmp = message;
        }
        this_.message = tmp;
      }
      if ((errorInfo & 2) === 0) {
        this_.cause = cause;
      }
      this_.name = Object.getPrototypeOf(this_).constructor.name;
    }
    function ensureNotNull(v) {
      var tmp;
      if (v == null) {
        THROW_NPE();
      } else {
        tmp = v;
      }
      return tmp;
    }
    function THROW_NPE() {
      throw NullPointerException_init_$Create$();
    }
    function THROW_CCE() {
      throw ClassCastException_init_$Create$();
    }
    function throwKotlinNothingValueException() {
      throw KotlinNothingValueException_init_$Create$();
    }
    function get_ZERO() {
      _init_properties_longJs_kt__elc2w5();
      return ZERO;
    }
    var ZERO;
    function get_ONE() {
      _init_properties_longJs_kt__elc2w5();
      return ONE;
    }
    var ONE;
    function get_NEG_ONE() {
      _init_properties_longJs_kt__elc2w5();
      return NEG_ONE;
    }
    var NEG_ONE;
    function get_MAX_VALUE() {
      _init_properties_longJs_kt__elc2w5();
      return MAX_VALUE;
    }
    var MAX_VALUE;
    function get_MIN_VALUE() {
      _init_properties_longJs_kt__elc2w5();
      return MIN_VALUE;
    }
    var MIN_VALUE;
    function get_TWO_PWR_24_() {
      _init_properties_longJs_kt__elc2w5();
      return TWO_PWR_24_;
    }
    var TWO_PWR_24_;
    function compare(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      if (equalsLong(_this__u8e3s4, other)) {
        return 0;
      }
      var thisNeg = isNegative(_this__u8e3s4);
      var otherNeg = isNegative(other);
      return thisNeg && !otherNeg ? -1 : !thisNeg && otherNeg ? 1 : isNegative(subtract(_this__u8e3s4, other)) ? -1 : 1;
    }
    function add(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      var a48 = (_this__u8e3s4.x1_1 >>> 16) | 0;
      var a32 = _this__u8e3s4.x1_1 & 65535;
      var a16 = (_this__u8e3s4.w1_1 >>> 16) | 0;
      var a00 = _this__u8e3s4.w1_1 & 65535;
      var b48 = (other.x1_1 >>> 16) | 0;
      var b32 = other.x1_1 & 65535;
      var b16 = (other.w1_1 >>> 16) | 0;
      var b00 = other.w1_1 & 65535;
      var c48 = 0;
      var c32 = 0;
      var c16 = 0;
      var c00 = 0;
      c00 = (c00 + ((a00 + b00) | 0)) | 0;
      c16 = (c16 + ((c00 >>> 16) | 0)) | 0;
      c00 = c00 & 65535;
      c16 = (c16 + ((a16 + b16) | 0)) | 0;
      c32 = (c32 + ((c16 >>> 16) | 0)) | 0;
      c16 = c16 & 65535;
      c32 = (c32 + ((a32 + b32) | 0)) | 0;
      c48 = (c48 + ((c32 >>> 16) | 0)) | 0;
      c32 = c32 & 65535;
      c48 = (c48 + ((a48 + b48) | 0)) | 0;
      c48 = c48 & 65535;
      return new Long((c16 << 16) | c00, (c48 << 16) | c32);
    }
    function subtract(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      return add(_this__u8e3s4, other.g2());
    }
    function multiply(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      if (isZero(_this__u8e3s4)) {
        return get_ZERO();
      } else if (isZero(other)) {
        return get_ZERO();
      }
      if (equalsLong(_this__u8e3s4, get_MIN_VALUE())) {
        return isOdd(other) ? get_MIN_VALUE() : get_ZERO();
      } else if (equalsLong(other, get_MIN_VALUE())) {
        return isOdd(_this__u8e3s4) ? get_MIN_VALUE() : get_ZERO();
      }
      if (isNegative(_this__u8e3s4)) {
        var tmp;
        if (isNegative(other)) {
          tmp = multiply(negate(_this__u8e3s4), negate(other));
        } else {
          tmp = negate(multiply(negate(_this__u8e3s4), other));
        }
        return tmp;
      } else if (isNegative(other)) {
        return negate(multiply(_this__u8e3s4, negate(other)));
      }
      if (lessThan(_this__u8e3s4, get_TWO_PWR_24_()) && lessThan(other, get_TWO_PWR_24_())) {
        return fromNumber(toNumber(_this__u8e3s4) * toNumber(other));
      }
      var a48 = (_this__u8e3s4.x1_1 >>> 16) | 0;
      var a32 = _this__u8e3s4.x1_1 & 65535;
      var a16 = (_this__u8e3s4.w1_1 >>> 16) | 0;
      var a00 = _this__u8e3s4.w1_1 & 65535;
      var b48 = (other.x1_1 >>> 16) | 0;
      var b32 = other.x1_1 & 65535;
      var b16 = (other.w1_1 >>> 16) | 0;
      var b00 = other.w1_1 & 65535;
      var c48 = 0;
      var c32 = 0;
      var c16 = 0;
      var c00 = 0;
      c00 = (c00 + imul(a00, b00)) | 0;
      c16 = (c16 + ((c00 >>> 16) | 0)) | 0;
      c00 = c00 & 65535;
      c16 = (c16 + imul(a16, b00)) | 0;
      c32 = (c32 + ((c16 >>> 16) | 0)) | 0;
      c16 = c16 & 65535;
      c16 = (c16 + imul(a00, b16)) | 0;
      c32 = (c32 + ((c16 >>> 16) | 0)) | 0;
      c16 = c16 & 65535;
      c32 = (c32 + imul(a32, b00)) | 0;
      c48 = (c48 + ((c32 >>> 16) | 0)) | 0;
      c32 = c32 & 65535;
      c32 = (c32 + imul(a16, b16)) | 0;
      c48 = (c48 + ((c32 >>> 16) | 0)) | 0;
      c32 = c32 & 65535;
      c32 = (c32 + imul(a00, b32)) | 0;
      c48 = (c48 + ((c32 >>> 16) | 0)) | 0;
      c32 = c32 & 65535;
      c48 = (c48 + ((((((imul(a48, b00) + imul(a32, b16)) | 0) + imul(a16, b32)) | 0) + imul(a00, b48)) | 0)) | 0;
      c48 = c48 & 65535;
      return new Long((c16 << 16) | c00, (c48 << 16) | c32);
    }
    function divide(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      if (isZero(other)) {
        throw Exception_init_$Create$_0("division by zero");
      } else if (isZero(_this__u8e3s4)) {
        return get_ZERO();
      }
      if (equalsLong(_this__u8e3s4, get_MIN_VALUE())) {
        if (equalsLong(other, get_ONE()) || equalsLong(other, get_NEG_ONE())) {
          return get_MIN_VALUE();
        } else if (equalsLong(other, get_MIN_VALUE())) {
          return get_ONE();
        } else {
          var halfThis = shiftRight(_this__u8e3s4, 1);
          var approx = shiftLeft(halfThis.c2(other), 1);
          if (equalsLong(approx, get_ZERO())) {
            return isNegative(other) ? get_ONE() : get_NEG_ONE();
          } else {
            var rem = subtract(_this__u8e3s4, multiply(other, approx));
            return add(approx, rem.c2(other));
          }
        }
      } else if (equalsLong(other, get_MIN_VALUE())) {
        return get_ZERO();
      }
      if (isNegative(_this__u8e3s4)) {
        var tmp;
        if (isNegative(other)) {
          tmp = negate(_this__u8e3s4).c2(negate(other));
        } else {
          tmp = negate(negate(_this__u8e3s4).c2(other));
        }
        return tmp;
      } else if (isNegative(other)) {
        return negate(_this__u8e3s4.c2(negate(other)));
      }
      var res = get_ZERO();
      var rem_0 = _this__u8e3s4;
      while (greaterThanOrEqual(rem_0, other)) {
        var approxDouble = toNumber(rem_0) / toNumber(other);
        var approx2 = Math.max(1.0, Math.floor(approxDouble));
        var log2 = Math.ceil(Math.log(approx2) / Math.LN2);
        var delta = log2 <= 48 ? 1.0 : Math.pow(2.0, log2 - 48);
        var approxRes = fromNumber(approx2);
        var approxRem = multiply(approxRes, other);
        while (isNegative(approxRem) || greaterThan(approxRem, rem_0)) {
          approx2 = approx2 - delta;
          approxRes = fromNumber(approx2);
          approxRem = multiply(approxRes, other);
        }
        if (isZero(approxRes)) {
          approxRes = get_ONE();
        }
        res = add(res, approxRes);
        rem_0 = subtract(rem_0, approxRem);
      }
      return res;
    }
    function modulo(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      return subtract(_this__u8e3s4, multiply(_this__u8e3s4.c2(other), other));
    }
    function shiftLeft(_this__u8e3s4, numBits) {
      _init_properties_longJs_kt__elc2w5();
      var numBits_0 = numBits & 63;
      if (numBits_0 === 0) {
        return _this__u8e3s4;
      } else {
        if (numBits_0 < 32) {
          return new Long(_this__u8e3s4.w1_1 << numBits_0, (_this__u8e3s4.x1_1 << numBits_0) | ((_this__u8e3s4.w1_1 >>> ((32 - numBits_0) | 0)) | 0));
        } else {
          return new Long(0, _this__u8e3s4.w1_1 << ((numBits_0 - 32) | 0));
        }
      }
    }
    function shiftRight(_this__u8e3s4, numBits) {
      _init_properties_longJs_kt__elc2w5();
      var numBits_0 = numBits & 63;
      if (numBits_0 === 0) {
        return _this__u8e3s4;
      } else {
        if (numBits_0 < 32) {
          return new Long((_this__u8e3s4.w1_1 >>> numBits_0) | 0 | (_this__u8e3s4.x1_1 << ((32 - numBits_0) | 0)), _this__u8e3s4.x1_1 >> numBits_0);
        } else {
          return new Long(_this__u8e3s4.x1_1 >> ((numBits_0 - 32) | 0), _this__u8e3s4.x1_1 >= 0 ? 0 : -1);
        }
      }
    }
    function toNumber(_this__u8e3s4) {
      _init_properties_longJs_kt__elc2w5();
      return _this__u8e3s4.x1_1 * 4.294967296e9 + getLowBitsUnsigned(_this__u8e3s4);
    }
    function toStringImpl(_this__u8e3s4, radix) {
      _init_properties_longJs_kt__elc2w5();
      if (radix < 2 || 36 < radix) {
        throw Exception_init_$Create$_0("radix out of range: " + radix);
      }
      if (isZero(_this__u8e3s4)) {
        return "0";
      }
      if (isNegative(_this__u8e3s4)) {
        if (equalsLong(_this__u8e3s4, get_MIN_VALUE())) {
          var radixLong = fromInt(radix);
          var div = _this__u8e3s4.c2(radixLong);
          var rem = subtract(multiply(div, radixLong), _this__u8e3s4).i2();
          var tmp = toStringImpl(div, radix);
          // Inline function 'kotlin.js.unsafeCast' call
          // Inline function 'kotlin.js.asDynamic' call
          return tmp + rem.toString(radix);
        } else {
          return "-" + toStringImpl(negate(_this__u8e3s4), radix);
        }
      }
      var digitsPerTime = radix === 2 ? 31 : radix <= 10 ? 9 : radix <= 21 ? 7 : radix <= 35 ? 6 : 5;
      var radixToPower = fromNumber(Math.pow(radix, digitsPerTime));
      var rem_0 = _this__u8e3s4;
      var result = "";
      while (true) {
        var remDiv = rem_0.c2(radixToPower);
        var intval = subtract(rem_0, multiply(remDiv, radixToPower)).i2();
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var digits = intval.toString(radix);
        rem_0 = remDiv;
        if (isZero(rem_0)) {
          return digits + result;
        } else {
          while (digits.length < digitsPerTime) {
            digits = "0" + digits;
          }
          result = digits + result;
        }
      }
    }
    function equalsLong(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      return _this__u8e3s4.x1_1 === other.x1_1 && _this__u8e3s4.w1_1 === other.w1_1;
    }
    function hashCode_0(l) {
      _init_properties_longJs_kt__elc2w5();
      return l.w1_1 ^ l.x1_1;
    }
    function fromInt(value) {
      _init_properties_longJs_kt__elc2w5();
      return new Long(value, value < 0 ? -1 : 0);
    }
    function isNegative(_this__u8e3s4) {
      _init_properties_longJs_kt__elc2w5();
      return _this__u8e3s4.x1_1 < 0;
    }
    function isZero(_this__u8e3s4) {
      _init_properties_longJs_kt__elc2w5();
      return _this__u8e3s4.x1_1 === 0 && _this__u8e3s4.w1_1 === 0;
    }
    function isOdd(_this__u8e3s4) {
      _init_properties_longJs_kt__elc2w5();
      return (_this__u8e3s4.w1_1 & 1) === 1;
    }
    function negate(_this__u8e3s4) {
      _init_properties_longJs_kt__elc2w5();
      return _this__u8e3s4.g2();
    }
    function lessThan(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      return compare(_this__u8e3s4, other) < 0;
    }
    function fromNumber(value) {
      _init_properties_longJs_kt__elc2w5();
      if (isNaN_0(value)) {
        return get_ZERO();
      } else if (value <= -9.223372036854776e18) {
        return get_MIN_VALUE();
      } else if (value + 1 >= 9.223372036854776e18) {
        return get_MAX_VALUE();
      } else if (value < 0) {
        return negate(fromNumber(-value));
      } else {
        var twoPwr32 = 4.294967296e9;
        // Inline function 'kotlin.js.jsBitwiseOr' call
        var tmp = (value % twoPwr32) | 0;
        // Inline function 'kotlin.js.jsBitwiseOr' call
        var tmp$ret$1 = (value / twoPwr32) | 0;
        return new Long(tmp, tmp$ret$1);
      }
    }
    function greaterThan(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      return compare(_this__u8e3s4, other) > 0;
    }
    function greaterThanOrEqual(_this__u8e3s4, other) {
      _init_properties_longJs_kt__elc2w5();
      return compare(_this__u8e3s4, other) >= 0;
    }
    function getLowBitsUnsigned(_this__u8e3s4) {
      _init_properties_longJs_kt__elc2w5();
      return _this__u8e3s4.w1_1 >= 0 ? _this__u8e3s4.w1_1 : 4.294967296e9 + _this__u8e3s4.w1_1;
    }
    var properties_initialized_longJs_kt_4syf89;
    function _init_properties_longJs_kt__elc2w5() {
      if (!properties_initialized_longJs_kt_4syf89) {
        properties_initialized_longJs_kt_4syf89 = true;
        ZERO = fromInt(0);
        ONE = fromInt(1);
        NEG_ONE = fromInt(-1);
        MAX_VALUE = new Long(-1, 2147483647);
        MIN_VALUE = new Long(0, -2147483648);
        TWO_PWR_24_ = fromInt(16777216);
      }
    }
    function createMetadata(kind, name, defaultConstructor, associatedObjectKey, associatedObjects, suspendArity) {
      var undef = VOID;
      var iid = kind === "interface" ? generateInterfaceId() : VOID;
      return {
        kind: kind,
        simpleName: name,
        associatedObjectKey: associatedObjectKey,
        associatedObjects: associatedObjects,
        suspendArity: suspendArity,
        $kClass$: undef,
        defaultConstructor: defaultConstructor,
        iid: iid,
      };
    }
    function generateInterfaceId() {
      if (globalInterfaceId === VOID) {
        globalInterfaceId = 0;
      }
      // Inline function 'kotlin.js.unsafeCast' call
      globalInterfaceId = (globalInterfaceId + 1) | 0;
      // Inline function 'kotlin.js.unsafeCast' call
      return globalInterfaceId;
    }
    var globalInterfaceId;
    function initMetadataFor(kind, ctor, name, defaultConstructor, parent, interfaces, suspendArity, associatedObjectKey, associatedObjects) {
      if (!(parent == null)) {
        ctor.prototype = Object.create(parent.prototype);
        ctor.prototype.constructor = ctor;
      }
      var metadata = createMetadata(kind, name, defaultConstructor, associatedObjectKey, associatedObjects, suspendArity);
      ctor.$metadata$ = metadata;
      if (!(interfaces == null)) {
        var receiver = !equals(metadata.iid, VOID) ? ctor : ctor.prototype;
        receiver.$imask$ = implement(interfaces);
      }
    }
    function initMetadataForClass(ctor, name, defaultConstructor, parent, interfaces, suspendArity, associatedObjectKey, associatedObjects) {
      var kind = "class";
      initMetadataFor(kind, ctor, name, defaultConstructor, parent, interfaces, suspendArity, associatedObjectKey, associatedObjects);
    }
    function initMetadataForObject(ctor, name, defaultConstructor, parent, interfaces, suspendArity, associatedObjectKey, associatedObjects) {
      var kind = "object";
      initMetadataFor(kind, ctor, name, defaultConstructor, parent, interfaces, suspendArity, associatedObjectKey, associatedObjects);
    }
    function initMetadataForInterface(ctor, name, defaultConstructor, parent, interfaces, suspendArity, associatedObjectKey, associatedObjects) {
      var kind = "interface";
      initMetadataFor(kind, ctor, name, defaultConstructor, parent, interfaces, suspendArity, associatedObjectKey, associatedObjects);
    }
    function initMetadataForLambda(ctor, parent, interfaces, suspendArity) {
      initMetadataForClass(ctor, "Lambda", VOID, parent, interfaces, suspendArity, VOID, VOID);
    }
    function initMetadataForCoroutine(ctor, parent, interfaces, suspendArity) {
      initMetadataForClass(ctor, "Coroutine", VOID, parent, interfaces, suspendArity, VOID, VOID);
    }
    function initMetadataForFunctionReference(ctor, parent, interfaces, suspendArity) {
      initMetadataForClass(ctor, "FunctionReference", VOID, parent, interfaces, suspendArity, VOID, VOID);
    }
    function initMetadataForCompanion(ctor, parent, interfaces, suspendArity) {
      initMetadataForObject(ctor, "Companion", VOID, parent, interfaces, suspendArity, VOID, VOID);
    }
    function classMeta(name, defaultConstructor, associatedObjectKey, associatedObjects, suspendArity) {
      return createMetadata("class", name, defaultConstructor, associatedObjectKey, associatedObjects, suspendArity);
    }
    function arrayConcat(args) {
      var len = args.length;
      // Inline function 'kotlin.js.unsafeCast' call
      var typed = Array(len);
      var inductionVariable = 0;
      var last = (len - 1) | 0;
      if (inductionVariable <= last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var arr = args[i];
          if (!(!(arr == null) ? isArray(arr) : false)) {
            typed[i] = [].slice.call(arr);
          } else {
            typed[i] = arr;
          }
        } while (!(i === last));
      return [].concat.apply([], typed);
    }
    function taggedArrayCopy(array) {
      var res = array.slice();
      res.$type$ = array.$type$;
      // Inline function 'kotlin.js.unsafeCast' call
      return res;
    }
    function toByte(a) {
      // Inline function 'kotlin.js.unsafeCast' call
      return (a << 24) >> 24;
    }
    function numberToInt(a) {
      var tmp;
      if (a instanceof Long) {
        tmp = a.i2();
      } else {
        tmp = doubleToInt(a);
      }
      return tmp;
    }
    function doubleToInt(a) {
      var tmp;
      if (a > 2147483647) {
        tmp = 2147483647;
      } else if (a < -2147483648) {
        tmp = -2147483648;
      } else {
        // Inline function 'kotlin.js.jsBitwiseOr' call
        tmp = a | 0;
      }
      return tmp;
    }
    function numberToDouble(a) {
      // Inline function 'kotlin.js.unsafeCast' call
      return +a;
    }
    function toShort(a) {
      // Inline function 'kotlin.js.unsafeCast' call
      return (a << 16) >> 16;
    }
    function numberToLong(a) {
      var tmp;
      if (a instanceof Long) {
        tmp = a;
      } else {
        tmp = fromNumber(a);
      }
      return tmp;
    }
    function numberToChar(a) {
      // Inline function 'kotlin.toUShort' call
      var this_0 = numberToInt(a);
      var tmp$ret$0 = _UShort___init__impl__jigrne(toShort(this_0));
      return _Char___init__impl__6a9atx_0(tmp$ret$0);
    }
    function toLong(a) {
      return fromInt(a);
    }
    function numberRangeToNumber(start, endInclusive) {
      return new IntRange(start, endInclusive);
    }
    function get_propertyRefClassMetadataCache() {
      _init_properties_reflectRuntime_kt__5r4uu3();
      return propertyRefClassMetadataCache;
    }
    var propertyRefClassMetadataCache;
    function metadataObject() {
      _init_properties_reflectRuntime_kt__5r4uu3();
      return classMeta(VOID, VOID, VOID, VOID, VOID);
    }
    function getPropertyCallableRef(name, paramCount, superType, getter, setter) {
      _init_properties_reflectRuntime_kt__5r4uu3();
      getter.get = getter;
      getter.set = setter;
      getter.callableName = name;
      // Inline function 'kotlin.js.unsafeCast' call
      return getPropertyRefClass(getter, getKPropMetadata(paramCount, setter), getInterfaceMaskFor(getter, superType));
    }
    function getPropertyRefClass(obj, metadata, imask) {
      _init_properties_reflectRuntime_kt__5r4uu3();
      obj.$metadata$ = metadata;
      obj.constructor = obj;
      obj.$imask$ = imask;
      return obj;
    }
    function getKPropMetadata(paramCount, setter) {
      _init_properties_reflectRuntime_kt__5r4uu3();
      return get_propertyRefClassMetadataCache()[paramCount][setter == null ? 0 : 1];
    }
    function getInterfaceMaskFor(obj, superType) {
      _init_properties_reflectRuntime_kt__5r4uu3();
      var tmp0_elvis_lhs = obj.$imask$;
      var tmp;
      if (tmp0_elvis_lhs == null) {
        // Inline function 'kotlin.arrayOf' call
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var tmp$ret$2 = [superType];
        tmp = implement(tmp$ret$2);
      } else {
        tmp = tmp0_elvis_lhs;
      }
      return tmp;
    }
    var properties_initialized_reflectRuntime_kt_inkhwd;
    function _init_properties_reflectRuntime_kt__5r4uu3() {
      if (!properties_initialized_reflectRuntime_kt_inkhwd) {
        properties_initialized_reflectRuntime_kt_inkhwd = true;
        // Inline function 'kotlin.arrayOf' call
        // Inline function 'kotlin.arrayOf' call
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var tmp = [metadataObject(), metadataObject()];
        // Inline function 'kotlin.arrayOf' call
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var tmp_0 = [metadataObject(), metadataObject()];
        // Inline function 'kotlin.arrayOf' call
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        propertyRefClassMetadataCache = [tmp, tmp_0, [metadataObject(), metadataObject()]];
      }
    }
    function isArrayish(o) {
      return isJsArray(o) || isView(o);
    }
    function isJsArray(obj) {
      // Inline function 'kotlin.js.unsafeCast' call
      return Array.isArray(obj);
    }
    function isInterface(obj, iface) {
      return isInterfaceImpl(obj, iface.$metadata$.iid);
    }
    function isInterfaceImpl(obj, iface) {
      // Inline function 'kotlin.js.unsafeCast' call
      var tmp0_elvis_lhs = obj.$imask$;
      var tmp;
      if (tmp0_elvis_lhs == null) {
        return false;
      } else {
        tmp = tmp0_elvis_lhs;
      }
      var mask = tmp;
      return isBitSet(mask, iface);
    }
    function isArray(obj) {
      var tmp;
      if (isJsArray(obj)) {
        // Inline function 'kotlin.js.asDynamic' call
        tmp = !obj.$type$;
      } else {
        tmp = false;
      }
      return tmp;
    }
    function isNumber(a) {
      var tmp;
      if (typeof a === "number") {
        tmp = true;
      } else {
        tmp = a instanceof Long;
      }
      return tmp;
    }
    function isComparable(value) {
      var type = typeof value;
      return type === "string" || type === "boolean" || isNumber(value) || isInterface(value, Comparable);
    }
    function isCharSequence(value) {
      return typeof value === "string" || isInterface(value, CharSequence);
    }
    function isByteArray(a) {
      // Inline function 'kotlin.js.jsInstanceOf' call
      return a instanceof Int8Array;
    }
    function isIntArray(a) {
      // Inline function 'kotlin.js.jsInstanceOf' call
      return a instanceof Int32Array;
    }
    function isFloatArray(a) {
      // Inline function 'kotlin.js.jsInstanceOf' call
      return a instanceof Float32Array;
    }
    function isLongArray(a) {
      return isJsArray(a) && a.$type$ === "LongArray";
    }
    function isDoubleArray(a) {
      // Inline function 'kotlin.js.jsInstanceOf' call
      return a instanceof Float64Array;
    }
    function calculateErrorInfo(proto) {
      var tmp0_safe_receiver = proto.constructor;
      var metadata = tmp0_safe_receiver == null ? null : tmp0_safe_receiver.$metadata$;
      var tmp2_safe_receiver = metadata == null ? null : metadata.errorInfo;
      if (tmp2_safe_receiver == null) null;
      else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        return tmp2_safe_receiver;
      }
      var result = 0;
      if (hasProp(proto, "message")) result = result | 1;
      if (hasProp(proto, "cause")) result = result | 2;
      if (!(result === 3)) {
        var parentProto = getPrototypeOf(proto);
        if (parentProto != Error.prototype) {
          result = result | calculateErrorInfo(parentProto);
        }
      }
      if (!(metadata == null)) {
        metadata.errorInfo = result;
      }
      return result;
    }
    function hasProp(proto, propName) {
      return proto.hasOwnProperty(propName);
    }
    function getPrototypeOf(obj) {
      return Object.getPrototypeOf(obj);
    }
    function get_VOID() {
      _init_properties_void_kt__3zg9as();
      return VOID;
    }
    var VOID;
    var properties_initialized_void_kt_e4ret2;
    function _init_properties_void_kt__3zg9as() {
      if (!properties_initialized_void_kt_e4ret2) {
        properties_initialized_void_kt_e4ret2 = true;
        VOID = void 0;
      }
    }
    function asList(_this__u8e3s4) {
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.asDynamic' call
      return new ArrayList(_this__u8e3s4);
    }
    function copyOf(_this__u8e3s4, newSize) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(newSize >= 0)) {
        // Inline function 'kotlin.collections.copyOf.<anonymous>' call
        var message = "Invalid new array size: " + newSize + ".";
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      return fillFrom(_this__u8e3s4, new Int32Array(newSize));
    }
    function copyOf_0(_this__u8e3s4, newSize) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(newSize >= 0)) {
        // Inline function 'kotlin.collections.copyOf.<anonymous>' call
        var message = "Invalid new array size: " + newSize + ".";
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      return arrayCopyResize(_this__u8e3s4, newSize, null);
    }
    function copyOfRange(_this__u8e3s4, fromIndex, toIndex) {
      Companion_instance_5.o2(fromIndex, toIndex, _this__u8e3s4.length);
      // Inline function 'kotlin.js.asDynamic' call
      return _this__u8e3s4.slice(fromIndex, toIndex);
    }
    function contentEquals(_this__u8e3s4, other) {
      return contentEqualsInternal(_this__u8e3s4, other);
    }
    function digitToIntImpl(_this__u8e3s4) {
      // Inline function 'kotlin.code' call
      var ch = Char__toInt_impl_vasixd(_this__u8e3s4);
      var index = binarySearchRange(Digit_getInstance().p2_1, ch);
      var diff = (ch - Digit_getInstance().p2_1[index]) | 0;
      return diff < 10 ? diff : -1;
    }
    function binarySearchRange(array, needle) {
      var bottom = 0;
      var top = (array.length - 1) | 0;
      var middle = -1;
      var value = 0;
      while (bottom <= top) {
        middle = (((bottom + top) | 0) / 2) | 0;
        value = array[middle];
        if (needle > value) bottom = (middle + 1) | 0;
        else if (needle === value) return middle;
        else top = (middle - 1) | 0;
      }
      return (middle - (needle < value ? 1 : 0)) | 0;
    }
    function Digit() {
      Digit_instance = this;
      var tmp = this;
      // Inline function 'kotlin.intArrayOf' call
      tmp.p2_1 = new Int32Array([
        48, 1632, 1776, 1984, 2406, 2534, 2662, 2790, 2918, 3046, 3174, 3302, 3430, 3558, 3664, 3792, 3872, 4160, 4240, 6112, 6160, 6470, 6608, 6784, 6800,
        6992, 7088, 7232, 7248, 42528, 43216, 43264, 43472, 43504, 43600, 44016, 65296,
      ]);
    }
    var Digit_instance;
    function Digit_getInstance() {
      if (Digit_instance == null) new Digit();
      return Digit_instance;
    }
    function isWhitespaceImpl(_this__u8e3s4) {
      // Inline function 'kotlin.code' call
      var ch = Char__toInt_impl_vasixd(_this__u8e3s4);
      return (
        (9 <= ch ? ch <= 13 : false) ||
        (28 <= ch ? ch <= 32 : false) ||
        ch === 160 ||
        (ch > 4096 && (ch === 5760 || (8192 <= ch ? ch <= 8202 : false) || ch === 8232 || ch === 8233 || ch === 8239 || ch === 8287 || ch === 12288))
      );
    }
    function Comparator() {}
    function isNaN_0(_this__u8e3s4) {
      return !(_this__u8e3s4 === _this__u8e3s4);
    }
    function takeHighestOneBit(_this__u8e3s4) {
      var tmp;
      if (_this__u8e3s4 === 0) {
        tmp = 0;
      } else {
        // Inline function 'kotlin.countLeadingZeroBits' call
        tmp = 1 << ((31 - clz32(_this__u8e3s4)) | 0);
      }
      return tmp;
    }
    function collectionToArray(collection) {
      return collectionToArrayCommonImpl(collection);
    }
    function listOf(element) {
      return arrayListOf([element]);
    }
    function mapCapacity(expectedSize) {
      return expectedSize;
    }
    function checkIndexOverflow(index) {
      if (index < 0) {
        throwIndexOverflow();
      }
      return index;
    }
    function sortWith(_this__u8e3s4, comparator) {
      collectionsSort(_this__u8e3s4, comparator);
    }
    function copyToArray(collection) {
      var tmp;
      // Inline function 'kotlin.js.asDynamic' call
      if (collection.toArray !== undefined) {
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        tmp = collection.toArray();
      } else {
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        tmp = collectionToArray(collection);
      }
      return tmp;
    }
    function collectionsSort(list, comparator) {
      if (list.p() <= 1) return Unit_instance;
      var array = copyToArray(list);
      sortArrayWith(array, comparator);
      var inductionVariable = 0;
      var last = array.length;
      if (inductionVariable < last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          list.q2(i, array[i]);
        } while (inductionVariable < last);
    }
    function arrayCopy(source, destination, destinationOffset, startIndex, endIndex) {
      Companion_instance_5.o2(startIndex, endIndex, source.length);
      var rangeSize = (endIndex - startIndex) | 0;
      Companion_instance_5.o2(destinationOffset, (destinationOffset + rangeSize) | 0, destination.length);
      if (isView(destination) && isView(source)) {
        // Inline function 'kotlin.js.asDynamic' call
        var subrange = source.subarray(startIndex, endIndex);
        // Inline function 'kotlin.js.asDynamic' call
        destination.set(subrange, destinationOffset);
      } else {
        if (!(source === destination) || destinationOffset <= startIndex) {
          var inductionVariable = 0;
          if (inductionVariable < rangeSize)
            do {
              var index = inductionVariable;
              inductionVariable = (inductionVariable + 1) | 0;
              destination[(destinationOffset + index) | 0] = source[(startIndex + index) | 0];
            } while (inductionVariable < rangeSize);
        } else {
          var inductionVariable_0 = (rangeSize - 1) | 0;
          if (0 <= inductionVariable_0)
            do {
              var index_0 = inductionVariable_0;
              inductionVariable_0 = (inductionVariable_0 + -1) | 0;
              destination[(destinationOffset + index_0) | 0] = source[(startIndex + index_0) | 0];
            } while (0 <= inductionVariable_0);
        }
      }
    }
    function AbstractMutableCollection() {
      AbstractCollection.call(this);
    }
    protoOf(AbstractMutableCollection).toJSON = function () {
      return this.toArray();
    };
    protoOf(AbstractMutableCollection).s2 = function () {};
    function IteratorImpl($outer) {
      this.v2_1 = $outer;
      this.t2_1 = 0;
      this.u2_1 = -1;
    }
    protoOf(IteratorImpl).m = function () {
      return this.t2_1 < this.v2_1.p();
    };
    protoOf(IteratorImpl).n = function () {
      if (!this.m()) throw NoSuchElementException_init_$Create$();
      var tmp = this;
      var tmp1 = this.t2_1;
      this.t2_1 = (tmp1 + 1) | 0;
      tmp.u2_1 = tmp1;
      return this.v2_1.o(this.u2_1);
    };
    protoOf(IteratorImpl).w2 = function () {
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      if (!!(this.u2_1 === -1)) {
        // Inline function 'kotlin.collections.IteratorImpl.remove.<anonymous>' call
        var message = "Call next() or previous() before removing element from the iterator.";
        throw IllegalStateException_init_$Create$_0(toString_1(message));
      }
      this.v2_1.y2(this.u2_1);
      this.t2_1 = this.u2_1;
      this.u2_1 = -1;
    };
    function ListIteratorImpl($outer, index) {
      this.c3_1 = $outer;
      IteratorImpl.call(this, $outer);
      Companion_instance_5.d3(index, this.c3_1.p());
      this.t2_1 = index;
    }
    protoOf(ListIteratorImpl).e3 = function () {
      return this.t2_1 > 0;
    };
    protoOf(ListIteratorImpl).f3 = function () {
      if (!this.e3()) throw NoSuchElementException_init_$Create$();
      var tmp = this;
      this.t2_1 = (this.t2_1 - 1) | 0;
      tmp.u2_1 = this.t2_1;
      return this.c3_1.o(this.u2_1);
    };
    function AbstractMutableList() {
      AbstractMutableCollection.call(this);
      this.x2_1 = 0;
    }
    protoOf(AbstractMutableList).r2 = function (element) {
      this.s2();
      this.g3(this.p(), element);
      return true;
    };
    protoOf(AbstractMutableList).h3 = function () {
      this.s2();
      this.i3(0, this.p());
    };
    protoOf(AbstractMutableList).l = function () {
      return new IteratorImpl(this);
    };
    protoOf(AbstractMutableList).h1 = function (element) {
      return this.j3(element) >= 0;
    };
    protoOf(AbstractMutableList).j3 = function (element) {
      var tmp$ret$1;
      $l$block: {
        // Inline function 'kotlin.collections.indexOfFirst' call
        var index = 0;
        var tmp0_iterator = this.l();
        while (tmp0_iterator.m()) {
          var item = tmp0_iterator.n();
          // Inline function 'kotlin.collections.AbstractMutableList.indexOf.<anonymous>' call
          if (equals(item, element)) {
            tmp$ret$1 = index;
            break $l$block;
          }
          index = (index + 1) | 0;
        }
        tmp$ret$1 = -1;
      }
      return tmp$ret$1;
    };
    protoOf(AbstractMutableList).k3 = function (index) {
      return new ListIteratorImpl(this, index);
    };
    protoOf(AbstractMutableList).i3 = function (fromIndex, toIndex) {
      var iterator = this.k3(fromIndex);
      // Inline function 'kotlin.repeat' call
      var times = (toIndex - fromIndex) | 0;
      // Inline function 'kotlin.contracts.contract' call
      var inductionVariable = 0;
      if (inductionVariable < times)
        do {
          var index = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          // Inline function 'kotlin.collections.AbstractMutableList.removeRange.<anonymous>' call
          iterator.n();
          iterator.w2();
        } while (inductionVariable < times);
    };
    protoOf(AbstractMutableList).equals = function (other) {
      if (other === this) return true;
      if (!(!(other == null) ? isInterface(other, KtList) : false)) return false;
      return Companion_instance_5.l3(this, other);
    };
    protoOf(AbstractMutableList).hashCode = function () {
      return Companion_instance_5.m3(this);
    };
    function AbstractMutableMap() {
      AbstractMap.call(this);
      this.p3_1 = null;
      this.q3_1 = null;
    }
    protoOf(AbstractMutableMap).r3 = function () {
      return new HashMapValuesDefault(this);
    };
    protoOf(AbstractMutableMap).s3 = function () {
      var tmp0_elvis_lhs = this.q3_1;
      var tmp;
      if (tmp0_elvis_lhs == null) {
        // Inline function 'kotlin.also' call
        var this_0 = this.r3();
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlin.collections.AbstractMutableMap.<get-values>.<anonymous>' call
        this.q3_1 = this_0;
        tmp = this_0;
      } else {
        tmp = tmp0_elvis_lhs;
      }
      return tmp;
    };
    function AbstractMutableSet() {
      AbstractMutableCollection.call(this);
    }
    protoOf(AbstractMutableSet).equals = function (other) {
      if (other === this) return true;
      if (!(!(other == null) ? isInterface(other, KtSet) : false)) return false;
      return Companion_instance_7.x3(this, other);
    };
    protoOf(AbstractMutableSet).hashCode = function () {
      return Companion_instance_7.y3(this);
    };
    function arrayOfUninitializedElements(capacity) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(capacity >= 0)) {
        // Inline function 'kotlin.collections.arrayOfUninitializedElements.<anonymous>' call
        var message = "capacity must be non-negative.";
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.arrayOfNulls' call
      // Inline function 'kotlin.js.asDynamic' call
      return fillArrayVal(Array(capacity), null);
    }
    function resetRange(_this__u8e3s4, fromIndex, toIndex) {
      // Inline function 'kotlin.js.nativeFill' call
      // Inline function 'kotlin.js.asDynamic' call
      _this__u8e3s4.fill(null, fromIndex, toIndex);
    }
    function copyOfUninitializedElements(_this__u8e3s4, newSize) {
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.asDynamic' call
      return copyOf_0(_this__u8e3s4, newSize);
    }
    function resetAt(_this__u8e3s4, index) {
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.asDynamic' call
      _this__u8e3s4[index] = null;
    }
    function Companion_2() {
      Companion_instance_2 = this;
      var tmp = this;
      // Inline function 'kotlin.also' call
      var this_0 = ArrayList_init_$Create$_0(0);
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.collections.Companion.Empty.<anonymous>' call
      this_0.b4_1 = true;
      tmp.c4_1 = this_0;
    }
    var Companion_instance_2;
    function Companion_getInstance_2() {
      if (Companion_instance_2 == null) new Companion_2();
      return Companion_instance_2;
    }
    function ArrayList_init_$Init$($this) {
      // Inline function 'kotlin.emptyArray' call
      var tmp$ret$0 = [];
      ArrayList.call($this, tmp$ret$0);
      return $this;
    }
    function ArrayList_init_$Create$() {
      return ArrayList_init_$Init$(objectCreate(protoOf(ArrayList)));
    }
    function ArrayList_init_$Init$_0(initialCapacity, $this) {
      // Inline function 'kotlin.emptyArray' call
      var tmp$ret$0 = [];
      ArrayList.call($this, tmp$ret$0);
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(initialCapacity >= 0)) {
        // Inline function 'kotlin.collections.ArrayList.<init>.<anonymous>' call
        var message = "Negative initial capacity: " + initialCapacity;
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      return $this;
    }
    function ArrayList_init_$Create$_0(initialCapacity) {
      return ArrayList_init_$Init$_0(initialCapacity, objectCreate(protoOf(ArrayList)));
    }
    function ArrayList_init_$Init$_1(elements, $this) {
      // Inline function 'kotlin.collections.toTypedArray' call
      var tmp$ret$0 = copyToArray(elements);
      ArrayList.call($this, tmp$ret$0);
      return $this;
    }
    function ArrayList_init_$Create$_1(elements) {
      return ArrayList_init_$Init$_1(elements, objectCreate(protoOf(ArrayList)));
    }
    function increaseLength($this, amount) {
      var previous = $this.p();
      // Inline function 'kotlin.js.asDynamic' call
      $this.a4_1.length = ($this.p() + amount) | 0;
      return previous;
    }
    function rangeCheck($this, index) {
      // Inline function 'kotlin.apply' call
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.collections.ArrayList.rangeCheck.<anonymous>' call
      Companion_instance_5.d4(index, $this.p());
      return index;
    }
    function insertionRangeCheck($this, index) {
      // Inline function 'kotlin.apply' call
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.collections.ArrayList.insertionRangeCheck.<anonymous>' call
      Companion_instance_5.d3(index, $this.p());
      return index;
    }
    function ArrayList(array) {
      Companion_getInstance_2();
      AbstractMutableList.call(this);
      this.a4_1 = array;
      this.b4_1 = false;
    }
    protoOf(ArrayList).p = function () {
      return this.a4_1.length;
    };
    protoOf(ArrayList).o = function (index) {
      var tmp = this.a4_1[rangeCheck(this, index)];
      return (tmp == null ? true : !(tmp == null)) ? tmp : THROW_CCE();
    };
    protoOf(ArrayList).q2 = function (index, element) {
      this.s2();
      rangeCheck(this, index);
      // Inline function 'kotlin.apply' call
      var this_0 = this.a4_1[index];
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.collections.ArrayList.set.<anonymous>' call
      this.a4_1[index] = element;
      var tmp = this_0;
      return (tmp == null ? true : !(tmp == null)) ? tmp : THROW_CCE();
    };
    protoOf(ArrayList).r2 = function (element) {
      this.s2();
      // Inline function 'kotlin.js.asDynamic' call
      this.a4_1.push(element);
      this.x2_1 = (this.x2_1 + 1) | 0;
      return true;
    };
    protoOf(ArrayList).g3 = function (index, element) {
      this.s2();
      // Inline function 'kotlin.js.asDynamic' call
      this.a4_1.splice(insertionRangeCheck(this, index), 0, element);
      this.x2_1 = (this.x2_1 + 1) | 0;
    };
    protoOf(ArrayList).e4 = function (elements) {
      this.s2();
      if (elements.i()) return false;
      var offset = increaseLength(this, elements.p());
      // Inline function 'kotlin.collections.forEachIndexed' call
      var index = 0;
      var tmp0_iterator = elements.l();
      while (tmp0_iterator.m()) {
        var item = tmp0_iterator.n();
        // Inline function 'kotlin.collections.ArrayList.addAll.<anonymous>' call
        var tmp1 = index;
        index = (tmp1 + 1) | 0;
        var index_0 = checkIndexOverflow(tmp1);
        this.a4_1[(offset + index_0) | 0] = item;
      }
      this.x2_1 = (this.x2_1 + 1) | 0;
      return true;
    };
    protoOf(ArrayList).y2 = function (index) {
      this.s2();
      rangeCheck(this, index);
      this.x2_1 = (this.x2_1 + 1) | 0;
      var tmp;
      if (index === get_lastIndex_0(this)) {
        // Inline function 'kotlin.js.asDynamic' call
        tmp = this.a4_1.pop();
      } else {
        // Inline function 'kotlin.js.asDynamic' call
        tmp = this.a4_1.splice(index, 1)[0];
      }
      return tmp;
    };
    protoOf(ArrayList).f4 = function (element) {
      this.s2();
      var inductionVariable = 0;
      var last = (this.a4_1.length - 1) | 0;
      if (inductionVariable <= last)
        do {
          var index = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          if (equals(this.a4_1[index], element)) {
            // Inline function 'kotlin.js.asDynamic' call
            this.a4_1.splice(index, 1);
            this.x2_1 = (this.x2_1 + 1) | 0;
            return true;
          }
        } while (inductionVariable <= last);
      return false;
    };
    protoOf(ArrayList).i3 = function (fromIndex, toIndex) {
      this.s2();
      this.x2_1 = (this.x2_1 + 1) | 0;
      // Inline function 'kotlin.js.asDynamic' call
      this.a4_1.splice(fromIndex, (toIndex - fromIndex) | 0);
    };
    protoOf(ArrayList).h3 = function () {
      this.s2();
      var tmp = this;
      // Inline function 'kotlin.emptyArray' call
      tmp.a4_1 = [];
      this.x2_1 = (this.x2_1 + 1) | 0;
    };
    protoOf(ArrayList).j3 = function (element) {
      return indexOf(this.a4_1, element);
    };
    protoOf(ArrayList).toString = function () {
      return arrayToString(this.a4_1);
    };
    protoOf(ArrayList).g4 = function () {
      return [].slice.call(this.a4_1);
    };
    protoOf(ArrayList).toArray = function () {
      return this.g4();
    };
    protoOf(ArrayList).s2 = function () {
      if (this.b4_1) throw UnsupportedOperationException_init_$Create$();
    };
    var _stableSortingIsSupported;
    function sortArrayWith(array, comparator) {
      if (getStableSortingIsSupported()) {
        var comparison = sortArrayWith$lambda(comparator);
        // Inline function 'kotlin.js.asDynamic' call
        array.sort(comparison);
      } else {
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        mergeSort(array, 0, get_lastIndex(array), comparator);
      }
    }
    function getStableSortingIsSupported() {
      var tmp0_safe_receiver = _stableSortingIsSupported;
      if (tmp0_safe_receiver == null) null;
      else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        return tmp0_safe_receiver;
      }
      _stableSortingIsSupported = false;
      // Inline function 'kotlin.js.unsafeCast' call
      var array = [];
      var inductionVariable = 0;
      if (inductionVariable < 600)
        do {
          var index = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          // Inline function 'kotlin.js.asDynamic' call
          array.push(index);
        } while (inductionVariable < 600);
      var comparison = getStableSortingIsSupported$lambda;
      // Inline function 'kotlin.js.asDynamic' call
      array.sort(comparison);
      var inductionVariable_0 = 1;
      var last = array.length;
      if (inductionVariable_0 < last)
        do {
          var index_0 = inductionVariable_0;
          inductionVariable_0 = (inductionVariable_0 + 1) | 0;
          var a = array[(index_0 - 1) | 0];
          var b = array[index_0];
          if ((a & 3) === (b & 3) && a >= b) return false;
        } while (inductionVariable_0 < last);
      _stableSortingIsSupported = true;
      return true;
    }
    function mergeSort(array, start, endInclusive, comparator) {
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.arrayOfNulls' call
      var size = array.length;
      // Inline function 'kotlin.js.asDynamic' call
      var buffer = fillArrayVal(Array(size), null);
      var result = mergeSort_0(array, buffer, start, endInclusive, comparator);
      if (!(result === array)) {
        var inductionVariable = start;
        if (inductionVariable <= endInclusive)
          do {
            var i = inductionVariable;
            inductionVariable = (inductionVariable + 1) | 0;
            array[i] = result[i];
          } while (!(i === endInclusive));
      }
    }
    function mergeSort_0(array, buffer, start, end, comparator) {
      if (start === end) {
        return array;
      }
      var median = (((start + end) | 0) / 2) | 0;
      var left = mergeSort_0(array, buffer, start, median, comparator);
      var right = mergeSort_0(array, buffer, (median + 1) | 0, end, comparator);
      var target = left === buffer ? array : buffer;
      var leftIndex = start;
      var rightIndex = (median + 1) | 0;
      var inductionVariable = start;
      if (inductionVariable <= end)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          if (leftIndex <= median && rightIndex <= end) {
            var leftValue = left[leftIndex];
            var rightValue = right[rightIndex];
            if (comparator.compare(leftValue, rightValue) <= 0) {
              target[i] = leftValue;
              leftIndex = (leftIndex + 1) | 0;
            } else {
              target[i] = rightValue;
              rightIndex = (rightIndex + 1) | 0;
            }
          } else if (leftIndex <= median) {
            target[i] = left[leftIndex];
            leftIndex = (leftIndex + 1) | 0;
          } else {
            target[i] = right[rightIndex];
            rightIndex = (rightIndex + 1) | 0;
          }
        } while (!(i === end));
      return target;
    }
    function sortArrayWith$lambda($comparator) {
      return function (a, b) {
        return $comparator.compare(a, b);
      };
    }
    function getStableSortingIsSupported$lambda(a, b) {
      return ((a & 3) - (b & 3)) | 0;
    }
    function HashMap_init_$Init$(internalMap, $this) {
      AbstractMutableMap.call($this);
      HashMap.call($this);
      $this.l4_1 = internalMap;
      return $this;
    }
    function HashMap_init_$Init$_0($this) {
      HashMap_init_$Init$(InternalHashMap_init_$Create$(), $this);
      return $this;
    }
    function HashMap_init_$Create$() {
      return HashMap_init_$Init$_0(objectCreate(protoOf(HashMap)));
    }
    function HashMap_init_$Init$_1(initialCapacity, loadFactor, $this) {
      HashMap_init_$Init$(InternalHashMap_init_$Create$_0(initialCapacity, loadFactor), $this);
      return $this;
    }
    function HashMap_init_$Init$_2(initialCapacity, $this) {
      HashMap_init_$Init$_1(initialCapacity, 1.0, $this);
      return $this;
    }
    function HashMap_init_$Create$_0(initialCapacity) {
      return HashMap_init_$Init$_2(initialCapacity, objectCreate(protoOf(HashMap)));
    }
    protoOf(HashMap).h3 = function () {
      this.l4_1.h3();
    };
    protoOf(HashMap).l1 = function (key) {
      return this.l4_1.n4(key);
    };
    protoOf(HashMap).m1 = function (value) {
      return this.l4_1.m1(value);
    };
    protoOf(HashMap).r3 = function () {
      return new HashMapValues(this.l4_1);
    };
    protoOf(HashMap).o1 = function () {
      var tmp0_elvis_lhs = this.m4_1;
      var tmp;
      if (tmp0_elvis_lhs == null) {
        // Inline function 'kotlin.also' call
        var this_0 = new HashMapEntrySet(this.l4_1);
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlin.collections.HashMap.<get-entries>.<anonymous>' call
        this.m4_1 = this_0;
        tmp = this_0;
      } else {
        tmp = tmp0_elvis_lhs;
      }
      return tmp;
    };
    protoOf(HashMap).n1 = function (key) {
      return this.l4_1.n1(key);
    };
    protoOf(HashMap).t3 = function (key, value) {
      return this.l4_1.t3(key, value);
    };
    protoOf(HashMap).o4 = function (key) {
      return this.l4_1.o4(key);
    };
    protoOf(HashMap).p = function () {
      return this.l4_1.p();
    };
    protoOf(HashMap).p4 = function (from) {
      return this.l4_1.p4(from);
    };
    function HashMap() {
      this.m4_1 = null;
    }
    function HashMapValues(backing) {
      AbstractMutableCollection.call(this);
      this.q4_1 = backing;
    }
    protoOf(HashMapValues).p = function () {
      return this.q4_1.p();
    };
    protoOf(HashMapValues).i = function () {
      return this.q4_1.p() === 0;
    };
    protoOf(HashMapValues).r4 = function (element) {
      return this.q4_1.m1(element);
    };
    protoOf(HashMapValues).h1 = function (element) {
      if (!(element == null ? true : !(element == null))) return false;
      return this.r4((element == null ? true : !(element == null)) ? element : THROW_CCE());
    };
    protoOf(HashMapValues).s4 = function (element) {
      throw UnsupportedOperationException_init_$Create$();
    };
    protoOf(HashMapValues).r2 = function (element) {
      return this.s4((element == null ? true : !(element == null)) ? element : THROW_CCE());
    };
    protoOf(HashMapValues).l = function () {
      return this.q4_1.t4();
    };
    function HashMapEntrySet(backing) {
      HashMapEntrySetBase.call(this, backing);
    }
    protoOf(HashMapEntrySet).l = function () {
      return this.v4_1.w4();
    };
    function HashMapEntrySetBase(backing) {
      AbstractMutableSet.call(this);
      this.v4_1 = backing;
    }
    protoOf(HashMapEntrySetBase).p = function () {
      return this.v4_1.p();
    };
    protoOf(HashMapEntrySetBase).i = function () {
      return this.v4_1.p() === 0;
    };
    protoOf(HashMapEntrySetBase).x4 = function (element) {
      return this.v4_1.z4(element);
    };
    protoOf(HashMapEntrySetBase).h1 = function (element) {
      if (!(!(element == null) ? isInterface(element, Entry) : false)) return false;
      return this.x4((!(element == null) ? isInterface(element, Entry) : false) ? element : THROW_CCE());
    };
    protoOf(HashMapEntrySetBase).y4 = function (element) {
      throw UnsupportedOperationException_init_$Create$();
    };
    protoOf(HashMapEntrySetBase).r2 = function (element) {
      return this.y4((!(element == null) ? isInterface(element, Entry) : false) ? element : THROW_CCE());
    };
    protoOf(HashMapEntrySetBase).i1 = function (elements) {
      return this.v4_1.a5(elements);
    };
    function HashMapValuesDefault$iterator$1($entryIterator) {
      this.b5_1 = $entryIterator;
    }
    protoOf(HashMapValuesDefault$iterator$1).m = function () {
      return this.b5_1.m();
    };
    protoOf(HashMapValuesDefault$iterator$1).n = function () {
      return this.b5_1.n().k1();
    };
    function HashMapValuesDefault(backingMap) {
      AbstractMutableCollection.call(this);
      this.c5_1 = backingMap;
    }
    protoOf(HashMapValuesDefault).s4 = function (element) {
      throw UnsupportedOperationException_init_$Create$_0("Add is not supported on values");
    };
    protoOf(HashMapValuesDefault).r2 = function (element) {
      return this.s4((element == null ? true : !(element == null)) ? element : THROW_CCE());
    };
    protoOf(HashMapValuesDefault).r4 = function (element) {
      return this.c5_1.m1(element);
    };
    protoOf(HashMapValuesDefault).h1 = function (element) {
      if (!(element == null ? true : !(element == null))) return false;
      return this.r4((element == null ? true : !(element == null)) ? element : THROW_CCE());
    };
    protoOf(HashMapValuesDefault).l = function () {
      var entryIterator = this.c5_1.o1().l();
      return new HashMapValuesDefault$iterator$1(entryIterator);
    };
    protoOf(HashMapValuesDefault).p = function () {
      return this.c5_1.p();
    };
    function HashSet_init_$Init$(map, $this) {
      AbstractMutableSet.call($this);
      HashSet.call($this);
      $this.d5_1 = map;
      return $this;
    }
    function HashSet_init_$Init$_0($this) {
      HashSet_init_$Init$(InternalHashMap_init_$Create$(), $this);
      return $this;
    }
    function HashSet_init_$Create$() {
      return HashSet_init_$Init$_0(objectCreate(protoOf(HashSet)));
    }
    protoOf(HashSet).r2 = function (element) {
      return this.d5_1.t3(element, true) == null;
    };
    protoOf(HashSet).h1 = function (element) {
      return this.d5_1.n4(element);
    };
    protoOf(HashSet).i = function () {
      return this.d5_1.p() === 0;
    };
    protoOf(HashSet).l = function () {
      return this.d5_1.e5();
    };
    protoOf(HashSet).p = function () {
      return this.d5_1.p();
    };
    function HashSet() {}
    function computeHashSize($this, capacity) {
      return takeHighestOneBit(imul(coerceAtLeast(capacity, 1), 3));
    }
    function computeShift($this, hashSize) {
      // Inline function 'kotlin.countLeadingZeroBits' call
      return (clz32(hashSize) + 1) | 0;
    }
    function InternalHashMap_init_$Init$($this) {
      InternalHashMap_init_$Init$_0(8, $this);
      return $this;
    }
    function InternalHashMap_init_$Create$() {
      return InternalHashMap_init_$Init$(objectCreate(protoOf(InternalHashMap)));
    }
    function InternalHashMap_init_$Init$_0(initialCapacity, $this) {
      InternalHashMap.call(
        $this,
        arrayOfUninitializedElements(initialCapacity),
        null,
        new Int32Array(initialCapacity),
        new Int32Array(computeHashSize(Companion_instance_3, initialCapacity)),
        2,
        0,
      );
      return $this;
    }
    function InternalHashMap_init_$Init$_1(initialCapacity, loadFactor, $this) {
      InternalHashMap_init_$Init$_0(initialCapacity, $this);
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(loadFactor > 0)) {
        // Inline function 'kotlin.collections.InternalHashMap.<init>.<anonymous>' call
        var message = "Non-positive load factor: " + loadFactor;
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      return $this;
    }
    function InternalHashMap_init_$Create$_0(initialCapacity, loadFactor) {
      return InternalHashMap_init_$Init$_1(initialCapacity, loadFactor, objectCreate(protoOf(InternalHashMap)));
    }
    function _get_capacity__a9k9f3($this) {
      return $this.f5_1.length;
    }
    function _get_hashSize__tftcho($this) {
      return $this.i5_1.length;
    }
    function registerModification($this) {
      $this.m5_1 = ($this.m5_1 + 1) | 0;
    }
    function ensureExtraCapacity($this, n) {
      if (shouldCompact($this, n)) {
        compact($this, true);
      } else {
        ensureCapacity($this, ($this.k5_1 + n) | 0);
      }
    }
    function shouldCompact($this, extraCapacity) {
      var spareCapacity = (_get_capacity__a9k9f3($this) - $this.k5_1) | 0;
      var gaps = ($this.k5_1 - $this.p()) | 0;
      return spareCapacity < extraCapacity && ((gaps + spareCapacity) | 0) >= extraCapacity && gaps >= ((_get_capacity__a9k9f3($this) / 4) | 0);
    }
    function ensureCapacity($this, minCapacity) {
      if (minCapacity < 0) throw RuntimeException_init_$Create$_0("too many elements");
      if (minCapacity > _get_capacity__a9k9f3($this)) {
        var newSize = Companion_instance_5.p5(_get_capacity__a9k9f3($this), minCapacity);
        $this.f5_1 = copyOfUninitializedElements($this.f5_1, newSize);
        var tmp = $this;
        var tmp0_safe_receiver = $this.g5_1;
        tmp.g5_1 = tmp0_safe_receiver == null ? null : copyOfUninitializedElements(tmp0_safe_receiver, newSize);
        $this.h5_1 = copyOf($this.h5_1, newSize);
        var newHashSize = computeHashSize(Companion_instance_3, newSize);
        if (newHashSize > _get_hashSize__tftcho($this)) {
          rehash($this, newHashSize);
        }
      }
    }
    function allocateValuesArray($this) {
      var curValuesArray = $this.g5_1;
      if (!(curValuesArray == null)) return curValuesArray;
      var newValuesArray = arrayOfUninitializedElements(_get_capacity__a9k9f3($this));
      $this.g5_1 = newValuesArray;
      return newValuesArray;
    }
    function hash($this, key) {
      return key == null ? 0 : (imul(hashCode(key), -1640531527) >>> $this.l5_1) | 0;
    }
    function compact($this, updateHashArray) {
      var i = 0;
      var j = 0;
      var valuesArray = $this.g5_1;
      while (i < $this.k5_1) {
        var hash = $this.h5_1[i];
        if (hash >= 0) {
          $this.f5_1[j] = $this.f5_1[i];
          if (!(valuesArray == null)) {
            valuesArray[j] = valuesArray[i];
          }
          if (updateHashArray) {
            $this.h5_1[j] = hash;
            $this.i5_1[hash] = (j + 1) | 0;
          }
          j = (j + 1) | 0;
        }
        i = (i + 1) | 0;
      }
      resetRange($this.f5_1, j, $this.k5_1);
      if (valuesArray == null) null;
      else {
        resetRange(valuesArray, j, $this.k5_1);
      }
      $this.k5_1 = j;
    }
    function rehash($this, newHashSize) {
      registerModification($this);
      if ($this.k5_1 > $this.n5_1) {
        compact($this, false);
      }
      $this.i5_1 = new Int32Array(newHashSize);
      $this.l5_1 = computeShift(Companion_instance_3, newHashSize);
      var i = 0;
      while (i < $this.k5_1) {
        var tmp0 = i;
        i = (tmp0 + 1) | 0;
        if (!putRehash($this, tmp0)) {
          throw IllegalStateException_init_$Create$_0(
            "This cannot happen with fixed magic multiplier and grow-only hash array. Have object hashCodes changed?",
          );
        }
      }
    }
    function putRehash($this, i) {
      var hash_0 = hash($this, $this.f5_1[i]);
      var probesLeft = $this.j5_1;
      while (true) {
        var index = $this.i5_1[hash_0];
        if (index === 0) {
          $this.i5_1[hash_0] = (i + 1) | 0;
          $this.h5_1[i] = hash_0;
          return true;
        }
        probesLeft = (probesLeft - 1) | 0;
        if (probesLeft < 0) return false;
        var tmp0 = hash_0;
        hash_0 = (tmp0 - 1) | 0;
        if (tmp0 === 0) hash_0 = (_get_hashSize__tftcho($this) - 1) | 0;
      }
    }
    function findKey($this, key) {
      var hash_0 = hash($this, key);
      var probesLeft = $this.j5_1;
      while (true) {
        var index = $this.i5_1[hash_0];
        if (index === 0) return -1;
        if (index > 0 && equals($this.f5_1[(index - 1) | 0], key)) return (index - 1) | 0;
        probesLeft = (probesLeft - 1) | 0;
        if (probesLeft < 0) return -1;
        var tmp0 = hash_0;
        hash_0 = (tmp0 - 1) | 0;
        if (tmp0 === 0) hash_0 = (_get_hashSize__tftcho($this) - 1) | 0;
      }
    }
    function findValue($this, value) {
      var i = $this.k5_1;
      $l$loop: while (true) {
        i = (i - 1) | 0;
        if (!(i >= 0)) {
          break $l$loop;
        }
        if ($this.h5_1[i] >= 0 && equals(ensureNotNull($this.g5_1)[i], value)) return i;
      }
      return -1;
    }
    function addKey($this, key) {
      $this.q5();
      retry: while (true) {
        var hash_0 = hash($this, key);
        var tentativeMaxProbeDistance = coerceAtMost(imul($this.j5_1, 2), (_get_hashSize__tftcho($this) / 2) | 0);
        var probeDistance = 0;
        while (true) {
          var index = $this.i5_1[hash_0];
          if (index <= 0) {
            if ($this.k5_1 >= _get_capacity__a9k9f3($this)) {
              ensureExtraCapacity($this, 1);
              continue retry;
            }
            var tmp1 = $this.k5_1;
            $this.k5_1 = (tmp1 + 1) | 0;
            var putIndex = tmp1;
            $this.f5_1[putIndex] = key;
            $this.h5_1[putIndex] = hash_0;
            $this.i5_1[hash_0] = (putIndex + 1) | 0;
            $this.n5_1 = ($this.n5_1 + 1) | 0;
            registerModification($this);
            if (probeDistance > $this.j5_1) $this.j5_1 = probeDistance;
            return putIndex;
          }
          if (equals($this.f5_1[(index - 1) | 0], key)) {
            return -index | 0;
          }
          probeDistance = (probeDistance + 1) | 0;
          if (probeDistance > tentativeMaxProbeDistance) {
            rehash($this, imul(_get_hashSize__tftcho($this), 2));
            continue retry;
          }
          var tmp4 = hash_0;
          hash_0 = (tmp4 - 1) | 0;
          if (tmp4 === 0) hash_0 = (_get_hashSize__tftcho($this) - 1) | 0;
        }
      }
    }
    function removeEntryAt($this, index) {
      resetAt($this.f5_1, index);
      var tmp0_safe_receiver = $this.g5_1;
      if (tmp0_safe_receiver == null) null;
      else {
        resetAt(tmp0_safe_receiver, index);
      }
      removeHashAt($this, $this.h5_1[index]);
      $this.h5_1[index] = -1;
      $this.n5_1 = ($this.n5_1 - 1) | 0;
      registerModification($this);
    }
    function removeHashAt($this, removedHash) {
      var hash_0 = removedHash;
      var hole = removedHash;
      var probeDistance = 0;
      var patchAttemptsLeft = coerceAtMost(imul($this.j5_1, 2), (_get_hashSize__tftcho($this) / 2) | 0);
      while (true) {
        var tmp0 = hash_0;
        hash_0 = (tmp0 - 1) | 0;
        if (tmp0 === 0) hash_0 = (_get_hashSize__tftcho($this) - 1) | 0;
        probeDistance = (probeDistance + 1) | 0;
        if (probeDistance > $this.j5_1) {
          $this.i5_1[hole] = 0;
          return Unit_instance;
        }
        var index = $this.i5_1[hash_0];
        if (index === 0) {
          $this.i5_1[hole] = 0;
          return Unit_instance;
        }
        if (index < 0) {
          $this.i5_1[hole] = -1;
          hole = hash_0;
          probeDistance = 0;
        } else {
          var otherHash = hash($this, $this.f5_1[(index - 1) | 0]);
          if ((((otherHash - hash_0) | 0) & ((_get_hashSize__tftcho($this) - 1) | 0)) >= probeDistance) {
            $this.i5_1[hole] = index;
            $this.h5_1[(index - 1) | 0] = hole;
            hole = hash_0;
            probeDistance = 0;
          }
        }
        patchAttemptsLeft = (patchAttemptsLeft - 1) | 0;
        if (patchAttemptsLeft < 0) {
          $this.i5_1[hole] = -1;
          return Unit_instance;
        }
      }
    }
    function contentEquals_0($this, other) {
      return $this.n5_1 === other.p() && $this.a5(other.o1());
    }
    function putEntry($this, entry) {
      var index = addKey($this, entry.j1());
      var valuesArray = allocateValuesArray($this);
      if (index >= 0) {
        valuesArray[index] = entry.k1();
        return true;
      }
      var oldValue = valuesArray[((-index | 0) - 1) | 0];
      if (!equals(entry.k1(), oldValue)) {
        valuesArray[((-index | 0) - 1) | 0] = entry.k1();
        return true;
      }
      return false;
    }
    function putAllEntries($this, from) {
      if (from.i()) return false;
      ensureExtraCapacity($this, from.p());
      var it = from.l();
      var updated = false;
      while (it.m()) {
        if (putEntry($this, it.n())) updated = true;
      }
      return updated;
    }
    function Companion_3() {
      this.r5_1 = -1640531527;
      this.s5_1 = 8;
      this.t5_1 = 2;
      this.u5_1 = -1;
    }
    var Companion_instance_3;
    function Companion_getInstance_3() {
      return Companion_instance_3;
    }
    function Itr(map) {
      this.v5_1 = map;
      this.w5_1 = 0;
      this.x5_1 = -1;
      this.y5_1 = this.v5_1.m5_1;
      this.z5();
    }
    protoOf(Itr).z5 = function () {
      while (this.w5_1 < this.v5_1.k5_1 && this.v5_1.h5_1[this.w5_1] < 0) {
        this.w5_1 = (this.w5_1 + 1) | 0;
      }
    };
    protoOf(Itr).m = function () {
      return this.w5_1 < this.v5_1.k5_1;
    };
    protoOf(Itr).a6 = function () {
      if (!(this.v5_1.m5_1 === this.y5_1)) throw ConcurrentModificationException_init_$Create$();
    };
    function KeysItr(map) {
      Itr.call(this, map);
    }
    protoOf(KeysItr).n = function () {
      this.a6();
      if (this.w5_1 >= this.v5_1.k5_1) throw NoSuchElementException_init_$Create$();
      var tmp = this;
      var tmp1 = this.w5_1;
      this.w5_1 = (tmp1 + 1) | 0;
      tmp.x5_1 = tmp1;
      var result = this.v5_1.f5_1[this.x5_1];
      this.z5();
      return result;
    };
    function ValuesItr(map) {
      Itr.call(this, map);
    }
    protoOf(ValuesItr).n = function () {
      this.a6();
      if (this.w5_1 >= this.v5_1.k5_1) throw NoSuchElementException_init_$Create$();
      var tmp = this;
      var tmp1 = this.w5_1;
      this.w5_1 = (tmp1 + 1) | 0;
      tmp.x5_1 = tmp1;
      var result = ensureNotNull(this.v5_1.g5_1)[this.x5_1];
      this.z5();
      return result;
    };
    function EntriesItr(map) {
      Itr.call(this, map);
    }
    protoOf(EntriesItr).n = function () {
      this.a6();
      if (this.w5_1 >= this.v5_1.k5_1) throw NoSuchElementException_init_$Create$();
      var tmp = this;
      var tmp1 = this.w5_1;
      this.w5_1 = (tmp1 + 1) | 0;
      tmp.x5_1 = tmp1;
      var result = new EntryRef(this.v5_1, this.x5_1);
      this.z5();
      return result;
    };
    protoOf(EntriesItr).n6 = function () {
      if (this.w5_1 >= this.v5_1.k5_1) throw NoSuchElementException_init_$Create$();
      var tmp = this;
      var tmp1 = this.w5_1;
      this.w5_1 = (tmp1 + 1) | 0;
      tmp.x5_1 = tmp1;
      // Inline function 'kotlin.hashCode' call
      var tmp0_safe_receiver = this.v5_1.f5_1[this.x5_1];
      var tmp1_elvis_lhs = tmp0_safe_receiver == null ? null : hashCode(tmp0_safe_receiver);
      var tmp_0 = tmp1_elvis_lhs == null ? 0 : tmp1_elvis_lhs;
      // Inline function 'kotlin.hashCode' call
      var tmp0_safe_receiver_0 = ensureNotNull(this.v5_1.g5_1)[this.x5_1];
      var tmp1_elvis_lhs_0 = tmp0_safe_receiver_0 == null ? null : hashCode(tmp0_safe_receiver_0);
      var result = tmp_0 ^ (tmp1_elvis_lhs_0 == null ? 0 : tmp1_elvis_lhs_0);
      this.z5();
      return result;
    };
    protoOf(EntriesItr).o6 = function (sb) {
      if (this.w5_1 >= this.v5_1.k5_1) throw NoSuchElementException_init_$Create$();
      var tmp = this;
      var tmp1 = this.w5_1;
      this.w5_1 = (tmp1 + 1) | 0;
      tmp.x5_1 = tmp1;
      var key = this.v5_1.f5_1[this.x5_1];
      if (equals(key, this.v5_1)) {
        sb.r6("(this Map)");
      } else {
        sb.q6(key);
      }
      sb.s6(_Char___init__impl__6a9atx(61));
      var value = ensureNotNull(this.v5_1.g5_1)[this.x5_1];
      if (equals(value, this.v5_1)) {
        sb.r6("(this Map)");
      } else {
        sb.q6(value);
      }
      this.z5();
    };
    function EntryRef(map, index) {
      this.t6_1 = map;
      this.u6_1 = index;
    }
    protoOf(EntryRef).j1 = function () {
      return this.t6_1.f5_1[this.u6_1];
    };
    protoOf(EntryRef).k1 = function () {
      return ensureNotNull(this.t6_1.g5_1)[this.u6_1];
    };
    protoOf(EntryRef).equals = function (other) {
      var tmp;
      var tmp_0;
      if (!(other == null) ? isInterface(other, Entry) : false) {
        tmp_0 = equals(other.j1(), this.j1());
      } else {
        tmp_0 = false;
      }
      if (tmp_0) {
        tmp = equals(other.k1(), this.k1());
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(EntryRef).hashCode = function () {
      // Inline function 'kotlin.hashCode' call
      var tmp0_safe_receiver = this.j1();
      var tmp1_elvis_lhs = tmp0_safe_receiver == null ? null : hashCode(tmp0_safe_receiver);
      var tmp = tmp1_elvis_lhs == null ? 0 : tmp1_elvis_lhs;
      // Inline function 'kotlin.hashCode' call
      var tmp0_safe_receiver_0 = this.k1();
      var tmp1_elvis_lhs_0 = tmp0_safe_receiver_0 == null ? null : hashCode(tmp0_safe_receiver_0);
      return tmp ^ (tmp1_elvis_lhs_0 == null ? 0 : tmp1_elvis_lhs_0);
    };
    protoOf(EntryRef).toString = function () {
      return toString_0(this.j1()) + "=" + toString_0(this.k1());
    };
    function InternalHashMap(keysArray, valuesArray, presenceArray, hashArray, maxProbeDistance, length) {
      this.f5_1 = keysArray;
      this.g5_1 = valuesArray;
      this.h5_1 = presenceArray;
      this.i5_1 = hashArray;
      this.j5_1 = maxProbeDistance;
      this.k5_1 = length;
      this.l5_1 = computeShift(Companion_instance_3, _get_hashSize__tftcho(this));
      this.m5_1 = 0;
      this.n5_1 = 0;
      this.o5_1 = false;
    }
    protoOf(InternalHashMap).p = function () {
      return this.n5_1;
    };
    protoOf(InternalHashMap).m1 = function (value) {
      return findValue(this, value) >= 0;
    };
    protoOf(InternalHashMap).n1 = function (key) {
      var index = findKey(this, key);
      if (index < 0) return null;
      return ensureNotNull(this.g5_1)[index];
    };
    protoOf(InternalHashMap).n4 = function (key) {
      return findKey(this, key) >= 0;
    };
    protoOf(InternalHashMap).t3 = function (key, value) {
      var index = addKey(this, key);
      var valuesArray = allocateValuesArray(this);
      if (index < 0) {
        var oldValue = valuesArray[((-index | 0) - 1) | 0];
        valuesArray[((-index | 0) - 1) | 0] = value;
        return oldValue;
      } else {
        valuesArray[index] = value;
        return null;
      }
    };
    protoOf(InternalHashMap).p4 = function (from) {
      this.q5();
      putAllEntries(this, from.o1());
    };
    protoOf(InternalHashMap).o4 = function (key) {
      this.q5();
      var index = findKey(this, key);
      if (index < 0) return null;
      var oldValue = ensureNotNull(this.g5_1)[index];
      removeEntryAt(this, index);
      return oldValue;
    };
    protoOf(InternalHashMap).h3 = function () {
      this.q5();
      var inductionVariable = 0;
      var last = (this.k5_1 - 1) | 0;
      if (inductionVariable <= last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var hash = this.h5_1[i];
          if (hash >= 0) {
            this.i5_1[hash] = 0;
            this.h5_1[i] = -1;
          }
        } while (!(i === last));
      resetRange(this.f5_1, 0, this.k5_1);
      var tmp1_safe_receiver = this.g5_1;
      if (tmp1_safe_receiver == null) null;
      else {
        resetRange(tmp1_safe_receiver, 0, this.k5_1);
      }
      this.n5_1 = 0;
      this.k5_1 = 0;
      registerModification(this);
    };
    protoOf(InternalHashMap).equals = function (other) {
      var tmp;
      if (other === this) {
        tmp = true;
      } else {
        var tmp_0;
        if (!(other == null) ? isInterface(other, KtMap) : false) {
          tmp_0 = contentEquals_0(this, other);
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      }
      return tmp;
    };
    protoOf(InternalHashMap).hashCode = function () {
      var result = 0;
      var it = this.w4();
      while (it.m()) {
        result = (result + it.n6()) | 0;
      }
      return result;
    };
    protoOf(InternalHashMap).toString = function () {
      var sb = StringBuilder_init_$Create$((2 + imul(this.n5_1, 3)) | 0);
      sb.r6("{");
      var i = 0;
      var it = this.w4();
      while (it.m()) {
        if (i > 0) {
          sb.r6(", ");
        }
        it.o6(sb);
        i = (i + 1) | 0;
      }
      sb.r6("}");
      return sb.toString();
    };
    protoOf(InternalHashMap).q5 = function () {
      if (this.o5_1) throw UnsupportedOperationException_init_$Create$();
    };
    protoOf(InternalHashMap).z4 = function (entry) {
      var index = findKey(this, entry.j1());
      if (index < 0) return false;
      return equals(ensureNotNull(this.g5_1)[index], entry.k1());
    };
    protoOf(InternalHashMap).v6 = function (entry) {
      return this.z4(isInterface(entry, Entry) ? entry : THROW_CCE());
    };
    protoOf(InternalHashMap).e5 = function () {
      return new KeysItr(this);
    };
    protoOf(InternalHashMap).t4 = function () {
      return new ValuesItr(this);
    };
    protoOf(InternalHashMap).w4 = function () {
      return new EntriesItr(this);
    };
    function InternalMap() {}
    function get_output() {
      _init_properties_console_kt__rfg7jv();
      return output;
    }
    var output;
    function BaseOutput() {}
    protoOf(BaseOutput).w6 = function () {
      this.x6("\n");
    };
    protoOf(BaseOutput).y6 = function (message) {
      this.x6(message);
      this.w6();
    };
    function NodeJsOutput(outputStream) {
      BaseOutput.call(this);
      this.z6_1 = outputStream;
    }
    protoOf(NodeJsOutput).x6 = function (message) {
      // Inline function 'kotlin.io.String' call
      var messageString = String(message);
      this.z6_1.write(messageString);
    };
    function BufferedOutputToConsoleLog() {
      BufferedOutput.call(this);
    }
    protoOf(BufferedOutputToConsoleLog).x6 = function (message) {
      // Inline function 'kotlin.io.String' call
      var s = String(message);
      // Inline function 'kotlin.text.nativeLastIndexOf' call
      // Inline function 'kotlin.js.asDynamic' call
      var i = s.lastIndexOf("\n", 0);
      if (i >= 0) {
        var tmp = this;
        var tmp_0 = this.b7_1;
        // Inline function 'kotlin.text.substring' call
        // Inline function 'kotlin.js.asDynamic' call
        tmp.b7_1 = tmp_0 + s.substring(0, i);
        this.c7();
        // Inline function 'kotlin.text.substring' call
        var this_0 = s;
        var startIndex = (i + 1) | 0;
        // Inline function 'kotlin.js.asDynamic' call
        s = this_0.substring(startIndex);
      }
      this.b7_1 = this.b7_1 + s;
    };
    protoOf(BufferedOutputToConsoleLog).c7 = function () {
      console.log(this.b7_1);
      this.b7_1 = "";
    };
    function BufferedOutput() {
      BaseOutput.call(this);
      this.b7_1 = "";
    }
    protoOf(BufferedOutput).x6 = function (message) {
      var tmp = this;
      var tmp_0 = this.b7_1;
      // Inline function 'kotlin.io.String' call
      tmp.b7_1 = tmp_0 + String(message);
    };
    function println(message) {
      _init_properties_console_kt__rfg7jv();
      get_output().y6(message);
    }
    var properties_initialized_console_kt_gll9dl;
    function _init_properties_console_kt__rfg7jv() {
      if (!properties_initialized_console_kt_gll9dl) {
        properties_initialized_console_kt_gll9dl = true;
        // Inline function 'kotlin.run' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlin.io.output.<anonymous>' call
        var isNode = typeof process !== "undefined" && process.versions && !!process.versions.node;
        output = isNode ? new NodeJsOutput(process.stdout) : new BufferedOutputToConsoleLog();
      }
    }
    function Exception_init_$Init$($this) {
      extendThrowable($this);
      Exception.call($this);
      return $this;
    }
    function Exception_init_$Create$() {
      var tmp = Exception_init_$Init$(objectCreate(protoOf(Exception)));
      captureStack(tmp, Exception_init_$Create$);
      return tmp;
    }
    function Exception_init_$Init$_0(message, $this) {
      extendThrowable($this, message);
      Exception.call($this);
      return $this;
    }
    function Exception_init_$Create$_0(message) {
      var tmp = Exception_init_$Init$_0(message, objectCreate(protoOf(Exception)));
      captureStack(tmp, Exception_init_$Create$_0);
      return tmp;
    }
    function Exception_init_$Init$_1(message, cause, $this) {
      extendThrowable($this, message, cause);
      Exception.call($this);
      return $this;
    }
    function Exception() {
      captureStack(this, Exception);
    }
    function IllegalArgumentException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      IllegalArgumentException.call($this);
      return $this;
    }
    function IllegalArgumentException_init_$Create$() {
      var tmp = IllegalArgumentException_init_$Init$(objectCreate(protoOf(IllegalArgumentException)));
      captureStack(tmp, IllegalArgumentException_init_$Create$);
      return tmp;
    }
    function IllegalArgumentException_init_$Init$_0(message, $this) {
      RuntimeException_init_$Init$_0(message, $this);
      IllegalArgumentException.call($this);
      return $this;
    }
    function IllegalArgumentException_init_$Create$_0(message) {
      var tmp = IllegalArgumentException_init_$Init$_0(message, objectCreate(protoOf(IllegalArgumentException)));
      captureStack(tmp, IllegalArgumentException_init_$Create$_0);
      return tmp;
    }
    function IllegalArgumentException() {
      captureStack(this, IllegalArgumentException);
    }
    function IndexOutOfBoundsException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      IndexOutOfBoundsException.call($this);
      return $this;
    }
    function IndexOutOfBoundsException_init_$Create$() {
      var tmp = IndexOutOfBoundsException_init_$Init$(objectCreate(protoOf(IndexOutOfBoundsException)));
      captureStack(tmp, IndexOutOfBoundsException_init_$Create$);
      return tmp;
    }
    function IndexOutOfBoundsException_init_$Init$_0(message, $this) {
      RuntimeException_init_$Init$_0(message, $this);
      IndexOutOfBoundsException.call($this);
      return $this;
    }
    function IndexOutOfBoundsException_init_$Create$_0(message) {
      var tmp = IndexOutOfBoundsException_init_$Init$_0(message, objectCreate(protoOf(IndexOutOfBoundsException)));
      captureStack(tmp, IndexOutOfBoundsException_init_$Create$_0);
      return tmp;
    }
    function IndexOutOfBoundsException() {
      captureStack(this, IndexOutOfBoundsException);
    }
    function IllegalStateException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      IllegalStateException.call($this);
      return $this;
    }
    function IllegalStateException_init_$Create$() {
      var tmp = IllegalStateException_init_$Init$(objectCreate(protoOf(IllegalStateException)));
      captureStack(tmp, IllegalStateException_init_$Create$);
      return tmp;
    }
    function IllegalStateException_init_$Init$_0(message, $this) {
      RuntimeException_init_$Init$_0(message, $this);
      IllegalStateException.call($this);
      return $this;
    }
    function IllegalStateException_init_$Create$_0(message) {
      var tmp = IllegalStateException_init_$Init$_0(message, objectCreate(protoOf(IllegalStateException)));
      captureStack(tmp, IllegalStateException_init_$Create$_0);
      return tmp;
    }
    function IllegalStateException() {
      captureStack(this, IllegalStateException);
    }
    function UnsupportedOperationException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      UnsupportedOperationException.call($this);
      return $this;
    }
    function UnsupportedOperationException_init_$Create$() {
      var tmp = UnsupportedOperationException_init_$Init$(objectCreate(protoOf(UnsupportedOperationException)));
      captureStack(tmp, UnsupportedOperationException_init_$Create$);
      return tmp;
    }
    function UnsupportedOperationException_init_$Init$_0(message, $this) {
      RuntimeException_init_$Init$_0(message, $this);
      UnsupportedOperationException.call($this);
      return $this;
    }
    function UnsupportedOperationException_init_$Create$_0(message) {
      var tmp = UnsupportedOperationException_init_$Init$_0(message, objectCreate(protoOf(UnsupportedOperationException)));
      captureStack(tmp, UnsupportedOperationException_init_$Create$_0);
      return tmp;
    }
    function UnsupportedOperationException_init_$Init$_1(message, cause, $this) {
      RuntimeException_init_$Init$_1(message, cause, $this);
      UnsupportedOperationException.call($this);
      return $this;
    }
    function UnsupportedOperationException_init_$Create$_1(message, cause) {
      var tmp = UnsupportedOperationException_init_$Init$_1(message, cause, objectCreate(protoOf(UnsupportedOperationException)));
      captureStack(tmp, UnsupportedOperationException_init_$Create$_1);
      return tmp;
    }
    function UnsupportedOperationException() {
      captureStack(this, UnsupportedOperationException);
    }
    function RuntimeException_init_$Init$($this) {
      Exception_init_$Init$($this);
      RuntimeException.call($this);
      return $this;
    }
    function RuntimeException_init_$Create$() {
      var tmp = RuntimeException_init_$Init$(objectCreate(protoOf(RuntimeException)));
      captureStack(tmp, RuntimeException_init_$Create$);
      return tmp;
    }
    function RuntimeException_init_$Init$_0(message, $this) {
      Exception_init_$Init$_0(message, $this);
      RuntimeException.call($this);
      return $this;
    }
    function RuntimeException_init_$Create$_0(message) {
      var tmp = RuntimeException_init_$Init$_0(message, objectCreate(protoOf(RuntimeException)));
      captureStack(tmp, RuntimeException_init_$Create$_0);
      return tmp;
    }
    function RuntimeException_init_$Init$_1(message, cause, $this) {
      Exception_init_$Init$_1(message, cause, $this);
      RuntimeException.call($this);
      return $this;
    }
    function RuntimeException() {
      captureStack(this, RuntimeException);
    }
    function NoSuchElementException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      NoSuchElementException.call($this);
      return $this;
    }
    function NoSuchElementException_init_$Create$() {
      var tmp = NoSuchElementException_init_$Init$(objectCreate(protoOf(NoSuchElementException)));
      captureStack(tmp, NoSuchElementException_init_$Create$);
      return tmp;
    }
    function NoSuchElementException_init_$Init$_0(message, $this) {
      RuntimeException_init_$Init$_0(message, $this);
      NoSuchElementException.call($this);
      return $this;
    }
    function NoSuchElementException_init_$Create$_0(message) {
      var tmp = NoSuchElementException_init_$Init$_0(message, objectCreate(protoOf(NoSuchElementException)));
      captureStack(tmp, NoSuchElementException_init_$Create$_0);
      return tmp;
    }
    function NoSuchElementException() {
      captureStack(this, NoSuchElementException);
    }
    function ArithmeticException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      ArithmeticException.call($this);
      return $this;
    }
    function ArithmeticException_init_$Create$() {
      var tmp = ArithmeticException_init_$Init$(objectCreate(protoOf(ArithmeticException)));
      captureStack(tmp, ArithmeticException_init_$Create$);
      return tmp;
    }
    function ArithmeticException_init_$Init$_0(message, $this) {
      RuntimeException_init_$Init$_0(message, $this);
      ArithmeticException.call($this);
      return $this;
    }
    function ArithmeticException_init_$Create$_0(message) {
      var tmp = ArithmeticException_init_$Init$_0(message, objectCreate(protoOf(ArithmeticException)));
      captureStack(tmp, ArithmeticException_init_$Create$_0);
      return tmp;
    }
    function ArithmeticException() {
      captureStack(this, ArithmeticException);
    }
    function ConcurrentModificationException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      ConcurrentModificationException.call($this);
      return $this;
    }
    function ConcurrentModificationException_init_$Create$() {
      var tmp = ConcurrentModificationException_init_$Init$(objectCreate(protoOf(ConcurrentModificationException)));
      captureStack(tmp, ConcurrentModificationException_init_$Create$);
      return tmp;
    }
    function ConcurrentModificationException() {
      captureStack(this, ConcurrentModificationException);
    }
    function NumberFormatException_init_$Init$($this) {
      IllegalArgumentException_init_$Init$($this);
      NumberFormatException.call($this);
      return $this;
    }
    function NumberFormatException_init_$Create$() {
      var tmp = NumberFormatException_init_$Init$(objectCreate(protoOf(NumberFormatException)));
      captureStack(tmp, NumberFormatException_init_$Create$);
      return tmp;
    }
    function NumberFormatException_init_$Init$_0(message, $this) {
      IllegalArgumentException_init_$Init$_0(message, $this);
      NumberFormatException.call($this);
      return $this;
    }
    function NumberFormatException_init_$Create$_0(message) {
      var tmp = NumberFormatException_init_$Init$_0(message, objectCreate(protoOf(NumberFormatException)));
      captureStack(tmp, NumberFormatException_init_$Create$_0);
      return tmp;
    }
    function NumberFormatException() {
      captureStack(this, NumberFormatException);
    }
    function NullPointerException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      NullPointerException.call($this);
      return $this;
    }
    function NullPointerException_init_$Create$() {
      var tmp = NullPointerException_init_$Init$(objectCreate(protoOf(NullPointerException)));
      captureStack(tmp, NullPointerException_init_$Create$);
      return tmp;
    }
    function NullPointerException() {
      captureStack(this, NullPointerException);
    }
    function ClassCastException_init_$Init$($this) {
      RuntimeException_init_$Init$($this);
      ClassCastException.call($this);
      return $this;
    }
    function ClassCastException_init_$Create$() {
      var tmp = ClassCastException_init_$Init$(objectCreate(protoOf(ClassCastException)));
      captureStack(tmp, ClassCastException_init_$Create$);
      return tmp;
    }
    function ClassCastException() {
      captureStack(this, ClassCastException);
    }
    function lazy(initializer) {
      return new UnsafeLazyImpl(initializer);
    }
    function fillFrom(src, dst) {
      var srcLen = src.length;
      var dstLen = dst.length;
      var index = 0;
      // Inline function 'kotlin.js.unsafeCast' call
      var arr = dst;
      while (index < srcLen && index < dstLen) {
        var tmp = index;
        var tmp0 = index;
        index = (tmp0 + 1) | 0;
        arr[tmp] = src[tmp0];
      }
      return dst;
    }
    function arrayCopyResize(source, newSize, defaultValue) {
      // Inline function 'kotlin.js.unsafeCast' call
      var result = source.slice(0, newSize);
      // Inline function 'kotlin.copyArrayType' call
      if (source.$type$ !== undefined) {
        result.$type$ = source.$type$;
      }
      var index = source.length;
      if (newSize > index) {
        // Inline function 'kotlin.js.asDynamic' call
        result.length = newSize;
        while (index < newSize) {
          var tmp0 = index;
          index = (tmp0 + 1) | 0;
          result[tmp0] = defaultValue;
        }
      }
      return result;
    }
    function roundToInt(_this__u8e3s4) {
      var tmp;
      if (isNaN_0(_this__u8e3s4)) {
        throw IllegalArgumentException_init_$Create$_0("Cannot round NaN value.");
      } else if (_this__u8e3s4 > 2147483647) {
        tmp = 2147483647;
      } else if (_this__u8e3s4 < -2147483648) {
        tmp = -2147483648;
      } else {
        tmp = numberToInt(Math.round(_this__u8e3s4));
      }
      return tmp;
    }
    function KProperty0() {}
    function KProperty1() {}
    function StringBuilder_init_$Init$(capacity, $this) {
      StringBuilder_init_$Init$_0($this);
      return $this;
    }
    function StringBuilder_init_$Create$(capacity) {
      return StringBuilder_init_$Init$(capacity, objectCreate(protoOf(StringBuilder)));
    }
    function StringBuilder_init_$Init$_0($this) {
      StringBuilder.call($this, "");
      return $this;
    }
    function StringBuilder_init_$Create$_0() {
      return StringBuilder_init_$Init$_0(objectCreate(protoOf(StringBuilder)));
    }
    function StringBuilder(content) {
      this.p6_1 = !(content === undefined) ? content : "";
    }
    protoOf(StringBuilder).a = function () {
      // Inline function 'kotlin.js.asDynamic' call
      return this.p6_1.length;
    };
    protoOf(StringBuilder).b = function (index) {
      // Inline function 'kotlin.text.getOrElse' call
      var this_0 = this.p6_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= index ? index <= ((charSequenceLength(this_0) - 1) | 0) : false) {
        tmp = charSequenceGet(this_0, index);
      } else {
        throw IndexOutOfBoundsException_init_$Create$_0("index: " + index + ", length: " + this.a() + "}");
      }
      return tmp;
    };
    protoOf(StringBuilder).c = function (startIndex, endIndex) {
      // Inline function 'kotlin.text.substring' call
      // Inline function 'kotlin.js.asDynamic' call
      return this.p6_1.substring(startIndex, endIndex);
    };
    protoOf(StringBuilder).s6 = function (value) {
      this.p6_1 = this.p6_1 + toString(value);
      return this;
    };
    protoOf(StringBuilder).e = function (value) {
      this.p6_1 = this.p6_1 + toString_0(value);
      return this;
    };
    protoOf(StringBuilder).q6 = function (value) {
      this.p6_1 = this.p6_1 + toString_0(value);
      return this;
    };
    protoOf(StringBuilder).r6 = function (value) {
      var tmp = this;
      var tmp_0 = this.p6_1;
      tmp.p6_1 = tmp_0 + (value == null ? "null" : value);
      return this;
    };
    protoOf(StringBuilder).toString = function () {
      return this.p6_1;
    };
    function uppercaseChar(_this__u8e3s4) {
      // Inline function 'kotlin.text.uppercase' call
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.asDynamic' call
      var uppercase = toString(_this__u8e3s4).toUpperCase();
      return uppercase.length > 1 ? _this__u8e3s4 : charSequenceGet(uppercase, 0);
    }
    function isWhitespace(_this__u8e3s4) {
      return isWhitespaceImpl(_this__u8e3s4);
    }
    function toString_2(_this__u8e3s4, radix) {
      // Inline function 'kotlin.js.asDynamic' call
      return _this__u8e3s4.toString(checkRadix(radix));
    }
    function checkRadix(radix) {
      if (!(2 <= radix ? radix <= 36 : false)) {
        throw IllegalArgumentException_init_$Create$_0("radix " + radix + " was not in valid range 2..36");
      }
      return radix;
    }
    function toLong_0(_this__u8e3s4) {
      var tmp0_elvis_lhs = toLongOrNull(_this__u8e3s4);
      var tmp;
      if (tmp0_elvis_lhs == null) {
        numberFormatError(_this__u8e3s4);
      } else {
        tmp = tmp0_elvis_lhs;
      }
      return tmp;
    }
    function toInt(_this__u8e3s4) {
      var tmp0_elvis_lhs = toIntOrNull(_this__u8e3s4);
      var tmp;
      if (tmp0_elvis_lhs == null) {
        numberFormatError(_this__u8e3s4);
      } else {
        tmp = tmp0_elvis_lhs;
      }
      return tmp;
    }
    function digitOf(char, radix) {
      // Inline function 'kotlin.let' call
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.text.digitOf.<anonymous>' call
      var it =
        Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(48)) >= 0 && Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(57)) <= 0
          ? Char__minus_impl_a2frrh(char, _Char___init__impl__6a9atx(48))
          : Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(65)) >= 0 && Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(90)) <= 0
            ? (Char__minus_impl_a2frrh(char, _Char___init__impl__6a9atx(65)) + 10) | 0
            : Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(97)) >= 0 && Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(122)) <= 0
              ? (Char__minus_impl_a2frrh(char, _Char___init__impl__6a9atx(97)) + 10) | 0
              : Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(128)) < 0
                ? -1
                : Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(65313)) >= 0 &&
                    Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(65338)) <= 0
                  ? (Char__minus_impl_a2frrh(char, _Char___init__impl__6a9atx(65313)) + 10) | 0
                  : Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(65345)) >= 0 &&
                      Char__compareTo_impl_ypi4mb(char, _Char___init__impl__6a9atx(65370)) <= 0
                    ? (Char__minus_impl_a2frrh(char, _Char___init__impl__6a9atx(65345)) + 10) | 0
                    : digitToIntImpl(char);
      return it >= radix ? -1 : it;
    }
    function toDouble(_this__u8e3s4) {
      // Inline function 'kotlin.also' call
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.asDynamic' call
      var this_0 = +_this__u8e3s4;
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.text.toDouble.<anonymous>' call
      if ((isNaN_0(this_0) && !isNaN_1(_this__u8e3s4)) || (this_0 === 0.0 && isBlank(_this__u8e3s4))) {
        numberFormatError(_this__u8e3s4);
      }
      return this_0;
    }
    function isNaN_1(_this__u8e3s4) {
      // Inline function 'kotlin.text.lowercase' call
      // Inline function 'kotlin.js.asDynamic' call
      switch (_this__u8e3s4.toLowerCase()) {
        case "nan":
        case "+nan":
        case "-nan":
          return true;
        default:
          return false;
      }
    }
    function toShort_0(_this__u8e3s4) {
      var tmp0_elvis_lhs = toShortOrNull(_this__u8e3s4);
      var tmp;
      if (tmp0_elvis_lhs == null) {
        numberFormatError(_this__u8e3s4);
      } else {
        tmp = tmp0_elvis_lhs;
      }
      return tmp;
    }
    function toBoolean(_this__u8e3s4) {
      var tmp;
      if (!(_this__u8e3s4 == null)) {
        // Inline function 'kotlin.text.lowercase' call
        // Inline function 'kotlin.js.asDynamic' call
        tmp = _this__u8e3s4.toLowerCase() === "true";
      } else {
        tmp = false;
      }
      return tmp;
    }
    function toByte_0(_this__u8e3s4) {
      var tmp0_elvis_lhs = toByteOrNull(_this__u8e3s4);
      var tmp;
      if (tmp0_elvis_lhs == null) {
        numberFormatError(_this__u8e3s4);
      } else {
        tmp = tmp0_elvis_lhs;
      }
      return tmp;
    }
    function Companion_4() {
      Companion_instance_4 = this;
      this.d7_1 = new RegExp("[\\\\^$*+?.()|[\\]{}]", "g");
      this.e7_1 = new RegExp("[\\\\$]", "g");
      this.f7_1 = new RegExp("\\$", "g");
    }
    protoOf(Companion_4).g7 = function (literal) {
      // Inline function 'kotlin.text.nativeReplace' call
      var pattern = this.d7_1;
      // Inline function 'kotlin.js.asDynamic' call
      return literal.replace(pattern, "\\$&");
    };
    var Companion_instance_4;
    function Companion_getInstance_4() {
      if (Companion_instance_4 == null) new Companion_4();
      return Companion_instance_4;
    }
    var STRING_CASE_INSENSITIVE_ORDER;
    function compareTo_0(_this__u8e3s4, other, ignoreCase) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      _init_properties_stringJs_kt__bg7zye();
      if (ignoreCase) {
        var n1 = _this__u8e3s4.length;
        var n2 = other.length;
        // Inline function 'kotlin.comparisons.minOf' call
        var min = Math.min(n1, n2);
        if (min === 0) return (n1 - n2) | 0;
        var inductionVariable = 0;
        if (inductionVariable < min)
          do {
            var index = inductionVariable;
            inductionVariable = (inductionVariable + 1) | 0;
            var thisChar = charSequenceGet(_this__u8e3s4, index);
            var otherChar = charSequenceGet(other, index);
            if (!(thisChar === otherChar)) {
              thisChar = uppercaseChar(thisChar);
              otherChar = uppercaseChar(otherChar);
              if (!(thisChar === otherChar)) {
                // Inline function 'kotlin.text.lowercaseChar' call
                // Inline function 'kotlin.text.lowercase' call
                var this_0 = thisChar;
                // Inline function 'kotlin.js.unsafeCast' call
                // Inline function 'kotlin.js.asDynamic' call
                var tmp$ret$3 = toString(this_0).toLowerCase();
                thisChar = charSequenceGet(tmp$ret$3, 0);
                // Inline function 'kotlin.text.lowercaseChar' call
                // Inline function 'kotlin.text.lowercase' call
                var this_1 = otherChar;
                // Inline function 'kotlin.js.unsafeCast' call
                // Inline function 'kotlin.js.asDynamic' call
                var tmp$ret$7 = toString(this_1).toLowerCase();
                otherChar = charSequenceGet(tmp$ret$7, 0);
                if (!(thisChar === otherChar)) {
                  return Char__compareTo_impl_ypi4mb(thisChar, otherChar);
                }
              }
            }
          } while (inductionVariable < min);
        return (n1 - n2) | 0;
      } else {
        return compareTo(_this__u8e3s4, other);
      }
    }
    function toCharArray(_this__u8e3s4) {
      _init_properties_stringJs_kt__bg7zye();
      var tmp = 0;
      var tmp_0 = _this__u8e3s4.length;
      var tmp_1 = charArray(tmp_0);
      while (tmp < tmp_0) {
        var tmp_2 = tmp;
        tmp_1[tmp_2] = charSequenceGet(_this__u8e3s4, tmp_2);
        tmp = (tmp + 1) | 0;
      }
      return tmp_1;
    }
    function sam$kotlin_Comparator$0(function_0) {
      this.h7_1 = function_0;
    }
    protoOf(sam$kotlin_Comparator$0).i7 = function (a, b) {
      return this.h7_1(a, b);
    };
    protoOf(sam$kotlin_Comparator$0).compare = function (a, b) {
      return this.i7(a, b);
    };
    protoOf(sam$kotlin_Comparator$0).k2 = function () {
      return this.h7_1;
    };
    protoOf(sam$kotlin_Comparator$0).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, Comparator) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$kotlin_Comparator$0).hashCode = function () {
      return hashCode(this.k2());
    };
    function STRING_CASE_INSENSITIVE_ORDER$lambda(a, b) {
      _init_properties_stringJs_kt__bg7zye();
      return compareTo_0(a, b, true);
    }
    var properties_initialized_stringJs_kt_nta8o4;
    function _init_properties_stringJs_kt__bg7zye() {
      if (!properties_initialized_stringJs_kt_nta8o4) {
        properties_initialized_stringJs_kt_nta8o4 = true;
        var tmp = STRING_CASE_INSENSITIVE_ORDER$lambda;
        STRING_CASE_INSENSITIVE_ORDER = new sam$kotlin_Comparator$0(tmp);
      }
    }
    function startsWith(_this__u8e3s4, prefix, ignoreCase) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      if (!ignoreCase) {
        // Inline function 'kotlin.text.nativeStartsWith' call
        // Inline function 'kotlin.js.asDynamic' call
        return _this__u8e3s4.startsWith(prefix, 0);
      } else return regionMatches(_this__u8e3s4, 0, prefix, 0, prefix.length, ignoreCase);
    }
    function regionMatches(_this__u8e3s4, thisOffset, other, otherOffset, length, ignoreCase) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      return regionMatchesImpl(_this__u8e3s4, thisOffset, other, otherOffset, length, ignoreCase);
    }
    function replace(_this__u8e3s4, oldChar, newChar, ignoreCase) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      // Inline function 'kotlin.text.nativeReplace' call
      var pattern = new RegExp(Companion_getInstance_4().g7(toString(oldChar)), ignoreCase ? "gui" : "gu");
      var replacement = toString(newChar);
      // Inline function 'kotlin.js.asDynamic' call
      return _this__u8e3s4.replace(pattern, replacement);
    }
    function stackTraceToString(_this__u8e3s4) {
      return new ExceptionTraceBuilder().n7(_this__u8e3s4);
    }
    function printStackTrace(_this__u8e3s4) {
      console.error(stackTraceToString(_this__u8e3s4));
    }
    function hasSeen($this, exception) {
      var tmp$ret$1;
      $l$block: {
        // Inline function 'kotlin.collections.any' call
        var indexedObject = $this.k7_1;
        var inductionVariable = 0;
        var last = indexedObject.length;
        while (inductionVariable < last) {
          var element = indexedObject[inductionVariable];
          inductionVariable = (inductionVariable + 1) | 0;
          // Inline function 'kotlin.ExceptionTraceBuilder.hasSeen.<anonymous>' call
          if (element === exception) {
            tmp$ret$1 = true;
            break $l$block;
          }
        }
        tmp$ret$1 = false;
      }
      return tmp$ret$1;
    }
    function dumpFullTrace(_this__u8e3s4, $this, indent, qualifier) {
      if (dumpSelfTrace(_this__u8e3s4, $this, indent, qualifier)) true;
      else return Unit_instance;
      var cause = _this__u8e3s4.cause;
      while (!(cause == null)) {
        if (dumpSelfTrace(cause, $this, indent, "Caused by: ")) true;
        else return Unit_instance;
        cause = cause.cause;
      }
    }
    function dumpSelfTrace(_this__u8e3s4, $this, indent, qualifier) {
      $this.j7_1.r6(indent).r6(qualifier);
      var shortInfo = _this__u8e3s4.toString();
      if (hasSeen($this, _this__u8e3s4)) {
        $this.j7_1.r6("[CIRCULAR REFERENCE, SEE ABOVE: ").r6(shortInfo).r6("]\n");
        return false;
      }
      // Inline function 'kotlin.js.asDynamic' call
      $this.k7_1.push(_this__u8e3s4);
      // Inline function 'kotlin.js.asDynamic' call
      var tmp = _this__u8e3s4.stack;
      var stack = (tmp == null ? true : typeof tmp === "string") ? tmp : THROW_CCE();
      if (!(stack == null)) {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlin.ExceptionTraceBuilder.dumpSelfTrace.<anonymous>' call
        var it = indexOf_2(stack, shortInfo);
        var stackStart = it < 0 ? 0 : (it + shortInfo.length) | 0;
        if (stackStart === 0) {
          $this.j7_1.r6(shortInfo).r6("\n");
        }
        // Inline function 'kotlin.text.isEmpty' call
        var this_0 = $this.l7_1;
        if (charSequenceLength(this_0) === 0) {
          $this.l7_1 = stack;
          $this.m7_1 = stackStart;
        } else {
          stack = dropCommonFrames($this, stack, stackStart);
        }
        // Inline function 'kotlin.text.isNotEmpty' call
        if (charSequenceLength(indent) > 0) {
          var tmp_0;
          if (stackStart === 0) {
            tmp_0 = 0;
          } else {
            // Inline function 'kotlin.text.count' call
            var count = 0;
            var inductionVariable = 0;
            while (inductionVariable < charSequenceLength(shortInfo)) {
              var element = charSequenceGet(shortInfo, inductionVariable);
              inductionVariable = (inductionVariable + 1) | 0;
              // Inline function 'kotlin.ExceptionTraceBuilder.dumpSelfTrace.<anonymous>' call
              if (element === _Char___init__impl__6a9atx(10)) {
                count = (count + 1) | 0;
              }
            }
            tmp_0 = (1 + count) | 0;
          }
          var messageLines = tmp_0;
          // Inline function 'kotlin.sequences.forEachIndexed' call
          var index = 0;
          var tmp0_iterator = lineSequence(stack).l();
          while (tmp0_iterator.m()) {
            var item = tmp0_iterator.n();
            // Inline function 'kotlin.ExceptionTraceBuilder.dumpSelfTrace.<anonymous>' call
            var tmp1 = index;
            index = (tmp1 + 1) | 0;
            if (checkIndexOverflow(tmp1) >= messageLines) {
              $this.j7_1.r6(indent);
            }
            $this.j7_1.r6(item).r6("\n");
          }
        } else {
          $this.j7_1.r6(stack).r6("\n");
        }
      } else {
        $this.j7_1.r6(shortInfo).r6("\n");
      }
      var suppressed = get_suppressedExceptions(_this__u8e3s4);
      // Inline function 'kotlin.collections.isNotEmpty' call
      if (!suppressed.i()) {
        var suppressedIndent = indent + "    ";
        var tmp0_iterator_0 = suppressed.l();
        while (tmp0_iterator_0.m()) {
          var s = tmp0_iterator_0.n();
          dumpFullTrace(s, $this, suppressedIndent, "Suppressed: ");
        }
      }
      return true;
    }
    function dropCommonFrames($this, stack, stackStart) {
      var commonFrames = 0;
      var lastBreak = 0;
      var preLastBreak = 0;
      var inductionVariable = 0;
      // Inline function 'kotlin.comparisons.minOf' call
      var a = ($this.l7_1.length - $this.m7_1) | 0;
      var b = (stack.length - stackStart) | 0;
      var last = Math.min(a, b);
      if (inductionVariable < last)
        $l$loop: do {
          var pos = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var c = charSequenceGet(stack, (get_lastIndex_1(stack) - pos) | 0);
          if (!(c === charSequenceGet($this.l7_1, (get_lastIndex_1($this.l7_1) - pos) | 0))) break $l$loop;
          if (c === _Char___init__impl__6a9atx(10)) {
            commonFrames = (commonFrames + 1) | 0;
            preLastBreak = lastBreak;
            lastBreak = pos;
          }
        } while (inductionVariable < last);
      if (commonFrames <= 1) return stack;
      while (preLastBreak > 0 && charSequenceGet(stack, (get_lastIndex_1(stack) - ((preLastBreak - 1) | 0)) | 0) === _Char___init__impl__6a9atx(32))
        preLastBreak = (preLastBreak - 1) | 0;
      return dropLast(stack, preLastBreak) + ("... and " + ((commonFrames - 1) | 0) + " more common stack frames skipped");
    }
    function ExceptionTraceBuilder() {
      this.j7_1 = StringBuilder_init_$Create$_0();
      var tmp = this;
      // Inline function 'kotlin.arrayOf' call
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.asDynamic' call
      tmp.k7_1 = [];
      this.l7_1 = "";
      this.m7_1 = 0;
    }
    protoOf(ExceptionTraceBuilder).n7 = function (exception) {
      dumpFullTrace(exception, this, "", "");
      return this.j7_1.toString();
    };
    function get_suppressedExceptions(_this__u8e3s4) {
      // Inline function 'kotlin.js.asDynamic' call
      var tmp0_safe_receiver = _this__u8e3s4._suppressed;
      var tmp;
      if (tmp0_safe_receiver == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.js.unsafeCast' call
        tmp = tmp0_safe_receiver;
      }
      var tmp1_elvis_lhs = tmp;
      return tmp1_elvis_lhs == null ? emptyList() : tmp1_elvis_lhs;
    }
    function AbstractCollection$toString$lambda(this$0) {
      return function (it) {
        return it === this$0 ? "(this Collection)" : toString_0(it);
      };
    }
    function AbstractCollection() {}
    protoOf(AbstractCollection).h1 = function (element) {
      var tmp$ret$0;
      $l$block_0: {
        // Inline function 'kotlin.collections.any' call
        var tmp;
        if (isInterface(this, Collection)) {
          tmp = this.i();
        } else {
          tmp = false;
        }
        if (tmp) {
          tmp$ret$0 = false;
          break $l$block_0;
        }
        var tmp0_iterator = this.l();
        while (tmp0_iterator.m()) {
          var element_0 = tmp0_iterator.n();
          // Inline function 'kotlin.collections.AbstractCollection.contains.<anonymous>' call
          if (equals(element_0, element)) {
            tmp$ret$0 = true;
            break $l$block_0;
          }
        }
        tmp$ret$0 = false;
      }
      return tmp$ret$0;
    };
    protoOf(AbstractCollection).i1 = function (elements) {
      var tmp$ret$0;
      $l$block_0: {
        // Inline function 'kotlin.collections.all' call
        var tmp;
        if (isInterface(elements, Collection)) {
          tmp = elements.i();
        } else {
          tmp = false;
        }
        if (tmp) {
          tmp$ret$0 = true;
          break $l$block_0;
        }
        var tmp0_iterator = elements.l();
        while (tmp0_iterator.m()) {
          var element = tmp0_iterator.n();
          // Inline function 'kotlin.collections.AbstractCollection.containsAll.<anonymous>' call
          if (!this.h1(element)) {
            tmp$ret$0 = false;
            break $l$block_0;
          }
        }
        tmp$ret$0 = true;
      }
      return tmp$ret$0;
    };
    protoOf(AbstractCollection).i = function () {
      return this.p() === 0;
    };
    protoOf(AbstractCollection).toString = function () {
      return joinToString_5(this, ", ", "[", "]", VOID, VOID, AbstractCollection$toString$lambda(this));
    };
    protoOf(AbstractCollection).toArray = function () {
      return collectionToArray(this);
    };
    function Companion_5() {
      this.n2_1 = 2147483639;
    }
    protoOf(Companion_5).d4 = function (index, size) {
      if (index < 0 || index >= size) {
        throw IndexOutOfBoundsException_init_$Create$_0("index: " + index + ", size: " + size);
      }
    };
    protoOf(Companion_5).d3 = function (index, size) {
      if (index < 0 || index > size) {
        throw IndexOutOfBoundsException_init_$Create$_0("index: " + index + ", size: " + size);
      }
    };
    protoOf(Companion_5).o2 = function (fromIndex, toIndex, size) {
      if (fromIndex < 0 || toIndex > size) {
        throw IndexOutOfBoundsException_init_$Create$_0("fromIndex: " + fromIndex + ", toIndex: " + toIndex + ", size: " + size);
      }
      if (fromIndex > toIndex) {
        throw IllegalArgumentException_init_$Create$_0("fromIndex: " + fromIndex + " > toIndex: " + toIndex);
      }
    };
    protoOf(Companion_5).p5 = function (oldCapacity, minCapacity) {
      var newCapacity = (oldCapacity + (oldCapacity >> 1)) | 0;
      if (((newCapacity - minCapacity) | 0) < 0) newCapacity = minCapacity;
      if (((newCapacity - 2147483639) | 0) > 0) newCapacity = minCapacity > 2147483639 ? 2147483647 : 2147483639;
      return newCapacity;
    };
    protoOf(Companion_5).m3 = function (c) {
      var hashCode_0 = 1;
      var tmp0_iterator = c.l();
      while (tmp0_iterator.m()) {
        var e = tmp0_iterator.n();
        var tmp = imul(31, hashCode_0);
        var tmp2_elvis_lhs = e == null ? null : hashCode(e);
        hashCode_0 = (tmp + (tmp2_elvis_lhs == null ? 0 : tmp2_elvis_lhs)) | 0;
      }
      return hashCode_0;
    };
    protoOf(Companion_5).l3 = function (c, other) {
      if (!(c.p() === other.p())) return false;
      var otherIterator = other.l();
      var tmp0_iterator = c.l();
      while (tmp0_iterator.m()) {
        var elem = tmp0_iterator.n();
        var elemOther = otherIterator.n();
        if (!equals(elem, elemOther)) {
          return false;
        }
      }
      return true;
    };
    var Companion_instance_5;
    function Companion_getInstance_5() {
      return Companion_instance_5;
    }
    function toString_3($this, o) {
      return o === $this ? "(this Map)" : toString_0(o);
    }
    function implFindEntry($this, key) {
      var tmp$ret$1;
      $l$block: {
        // Inline function 'kotlin.collections.firstOrNull' call
        var tmp0_iterator = $this.o1().l();
        while (tmp0_iterator.m()) {
          var element = tmp0_iterator.n();
          // Inline function 'kotlin.collections.AbstractMap.implFindEntry.<anonymous>' call
          if (equals(element.j1(), key)) {
            tmp$ret$1 = element;
            break $l$block;
          }
        }
        tmp$ret$1 = null;
      }
      return tmp$ret$1;
    }
    function Companion_6() {}
    var Companion_instance_6;
    function Companion_getInstance_6() {
      return Companion_instance_6;
    }
    function AbstractMap$toString$lambda(this$0) {
      return function (it) {
        return this$0.o7(it);
      };
    }
    function AbstractMap() {
      this.u3_1 = null;
      this.v3_1 = null;
    }
    protoOf(AbstractMap).l1 = function (key) {
      return !(implFindEntry(this, key) == null);
    };
    protoOf(AbstractMap).m1 = function (value) {
      var tmp$ret$0;
      $l$block_0: {
        // Inline function 'kotlin.collections.any' call
        var this_0 = this.o1();
        var tmp;
        if (isInterface(this_0, Collection)) {
          tmp = this_0.i();
        } else {
          tmp = false;
        }
        if (tmp) {
          tmp$ret$0 = false;
          break $l$block_0;
        }
        var tmp0_iterator = this_0.l();
        while (tmp0_iterator.m()) {
          var element = tmp0_iterator.n();
          // Inline function 'kotlin.collections.AbstractMap.containsValue.<anonymous>' call
          if (equals(element.k1(), value)) {
            tmp$ret$0 = true;
            break $l$block_0;
          }
        }
        tmp$ret$0 = false;
      }
      return tmp$ret$0;
    };
    protoOf(AbstractMap).w3 = function (entry) {
      if (!(!(entry == null) ? isInterface(entry, Entry) : false)) return false;
      var key = entry.j1();
      var value = entry.k1();
      // Inline function 'kotlin.collections.get' call
      var ourValue = (isInterface(this, KtMap) ? this : THROW_CCE()).n1(key);
      if (!equals(value, ourValue)) {
        return false;
      }
      var tmp;
      if (ourValue == null) {
        // Inline function 'kotlin.collections.containsKey' call
        tmp = !(isInterface(this, KtMap) ? this : THROW_CCE()).l1(key);
      } else {
        tmp = false;
      }
      if (tmp) {
        return false;
      }
      return true;
    };
    protoOf(AbstractMap).equals = function (other) {
      if (other === this) return true;
      if (!(!(other == null) ? isInterface(other, KtMap) : false)) return false;
      if (!(this.p() === other.p())) return false;
      var tmp$ret$0;
      $l$block_0: {
        // Inline function 'kotlin.collections.all' call
        var this_0 = other.o1();
        var tmp;
        if (isInterface(this_0, Collection)) {
          tmp = this_0.i();
        } else {
          tmp = false;
        }
        if (tmp) {
          tmp$ret$0 = true;
          break $l$block_0;
        }
        var tmp0_iterator = this_0.l();
        while (tmp0_iterator.m()) {
          var element = tmp0_iterator.n();
          // Inline function 'kotlin.collections.AbstractMap.equals.<anonymous>' call
          if (!this.w3(element)) {
            tmp$ret$0 = false;
            break $l$block_0;
          }
        }
        tmp$ret$0 = true;
      }
      return tmp$ret$0;
    };
    protoOf(AbstractMap).n1 = function (key) {
      var tmp0_safe_receiver = implFindEntry(this, key);
      return tmp0_safe_receiver == null ? null : tmp0_safe_receiver.k1();
    };
    protoOf(AbstractMap).hashCode = function () {
      return hashCode(this.o1());
    };
    protoOf(AbstractMap).i = function () {
      return this.p() === 0;
    };
    protoOf(AbstractMap).p = function () {
      return this.o1().p();
    };
    protoOf(AbstractMap).toString = function () {
      var tmp = this.o1();
      return joinToString_5(tmp, ", ", "{", "}", VOID, VOID, AbstractMap$toString$lambda(this));
    };
    protoOf(AbstractMap).o7 = function (entry) {
      return toString_3(this, entry.j1()) + "=" + toString_3(this, entry.k1());
    };
    function Companion_7() {}
    protoOf(Companion_7).y3 = function (c) {
      var hashCode_0 = 0;
      var tmp0_iterator = c.l();
      while (tmp0_iterator.m()) {
        var element = tmp0_iterator.n();
        var tmp = hashCode_0;
        var tmp2_elvis_lhs = element == null ? null : hashCode(element);
        hashCode_0 = (tmp + (tmp2_elvis_lhs == null ? 0 : tmp2_elvis_lhs)) | 0;
      }
      return hashCode_0;
    };
    protoOf(Companion_7).x3 = function (c, other) {
      if (!(c.p() === other.p())) return false;
      // Inline function 'kotlin.collections.containsAll' call
      return c.i1(other);
    };
    var Companion_instance_7;
    function Companion_getInstance_7() {
      return Companion_instance_7;
    }
    function collectionToArrayCommonImpl(collection) {
      if (collection.i()) {
        // Inline function 'kotlin.emptyArray' call
        return [];
      }
      // Inline function 'kotlin.arrayOfNulls' call
      var size = collection.p();
      var destination = fillArrayVal(Array(size), null);
      var iterator = collection.l();
      var index = 0;
      while (iterator.m()) {
        var tmp0 = index;
        index = (tmp0 + 1) | 0;
        destination[tmp0] = iterator.n();
      }
      return destination;
    }
    function listOf_0(elements) {
      return elements.length > 0 ? asList(elements) : emptyList();
    }
    function emptyList() {
      return EmptyList_getInstance();
    }
    function get_lastIndex_0(_this__u8e3s4) {
      return (_this__u8e3s4.p() - 1) | 0;
    }
    function arrayListOf(elements) {
      return elements.length === 0 ? ArrayList_init_$Create$() : ArrayList_init_$Create$_1(new ArrayAsCollection(elements, true));
    }
    function EmptyList() {
      EmptyList_instance = this;
      this.p7_1 = new Long(-1478467534, -1720727600);
    }
    protoOf(EmptyList).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, KtList) : false) {
        tmp = other.i();
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(EmptyList).hashCode = function () {
      return 1;
    };
    protoOf(EmptyList).toString = function () {
      return "[]";
    };
    protoOf(EmptyList).p = function () {
      return 0;
    };
    protoOf(EmptyList).i = function () {
      return true;
    };
    protoOf(EmptyList).q7 = function (elements) {
      return elements.i();
    };
    protoOf(EmptyList).i1 = function (elements) {
      return this.q7(elements);
    };
    protoOf(EmptyList).o = function (index) {
      throw IndexOutOfBoundsException_init_$Create$_0("Empty list doesn't contain element at index " + index + ".");
    };
    protoOf(EmptyList).l = function () {
      return EmptyIterator_instance;
    };
    var EmptyList_instance;
    function EmptyList_getInstance() {
      if (EmptyList_instance == null) new EmptyList();
      return EmptyList_instance;
    }
    function ArrayAsCollection(values, isVarargs) {
      this.r7_1 = values;
      this.s7_1 = isVarargs;
    }
    protoOf(ArrayAsCollection).p = function () {
      return this.r7_1.length;
    };
    protoOf(ArrayAsCollection).i = function () {
      // Inline function 'kotlin.collections.isEmpty' call
      return this.r7_1.length === 0;
    };
    protoOf(ArrayAsCollection).t7 = function (element) {
      return contains(this.r7_1, element);
    };
    protoOf(ArrayAsCollection).u7 = function (elements) {
      var tmp$ret$0;
      $l$block_0: {
        // Inline function 'kotlin.collections.all' call
        var tmp;
        if (isInterface(elements, Collection)) {
          tmp = elements.i();
        } else {
          tmp = false;
        }
        if (tmp) {
          tmp$ret$0 = true;
          break $l$block_0;
        }
        var tmp0_iterator = elements.l();
        while (tmp0_iterator.m()) {
          var element = tmp0_iterator.n();
          // Inline function 'kotlin.collections.ArrayAsCollection.containsAll.<anonymous>' call
          if (!this.t7(element)) {
            tmp$ret$0 = false;
            break $l$block_0;
          }
        }
        tmp$ret$0 = true;
      }
      return tmp$ret$0;
    };
    protoOf(ArrayAsCollection).i1 = function (elements) {
      return this.u7(elements);
    };
    protoOf(ArrayAsCollection).l = function () {
      return arrayIterator(this.r7_1);
    };
    function EmptyIterator() {}
    protoOf(EmptyIterator).m = function () {
      return false;
    };
    protoOf(EmptyIterator).n = function () {
      throw NoSuchElementException_init_$Create$();
    };
    var EmptyIterator_instance;
    function EmptyIterator_getInstance() {
      return EmptyIterator_instance;
    }
    function throwIndexOverflow() {
      throw ArithmeticException_init_$Create$_0("Index overflow has happened.");
    }
    function collectionSizeOrDefault(_this__u8e3s4, default_0) {
      var tmp;
      if (isInterface(_this__u8e3s4, Collection)) {
        tmp = _this__u8e3s4.p();
      } else {
        tmp = default_0;
      }
      return tmp;
    }
    function hashMapOf(pairs) {
      // Inline function 'kotlin.apply' call
      var this_0 = HashMap_init_$Create$_0(mapCapacity(pairs.length));
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.collections.hashMapOf.<anonymous>' call
      putAll(this_0, pairs);
      return this_0;
    }
    function putAll(_this__u8e3s4, pairs) {
      var inductionVariable = 0;
      var last = pairs.length;
      while (inductionVariable < last) {
        var tmp1_loop_parameter = pairs[inductionVariable];
        inductionVariable = (inductionVariable + 1) | 0;
        var key = tmp1_loop_parameter.x7();
        var value = tmp1_loop_parameter.y7();
        _this__u8e3s4.t3(key, value);
      }
    }
    function removeFirstOrNull(_this__u8e3s4) {
      return _this__u8e3s4.i() ? null : _this__u8e3s4.y2(0);
    }
    function removeFirst(_this__u8e3s4) {
      var tmp;
      if (_this__u8e3s4.i()) {
        throw NoSuchElementException_init_$Create$_0("List is empty.");
      } else {
        tmp = _this__u8e3s4.y2(0);
      }
      return tmp;
    }
    function IntIterator() {}
    protoOf(IntIterator).n = function () {
      return this.z7();
    };
    function asReversed(_this__u8e3s4) {
      return new ReversedList(_this__u8e3s4);
    }
    function ReversedList$listIterator$1(this$0, $index) {
      this.b8_1 = this$0;
      this.a8_1 = this$0.d8_1.k3(reversePositionIndex(this$0, $index));
    }
    protoOf(ReversedList$listIterator$1).m = function () {
      return this.a8_1.e3();
    };
    protoOf(ReversedList$listIterator$1).e3 = function () {
      return this.a8_1.m();
    };
    protoOf(ReversedList$listIterator$1).n = function () {
      return this.a8_1.f3();
    };
    protoOf(ReversedList$listIterator$1).f3 = function () {
      return this.a8_1.n();
    };
    protoOf(ReversedList$listIterator$1).w2 = function () {
      return this.a8_1.w2();
    };
    function ReversedList(delegate) {
      AbstractMutableList.call(this);
      this.d8_1 = delegate;
    }
    protoOf(ReversedList).p = function () {
      return this.d8_1.p();
    };
    protoOf(ReversedList).o = function (index) {
      return this.d8_1.o(reverseElementIndex(this, index));
    };
    protoOf(ReversedList).h3 = function () {
      return this.d8_1.h3();
    };
    protoOf(ReversedList).y2 = function (index) {
      return this.d8_1.y2(reverseElementIndex(this, index));
    };
    protoOf(ReversedList).e8 = function (index, element) {
      return this.d8_1.q2(reverseElementIndex(this, index), element);
    };
    protoOf(ReversedList).q2 = function (index, element) {
      return this.e8(index, (element == null ? true : !(element == null)) ? element : THROW_CCE());
    };
    protoOf(ReversedList).f8 = function (index, element) {
      this.d8_1.g3(reversePositionIndex(this, index), element);
    };
    protoOf(ReversedList).g3 = function (index, element) {
      return this.f8(index, (element == null ? true : !(element == null)) ? element : THROW_CCE());
    };
    protoOf(ReversedList).l = function () {
      return this.k3(0);
    };
    protoOf(ReversedList).k3 = function (index) {
      return new ReversedList$listIterator$1(this, index);
    };
    function reverseElementIndex(_this__u8e3s4, index) {
      var tmp;
      if (0 <= index ? index <= get_lastIndex_0(_this__u8e3s4) : false) {
        tmp = (get_lastIndex_0(_this__u8e3s4) - index) | 0;
      } else {
        throw IndexOutOfBoundsException_init_$Create$_0(
          "Element index " + index + " must be in range [" + numberRangeToNumber(0, get_lastIndex_0(_this__u8e3s4)).toString() + "].",
        );
      }
      return tmp;
    }
    function reversePositionIndex(_this__u8e3s4, index) {
      var tmp;
      if (0 <= index ? index <= _this__u8e3s4.p() : false) {
        tmp = (_this__u8e3s4.p() - index) | 0;
      } else {
        throw IndexOutOfBoundsException_init_$Create$_0(
          "Position index " + index + " must be in range [" + numberRangeToNumber(0, _this__u8e3s4.p()).toString() + "].",
        );
      }
      return tmp;
    }
    function Sequence() {}
    function TransformingSequence$iterator$1(this$0) {
      this.h8_1 = this$0;
      this.g8_1 = this$0.i8_1.l();
    }
    protoOf(TransformingSequence$iterator$1).n = function () {
      return this.h8_1.j8_1(this.g8_1.n());
    };
    protoOf(TransformingSequence$iterator$1).m = function () {
      return this.g8_1.m();
    };
    function TransformingSequence(sequence, transformer) {
      this.i8_1 = sequence;
      this.j8_1 = transformer;
    }
    protoOf(TransformingSequence).l = function () {
      return new TransformingSequence$iterator$1(this);
    };
    function compareValues(a, b) {
      if (a === b) return 0;
      if (a == null) return -1;
      if (b == null) return 1;
      return compareTo((!(a == null) ? isComparable(a) : false) ? a : THROW_CCE(), b);
    }
    function getProgressionLastElement(start, end, step) {
      var tmp;
      if (step > 0) {
        tmp = start >= end ? end : (end - differenceModulo(end, start, step)) | 0;
      } else if (step < 0) {
        tmp = start <= end ? end : (end + differenceModulo(start, end, -step | 0)) | 0;
      } else {
        throw IllegalArgumentException_init_$Create$_0("Step is zero.");
      }
      return tmp;
    }
    function differenceModulo(a, b, c) {
      return mod((mod(a, c) - mod(b, c)) | 0, c);
    }
    function mod(a, b) {
      var mod = (a % b) | 0;
      return mod >= 0 ? mod : (mod + b) | 0;
    }
    function Companion_8() {
      Companion_instance_8 = this;
      this.q_1 = new IntRange(1, 0);
    }
    var Companion_instance_8;
    function Companion_getInstance_8() {
      if (Companion_instance_8 == null) new Companion_8();
      return Companion_instance_8;
    }
    function IntRange(start, endInclusive) {
      Companion_getInstance_8();
      IntProgression.call(this, start, endInclusive, 1);
    }
    protoOf(IntRange).j = function () {
      return this.k8_1;
    };
    protoOf(IntRange).k = function () {
      return this.l8_1;
    };
    protoOf(IntRange).i = function () {
      return this.k8_1 > this.l8_1;
    };
    protoOf(IntRange).equals = function (other) {
      var tmp;
      if (other instanceof IntRange) {
        tmp = (this.i() && other.i()) || (this.k8_1 === other.k8_1 && this.l8_1 === other.l8_1);
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(IntRange).hashCode = function () {
      return this.i() ? -1 : (imul(31, this.k8_1) + this.l8_1) | 0;
    };
    protoOf(IntRange).toString = function () {
      return "" + this.k8_1 + ".." + this.l8_1;
    };
    function IntProgressionIterator(first, last, step) {
      IntIterator.call(this);
      this.n8_1 = step;
      this.o8_1 = last;
      this.p8_1 = this.n8_1 > 0 ? first <= last : first >= last;
      this.q8_1 = this.p8_1 ? first : this.o8_1;
    }
    protoOf(IntProgressionIterator).m = function () {
      return this.p8_1;
    };
    protoOf(IntProgressionIterator).z7 = function () {
      var value = this.q8_1;
      if (value === this.o8_1) {
        if (!this.p8_1) throw NoSuchElementException_init_$Create$();
        this.p8_1 = false;
      } else {
        this.q8_1 = (this.q8_1 + this.n8_1) | 0;
      }
      return value;
    };
    function Companion_9() {}
    protoOf(Companion_9).r = function (rangeStart, rangeEnd, step) {
      return new IntProgression(rangeStart, rangeEnd, step);
    };
    var Companion_instance_9;
    function Companion_getInstance_9() {
      return Companion_instance_9;
    }
    function IntProgression(start, endInclusive, step) {
      if (step === 0) throw IllegalArgumentException_init_$Create$_0("Step must be non-zero.");
      if (step === -2147483648) throw IllegalArgumentException_init_$Create$_0("Step must be greater than Int.MIN_VALUE to avoid overflow on negation.");
      this.k8_1 = start;
      this.l8_1 = getProgressionLastElement(start, endInclusive, step);
      this.m8_1 = step;
    }
    protoOf(IntProgression).l = function () {
      return new IntProgressionIterator(this.k8_1, this.l8_1, this.m8_1);
    };
    protoOf(IntProgression).i = function () {
      return this.m8_1 > 0 ? this.k8_1 > this.l8_1 : this.k8_1 < this.l8_1;
    };
    protoOf(IntProgression).equals = function (other) {
      var tmp;
      if (other instanceof IntProgression) {
        tmp = (this.i() && other.i()) || (this.k8_1 === other.k8_1 && this.l8_1 === other.l8_1 && this.m8_1 === other.m8_1);
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(IntProgression).hashCode = function () {
      return this.i() ? -1 : (imul(31, (imul(31, this.k8_1) + this.l8_1) | 0) + this.m8_1) | 0;
    };
    protoOf(IntProgression).toString = function () {
      return this.m8_1 > 0 ? "" + this.k8_1 + ".." + this.l8_1 + " step " + this.m8_1 : "" + this.k8_1 + " downTo " + this.l8_1 + " step " + (-this.m8_1 | 0);
    };
    function appendElement(_this__u8e3s4, element, transform) {
      if (!(transform == null)) {
        _this__u8e3s4.e(transform(element));
      } else {
        if (element == null ? true : isCharSequence(element)) {
          _this__u8e3s4.e(element);
        } else {
          if (element instanceof Char) {
            _this__u8e3s4.s6(element.v_1);
          } else {
            _this__u8e3s4.e(toString_0(element));
          }
        }
      }
    }
    function equals_0(_this__u8e3s4, other, ignoreCase) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      if (_this__u8e3s4 === other) return true;
      if (!ignoreCase) return false;
      var thisUpper = uppercaseChar(_this__u8e3s4);
      var otherUpper = uppercaseChar(other);
      var tmp;
      if (thisUpper === otherUpper) {
        tmp = true;
      } else {
        // Inline function 'kotlin.text.lowercaseChar' call
        // Inline function 'kotlin.text.lowercase' call
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var tmp$ret$2 = toString(thisUpper).toLowerCase();
        var tmp_0 = charSequenceGet(tmp$ret$2, 0);
        // Inline function 'kotlin.text.lowercaseChar' call
        // Inline function 'kotlin.text.lowercase' call
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var tmp$ret$6 = toString(otherUpper).toLowerCase();
        tmp = tmp_0 === charSequenceGet(tmp$ret$6, 0);
      }
      return tmp;
    }
    function toLongOrNull(_this__u8e3s4) {
      return toLongOrNull_0(_this__u8e3s4, 10);
    }
    function toIntOrNull(_this__u8e3s4) {
      return toIntOrNull_0(_this__u8e3s4, 10);
    }
    function toLongOrNull_0(_this__u8e3s4, radix) {
      checkRadix(radix);
      var length = _this__u8e3s4.length;
      if (length === 0) return null;
      var start;
      var isNegative;
      var limit;
      var firstChar = charSequenceGet(_this__u8e3s4, 0);
      if (Char__compareTo_impl_ypi4mb(firstChar, _Char___init__impl__6a9atx(48)) < 0) {
        if (length === 1) return null;
        start = 1;
        if (firstChar === _Char___init__impl__6a9atx(45)) {
          isNegative = true;
          limit = new Long(0, -2147483648);
        } else if (firstChar === _Char___init__impl__6a9atx(43)) {
          isNegative = false;
          limit = new Long(1, -2147483648);
        } else return null;
      } else {
        start = 0;
        isNegative = false;
        limit = new Long(1, -2147483648);
      }
      // Inline function 'kotlin.Long.div' call
      var limitForMaxRadix = new Long(1, -2147483648).c2(toLong(36));
      var limitBeforeMul = limitForMaxRadix;
      var result = new Long(0, 0);
      var inductionVariable = start;
      if (inductionVariable < length)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var digit = digitOf(charSequenceGet(_this__u8e3s4, i), radix);
          if (digit < 0) return null;
          if (result.y1(limitBeforeMul) < 0) {
            if (limitBeforeMul.equals(limitForMaxRadix)) {
              // Inline function 'kotlin.Long.div' call
              limitBeforeMul = limit.c2(toLong(radix));
              if (result.y1(limitBeforeMul) < 0) {
                return null;
              }
            } else {
              return null;
            }
          }
          // Inline function 'kotlin.Long.times' call
          result = result.b2(toLong(radix));
          var tmp = result;
          // Inline function 'kotlin.Long.plus' call
          var tmp$ret$3 = limit.z1(toLong(digit));
          if (tmp.y1(tmp$ret$3) < 0) return null;
          // Inline function 'kotlin.Long.minus' call
          result = result.a2(toLong(digit));
        } while (inductionVariable < length);
      return isNegative ? result : result.g2();
    }
    function toIntOrNull_0(_this__u8e3s4, radix) {
      checkRadix(radix);
      var length = _this__u8e3s4.length;
      if (length === 0) return null;
      var start;
      var isNegative;
      var limit;
      var firstChar = charSequenceGet(_this__u8e3s4, 0);
      if (Char__compareTo_impl_ypi4mb(firstChar, _Char___init__impl__6a9atx(48)) < 0) {
        if (length === 1) return null;
        start = 1;
        if (firstChar === _Char___init__impl__6a9atx(45)) {
          isNegative = true;
          limit = -2147483648;
        } else if (firstChar === _Char___init__impl__6a9atx(43)) {
          isNegative = false;
          limit = -2147483647;
        } else return null;
      } else {
        start = 0;
        isNegative = false;
        limit = -2147483647;
      }
      var limitForMaxRadix = -59652323;
      var limitBeforeMul = limitForMaxRadix;
      var result = 0;
      var inductionVariable = start;
      if (inductionVariable < length)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var digit = digitOf(charSequenceGet(_this__u8e3s4, i), radix);
          if (digit < 0) return null;
          if (result < limitBeforeMul) {
            if (limitBeforeMul === limitForMaxRadix) {
              limitBeforeMul = (limit / radix) | 0;
              if (result < limitBeforeMul) {
                return null;
              }
            } else {
              return null;
            }
          }
          result = imul(result, radix);
          if (result < ((limit + digit) | 0)) return null;
          result = (result - digit) | 0;
        } while (inductionVariable < length);
      return isNegative ? result : -result | 0;
    }
    function numberFormatError(input) {
      throw NumberFormatException_init_$Create$_0("Invalid number format: '" + input + "'");
    }
    function toShortOrNull(_this__u8e3s4) {
      return toShortOrNull_0(_this__u8e3s4, 10);
    }
    function toByteOrNull(_this__u8e3s4) {
      return toByteOrNull_0(_this__u8e3s4, 10);
    }
    function toShortOrNull_0(_this__u8e3s4, radix) {
      var tmp0_elvis_lhs = toIntOrNull_0(_this__u8e3s4, radix);
      var tmp;
      if (tmp0_elvis_lhs == null) {
        return null;
      } else {
        tmp = tmp0_elvis_lhs;
      }
      var int = tmp;
      if (int < -32768 || int > 32767) return null;
      return toShort(int);
    }
    function toByteOrNull_0(_this__u8e3s4, radix) {
      var tmp0_elvis_lhs = toIntOrNull_0(_this__u8e3s4, radix);
      var tmp;
      if (tmp0_elvis_lhs == null) {
        return null;
      } else {
        tmp = tmp0_elvis_lhs;
      }
      var int = tmp;
      if (int < -128 || int > 127) return null;
      return toByte(int);
    }
    function contains_1(_this__u8e3s4, char, ignoreCase) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      return indexOf_1(_this__u8e3s4, char, VOID, ignoreCase) >= 0;
    }
    function indexOf_1(_this__u8e3s4, char, startIndex, ignoreCase) {
      startIndex = startIndex === VOID ? 0 : startIndex;
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      var tmp;
      var tmp_0;
      if (ignoreCase) {
        tmp_0 = true;
      } else {
        tmp_0 = !(typeof _this__u8e3s4 === "string");
      }
      if (tmp_0) {
        // Inline function 'kotlin.charArrayOf' call
        var tmp$ret$0 = charArrayOf([char]);
        tmp = indexOfAny(_this__u8e3s4, tmp$ret$0, startIndex, ignoreCase);
      } else {
        // Inline function 'kotlin.text.nativeIndexOf' call
        // Inline function 'kotlin.text.nativeIndexOf' call
        var str = toString(char);
        // Inline function 'kotlin.js.asDynamic' call
        tmp = _this__u8e3s4.indexOf(str, startIndex);
      }
      return tmp;
    }
    function lineSequence(_this__u8e3s4) {
      return splitToSequence(_this__u8e3s4, ["\r\n", "\n", "\r"]);
    }
    function isBlank(_this__u8e3s4) {
      var tmp$ret$1;
      $l$block: {
        // Inline function 'kotlin.text.all' call
        var inductionVariable = 0;
        while (inductionVariable < charSequenceLength(_this__u8e3s4)) {
          var element = charSequenceGet(_this__u8e3s4, inductionVariable);
          inductionVariable = (inductionVariable + 1) | 0;
          // Inline function 'kotlin.text.isBlank.<anonymous>' call
          if (!isWhitespace(element)) {
            tmp$ret$1 = false;
            break $l$block;
          }
        }
        tmp$ret$1 = true;
      }
      return tmp$ret$1;
    }
    function get_lastIndex_1(_this__u8e3s4) {
      return (charSequenceLength(_this__u8e3s4) - 1) | 0;
    }
    function contains_2(_this__u8e3s4, other, ignoreCase) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      var tmp;
      if (typeof other === "string") {
        tmp = indexOf_2(_this__u8e3s4, other, VOID, ignoreCase) >= 0;
      } else {
        tmp = indexOf_3(_this__u8e3s4, other, 0, charSequenceLength(_this__u8e3s4), ignoreCase) >= 0;
      }
      return tmp;
    }
    function indexOfAny(_this__u8e3s4, chars, startIndex, ignoreCase) {
      startIndex = startIndex === VOID ? 0 : startIndex;
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      var tmp;
      if (!ignoreCase && chars.length === 1) {
        tmp = typeof _this__u8e3s4 === "string";
      } else {
        tmp = false;
      }
      if (tmp) {
        var char = single(chars);
        // Inline function 'kotlin.text.nativeIndexOf' call
        // Inline function 'kotlin.text.nativeIndexOf' call
        var str = toString(char);
        // Inline function 'kotlin.js.asDynamic' call
        return _this__u8e3s4.indexOf(str, startIndex);
      }
      var inductionVariable = coerceAtLeast(startIndex, 0);
      var last = get_lastIndex_1(_this__u8e3s4);
      if (inductionVariable <= last)
        do {
          var index = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var charAtIndex = charSequenceGet(_this__u8e3s4, index);
          var tmp$ret$4;
          $l$block: {
            // Inline function 'kotlin.collections.any' call
            var inductionVariable_0 = 0;
            var last_0 = chars.length;
            while (inductionVariable_0 < last_0) {
              var element = chars[inductionVariable_0];
              inductionVariable_0 = (inductionVariable_0 + 1) | 0;
              // Inline function 'kotlin.text.indexOfAny.<anonymous>' call
              if (equals_0(element, charAtIndex, ignoreCase)) {
                tmp$ret$4 = true;
                break $l$block;
              }
            }
            tmp$ret$4 = false;
          }
          if (tmp$ret$4) return index;
        } while (!(index === last));
      return -1;
    }
    function trim(_this__u8e3s4) {
      // Inline function 'kotlin.text.trim' call
      var startIndex = 0;
      var endIndex = (charSequenceLength(_this__u8e3s4) - 1) | 0;
      var startFound = false;
      $l$loop: while (startIndex <= endIndex) {
        var index = !startFound ? startIndex : endIndex;
        var p0 = charSequenceGet(_this__u8e3s4, index);
        var match = isWhitespace(p0);
        if (!startFound) {
          if (!match) startFound = true;
          else startIndex = (startIndex + 1) | 0;
        } else {
          if (!match) break $l$loop;
          else endIndex = (endIndex - 1) | 0;
        }
      }
      return charSequenceSubSequence(_this__u8e3s4, startIndex, (endIndex + 1) | 0);
    }
    function splitToSequence(_this__u8e3s4, delimiters, ignoreCase, limit) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      limit = limit === VOID ? 0 : limit;
      var tmp = rangesDelimitedBy(_this__u8e3s4, delimiters, VOID, ignoreCase, limit);
      return map(tmp, splitToSequence$lambda(_this__u8e3s4));
    }
    function indexOf_2(_this__u8e3s4, string, startIndex, ignoreCase) {
      startIndex = startIndex === VOID ? 0 : startIndex;
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      var tmp;
      var tmp_0;
      if (ignoreCase) {
        tmp_0 = true;
      } else {
        tmp_0 = !(typeof _this__u8e3s4 === "string");
      }
      if (tmp_0) {
        tmp = indexOf_3(_this__u8e3s4, string, startIndex, charSequenceLength(_this__u8e3s4), ignoreCase);
      } else {
        // Inline function 'kotlin.text.nativeIndexOf' call
        // Inline function 'kotlin.js.asDynamic' call
        tmp = _this__u8e3s4.indexOf(string, startIndex);
      }
      return tmp;
    }
    function indexOf_3(_this__u8e3s4, other, startIndex, endIndex, ignoreCase, last) {
      last = last === VOID ? false : last;
      var indices = !last
        ? numberRangeToNumber(coerceAtLeast(startIndex, 0), coerceAtMost(endIndex, charSequenceLength(_this__u8e3s4)))
        : downTo(coerceAtMost(startIndex, get_lastIndex_1(_this__u8e3s4)), coerceAtLeast(endIndex, 0));
      var tmp;
      if (typeof _this__u8e3s4 === "string") {
        tmp = typeof other === "string";
      } else {
        tmp = false;
      }
      if (tmp) {
        var inductionVariable = indices.k8_1;
        var last_0 = indices.l8_1;
        var step = indices.m8_1;
        if ((step > 0 && inductionVariable <= last_0) || (step < 0 && last_0 <= inductionVariable))
          do {
            var index = inductionVariable;
            inductionVariable = (inductionVariable + step) | 0;
            if (regionMatches(other, 0, _this__u8e3s4, index, charSequenceLength(other), ignoreCase)) return index;
          } while (!(index === last_0));
      } else {
        var inductionVariable_0 = indices.k8_1;
        var last_1 = indices.l8_1;
        var step_0 = indices.m8_1;
        if ((step_0 > 0 && inductionVariable_0 <= last_1) || (step_0 < 0 && last_1 <= inductionVariable_0))
          do {
            var index_0 = inductionVariable_0;
            inductionVariable_0 = (inductionVariable_0 + step_0) | 0;
            if (regionMatchesImpl(other, 0, _this__u8e3s4, index_0, charSequenceLength(other), ignoreCase)) return index_0;
          } while (!(index_0 === last_1));
      }
      return -1;
    }
    function regionMatchesImpl(_this__u8e3s4, thisOffset, other, otherOffset, length, ignoreCase) {
      if (
        otherOffset < 0 ||
        thisOffset < 0 ||
        thisOffset > ((charSequenceLength(_this__u8e3s4) - length) | 0) ||
        otherOffset > ((charSequenceLength(other) - length) | 0)
      ) {
        return false;
      }
      var inductionVariable = 0;
      if (inductionVariable < length)
        do {
          var index = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          if (!equals_0(charSequenceGet(_this__u8e3s4, (thisOffset + index) | 0), charSequenceGet(other, (otherOffset + index) | 0), ignoreCase)) return false;
        } while (inductionVariable < length);
      return true;
    }
    function substring(_this__u8e3s4, range) {
      return toString_1(charSequenceSubSequence(_this__u8e3s4, range.j(), (range.k() + 1) | 0));
    }
    function rangesDelimitedBy(_this__u8e3s4, delimiters, startIndex, ignoreCase, limit) {
      startIndex = startIndex === VOID ? 0 : startIndex;
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      limit = limit === VOID ? 0 : limit;
      requireNonNegativeLimit(limit);
      var delimitersList = asList(delimiters);
      return new DelimitedRangesSequence(_this__u8e3s4, startIndex, limit, rangesDelimitedBy$lambda(delimitersList, ignoreCase));
    }
    function requireNonNegativeLimit(limit) {
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (!(limit >= 0)) {
        // Inline function 'kotlin.text.requireNonNegativeLimit.<anonymous>' call
        var message = "Limit must be non-negative, but was " + limit;
        throw IllegalArgumentException_init_$Create$_0(toString_1(message));
      }
      return tmp;
    }
    function calcNext($this) {
      if ($this.t8_1 < 0) {
        $this.r8_1 = 0;
        $this.u8_1 = null;
      } else {
        var tmp;
        var tmp_0;
        if ($this.w8_1.z8_1 > 0) {
          $this.v8_1 = ($this.v8_1 + 1) | 0;
          tmp_0 = $this.v8_1 >= $this.w8_1.z8_1;
        } else {
          tmp_0 = false;
        }
        if (tmp_0) {
          tmp = true;
        } else {
          tmp = $this.t8_1 > charSequenceLength($this.w8_1.x8_1);
        }
        if (tmp) {
          $this.u8_1 = numberRangeToNumber($this.s8_1, get_lastIndex_1($this.w8_1.x8_1));
          $this.t8_1 = -1;
        } else {
          var match = $this.w8_1.a9_1($this.w8_1.x8_1, $this.t8_1);
          if (match == null) {
            $this.u8_1 = numberRangeToNumber($this.s8_1, get_lastIndex_1($this.w8_1.x8_1));
            $this.t8_1 = -1;
          } else {
            var index = match.x7();
            var length = match.y7();
            $this.u8_1 = until($this.s8_1, index);
            $this.s8_1 = (index + length) | 0;
            $this.t8_1 = ($this.s8_1 + (length === 0 ? 1 : 0)) | 0;
          }
        }
        $this.r8_1 = 1;
      }
    }
    function DelimitedRangesSequence$iterator$1(this$0) {
      this.w8_1 = this$0;
      this.r8_1 = -1;
      this.s8_1 = coerceIn(this$0.y8_1, 0, charSequenceLength(this$0.x8_1));
      this.t8_1 = this.s8_1;
      this.u8_1 = null;
      this.v8_1 = 0;
    }
    protoOf(DelimitedRangesSequence$iterator$1).n = function () {
      if (this.r8_1 === -1) {
        calcNext(this);
      }
      if (this.r8_1 === 0) throw NoSuchElementException_init_$Create$();
      var tmp = this.u8_1;
      var result = tmp instanceof IntRange ? tmp : THROW_CCE();
      this.u8_1 = null;
      this.r8_1 = -1;
      return result;
    };
    protoOf(DelimitedRangesSequence$iterator$1).m = function () {
      if (this.r8_1 === -1) {
        calcNext(this);
      }
      return this.r8_1 === 1;
    };
    function DelimitedRangesSequence(input, startIndex, limit, getNextMatch) {
      this.x8_1 = input;
      this.y8_1 = startIndex;
      this.z8_1 = limit;
      this.a9_1 = getNextMatch;
    }
    protoOf(DelimitedRangesSequence).l = function () {
      return new DelimitedRangesSequence$iterator$1(this);
    };
    function findAnyOf(_this__u8e3s4, strings, startIndex, ignoreCase, last) {
      if (!ignoreCase && strings.p() === 1) {
        var string = single_1(strings);
        var index = !last ? indexOf_2(_this__u8e3s4, string, startIndex) : lastIndexOf(_this__u8e3s4, string, startIndex);
        return index < 0 ? null : to(index, string);
      }
      var indices = !last
        ? numberRangeToNumber(coerceAtLeast(startIndex, 0), charSequenceLength(_this__u8e3s4))
        : downTo(coerceAtMost(startIndex, get_lastIndex_1(_this__u8e3s4)), 0);
      if (typeof _this__u8e3s4 === "string") {
        var inductionVariable = indices.k8_1;
        var last_0 = indices.l8_1;
        var step = indices.m8_1;
        if ((step > 0 && inductionVariable <= last_0) || (step < 0 && last_0 <= inductionVariable))
          do {
            var index_0 = inductionVariable;
            inductionVariable = (inductionVariable + step) | 0;
            var tmp$ret$1;
            $l$block: {
              // Inline function 'kotlin.collections.firstOrNull' call
              var tmp0_iterator = strings.l();
              while (tmp0_iterator.m()) {
                var element = tmp0_iterator.n();
                // Inline function 'kotlin.text.findAnyOf.<anonymous>' call
                if (regionMatches(element, 0, _this__u8e3s4, index_0, element.length, ignoreCase)) {
                  tmp$ret$1 = element;
                  break $l$block;
                }
              }
              tmp$ret$1 = null;
            }
            var matchingString = tmp$ret$1;
            if (!(matchingString == null)) return to(index_0, matchingString);
          } while (!(index_0 === last_0));
      } else {
        var inductionVariable_0 = indices.k8_1;
        var last_1 = indices.l8_1;
        var step_0 = indices.m8_1;
        if ((step_0 > 0 && inductionVariable_0 <= last_1) || (step_0 < 0 && last_1 <= inductionVariable_0))
          do {
            var index_1 = inductionVariable_0;
            inductionVariable_0 = (inductionVariable_0 + step_0) | 0;
            var tmp$ret$3;
            $l$block_0: {
              // Inline function 'kotlin.collections.firstOrNull' call
              var tmp0_iterator_0 = strings.l();
              while (tmp0_iterator_0.m()) {
                var element_0 = tmp0_iterator_0.n();
                // Inline function 'kotlin.text.findAnyOf.<anonymous>' call
                if (regionMatchesImpl(element_0, 0, _this__u8e3s4, index_1, element_0.length, ignoreCase)) {
                  tmp$ret$3 = element_0;
                  break $l$block_0;
                }
              }
              tmp$ret$3 = null;
            }
            var matchingString_0 = tmp$ret$3;
            if (!(matchingString_0 == null)) return to(index_1, matchingString_0);
          } while (!(index_1 === last_1));
      }
      return null;
    }
    function lastIndexOf(_this__u8e3s4, string, startIndex, ignoreCase) {
      startIndex = startIndex === VOID ? get_lastIndex_1(_this__u8e3s4) : startIndex;
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      var tmp;
      var tmp_0;
      if (ignoreCase) {
        tmp_0 = true;
      } else {
        tmp_0 = !(typeof _this__u8e3s4 === "string");
      }
      if (tmp_0) {
        tmp = indexOf_3(_this__u8e3s4, string, startIndex, 0, ignoreCase, true);
      } else {
        // Inline function 'kotlin.text.nativeLastIndexOf' call
        // Inline function 'kotlin.js.asDynamic' call
        tmp = _this__u8e3s4.lastIndexOf(string, startIndex);
      }
      return tmp;
    }
    function split(_this__u8e3s4, delimiters, ignoreCase, limit) {
      ignoreCase = ignoreCase === VOID ? false : ignoreCase;
      limit = limit === VOID ? 0 : limit;
      if (delimiters.length === 1) {
        var delimiter = delimiters[0];
        // Inline function 'kotlin.text.isEmpty' call
        if (!(charSequenceLength(delimiter) === 0)) {
          return split_0(_this__u8e3s4, delimiter, ignoreCase, limit);
        }
      }
      // Inline function 'kotlin.collections.map' call
      var this_0 = asIterable(rangesDelimitedBy(_this__u8e3s4, delimiters, VOID, ignoreCase, limit));
      // Inline function 'kotlin.collections.mapTo' call
      var destination = ArrayList_init_$Create$_0(collectionSizeOrDefault(this_0, 10));
      var tmp0_iterator = this_0.l();
      while (tmp0_iterator.m()) {
        var item = tmp0_iterator.n();
        // Inline function 'kotlin.text.split.<anonymous>' call
        var tmp$ret$1 = substring(_this__u8e3s4, item);
        destination.r2(tmp$ret$1);
      }
      return destination;
    }
    function trim_0(_this__u8e3s4, chars) {
      // Inline function 'kotlin.text.trim' call
      // Inline function 'kotlin.text.trim' call
      var this_0 = isCharSequence(_this__u8e3s4) ? _this__u8e3s4 : THROW_CCE();
      var startIndex = 0;
      var endIndex = (charSequenceLength(this_0) - 1) | 0;
      var startFound = false;
      $l$loop: while (startIndex <= endIndex) {
        var index = !startFound ? startIndex : endIndex;
        // Inline function 'kotlin.text.trim.<anonymous>' call
        var it = charSequenceGet(this_0, index);
        var match = contains_0(chars, it);
        if (!startFound) {
          if (!match) startFound = true;
          else startIndex = (startIndex + 1) | 0;
        } else {
          if (!match) break $l$loop;
          else endIndex = (endIndex - 1) | 0;
        }
      }
      var tmp$ret$1 = charSequenceSubSequence(this_0, startIndex, (endIndex + 1) | 0);
      return toString_1(tmp$ret$1);
    }
    function split_0(_this__u8e3s4, delimiter, ignoreCase, limit) {
      requireNonNegativeLimit(limit);
      var currentOffset = 0;
      var nextIndex = indexOf_2(_this__u8e3s4, delimiter, currentOffset, ignoreCase);
      if (nextIndex === -1 || limit === 1) {
        return listOf(toString_1(_this__u8e3s4));
      }
      var isLimited = limit > 0;
      var result = ArrayList_init_$Create$_0(isLimited ? coerceAtMost(limit, 10) : 10);
      $l$loop: do {
        // Inline function 'kotlin.text.substring' call
        var startIndex = currentOffset;
        var endIndex = nextIndex;
        var tmp$ret$0 = toString_1(charSequenceSubSequence(_this__u8e3s4, startIndex, endIndex));
        result.r2(tmp$ret$0);
        currentOffset = (nextIndex + delimiter.length) | 0;
        if (isLimited && result.p() === ((limit - 1) | 0)) break $l$loop;
        nextIndex = indexOf_2(_this__u8e3s4, delimiter, currentOffset, ignoreCase);
      } while (!(nextIndex === -1));
      // Inline function 'kotlin.text.substring' call
      var startIndex_0 = currentOffset;
      var endIndex_0 = charSequenceLength(_this__u8e3s4);
      var tmp$ret$1 = toString_1(charSequenceSubSequence(_this__u8e3s4, startIndex_0, endIndex_0));
      result.r2(tmp$ret$1);
      return result;
    }
    function splitToSequence$lambda($this_splitToSequence) {
      return function (it) {
        return substring($this_splitToSequence, it);
      };
    }
    function rangesDelimitedBy$lambda($delimitersList, $ignoreCase) {
      return function ($this$$receiver, currentIndex) {
        var tmp0_safe_receiver = findAnyOf($this$$receiver, $delimitersList, currentIndex, $ignoreCase, false);
        var tmp;
        if (tmp0_safe_receiver == null) {
          tmp = null;
        } else {
          // Inline function 'kotlin.let' call
          // Inline function 'kotlin.contracts.contract' call
          // Inline function 'kotlin.text.rangesDelimitedBy.<anonymous>.<anonymous>' call
          tmp = to(tmp0_safe_receiver.v7_1, tmp0_safe_receiver.w7_1.length);
        }
        return tmp;
      };
    }
    function UnsafeLazyImpl(initializer) {
      this.b9_1 = initializer;
      this.c9_1 = UNINITIALIZED_VALUE_instance;
    }
    protoOf(UnsafeLazyImpl).k1 = function () {
      if (this.c9_1 === UNINITIALIZED_VALUE_instance) {
        this.c9_1 = ensureNotNull(this.b9_1)();
        this.b9_1 = null;
      }
      var tmp = this.c9_1;
      return (tmp == null ? true : !(tmp == null)) ? tmp : THROW_CCE();
    };
    protoOf(UnsafeLazyImpl).d9 = function () {
      return !(this.c9_1 === UNINITIALIZED_VALUE_instance);
    };
    protoOf(UnsafeLazyImpl).toString = function () {
      return this.d9() ? toString_0(this.k1()) : "Lazy value not initialized yet.";
    };
    function UNINITIALIZED_VALUE() {}
    var UNINITIALIZED_VALUE_instance;
    function UNINITIALIZED_VALUE_getInstance() {
      return UNINITIALIZED_VALUE_instance;
    }
    function _Result___init__impl__xyqfz8(value) {
      return value;
    }
    function _Result___get_value__impl__bjfvqg($this) {
      return $this;
    }
    function _Result___get_isFailure__impl__jpiriv($this) {
      var tmp = _Result___get_value__impl__bjfvqg($this);
      return tmp instanceof Failure;
    }
    function Companion_10() {}
    var Companion_instance_10;
    function Companion_getInstance_10() {
      return Companion_instance_10;
    }
    function Failure(exception) {
      this.e9_1 = exception;
    }
    protoOf(Failure).equals = function (other) {
      var tmp;
      if (other instanceof Failure) {
        tmp = equals(this.e9_1, other.e9_1);
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(Failure).hashCode = function () {
      return hashCode(this.e9_1);
    };
    protoOf(Failure).toString = function () {
      return "Failure(" + this.e9_1.toString() + ")";
    };
    function createFailure(exception) {
      return new Failure(exception);
    }
    function Pair(first, second) {
      this.v7_1 = first;
      this.w7_1 = second;
    }
    protoOf(Pair).toString = function () {
      return "(" + toString_0(this.v7_1) + ", " + toString_0(this.w7_1) + ")";
    };
    protoOf(Pair).x7 = function () {
      return this.v7_1;
    };
    protoOf(Pair).y7 = function () {
      return this.w7_1;
    };
    protoOf(Pair).hashCode = function () {
      var result = this.v7_1 == null ? 0 : hashCode(this.v7_1);
      result = (imul(result, 31) + (this.w7_1 == null ? 0 : hashCode(this.w7_1))) | 0;
      return result;
    };
    protoOf(Pair).equals = function (other) {
      if (this === other) return true;
      if (!(other instanceof Pair)) return false;
      var tmp0_other_with_cast = other instanceof Pair ? other : THROW_CCE();
      if (!equals(this.v7_1, tmp0_other_with_cast.v7_1)) return false;
      if (!equals(this.w7_1, tmp0_other_with_cast.w7_1)) return false;
      return true;
    };
    function to(_this__u8e3s4, that) {
      return new Pair(_this__u8e3s4, that);
    }
    function Triple(first, second, third) {
      this.f9_1 = first;
      this.g9_1 = second;
      this.h9_1 = third;
    }
    protoOf(Triple).toString = function () {
      return "(" + toString_0(this.f9_1) + ", " + toString_0(this.g9_1) + ", " + toString_0(this.h9_1) + ")";
    };
    protoOf(Triple).x7 = function () {
      return this.f9_1;
    };
    protoOf(Triple).y7 = function () {
      return this.g9_1;
    };
    protoOf(Triple).i9 = function () {
      return this.h9_1;
    };
    protoOf(Triple).hashCode = function () {
      var result = this.f9_1 == null ? 0 : hashCode(this.f9_1);
      result = (imul(result, 31) + (this.g9_1 == null ? 0 : hashCode(this.g9_1))) | 0;
      result = (imul(result, 31) + (this.h9_1 == null ? 0 : hashCode(this.h9_1))) | 0;
      return result;
    };
    protoOf(Triple).equals = function (other) {
      if (this === other) return true;
      if (!(other instanceof Triple)) return false;
      var tmp0_other_with_cast = other instanceof Triple ? other : THROW_CCE();
      if (!equals(this.f9_1, tmp0_other_with_cast.f9_1)) return false;
      if (!equals(this.g9_1, tmp0_other_with_cast.g9_1)) return false;
      if (!equals(this.h9_1, tmp0_other_with_cast.h9_1)) return false;
      return true;
    };
    function _UShort___init__impl__jigrne(data) {
      return data;
    }
    function _UShort___get_data__impl__g0245($this) {
      return $this;
    }
    //region block: post-declaration
    protoOf(InternalHashMap).a5 = containsAllEntries;
    //endregion
    //region block: init
    Unit_instance = new Unit();
    Companion_instance_0 = new Companion_0();
    _stableSortingIsSupported = null;
    Companion_instance_3 = new Companion_3();
    Companion_instance_5 = new Companion_5();
    Companion_instance_6 = new Companion_6();
    Companion_instance_7 = new Companion_7();
    EmptyIterator_instance = new EmptyIterator();
    Companion_instance_9 = new Companion_9();
    UNINITIALIZED_VALUE_instance = new UNINITIALIZED_VALUE();
    Companion_instance_10 = new Companion_10();
    //endregion
    //region block: exports
    _.$_$ = _.$_$ || {};
    _.$_$.a = arrayConcat;
    _.$_$.b = taggedArrayCopy;
    _.$_$.c = VOID;
    _.$_$.d = ArrayList_init_$Create$_0;
    _.$_$.e = ArrayList_init_$Create$;
    _.$_$.f = HashMap_init_$Create$;
    _.$_$.g = HashSet_init_$Create$;
    _.$_$.h = StringBuilder_init_$Create$;
    _.$_$.i = Exception_init_$Init$;
    _.$_$.j = Exception_init_$Init$_0;
    _.$_$.k = Exception_init_$Init$_1;
    _.$_$.l = IllegalArgumentException_init_$Create$;
    _.$_$.m = IllegalArgumentException_init_$Create$_0;
    _.$_$.n = IllegalStateException_init_$Create$_0;
    _.$_$.o = IndexOutOfBoundsException_init_$Create$;
    _.$_$.p = IndexOutOfBoundsException_init_$Create$_0;
    _.$_$.q = NoSuchElementException_init_$Create$;
    _.$_$.r = UnsupportedOperationException_init_$Create$_1;
    _.$_$.s = _Char___init__impl__6a9atx;
    _.$_$.t = Char__toInt_impl_vasixd;
    _.$_$.u = _Result___init__impl__xyqfz8;
    _.$_$.v = _Result___get_isFailure__impl__jpiriv;
    _.$_$.w = _Result___get_value__impl__bjfvqg;
    _.$_$.x = Companion_instance_10;
    _.$_$.y = Unit_instance;
    _.$_$.z = Collection;
    _.$_$.a1 = Entry;
    _.$_$.b1 = KtMap;
    _.$_$.c1 = arrayCopy;
    _.$_$.d1 = arrayListOf;
    _.$_$.e1 = asReversed;
    _.$_$.f1 = contentEquals;
    _.$_$.g1 = firstOrNull;
    _.$_$.h1 = first;
    _.$_$.i1 = first_0;
    _.$_$.j1 = hashMapOf;
    _.$_$.k1 = joinToString_1;
    _.$_$.l1 = joinToString_2;
    _.$_$.m1 = joinToString_3;
    _.$_$.n1 = joinToString_4;
    _.$_$.o1 = joinToString_0;
    _.$_$.p1 = joinToString_5;
    _.$_$.q1 = joinToString;
    _.$_$.r1 = get_lastIndex_0;
    _.$_$.s1 = lastOrNull;
    _.$_$.t1 = last;
    _.$_$.u1 = listOf_0;
    _.$_$.v1 = max;
    _.$_$.w1 = min;
    _.$_$.x1 = min_0;
    _.$_$.y1 = removeFirstOrNull;
    _.$_$.z1 = removeFirst;
    _.$_$.a2 = sliceArray;
    _.$_$.b2 = sortWith;
    _.$_$.c2 = sum;
    _.$_$.d2 = compareValues;
    _.$_$.e2 = getProgressionLastElement;
    _.$_$.f2 = println;
    _.$_$.g2 = FunctionAdapter;
    _.$_$.h2 = anyToString;
    _.$_$.i2 = arrayIterator;
    _.$_$.j2 = captureStack;
    _.$_$.k2 = charArrayOf;
    _.$_$.l2 = charSequenceGet;
    _.$_$.m2 = charSequenceLength;
    _.$_$.n2 = compareTo;
    _.$_$.o2 = defineProp;
    _.$_$.p2 = equals;
    _.$_$.q2 = fillArrayVal;
    _.$_$.r2 = getBooleanHashCode;
    _.$_$.s2 = getNumberHashCode;
    _.$_$.t2 = getPropertyCallableRef;
    _.$_$.u2 = getStringHashCode;
    _.$_$.v2 = hashCode;
    _.$_$.w2 = initMetadataForClass;
    _.$_$.x2 = initMetadataForCompanion;
    _.$_$.y2 = initMetadataForInterface;
    _.$_$.z2 = initMetadataForObject;
    _.$_$.a3 = isArray;
    _.$_$.b3 = isByteArray;
    _.$_$.c3 = isCharSequence;
    _.$_$.d3 = isDoubleArray;
    _.$_$.e3 = isFloatArray;
    _.$_$.f3 = isIntArray;
    _.$_$.g3 = isInterface;
    _.$_$.h3 = isLongArray;
    _.$_$.i3 = newThrowable;
    _.$_$.j3 = numberToChar;
    _.$_$.k3 = numberToDouble;
    _.$_$.l3 = numberToInt;
    _.$_$.m3 = numberToLong;
    _.$_$.n3 = objectCreate;
    _.$_$.o3 = protoOf;
    _.$_$.p3 = toByte;
    _.$_$.q3 = toLong;
    _.$_$.r3 = toString_1;
    _.$_$.s3 = roundToInt;
    _.$_$.t3 = coerceAtLeast_0;
    _.$_$.u3 = until;
    _.$_$.v3 = KProperty0;
    _.$_$.w3 = KProperty1;
    _.$_$.x3 = Sequence;
    _.$_$.y3 = joinToString_6;
    _.$_$.z3 = contains_2;
    _.$_$.a4 = contains_1;
    _.$_$.b4 = isBlank;
    _.$_$.c4 = lastIndexOf;
    _.$_$.d4 = replace;
    _.$_$.e4 = split;
    _.$_$.f4 = startsWith;
    _.$_$.g4 = takeLast;
    _.$_$.h4 = toBoolean;
    _.$_$.i4 = toByte_0;
    _.$_$.j4 = toCharArray;
    _.$_$.k4 = toDouble;
    _.$_$.l4 = toInt;
    _.$_$.m4 = toLongOrNull;
    _.$_$.n4 = toLong_0;
    _.$_$.o4 = toShort_0;
    _.$_$.p4 = toString_2;
    _.$_$.q4 = trim_0;
    _.$_$.r4 = trim;
    _.$_$.s4 = Char;
    _.$_$.t4 = Comparator;
    _.$_$.u4 = Enum;
    _.$_$.v4 = Exception;
    _.$_$.w4 = Long;
    _.$_$.x4 = Pair;
    _.$_$.y4 = THROW_CCE;
    _.$_$.z4 = Triple;
    _.$_$.a5 = createFailure;
    _.$_$.b5 = ensureNotNull;
    _.$_$.c5 = lazy;
    _.$_$.d5 = printStackTrace;
    _.$_$.e5 = stackTraceToString;
    _.$_$.f5 = throwKotlinNothingValueException;
    _.$_$.g5 = toString_0;
    //endregion
    return _;
  })({});

  //# sourceMappingURL=kotlin-kotlin-stdlib.js.map
  var kotlin_org_jetbrains_kotlinx_kotlinx_io_core = (function (_, kotlin_kotlin) {
    "use strict";
    //region block: imports
    var imul = Math.imul;
    var IndexOutOfBoundsException_init_$Create$ = kotlin_kotlin.$_$.p;
    var Long = kotlin_kotlin.$_$.w4;
    var IllegalArgumentException_init_$Create$ = kotlin_kotlin.$_$.m;
    var _Char___init__impl__6a9atx = kotlin_kotlin.$_$.s;
    var charArrayOf = kotlin_kotlin.$_$.k2;
    var protoOf = kotlin_kotlin.$_$.o3;
    var Unit_instance = kotlin_kotlin.$_$.y;
    var ensureNotNull = kotlin_kotlin.$_$.b5;
    var toLong = kotlin_kotlin.$_$.q3;
    var toString = kotlin_kotlin.$_$.r3;
    var StringBuilder_init_$Create$ = kotlin_kotlin.$_$.h;
    var initMetadataForClass = kotlin_kotlin.$_$.w2;
    var IllegalStateException_init_$Create$ = kotlin_kotlin.$_$.n;
    var objectCreate = kotlin_kotlin.$_$.n3;
    var initMetadataForCompanion = kotlin_kotlin.$_$.x2;
    var arrayCopy = kotlin_kotlin.$_$.c1;
    var IllegalArgumentException_init_$Create$_0 = kotlin_kotlin.$_$.l;
    var initMetadataForObject = kotlin_kotlin.$_$.z2;
    var VOID = kotlin_kotlin.$_$.c;
    var charSequenceGet = kotlin_kotlin.$_$.l2;
    var Char__toInt_impl_vasixd = kotlin_kotlin.$_$.t;
    var toByte = kotlin_kotlin.$_$.p3;
    var initMetadataForInterface = kotlin_kotlin.$_$.y2;
    var startsWith = kotlin_kotlin.$_$.f4;
    var Exception_init_$Init$ = kotlin_kotlin.$_$.i;
    var captureStack = kotlin_kotlin.$_$.j2;
    var Exception_init_$Init$_0 = kotlin_kotlin.$_$.j;
    var Exception_init_$Init$_1 = kotlin_kotlin.$_$.k;
    var Exception = kotlin_kotlin.$_$.v4;
    var UnsupportedOperationException_init_$Create$ = kotlin_kotlin.$_$.r;
    var KProperty0 = kotlin_kotlin.$_$.v3;
    var getPropertyCallableRef = kotlin_kotlin.$_$.t2;
    var lazy = kotlin_kotlin.$_$.c5;
    var ArrayList_init_$Create$ = kotlin_kotlin.$_$.e;
    var asReversed = kotlin_kotlin.$_$.e1;
    var charSequenceLength = kotlin_kotlin.$_$.m2;
    var contains = kotlin_kotlin.$_$.a4;
    var getStringHashCode = kotlin_kotlin.$_$.u2;
    var Char = kotlin_kotlin.$_$.s4;
    //endregion
    //region block: pre-declaration
    initMetadataForClass(Buffer, "Buffer", Buffer);
    initMetadataForClass(RealSink, "RealSink");
    initMetadataForCompanion(Companion);
    initMetadataForClass(Segment, "Segment");
    initMetadataForClass(SegmentCopyTracker, "SegmentCopyTracker");
    initMetadataForObject(AlwaysSharedCopyTracker, "AlwaysSharedCopyTracker", VOID, SegmentCopyTracker);
    function createDirectories$default(path, mustCreate, $super) {
      mustCreate = mustCreate === VOID ? false : mustCreate;
      var tmp;
      if ($super === VOID) {
        this.md(path, mustCreate);
        tmp = Unit_instance;
      } else {
        tmp = $super.md.call(this, path, mustCreate);
      }
      return tmp;
    }
    function sink$default(path, append, $super) {
      append = append === VOID ? false : append;
      return $super === VOID ? this.od(path, append) : $super.od.call(this, path, append);
    }
    initMetadataForInterface(FileSystem, "FileSystem");
    initMetadataForClass(SystemFileSystemImpl, "SystemFileSystemImpl", VOID, VOID, [FileSystem]);
    initMetadataForClass(FileMetadata, "FileMetadata", FileMetadata);
    initMetadataForObject(UnsafeBufferOperations, "UnsafeBufferOperations");
    initMetadataForClass(SegmentReadContextImpl$1);
    initMetadataForClass(SegmentWriteContextImpl$1);
    initMetadataForClass(BufferIterationContextImpl$1);
    initMetadataForClass(IOException, "IOException", IOException_init_$Create$, Exception);
    initMetadataForClass(EOFException, "EOFException", EOFException_init_$Create$, IOException);
    initMetadataForObject(SegmentPool, "SegmentPool");
    initMetadataForClass(SystemFileSystem$1, VOID, VOID, SystemFileSystemImpl);
    initMetadataForClass(Path, "Path");
    initMetadataForClass(FileSink, "FileSink");
    //endregion
    function get_HEX_DIGIT_CHARS() {
      _init_properties__Util_kt__g8tcl9();
      return HEX_DIGIT_CHARS;
    }
    var HEX_DIGIT_CHARS;
    function checkBounds(size, startIndex, endIndex) {
      _init_properties__Util_kt__g8tcl9();
      if (startIndex.y1(new Long(0, 0)) < 0 || endIndex.y1(size) > 0) {
        throw IndexOutOfBoundsException_init_$Create$(
          "startIndex (" + startIndex.toString() + ") and endIndex (" + endIndex.toString() + ") are not within the range [0..size(" + size.toString() + "))",
        );
      }
      if (startIndex.y1(endIndex) > 0) {
        throw IllegalArgumentException_init_$Create$("startIndex (" + startIndex.toString() + ") > endIndex (" + endIndex.toString() + ")");
      }
    }
    function checkOffsetAndCount(size, offset, byteCount) {
      _init_properties__Util_kt__g8tcl9();
      if (offset.y1(new Long(0, 0)) < 0 || offset.y1(size) > 0 || size.a2(offset).y1(byteCount) < 0 || byteCount.y1(new Long(0, 0)) < 0) {
        throw IllegalArgumentException_init_$Create$(
          "offset (" + offset.toString() + ") and byteCount (" + byteCount.toString() + ") are not within the range [0..size(" + size.toString() + "))",
        );
      }
    }
    var properties_initialized__Util_kt_67kc5b;
    function _init_properties__Util_kt__g8tcl9() {
      if (!properties_initialized__Util_kt_67kc5b) {
        properties_initialized__Util_kt_67kc5b = true;
        // Inline function 'kotlin.charArrayOf' call
        HEX_DIGIT_CHARS = charArrayOf([
          _Char___init__impl__6a9atx(48),
          _Char___init__impl__6a9atx(49),
          _Char___init__impl__6a9atx(50),
          _Char___init__impl__6a9atx(51),
          _Char___init__impl__6a9atx(52),
          _Char___init__impl__6a9atx(53),
          _Char___init__impl__6a9atx(54),
          _Char___init__impl__6a9atx(55),
          _Char___init__impl__6a9atx(56),
          _Char___init__impl__6a9atx(57),
          _Char___init__impl__6a9atx(97),
          _Char___init__impl__6a9atx(98),
          _Char___init__impl__6a9atx(99),
          _Char___init__impl__6a9atx(100),
          _Char___init__impl__6a9atx(101),
          _Char___init__impl__6a9atx(102),
        ]);
      }
    }
    function Buffer() {
      this.kb_1 = null;
      this.lb_1 = null;
      this.mb_1 = new Long(0, 0);
    }
    protoOf(Buffer).p = function () {
      return this.mb_1;
    };
    protoOf(Buffer).nb = function () {
      return this;
    };
    protoOf(Buffer).ob = function () {
      return this.p().equals(new Long(0, 0));
    };
    protoOf(Buffer).pb = function () {
      return Unit_instance;
    };
    protoOf(Buffer).qb = function () {
      var result = this.p();
      if (result.equals(new Long(0, 0))) return new Long(0, 0);
      var tail = ensureNotNull(this.lb_1);
      if (tail.tb_1 < 8192 && tail.vb_1) {
        result = result.a2(toLong((tail.tb_1 - tail.sb_1) | 0));
      }
      return result;
    };
    protoOf(Buffer).yb = function (byteCount) {
      // Inline function 'kotlinx.io.checkByteCount' call
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(byteCount.y1(new Long(0, 0)) >= 0)) {
        // Inline function 'kotlinx.io.checkByteCount.<anonymous>' call
        var message = "byteCount (" + byteCount.toString() + ") < 0";
        throw IllegalArgumentException_init_$Create$(toString(message));
      }
      var remainingByteCount = byteCount;
      while (remainingByteCount.y1(new Long(0, 0)) > 0) {
        var tmp0_elvis_lhs = this.kb_1;
        var tmp;
        if (tmp0_elvis_lhs == null) {
          throw EOFException_init_$Create$_0("Buffer exhausted before skipping " + byteCount.toString() + " bytes.");
        } else {
          tmp = tmp0_elvis_lhs;
        }
        var head = tmp;
        // Inline function 'kotlinx.io.minOf' call
        var a = remainingByteCount;
        var b = (head.tb_1 - head.sb_1) | 0;
        // Inline function 'kotlin.comparisons.minOf' call
        var b_0 = toLong(b);
        var toSkip = (a.y1(b_0) <= 0 ? a : b_0).i2();
        this.mb_1 = this.mb_1.a2(toLong(toSkip));
        remainingByteCount = remainingByteCount.a2(toLong(toSkip));
        head.sb_1 = (head.sb_1 + toSkip) | 0;
        if (head.sb_1 === head.tb_1) {
          this.zb();
        }
      }
    };
    protoOf(Buffer).ac = function (minimumCapacity) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(minimumCapacity >= 1 && minimumCapacity <= 8192)) {
        // Inline function 'kotlinx.io.Buffer.writableSegment.<anonymous>' call
        var message = "unexpected capacity";
        throw IllegalArgumentException_init_$Create$(toString(message));
      }
      if (this.lb_1 == null) {
        var result = SegmentPool_instance.dc();
        this.kb_1 = result;
        this.lb_1 = result;
        return result;
      }
      var t = ensureNotNull(this.lb_1);
      if (((t.tb_1 + minimumCapacity) | 0) > 8192 || !t.vb_1) {
        var newTail = t.ec(SegmentPool_instance.dc());
        this.lb_1 = newTail;
        return newTail;
      }
      return t;
    };
    protoOf(Buffer).fc = function (source, byteCount) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!!(source === this)) {
        // Inline function 'kotlinx.io.Buffer.write.<anonymous>' call
        var message = "source == this";
        throw IllegalArgumentException_init_$Create$(toString(message));
      }
      checkOffsetAndCount(source.mb_1, new Long(0, 0), byteCount);
      var remainingByteCount = byteCount;
      while (remainingByteCount.y1(new Long(0, 0)) > 0) {
        if (remainingByteCount.y1(toLong(ensureNotNull(source.kb_1).jc())) < 0) {
          var tail = this.lb_1;
          var tmp;
          if (!(tail == null) && tail.vb_1) {
            // Inline function 'kotlin.Long.minus' call
            // Inline function 'kotlin.Long.plus' call
            var this_0 = remainingByteCount;
            var other = tail.tb_1;
            var this_1 = this_0.z1(toLong(other));
            var other_0 = tail.gc() ? 0 : tail.sb_1;
            tmp = this_1.a2(toLong(other_0)).y1(new Long(8192, 0)) <= 0;
          } else {
            tmp = false;
          }
          if (tmp) {
            ensureNotNull(source.kb_1).ic(tail, remainingByteCount.i2());
            source.mb_1 = source.mb_1.a2(remainingByteCount);
            this.mb_1 = this.mb_1.z1(remainingByteCount);
            return Unit_instance;
          } else {
            source.kb_1 = ensureNotNull(source.kb_1).hc(remainingByteCount.i2());
          }
        }
        var segmentToMove = ensureNotNull(source.kb_1);
        var movedByteCount = toLong(segmentToMove.jc());
        source.kb_1 = segmentToMove.kc();
        if (source.kb_1 == null) {
          source.lb_1 = null;
        }
        // Inline function 'kotlinx.io.Buffer.pushSegment' call
        if (this.kb_1 == null) {
          this.kb_1 = segmentToMove;
          this.lb_1 = segmentToMove;
        } else if (true) {
          this.lb_1 = ensureNotNull(this.lb_1).ec(segmentToMove).lc();
          if (ensureNotNull(this.lb_1).xb_1 == null) {
            this.kb_1 = this.lb_1;
          }
        } else {
          this.lb_1 = ensureNotNull(this.lb_1).ec(segmentToMove);
        }
        source.mb_1 = source.mb_1.a2(movedByteCount);
        this.mb_1 = this.mb_1.z1(movedByteCount);
        remainingByteCount = remainingByteCount.a2(movedByteCount);
      }
    };
    protoOf(Buffer).mc = function (byte) {
      this.ac(1).nc(byte);
      this.mb_1 = this.mb_1.z1(new Long(1, 0));
    };
    protoOf(Buffer).toString = function () {
      if (this.p().equals(new Long(0, 0))) return "Buffer(size=0)";
      var maxPrintableBytes = 64;
      // Inline function 'kotlinx.io.minOf' call
      var b = this.p();
      // Inline function 'kotlin.comparisons.minOf' call
      var a = toLong(maxPrintableBytes);
      var len = (a.y1(b) <= 0 ? a : b).i2();
      var builder = StringBuilder_init_$Create$((imul(len, 2) + (this.p().y1(toLong(maxPrintableBytes)) > 0 ? 1 : 0)) | 0);
      var bytesWritten = 0;
      // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.forEachSegment' call
      var curr = this.kb_1;
      while (!(curr == null)) {
        // Inline function 'kotlinx.io.Buffer.toString.<anonymous>' call
        var ctx = get_SegmentReadContextImpl();
        var segment = curr;
        var idx = 0;
        while (bytesWritten < len && idx < segment.jc()) {
          var _unary__edvuaz = idx;
          idx = (_unary__edvuaz + 1) | 0;
          var b_0 = ctx.oc(segment, _unary__edvuaz);
          bytesWritten = (bytesWritten + 1) | 0;
          var tmp = get_HEX_DIGIT_CHARS();
          // Inline function 'kotlinx.io.shr' call
          var tmp$ret$2 = b_0 >> 4;
          var tmp_0 = builder.s6(tmp[tmp$ret$2 & 15]);
          var tmp_1 = get_HEX_DIGIT_CHARS();
          // Inline function 'kotlinx.io.and' call
          var tmp$ret$3 = b_0 & 15;
          tmp_0.s6(tmp_1[tmp$ret$3]);
        }
        curr = curr.wb_1;
      }
      if (this.p().y1(toLong(maxPrintableBytes)) > 0) {
        builder.s6(_Char___init__impl__6a9atx(8230));
      }
      return "Buffer(size=" + this.p().toString() + " hex=" + builder.toString() + ")";
    };
    protoOf(Buffer).zb = function () {
      var oldHead = ensureNotNull(this.kb_1);
      var nextHead = oldHead.wb_1;
      this.kb_1 = nextHead;
      if (nextHead == null) {
        this.lb_1 = null;
      } else {
        nextHead.xb_1 = null;
      }
      oldHead.wb_1 = null;
      SegmentPool_instance.pc(oldHead);
    };
    protoOf(Buffer).qc = function () {
      var oldTail = ensureNotNull(this.lb_1);
      var newTail = oldTail.xb_1;
      this.lb_1 = newTail;
      if (newTail == null) {
        this.kb_1 = null;
      } else {
        newTail.wb_1 = null;
      }
      oldTail.xb_1 = null;
      SegmentPool_instance.pc(oldTail);
    };
    function buffered(_this__u8e3s4) {
      return new RealSink(_this__u8e3s4);
    }
    function RealSink(sink) {
      this.rc_1 = sink;
      this.sc_1 = false;
      this.tc_1 = new Buffer();
    }
    protoOf(RealSink).nb = function () {
      return this.tc_1;
    };
    protoOf(RealSink).fc = function (source, byteCount) {
      // Inline function 'kotlinx.io.RealSink.checkNotClosed' call
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      if (!!this.sc_1) {
        // Inline function 'kotlinx.io.RealSink.checkNotClosed.<anonymous>' call
        var message = "Sink is closed.";
        throw IllegalStateException_init_$Create$(toString(message));
      }
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(byteCount.y1(new Long(0, 0)) >= 0)) {
        // Inline function 'kotlinx.io.RealSink.write.<anonymous>' call
        var message_0 = "byteCount: " + byteCount.toString();
        throw IllegalArgumentException_init_$Create$(toString(message_0));
      }
      this.tc_1.fc(source, byteCount);
      this.pb();
    };
    protoOf(RealSink).pb = function () {
      // Inline function 'kotlinx.io.RealSink.checkNotClosed' call
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      if (!!this.sc_1) {
        // Inline function 'kotlinx.io.RealSink.checkNotClosed.<anonymous>' call
        var message = "Sink is closed.";
        throw IllegalStateException_init_$Create$(toString(message));
      }
      var byteCount = this.tc_1.qb();
      if (byteCount.y1(new Long(0, 0)) > 0) {
        this.rc_1.fc(this.tc_1, byteCount);
      }
    };
    protoOf(RealSink).toString = function () {
      return "buffered(" + toString(this.rc_1) + ")";
    };
    function Segment_init_$Init$($this) {
      Segment.call($this);
      $this.rb_1 = new Int8Array(8192);
      $this.vb_1 = true;
      $this.ub_1 = null;
      return $this;
    }
    function Segment_init_$Create$() {
      return Segment_init_$Init$(objectCreate(protoOf(Segment)));
    }
    function Segment_init_$Init$_0(data, pos, limit, shareToken, owner, $this) {
      Segment.call($this);
      $this.rb_1 = data;
      $this.sb_1 = pos;
      $this.tb_1 = limit;
      $this.ub_1 = shareToken;
      $this.vb_1 = owner;
      return $this;
    }
    function Segment_init_$Create$_0(data, pos, limit, shareToken, owner) {
      return Segment_init_$Init$_0(data, pos, limit, shareToken, owner, objectCreate(protoOf(Segment)));
    }
    function Companion() {
      this.uc_1 = 8192;
      this.vc_1 = 1024;
    }
    protoOf(Companion).wc = function () {
      return Segment_init_$Create$();
    };
    var Companion_instance;
    function Companion_getInstance() {
      return Companion_instance;
    }
    protoOf(Segment).gc = function () {
      var tmp1_safe_receiver = this.ub_1;
      var tmp0_elvis_lhs = tmp1_safe_receiver == null ? null : tmp1_safe_receiver.xc();
      return tmp0_elvis_lhs == null ? false : tmp0_elvis_lhs;
    };
    protoOf(Segment).yc = function () {
      var tmp0_elvis_lhs = this.ub_1;
      var tmp;
      if (tmp0_elvis_lhs == null) {
        // Inline function 'kotlin.also' call
        var this_0 = SegmentPool_instance.zc();
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlinx.io.Segment.sharedCopy.<anonymous>' call
        this.ub_1 = this_0;
        tmp = this_0;
      } else {
        tmp = tmp0_elvis_lhs;
      }
      var t = tmp;
      var tmp_0 = this.sb_1;
      var tmp_1 = this.tb_1;
      // Inline function 'kotlin.also' call
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlinx.io.Segment.sharedCopy.<anonymous>' call
      t.ad();
      return Segment_init_$Create$_0(this.rb_1, tmp_0, tmp_1, t, false);
    };
    protoOf(Segment).kc = function () {
      var result = this.wb_1;
      if (!(this.xb_1 == null)) {
        ensureNotNull(this.xb_1).wb_1 = this.wb_1;
      }
      if (!(this.wb_1 == null)) {
        ensureNotNull(this.wb_1).xb_1 = this.xb_1;
      }
      this.wb_1 = null;
      this.xb_1 = null;
      return result;
    };
    protoOf(Segment).ec = function (segment) {
      segment.xb_1 = this;
      segment.wb_1 = this.wb_1;
      if (!(this.wb_1 == null)) {
        ensureNotNull(this.wb_1).xb_1 = segment;
      }
      this.wb_1 = segment;
      return segment;
    };
    protoOf(Segment).hc = function (byteCount) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(byteCount > 0 && byteCount <= ((this.tb_1 - this.sb_1) | 0))) {
        // Inline function 'kotlinx.io.Segment.split.<anonymous>' call
        var message = "byteCount out of range";
        throw IllegalArgumentException_init_$Create$(toString(message));
      }
      var prefix;
      if (byteCount >= 1024) {
        prefix = this.yc();
      } else {
        prefix = SegmentPool_instance.dc();
        // Inline function 'kotlin.collections.copyInto' call
        var this_0 = this.rb_1;
        var destination = prefix.rb_1;
        var startIndex = this.sb_1;
        var endIndex = (this.sb_1 + byteCount) | 0;
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var tmp = this_0;
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        arrayCopy(tmp, destination, 0, startIndex, endIndex);
      }
      prefix.tb_1 = (prefix.sb_1 + byteCount) | 0;
      this.sb_1 = (this.sb_1 + byteCount) | 0;
      if (!(this.xb_1 == null)) {
        ensureNotNull(this.xb_1).ec(prefix);
      } else {
        prefix.wb_1 = this;
        this.xb_1 = prefix;
      }
      return prefix;
    };
    protoOf(Segment).lc = function () {
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      if (!!(this.xb_1 == null)) {
        // Inline function 'kotlinx.io.Segment.compact.<anonymous>' call
        var message = "cannot compact";
        throw IllegalStateException_init_$Create$(toString(message));
      }
      if (!ensureNotNull(this.xb_1).vb_1) return this;
      var byteCount = (this.tb_1 - this.sb_1) | 0;
      var availableByteCount = (((8192 - ensureNotNull(this.xb_1).tb_1) | 0) + (ensureNotNull(this.xb_1).gc() ? 0 : ensureNotNull(this.xb_1).sb_1)) | 0;
      if (byteCount > availableByteCount) return this;
      var predecessor = this.xb_1;
      this.ic(ensureNotNull(predecessor), byteCount);
      var successor = this.kc();
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(successor == null)) {
        // Inline function 'kotlin.check.<anonymous>' call
        var message_0 = "Check failed.";
        throw IllegalStateException_init_$Create$(toString(message_0));
      }
      SegmentPool_instance.pc(this);
      return predecessor;
    };
    protoOf(Segment).nc = function (byte) {
      var _unary__edvuaz = this.tb_1;
      this.tb_1 = (_unary__edvuaz + 1) | 0;
      this.rb_1[_unary__edvuaz] = byte;
    };
    protoOf(Segment).ic = function (sink, byteCount) {
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      if (!sink.vb_1) {
        // Inline function 'kotlinx.io.Segment.writeTo.<anonymous>' call
        var message = "only owner can write";
        throw IllegalStateException_init_$Create$(toString(message));
      }
      if (((sink.tb_1 + byteCount) | 0) > 8192) {
        if (sink.gc()) throw IllegalArgumentException_init_$Create$_0();
        if (((((sink.tb_1 + byteCount) | 0) - sink.sb_1) | 0) > 8192) throw IllegalArgumentException_init_$Create$_0();
        // Inline function 'kotlin.collections.copyInto' call
        var this_0 = sink.rb_1;
        var destination = sink.rb_1;
        var startIndex = sink.sb_1;
        var endIndex = sink.tb_1;
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        var tmp = this_0;
        // Inline function 'kotlin.js.unsafeCast' call
        // Inline function 'kotlin.js.asDynamic' call
        arrayCopy(tmp, destination, 0, startIndex, endIndex);
        sink.tb_1 = (sink.tb_1 - sink.sb_1) | 0;
        sink.sb_1 = 0;
      }
      // Inline function 'kotlin.collections.copyInto' call
      var this_1 = this.rb_1;
      var destination_0 = sink.rb_1;
      var destinationOffset = sink.tb_1;
      var startIndex_0 = this.sb_1;
      var endIndex_0 = (this.sb_1 + byteCount) | 0;
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.asDynamic' call
      var tmp_0 = this_1;
      // Inline function 'kotlin.js.unsafeCast' call
      // Inline function 'kotlin.js.asDynamic' call
      arrayCopy(tmp_0, destination_0, destinationOffset, startIndex_0, endIndex_0);
      sink.tb_1 = (sink.tb_1 + byteCount) | 0;
      this.sb_1 = (this.sb_1 + byteCount) | 0;
    };
    protoOf(Segment).jc = function () {
      return (this.tb_1 - this.sb_1) | 0;
    };
    protoOf(Segment).bd = function () {
      return (this.rb_1.length - this.tb_1) | 0;
    };
    protoOf(Segment).cd = function (readOnly) {
      return this.rb_1;
    };
    protoOf(Segment).dd = function (index) {
      return this.rb_1[(this.sb_1 + index) | 0];
    };
    protoOf(Segment).ed = function (index, value) {
      this.rb_1[(this.tb_1 + index) | 0] = value;
    };
    protoOf(Segment).fd = function (index, b0, b1) {
      var d = this.rb_1;
      var l = this.tb_1;
      d[(l + index) | 0] = b0;
      d[(((l + index) | 0) + 1) | 0] = b1;
    };
    protoOf(Segment).gd = function (index, b0, b1, b2) {
      var d = this.rb_1;
      var l = this.tb_1;
      d[(l + index) | 0] = b0;
      d[(((l + index) | 0) + 1) | 0] = b1;
      d[(((l + index) | 0) + 2) | 0] = b2;
    };
    protoOf(Segment).hd = function (index, b0, b1, b2, b3) {
      var d = this.rb_1;
      var l = this.tb_1;
      d[(l + index) | 0] = b0;
      d[(((l + index) | 0) + 1) | 0] = b1;
      d[(((l + index) | 0) + 2) | 0] = b2;
      d[(((l + index) | 0) + 3) | 0] = b3;
    };
    function Segment() {
      this.sb_1 = 0;
      this.tb_1 = 0;
      this.ub_1 = null;
      this.vb_1 = false;
      this.wb_1 = null;
      this.xb_1 = null;
    }
    function SegmentCopyTracker() {}
    function isEmpty(_this__u8e3s4) {
      return _this__u8e3s4.jc() === 0;
    }
    function AlwaysSharedCopyTracker() {
      AlwaysSharedCopyTracker_instance = this;
      SegmentCopyTracker.call(this);
    }
    protoOf(AlwaysSharedCopyTracker).xc = function () {
      return true;
    };
    protoOf(AlwaysSharedCopyTracker).ad = function () {
      return Unit_instance;
    };
    var AlwaysSharedCopyTracker_instance;
    function AlwaysSharedCopyTracker_getInstance() {
      if (AlwaysSharedCopyTracker_instance == null) new AlwaysSharedCopyTracker();
      return AlwaysSharedCopyTracker_instance;
    }
    function writeString(_this__u8e3s4, string, startIndex, endIndex) {
      startIndex = startIndex === VOID ? 0 : startIndex;
      endIndex = endIndex === VOID ? string.length : endIndex;
      // Inline function 'kotlinx.io.checkBounds' call
      var size = string.length;
      checkBounds(toLong(size), toLong(startIndex), toLong(endIndex));
      // Inline function 'kotlinx.io.writeToInternalBuffer' call
      // Inline function 'kotlinx.io.writeString.<anonymous>' call
      // Inline function 'kotlinx.io.commonWriteUtf8' call
      var this_0 = _this__u8e3s4.nb();
      var i = startIndex;
      while (i < endIndex) {
        // Inline function 'kotlin.code' call
        var p0 = i;
        var this_1 = charSequenceGet(string, p0);
        var c = Char__toInt_impl_vasixd(this_1);
        if (c < 128) {
          $l$block_0: {
            // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.writeToTail' call
            var tail = this_0.ac(1);
            // Inline function 'kotlinx.io.commonWriteUtf8.<anonymous>' call
            var ctx = get_SegmentWriteContextImpl();
            var segmentOffset = -i | 0;
            // Inline function 'kotlin.comparisons.minOf' call
            var b = (i + tail.bd()) | 0;
            var runLimit = Math.min(endIndex, b);
            var _unary__edvuaz = i;
            i = (_unary__edvuaz + 1) | 0;
            ctx.ld(tail, (segmentOffset + _unary__edvuaz) | 0, toByte(c));
            $l$loop: while (i < runLimit) {
              // Inline function 'kotlin.code' call
              var p0_0 = i;
              var this_2 = charSequenceGet(string, p0_0);
              c = Char__toInt_impl_vasixd(this_2);
              if (c >= 128) break $l$loop;
              var _unary__edvuaz_0 = i;
              i = (_unary__edvuaz_0 + 1) | 0;
              ctx.ld(tail, (segmentOffset + _unary__edvuaz_0) | 0, toByte(c));
            }
            var bytesWritten = (i + segmentOffset) | 0;
            if (bytesWritten === 1) {
              tail.tb_1 = (tail.tb_1 + bytesWritten) | 0;
              var tmp = this_0;
              // Inline function 'kotlin.Long.plus' call
              tmp.mb_1 = this_0.mb_1.z1(toLong(bytesWritten));
              break $l$block_0;
            }
            // Inline function 'kotlin.check' call
            // Inline function 'kotlin.contracts.contract' call
            if (!(0 <= bytesWritten ? bytesWritten <= tail.bd() : false)) {
              // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.writeToTail.<anonymous>' call
              var message = "Invalid number of bytes written: " + bytesWritten + ". Should be in 0.." + tail.bd();
              throw IllegalStateException_init_$Create$(toString(message));
            }
            if (!(bytesWritten === 0)) {
              tail.tb_1 = (tail.tb_1 + bytesWritten) | 0;
              var tmp_0 = this_0;
              // Inline function 'kotlin.Long.plus' call
              tmp_0.mb_1 = this_0.mb_1.z1(toLong(bytesWritten));
              break $l$block_0;
            }
            if (isEmpty(tail)) {
              this_0.qc();
            }
          }
        } else if (c < 2048) {
          $l$block_2: {
            // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.writeToTail' call
            var tail_0 = this_0.ac(2);
            // Inline function 'kotlinx.io.commonWriteUtf8.<anonymous>' call
            get_SegmentWriteContextImpl().kd(tail_0, 0, toByte((c >> 6) | 192), toByte((c & 63) | 128));
            var bytesWritten_0 = 2;
            if (bytesWritten_0 === 2) {
              tail_0.tb_1 = (tail_0.tb_1 + bytesWritten_0) | 0;
              var tmp_1 = this_0;
              // Inline function 'kotlin.Long.plus' call
              tmp_1.mb_1 = this_0.mb_1.z1(toLong(bytesWritten_0));
              break $l$block_2;
            }
            // Inline function 'kotlin.check' call
            // Inline function 'kotlin.contracts.contract' call
            if (!(0 <= bytesWritten_0 ? bytesWritten_0 <= tail_0.bd() : false)) {
              // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.writeToTail.<anonymous>' call
              var message_0 = "Invalid number of bytes written: " + bytesWritten_0 + ". Should be in 0.." + tail_0.bd();
              throw IllegalStateException_init_$Create$(toString(message_0));
            }
            if (!(bytesWritten_0 === 0)) {
              tail_0.tb_1 = (tail_0.tb_1 + bytesWritten_0) | 0;
              var tmp_2 = this_0;
              // Inline function 'kotlin.Long.plus' call
              tmp_2.mb_1 = this_0.mb_1.z1(toLong(bytesWritten_0));
              break $l$block_2;
            }
            if (isEmpty(tail_0)) {
              this_0.qc();
            }
          }
          i = (i + 1) | 0;
        } else if (c < 55296 || c > 57343) {
          $l$block_4: {
            // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.writeToTail' call
            var tail_1 = this_0.ac(3);
            // Inline function 'kotlinx.io.commonWriteUtf8.<anonymous>' call
            get_SegmentWriteContextImpl().jd(tail_1, 0, toByte((c >> 12) | 224), toByte(((c >> 6) & 63) | 128), toByte((c & 63) | 128));
            var bytesWritten_1 = 3;
            if (bytesWritten_1 === 3) {
              tail_1.tb_1 = (tail_1.tb_1 + bytesWritten_1) | 0;
              var tmp_3 = this_0;
              // Inline function 'kotlin.Long.plus' call
              tmp_3.mb_1 = this_0.mb_1.z1(toLong(bytesWritten_1));
              break $l$block_4;
            }
            // Inline function 'kotlin.check' call
            // Inline function 'kotlin.contracts.contract' call
            if (!(0 <= bytesWritten_1 ? bytesWritten_1 <= tail_1.bd() : false)) {
              // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.writeToTail.<anonymous>' call
              var message_1 = "Invalid number of bytes written: " + bytesWritten_1 + ". Should be in 0.." + tail_1.bd();
              throw IllegalStateException_init_$Create$(toString(message_1));
            }
            if (!(bytesWritten_1 === 0)) {
              tail_1.tb_1 = (tail_1.tb_1 + bytesWritten_1) | 0;
              var tmp_4 = this_0;
              // Inline function 'kotlin.Long.plus' call
              tmp_4.mb_1 = this_0.mb_1.z1(toLong(bytesWritten_1));
              break $l$block_4;
            }
            if (isEmpty(tail_1)) {
              this_0.qc();
            }
          }
          i = (i + 1) | 0;
        } else {
          var tmp_5;
          if (((i + 1) | 0) < endIndex) {
            // Inline function 'kotlin.code' call
            var p0_1 = (i + 1) | 0;
            var this_3 = charSequenceGet(string, p0_1);
            tmp_5 = Char__toInt_impl_vasixd(this_3);
          } else {
            tmp_5 = 0;
          }
          var low = tmp_5;
          if (c > 56319 || !(56320 <= low ? low <= 57343 : false)) {
            this_0.mc(63);
            i = (i + 1) | 0;
          } else {
            var codePoint = (65536 + (((c & 1023) << 10) | (low & 1023))) | 0;
            $l$block_6: {
              // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.writeToTail' call
              var tail_2 = this_0.ac(4);
              // Inline function 'kotlinx.io.commonWriteUtf8.<anonymous>' call
              get_SegmentWriteContextImpl().id(
                tail_2,
                0,
                toByte((codePoint >> 18) | 240),
                toByte(((codePoint >> 12) & 63) | 128),
                toByte(((codePoint >> 6) & 63) | 128),
                toByte((codePoint & 63) | 128),
              );
              var bytesWritten_2 = 4;
              if (bytesWritten_2 === 4) {
                tail_2.tb_1 = (tail_2.tb_1 + bytesWritten_2) | 0;
                var tmp_6 = this_0;
                // Inline function 'kotlin.Long.plus' call
                tmp_6.mb_1 = this_0.mb_1.z1(toLong(bytesWritten_2));
                break $l$block_6;
              }
              // Inline function 'kotlin.check' call
              // Inline function 'kotlin.contracts.contract' call
              if (!(0 <= bytesWritten_2 ? bytesWritten_2 <= tail_2.bd() : false)) {
                // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.writeToTail.<anonymous>' call
                var message_2 = "Invalid number of bytes written: " + bytesWritten_2 + ". Should be in 0.." + tail_2.bd();
                throw IllegalStateException_init_$Create$(toString(message_2));
              }
              if (!(bytesWritten_2 === 0)) {
                tail_2.tb_1 = (tail_2.tb_1 + bytesWritten_2) | 0;
                var tmp_7 = this_0;
                // Inline function 'kotlin.Long.plus' call
                tmp_7.mb_1 = this_0.mb_1.z1(toLong(bytesWritten_2));
                break $l$block_6;
              }
              if (isEmpty(tail_2)) {
                this_0.qc();
              }
            }
            i = (i + 2) | 0;
          }
        }
      }
      _this__u8e3s4.pb();
    }
    function FileSystem() {}
    function SystemFileSystemImpl() {}
    function FileMetadata(isRegularFile, isDirectory, size) {
      isRegularFile = isRegularFile === VOID ? false : isRegularFile;
      isDirectory = isDirectory === VOID ? false : isDirectory;
      size = size === VOID ? new Long(0, 0) : size;
      this.qd_1 = isRegularFile;
      this.rd_1 = isDirectory;
      this.sd_1 = size;
    }
    function removeTrailingSeparators(path, isWindows_) {
      isWindows_ = isWindows_ === VOID ? get_isWindows() : isWindows_;
      if (isWindows_) {
        var tmp;
        if (path.length > 1) {
          var tmp_0;
          if (charSequenceGet(path, 1) === _Char___init__impl__6a9atx(58)) {
            tmp_0 = 3;
          } else if (isUnc(path)) {
            tmp_0 = 2;
          } else {
            tmp_0 = 1;
          }
          tmp = tmp_0;
        } else {
          tmp = 1;
        }
        var limit = tmp;
        return removeTrailingSeparatorsWindows(limit, path);
      }
      return removeTrailingSeparatorsUnix(path);
    }
    function isUnc(path) {
      if (path.length < 2) return false;
      if (startsWith(path, "\\\\")) return true;
      if (startsWith(path, "//")) return true;
      return false;
    }
    function removeTrailingSeparatorsWindows(suffixLength, path) {
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(suffixLength >= 1)) {
        // Inline function 'kotlin.require.<anonymous>' call
        var message = "Failed requirement.";
        throw IllegalArgumentException_init_$Create$(toString(message));
      }
      var idx = path.length;
      $l$loop: while (idx > suffixLength) {
        var c = charSequenceGet(path, (idx - 1) | 0);
        if (!(c === _Char___init__impl__6a9atx(92)) && !(c === _Char___init__impl__6a9atx(47))) break $l$loop;
        idx = (idx - 1) | 0;
      }
      // Inline function 'kotlin.text.substring' call
      var endIndex = idx;
      // Inline function 'kotlin.js.asDynamic' call
      return path.substring(0, endIndex);
    }
    function removeTrailingSeparatorsUnix(path) {
      var idx = path.length;
      while (idx > 1 && charSequenceGet(path, (idx - 1) | 0) === _Char___init__impl__6a9atx(47)) {
        idx = (idx - 1) | 0;
      }
      // Inline function 'kotlin.text.substring' call
      var endIndex = idx;
      // Inline function 'kotlin.js.asDynamic' call
      return path.substring(0, endIndex);
    }
    function get_SegmentReadContextImpl() {
      _init_properties_UnsafeBufferOperations_kt__xw75gy();
      return SegmentReadContextImpl;
    }
    var SegmentReadContextImpl;
    function get_SegmentWriteContextImpl() {
      _init_properties_UnsafeBufferOperations_kt__xw75gy();
      return SegmentWriteContextImpl;
    }
    var SegmentWriteContextImpl;
    var BufferIterationContextImpl;
    function UnsafeBufferOperations() {}
    var UnsafeBufferOperations_instance;
    function UnsafeBufferOperations_getInstance() {
      return UnsafeBufferOperations_instance;
    }
    function SegmentReadContextImpl$1() {}
    protoOf(SegmentReadContextImpl$1).oc = function (segment, offset) {
      return segment.dd(offset);
    };
    function SegmentWriteContextImpl$1() {}
    protoOf(SegmentWriteContextImpl$1).ld = function (segment, offset, value) {
      segment.ed(offset, value);
    };
    protoOf(SegmentWriteContextImpl$1).kd = function (segment, offset, b0, b1) {
      segment.fd(offset, b0, b1);
    };
    protoOf(SegmentWriteContextImpl$1).jd = function (segment, offset, b0, b1, b2) {
      segment.gd(offset, b0, b1, b2);
    };
    protoOf(SegmentWriteContextImpl$1).id = function (segment, offset, b0, b1, b2, b3) {
      segment.hd(offset, b0, b1, b2, b3);
    };
    function BufferIterationContextImpl$1() {}
    protoOf(BufferIterationContextImpl$1).oc = function (segment, offset) {
      return get_SegmentReadContextImpl().oc(segment, offset);
    };
    var properties_initialized_UnsafeBufferOperations_kt_2xfgoc;
    function _init_properties_UnsafeBufferOperations_kt__xw75gy() {
      if (!properties_initialized_UnsafeBufferOperations_kt_2xfgoc) {
        properties_initialized_UnsafeBufferOperations_kt_2xfgoc = true;
        SegmentReadContextImpl = new SegmentReadContextImpl$1();
        SegmentWriteContextImpl = new SegmentWriteContextImpl$1();
        BufferIterationContextImpl = new BufferIterationContextImpl$1();
      }
    }
    function withCaughtException(block) {
      try {
        block();
        return null;
      } catch ($p) {
        if ($p instanceof Error) {
          var t = $p;
          return t;
        } else {
          throw $p;
        }
      }
    }
    function IOException_init_$Init$($this) {
      Exception_init_$Init$($this);
      IOException.call($this);
      return $this;
    }
    function IOException_init_$Create$() {
      var tmp = IOException_init_$Init$(objectCreate(protoOf(IOException)));
      captureStack(tmp, IOException_init_$Create$);
      return tmp;
    }
    function IOException_init_$Init$_0(message, $this) {
      Exception_init_$Init$_0(message, $this);
      IOException.call($this);
      return $this;
    }
    function IOException_init_$Create$_0(message) {
      var tmp = IOException_init_$Init$_0(message, objectCreate(protoOf(IOException)));
      captureStack(tmp, IOException_init_$Create$_0);
      return tmp;
    }
    function IOException_init_$Init$_1(message, cause, $this) {
      Exception_init_$Init$_1(message, cause, $this);
      IOException.call($this);
      return $this;
    }
    function IOException_init_$Create$_1(message, cause) {
      var tmp = IOException_init_$Init$_1(message, cause, objectCreate(protoOf(IOException)));
      captureStack(tmp, IOException_init_$Create$_1);
      return tmp;
    }
    function IOException() {
      captureStack(this, IOException);
    }
    function EOFException_init_$Init$($this) {
      IOException_init_$Init$($this);
      EOFException.call($this);
      return $this;
    }
    function EOFException_init_$Create$() {
      var tmp = EOFException_init_$Init$(objectCreate(protoOf(EOFException)));
      captureStack(tmp, EOFException_init_$Create$);
      return tmp;
    }
    function EOFException_init_$Init$_0(message, $this) {
      IOException_init_$Init$_0(message, $this);
      EOFException.call($this);
      return $this;
    }
    function EOFException_init_$Create$_0(message) {
      var tmp = EOFException_init_$Init$_0(message, objectCreate(protoOf(EOFException)));
      captureStack(tmp, EOFException_init_$Create$_0);
      return tmp;
    }
    function EOFException() {
      captureStack(this, EOFException);
    }
    function SegmentPool() {
      this.bc_1 = 0;
      this.cc_1 = 0;
    }
    protoOf(SegmentPool).dc = function () {
      return Companion_instance.wc();
    };
    protoOf(SegmentPool).pc = function (segment) {};
    protoOf(SegmentPool).zc = function () {
      return AlwaysSharedCopyTracker_getInstance();
    };
    var SegmentPool_instance;
    function SegmentPool_getInstance() {
      return SegmentPool_instance;
    }
    function get_path() {
      _init_properties_nodeModulesJs_kt__ngjjzw();
      // Inline function 'kotlin.getValue' call
      var this_0 = path$delegate;
      path$factory();
      return this_0.k1();
    }
    var path$delegate;
    function get_fs() {
      _init_properties_nodeModulesJs_kt__ngjjzw();
      // Inline function 'kotlin.getValue' call
      var this_0 = fs$delegate;
      fs$factory();
      return this_0.k1();
    }
    var fs$delegate;
    function get_os() {
      _init_properties_nodeModulesJs_kt__ngjjzw();
      // Inline function 'kotlin.getValue' call
      var this_0 = os$delegate;
      os$factory();
      return this_0.k1();
    }
    var os$delegate;
    function get_buffer() {
      _init_properties_nodeModulesJs_kt__ngjjzw();
      // Inline function 'kotlin.getValue' call
      var this_0 = buffer$delegate;
      buffer$factory();
      return this_0.k1();
    }
    var buffer$delegate;
    function path$delegate$lambda() {
      _init_properties_nodeModulesJs_kt__ngjjzw();
      var tmp;
      try {
        tmp = eval("require")("path");
      } catch ($p) {
        var tmp_0;
        if ($p instanceof Error) {
          var e = $p;
          throw UnsupportedOperationException_init_$Create$("Module 'path' could not be imported", e);
        } else {
          throw $p;
        }
      }
      return tmp;
    }
    function fs$delegate$lambda() {
      _init_properties_nodeModulesJs_kt__ngjjzw();
      var tmp;
      try {
        tmp = eval("require")("fs");
      } catch ($p) {
        var tmp_0;
        if ($p instanceof Error) {
          var e = $p;
          throw UnsupportedOperationException_init_$Create$("Module 'fs' could not be imported", e);
        } else {
          throw $p;
        }
      }
      return tmp;
    }
    function os$delegate$lambda() {
      _init_properties_nodeModulesJs_kt__ngjjzw();
      var tmp;
      try {
        tmp = eval("require")("os");
      } catch ($p) {
        var tmp_0;
        if ($p instanceof Error) {
          var e = $p;
          throw UnsupportedOperationException_init_$Create$("Module 'os' could not be imported", e);
        } else {
          throw $p;
        }
      }
      return tmp;
    }
    function buffer$delegate$lambda() {
      _init_properties_nodeModulesJs_kt__ngjjzw();
      var tmp;
      try {
        tmp = eval("require")("buffer");
      } catch ($p) {
        var tmp_0;
        if ($p instanceof Error) {
          var e = $p;
          throw UnsupportedOperationException_init_$Create$("Module 'buffer' could not be imported", e);
        } else {
          throw $p;
        }
      }
      return tmp;
    }
    function path$factory() {
      return getPropertyCallableRef(
        "path",
        0,
        KProperty0,
        function () {
          return get_path();
        },
        null,
      );
    }
    function fs$factory() {
      return getPropertyCallableRef(
        "fs",
        0,
        KProperty0,
        function () {
          return get_fs();
        },
        null,
      );
    }
    function os$factory() {
      return getPropertyCallableRef(
        "os",
        0,
        KProperty0,
        function () {
          return get_os();
        },
        null,
      );
    }
    function buffer$factory() {
      return getPropertyCallableRef(
        "buffer",
        0,
        KProperty0,
        function () {
          return get_buffer();
        },
        null,
      );
    }
    var properties_initialized_nodeModulesJs_kt_oooz8e;
    function _init_properties_nodeModulesJs_kt__ngjjzw() {
      if (!properties_initialized_nodeModulesJs_kt_oooz8e) {
        properties_initialized_nodeModulesJs_kt_oooz8e = true;
        path$delegate = lazy(path$delegate$lambda);
        fs$delegate = lazy(fs$delegate$lambda);
        os$delegate = lazy(os$delegate$lambda);
        buffer$delegate = lazy(buffer$delegate$lambda);
      }
    }
    function get_SystemFileSystem() {
      _init_properties_FileSystemNodeJs_kt__m4c3u();
      return SystemFileSystem;
    }
    var SystemFileSystem;
    function get_isWindows() {
      _init_properties_FileSystemNodeJs_kt__m4c3u();
      return isWindows;
    }
    var isWindows;
    function SystemFileSystem$o$metadataOrNull$lambda($path, $metadata) {
      return function () {
        var tmp0_elvis_lhs = get_fs().statSync($path.td_1);
        var tmp;
        if (tmp0_elvis_lhs == null) {
          return Unit_instance;
        } else {
          tmp = tmp0_elvis_lhs;
        }
        var stat = tmp;
        var mode = stat.mode;
        var isFile = (mode & get_fs().constants.S_IFMT) === get_fs().constants.S_IFREG;
        $metadata._v = new FileMetadata(
          isFile,
          (mode & get_fs().constants.S_IFMT) === get_fs().constants.S_IFDIR,
          isFile ? toLong(stat.size) : new Long(-1, -1),
        );
        return Unit_instance;
      };
    }
    function SystemFileSystem$1() {
      SystemFileSystemImpl.call(this);
    }
    protoOf(SystemFileSystem$1).ud = function (path) {
      return get_fs().existsSync(path.td_1);
    };
    protoOf(SystemFileSystem$1).md = function (path, mustCreate) {
      var metadata = this.vd(path);
      if (!(metadata == null)) {
        if (mustCreate) {
          throw IOException_init_$Create$_0("Path already exists: " + path.toString());
        }
        if (metadata.qd_1) {
          throw IOException_init_$Create$_0("Path already exists and it's a file: " + path.toString());
        }
        return Unit_instance;
      }
      // Inline function 'kotlin.collections.arrayListOf' call
      var parts = ArrayList_init_$Create$();
      var p = path;
      while (!(p == null) && !this.ud(p)) {
        parts.r2(p.toString());
        p = p.wd();
      }
      // Inline function 'kotlin.collections.forEach' call
      var tmp0_iterator = asReversed(parts).l();
      while (tmp0_iterator.m()) {
        var element = tmp0_iterator.n();
        // Inline function 'kotlinx.io.files.<no name provided>.createDirectories.<anonymous>' call
        get_fs().mkdirSync(element);
      }
    };
    protoOf(SystemFileSystem$1).vd = function (path) {
      if (!this.ud(path)) return null;
      var metadata = { _v: null };
      var tmp2_safe_receiver = withCaughtException(SystemFileSystem$o$metadataOrNull$lambda(path, metadata));
      if (tmp2_safe_receiver == null) null;
      else {
        // Inline function 'kotlin.also' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlinx.io.files.<no name provided>.metadataOrNull.<anonymous>' call
        throw IOException_init_$Create$_1("Stat failed for " + path.toString(), tmp2_safe_receiver);
      }
      return metadata._v;
    };
    protoOf(SystemFileSystem$1).od = function (path, append) {
      return new FileSink(path, append);
    };
    var properties_initialized_FileSystemNodeJs_kt_vmmd20;
    function _init_properties_FileSystemNodeJs_kt__m4c3u() {
      if (!properties_initialized_FileSystemNodeJs_kt_vmmd20) {
        properties_initialized_FileSystemNodeJs_kt_vmmd20 = true;
        SystemFileSystem = new SystemFileSystem$1();
        isWindows = get_os().platform() === "win32";
      }
    }
    function get_SystemPathSeparator() {
      _init_properties_PathsNodeJs_kt__bvvvsp();
      // Inline function 'kotlin.getValue' call
      var this_0 = SystemPathSeparator$delegate;
      SystemPathSeparator$factory();
      return this_0.k1().v_1;
    }
    var SystemPathSeparator$delegate;
    function Path(rawPath, any) {
      this.td_1 = removeTrailingSeparators(rawPath);
    }
    protoOf(Path).wd = function () {
      // Inline function 'kotlin.text.isEmpty' call
      var this_0 = this.td_1;
      if (charSequenceLength(this_0) === 0) return null;
      if (get_isWindows()) {
        if (!contains(this.td_1, _Char___init__impl__6a9atx(47)) && !contains(this.td_1, _Char___init__impl__6a9atx(92))) {
          return null;
        }
      } else if (!contains(this.td_1, get_SystemPathSeparator())) {
        return null;
      }
      var p = get_path().dirname(this.td_1);
      var tmp;
      // Inline function 'kotlin.text.isEmpty' call
      if (charSequenceLength(p) === 0) {
        tmp = null;
      } else {
        if (p === this.td_1) {
          tmp = null;
        } else {
          tmp = Path_0(p);
        }
      }
      return tmp;
    };
    protoOf(Path).toString = function () {
      return this.td_1;
    };
    protoOf(Path).equals = function (other) {
      if (this === other) return true;
      if (!(other instanceof Path)) return false;
      return this.td_1 === other.td_1;
    };
    protoOf(Path).hashCode = function () {
      return getStringHashCode(this.td_1);
    };
    function open($this, path, append) {
      var flags = append ? "a" : "w";
      var fd = { _v: -1 };
      var tmp5_safe_receiver = withCaughtException(FileSink$open$lambda(fd, path, flags));
      if (tmp5_safe_receiver == null) null;
      else {
        // Inline function 'kotlin.also' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlinx.io.files.FileSink.open.<anonymous>' call
        throw IOException_init_$Create$_1("Failed to open a file " + path.td_1 + ".", tmp5_safe_receiver);
      }
      if (fd._v < 0) throw IOException_init_$Create$_0("Failed to open a file " + path.td_1 + ".");
      return fd._v;
    }
    function FileSink$open$lambda($fd, $path, $flags) {
      return function () {
        $fd._v = get_fs().openSync($path.td_1, $flags);
        return Unit_instance;
      };
    }
    function FileSink$write$lambda(this$0, $buf) {
      return function () {
        get_fs().writeFileSync(this$0.yd_1, $buf);
        return Unit_instance;
      };
    }
    function FileSink(path, append) {
      this.xd_1 = false;
      this.yd_1 = open(this, path, append);
    }
    protoOf(FileSink).fc = function (source, byteCount) {
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      if (!!this.xd_1) {
        // Inline function 'kotlinx.io.files.FileSink.write.<anonymous>' call
        var message = "Sink is closed.";
        throw IllegalStateException_init_$Create$(toString(message));
      }
      if (byteCount.equals(new Long(0, 0))) {
        return Unit_instance;
      }
      // Inline function 'kotlin.comparisons.minOf' call
      var b = source.p();
      var remainingBytes = byteCount.y1(b) <= 0 ? byteCount : b;
      while (remainingBytes.y1(new Long(0, 0)) > 0) {
        var segmentBytes = 0;
        // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.readFromHead' call
        // Inline function 'kotlin.require' call
        // Inline function 'kotlin.contracts.contract' call
        if (!!source.ob()) {
          // Inline function 'kotlinx.io.unsafe.UnsafeBufferOperations.readFromHead.<anonymous>' call
          var message_0 = "Buffer is empty";
          throw IllegalArgumentException_init_$Create$(toString(message_0));
        }
        var head = ensureNotNull(source.kb_1);
        // Inline function 'kotlinx.io.files.FileSink.write.<anonymous>' call
        var headData = head.cd(true);
        var headPos = head.sb_1;
        segmentBytes = (head.tb_1 - headPos) | 0;
        var buf = get_buffer().Buffer.allocUnsafe(segmentBytes);
        var inductionVariable = 0;
        var last = segmentBytes;
        if (inductionVariable < last)
          do {
            var offset = inductionVariable;
            inductionVariable = (inductionVariable + 1) | 0;
            buf.writeInt8(headData[(headPos + offset) | 0], offset);
          } while (inductionVariable < last);
        var tmp6_safe_receiver = withCaughtException(FileSink$write$lambda(this, buf));
        if (tmp6_safe_receiver == null) null;
        else {
          // Inline function 'kotlin.also' call
          // Inline function 'kotlin.contracts.contract' call
          // Inline function 'kotlinx.io.files.FileSink.write.<anonymous>.<anonymous>' call
          throw IOException_init_$Create$_1("Write failed", tmp6_safe_receiver);
        }
        var bytesRead = segmentBytes;
        if (!(bytesRead === 0)) {
          if (bytesRead < 0) throw IllegalStateException_init_$Create$("Returned negative read bytes count");
          if (bytesRead > head.jc()) throw IllegalStateException_init_$Create$("Returned too many bytes");
          source.yb(toLong(bytesRead));
        }
        // Inline function 'kotlin.Long.minus' call
        var this_0 = remainingBytes;
        var other = segmentBytes;
        remainingBytes = this_0.a2(toLong(other));
      }
    };
    function Path_0(path) {
      _init_properties_PathsNodeJs_kt__bvvvsp();
      return new Path(path, null);
    }
    function SystemPathSeparator$delegate$lambda() {
      _init_properties_PathsNodeJs_kt__bvvvsp();
      var sep = get_path().sep;
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlin.check' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(sep.length === 1)) {
        // Inline function 'kotlin.check.<anonymous>' call
        var message = "Check failed.";
        throw IllegalStateException_init_$Create$(toString(message));
      }
      return new Char(charSequenceGet(sep, 0));
    }
    function SystemPathSeparator$factory() {
      return getPropertyCallableRef(
        "SystemPathSeparator",
        0,
        KProperty0,
        function () {
          return new Char(get_SystemPathSeparator());
        },
        null,
      );
    }
    var properties_initialized_PathsNodeJs_kt_2u5gc7;
    function _init_properties_PathsNodeJs_kt__bvvvsp() {
      if (!properties_initialized_PathsNodeJs_kt_2u5gc7) {
        properties_initialized_PathsNodeJs_kt_2u5gc7 = true;
        SystemPathSeparator$delegate = lazy(SystemPathSeparator$delegate$lambda);
      }
    }
    //region block: post-declaration
    protoOf(SystemFileSystemImpl).nd = createDirectories$default;
    protoOf(SystemFileSystemImpl).pd = sink$default;
    //endregion
    //region block: init
    Companion_instance = new Companion();
    UnsafeBufferOperations_instance = new UnsafeBufferOperations();
    SegmentPool_instance = new SegmentPool();
    //endregion
    //region block: exports
    _.$_$ = _.$_$ || {};
    _.$_$.a = Path_0;
    _.$_$.b = get_SystemFileSystem;
    _.$_$.c = buffered;
    _.$_$.d = writeString;
    //endregion
    return _;
  })({}, kotlin_kotlin);

  //# sourceMappingURL=kotlinx-io-kotlinx-io-core.js.map
  var kotlin_org_jetbrains_kotlinx_atomicfu = (function (_, kotlin_kotlin) {
    "use strict";
    //region block: imports
    var fillArrayVal = kotlin_kotlin.$_$.q2;
    var protoOf = kotlin_kotlin.$_$.o3;
    var defineProp = kotlin_kotlin.$_$.o2;
    var initMetadataForClass = kotlin_kotlin.$_$.w2;
    var initMetadataForObject = kotlin_kotlin.$_$.z2;
    var VOID = kotlin_kotlin.$_$.c;
    var toString = kotlin_kotlin.$_$.g5;
    //endregion
    //region block: pre-declaration
    initMetadataForClass(atomicfu$AtomicRefArray$ref, "AtomicArray");
    initMetadataForClass(atomicfu$TraceBase, "TraceBase");
    initMetadataForObject(None, "None", VOID, atomicfu$TraceBase);
    initMetadataForClass(AtomicRef, "AtomicRef");
    initMetadataForClass(AtomicLong, "AtomicLong");
    initMetadataForClass(AtomicInt, "AtomicInt");
    //endregion
    function atomicfu$AtomicRefArray$ref(size) {
      var tmp = this;
      var tmp_0 = 0;
      // Inline function 'kotlin.arrayOfNulls' call
      var tmp_1 = fillArrayVal(Array(size), null);
      while (tmp_0 < size) {
        tmp_1[tmp_0] = atomic$ref$1(null);
        tmp_0 = (tmp_0 + 1) | 0;
      }
      tmp.j9_1 = tmp_1;
    }
    protoOf(atomicfu$AtomicRefArray$ref).k9 = function () {
      return this.j9_1.length;
    };
    protoOf(atomicfu$AtomicRefArray$ref).atomicfu$get = function (index) {
      return this.j9_1[index];
    };
    function atomicfu$AtomicRefArray$ofNulls(size) {
      return new atomicfu$AtomicRefArray$ref(size);
    }
    function None() {
      None_instance = this;
      atomicfu$TraceBase.call(this);
    }
    var None_instance;
    function None_getInstance() {
      if (None_instance == null) new None();
      return None_instance;
    }
    function atomicfu$TraceBase() {}
    protoOf(atomicfu$TraceBase).atomicfu$Trace$append$1 = function (event) {};
    protoOf(atomicfu$TraceBase).atomicfu$Trace$append$2 = function (event1, event2) {};
    protoOf(atomicfu$TraceBase).atomicfu$Trace$append$3 = function (event1, event2, event3) {};
    protoOf(atomicfu$TraceBase).atomicfu$Trace$append$4 = function (event1, event2, event3, event4) {};
    function AtomicRef(value) {
      this.kotlinx$atomicfu$value = value;
    }
    protoOf(AtomicRef).l9 = function (_set____db54di) {
      this.kotlinx$atomicfu$value = _set____db54di;
    };
    protoOf(AtomicRef).m9 = function () {
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicRef).atomicfu$compareAndSet = function (expect, update) {
      if (!(this.kotlinx$atomicfu$value === expect)) return false;
      this.kotlinx$atomicfu$value = update;
      return true;
    };
    protoOf(AtomicRef).atomicfu$getAndSet = function (value) {
      var oldValue = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = value;
      return oldValue;
    };
    protoOf(AtomicRef).toString = function () {
      return toString(this.kotlinx$atomicfu$value);
    };
    function atomic$ref$1(initial) {
      return atomic$ref$(initial, None_getInstance());
    }
    function AtomicLong(value) {
      this.kotlinx$atomicfu$value = value;
    }
    protoOf(AtomicLong).n9 = function (_set____db54di) {
      this.kotlinx$atomicfu$value = _set____db54di;
    };
    protoOf(AtomicLong).m9 = function () {
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicLong).atomicfu$compareAndSet = function (expect, update) {
      if (!this.kotlinx$atomicfu$value.equals(expect)) return false;
      this.kotlinx$atomicfu$value = update;
      return true;
    };
    protoOf(AtomicLong).atomicfu$getAndSet = function (value) {
      var oldValue = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = value;
      return oldValue;
    };
    protoOf(AtomicLong).atomicfu$getAndIncrement$long = function () {
      var _unary__edvuaz = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = _unary__edvuaz.e2();
      return _unary__edvuaz;
    };
    protoOf(AtomicLong).atomicfu$getAndDecrement$long = function () {
      var _unary__edvuaz = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = _unary__edvuaz.f2();
      return _unary__edvuaz;
    };
    protoOf(AtomicLong).atomicfu$getAndAdd$long = function (delta) {
      var oldValue = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = this.kotlinx$atomicfu$value.z1(delta);
      return oldValue;
    };
    protoOf(AtomicLong).atomicfu$addAndGet$long = function (delta) {
      this.kotlinx$atomicfu$value = this.kotlinx$atomicfu$value.z1(delta);
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicLong).atomicfu$incrementAndGet$long = function () {
      this.kotlinx$atomicfu$value = this.kotlinx$atomicfu$value.e2();
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicLong).atomicfu$decrementAndGet$long = function () {
      this.kotlinx$atomicfu$value = this.kotlinx$atomicfu$value.f2();
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicLong).toString = function () {
      return this.kotlinx$atomicfu$value.toString();
    };
    function atomic$long$1(initial) {
      return atomic$long$(initial, None_getInstance());
    }
    function AtomicInt(value) {
      this.kotlinx$atomicfu$value = value;
    }
    protoOf(AtomicInt).o9 = function (_set____db54di) {
      this.kotlinx$atomicfu$value = _set____db54di;
    };
    protoOf(AtomicInt).m9 = function () {
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicInt).atomicfu$compareAndSet = function (expect, update) {
      if (!(this.kotlinx$atomicfu$value === expect)) return false;
      this.kotlinx$atomicfu$value = update;
      return true;
    };
    protoOf(AtomicInt).atomicfu$getAndSet = function (value) {
      var oldValue = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = value;
      return oldValue;
    };
    protoOf(AtomicInt).atomicfu$getAndIncrement = function () {
      var _unary__edvuaz = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = (_unary__edvuaz + 1) | 0;
      return _unary__edvuaz;
    };
    protoOf(AtomicInt).atomicfu$getAndDecrement = function () {
      var _unary__edvuaz = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = (_unary__edvuaz - 1) | 0;
      return _unary__edvuaz;
    };
    protoOf(AtomicInt).atomicfu$getAndAdd = function (delta) {
      var oldValue = this.kotlinx$atomicfu$value;
      this.kotlinx$atomicfu$value = (this.kotlinx$atomicfu$value + delta) | 0;
      return oldValue;
    };
    protoOf(AtomicInt).atomicfu$addAndGet = function (delta) {
      this.kotlinx$atomicfu$value = (this.kotlinx$atomicfu$value + delta) | 0;
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicInt).atomicfu$incrementAndGet = function () {
      this.kotlinx$atomicfu$value = (this.kotlinx$atomicfu$value + 1) | 0;
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicInt).atomicfu$decrementAndGet = function () {
      this.kotlinx$atomicfu$value = (this.kotlinx$atomicfu$value - 1) | 0;
      return this.kotlinx$atomicfu$value;
    };
    protoOf(AtomicInt).toString = function () {
      return this.kotlinx$atomicfu$value.toString();
    };
    function atomic$int$1(initial) {
      return atomic$int$(initial, None_getInstance());
    }
    function atomic$ref$(initial, trace) {
      trace = trace === VOID ? None_getInstance() : trace;
      return new AtomicRef(initial);
    }
    function atomic$long$(initial, trace) {
      trace = trace === VOID ? None_getInstance() : trace;
      return new AtomicLong(initial);
    }
    function atomic$int$(initial, trace) {
      trace = trace === VOID ? None_getInstance() : trace;
      return new AtomicInt(initial);
    }
    //region block: post-declaration
    defineProp(protoOf(atomicfu$AtomicRefArray$ref), "atomicfu$size", protoOf(atomicfu$AtomicRefArray$ref).k9);
    //endregion
    //region block: exports
    _.$_$ = _.$_$ || {};
    _.$_$.a = atomicfu$AtomicRefArray$ofNulls;
    _.$_$.b = atomic$long$1;
    _.$_$.c = atomic$ref$1;
    _.$_$.d = atomic$int$1;
    //endregion
    return _;
  })({}, kotlin_kotlin);

  //# sourceMappingURL=kotlinx-atomicfu.js.map
  var kotlin_org_jetbrains_kotlinx_kotlinx_coroutines_core = (function (_, kotlin_kotlin, kotlin_org_jetbrains_kotlinx_atomicfu) {
    "use strict";
    //region block: imports
    var protoOf = kotlin_kotlin.$_$.o3;
    var initMetadataForInterface = kotlin_kotlin.$_$.y2;
    var atomic$int$1 = kotlin_org_jetbrains_kotlinx_atomicfu.$_$.d;
    var Unit_instance = kotlin_kotlin.$_$.y;
    var initMetadataForClass = kotlin_kotlin.$_$.w2;
    var VOID = kotlin_kotlin.$_$.c;
    var THROW_CCE = kotlin_kotlin.$_$.y4;
    var toString = kotlin_kotlin.$_$.r3;
    var IllegalStateException_init_$Create$ = kotlin_kotlin.$_$.n;
    var ensureNotNull = kotlin_kotlin.$_$.b5;
    var atomic$ref$1 = kotlin_org_jetbrains_kotlinx_atomicfu.$_$.c;
    var toLong = kotlin_kotlin.$_$.q3;
    var Long = kotlin_kotlin.$_$.w4;
    var toLongOrNull = kotlin_kotlin.$_$.m4;
    var toString_0 = kotlin_kotlin.$_$.g5;
    var isInterface = kotlin_kotlin.$_$.g3;
    var atomic$long$1 = kotlin_org_jetbrains_kotlinx_atomicfu.$_$.b;
    var IllegalArgumentException_init_$Create$ = kotlin_kotlin.$_$.m;
    var atomicfu$AtomicRefArray$ofNulls = kotlin_org_jetbrains_kotlinx_atomicfu.$_$.a;
    var hashCode = kotlin_kotlin.$_$.v2;
    //endregion
    //region block: pre-declaration
    initMetadataForInterface(CancellableContinuation, "CancellableContinuation");
    initMetadataForInterface(Waiter, "Waiter");
    initMetadataForClass(ConcurrentLinkedListNode, "ConcurrentLinkedListNode");
    initMetadataForClass(Segment, "Segment", VOID, ConcurrentLinkedListNode);
    initMetadataForClass(Symbol, "Symbol");
    initMetadataForInterface(SelectInstance, "SelectInstance");
    initMetadataForClass(SemaphoreAndMutexImpl, "SemaphoreAndMutexImpl", VOID, VOID, VOID, [0]);
    initMetadataForClass(MutexImpl, "MutexImpl", VOID, SemaphoreAndMutexImpl, VOID, [1, 0]);
    initMetadataForClass(SemaphoreSegment, "SemaphoreSegment", VOID, Segment);
    //endregion
    function CancellableContinuation() {}
    function Waiter() {}
    function get_CLOSED() {
      _init_properties_ConcurrentLinkedList_kt__5gcgzy();
      return CLOSED;
    }
    var CLOSED;
    function Segment(id, prev, pointers) {
      ConcurrentLinkedListNode.call(this, prev);
      this.v9_1 = id;
      this.w9_1 = atomic$int$1(pointers << 16);
    }
    protoOf(Segment).y9 = function () {
      return this.w9_1.kotlinx$atomicfu$value === this.x9() && !this.ba();
    };
    protoOf(Segment).ca = function () {
      var tmp$ret$1;
      $l$block_0: {
        // Inline function 'kotlinx.coroutines.internal.addConditionally' call
        var this_0 = this.w9_1;
        while (true) {
          var cur = this_0.kotlinx$atomicfu$value;
          // Inline function 'kotlinx.coroutines.internal.Segment.tryIncPointers.<anonymous>' call
          if (!(!(cur === this.x9()) || this.ba())) {
            tmp$ret$1 = false;
            break $l$block_0;
          }
          if (this_0.atomicfu$compareAndSet(cur, (cur + 65536) | 0)) {
            tmp$ret$1 = true;
            break $l$block_0;
          }
        }
      }
      return tmp$ret$1;
    };
    protoOf(Segment).da = function () {
      return this.w9_1.atomicfu$addAndGet(-65536) === this.x9() && !this.ba();
    };
    function _SegmentOrClosed___init__impl__jnexvb(value) {
      return value;
    }
    function _get_value__a43j40($this) {
      return $this;
    }
    function _SegmentOrClosed___get_isClosed__impl__qmxmlo($this) {
      return _get_value__a43j40($this) === get_CLOSED();
    }
    function _SegmentOrClosed___get_segment__impl__jvcr9l($this) {
      var tmp;
      if (_get_value__a43j40($this) === get_CLOSED()) {
        var message = "Does not contain segment";
        throw IllegalStateException_init_$Create$(toString(message));
      } else {
        var tmp_0 = _get_value__a43j40($this);
        tmp = tmp_0 instanceof Segment ? tmp_0 : THROW_CCE();
      }
      return tmp;
    }
    function _get_nextOrClosed__w0gmuv($this) {
      return $this.z9_1.kotlinx$atomicfu$value;
    }
    function _get_aliveSegmentLeft__mr4ndu($this) {
      var cur = $this.ga();
      while (!(cur === null) && cur.y9()) cur = cur.aa_1.kotlinx$atomicfu$value;
      return cur;
    }
    function _get_aliveSegmentRight__7ulr0b($this) {
      // Inline function 'kotlinx.coroutines.assert' call
      var cur = ensureNotNull($this.ea());
      while (cur.y9()) {
        var tmp0_elvis_lhs = cur.ea();
        var tmp;
        if (tmp0_elvis_lhs == null) {
          return cur;
        } else {
          tmp = tmp0_elvis_lhs;
        }
        cur = tmp;
      }
      return cur;
    }
    function ConcurrentLinkedListNode(prev) {
      this.z9_1 = atomic$ref$1(null);
      this.aa_1 = atomic$ref$1(prev);
    }
    protoOf(ConcurrentLinkedListNode).ea = function () {
      // Inline function 'kotlinx.coroutines.internal.ConcurrentLinkedListNode.nextOrIfClosed' call
      // Inline function 'kotlin.let' call
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'kotlinx.coroutines.internal.ConcurrentLinkedListNode.nextOrIfClosed.<anonymous>' call
      var it = _get_nextOrClosed__w0gmuv(this);
      var tmp;
      if (it === get_CLOSED()) {
        // Inline function 'kotlinx.coroutines.internal.ConcurrentLinkedListNode.<get-next>.<anonymous>' call
        return null;
      } else {
        tmp = (it == null ? true : it instanceof ConcurrentLinkedListNode) ? it : THROW_CCE();
      }
      return tmp;
    };
    protoOf(ConcurrentLinkedListNode).fa = function (value) {
      return this.z9_1.atomicfu$compareAndSet(null, value);
    };
    protoOf(ConcurrentLinkedListNode).ba = function () {
      return this.ea() == null;
    };
    protoOf(ConcurrentLinkedListNode).ga = function () {
      return this.aa_1.kotlinx$atomicfu$value;
    };
    protoOf(ConcurrentLinkedListNode).ha = function () {
      // Inline function 'kotlinx.atomicfu.AtomicRef.lazySet' call
      this.aa_1.kotlinx$atomicfu$value = null;
    };
    protoOf(ConcurrentLinkedListNode).w2 = function () {
      // Inline function 'kotlinx.coroutines.assert' call
      if (this.ba()) return Unit_instance;
      $l$loop_0: while (true) {
        var prev = _get_aliveSegmentLeft__mr4ndu(this);
        var next = _get_aliveSegmentRight__7ulr0b(this);
        $l$block: {
          // Inline function 'kotlinx.atomicfu.update' call
          var this_0 = next.aa_1;
          while (true) {
            var cur = this_0.kotlinx$atomicfu$value;
            // Inline function 'kotlinx.coroutines.internal.ConcurrentLinkedListNode.remove.<anonymous>' call
            var upd = cur === null ? null : prev;
            if (this_0.atomicfu$compareAndSet(cur, upd)) {
              break $l$block;
            }
          }
        }
        if (!(prev === null)) prev.z9_1.kotlinx$atomicfu$value = next;
        if (next.y9() && !next.ba()) continue $l$loop_0;
        if (!(prev === null) && prev.y9()) continue $l$loop_0;
        return Unit_instance;
      }
    };
    function findSegmentInternal(_this__u8e3s4, id, createNewSegment) {
      _init_properties_ConcurrentLinkedList_kt__5gcgzy();
      var cur = _this__u8e3s4;
      $l$loop: while (cur.v9_1.y1(id) < 0 || cur.y9()) {
        // Inline function 'kotlinx.coroutines.internal.ConcurrentLinkedListNode.nextOrIfClosed' call
        var this_0 = cur;
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'kotlinx.coroutines.internal.ConcurrentLinkedListNode.nextOrIfClosed.<anonymous>' call
        var it = _get_nextOrClosed__w0gmuv(this_0);
        var tmp;
        if (it === get_CLOSED()) {
          // Inline function 'kotlinx.coroutines.internal.findSegmentInternal.<anonymous>' call
          return _SegmentOrClosed___init__impl__jnexvb(get_CLOSED());
        } else {
          tmp = (it == null ? true : it instanceof ConcurrentLinkedListNode) ? it : THROW_CCE();
        }
        var next = tmp;
        if (!(next == null)) {
          cur = next;
          continue $l$loop;
        }
        // Inline function 'kotlin.Long.plus' call
        var newTail = createNewSegment(cur.v9_1.z1(toLong(1)), cur);
        if (cur.fa(newTail)) {
          if (cur.y9()) {
            cur.w2();
          }
          cur = newTail;
        }
      }
      return _SegmentOrClosed___init__impl__jnexvb(cur);
    }
    var properties_initialized_ConcurrentLinkedList_kt_kwt434;
    function _init_properties_ConcurrentLinkedList_kt__5gcgzy() {
      if (!properties_initialized_ConcurrentLinkedList_kt_kwt434) {
        properties_initialized_ConcurrentLinkedList_kt_kwt434 = true;
        CLOSED = new Symbol("CLOSED");
      }
    }
    function Symbol(symbol) {
      this.ia_1 = symbol;
    }
    protoOf(Symbol).toString = function () {
      return "<" + this.ia_1 + ">";
    };
    function systemProp(propertyName, defaultValue, minValue, maxValue) {
      minValue = minValue === VOID ? 1 : minValue;
      maxValue = maxValue === VOID ? 2147483647 : maxValue;
      return systemProp_0(propertyName, toLong(defaultValue), toLong(minValue), toLong(maxValue)).i2();
    }
    function systemProp_0(propertyName, defaultValue, minValue, maxValue) {
      minValue = minValue === VOID ? new Long(1, 0) : minValue;
      maxValue = maxValue === VOID ? new Long(-1, 2147483647) : maxValue;
      var tmp0_elvis_lhs = systemProp_1(propertyName);
      var tmp;
      if (tmp0_elvis_lhs == null) {
        return defaultValue;
      } else {
        tmp = tmp0_elvis_lhs;
      }
      var value = tmp;
      var tmp1_elvis_lhs = toLongOrNull(value);
      var tmp_0;
      if (tmp1_elvis_lhs == null) {
        var message = "System property '" + propertyName + "' has unrecognized value '" + value + "'";
        throw IllegalStateException_init_$Create$(toString(message));
      } else {
        tmp_0 = tmp1_elvis_lhs;
      }
      var parsed = tmp_0;
      if (!(minValue.y1(parsed) <= 0 ? parsed.y1(maxValue) <= 0 : false)) {
        // Inline function 'kotlin.error' call
        var message_0 =
          "System property '" +
          propertyName +
          "' should be in range " +
          minValue.toString() +
          ".." +
          maxValue.toString() +
          ", but is '" +
          parsed.toString() +
          "'";
        throw IllegalStateException_init_$Create$(toString(message_0));
      }
      return parsed;
    }
    function SelectInstance() {}
    function get_NO_OWNER() {
      _init_properties_Mutex_kt__jod56b();
      return NO_OWNER;
    }
    var NO_OWNER;
    var ON_LOCK_ALREADY_LOCKED_BY_OWNER;
    function Mutex(locked) {
      locked = locked === VOID ? false : locked;
      _init_properties_Mutex_kt__jod56b();
      return new MutexImpl(locked);
    }
    function MutexImpl$onSelectCancellationUnlockConstructor$lambda$lambda(this$0, $owner) {
      return function (_unused_var__etf5q3, _unused_var__etf5q3_0, _unused_var__etf5q3_1) {
        this$0.ua($owner);
        return Unit_instance;
      };
    }
    function MutexImpl$onSelectCancellationUnlockConstructor$lambda(this$0) {
      return function (_unused_var__etf5q3, owner, _unused_var__etf5q3_0) {
        return MutexImpl$onSelectCancellationUnlockConstructor$lambda$lambda(this$0, owner);
      };
    }
    function MutexImpl(locked) {
      SemaphoreAndMutexImpl.call(this, 1, locked ? 1 : 0);
      this.sa_1 = atomic$ref$1(locked ? null : get_NO_OWNER());
      var tmp = this;
      tmp.ta_1 = MutexImpl$onSelectCancellationUnlockConstructor$lambda(this);
    }
    protoOf(MutexImpl).va = function () {
      return this.db() === 0;
    };
    protoOf(MutexImpl).ua = function (owner) {
      $l$loop_0: while (true) {
        // Inline function 'kotlin.check' call
        // Inline function 'kotlin.contracts.contract' call
        if (!this.va()) {
          // Inline function 'kotlinx.coroutines.sync.MutexImpl.unlock.<anonymous>' call
          var message = "This mutex is not locked";
          throw IllegalStateException_init_$Create$(toString(message));
        }
        var curOwner = this.sa_1.kotlinx$atomicfu$value;
        if (curOwner === get_NO_OWNER()) continue $l$loop_0;
        // Inline function 'kotlin.check' call
        // Inline function 'kotlin.contracts.contract' call
        if (!(curOwner === owner || owner == null)) {
          // Inline function 'kotlinx.coroutines.sync.MutexImpl.unlock.<anonymous>' call
          var message_0 = "This mutex is locked by " + toString_0(curOwner) + ", but " + toString_0(owner) + " is expected";
          throw IllegalStateException_init_$Create$(toString(message_0));
        }
        if (!this.sa_1.atomicfu$compareAndSet(curOwner, get_NO_OWNER())) continue $l$loop_0;
        this.eb();
        return Unit_instance;
      }
    };
    protoOf(MutexImpl).toString = function () {
      return "Mutex@" + get_hexAddress(this) + "[isLocked=" + this.va() + ",owner=" + toString_0(this.sa_1.kotlinx$atomicfu$value) + "]";
    };
    var properties_initialized_Mutex_kt_yv4p3j;
    function _init_properties_Mutex_kt__jod56b() {
      if (!properties_initialized_Mutex_kt_yv4p3j) {
        properties_initialized_Mutex_kt_yv4p3j = true;
        NO_OWNER = new Symbol("NO_OWNER");
        ON_LOCK_ALREADY_LOCKED_BY_OWNER = new Symbol("ALREADY_LOCKED_BY_OWNER");
      }
    }
    function get_MAX_SPIN_CYCLES() {
      _init_properties_Semaphore_kt__t514r6();
      return MAX_SPIN_CYCLES;
    }
    var MAX_SPIN_CYCLES;
    function get_PERMIT() {
      _init_properties_Semaphore_kt__t514r6();
      return PERMIT;
    }
    var PERMIT;
    function get_TAKEN() {
      _init_properties_Semaphore_kt__t514r6();
      return TAKEN;
    }
    var TAKEN;
    function get_BROKEN() {
      _init_properties_Semaphore_kt__t514r6();
      return BROKEN;
    }
    var BROKEN;
    function get_CANCELLED() {
      _init_properties_Semaphore_kt__t514r6();
      return CANCELLED;
    }
    var CANCELLED;
    function get_SEGMENT_SIZE() {
      _init_properties_Semaphore_kt__t514r6();
      return SEGMENT_SIZE;
    }
    var SEGMENT_SIZE;
    function decPermits($this) {
      $l$loop: while (true) {
        var p = $this.bb_1.atomicfu$getAndDecrement();
        if (p > $this.wa_1) continue $l$loop;
        return p;
      }
    }
    function coerceAvailablePermitsAtMaximum($this) {
      $l$loop_0: while (true) {
        var cur = $this.bb_1.kotlinx$atomicfu$value;
        if (cur <= $this.wa_1) break $l$loop_0;
        if ($this.bb_1.atomicfu$compareAndSet(cur, $this.wa_1)) break $l$loop_0;
      }
    }
    function addAcquireToQueue($this, waiter) {
      var curTail = $this.za_1.kotlinx$atomicfu$value;
      var enqIdx = $this.ab_1.atomicfu$getAndIncrement$long();
      var createNewSegment = createSegment$ref();
      var tmp$ret$2;
      $l$block_2: {
        // Inline function 'kotlinx.coroutines.internal.findSegmentAndMoveForward' call
        var this_0 = $this.za_1;
        // Inline function 'kotlin.Long.div' call
        var other = get_SEGMENT_SIZE();
        var id = enqIdx.c2(toLong(other));
        while (true) {
          var s = findSegmentInternal(curTail, id, createNewSegment);
          var tmp;
          if (_SegmentOrClosed___get_isClosed__impl__qmxmlo(s)) {
            tmp = true;
          } else {
            var tmp$ret$1;
            $l$block_1: {
              // Inline function 'kotlinx.coroutines.internal.moveForward' call
              var to = _SegmentOrClosed___get_segment__impl__jvcr9l(s);
              while (true) {
                // Inline function 'kotlinx.coroutines.internal.moveForward.<anonymous>' call
                var cur = this_0.kotlinx$atomicfu$value;
                if (cur.v9_1.y1(to.v9_1) >= 0) {
                  tmp$ret$1 = true;
                  break $l$block_1;
                }
                if (!to.ca()) {
                  tmp$ret$1 = false;
                  break $l$block_1;
                }
                if (this_0.atomicfu$compareAndSet(cur, to)) {
                  if (cur.da()) {
                    cur.w2();
                  }
                  tmp$ret$1 = true;
                  break $l$block_1;
                }
                if (to.da()) {
                  to.w2();
                }
              }
              tmp$ret$1 = Unit_instance;
            }
            tmp = tmp$ret$1;
          }
          if (tmp) {
            tmp$ret$2 = s;
            break $l$block_2;
          }
        }
      }
      var segment = _SegmentOrClosed___get_segment__impl__jvcr9l(tmp$ret$2);
      // Inline function 'kotlin.Long.rem' call
      var other_0 = get_SEGMENT_SIZE();
      var i = enqIdx.d2(toLong(other_0)).i2();
      // Inline function 'kotlinx.coroutines.sync.SemaphoreSegment.cas' call
      if (segment.jb_1.atomicfu$get(i).atomicfu$compareAndSet(null, waiter)) {
        waiter.s9(segment, i);
        return true;
      }
      // Inline function 'kotlinx.coroutines.sync.SemaphoreSegment.cas' call
      var expected = get_PERMIT();
      var value = get_TAKEN();
      if (segment.jb_1.atomicfu$get(i).atomicfu$compareAndSet(expected, value)) {
        if (isInterface(waiter, CancellableContinuation)) {
          if (!isInterface(waiter, CancellableContinuation)) THROW_CCE();
          waiter.r9(Unit_instance, $this.cb_1);
        } else {
          if (isInterface(waiter, SelectInstance)) {
            waiter.ka(Unit_instance);
          } else {
            var message = "unexpected: " + toString(waiter);
            throw IllegalStateException_init_$Create$(toString(message));
          }
        }
        return true;
      }
      // Inline function 'kotlinx.coroutines.assert' call
      return false;
    }
    function tryResumeNextFromQueue($this) {
      var curHead = $this.xa_1.kotlinx$atomicfu$value;
      var deqIdx = $this.ya_1.atomicfu$getAndIncrement$long();
      // Inline function 'kotlin.Long.div' call
      var other = get_SEGMENT_SIZE();
      var id = deqIdx.c2(toLong(other));
      var createNewSegment = createSegment$ref_0();
      var tmp$ret$2;
      $l$block_2: {
        // Inline function 'kotlinx.coroutines.internal.findSegmentAndMoveForward' call
        var this_0 = $this.xa_1;
        while (true) {
          var s = findSegmentInternal(curHead, id, createNewSegment);
          var tmp;
          if (_SegmentOrClosed___get_isClosed__impl__qmxmlo(s)) {
            tmp = true;
          } else {
            var tmp$ret$1;
            $l$block_1: {
              // Inline function 'kotlinx.coroutines.internal.moveForward' call
              var to = _SegmentOrClosed___get_segment__impl__jvcr9l(s);
              while (true) {
                // Inline function 'kotlinx.coroutines.internal.moveForward.<anonymous>' call
                var cur = this_0.kotlinx$atomicfu$value;
                if (cur.v9_1.y1(to.v9_1) >= 0) {
                  tmp$ret$1 = true;
                  break $l$block_1;
                }
                if (!to.ca()) {
                  tmp$ret$1 = false;
                  break $l$block_1;
                }
                if (this_0.atomicfu$compareAndSet(cur, to)) {
                  if (cur.da()) {
                    cur.w2();
                  }
                  tmp$ret$1 = true;
                  break $l$block_1;
                }
                if (to.da()) {
                  to.w2();
                }
              }
              tmp$ret$1 = Unit_instance;
            }
            tmp = tmp$ret$1;
          }
          if (tmp) {
            tmp$ret$2 = s;
            break $l$block_2;
          }
        }
      }
      var segment = _SegmentOrClosed___get_segment__impl__jvcr9l(tmp$ret$2);
      segment.ha();
      if (segment.v9_1.y1(id) > 0) return false;
      // Inline function 'kotlin.Long.rem' call
      var other_0 = get_SEGMENT_SIZE();
      var i = deqIdx.d2(toLong(other_0)).i2();
      // Inline function 'kotlinx.coroutines.sync.SemaphoreSegment.getAndSet' call
      var value = get_PERMIT();
      var cellState = segment.jb_1.atomicfu$get(i).atomicfu$getAndSet(value);
      if (cellState === null) {
        // Inline function 'kotlin.repeat' call
        var times = get_MAX_SPIN_CYCLES();
        // Inline function 'kotlin.contracts.contract' call
        var inductionVariable = 0;
        if (inductionVariable < times)
          do {
            var index = inductionVariable;
            inductionVariable = (inductionVariable + 1) | 0;
            // Inline function 'kotlinx.coroutines.sync.SemaphoreAndMutexImpl.tryResumeNextFromQueue.<anonymous>' call
            // Inline function 'kotlinx.coroutines.sync.SemaphoreSegment.get' call
            if (segment.jb_1.atomicfu$get(i).kotlinx$atomicfu$value === get_TAKEN()) return true;
          } while (inductionVariable < times);
        // Inline function 'kotlinx.coroutines.sync.SemaphoreSegment.cas' call
        var expected = get_PERMIT();
        var value_0 = get_BROKEN();
        return !segment.jb_1.atomicfu$get(i).atomicfu$compareAndSet(expected, value_0);
      } else if (cellState === get_CANCELLED()) return false;
      else return tryResumeAcquire(cellState, $this);
    }
    function tryResumeAcquire(_this__u8e3s4, $this) {
      var tmp;
      if (isInterface(_this__u8e3s4, CancellableContinuation)) {
        if (!isInterface(_this__u8e3s4, CancellableContinuation)) THROW_CCE();
        var token = _this__u8e3s4.p9(Unit_instance, null, $this.cb_1);
        var tmp_0;
        if (!(token == null)) {
          _this__u8e3s4.q9(token);
          tmp_0 = true;
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        if (isInterface(_this__u8e3s4, SelectInstance)) {
          tmp = _this__u8e3s4.ja($this, Unit_instance);
        } else {
          var message = "unexpected: " + toString(_this__u8e3s4);
          throw IllegalStateException_init_$Create$(toString(message));
        }
      }
      return tmp;
    }
    function SemaphoreAndMutexImpl$onCancellationRelease$lambda(this$0) {
      return function (_unused_var__etf5q3, _unused_var__etf5q3_0, _unused_var__etf5q3_1) {
        this$0.eb();
        return Unit_instance;
      };
    }
    function createSegment$ref() {
      var l = function (p0, p1) {
        return createSegment(p0, p1);
      };
      l.callableName = "createSegment";
      return l;
    }
    function createSegment$ref_0() {
      var l = function (p0, p1) {
        return createSegment(p0, p1);
      };
      l.callableName = "createSegment";
      return l;
    }
    function SemaphoreAndMutexImpl(permits, acquiredPermits) {
      this.wa_1 = permits;
      this.ya_1 = atomic$long$1(new Long(0, 0));
      this.ab_1 = atomic$long$1(new Long(0, 0));
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(this.wa_1 > 0)) {
        // Inline function 'kotlinx.coroutines.sync.SemaphoreAndMutexImpl.<anonymous>' call
        var message = "Semaphore should have at least 1 permit, but had " + this.wa_1;
        throw IllegalArgumentException_init_$Create$(toString(message));
      }
      // Inline function 'kotlin.require' call
      // Inline function 'kotlin.contracts.contract' call
      if (!(0 <= acquiredPermits ? acquiredPermits <= this.wa_1 : false)) {
        // Inline function 'kotlinx.coroutines.sync.SemaphoreAndMutexImpl.<anonymous>' call
        var message_0 = "The number of acquired permits should be in 0.." + this.wa_1;
        throw IllegalArgumentException_init_$Create$(toString(message_0));
      }
      var s = new SemaphoreSegment(new Long(0, 0), null, 2);
      this.xa_1 = atomic$ref$1(s);
      this.za_1 = atomic$ref$1(s);
      this.bb_1 = atomic$int$1((this.wa_1 - acquiredPermits) | 0);
      var tmp = this;
      tmp.cb_1 = SemaphoreAndMutexImpl$onCancellationRelease$lambda(this);
    }
    protoOf(SemaphoreAndMutexImpl).db = function () {
      // Inline function 'kotlin.math.max' call
      var a = this.bb_1.kotlinx$atomicfu$value;
      return Math.max(a, 0);
    };
    protoOf(SemaphoreAndMutexImpl).acquireCont = function (waiter) {
      var tmp$ret$0;
      $l$block_0: {
        // Inline function 'kotlinx.coroutines.sync.SemaphoreAndMutexImpl.acquire' call
        while (true) {
          var p = decPermits(this);
          if (p > 0) {
            // Inline function 'kotlinx.coroutines.sync.SemaphoreAndMutexImpl.acquire.<anonymous>' call
            waiter.r9(Unit_instance, this.cb_1);
            tmp$ret$0 = Unit_instance;
            break $l$block_0;
          }
          // Inline function 'kotlinx.coroutines.sync.SemaphoreAndMutexImpl.acquire.<anonymous>' call
          if (addAcquireToQueue(this, isInterface(waiter, Waiter) ? waiter : THROW_CCE())) {
            tmp$ret$0 = Unit_instance;
            break $l$block_0;
          }
        }
      }
      return tmp$ret$0;
    };
    protoOf(SemaphoreAndMutexImpl).eb = function () {
      while (true) {
        var p = this.bb_1.atomicfu$getAndIncrement();
        if (p >= this.wa_1) {
          coerceAvailablePermitsAtMaximum(this);
          // Inline function 'kotlin.error' call
          var message = "The number of released permits cannot be greater than " + this.wa_1;
          throw IllegalStateException_init_$Create$(toString(message));
        }
        if (p >= 0) return Unit_instance;
        if (tryResumeNextFromQueue(this)) return Unit_instance;
      }
    };
    function SemaphoreSegment(id, prev, pointers) {
      Segment.call(this, id, prev, pointers);
      this.jb_1 = atomicfu$AtomicRefArray$ofNulls(get_SEGMENT_SIZE());
    }
    protoOf(SemaphoreSegment).x9 = function () {
      return get_SEGMENT_SIZE();
    };
    protoOf(SemaphoreSegment).toString = function () {
      return "SemaphoreSegment[id=" + this.v9_1.toString() + ", hashCode=" + hashCode(this) + "]";
    };
    function createSegment(id, prev) {
      _init_properties_Semaphore_kt__t514r6();
      return new SemaphoreSegment(id, prev, 0);
    }
    var properties_initialized_Semaphore_kt_uqcwok;
    function _init_properties_Semaphore_kt__t514r6() {
      if (!properties_initialized_Semaphore_kt_uqcwok) {
        properties_initialized_Semaphore_kt_uqcwok = true;
        MAX_SPIN_CYCLES = systemProp("kotlinx.coroutines.semaphore.maxSpinCycles", 100);
        PERMIT = new Symbol("PERMIT");
        TAKEN = new Symbol("TAKEN");
        BROKEN = new Symbol("BROKEN");
        CANCELLED = new Symbol("CANCELLED");
        SEGMENT_SIZE = systemProp("kotlinx.coroutines.semaphore.segmentSize", 16);
      }
    }
    var counter;
    function get_hexAddress(_this__u8e3s4) {
      // Inline function 'kotlin.js.asDynamic' call
      var result = _this__u8e3s4.__debug_counter;
      if (!(typeof result === "number")) {
        counter = (counter + 1) | 0;
        result = counter;
        // Inline function 'kotlin.js.asDynamic' call
        _this__u8e3s4.__debug_counter = result;
      }
      return ((!(result == null) ? typeof result === "number" : false) ? result : THROW_CCE()).toString();
    }
    function systemProp_1(propertyName) {
      return null;
    }
    //region block: init
    counter = 0;
    //endregion
    //region block: exports
    _.$_$ = _.$_$ || {};
    _.$_$.a = Mutex;
    //endregion
    return _;
  })({}, kotlin_kotlin, kotlin_org_jetbrains_kotlinx_atomicfu);

  //# sourceMappingURL=kotlinx-coroutines-core.js.map
  var kotlin_com_hgwen_hgutils_hgutils = (function (
    _,
    kotlin_kotlin,
    kotlin_org_jetbrains_kotlinx_kotlinx_io_core,
    kotlin_org_jetbrains_kotlinx_kotlinx_coroutines_core,
  ) {
    "use strict";
    //region block: imports
    var imul = Math.imul;
    var protoOf = kotlin_kotlin.$_$.o3;
    var initMetadataForInterface = kotlin_kotlin.$_$.y2;
    var ensureNotNull = kotlin_kotlin.$_$.b5;
    var throwKotlinNothingValueException = kotlin_kotlin.$_$.f5;
    var initMetadataForClass = kotlin_kotlin.$_$.w2;
    var initMetadataForObject = kotlin_kotlin.$_$.z2;
    var objectCreate = kotlin_kotlin.$_$.n3;
    var initMetadataForCompanion = kotlin_kotlin.$_$.x2;
    var equals = kotlin_kotlin.$_$.p2;
    var FunctionAdapter = kotlin_kotlin.$_$.g2;
    var isInterface = kotlin_kotlin.$_$.g3;
    var hashCode = kotlin_kotlin.$_$.v2;
    var VOID = kotlin_kotlin.$_$.c;
    var Unit_instance = kotlin_kotlin.$_$.y;
    var THROW_CCE = kotlin_kotlin.$_$.y4;
    var KtMap = kotlin_kotlin.$_$.b1;
    var HashMap_init_$Create$ = kotlin_kotlin.$_$.f;
    var Path = kotlin_org_jetbrains_kotlinx_kotlinx_io_core.$_$.a;
    var lazy = kotlin_kotlin.$_$.c5;
    var get_SystemFileSystem = kotlin_org_jetbrains_kotlinx_kotlinx_io_core.$_$.b;
    var buffered = kotlin_org_jetbrains_kotlinx_kotlinx_io_core.$_$.c;
    var lastIndexOf = kotlin_kotlin.$_$.c4;
    var startsWith = kotlin_kotlin.$_$.f4;
    var KProperty1 = kotlin_kotlin.$_$.w3;
    var getPropertyCallableRef = kotlin_kotlin.$_$.t2;
    var toString = kotlin_kotlin.$_$.g5;
    var isArray = kotlin_kotlin.$_$.a3;
    var Enum = kotlin_kotlin.$_$.u4;
    var println = kotlin_kotlin.$_$.f2;
    var newThrowable = kotlin_kotlin.$_$.i3;
    var stackTraceToString = kotlin_kotlin.$_$.e5;
    var HashSet_init_$Create$ = kotlin_kotlin.$_$.g;
    var ArrayList_init_$Create$ = kotlin_kotlin.$_$.e;
    var Mutex = kotlin_org_jetbrains_kotlinx_kotlinx_coroutines_core.$_$.a;
    var writeString = kotlin_org_jetbrains_kotlinx_kotlinx_io_core.$_$.d;
    var printStackTrace = kotlin_kotlin.$_$.d5;
    var coerceAtLeast = kotlin_kotlin.$_$.t3;
    var getNumberHashCode = kotlin_kotlin.$_$.s2;
    var Long = kotlin_kotlin.$_$.w4;
    var toString_0 = kotlin_kotlin.$_$.r3;
    var Entry = kotlin_kotlin.$_$.a1;
    var joinToString = kotlin_kotlin.$_$.y3;
    var Sequence = kotlin_kotlin.$_$.x3;
    var joinToString_0 = kotlin_kotlin.$_$.p1;
    var Collection = kotlin_kotlin.$_$.z;
    var joinToString_1 = kotlin_kotlin.$_$.q1;
    var joinToString_2 = kotlin_kotlin.$_$.n1;
    var isDoubleArray = kotlin_kotlin.$_$.d3;
    var joinToString_3 = kotlin_kotlin.$_$.m1;
    var isFloatArray = kotlin_kotlin.$_$.e3;
    var joinToString_4 = kotlin_kotlin.$_$.l1;
    var isLongArray = kotlin_kotlin.$_$.h3;
    var joinToString_5 = kotlin_kotlin.$_$.k1;
    var isIntArray = kotlin_kotlin.$_$.f3;
    var joinToString_6 = kotlin_kotlin.$_$.o1;
    var isByteArray = kotlin_kotlin.$_$.b3;
    var contains = kotlin_kotlin.$_$.z3;
    var until = kotlin_kotlin.$_$.u3;
    var sliceArray = kotlin_kotlin.$_$.a2;
    var charSequenceLength = kotlin_kotlin.$_$.m2;
    var isCharSequence = kotlin_kotlin.$_$.c3;
    var trim = kotlin_kotlin.$_$.r4;
    var Companion_instance = kotlin_kotlin.$_$.x;
    var toCharArray = kotlin_kotlin.$_$.j4;
    var taggedArrayCopy = kotlin_kotlin.$_$.b;
    var trim_0 = kotlin_kotlin.$_$.q4;
    var split = kotlin_kotlin.$_$.e4;
    var _Result___init__impl__xyqfz8 = kotlin_kotlin.$_$.u;
    var createFailure = kotlin_kotlin.$_$.a5;
    var _Result___get_isFailure__impl__jpiriv = kotlin_kotlin.$_$.v;
    var _Result___get_value__impl__bjfvqg = kotlin_kotlin.$_$.w;
    var toInt = kotlin_kotlin.$_$.l4;
    var numberToChar = kotlin_kotlin.$_$.j3;
    var Char = kotlin_kotlin.$_$.s4;
    var toByte = kotlin_kotlin.$_$.i4;
    var toBoolean = kotlin_kotlin.$_$.h4;
    var toDouble = kotlin_kotlin.$_$.k4;
    var toLong = kotlin_kotlin.$_$.n4;
    var toShort = kotlin_kotlin.$_$.o4;
    var fillArrayVal = kotlin_kotlin.$_$.q2;
    var sum = kotlin_kotlin.$_$.c2;
    var numberToInt = kotlin_kotlin.$_$.l3;
    var IndexOutOfBoundsException_init_$Create$ = kotlin_kotlin.$_$.o;
    var Triple = kotlin_kotlin.$_$.z4;
    var numberToDouble = kotlin_kotlin.$_$.k3;
    var contentEquals = kotlin_kotlin.$_$.f1;
    var arrayConcat = kotlin_kotlin.$_$.a;
    var listOf = kotlin_kotlin.$_$.u1;
    var arrayIterator = kotlin_kotlin.$_$.i2;
    var _Char___init__impl__6a9atx = kotlin_kotlin.$_$.s;
    var replace = kotlin_kotlin.$_$.d4;
    var numberToLong = kotlin_kotlin.$_$.m3;
    //endregion
    //region block: pre-declaration
    initMetadataForInterface(AlwaysCallMe, "AlwaysCallMe");
    initMetadataForClass(_no_name_provided__qut3iv);
    initMetadataForClass(_no_name_provided__qut3iv_0);
    initMetadataForClass(_no_name_provided__qut3iv_1);
    initMetadataForObject(hgcallme, "hgcallme");
    initMetadataForClass(hgconfig, "hgconfig", hgconfig_init_$Create$);
    initMetadataForCompanion(Companion, hgconfig);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(_no_name_provided__qut3iv_2);
    initMetadataForClass(FilePath, "FilePath");
    initMetadataForObject(hgfile, "hgfile");
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(_no_name_provided__qut3iv_3);
    initMetadataForClass(hggeo, "hggeo", hggeo);
    initMetadataForCompanion(Companion_0, hggeo);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(_no_name_provided__qut3iv_4);
    initMetadataForCompanion(Companion_1);
    initMetadataForClass(hgjson, "hgjson");
    initMetadataForClass(hglog, "hglog", hglog);
    initMetadataForCompanion(Companion_2, hglog);
    initMetadataForClass(LogType, "LogType", VOID, Enum);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(_no_name_provided__qut3iv_5);
    initMetadataForClass(_no_name_provided__qut3iv_6);
    initMetadataForClass(_no_name_provided__qut3iv_7);
    initMetadataForClass(_no_name_provided__qut3iv_8);
    initMetadataForClass(_no_name_provided__qut3iv_9);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(_no_name_provided__qut3iv_10);
    initMetadataForObject(hgmath, "hgmath");
    initMetadataForClass(hgtime, "hgtime", hgtime);
    initMetadataForCompanion(Companion_3, hgtime);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(_no_name_provided__qut3iv_11);
    initMetadataForClass(_no_name_provided__qut3iv_12);
    initMetadataForClass(_no_name_provided__qut3iv_13);
    initMetadataForObject(hgutils, "hgutils");
    initMetadataForCompanion(Companion_4);
    initMetadataForClass(matrixnd, "matrixnd", matrixnd);
    initMetadataForCompanion(Companion_5);
    initMetadataForClass(vector2d, "vector2d", vector2d_init_$Create$);
    initMetadataForCompanion(Companion_6);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12, "sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0", VOID, VOID, [
      AlwaysCallMe,
      FunctionAdapter,
    ]);
    initMetadataForClass(_no_name_provided__qut3iv_14);
    initMetadataForClass(_no_name_provided__qut3iv_15);
    initMetadataForClass(_no_name_provided__qut3iv_16);
    initMetadataForClass(vector3d, "vector3d", vector3d);
    initMetadataForCompanion(vector4d0);
    initMetadataForClass(vector4d, "vector4d", vector4d);
    initMetadataForCompanion(Companion_7);
    initMetadataForClass(vectornd, "vectornd", vectornd);
    initMetadataForClass(hgjsonIterator, "hgjsonIterator");
    //endregion
    function AlwaysCallMe() {}
    function _no_name_provided__qut3iv() {}
    protoOf(_no_name_provided__qut3iv).ae = function () {
      ensureNotNull(null);
      return throwKotlinNothingValueException();
    };
    function _no_name_provided__qut3iv_0() {}
    protoOf(_no_name_provided__qut3iv_0).ae = function () {
      ensureNotNull(null);
      return throwKotlinNothingValueException();
    };
    function _no_name_provided__qut3iv_1() {}
    protoOf(_no_name_provided__qut3iv_1).zd = function () {
      Companion_getInstance_2().qe("");
    };
    function hgcallme() {
      this.re_1 = false;
      this.se_1 = true;
    }
    var hgcallme_instance;
    function hgcallme_getInstance() {
      return hgcallme_instance;
    }
    function hgconfig_init_$Init$($this) {
      hgconfig.call($this);
      return $this;
    }
    function hgconfig_init_$Create$() {
      return hgconfig_init_$Init$(objectCreate(protoOf(hgconfig)));
    }
    function hgconfig_init_$Init$_0(fname, $this) {
      hgconfig.call($this);
      $this.ue_1 = fname;
      return $this;
    }
    function hgconfig_init_$Create$_0(fname) {
      return hgconfig_init_$Init$_0(fname, objectCreate(protoOf(hgconfig)));
    }
    function Companion() {
      Companion_instance_0 = this;
      hgconfig_init_$Init$_0("hgconfig.conf", this);
      this.xe_1 = this;
      this.ye_1 = hgconfig_init_$Create$_0("autosave.conf");
    }
    var Companion_instance_0;
    function Companion_getInstance() {
      if (Companion_instance_0 == null) new Companion();
      return Companion_instance_0;
    }
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0(function_0) {
      this.bf_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0).zd = function () {
      return this.bf_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0).k2 = function () {
      return this.bf_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0).hashCode = function () {
      return hashCode(this.k2());
    };
    function hgconfig$getConfig$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgconfig$getConfig$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_2() {}
    protoOf(_no_name_provided__qut3iv_2).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hgconfig$getConfig$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgconfig$getConfig$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    protoOf(hgconfig).ze = function (key, defaultValue, log) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hgconfig$getConfig$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hgconfig$getConfig$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0(tmp_0).zd();
                new _no_name_provided__qut3iv_2().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hgconfig$getConfig$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hgconfig$getConfig$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0(tmp_2).zd();
            new _no_name_provided__qut3iv_0().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            var tmp_3 = hgutils_instance;
            // Inline function 'kotlin.collections.get' call
            var this_0 = this.te_1;
            var tmp$ret$1 = (isInterface(this_0, KtMap) ? this_0 : THROW_CCE()).n1(key);
            var v = tmp_3.df(tmp$ret$1, defaultValue);
            if (log) {
              var tmp_4 = Companion_getInstance_2();
              // Inline function 'kotlin.collections.get' call
              var this_1 = this.te_1;
              var tmp$ret$2 = (isInterface(this_1, KtMap) ? this_1 : THROW_CCE()).n1(key);
              tmp_4.cf([key, tmp$ret$2, defaultValue, v]);
            }
            return v;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              Companion_getInstance_2().cf([e_5]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          Companion_getInstance_2().cf([e_6]);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(hgconfig).af = function (key, defaultValue, log, $super) {
      log = log === VOID ? false : log;
      return $super === VOID ? this.ze(key, defaultValue, log) : $super.ze.call(this, key, defaultValue, log);
    };
    function hgconfig() {
      Companion_getInstance();
      this.te_1 = HashMap_init_$Create$();
      this.ue_1 = "";
    }
    function hgfile$FilePath$path$delegate$lambda(this$0) {
      return function () {
        return Path(this$0.ef_1);
      };
    }
    function FilePath(name) {
      this.ef_1 = name;
      var tmp = this;
      tmp.ff_1 = lazy(hgfile$FilePath$path$delegate$lambda(this));
    }
    protoOf(FilePath).gf = function () {
      // Inline function 'kotlin.getValue' call
      var this_0 = this.ff_1;
      path$factory();
      return this_0.k1();
    };
    protoOf(FilePath).hf = function () {
      var tmp;
      try {
        this.wd().if();
        tmp = buffered(get_SystemFileSystem().pd(this.gf()));
      } catch ($p) {
        var tmp_0;
        if ($p instanceof Error) {
          var e = $p;
          Companion_getInstance_2().cf(["Write file error", this.ef_1]);
          Companion_getInstance_2().cf([e]);
          tmp_0 = null;
        } else {
          throw $p;
        }
        tmp = tmp_0;
      }
      return tmp;
    };
    protoOf(FilePath).if = function () {
      try {
        get_SystemFileSystem().nd(this.gf());
      } catch ($p) {
        if ($p instanceof Error) {
          var e = $p;
          Companion_getInstance_2().cf([e]);
        } else {
          throw $p;
        }
      }
    };
    protoOf(FilePath).toString = function () {
      return this.ef_1;
    };
    protoOf(FilePath).wd = function () {
      var pos = lastIndexOf(this.ef_1, hgfile_instance.jf_1);
      // Inline function 'kotlin.text.substring' call
      var this_0 = this.ef_1;
      // Inline function 'kotlin.math.max' call
      var endIndex = Math.max(0, pos);
      // Inline function 'kotlin.js.asDynamic' call
      var tmp$ret$2 = this_0.substring(0, endIndex);
      return new FilePath(tmp$ret$2);
    };
    function hgfile() {
      this.jf_1 = "/";
      this.kf_1 = "";
      this.lf_1 = "";
    }
    protoOf(hgfile).mf = function (fname) {
      var fpath = new FilePath(startsWith(fname, this.kf_1) || startsWith(fname, "/") ? fname : this.kf_1 + fname);
      Companion_getInstance_2().cf([this.kf_1, fname, fpath]);
      return fpath;
    };
    var hgfile_instance;
    function hgfile_getInstance() {
      return hgfile_instance;
    }
    function path$factory() {
      return getPropertyCallableRef(
        "path",
        1,
        KProperty1,
        function (receiver) {
          return receiver.gf();
        },
        null,
      );
    }
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0(function_0) {
      this.nf_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0).zd = function () {
      return this.nf_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0).k2 = function () {
      return this.nf_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0).hashCode = function () {
      return hashCode(this.k2());
    };
    function hggeo$Companion$distance$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hggeo$Companion$distance$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_3() {}
    protoOf(_no_name_provided__qut3iv_3).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hggeo$Companion$distance$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hggeo$Companion$distance$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function Companion_0() {
      Companion_instance_1 = this;
      hggeo.call(this);
      this.rf_1 = this;
      this.sf_1 = 6378137.0;
      this.tf_1 = 6378137.0;
      this.uf_1 = 0.0818191910428;
      this.vf_1 = 0.017453292519943295;
      this.wf_1 = 111319.49079327357;
      this.xf_1 = 57.29577951308232;
      this.yf_1 = new vector3d(1000000.0, 1000000.0, 1.0);
    }
    protoOf(Companion_0).zf = function (v1, v2) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hggeo$Companion$distance$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hggeo$Companion$distance$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0(tmp_0).zd();
                new _no_name_provided__qut3iv_3().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hggeo$Companion$distance$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hggeo$Companion$distance$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_0(tmp_2).zd();
            new _no_name_provided__qut3iv_0().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            var r1 = v1.cg(0.017453292519943295);
            var r2 = v2.cg(0.017453292519943295);
            var r3 = r1.dg(r2);
            // Inline function 'kotlin.math.asin' call
            // Inline function 'kotlin.math.sqrt' call
            // Inline function 'kotlin.math.sin' call
            var x = r3.bg_1 / 2;
            var tmp_3 = Math.sin(x);
            // Inline function 'kotlin.math.sin' call
            var x_0 = r3.bg_1 / 2;
            var tmp_4 = tmp_3 * Math.sin(x_0);
            // Inline function 'kotlin.math.cos' call
            var x_1 = r1.bg_1;
            var tmp_5 = Math.cos(x_1);
            // Inline function 'kotlin.math.cos' call
            var x_2 = r2.bg_1;
            var tmp_6 = tmp_5 * Math.cos(x_2);
            // Inline function 'kotlin.math.sin' call
            var x_3 = r3.ag_1 / 2;
            var tmp_7 = tmp_6 * Math.sin(x_3);
            // Inline function 'kotlin.math.sin' call
            var x_4 = r3.ag_1 / 2;
            var x_5 = tmp_4 + tmp_7 * Math.sin(x_4);
            var x_6 = Math.sqrt(x_5);
            return 2 * Math.asin(x_6) * Companion_getInstance_0().tf_1;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              Companion_getInstance_2().cf([e_5]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          Companion_getInstance_2().cf([e_6]);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(Companion_0).eg = function (v1, v2) {
      return this.zf(v1.fg(), v2.fg());
    };
    var Companion_instance_1;
    function Companion_getInstance_0() {
      if (Companion_instance_1 == null) new Companion_0();
      return Companion_instance_1;
    }
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1(function_0) {
      this.mg_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1).zd = function () {
      return this.mg_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1).k2 = function () {
      return this.mg_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1).hashCode = function () {
      return hashCode(this.k2());
    };
    function hggeo$_set_reference_$lambda_c1ht4z() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hggeo$_set_reference_$lambda_c1ht4z_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_4() {}
    protoOf(_no_name_provided__qut3iv_4).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hggeo$_set_reference_$lambda_c1ht4z_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hggeo$_set_reference_$lambda_c1ht4z_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hggeo() {
      Companion_getInstance_0();
      this.gg_1 = new vector3d(111319.49079327357, 111319.49079327357, 1.0);
      this.hg_1 = null;
      this.ig_1 = 100.0;
    }
    protoOf(hggeo).jg = function (value) {
      // Inline function 'com.hgwen.hgutils.hgcallme.callMeAlways' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hggeo$_set_reference_$lambda_c1ht4z;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hggeo$_set_reference_$lambda_c1ht4z_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1(tmp_0).zd();
                new _no_name_provided__qut3iv_4().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hggeo$_set_reference_$lambda_c1ht4z_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hggeo$_set_reference_$lambda_c1ht4z_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_1(tmp_2).zd();
            new _no_name_provided__qut3iv_1().zd();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            // Inline function 'com.hgwen.hgutils.hggeo.<set-reference>.<anonymous>' call
            if (value == null) {
              Companion_getInstance_2().cf([toString(this.hg_1) + " => " + toString(value), this.gg_1]);
              this.hg_1 = null;
              return Unit_instance;
            }
            // Inline function 'kotlin.math.cos' call
            var x = hgmath_instance.rg(value.y);
            var s = Math.cos(x);
            this.gg_1.x = this.gg_1.y * s;
            Companion_getInstance_2().cf(["\u53C2\u8003\u70B9", toString(this.hg_1) + " => " + toString(value), this.gg_1, s]);
            this.hg_1 = value.sg();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              Companion_getInstance_2().cf([e_5]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          Companion_getInstance_2().cf([e_6]);
        } else {
          throw $p;
        }
      }
    };
    protoOf(hggeo).kg = function (coord) {
      if (this.hg_1 == null) {
        this.jg(coord);
      }
      return coord.tg(this.hg_1).ug(this.gg_1);
    };
    protoOf(hggeo).lg = function (pos) {
      return pos.vg(this.gg_1).wg(this.hg_1);
    };
    function Companion_1() {}
    protoOf(Companion_1).xg = function (s) {
      try {
        return Parse(this, s);
      } catch ($p) {
        if ($p instanceof Error) {
          var e = $p;
          Companion_getInstance_2().cf([e.message, s]);
          return null;
        } else {
          throw $p;
        }
      }
    };
    var Companion_instance_2;
    function Companion_getInstance_1() {
      return Companion_instance_2;
    }
    function hgjson(jsonElement) {
      this.yg_1 = null;
      if (jsonElement instanceof hgjson) {
        this.yg_1 = jsonElement.yg_1;
      } else {
        this.yg_1 = jsonElement;
      }
    }
    protoOf(hgjson).p = function () {
      return get_Size(this);
    };
    protoOf(hgjson).zg = function (key) {
      return this.ah(key);
    };
    protoOf(hgjson).ah = function (key) {
      // Inline function 'com.hgwen.hgutils.value' call
      var tmp = this == null ? null : this.yg_1;
      var tmp1_safe_receiver = (!(tmp == null) ? !(tmp == null) : false) ? tmp : null;
      var tmp_0 = tmp1_safe_receiver == null ? null : tmp1_safe_receiver[key];
      var tmp0_elvis_lhs = (tmp_0 == null ? true : !(tmp_0 == null)) ? tmp_0 : null;
      var tmp_1;
      if (tmp0_elvis_lhs == null) {
        return null;
      } else {
        tmp_1 = tmp0_elvis_lhs;
      }
      return new hgjson(tmp_1);
    };
    protoOf(hgjson).bh = function (key) {
      // Inline function 'com.hgwen.hgutils.value' call
      var tmp = this == null ? null : this.yg_1;
      var tmp1_safe_receiver = (!(tmp == null) ? !(tmp == null) : false) ? tmp : null;
      var tmp_0 = tmp1_safe_receiver == null ? null : tmp1_safe_receiver[key];
      var tmp0_elvis_lhs = (tmp_0 == null ? true : typeof tmp_0 === "string") ? tmp_0 : null;
      return tmp0_elvis_lhs == null ? "" : tmp0_elvis_lhs;
    };
    protoOf(hgjson).ch = function (key) {
      // Inline function 'com.hgwen.hgutils.value' call
      var tmp = this == null ? null : this.yg_1;
      var tmp1_safe_receiver = (!(tmp == null) ? !(tmp == null) : false) ? tmp : null;
      var tmp_0 = tmp1_safe_receiver == null ? null : tmp1_safe_receiver[key];
      var tmp0_elvis_lhs = (tmp_0 == null ? true : typeof tmp_0 === "number") ? tmp_0 : null;
      return tmp0_elvis_lhs == null ? 0.0 : tmp0_elvis_lhs;
    };
    protoOf(hgjson).dh = function (key) {
      // Inline function 'com.hgwen.hgutils.value' call
      var tmp = this == null ? null : this.yg_1;
      var tmp1_safe_receiver = (!(tmp == null) ? !(tmp == null) : false) ? tmp : null;
      var tmp_0 = tmp1_safe_receiver == null ? null : tmp1_safe_receiver[key];
      var tmp0_elvis_lhs = (tmp_0 == null ? true : typeof tmp_0 === "boolean") ? tmp_0 : null;
      return tmp0_elvis_lhs == null ? false : tmp0_elvis_lhs;
    };
    protoOf(hgjson).o = function (key) {
      return this.eh(key);
    };
    protoOf(hgjson).eh = function (key) {
      // Inline function 'com.hgwen.hgutils.value' call
      var tmp = this == null ? null : this.yg_1;
      var tmp1_safe_receiver = (!(tmp == null) ? isArray(tmp) : false) ? tmp : null;
      var tmp_0 = tmp1_safe_receiver == null ? null : tmp1_safe_receiver[key];
      var tmp0_elvis_lhs = (tmp_0 == null ? true : !(tmp_0 == null)) ? tmp_0 : null;
      var tmp_1;
      if (tmp0_elvis_lhs == null) {
        return null;
      } else {
        tmp_1 = tmp0_elvis_lhs;
      }
      return new hgjson(tmp_1);
    };
    protoOf(hgjson).fh = function (key) {
      // Inline function 'com.hgwen.hgutils.value' call
      var tmp = this == null ? null : this.yg_1;
      var tmp1_safe_receiver = (!(tmp == null) ? isArray(tmp) : false) ? tmp : null;
      var tmp_0 = tmp1_safe_receiver == null ? null : tmp1_safe_receiver[key];
      var tmp0_elvis_lhs = (tmp_0 == null ? true : typeof tmp_0 === "number") ? tmp_0 : null;
      return tmp0_elvis_lhs == null ? 0.0 : tmp0_elvis_lhs;
    };
    protoOf(hgjson).toString = function () {
      return toString(this.yg_1);
    };
    protoOf(hgjson).l = function () {
      return new hgjsonIterator(this);
    };
    var LogType_V_instance;
    var LogType_D_instance;
    var LogType_I_instance;
    var LogType_W_instance;
    var LogType_E_instance;
    var LogType_WTF_instance;
    var LogType_entriesInitialized;
    function LogType_initEntries() {
      if (LogType_entriesInitialized) return Unit_instance;
      LogType_entriesInitialized = true;
      LogType_V_instance = new LogType("V", 0);
      LogType_D_instance = new LogType("D", 1);
      LogType_I_instance = new LogType("I", 2);
      LogType_W_instance = new LogType("W", 3);
      LogType_E_instance = new LogType("E", 4);
      LogType_WTF_instance = new LogType("WTF", 5);
    }
    function Companion_2() {
      Companion_instance_3 = this;
      hglog.call(this);
      this.vh_1 = this;
      init_top_level_properties();
    }
    var Companion_instance_3;
    function Companion_getInstance_2() {
      if (Companion_instance_3 == null) new Companion_2();
      return Companion_instance_3;
    }
    function LogType(name, ordinal) {
      Enum.call(this, name, ordinal);
    }
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2(function_0) {
      this.bi_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2).zd = function () {
      return this.bi_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2).k2 = function () {
      return this.bi_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2).hashCode = function () {
      return hashCode(this.k2());
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3(function_0) {
      this.ci_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3).zd = function () {
      return this.ci_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3).k2 = function () {
      return this.ci_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3).hashCode = function () {
      return hashCode(this.k2());
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(function_0) {
      this.di_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4).zd = function () {
      return this.di_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4).k2 = function () {
      return this.di_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4).hashCode = function () {
      return hashCode(this.k2());
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5(function_0) {
      this.ei_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5).zd = function () {
      return this.ei_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5).k2 = function () {
      return this.ei_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5).hashCode = function () {
      return hashCode(this.k2());
    };
    function hglog$logFunction$o(type, tag, msg) {
      println(type.toString() + " " + tag + " " + msg);
      return Unit_instance;
    }
    function hglog$formatLog$o(log) {
      return log == null ? "" : log;
    }
    function hglog$autoCheckEnable$o() {
      return Unit_instance;
    }
    function hglog$callerStacks$o(this$0) {
      return function (depth, str) {
        this$0.wh(str == null ? "" : str);
        this$0.wh(stackTraceToString(newThrowable()));
        return Unit_instance;
      };
    }
    function hglog$write$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$write$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_5() {}
    protoOf(_no_name_provided__qut3iv_5).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hglog$write$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$write$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$isEnable$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$isEnable$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_6() {}
    protoOf(_no_name_provided__qut3iv_6).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hglog$isEnable$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$isEnable$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$logs$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$logs$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_7() {}
    protoOf(_no_name_provided__qut3iv_7).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hglog$logs$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$logs$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$logs$lambda_3(this$0) {
      return function () {
        this$0.qe("");
        return Unit_instance;
      };
    }
    function hglog$logs$lambda_4() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$logs$lambda_5() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_8() {}
    protoOf(_no_name_provided__qut3iv_8).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hglog$logs$lambda_6() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$logs$lambda_7() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$checkHighFrequence$o() {
      return false;
    }
    function hglog$log$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$log$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_9() {}
    protoOf(_no_name_provided__qut3iv_9).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hglog$log$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hglog$log$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function LogType_D_getInstance() {
      LogType_initEntries();
      return LogType_D_instance;
    }
    function LogType_E_getInstance() {
      LogType_initEntries();
      return LogType_E_instance;
    }
    function LogType_WTF_getInstance() {
      LogType_initEntries();
      return LogType_WTF_instance;
    }
    function hglog(mLogFilename) {
      Companion_getInstance_2();
      mLogFilename = mLogFilename === VOID ? "hglog/wtf/log." + Companion_getInstance_3().ii("yyyyMMddHHmmss") + ".txt" : mLogFilename;
      this.be_1 = mLogFilename;
      this.ce_1 = "hglog";
      this.de_1 = null;
      this.ee_1 = false;
      this.fe_1 = false;
      this.ge_1 = HashSet_init_$Create$();
      this.he_1 = ArrayList_init_$Create$();
      var tmp = this;
      tmp.ie_1 = hglog$logFunction$o;
      var tmp_0 = this;
      tmp_0.je_1 = hglog$formatLog$o;
      var tmp_1 = this;
      tmp_1.ke_1 = hglog$autoCheckEnable$o;
      this.le_1 = 0;
      this.ie_1(LogType_D_getInstance(), this.ce_1, "hglog.init");
      this.he_1.r2("com.hgwen.hgutils.Hgutils_javaKt$$ExternalSyntheticLambda0");
      this.he_1.r2("com.hgwen.hgutils.Hgutils_javaKt$$ExternalSyntheticLambda1");
      this.he_1.r2("com.hgwen.hgutils.Hgutils_javaKt$$ExternalSyntheticLambda4");
      this.he_1.r2("com.hgwen.hgutils.Hgutils_javaKt");
      this.he_1.r2("com.hgwen.hgutils.hglog");
      this.he_1.r2("com.hgwen.hgutils.hgtoast");
      this.he_1.r2("android.app.Activity");
      this.he_1.r2("android.app.ActivityThread");
      this.he_1.r2("android.os.Handler");
      this.he_1.r2("android.view.View");
      this.he_1.r2("androidx.fragment.app.Fragment");
      this.me_1 = HashMap_init_$Create$();
      var tmp_2 = this;
      tmp_2.ne_1 = hglog$callerStacks$o(this);
      this.oe_1 = Mutex();
      var tmp_3 = this;
      tmp_3.pe_1 = hglog$checkHighFrequence$o;
    }
    protoOf(hglog).toString = function () {
      return hgutils_instance.ji(["hglog", this.ee_1, this.ge_1, this.be_1]);
    };
    protoOf(hglog).cf = function (args) {
      this.ai(LogType_D_getInstance(), args.slice());
    };
    protoOf(hglog).qe = function (s) {
      this.ai(LogType_D_getInstance(), [s]);
    };
    protoOf(hglog).wh = function (s) {
      this.ie_1(LogType_D_getInstance(), this.ce_1, s);
    };
    protoOf(hglog).xh = function (str) {
      // Inline function 'com.hgwen.hgutils.hgcallme.callMeAlways' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hglog$write$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hglog$write$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2(tmp_0).zd();
                new _no_name_provided__qut3iv_5().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hglog$write$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hglog$write$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_2(tmp_2).zd();
            new _no_name_provided__qut3iv_1().zd();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            // Inline function 'com.hgwen.hgutils.hglog.write.<anonymous>' call
            if (!this.yh(LogType_WTF_getInstance())) {
              return Unit_instance;
            }
            try {
              if (this.de_1 == null) {
                this.fe_1 = true;
                var file = hgfile_instance.mf(this.be_1);
                this.de_1 = file.hf();
                this.fe_1 = this.de_1 == null;
                Companion_getInstance_2().vh_1.vh_1.cf([file]);
              }
              var tmp0_safe_receiver = this.de_1;
              if (tmp0_safe_receiver == null) null;
              else {
                // Inline function 'kotlin.apply' call
                // Inline function 'kotlin.contracts.contract' call
                // Inline function 'com.hgwen.hgutils.hglog.write.<anonymous>.<anonymous>' call
                writeString(tmp0_safe_receiver, Companion_getInstance_3().ii("yyyy-MM-dd HH:mm:ss.SSS "));
                writeString(tmp0_safe_receiver, " " + get_currentThreadId(hgutils_instance).toString() + "\t" + str + "\n");
                this.le_1 = 0;
              }
            } catch ($p) {
              if ($p instanceof Error) {
                var e_5 = $p;
                var tmp_3 = this.ie_1;
                var tmp_4 = LogType_E_getInstance();
                var tmp_5 = this.ce_1;
                var tmp1_elvis_lhs = e_5.message;
                tmp_3(tmp_4, tmp_5, tmp1_elvis_lhs == null ? e_5.toString() : tmp1_elvis_lhs);
                printStackTrace(e_5);
                var tmp_6 = this;
                var _unary__edvuaz = this.le_1;
                this.le_1 = (_unary__edvuaz + 1) | 0;
                tmp_6.fe_1 = _unary__edvuaz > 10;
              } else {
                throw $p;
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_6 = $p;
              Companion_getInstance_2().cf([e_6]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_7 = $p;
          Companion_getInstance_2().cf([e_7]);
        } else {
          throw $p;
        }
      }
    };
    protoOf(hglog).yh = function (type) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMeWithoutLog' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hglog$isEnable$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hglog$isEnable$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3(tmp_0).zd();
                new _no_name_provided__qut3iv_6().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hglog$isEnable$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hglog$isEnable$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_3(tmp_2).zd();
            new _no_name_provided__qut3iv().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            var enable = this.ge_1.h1(type) || (this.ee_1 && this.ge_1.h1(LogType_WTF_getInstance()));
            if (!enable) {
              this.ke_1();
              enable = this.ge_1.h1(type) || (this.ee_1 && this.ge_1.h1(LogType_WTF_getInstance()));
            }
            return enable;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              printStackTrace(e_5);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          printStackTrace(e_6);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(hglog).zh = function (type, str) {
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
              try {
                if (hgcallme_instance.re_1) {
                  var tmp = hglog$logs$lambda;
                  var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp);
                  alwaysCallMe.zd();
                }
              } catch ($p) {
                if ($p instanceof Error) {
                  var e = $p;
                  Companion_getInstance_2().cf([e]);
                } else {
                  throw $p;
                }
              }
              var t = null;
              try {
                if (hgcallme_instance.re_1) {
                  try {
                    var tmp_0 = hglog$logs$lambda_0;
                    new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp_0).zd();
                    new _no_name_provided__qut3iv_7().ae();
                  } catch ($p) {
                    if ($p instanceof Error) {
                      var e_0 = $p;
                      Companion_getInstance_2().cf([e_0]);
                    } else {
                      throw $p;
                    }
                  }
                }
                if (hgcallme_instance.se_1) {
                  try {
                    Companion_getInstance_2().qe("");
                    t = Unit_instance;
                  } catch ($p) {
                    if ($p instanceof Error) {
                      var e_1 = $p;
                      Companion_getInstance_2().cf([e_1]);
                    } else {
                      throw $p;
                    }
                  }
                }
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_2 = $p;
                  Companion_getInstance_2().cf([e_2]);
                } else {
                  throw $p;
                }
              }
              ensureNotNull(t);
              var tmp_1 = hglog$logs$lambda_1;
              var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp_1);
              alwaysCallMe_0.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_3 = $p;
              Companion_getInstance_2().cf([e_3]);
            } else {
              throw $p;
            }
          }
          var t_0 = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_2 = hglog$logs$lambda_2;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp_2).zd();
                new _no_name_provided__qut3iv_0().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_4 = $p;
                  Companion_getInstance_2().cf([e_4]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                this.qe("");
                t_0 = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_5 = $p;
                  Companion_getInstance_2().cf([e_5]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_6 = $p;
              Companion_getInstance_2().cf([e_6]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t_0);
          var tmp_3 = hglog$logs$lambda_3(this);
          var alwaysCallMe_1 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp_3);
          alwaysCallMe_1.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_7 = $p;
          Companion_getInstance_2().vh_1.cf([e_7]);
        } else {
          throw $p;
        }
      }
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMeWithoutLog' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp_4 = hglog$logs$lambda_4;
              var alwaysCallMe_2 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp_4);
              alwaysCallMe_2.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_8 = $p;
              Companion_getInstance_2().cf([e_8]);
            } else {
              throw $p;
            }
          }
          var t_1 = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_5 = hglog$logs$lambda_5;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp_5).zd();
                new _no_name_provided__qut3iv_8().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_9 = $p;
                  Companion_getInstance_2().cf([e_9]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t_1 = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_10 = $p;
                  Companion_getInstance_2().cf([e_10]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_11 = $p;
              Companion_getInstance_2().cf([e_11]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t_1);
          var tmp_6 = hglog$logs$lambda_6;
          var alwaysCallMe_3 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp_6);
          alwaysCallMe_3.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_12 = $p;
          Companion_getInstance_2().cf([e_12]);
        } else {
          throw $p;
        }
      }
      var t_2 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_7 = hglog$logs$lambda_7;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_4(tmp_7).zd();
            new _no_name_provided__qut3iv().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_13 = $p;
              Companion_getInstance_2().cf([e_13]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            try {
              if (!this.yh(type)) {
                return Unit_instance;
              }
              var log = this.je_1(str);
              this.ie_1(type, this.ce_1, log);
              if ((type.equals(LogType_WTF_getInstance()) || this.ee_1) && this.yh(LogType_WTF_getInstance()) && !this.fe_1) {
                this.xh(log);
              }
              var splitLength = 3000;
              if (str.length > splitLength) {
                var i = 0;
                while (i < str.length) {
                  var tmp_8 = this.je_1;
                  // Inline function 'kotlin.text.substring' call
                  var startIndex = i;
                  // Inline function 'kotlin.math.min' call
                  var a = (i + splitLength) | 0;
                  var b = str.length;
                  var endIndex = Math.min(a, b);
                  // Inline function 'kotlin.js.asDynamic' call
                  var s = tmp_8(str.substring(startIndex, endIndex));
                  this.ie_1(type, this.ce_1, s);
                  i = (i + splitLength) | 0;
                }
              }
            } catch ($p) {
              if ($p instanceof Error) {
                var e_14 = $p;
                printStackTrace(e_14);
              } else {
                throw $p;
              }
            }
            t_2 = Unit_instance;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_15 = $p;
              printStackTrace(e_15);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_16 = $p;
          printStackTrace(e_16);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_2);
    };
    protoOf(hglog).ai = function (type, args) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMeWithoutLog' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hglog$log$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hglog$log$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5(tmp_0).zd();
                new _no_name_provided__qut3iv_9().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hglog$log$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hglog$log$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_5(tmp_2).zd();
            new _no_name_provided__qut3iv().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            if (!this.yh(type)) {
              return Unit_instance;
            }
            if (this.pe_1()) {
              return Unit_instance;
            }
            this.zh(type, hgutils_instance.ji(args.slice()));
            t_0 = Unit_instance;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              printStackTrace(e_5);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          printStackTrace(e_6);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6(function_0) {
      this.ki_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6).zd = function () {
      return this.ki_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6).k2 = function () {
      return this.ki_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6).hashCode = function () {
      return hashCode(this.k2());
    };
    function hgmath$formatDegree$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgmath$formatDegree$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_10() {}
    protoOf(_no_name_provided__qut3iv_10).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hgmath$formatDegree$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgmath$formatDegree$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgmath() {
      this.ng_1 = 2.718281828459045;
      this.og_1 = 3.141592653589793;
      this.pg_1 = 0.017453292519943295;
      this.qg_1 = 57.29577951308232;
    }
    protoOf(hgmath).li = function (var0, var1) {
      // Inline function 'kotlin.math.abs' call
      var x = var0 - var1;
      var var2 = Math.abs(x);
      var tmp;
      if (var2 <= 1.0e-20) {
        tmp = true;
      } else {
        // Inline function 'kotlin.math.abs' call
        var tmp_0 = Math.abs(var0);
        // Inline function 'kotlin.math.abs' call
        var tmp$ret$2 = Math.abs(var1);
        var var3 = coerceAtLeast(tmp_0, tmp$ret$2);
        tmp = var2 <= var3 * 2.220446049250313e-16;
      }
      return tmp;
    };
    protoOf(hgmath).mi = function (value) {
      return getNumberHashCode(value);
    };
    protoOf(hgmath).ni = function (v) {
      return this.li(v, 0.0) ? 0 : v > 0 ? 1 : -1;
    };
    protoOf(hgmath).rg = function (angdeg) {
      return angdeg * 0.017453292519943295;
    };
    protoOf(hgmath).oi = function (angrad) {
      return angrad * 57.29577951308232;
    };
    protoOf(hgmath).pi = function (deg, around) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hgmath$formatDegree$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hgmath$formatDegree$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6(tmp_0).zd();
                new _no_name_provided__qut3iv_10().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hgmath$formatDegree$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hgmath$formatDegree$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_6(tmp_2).zd();
            new _no_name_provided__qut3iv_0().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            var degree = deg;
            while (degree < around - 180) {
              degree = degree + 360.0;
            }
            while (degree > around + 180) {
              degree = degree - 360.0;
            }
            return degree;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              Companion_getInstance_2().cf([e_5]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          Companion_getInstance_2().cf([e_6]);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(hgmath).qi = function (deg, around, $super) {
      around = around === VOID ? 0.0 : around;
      return $super === VOID ? this.pi(deg, around) : $super.pi.call(this, deg, around);
    };
    var hgmath_instance;
    function hgmath_getInstance() {
      return hgmath_instance;
    }
    function Companion_3() {
      Companion_instance_4 = this;
      hgtime.call(this);
      this.gi_1 = new hgtime();
      this.hi_1 = new Long(0, 0);
    }
    protoOf(Companion_3).ri = function () {
      return this.si().ui();
    };
    protoOf(Companion_3).vi = function (_set____db54di) {
      this.hi_1 = _set____db54di;
    };
    protoOf(Companion_3).ui = function () {
      return this.ri();
    };
    protoOf(Companion_3).wi = function () {
      this.gi_1.vi(systemTime(this.gi_1));
      return this.gi_1;
    };
    protoOf(Companion_3).si = function () {
      return this.wi();
    };
    protoOf(Companion_3).ii = function (format) {
      return formatTime(this, format, this.ri());
    };
    var Companion_instance_4;
    function Companion_getInstance_3() {
      if (Companion_instance_4 == null) new Companion_3();
      return Companion_instance_4;
    }
    function hgtime(milliseconds) {
      Companion_getInstance_3();
      milliseconds = milliseconds === VOID ? new Long(0, 0) : milliseconds;
      this.ti_1 = milliseconds;
    }
    protoOf(hgtime).vi = function (_set____db54di) {
      this.ti_1 = _set____db54di;
    };
    protoOf(hgtime).ui = function () {
      return this.ti_1;
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7(function_0) {
      this.xi_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7).zd = function () {
      return this.xi_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7).k2 = function () {
      return this.xi_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7).hashCode = function () {
      return hashCode(this.k2());
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8(function_0) {
      this.yi_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8).zd = function () {
      return this.yi_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8).k2 = function () {
      return this.yi_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8).hashCode = function () {
      return hashCode(this.k2());
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9(function_0) {
      this.zi_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9).zd = function () {
      return this.zi_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9).k2 = function () {
      return this.zi_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9).hashCode = function () {
      return hashCode(this.k2());
    };
    function hgutils$toString$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils$toString$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_11() {}
    protoOf(_no_name_provided__qut3iv_11).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hgutils$toString$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils$toString$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils$toString$lambda_3(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$toString$lambda_4(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$toString$lambda_5(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$toString$lambda_6(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$toString$lambda_7(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$toString$lambda_8(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$toString$lambda_9(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$toString$lambda_10(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$toString$lambda_11(it) {
      return hgutils_instance.ji([it]);
    }
    function hgutils$isEmpty$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils$isEmpty$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_12() {}
    protoOf(_no_name_provided__qut3iv_12).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hgutils$isEmpty$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils$isEmpty$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils$parse$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils$parse$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_13() {}
    protoOf(_no_name_provided__qut3iv_13).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function hgutils$parse$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils$parse$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function hgutils() {}
    protoOf(hgutils).ji = function (objs) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMeWithoutLog' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hgutils$toString$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hgutils$toString$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7(tmp_0).zd();
                new _no_name_provided__qut3iv_11().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hgutils$toString$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hgutils$toString$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_7(tmp_2).zd();
            new _no_name_provided__qut3iv().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            var tmp_3;
            try {
              if (hgutils_instance.aj(objs)) return "";
              var obj = objs[0];
              if (objs.length === 1) {
                var tmp_4;
                if (obj == null) {
                  tmp_4 = "";
                } else {
                  if (!(obj == null) ? isByteArray(obj) : false) {
                    tmp_4 = joinToString_6(obj, " ", "[", "]", VOID, VOID, hgutils$toString$lambda_3);
                  } else {
                    if (!(obj == null) ? isIntArray(obj) : false) {
                      tmp_4 = joinToString_5(obj, ", ", "[", "]", VOID, VOID, hgutils$toString$lambda_4);
                    } else {
                      if (!(obj == null) ? isLongArray(obj) : false) {
                        tmp_4 = joinToString_4(obj, ", ", "[", "]", VOID, VOID, hgutils$toString$lambda_5);
                      } else {
                        if (!(obj == null) ? isFloatArray(obj) : false) {
                          tmp_4 = joinToString_3(obj, ", ", "[", "]", VOID, VOID, hgutils$toString$lambda_6);
                        } else {
                          if (!(obj == null) ? isDoubleArray(obj) : false) {
                            tmp_4 = joinToString_2(obj, ", ", "[", "]", VOID, VOID, hgutils$toString$lambda_7);
                          } else {
                            if (!(obj == null) ? isArray(obj) : false) {
                              tmp_4 = joinToString_1(obj, ", ", "[", "]", VOID, VOID, hgutils$toString$lambda_8);
                            } else {
                              if (!(obj == null) ? isInterface(obj, Collection) : false) {
                                tmp_4 = joinToString_0(obj, ", ", "[", "]", VOID, VOID, hgutils$toString$lambda_9);
                              } else {
                                if (!(obj == null) ? isInterface(obj, Sequence) : false) {
                                  tmp_4 = joinToString(obj, ", ", "[", "]", VOID, VOID, hgutils$toString$lambda_10);
                                } else {
                                  if (!(obj == null) ? isInterface(obj, KtMap) : false) {
                                    tmp_4 = hgutils_instance.ji([obj.o1()]);
                                  } else {
                                    if (!(obj == null) ? isInterface(obj, Entry) : false) {
                                      tmp_4 = formatString(hgutils_instance, "[%s]=%s", [hgutils_instance.ji([obj.j1()]), hgutils_instance.ji([obj.k1()])]);
                                    } else {
                                      if (obj instanceof Error) {
                                        tmp_4 = "Throwable:" + stackTraceToString(obj);
                                      } else {
                                        if (!(obj == null) ? typeof obj === "number" : false) {
                                          tmp_4 = formatString(hgutils_instance, "%.6f", [obj]);
                                        } else {
                                          if (!(obj == null) ? typeof obj === "number" : false) {
                                            tmp_4 = formatString(hgutils_instance, "%.6f", [obj]);
                                          } else {
                                            if (!(obj == null) ? typeof obj === "number" : false) {
                                              tmp_4 = formatString(hgutils_instance, "%02X", [obj]);
                                            } else {
                                              tmp_4 = toString_0(obj);
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
                return tmp_4;
              }
              var tmp_5;
              if (!(obj == null) ? typeof obj === "string" : false) {
                tmp_5 = contains(obj, "%");
              } else {
                tmp_5 = false;
              }
              if (tmp_5) {
                return formatString(hgutils_instance, obj, sliceArray(objs, until(1, objs.length)).slice());
              }
              return joinToString_1(objs, ", ", "[", "]", VOID, VOID, hgutils$toString$lambda_11);
            } catch ($p) {
              var tmp_6;
              if ($p instanceof Error) {
                var e_5 = $p;
                return stackTraceToString(e_5);
              } else {
                throw $p;
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_6 = $p;
              printStackTrace(e_6);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_7 = $p;
          printStackTrace(e_7);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(hgutils).aj = function (obj) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hgutils$isEmpty$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hgutils$isEmpty$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8(tmp_0).zd();
                new _no_name_provided__qut3iv_12().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hgutils$isEmpty$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hgutils$isEmpty$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_8(tmp_2).zd();
            new _no_name_provided__qut3iv_0().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            var tmp_3;
            if (obj == null) {
              tmp_3 = true;
            } else {
              if (!(obj == null) ? isArray(obj) : false) {
                // Inline function 'kotlin.collections.isEmpty' call
                tmp_3 = obj.length === 0;
              } else {
                if (!(obj == null) ? isInterface(obj, Collection) : false) {
                  tmp_3 = obj.i();
                } else {
                  if (!(obj == null) ? isInterface(obj, KtMap) : false) {
                    tmp_3 = obj.i();
                  } else {
                    if (!(obj == null) ? isByteArray(obj) : false) {
                      // Inline function 'kotlin.collections.isEmpty' call
                      tmp_3 = obj.length === 0;
                    } else {
                      if (!(obj == null) ? isIntArray(obj) : false) {
                        // Inline function 'kotlin.collections.isEmpty' call
                        tmp_3 = obj.length === 0;
                      } else {
                        if (!(obj == null) ? isLongArray(obj) : false) {
                          // Inline function 'kotlin.collections.isEmpty' call
                          tmp_3 = obj.length === 0;
                        } else {
                          if (!(obj == null) ? isFloatArray(obj) : false) {
                            // Inline function 'kotlin.collections.isEmpty' call
                            tmp_3 = obj.length === 0;
                          } else {
                            if (!(obj == null) ? isDoubleArray(obj) : false) {
                              // Inline function 'kotlin.collections.isEmpty' call
                              tmp_3 = obj.length === 0;
                            } else {
                              if (!(obj == null) ? isCharSequence(obj) : false) {
                                // Inline function 'kotlin.text.isEmpty' call
                                tmp_3 = charSequenceLength(obj) === 0;
                              } else {
                                if (!(obj == null) ? typeof obj === "boolean" : false) {
                                  tmp_3 = !obj;
                                } else {
                                  if (!(obj == null) ? typeof obj === "number" : false) {
                                    tmp_3 = obj === 0;
                                  } else {
                                    if (!(obj == null) ? typeof obj === "number" : false) {
                                      tmp_3 = obj === 0;
                                    } else {
                                      if (!(obj == null) ? typeof obj === "number" : false) {
                                        tmp_3 = equals(obj, 0);
                                      } else {
                                        if (obj instanceof Long) {
                                          tmp_3 = equals(obj, new Long(0, 0));
                                        } else {
                                          if (!(obj == null) ? typeof obj === "number" : false) {
                                            tmp_3 = obj === 0.0;
                                          } else {
                                            if (!(obj == null) ? typeof obj === "number" : false) {
                                              tmp_3 = obj === 0.0;
                                            } else {
                                              tmp_3 = false;
                                            }
                                          }
                                        }
                                      }
                                    }
                                  }
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
            return tmp_3;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              Companion_getInstance_2().cf([e_5]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          Companion_getInstance_2().cf([e_6]);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(hgutils).bj = function (v) {
      // Inline function 'kotlin.math.abs' call
      return Math.abs(v) < 1.0e-20;
    };
    protoOf(hgutils).df = function (s, defaultValue) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = hgutils$parse$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = hgutils$parse$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9(tmp_0).zd();
                new _no_name_provided__qut3iv_13().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = hgutils$parse$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = hgutils$parse$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_9(tmp_2).zd();
            new _no_name_provided__qut3iv_0().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            var tmp_3;
            if (s == null) {
              tmp_3 = null;
            } else {
              // Inline function 'kotlin.text.trim' call
              tmp_3 = toString_0(trim(isCharSequence(s) ? s : THROW_CCE()));
            }
            var tmp1_elvis_lhs = tmp_3;
            var tmp_4;
            if (tmp1_elvis_lhs == null) {
              return defaultValue;
            } else {
              tmp_4 = tmp1_elvis_lhs;
            }
            var str = tmp_4;
            var tmp_5;
            if (!(defaultValue == null) ? typeof defaultValue === "string" : false) {
              tmp_5 = hgutils_instance.cj(str);
            } else {
              if (!(defaultValue == null) ? typeof defaultValue === "number" : false) {
                tmp_5 = hgutils_instance.cj(toInt(str));
              } else {
                if (!(defaultValue == null) ? typeof defaultValue === "number" : false) {
                  tmp_5 = hgutils_instance.cj(toShort(str));
                } else {
                  if (defaultValue instanceof Long) {
                    tmp_5 = hgutils_instance.cj(toLong(str));
                  } else {
                    if (!(defaultValue == null) ? typeof defaultValue === "number" : false) {
                      var tmp_6 = hgutils_instance;
                      // Inline function 'kotlin.text.toFloat' call
                      // Inline function 'kotlin.js.unsafeCast' call
                      // Inline function 'kotlin.js.asDynamic' call
                      var tmp$ret$4 = toDouble(str);
                      tmp_5 = tmp_6.cj(tmp$ret$4);
                    } else {
                      if (!(defaultValue == null) ? typeof defaultValue === "number" : false) {
                        tmp_5 = hgutils_instance.cj(toDouble(str));
                      } else {
                        if (!(defaultValue == null) ? typeof defaultValue === "boolean" : false) {
                          tmp_5 = hgutils_instance.cj(toBoolean(str));
                        } else {
                          if (!(defaultValue == null) ? typeof defaultValue === "number" : false) {
                            tmp_5 = hgutils_instance.cj(toByte(str));
                          } else {
                            if (defaultValue instanceof Char) {
                              tmp_5 = hgutils_instance.cj(new Char(numberToChar(toInt(str))));
                            } else {
                              if (defaultValue instanceof hgtime) {
                                tmp_5 = hgutils_instance.cj(parseTime(Companion_getInstance_3(), "yyyy-MM-dd HH:mm:ss.SSS", str));
                              } else {
                                if (!(defaultValue == null) ? isDoubleArray(defaultValue) : false) {
                                  var tmp_7 = hgutils_instance;
                                  var tmp$ret$9;
                                  $l$block: {
                                    // Inline function 'kotlin.getOrDefault' call
                                    // Inline function 'kotlin.runCatching' call
                                    var tmp_8;
                                    try {
                                      // Inline function 'kotlin.Companion.success' call
                                      // Inline function 'com.hgwen.hgutils.hgutils.parse.<anonymous>.<anonymous>' call
                                      var items = split(trim_0(str, taggedArrayCopy(toCharArray("()[]{}"))), [","]);
                                      var v = new Float64Array(items.p());
                                      var iterator = items.l();
                                      var index = 0;
                                      while (iterator.m()) {
                                        var i = index;
                                        index = (index + 1) | 0;
                                        var item = iterator.n();
                                        v[i] = hgutils_instance.df(item, defaultValue[i]);
                                      }
                                      tmp_8 = _Result___init__impl__xyqfz8(v);
                                    } catch ($p) {
                                      var tmp_9;
                                      if ($p instanceof Error) {
                                        var e_5 = $p;
                                        // Inline function 'kotlin.Companion.failure' call
                                        tmp_9 = _Result___init__impl__xyqfz8(createFailure(e_5));
                                      } else {
                                        throw $p;
                                      }
                                      tmp_8 = tmp_9;
                                    }
                                    var this_0 = tmp_8;
                                    if (_Result___get_isFailure__impl__jpiriv(this_0)) {
                                      tmp$ret$9 = defaultValue;
                                      break $l$block;
                                    }
                                    var tmp_10 = _Result___get_value__impl__bjfvqg(this_0);
                                    tmp$ret$9 = (tmp_10 == null ? true : !(tmp_10 == null)) ? tmp_10 : THROW_CCE();
                                  }
                                  tmp_5 = tmp_7.cj(tmp$ret$9);
                                } else {
                                  tmp_5 = defaultValue;
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
            return tmp_5;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_6 = $p;
              Companion_getInstance_2().cf([e_6]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_7 = $p;
          Companion_getInstance_2().cf([e_7]);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(hgutils).cj = function (_this__u8e3s4) {
      return (_this__u8e3s4 == null ? true : !(_this__u8e3s4 == null)) ? _this__u8e3s4 : THROW_CCE();
    };
    protoOf(hgutils).ri = function () {
      return Companion_getInstance_3().ri();
    };
    var hgutils_instance;
    function hgutils_getInstance() {
      return hgutils_instance;
    }
    function matrixnd_init_$Init$(mat, $this) {
      matrixnd.call($this, mat.dj_1, mat.ej_1, mat.fj_1.sg());
      return $this;
    }
    function matrixnd_init_$Create$(mat) {
      return matrixnd_init_$Init$(mat, objectCreate(protoOf(matrixnd)));
    }
    function Companion_4() {}
    var Companion_instance_5;
    function Companion_getInstance_4() {
      return Companion_instance_5;
    }
    function matrixnd(m, n, v) {
      m = m === VOID ? 3 : m;
      n = n === VOID ? 3 : n;
      v = v === VOID ? vectornd_init_$Create$(imul(m, n)) : v;
      this.dj_1 = m;
      this.ej_1 = n;
      this.fj_1 = v;
      if (!(this.fj_1.p() === imul(this.dj_1, this.ej_1))) {
        this.fj_1.hj(imul(this.dj_1, this.ej_1));
      }
    }
    protoOf(matrixnd).ij = function (r, c) {
      return this.fj_1.o((imul(r, this.ej_1) + c) | 0);
    };
    protoOf(matrixnd).o = function (i) {
      var tmp = 0;
      var tmp_0 = this.ej_1;
      var tmp_1 = new Float64Array(tmp_0);
      while (tmp < tmp_0) {
        var tmp_2 = tmp;
        tmp_1[tmp_2] = this.ij(i, tmp_2);
        tmp = (tmp + 1) | 0;
      }
      return new vectornd(tmp_1);
    };
    protoOf(matrixnd).jj = function (r, c, vi) {
      this.fj_1.kj((imul(r, this.ej_1) + c) | 0, vi);
    };
    protoOf(matrixnd).lj = function (vn) {
      this.fj_1.lj(vn);
      return this;
    };
    protoOf(matrixnd).mj = function (vn) {
      this.fj_1.nj(vn == null ? null : vn.fj_1);
      return this;
    };
    protoOf(matrixnd).sg = function () {
      return matrixnd_init_$Create$(this);
    };
    protoOf(matrixnd).toString = function () {
      var tmp = 0;
      var tmp_0 = this.dj_1;
      // Inline function 'kotlin.arrayOfNulls' call
      var tmp_1 = fillArrayVal(Array(tmp_0), null);
      while (tmp < tmp_0) {
        var tmp_2 = tmp;
        tmp_1[tmp_2] = hgutils_instance.ji([tmp_2, this.dj_1, this.ej_1, this.o(tmp_2)]);
        tmp = (tmp + 1) | 0;
      }
      return joinToString_1(tmp_1, "\n\t\t\t");
    };
    protoOf(matrixnd).oj = function (vn) {
      var tmp;
      if (vn == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'com.hgwen.hgutils.matrixnd.plus.<anonymous>' call
        var tmp_0 = 0;
        var tmp_1 = this.fj_1.p();
        var tmp_2 = new Float64Array(tmp_1);
        while (tmp_0 < tmp_1) {
          var tmp_3 = tmp_0;
          tmp_2[tmp_3] = this.fj_1.o(tmp_3) + vn.fj_1.o(tmp_3);
          tmp_0 = (tmp_0 + 1) | 0;
        }
        tmp = new matrixnd(this.dj_1, this.ej_1, new vectornd(tmp_2));
      }
      var tmp1_elvis_lhs = tmp;
      return tmp1_elvis_lhs == null ? this.sg() : tmp1_elvis_lhs;
    };
    protoOf(matrixnd).pj = function (vn) {
      var t = new matrixnd(this.dj_1, vn.ej_1);
      if (!(this.ej_1 === vn.dj_1)) return t;
      var inductionVariable = 0;
      var last = t.dj_1;
      if (inductionVariable < last)
        do {
          var r = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var inductionVariable_0 = 0;
          var last_0 = t.ej_1;
          if (inductionVariable_0 < last_0)
            do {
              var c = inductionVariable_0;
              inductionVariable_0 = (inductionVariable_0 + 1) | 0;
              var tmp = 0;
              var tmp_0 = this.ej_1;
              var tmp_1 = new Float64Array(tmp_0);
              while (tmp < tmp_0) {
                var tmp_2 = tmp;
                tmp_1[tmp_2] = this.ij(r, tmp_2) * vn.ij(tmp_2, c);
                tmp = (tmp + 1) | 0;
              }
              t.jj(r, c, sum(tmp_1));
            } while (inductionVariable_0 < last_0);
        } while (inductionVariable < last);
      return t;
    };
    protoOf(matrixnd).qj = function () {
      var t = new matrixnd(this.ej_1, this.dj_1);
      var inductionVariable = 0;
      var last = this.ej_1;
      if (inductionVariable < last)
        do {
          var r = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var inductionVariable_0 = 0;
          var last_0 = this.dj_1;
          if (inductionVariable_0 < last_0)
            do {
              var c = inductionVariable_0;
              inductionVariable_0 = (inductionVariable_0 + 1) | 0;
              t.jj(r, c, this.ij(c, r));
            } while (inductionVariable_0 < last_0);
        } while (inductionVariable < last);
      return t;
    };
    function vector2d_init_$Init$($this) {
      vector2d.call($this);
      $this.ag_1 = 0.0;
      $this.bg_1 = 0.0;
      return $this;
    }
    function vector2d_init_$Create$() {
      return vector2d_init_$Init$(objectCreate(protoOf(vector2d)));
    }
    function vector2d_init_$Init$_0(var1, var2, $this) {
      vector2d.call($this);
      $this.ag_1 = var1;
      $this.bg_1 = var2;
      return $this;
    }
    function vector2d_init_$Create$_0(var1, var2) {
      return vector2d_init_$Init$_0(var1, var2, objectCreate(protoOf(vector2d)));
    }
    function vector2d_init_$Init$_1(var1, $this) {
      vector2d.call($this);
      if (var1 == null) {
        Companion_getInstance_2().qe('Parameter "v" was null.');
        return $this;
      }
      $this.rj(var1.x, var1.y);
      return $this;
    }
    function vector2d_init_$Create$_1(var1) {
      return vector2d_init_$Init$_1(var1, objectCreate(protoOf(vector2d)));
    }
    function Companion_5() {}
    protoOf(Companion_5).sj = function (var0, var1) {
      if (var0 === var1 || (this.tj(var0) && this.tj(var1))) {
        return true;
      }
      if (var0 == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
        return false;
      }
      if (var1 == null) {
        Companion_getInstance_2().qe('Parameter "rhs" was null.');
        return false;
      }
      return hgmath_instance.li(var0.ag_1, var1.ag_1) && hgmath_instance.li(var0.bg_1, var1.bg_1);
    };
    protoOf(Companion_5).tj = function (_this__u8e3s4) {
      var tmp;
      if (_this__u8e3s4 == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.run' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'com.hgwen.hgutils.Companion.isZero.<anonymous>' call
        tmp = hgutils_instance.bj(_this__u8e3s4.ag_1) && hgutils_instance.bj(_this__u8e3s4.bg_1);
      }
      var tmp1_elvis_lhs = tmp;
      return tmp1_elvis_lhs == null ? true : tmp1_elvis_lhs;
    };
    var Companion_instance_6;
    function Companion_getInstance_5() {
      return Companion_instance_6;
    }
    protoOf(vector2d).rj = function (var1, var2) {
      this.ag_1 = var1;
      this.bg_1 = var2;
      return this;
    };
    protoOf(vector2d).uj = function () {
      return this.ag_1 * this.ag_1 + this.bg_1 * this.bg_1;
    };
    protoOf(vector2d).vj = function () {
      // Inline function 'kotlin.math.sqrt' call
      var x = this.uj();
      return Math.sqrt(x);
    };
    protoOf(vector2d).toString = function () {
      return numberToInt(this.ag_1) === 116 && (numberToInt(this.bg_1) === 39 || numberToInt(this.bg_1) === 40)
        ? hgutils_instance.ji(["(%.6f,%.6f)", this.ag_1, this.bg_1])
        : numberToInt(this.ag_1) === this.ag_1 && numberToInt(this.bg_1) === this.bg_1
          ? "(" + this.ag_1 + "," + this.bg_1 + ")"
          : hgutils_instance.ji(["(%.6f,%.6f)", this.ag_1, this.bg_1]);
    };
    protoOf(vector2d).dg = function (vec) {
      if (vec == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
      }
      var tmp = this.ag_1;
      var tmp1_elvis_lhs = vec == null ? null : vec.ag_1;
      var tmp_0 = tmp - (tmp1_elvis_lhs == null ? 0.0 : tmp1_elvis_lhs);
      var tmp_1 = this.bg_1;
      var tmp3_elvis_lhs = vec == null ? null : vec.bg_1;
      return vector2d_init_$Create$_0(tmp_0, tmp_1 - (tmp3_elvis_lhs == null ? 0.0 : tmp3_elvis_lhs));
    };
    protoOf(vector2d).cg = function (var1) {
      return vector2d_init_$Create$_0(this.ag_1 * var1, this.bg_1 * var1);
    };
    protoOf(vector2d).wj = function (v) {
      if (v == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
        return 0.0;
      }
      return this.ag_1 * v.ag_1 + this.bg_1 * v.bg_1;
    };
    protoOf(vector2d).xj = function (v) {
      if (v == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
        return 0.0;
      }
      return this.ag_1 * v.bg_1 - this.bg_1 * v.ag_1;
    };
    protoOf(vector2d).equals = function (other) {
      var tmp;
      if (!(other instanceof vector2d)) {
        tmp = false;
      } else {
        var tmp_0;
        if (this === other) {
          tmp_0 = true;
        } else {
          var tmp_1 = Companion_instance_6;
          tmp_0 = tmp_1.sj(this, other instanceof vector2d ? other : THROW_CCE());
        }
        tmp = tmp_0;
      }
      return tmp;
    };
    protoOf(vector2d).hashCode = function () {
      var code = (31 + hgmath_instance.mi(this.ag_1)) | 0;
      code = (imul(code, 31) + hgmath_instance.mi(this.bg_1)) | 0;
      return code;
    };
    protoOf(vector2d).yj = function () {
      if (this.ag_1 === 0.0 && this.bg_1 === 0.0) {
        return 0.0;
      }
      var tmp = hgmath_instance;
      var tmp_0 = hgmath_instance;
      // Inline function 'kotlin.math.atan2' call
      var y = this.bg_1;
      var x = this.ag_1;
      var tmp$ret$0 = Math.atan2(y, x);
      return tmp.qi(90 - tmp_0.oi(tmp$ret$0));
    };
    function vector2d() {
      this.ag_1 = 0.0;
      this.bg_1 = 0.0;
    }
    function vector3d_init_$Init$(var1, var2, var3, $this) {
      vector3d.call($this, var1, var2, var3);
      return $this;
    }
    function vector3d_init_$Create$(var1, var2, var3) {
      return vector3d_init_$Init$(var1, var2, var3, objectCreate(protoOf(vector3d)));
    }
    function vector3d_init_$Init$_0(var1, var2, var3, $this) {
      vector3d.call($this, var1, var2, var3);
      return $this;
    }
    function vector3ddi(var1, var2, var3) {
      return vector3d_init_$Init$_0(var1, var2, var3, objectCreate(protoOf(vector3d)));
    }
    function vector3d_init_$Init$_1(v, $this) {
      var tmp1_elvis_lhs = v == null ? null : v.x;
      var tmp = tmp1_elvis_lhs == null ? 0.0 : tmp1_elvis_lhs;
      var tmp3_elvis_lhs = v == null ? null : v.y;
      var tmp_0 = tmp3_elvis_lhs == null ? 0.0 : tmp3_elvis_lhs;
      var tmp5_elvis_lhs = v == null ? null : v.z;
      vector3d.call($this, tmp, tmp_0, tmp5_elvis_lhs == null ? 0.0 : tmp5_elvis_lhs);
      return $this;
    }
    function vector3d_init_$Create$_0(v) {
      return vector3d_init_$Init$_1(v, objectCreate(protoOf(vector3d)));
    }
    function Companion_6() {}
    protoOf(Companion_6).zj = function (var0, var1) {
      if (var0 == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
        return var1;
      }
      if (var1 == null) {
        Companion_getInstance_2().qe('Parameter "rhs" was null.');
        return var0;
      }
      // Inline function 'kotlin.math.min' call
      var a = var0.x;
      var b = var1.x;
      var tmp = Math.min(a, b);
      // Inline function 'kotlin.math.min' call
      var a_0 = var0.y;
      var b_0 = var1.y;
      var tmp_0 = Math.min(a_0, b_0);
      // Inline function 'kotlin.math.min' call
      var a_1 = var0.z;
      var b_1 = var1.z;
      var tmp$ret$2 = Math.min(a_1, b_1);
      return new vector3d(tmp, tmp_0, tmp$ret$2);
    };
    protoOf(Companion_6).ak = function (var0, var1) {
      if (var0 == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
        return var1;
      }
      if (var1 == null) {
        Companion_getInstance_2().qe('Parameter "rhs" was null.');
        return var0;
      }
      // Inline function 'kotlin.math.max' call
      var a = var0.x;
      var b = var1.x;
      var tmp = Math.max(a, b);
      // Inline function 'kotlin.math.max' call
      var a_0 = var0.y;
      var b_0 = var1.y;
      var tmp_0 = Math.max(a_0, b_0);
      // Inline function 'kotlin.math.max' call
      var a_1 = var0.z;
      var b_1 = var1.z;
      var tmp$ret$2 = Math.max(a_1, b_1);
      return new vector3d(tmp, tmp_0, tmp$ret$2);
    };
    protoOf(Companion_6).bk = function (var0, var1) {
      if (var0 === var1 || (this.ck(var0) && this.ck(var1))) {
        return true;
      }
      if (var0 == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
        return false;
      }
      if (var1 == null) {
        Companion_getInstance_2().qe('Parameter "rhs" was null.');
        return false;
      }
      return hgmath_instance.li(var0.x, var1.x) && hgmath_instance.li(var0.y, var1.y) && hgmath_instance.li(var0.z, var1.z);
    };
    protoOf(Companion_6).ck = function (_this__u8e3s4) {
      var tmp1_elvis_lhs = _this__u8e3s4 == null ? null : _this__u8e3s4.dk();
      return tmp1_elvis_lhs == null ? true : tmp1_elvis_lhs;
    };
    protoOf(Companion_6).ek = function () {
      return new vector3d().fk();
    };
    protoOf(Companion_6).gk = function () {
      return new vector3d().hk();
    };
    protoOf(Companion_6).ik = function () {
      return new vector3d().jk();
    };
    var Companion_instance_7;
    function Companion_getInstance_6() {
      return Companion_instance_7;
    }
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10(function_0) {
      this.kk_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10).zd = function () {
      return this.kk_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10).k2 = function () {
      return this.kk_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10).hashCode = function () {
      return hashCode(this.k2());
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11(function_0) {
      this.lk_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11).zd = function () {
      return this.lk_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11).k2 = function () {
      return this.lk_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11).hashCode = function () {
      return hashCode(this.k2());
    };
    function sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12(function_0) {
      this.mk_1 = function_0;
    }
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12).zd = function () {
      return this.mk_1();
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12).k2 = function () {
      return this.mk_1;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, AlwaysCallMe) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12).hashCode = function () {
      return hashCode(this.k2());
    };
    function vector3d$distanceToSegment$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d$distanceToSegment$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_14() {}
    protoOf(_no_name_provided__qut3iv_14).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function vector3d$distanceToSegment$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d$distanceToSegment$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d$matchToSegment$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d$matchToSegment$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_15() {}
    protoOf(_no_name_provided__qut3iv_15).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function vector3d$matchToSegment$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d$matchToSegment$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d$matchesToSegment$lambda() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d$matchesToSegment$lambda_0() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function _no_name_provided__qut3iv_16() {}
    protoOf(_no_name_provided__qut3iv_16).ae = function () {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    };
    function vector3d$matchesToSegment$lambda_1() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d$matchesToSegment$lambda_2() {
      Companion_getInstance_2().qe("");
      return Unit_instance;
    }
    function vector3d(x, y, z) {
      x = x === VOID ? 0.0 : x;
      y = y === VOID ? 0.0 : y;
      z = z === VOID ? 0.0 : z;
      this.x = x;
      this.y = y;
      this.z = z;
    }
    protoOf(vector3d).nk = function (_set____db54di) {
      this.x = _set____db54di;
    };
    protoOf(vector3d).ok = function () {
      return this.x;
    };
    protoOf(vector3d).pk = function (_set____db54di) {
      this.y = _set____db54di;
    };
    protoOf(vector3d).qk = function () {
      return this.y;
    };
    protoOf(vector3d).rk = function (_set____db54di) {
      this.z = _set____db54di;
    };
    protoOf(vector3d).sk = function () {
      return this.z;
    };
    protoOf(vector3d).o = function (i) {
      var tmp;
      switch (i) {
        case 0:
          tmp = this.x;
          break;
        case 1:
          tmp = this.y;
          break;
        case 2:
          tmp = this.z;
          break;
        default:
          throw IndexOutOfBoundsException_init_$Create$();
      }
      return tmp;
    };
    protoOf(vector3d).kj = function (i, v) {
      switch (i) {
        case 0:
          this.x = v;
          break;
        case 1:
          this.y = v;
          break;
        case 2:
          this.z = v;
          break;
        default:
          throw IndexOutOfBoundsException_init_$Create$();
      }
    };
    protoOf(vector3d).wg = function (v) {
      var tmp;
      if (v == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'com.hgwen.hgutils.vector3d.plus.<anonymous>' call
        tmp = new vector3d(this.x + v.x, this.y + v.y, this.z + v.z);
      }
      var tmp1_elvis_lhs = tmp;
      return tmp1_elvis_lhs == null ? this.sg() : tmp1_elvis_lhs;
    };
    protoOf(vector3d).tg = function (v) {
      var tmp;
      if (v == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'com.hgwen.hgutils.vector3d.minus.<anonymous>' call
        tmp = new vector3d(this.x - v.x, this.y - v.y, this.z - v.z);
      }
      var tmp1_elvis_lhs = tmp;
      return tmp1_elvis_lhs == null ? this.sg() : tmp1_elvis_lhs;
    };
    protoOf(vector3d).cg = function (var1) {
      return new vector3d(this.x * var1, this.y * var1, this.z * var1);
    };
    protoOf(vector3d).ug = function (v) {
      if (v == null) {
        Companion_getInstance_2().qe('Parameter "v" was null.');
      }
      var tmp;
      if (v == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'com.hgwen.hgutils.vector3d.times.<anonymous>' call
        tmp = new vector3d(this.x * v.x, this.y * v.y, this.z * v.z);
      }
      var tmp1_elvis_lhs = tmp;
      return tmp1_elvis_lhs == null ? new vector3d() : tmp1_elvis_lhs;
    };
    protoOf(vector3d).vg = function (v) {
      if (v == null) {
        Companion_getInstance_2().qe('Parameter "v" was null.');
      }
      var tmp;
      if (v == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'com.hgwen.hgutils.vector3d.div.<anonymous>' call
        tmp = new vector3d(this.x / v.x, this.y / v.y, this.z / v.z);
      }
      var tmp1_elvis_lhs = tmp;
      return tmp1_elvis_lhs == null ? new vector3d() : tmp1_elvis_lhs;
    };
    protoOf(vector3d).g2 = function () {
      return new vector3d(-this.x, -this.y, -this.z);
    };
    protoOf(vector3d).x7 = function () {
      return this.x;
    };
    protoOf(vector3d).y7 = function () {
      return this.y;
    };
    protoOf(vector3d).i9 = function () {
      return this.z;
    };
    protoOf(vector3d).toString = function () {
      var tmp;
      var tmp_0;
      var tmp_1;
      var containsArg = this.x;
      if (80.0 <= containsArg ? containsArg <= 130.0 : false) {
        var containsArg_0 = this.y;
        tmp_1 = 20.0 <= containsArg_0 ? containsArg_0 <= 50.0 : false;
      } else {
        tmp_1 = false;
      }
      if (tmp_1) {
        var containsLower = -100.0;
        var containsArg_1 = this.z;
        tmp_0 = containsLower <= containsArg_1 ? containsArg_1 <= 8000.0 : false;
      } else {
        tmp_0 = false;
      }
      if (tmp_0) {
        tmp = hgutils_instance.ji(["(%.6f,%.6f,%.6f)", this.x, this.y, this.z]);
      } else {
        if (numberToInt(this.x) === this.x && numberToInt(this.y) === this.y && numberToInt(this.z) === this.z) {
          tmp = "(" + this.x + "," + this.y + "," + this.z + ")";
        } else {
          tmp = hgutils_instance.ji(["(%.3f,%.3f,%.3f)", this.x, this.y, this.z]);
        }
      }
      return tmp;
    };
    protoOf(vector3d).equals = function (other) {
      var tmp;
      if (!(other instanceof vector3d)) {
        tmp = false;
      } else {
        var tmp_0;
        if (this === other) {
          tmp_0 = true;
        } else {
          var tmp_1 = Companion_instance_7;
          tmp_0 = tmp_1.bk(this, other instanceof vector3d ? other : THROW_CCE());
        }
        tmp = tmp_0;
      }
      return tmp;
    };
    protoOf(vector3d).hashCode = function () {
      var code = (31 + hgmath_instance.mi(this.x)) | 0;
      code = (imul(code, 31) + hgmath_instance.mi(this.y)) | 0;
      return (imul(code, 31) + hgmath_instance.mi(this.z)) | 0;
    };
    protoOf(vector3d).sg = function () {
      return vector3d_init_$Create$_0(this);
    };
    protoOf(vector3d).fg = function () {
      return vector2d_init_$Create$_1(this);
    };
    protoOf(vector3d).uj = function () {
      return this.x * this.x + this.y * this.y + this.z * this.z;
    };
    protoOf(vector3d).vj = function () {
      // Inline function 'kotlin.math.sqrt' call
      var x = this.uj();
      return Math.sqrt(x);
    };
    protoOf(vector3d).tk = function () {
      return this.fg().vj();
    };
    protoOf(vector3d).dk = function () {
      return hgutils_instance.bj(this.x) && hgutils_instance.bj(this.y) && hgutils_instance.bj(this.z);
    };
    protoOf(vector3d).uk = function () {
      return !this.dk();
    };
    protoOf(vector3d).vk = function (var1, var2, var3) {
      this.x = var1;
      this.y = var2;
      this.z = var3;
      return this;
    };
    protoOf(vector3d).fk = function () {
      return this.vk(0.0, 0.0, 1.0);
    };
    protoOf(vector3d).hk = function () {
      return this.vk(0.0, 1.0, 0.0);
    };
    protoOf(vector3d).jk = function () {
      return this.vk(1.0, 0.0, 0.0);
    };
    protoOf(vector3d).yj = function () {
      return this.fg().yj();
    };
    protoOf(vector3d).wk = function (A, B) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = vector3d$distanceToSegment$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = vector3d$distanceToSegment$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10(tmp_0).zd();
                new _no_name_provided__qut3iv_14().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = vector3d$distanceToSegment$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = vector3d$distanceToSegment$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_10(tmp_2).zd();
            new _no_name_provided__qut3iv_0().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            return this.tg(this.xk(A, B)).vj();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              Companion_getInstance_2().cf([e_5]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          Companion_getInstance_2().cf([e_6]);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(vector3d).xk = function (A, B) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = vector3d$matchToSegment$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = vector3d$matchToSegment$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11(tmp_0).zd();
                new _no_name_provided__qut3iv_15().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = vector3d$matchToSegment$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = vector3d$matchToSegment$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_11(tmp_2).zd();
            new _no_name_provided__qut3iv_0().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            if (A.equals(B)) {
              return A;
            }
            var C = this;
            var AB = B.tg(A);
            var v1 = AB.fg();
            var v2 = C.tg(A).fg();
            var v3 = C.tg(B).fg();
            var tmp_3;
            if (hgmath_instance.ni(v1.wj(v2)) < 0) {
              tmp_3 = A;
            } else if (hgmath_instance.ni(v1.wj(v3)) >= 0) {
              tmp_3 = B;
            } else {
              // Inline function 'kotlin.math.abs' call
              var x = v1.xj(v2);
              var d = Math.abs(x) / v1.vj();
              // Inline function 'kotlin.math.sqrt' call
              var x_0 = v2.uj() - d * d;
              var tmp$ret$2 = Math.sqrt(x_0);
              tmp_3 = A.wg(AB.cg(tmp$ret$2 / v1.vj()));
            }
            return tmp_3;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              Companion_getInstance_2().cf([e_5]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          Companion_getInstance_2().cf([e_6]);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(vector3d).yk = function (A, B) {
      // Inline function 'com.hgwen.hgutils.hgcallme.alwaysCallMe' call
      try {
        if (hgcallme_instance.re_1) {
          // Inline function 'com.hgwen.hgutils.hgcallme.hgCallMe' call
          try {
            if (hgcallme_instance.re_1) {
              var tmp = vector3d$matchesToSegment$lambda;
              var alwaysCallMe = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12(tmp);
              alwaysCallMe.zd();
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e = $p;
              Companion_getInstance_2().cf([e]);
            } else {
              throw $p;
            }
          }
          var t = null;
          try {
            if (hgcallme_instance.re_1) {
              try {
                var tmp_0 = vector3d$matchesToSegment$lambda_0;
                new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12(tmp_0).zd();
                new _no_name_provided__qut3iv_16().ae();
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_0 = $p;
                  Companion_getInstance_2().cf([e_0]);
                } else {
                  throw $p;
                }
              }
            }
            if (hgcallme_instance.se_1) {
              try {
                Companion_getInstance_2().qe("");
                t = Unit_instance;
              } catch ($p) {
                if ($p instanceof Error) {
                  var e_1 = $p;
                  Companion_getInstance_2().cf([e_1]);
                } else {
                  throw $p;
                }
              }
            }
          } catch ($p) {
            if ($p instanceof Error) {
              var e_2 = $p;
              Companion_getInstance_2().cf([e_2]);
            } else {
              throw $p;
            }
          }
          ensureNotNull(t);
          var tmp_1 = vector3d$matchesToSegment$lambda_1;
          var alwaysCallMe_0 = new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12(tmp_1);
          alwaysCallMe_0.zd();
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_3 = $p;
          Companion_getInstance_2().cf([e_3]);
        } else {
          throw $p;
        }
      }
      var t_0 = null;
      try {
        if (hgcallme_instance.re_1) {
          try {
            var tmp_2 = vector3d$matchesToSegment$lambda_2;
            new sam$com_hgwen_hgutils_hgcallme_AlwaysCallMe$0_12(tmp_2).zd();
            new _no_name_provided__qut3iv_0().ae();
          } catch ($p) {
            if ($p instanceof Error) {
              var e_4 = $p;
              Companion_getInstance_2().cf([e_4]);
            } else {
              throw $p;
            }
          }
        }
        if (hgcallme_instance.se_1) {
          try {
            if (A.equals(B)) {
              return new Triple(A, A, new vector3d());
            }
            var C = this;
            var AB = B.tg(A);
            var v1 = AB.fg();
            var v2 = C.tg(A).fg();
            var v3 = C.tg(B).fg();
            // Inline function 'kotlin.math.abs' call
            var x = v1.xj(v2);
            var d = Math.abs(x) / v1.vj();
            // Inline function 'kotlin.math.sqrt' call
            var x_0 = v2.uj() - d * d;
            var dis = Math.sqrt(x_0);
            var m = A.wg(AB.cg(dis / v1.vj()));
            var tmp_3;
            if (hgmath_instance.ni(v1.wj(v2)) < 0) {
              tmp_3 = new Triple(A, m, new vector3d(v2.vj(), d, dis));
            } else if (hgmath_instance.ni(v1.wj(v3)) >= 0) {
              var tmp_4 = v3.vj();
              // Inline function 'kotlin.math.sqrt' call
              var x_1 = v3.uj() - d * d;
              var tmp$ret$3 = Math.sqrt(x_1);
              tmp_3 = new Triple(B, m, new vector3d(tmp_4, d, tmp$ret$3));
            } else {
              tmp_3 = new Triple(m, m, vector3ddi(d, d, 0));
            }
            return tmp_3;
          } catch ($p) {
            if ($p instanceof Error) {
              var e_5 = $p;
              Companion_getInstance_2().cf([e_5]);
            } else {
              throw $p;
            }
          }
        }
      } catch ($p) {
        if ($p instanceof Error) {
          var e_6 = $p;
          Companion_getInstance_2().cf([e_6]);
        } else {
          throw $p;
        }
      }
      ensureNotNull(t_0);
    };
    protoOf(vector3d).zk = function (ring) {
      var count = 0;
      var ringSize = ring.p();
      if (ringSize < 3) {
        return false;
      }
      var inductionVariable = 0;
      if (inductionVariable < ringSize)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var p1 = ring.o(i);
          var p2 = ring.o((((i + 1) | 0) % ringSize) | 0);
          if (this.y < p2.y) {
            if (this.y >= p1.y) {
              if ((this.y - p1.y) * (p2.x - p1.x) > (this.x - p1.x) * (p2.y - p1.y)) {
                count = (count + 1) | 0;
              }
            }
          } else if (this.y < p1.y) {
            if ((this.y - p1.y) * (p2.x - p1.x) < (this.x - p1.x) * (p2.y - p1.y)) {
              count = (count - 1) | 0;
            }
          }
        } while (inductionVariable < ringSize);
      return !(count === 0);
    };
    function vector4d_init_$Init$(v, $this) {
      var tmp1_elvis_lhs = v == null ? null : v.x;
      var tmp = tmp1_elvis_lhs == null ? 0.0 : tmp1_elvis_lhs;
      var tmp3_elvis_lhs = v == null ? null : v.y;
      var tmp_0 = tmp3_elvis_lhs == null ? 0.0 : tmp3_elvis_lhs;
      var tmp5_elvis_lhs = v == null ? null : v.z;
      var tmp_1 = tmp5_elvis_lhs == null ? 0.0 : tmp5_elvis_lhs;
      var tmp7_elvis_lhs = v == null ? null : v.w;
      vector4d.call($this, tmp, tmp_0, tmp_1, tmp7_elvis_lhs == null ? 0.0 : tmp7_elvis_lhs);
      return $this;
    }
    function vector4d_init_$Create$(v) {
      return vector4d_init_$Init$(v, objectCreate(protoOf(vector4d)));
    }
    function vector4d_init_$Init$_0(v, w, $this) {
      w = w === VOID ? 0.0 : w;
      var tmp1_elvis_lhs = v == null ? null : v.x;
      var tmp = tmp1_elvis_lhs == null ? 0.0 : tmp1_elvis_lhs;
      var tmp3_elvis_lhs = v == null ? null : v.y;
      var tmp_0 = tmp3_elvis_lhs == null ? 0.0 : tmp3_elvis_lhs;
      var tmp5_elvis_lhs = v == null ? null : v.z;
      vector4d.call($this, tmp, tmp_0, tmp5_elvis_lhs == null ? 0.0 : tmp5_elvis_lhs, w);
      return $this;
    }
    function vector4d_init_$Create$_0(v, w) {
      return vector4d_init_$Init$_0(v, w, objectCreate(protoOf(vector4d)));
    }
    function vector4d0() {}
    protoOf(vector4d0).al = function (axis, degrees) {
      var angle = hgmath_instance.rg(degrees);
      // Inline function 'kotlin.math.sin' call
      var x = angle / 2.0;
      var factor = Math.sin(x);
      var dest = vector4d_init_$Create$_0(axis.cg(factor));
      var tmp = dest;
      // Inline function 'kotlin.math.cos' call
      var x_0 = angle / 2.0;
      tmp.w = Math.cos(x_0);
      return dest.bl();
    };
    protoOf(vector4d0).cl = function (orientation) {
      var qX = this.al(Companion_instance_7.ik(), -orientation.o(1));
      var qY = this.al(Companion_instance_7.gk(), orientation.o(2));
      var qZ = this.al(Companion_instance_7.ek(), -orientation.o(0));
      return qZ.dl(qX).dl(qY);
    };
    protoOf(vector4d0).el = function (var0, var1) {
      if (var0 == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
        return 0.0;
      }
      if (var1 == null) {
        Companion_getInstance_2().qe('Parameter "rhs" was null.');
        return 0.0;
      }
      return var0.x * var1.x + var0.y * var1.y + var0.z * var1.z + var0.w * var1.w;
    };
    protoOf(vector4d0).fl = function (var0, var1) {
      if (var0 === var1 || (this.gl(var0) && this.gl(var1))) {
        return true;
      }
      if (var0 == null) {
        Companion_getInstance_2().qe('Parameter "lhs" was null.');
        return false;
      }
      if (var1 == null) {
        Companion_getInstance_2().qe('Parameter "rhs" was null.');
        return false;
      }
      return (
        hgmath_instance.li(var0.x, var1.x) && hgmath_instance.li(var0.y, var1.y) && hgmath_instance.li(var0.z, var1.z) && hgmath_instance.li(var0.w, var1.w)
      );
    };
    protoOf(vector4d0).gl = function (_this__u8e3s4) {
      var tmp;
      if (_this__u8e3s4 == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.run' call
        // Inline function 'kotlin.contracts.contract' call
        // Inline function 'com.hgwen.hgutils.Companion.isZero.<anonymous>' call
        tmp =
          hgutils_instance.bj(_this__u8e3s4.x) &&
          hgutils_instance.bj(_this__u8e3s4.y) &&
          hgutils_instance.bj(_this__u8e3s4.z) &&
          hgutils_instance.bj(_this__u8e3s4.w);
      }
      var tmp1_elvis_lhs = tmp;
      return tmp1_elvis_lhs == null ? true : tmp1_elvis_lhs;
    };
    var Companion_instance_8;
    function Companion_getInstance_7() {
      return Companion_instance_8;
    }
    function vector4d(x, y, z, w) {
      x = x === VOID ? 0.0 : x;
      y = y === VOID ? 0.0 : y;
      z = z === VOID ? 0.0 : z;
      w = w === VOID ? 0.0 : w;
      this.x = x;
      this.y = y;
      this.z = z;
      this.w = w;
    }
    protoOf(vector4d).nk = function (_set____db54di) {
      this.x = _set____db54di;
    };
    protoOf(vector4d).ok = function () {
      return this.x;
    };
    protoOf(vector4d).pk = function (_set____db54di) {
      this.y = _set____db54di;
    };
    protoOf(vector4d).qk = function () {
      return this.y;
    };
    protoOf(vector4d).rk = function (_set____db54di) {
      this.z = _set____db54di;
    };
    protoOf(vector4d).sk = function () {
      return this.z;
    };
    protoOf(vector4d).hl = function (_set____db54di) {
      this.w = _set____db54di;
    };
    protoOf(vector4d).il = function () {
      return this.w;
    };
    protoOf(vector4d).jl = function (var1) {
      if (var1 == null) {
        Companion_getInstance_2().qe('Parameter "v" was null.');
        return this;
      }
      this.x = var1.x;
      this.y = var1.y;
      this.z = var1.z;
      this.w = var1.w;
      return this;
    };
    protoOf(vector4d).kl = function (var1, var2, var3, var4) {
      this.x = var1;
      this.y = var2;
      this.z = var3;
      this.w = var4;
      return this;
    };
    protoOf(vector4d).ll = function () {
      return this.kl(0.0, 0.0, 0.0, 0.0);
    };
    protoOf(vector4d).ml = function () {
      return new vector4d(this.y, this.z, this.w, this.x);
    };
    protoOf(vector4d).nl = function () {
      return new vector4d(this.w, this.x, this.y, this.z);
    };
    protoOf(vector4d).toString = function () {
      return hgutils_instance.ji(["(%.3f,%.3f,%.3f,%.3f)", this.x, this.y, this.z, this.w]);
    };
    protoOf(vector4d).bl = function () {
      var var1 = vector4d_init_$Create$(this);
      var var2;
      var tmp = hgmath_instance;
      // Inline function 'kotlin.also' call
      var this_0 = Companion_instance_8.el(this, this);
      // Inline function 'kotlin.contracts.contract' call
      // Inline function 'com.hgwen.hgutils.vector4d.normalized.<anonymous>' call
      var2 = this_0;
      if (tmp.li(this_0, 0.0)) {
        var1.ll();
      } else {
        if (!(var2 === 1.0)) {
          // Inline function 'kotlin.math.sqrt' call
          var var3 = 1.0 / Math.sqrt(var2);
          var1.jl(this.cg(var3));
        }
      }
      return var1;
    };
    protoOf(vector4d).o = function (i) {
      var tmp;
      switch (i) {
        case 0:
          tmp = this.x;
          break;
        case 1:
          tmp = this.y;
          break;
        case 2:
          tmp = this.z;
          break;
        case 3:
          tmp = this.w;
          break;
        default:
          throw IndexOutOfBoundsException_init_$Create$();
      }
      return tmp;
    };
    protoOf(vector4d).cg = function (var1) {
      return new vector4d(this.x * var1, this.y * var1, this.z * var1, this.w * var1);
    };
    protoOf(vector4d).dl = function (rhs) {
      var lhs = this;
      var lx = lhs.x;
      var ly = lhs.y;
      var lz = lhs.z;
      var lw = lhs.w;
      var rx = rhs.x;
      var ry = rhs.y;
      var rz = rhs.z;
      var rw = rhs.w;
      return new vector4d(
        lw * rx + lx * rw + ly * rz - lz * ry,
        lw * ry - lx * rz + ly * rw + lz * rx,
        lw * rz + lx * ry - ly * rx + lz * rw,
        lw * rw - lx * rx - ly * ry - lz * rz,
      );
    };
    protoOf(vector4d).equals = function (other) {
      var tmp;
      if (!(other instanceof vector4d)) {
        tmp = false;
      } else {
        var tmp_0;
        if (this === other) {
          tmp_0 = true;
        } else {
          var tmp_1 = Companion_instance_8;
          tmp_0 = tmp_1.fl(this, other instanceof vector4d ? other : THROW_CCE());
        }
        tmp = tmp_0;
      }
      return tmp;
    };
    protoOf(vector4d).hashCode = function () {
      var code = (31 + hgmath_instance.mi(this.x)) | 0;
      code = (imul(code, 31) + hgmath_instance.mi(this.y)) | 0;
      code = (imul(code, 31) + hgmath_instance.mi(this.z)) | 0;
      return (imul(code, 31) + hgmath_instance.mi(this.w)) | 0;
    };
    protoOf(vector4d).ol = function () {
      var rotationVector = this;
      var R = new Float64Array(16);
      var q0 = rotationVector.o(3);
      var q1 = rotationVector.o(0);
      var q2 = rotationVector.o(1);
      var q3 = rotationVector.o(2);
      var sq_q1 = 2 * q1 * q1;
      var sq_q2 = 2 * q2 * q2;
      var sq_q3 = 2 * q3 * q3;
      var q1_q2 = 2 * q1 * q2;
      var q3_q0 = 2 * q3 * q0;
      var q1_q3 = 2 * q1 * q3;
      var q2_q0 = 2 * q2 * q0;
      var q2_q3 = 2 * q2 * q3;
      var q1_q0 = 2 * q1 * q0;
      R[0] = 1 - sq_q2 - sq_q3;
      R[1] = q1_q2 - q3_q0;
      R[2] = q1_q3 + q2_q0;
      R[3] = 0.0;
      R[4] = q1_q2 + q3_q0;
      R[5] = 1 - sq_q1 - sq_q3;
      R[6] = q2_q3 - q1_q0;
      R[7] = 0.0;
      R[8] = q1_q3 - q2_q0;
      R[9] = q2_q3 + q1_q0;
      R[10] = 1 - sq_q1 - sq_q2;
      R[11] = 0.0;
      R[14] = 0.0;
      R[13] = R[14];
      R[12] = R[13];
      R[15] = 1.0;
      var values = new vector3d();
      // Inline function 'kotlin.math.atan2' call
      var y = R[1];
      var x = R[5];
      var tmp$ret$0 = Math.atan2(y, x);
      values.kj(0, tmp$ret$0);
      // Inline function 'kotlin.math.asin' call
      var x_0 = -R[9];
      var tmp$ret$1 = Math.asin(x_0);
      values.kj(1, tmp$ret$1);
      // Inline function 'kotlin.math.atan2' call
      var y_0 = -R[8];
      var x_1 = R[10];
      var tmp$ret$2 = Math.atan2(y_0, x_1);
      values.kj(2, tmp$ret$2);
      return values.cg(57.29577951308232);
    };
    function vectornd_init_$Init$(n, $this) {
      vectornd.call($this, new Float64Array(n));
      return $this;
    }
    function vectornd_init_$Create$(n) {
      return vectornd_init_$Init$(n, objectCreate(protoOf(vectornd)));
    }
    function vectornd_init_$Init$_0(vec, $this) {
      // Inline function 'kotlin.collections.copyOf' call
      // Inline function 'kotlin.js.asDynamic' call
      var tmp$ret$1 = vec.gj_1.slice();
      vectornd.call($this, tmp$ret$1);
      return $this;
    }
    function vectornd_init_$Create$_0(vec) {
      return vectornd_init_$Init$_0(vec, objectCreate(protoOf(vectornd)));
    }
    function Companion_7() {}
    var Companion_instance_9;
    function Companion_getInstance_8() {
      return Companion_instance_9;
    }
    function vectornd(v) {
      v = v === VOID ? new Float64Array(5) : v;
      this.gj_1 = v;
    }
    protoOf(vectornd).p = function () {
      return this.gj_1.length;
    };
    protoOf(vectornd).o = function (i) {
      return (0 <= i ? i <= ((this.gj_1.length - 1) | 0) : false) ? this.gj_1[i] : 0.0;
    };
    protoOf(vectornd).kj = function (i, vi) {
      if (0 <= i ? i <= ((this.gj_1.length - 1) | 0) : false) {
        this.gj_1[i] = vi;
      }
    };
    protoOf(vectornd).lj = function (vn) {
      var inductionVariable = 0;
      var last = (this.gj_1.length - 1) | 0;
      if (inductionVariable <= last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var tmp1_elvis_lhs = vn == null ? null : numberToDouble(vn);
          this.gj_1[i] = tmp1_elvis_lhs == null ? 0.0 : tmp1_elvis_lhs;
        } while (inductionVariable <= last);
      return this;
    };
    protoOf(vectornd).nj = function (vn) {
      var tmp;
      if (vn == null) {
        tmp = null;
      } else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        var inductionVariable = 0;
        var last = (this.gj_1.length - 1) | 0;
        if (inductionVariable <= last)
          do {
            var i = inductionVariable;
            inductionVariable = (inductionVariable + 1) | 0;
            this.gj_1[i] = vn.o(i);
          } while (inductionVariable <= last);
        tmp = Unit_instance;
      }
      if (tmp == null) this.lj(0);
      return this;
    };
    protoOf(vectornd).toString = function () {
      return hgutils_instance.ji([this.gj_1.length, this.gj_1]);
    };
    protoOf(vectornd).equals = function (other) {
      var tmp;
      if (!(other instanceof vectornd)) {
        tmp = false;
      } else {
        if (this === other) {
          tmp = true;
        } else {
          tmp = contentEquals(this.gj_1, other.gj_1);
        }
      }
      return tmp;
    };
    protoOf(vectornd).hashCode = function () {
      return hashCode(this.gj_1);
    };
    protoOf(vectornd).sg = function () {
      return vectornd_init_$Create$_0(this);
    };
    protoOf(vectornd).x7 = function () {
      var tmp;
      if (this.gj_1.length < 1) {
        tmp = 0.0;
      } else {
        // Inline function 'kotlin.collections.component1' call
        tmp = this.gj_1[0];
      }
      return tmp;
    };
    protoOf(vectornd).y7 = function () {
      var tmp;
      if (this.gj_1.length < 2) {
        tmp = 0.0;
      } else {
        // Inline function 'kotlin.collections.component2' call
        tmp = this.gj_1[1];
      }
      return tmp;
    };
    protoOf(vectornd).i9 = function () {
      var tmp;
      if (this.gj_1.length < 3) {
        tmp = 0.0;
      } else {
        // Inline function 'kotlin.collections.component3' call
        tmp = this.gj_1[2];
      }
      return tmp;
    };
    protoOf(vectornd).pl = function () {
      var tmp;
      if (this.gj_1.length < 4) {
        tmp = 0.0;
      } else {
        // Inline function 'kotlin.collections.component4' call
        tmp = this.gj_1[3];
      }
      return tmp;
    };
    protoOf(vectornd).ql = function () {
      var tmp;
      if (this.gj_1.length < 5) {
        tmp = 0.0;
      } else {
        // Inline function 'kotlin.collections.component5' call
        tmp = this.gj_1[4];
      }
      return tmp;
    };
    protoOf(vectornd).rl = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 5 ? 5 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[5];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component6.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).sl = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 6 ? 6 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[6];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component7.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).tl = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 7 ? 7 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[7];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component8.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).ul = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 8 ? 8 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[8];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component9.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).vl = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 9 ? 9 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[9];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component10.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).wl = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 10 ? 10 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[10];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component11.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).xl = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 11 ? 11 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[11];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component12.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).yl = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 12 ? 12 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[12];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component13.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).zl = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 13 ? 13 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[13];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component14.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).am = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 14 ? 14 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[14];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component15.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).bm = function () {
      // Inline function 'kotlin.collections.getOrElse' call
      var this_0 = this.gj_1;
      // Inline function 'kotlin.contracts.contract' call
      var tmp;
      if (0 <= 15 ? 15 <= ((this_0.length - 1) | 0) : false) {
        tmp = this_0[15];
      } else {
        // Inline function 'com.hgwen.hgutils.vectornd.component16.<anonymous>' call
        tmp = 0.0;
      }
      return tmp;
    };
    protoOf(vectornd).hj = function (n) {
      var tmp = 0;
      var tmp_0 = new Float64Array(n);
      while (tmp < n) {
        var tmp_1 = tmp;
        tmp_0[tmp_1] = this.o(tmp_1);
        tmp = (tmp + 1) | 0;
      }
      return new vectornd(tmp_0);
    };
    function init_top_level_properties() {
      Companion_getInstance_2().qe("init_top_level_properties");
    }
    function get_currentThreadId(_this__u8e3s4) {
      return new Long(0, 0);
    }
    function formatString(_this__u8e3s4, format, args) {
      return joinToString_0(listOf(arrayConcat([[format], args])), ",");
    }
    function formatTime(_this__u8e3s4, format, time) {
      return time.toString();
    }
    function get_Size(_this__u8e3s4) {
      var tmp = _this__u8e3s4 == null ? null : _this__u8e3s4.yg_1;
      var tmp1_safe_receiver = (!(tmp == null) ? isArray(tmp) : false) ? tmp : null;
      var tmp2_elvis_lhs = tmp1_safe_receiver == null ? null : tmp1_safe_receiver.length;
      return tmp2_elvis_lhs == null ? 0 : tmp2_elvis_lhs;
    }
    function hgjsonIterator(j) {
      this.cm_1 = j;
      var tmp = this;
      var tmp_0 = this.cm_1.yg_1;
      var tmp0_safe_receiver = (!(tmp_0 == null) ? isArray(tmp_0) : false) ? tmp_0 : null;
      tmp.dm_1 = tmp0_safe_receiver == null ? null : arrayIterator(tmp0_safe_receiver);
    }
    protoOf(hgjsonIterator).n = function () {
      var tmp0_safe_receiver = this.dm_1;
      return new hgjson(ensureNotNull(tmp0_safe_receiver == null ? null : tmp0_safe_receiver.n()));
    };
    protoOf(hgjsonIterator).m = function () {
      var tmp0_safe_receiver = this.dm_1;
      var tmp1_elvis_lhs = tmp0_safe_receiver == null ? null : tmp0_safe_receiver.m();
      return tmp1_elvis_lhs == null ? false : tmp1_elvis_lhs;
    };
    function Parse(_this__u8e3s4, s) {
      var tmp;
      if (!(s == null) ? typeof s === "string" : false) {
        tmp = new hgjson(JSON.parse(s));
      } else {
        if (!(s == null)) {
          tmp = new hgjson(s);
        } else {
          tmp = null;
        }
      }
      return tmp;
    }
    function parseTime(_this__u8e3s4, format, time) {
      return new hgtime(numberToLong(Date.parse(replace(time, _Char___init__impl__6a9atx(32), _Char___init__impl__6a9atx(84)) + "Z") * 1000));
    }
    function systemTime(_this__u8e3s4) {
      return numberToLong(Date.now() * 1000);
    }
    //region block: init
    hgcallme_instance = new hgcallme();
    hgfile_instance = new hgfile();
    Companion_instance_2 = new Companion_1();
    hgmath_instance = new hgmath();
    hgutils_instance = new hgutils();
    Companion_instance_5 = new Companion_4();
    Companion_instance_6 = new Companion_5();
    Companion_instance_7 = new Companion_6();
    Companion_instance_8 = new vector4d0();
    Companion_instance_9 = new Companion_7();
    //endregion
    //region block: exports
    _.$_$ = _.$_$ || {};
    _.$_$.a = hgjson;
    _.$_$.b = matrixnd;
    _.$_$.c = vector3d;
    _.$_$.d = vector4d;
    _.$_$.e = vector3d_init_$Create$;
    _.$_$.f = vectornd_init_$Create$;
    _.$_$.g = Companion_getInstance;
    _.$_$.h = Companion_getInstance_0;
    _.$_$.i = Companion_instance_2;
    _.$_$.j = Companion_getInstance_2;
    _.$_$.k = hgmath_instance;
    _.$_$.l = hgutils_instance;
    _.$_$.m = Companion_instance_7;
    _.$_$.n = Companion_instance_8;
    //endregion
    return _;
  })({}, kotlin_kotlin, kotlin_org_jetbrains_kotlinx_kotlinx_io_core, kotlin_org_jetbrains_kotlinx_kotlinx_coroutines_core);

  //# sourceMappingURL=NewSDK-Exts-hgutils.js.map
  var kotlin_NewSDK_Exts_RoadMapMatcher = (function (_, kotlin_com_hgwen_hgutils_hgutils, kotlin_kotlin) {
    "use strict";
    //region block: imports
    var imul = Math.imul;
    var Companion_getInstance = kotlin_com_hgwen_hgutils_hgutils.$_$.h;
    var hgutils_instance = kotlin_com_hgwen_hgutils_hgutils.$_$.l;
    var protoOf = kotlin_kotlin.$_$.o3;
    var initMetadataForClass = kotlin_kotlin.$_$.w2;
    var HashMap_init_$Create$ = kotlin_kotlin.$_$.f;
    var Unit_instance = kotlin_kotlin.$_$.y;
    var ArrayList_init_$Create$ = kotlin_kotlin.$_$.e;
    var removeFirst = kotlin_kotlin.$_$.z1;
    var Companion_getInstance_0 = kotlin_com_hgwen_hgutils_hgutils.$_$.j;
    var THROW_CCE = kotlin_kotlin.$_$.y4;
    var KtMap = kotlin_kotlin.$_$.b1;
    var isInterface = kotlin_kotlin.$_$.g3;
    var ensureNotNull = kotlin_kotlin.$_$.b5;
    var initMetadataForObject = kotlin_kotlin.$_$.z2;
    var vector3d = kotlin_com_hgwen_hgutils_hgutils.$_$.c;
    var VOID = kotlin_kotlin.$_$.c;
    var getNumberHashCode = kotlin_kotlin.$_$.s2;
    var hashCode = kotlin_kotlin.$_$.v2;
    var equals = kotlin_kotlin.$_$.p2;
    var getStringHashCode = kotlin_kotlin.$_$.u2;
    var getBooleanHashCode = kotlin_kotlin.$_$.r2;
    var first = kotlin_kotlin.$_$.i1;
    var Long = kotlin_kotlin.$_$.w4;
    var hgmath_instance = kotlin_com_hgwen_hgutils_hgutils.$_$.k;
    var min = kotlin_kotlin.$_$.w1;
    var Companion_instance = kotlin_com_hgwen_hgutils_hgutils.$_$.m;
    var initMetadataForCompanion = kotlin_kotlin.$_$.x2;
    var Entry = kotlin_kotlin.$_$.a1;
    var hgjson = kotlin_com_hgwen_hgutils_hgutils.$_$.a;
    var Pair = kotlin_kotlin.$_$.x4;
    var hashMapOf = kotlin_kotlin.$_$.j1;
    var Companion_instance_0 = kotlin_com_hgwen_hgutils_hgutils.$_$.i;
    var isBlank = kotlin_kotlin.$_$.b4;
    //endregion
    //region block: pre-declaration
    initMetadataForClass(RouteLine, "RouteLine");
    initMetadataForObject(RoadNet, "RoadNet");
    initMetadataForClass(LocPoint, "LocPoint", LocPoint);
    initMetadataForClass(MatchConfig, "MatchConfig", MatchConfig);
    initMetadataForClass(Geofence, "Geofence");
    initMetadataForClass(MatchSession, "MatchSession");
    initMetadataForCompanion(Companion);
    initMetadataForClass(RoadMapMatcher, "RoadMapMatcher", RoadMapMatcher);
    //endregion
    function RouteLine(featureId, from, to) {
      this.em_1 = featureId;
      this.fm_1 = from;
      this.gm_1 = to;
      this.hm_1 = Companion_getInstance().rf_1.kg(this.fm_1);
      this.im_1 = Companion_getInstance().rf_1.kg(this.gm_1);
      this.jm_1 = this.im_1.tg(this.hm_1);
      this.km_1 = this.jm_1.yj();
    }
    protoOf(RouteLine).toString = function () {
      return hgutils_instance.ji([this.fm_1, this.gm_1]);
    };
    function RoadNet() {
      RoadNet_instance = this;
      this.lm_1 = HashMap_init_$Create$();
    }
    protoOf(RoadNet).mm = function (net, r1, r2, m1, m2) {
      if (r2 === r1) {
        // Inline function 'kotlin.collections.set' call
        var value = m1.tg(m2).tk();
        net.t3(r2, value);
        return Unit_instance;
      }
      var q = ArrayList_init_$Create$();
      q.r2(r1);
      $l$loop: while (true) {
        // Inline function 'kotlin.collections.isNotEmpty' call
        if (!!q.i()) {
          break $l$loop;
        }
        var r0 = removeFirst(q);
        var tmp0_safe_receiver = this.lm_1.n1(r0);
        var roads = tmp0_safe_receiver == null ? null : tmp0_safe_receiver.om_1;
        // Inline function 'kotlin.collections.isNullOrEmpty' call
        // Inline function 'kotlin.contracts.contract' call
        if (roads == null || roads.i()) {
          Companion_getInstance_0().cf(["searchRoads", r0, roads]);
          return Unit_instance;
        }
        var _iterator__ex2g4s = roads.l();
        $l$loop_0: while (_iterator__ex2g4s.m()) {
          var road = _iterator__ex2g4s.n();
          var r = road.nm_1.em_1;
          // Inline function 'kotlin.collections.contains' call
          // Inline function 'kotlin.collections.containsKey' call
          if ((isInterface(net, KtMap) ? net : THROW_CCE()).l1(r)) continue $l$loop_0;
          var d = 0.0;
          if (r0 === r1) {
            if (
              ensureNotNull(this.lm_1.n1(r1)).nm_1.hm_1.tg(road.nm_1.hm_1).tk() < 0.01 ||
              ensureNotNull(this.lm_1.n1(r1)).nm_1.hm_1.tg(road.nm_1.im_1).tk() < 0.01
            ) {
              d = ensureNotNull(this.lm_1.n1(r1)).nm_1.hm_1.tg(m1).tk();
            } else if (
              ensureNotNull(this.lm_1.n1(r1)).nm_1.im_1.tg(road.nm_1.hm_1).tk() < 0.01 ||
              ensureNotNull(this.lm_1.n1(r1)).nm_1.im_1.tg(road.nm_1.im_1).tk() < 0.01
            ) {
              d = ensureNotNull(this.lm_1.n1(r1)).nm_1.im_1.tg(m1).tk();
            }
          }
          if (r === r2) {
            if (
              ensureNotNull(this.lm_1.n1(r0)).nm_1.hm_1.tg(road.nm_1.hm_1).tk() < 0.01 ||
              ensureNotNull(this.lm_1.n1(r0)).nm_1.im_1.tg(road.nm_1.hm_1).tk() < 0.01
            ) {
              d = d + road.nm_1.hm_1.tg(m2).tk();
            } else if (
              ensureNotNull(this.lm_1.n1(r0)).nm_1.hm_1.tg(road.nm_1.im_1).tk() < 0.01 ||
              ensureNotNull(this.lm_1.n1(r0)).nm_1.im_1.tg(road.nm_1.im_1).tk() < 0.01
            ) {
              d = d + road.nm_1.im_1.tg(m2).tk();
            }
            // Inline function 'kotlin.collections.set' call
            var value_0 = ensureNotNull(net.n1(r0)) + d;
            net.t3(r, value_0);
            return Unit_instance;
          } else {
            // Inline function 'kotlin.collections.set' call
            var value_1 = ensureNotNull(net.n1(r0)) + d + road.nm_1.jm_1.tk();
            net.t3(r, value_1);
            q.r2(r);
          }
        }
      }
    };
    protoOf(RoadNet).pm = function (l1, l2, m1, m2) {
      var net = HashMap_init_$Create$();
      var r1 = l1.em_1;
      var r2 = l2.em_1;
      // Inline function 'kotlin.collections.set' call
      net.t3(r1, 0.0);
      this.mm(net, r1, r2, m1, m2);
      var tmp0_elvis_lhs = net.n1(r2);
      return tmp0_elvis_lhs == null ? 0.0 : tmp0_elvis_lhs;
    };
    var RoadNet_instance;
    function RoadNet_getInstance() {
      if (RoadNet_instance == null) new RoadNet();
      return RoadNet_instance;
    }
    function LocPoint(coord, position, pos, accuracy, step, orient, timestamp, matched, matchedDis, matchedLine, calibration, frangle, altitude) {
      coord = coord === VOID ? new vector3d() : coord;
      position = position === VOID ? new vector3d() : position;
      pos = pos === VOID ? new vector3d() : pos;
      accuracy = accuracy === VOID ? 0.0 : accuracy;
      step = step === VOID ? 0 : step;
      orient = orient === VOID ? 0.0 : orient;
      timestamp = timestamp === VOID ? (Companion_getInstance_1().um_1 ? Companion_getInstance_1().vm_1 : hgutils_instance.ri()) : timestamp;
      matched = matched === VOID ? new vector3d() : matched;
      matchedDis = matchedDis === VOID ? 0.0 : matchedDis;
      matchedLine = matchedLine === VOID ? null : matchedLine;
      calibration = calibration === VOID ? new vector3d() : calibration;
      frangle = frangle === VOID ? 0.0 : frangle;
      altitude = altitude === VOID ? 0.0 : altitude;
      this.wm_1 = coord;
      this.xm_1 = position;
      this.ym_1 = pos;
      this.zm_1 = accuracy;
      this.an_1 = step;
      this.bn_1 = orient;
      this.cn_1 = timestamp;
      this.dn_1 = matched;
      this.en_1 = matchedDis;
      this.fn_1 = matchedLine;
      this.gn_1 = calibration;
      this.hn_1 = frangle;
      this.in_1 = altitude;
    }
    protoOf(LocPoint).toString = function () {
      return hgutils_instance.ji([
        this.wm_1,
        this.xm_1,
        this.ym_1,
        this.zm_1,
        this.an_1,
        this.bn_1,
        this.cn_1,
        this.dn_1,
        this.en_1,
        this.fn_1,
        this.gn_1,
        this.hn_1,
        this.in_1,
      ]);
    };
    protoOf(LocPoint).hashCode = function () {
      var result = this.wm_1.hashCode();
      result = (imul(result, 31) + this.xm_1.hashCode()) | 0;
      result = (imul(result, 31) + this.ym_1.hashCode()) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.zm_1)) | 0;
      result = (imul(result, 31) + this.an_1) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.bn_1)) | 0;
      result = (imul(result, 31) + this.cn_1.hashCode()) | 0;
      result = (imul(result, 31) + this.dn_1.hashCode()) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.en_1)) | 0;
      result = (imul(result, 31) + (this.fn_1 == null ? 0 : hashCode(this.fn_1))) | 0;
      result = (imul(result, 31) + this.gn_1.hashCode()) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.hn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.in_1)) | 0;
      return result;
    };
    protoOf(LocPoint).equals = function (other) {
      if (this === other) return true;
      if (!(other instanceof LocPoint)) return false;
      var tmp0_other_with_cast = other instanceof LocPoint ? other : THROW_CCE();
      if (!this.wm_1.equals(tmp0_other_with_cast.wm_1)) return false;
      if (!this.xm_1.equals(tmp0_other_with_cast.xm_1)) return false;
      if (!this.ym_1.equals(tmp0_other_with_cast.ym_1)) return false;
      if (!equals(this.zm_1, tmp0_other_with_cast.zm_1)) return false;
      if (!(this.an_1 === tmp0_other_with_cast.an_1)) return false;
      if (!equals(this.bn_1, tmp0_other_with_cast.bn_1)) return false;
      if (!this.cn_1.equals(tmp0_other_with_cast.cn_1)) return false;
      if (!this.dn_1.equals(tmp0_other_with_cast.dn_1)) return false;
      if (!equals(this.en_1, tmp0_other_with_cast.en_1)) return false;
      if (!equals(this.fn_1, tmp0_other_with_cast.fn_1)) return false;
      if (!this.gn_1.equals(tmp0_other_with_cast.gn_1)) return false;
      if (!equals(this.hn_1, tmp0_other_with_cast.hn_1)) return false;
      if (!equals(this.in_1, tmp0_other_with_cast.in_1)) return false;
      return true;
    };
    function MatchConfig(
      group,
      matching,
      debugging,
      maxGraspDistance,
      maxInterruptedTime,
      maxInterruptedDistance,
      maxHoldStillDistance,
      maxForwardDirectionDistance,
      minForwardDirectionDistance,
      routeDirectionFactor,
      keepDirectionFactor,
      nextRouteFactor,
      routeDistanceFactor,
      walkOrientationFactor,
      deviceOrientationFactor,
      offsetFactor,
      maxOffset,
      maxOffsetAngle,
      maxNextRouteDistance,
      altitudeFactor,
      routeAltitudes,
    ) {
      group = group === VOID ? "" : group;
      matching = matching === VOID ? true : matching;
      debugging = debugging === VOID ? false : debugging;
      maxGraspDistance = maxGraspDistance === VOID ? 50.0 : maxGraspDistance;
      maxInterruptedTime = maxInterruptedTime === VOID ? 10000.0 : maxInterruptedTime;
      maxInterruptedDistance = maxInterruptedDistance === VOID ? 10.0 : maxInterruptedDistance;
      maxHoldStillDistance = maxHoldStillDistance === VOID ? 0.2 : maxHoldStillDistance;
      maxForwardDirectionDistance = maxForwardDirectionDistance === VOID ? 5.0 : maxForwardDirectionDistance;
      minForwardDirectionDistance = minForwardDirectionDistance === VOID ? 0.5 : minForwardDirectionDistance;
      routeDirectionFactor = routeDirectionFactor === VOID ? 3.0 : routeDirectionFactor;
      keepDirectionFactor = keepDirectionFactor === VOID ? 1.0 : keepDirectionFactor;
      nextRouteFactor = nextRouteFactor === VOID ? 1.0 : nextRouteFactor;
      routeDistanceFactor = routeDistanceFactor === VOID ? 1.0 : routeDistanceFactor;
      walkOrientationFactor = walkOrientationFactor === VOID ? 1.0 : walkOrientationFactor;
      deviceOrientationFactor = deviceOrientationFactor === VOID ? 1.0 : deviceOrientationFactor;
      offsetFactor = offsetFactor === VOID ? 0.1 : offsetFactor;
      maxOffset = maxOffset === VOID ? new vector3d(10.0, 10.0, 10.0) : maxOffset;
      maxOffsetAngle = maxOffsetAngle === VOID ? 40.0 : maxOffsetAngle;
      maxNextRouteDistance = maxNextRouteDistance === VOID ? 3.0 : maxNextRouteDistance;
      altitudeFactor = altitudeFactor === VOID ? 1.0 : altitudeFactor;
      routeAltitudes = routeAltitudes === VOID ? HashMap_init_$Create$() : routeAltitudes;
      this.jn_1 = group;
      this.kn_1 = matching;
      this.ln_1 = debugging;
      this.mn_1 = maxGraspDistance;
      this.nn_1 = maxInterruptedTime;
      this.on_1 = maxInterruptedDistance;
      this.pn_1 = maxHoldStillDistance;
      this.qn_1 = maxForwardDirectionDistance;
      this.rn_1 = minForwardDirectionDistance;
      this.sn_1 = routeDirectionFactor;
      this.tn_1 = keepDirectionFactor;
      this.un_1 = nextRouteFactor;
      this.vn_1 = routeDistanceFactor;
      this.wn_1 = walkOrientationFactor;
      this.xn_1 = deviceOrientationFactor;
      this.yn_1 = offsetFactor;
      this.zn_1 = maxOffset;
      this.ao_1 = maxOffsetAngle;
      this.bo_1 = maxNextRouteDistance;
      this.co_1 = altitudeFactor;
      this.do_1 = routeAltitudes;
    }
    protoOf(MatchConfig).toString = function () {
      return hgutils_instance.ji([
        "matching=",
        this.kn_1,
        "debugging=",
        this.ln_1,
        "maxGraspDistance=",
        this.mn_1,
        "maxInterruptedTime=",
        this.nn_1,
        "maxInterruptedDistance=",
        this.on_1,
        "maxHoldStillDistance=",
        this.pn_1,
        "maxForwardDirectionDistance=",
        this.qn_1,
        "minForwardDirectionDistance=",
        this.rn_1,
        "routeDirectionFactor=",
        this.sn_1,
        "keepDirectionFactor=",
        this.tn_1,
        "nextRouteFactor=",
        this.un_1,
        "routeDistanceFactor=",
        this.vn_1,
        "walkOrientationFactor=",
        this.wn_1,
        "deviceOrientationFactor=",
        this.xn_1,
        "offsetFactor=",
        this.yn_1,
        "maxOffset=",
        this.zn_1,
        "maxOffsetAngle=",
        this.ao_1,
        "maxNextRouteDistance=",
        this.bo_1,
        "altitudeFactor=",
        this.co_1,
        "routeAltitudes.size=",
        this.do_1.p(),
      ]);
    };
    protoOf(MatchConfig).hashCode = function () {
      var result = getStringHashCode(this.jn_1);
      result = (imul(result, 31) + getBooleanHashCode(this.kn_1)) | 0;
      result = (imul(result, 31) + getBooleanHashCode(this.ln_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.mn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.nn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.on_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.pn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.qn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.rn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.sn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.tn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.un_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.vn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.wn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.xn_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.yn_1)) | 0;
      result = (imul(result, 31) + this.zn_1.hashCode()) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.ao_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.bo_1)) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.co_1)) | 0;
      result = (imul(result, 31) + this.do_1.hashCode()) | 0;
      return result;
    };
    protoOf(MatchConfig).equals = function (other) {
      if (this === other) return true;
      if (!(other instanceof MatchConfig)) return false;
      var tmp0_other_with_cast = other instanceof MatchConfig ? other : THROW_CCE();
      if (!(this.jn_1 === tmp0_other_with_cast.jn_1)) return false;
      if (!(this.kn_1 === tmp0_other_with_cast.kn_1)) return false;
      if (!(this.ln_1 === tmp0_other_with_cast.ln_1)) return false;
      if (!equals(this.mn_1, tmp0_other_with_cast.mn_1)) return false;
      if (!equals(this.nn_1, tmp0_other_with_cast.nn_1)) return false;
      if (!equals(this.on_1, tmp0_other_with_cast.on_1)) return false;
      if (!equals(this.pn_1, tmp0_other_with_cast.pn_1)) return false;
      if (!equals(this.qn_1, tmp0_other_with_cast.qn_1)) return false;
      if (!equals(this.rn_1, tmp0_other_with_cast.rn_1)) return false;
      if (!equals(this.sn_1, tmp0_other_with_cast.sn_1)) return false;
      if (!equals(this.tn_1, tmp0_other_with_cast.tn_1)) return false;
      if (!equals(this.un_1, tmp0_other_with_cast.un_1)) return false;
      if (!equals(this.vn_1, tmp0_other_with_cast.vn_1)) return false;
      if (!equals(this.wn_1, tmp0_other_with_cast.wn_1)) return false;
      if (!equals(this.xn_1, tmp0_other_with_cast.xn_1)) return false;
      if (!equals(this.yn_1, tmp0_other_with_cast.yn_1)) return false;
      if (!this.zn_1.equals(tmp0_other_with_cast.zn_1)) return false;
      if (!equals(this.ao_1, tmp0_other_with_cast.ao_1)) return false;
      if (!equals(this.bo_1, tmp0_other_with_cast.bo_1)) return false;
      if (!equals(this.co_1, tmp0_other_with_cast.co_1)) return false;
      if (!this.do_1.equals(tmp0_other_with_cast.do_1)) return false;
      return true;
    };
    function Geofence(fenceId, type, group, floorId, ring) {
      this.eo_1 = fenceId;
      this.fo_1 = type;
      this.go_1 = group;
      this.ho_1 = floorId;
      this.io_1 = ring;
    }
    protoOf(Geofence).toString = function () {
      return hgutils_instance.ji([this.eo_1, this.fo_1, this.go_1, this.ho_1, this.io_1]);
    };
    protoOf(Geofence).hashCode = function () {
      var result = getStringHashCode(this.eo_1);
      result = (imul(result, 31) + getStringHashCode(this.fo_1)) | 0;
      result = (imul(result, 31) + getStringHashCode(this.go_1)) | 0;
      result = (imul(result, 31) + getStringHashCode(this.ho_1)) | 0;
      result = (imul(result, 31) + this.io_1.hashCode()) | 0;
      return result;
    };
    protoOf(Geofence).equals = function (other) {
      if (this === other) return true;
      if (!(other instanceof Geofence)) return false;
      var tmp0_other_with_cast = other instanceof Geofence ? other : THROW_CCE();
      if (!(this.eo_1 === tmp0_other_with_cast.eo_1)) return false;
      if (!(this.fo_1 === tmp0_other_with_cast.fo_1)) return false;
      if (!(this.go_1 === tmp0_other_with_cast.go_1)) return false;
      if (!(this.ho_1 === tmp0_other_with_cast.ho_1)) return false;
      if (!this.io_1.equals(tmp0_other_with_cast.io_1)) return false;
      return true;
    };
    function MatchSession($outer, lastPoint, offset, offsetTimes, abnormalCount) {
      lastPoint = lastPoint === VOID ? new LocPoint() : lastPoint;
      offset = offset === VOID ? new vector3d() : offset;
      offsetTimes = offsetTimes === VOID ? 0 : offsetTimes;
      abnormalCount = abnormalCount === VOID ? 0 : abnormalCount;
      this.no_1 = $outer;
      this.jo_1 = lastPoint;
      this.ko_1 = offset;
      this.lo_1 = offsetTimes;
      this.mo_1 = abnormalCount;
    }
    protoOf(MatchSession).oo = function () {
      Companion_getInstance_0().cf([]);
      this.jo_1 = new LocPoint(VOID, VOID, VOID, VOID, VOID, VOID, this.jo_1.cn_1);
      this.ko_1 = new vector3d();
      this.lo_1 = 0;
      this.mo_1 = 0;
    };
    protoOf(MatchSession).po = function (coord, floorId, type, accuracy, step, orient, timestamp) {
      try {
        if (type === Companion_getInstance_1().rm_1) {
          Companion_getInstance_0().cf(["\u5B9A\u4F4D\u7C7B\u578B", coord, type]);
          return coord;
        }
        var lines = this.no_1.uo_1.n1(floorId);
        // Inline function 'kotlin.collections.isNullOrEmpty' call
        var this_0 = lines;
        // Inline function 'kotlin.contracts.contract' call
        if (this_0 == null || this_0.i()) {
          if (this.no_1.uo_1.p() === 1) {
            lines = first(this.no_1.uo_1.s3());
          }
          // Inline function 'kotlin.collections.isNullOrEmpty' call
          var this_1 = lines;
          // Inline function 'kotlin.contracts.contract' call
          if (this_1 == null || this_1.i()) {
            Companion_getInstance_0().cf(["\u697C\u5C42", coord, floorId, this.no_1.uo_1.p()]);
            return coord;
          }
        }
        this.no_1.zo(coord, floorId);
        if (!this.no_1.vo_1.kn_1) {
          Companion_getInstance_0().qe("\u56F4\u680F\u89C4\u5219\u4E0D\u6293\u8DEF");
          return coord;
        }
        var cp = new LocPoint(coord);
        cp.xm_1 = Companion_getInstance().rf_1.kg(coord);
        cp.ym_1 = cp.xm_1.wg(this.lo_1 > 5 ? this.ko_1 : new vector3d());
        if (timestamp.equals(new Long(0, 0))) {
          Companion_getInstance_0().cf(["reset", timestamp]);
          this.oo();
        } else {
          cp.cn_1 = timestamp;
        }
        Companion_getInstance_0().cf([this.jo_1]);
        var duration = cp.cn_1.a2(this.jo_1.cn_1);
        if (duration.j2() > this.no_1.vo_1.nn_1 || duration.y1(new Long(0, 0)) < 0 || cp.xm_1.tg(this.jo_1.xm_1).vj() > this.no_1.vo_1.on_1) {
          Companion_getInstance_0().cf(["reset", duration, cp.cn_1, this.jo_1.cn_1, this.no_1.vo_1.nn_1, cp.xm_1.tg(this.jo_1.xm_1).vj(), this.no_1.vo_1.on_1]);
          this.oo();
        }
        var forward = new vector3d();
        var forwardLength = 0.0;
        var forwardDirection = hgmath_instance.pi(orient, 0.0);
        if (this.jo_1.wm_1.uk()) {
          forward = cp.xm_1.tg(this.jo_1.xm_1);
          forwardLength = forward.vj();
          if (forwardLength < this.no_1.vo_1.pn_1) {
            this.jo_1.cn_1 = cp.cn_1;
            return Companion_getInstance().rf_1.lg(this.jo_1.dn_1);
          }
          if (forwardLength > this.no_1.vo_1.qn_1) {
            var tmp = this;
            // Inline function 'kotlin.math.min' call
            var b = (this.mo_1 + 5) | 0;
            tmp.mo_1 = Math.min(10, b);
          } else {
            var tmp_0 = this;
            // Inline function 'kotlin.math.max' call
            var b_0 = (this.mo_1 - 1) | 0;
            tmp_0.mo_1 = Math.max(0, b_0);
          }
          if (type === Companion_getInstance_1().GPS || type === Companion_getInstance_1().sm_1) {
            if (forwardLength > this.no_1.vo_1.rn_1) {
              forwardDirection = forward.yj();
              if (this.no_1.vo_1.ln_1) {
                Companion_getInstance_0().cf([
                  step,
                  "\u65B9\u5411",
                  (hgmath_instance.pi(orient, forwardDirection) * this.no_1.vo_1.xn_1 + forwardDirection * this.no_1.vo_1.wn_1) /
                    (this.no_1.vo_1.xn_1 + this.no_1.vo_1.wn_1),
                  "\u624B\u673A\u65B9\u5411",
                  orient,
                  this.no_1.vo_1.xn_1,
                  "\u524D\u8FDB\u65B9\u5411",
                  forwardDirection,
                  this.no_1.vo_1.wn_1,
                  this.no_1.vo_1.xn_1 + this.no_1.vo_1.wn_1,
                ]);
              }
              forwardDirection =
                (hgmath_instance.pi(orient, forwardDirection) * this.no_1.vo_1.xn_1 + forwardDirection * this.no_1.vo_1.wn_1) /
                (this.no_1.vo_1.xn_1 + this.no_1.vo_1.wn_1);
            }
          } else {
            forwardDirection = forward.yj();
          }
        }
        if (this.no_1.vo_1.ln_1) {
          Companion_getInstance_0().cf([
            step,
            "\u5F53\u524D\u70B9",
            cp,
            "\u4E0A\u4E00\u70B9",
            this.jo_1,
            "\u4F4D\u79FB",
            forward,
            "\u957F\u5EA6",
            forwardLength,
            "\u65B9\u5411",
            forwardDirection,
          ]);
        }
        cp.dn_1 = cp.ym_1;
        cp.en_1 = 1000.0;
        var hasMatched = false;
        var _iterator__ex2g4s = lines.l();
        $l$loop_1: while (_iterator__ex2g4s.m()) {
          var line = _iterator__ex2g4s.n();
          if (line.gm_1.dk()) {
            continue $l$loop_1;
          }
          var _destruct__k2r9zo = cp.ym_1.yk(line.hm_1, line.im_1);
          var matched = _destruct__k2r9zo.x7();
          var pedal = _destruct__k2r9zo.y7();
          var distances = _destruct__k2r9zo.i9();
          var dis = distances.x;
          if (dis > this.no_1.vo_1.mn_1) {
            continue $l$loop_1;
          }
          if (dis > cp.en_1) {
            continue $l$loop_1;
          }
          if (this.no_1.vo_1.ln_1) {
            Companion_getInstance_0().cf([
              step,
              "\u5B9E\u9645\u8DDD\u79BB",
              dis,
              "\u8DEF\u7EBF",
              line,
              "\u8DEF\u5411",
              line.km_1,
              cp.ym_1.tg(matched).vj(),
              distances,
              line.em_1,
            ]);
          }
          var frangle = 0.0;
          var altitude = 0.0;
          var tmp0_safe_receiver = this.jo_1.fn_1;
          if (tmp0_safe_receiver == null) null;
          else {
            // Inline function 'kotlin.let' call
            // Inline function 'kotlin.contracts.contract' call
            $l$block_1: {
              // Inline function 'com.indoor.roadmapmatcher.MatchSession.matchRoadMap.<anonymous>' call
              var dm = matched.tg(this.jo_1.dn_1);
              var dmlength = dm.vj();
              var dmdir = dm.yj();
              if (dmlength < 0.01) {
                dmdir = forwardDirection + 90;
              }
              // Inline function 'kotlin.math.abs' call
              var x = forwardLength - dmlength;
              var dmlen = Math.abs(x);
              // Inline function 'kotlin.math.abs' call
              var x_0 = hgmath_instance.pi(forwardDirection - dmdir, 0.0);
              var dmfactor = Math.abs(x_0) / 30;
              if (dmfactor < 1) dmfactor = 0.0;
              if (this.no_1.vo_1.ln_1) {
                Companion_getInstance_0().cf([
                  step,
                  "\u52A0\u6743\u8DDD\u79BB",
                  dis + dmfactor * dmlen * this.no_1.vo_1.tn_1,
                  "\u6293\u8DEF\u70B9\u95F4\u8DDD\u79BB",
                  dmlength,
                  "\u6293\u8DEF\u4F4D\u79FB\u65B9\u5411",
                  dmdir,
                  "\u8DDD\u79BB\u5DEE",
                  dmlen,
                  "\u65B9\u5411\u5DEE",
                  hgmath_instance.pi(forwardDirection - dmdir, 0.0),
                  "\u65B9\u5411\u56E0\u5B50",
                  dmfactor,
                  "\u4FDD\u6301\u65B9\u5411\u56E0\u5B50",
                  this.no_1.vo_1.tn_1,
                ]);
              }
              dis = dis + dmfactor * dmlen * this.no_1.vo_1.tn_1;
              if (dis > this.no_1.vo_1.mn_1) {
                break $l$block_1;
              }
              // Inline function 'kotlin.math.abs' call
              // Inline function 'kotlin.math.abs' call
              var x_1 = hgmath_instance.qi(forwardDirection - line.km_1);
              var x_2 = 90 - Math.abs(x_1);
              var angle = 90 - Math.abs(x_2);
              var factor = angle / 30;
              if (factor < 1) factor = 0.0;
              // Inline function 'kotlin.math.cos' call
              var x_3 = (angle * 3.141592653589793) / 180;
              factor = 1 - Math.cos(x_3);
              factor = factor * (factor * 40);
              if (this.no_1.vo_1.ln_1) {
                Companion_getInstance_0().cf([
                  step,
                  "\u52A0\u6743\u8DDD\u79BB",
                  dis + factor * this.no_1.vo_1.sn_1 + distances.z,
                  "\u4E0E\u8DEF\u7EBF\u5939\u89D2",
                  angle,
                  "\u8DEF\u7EBF\u5939\u89D2\u56E0\u5B50",
                  factor,
                  "\u5EF6\u8DEF\u7EBF\u56E0\u5B50",
                  this.no_1.vo_1.sn_1,
                  "\u504F\u79BB\u8DEF\u7EBF\u8DDD\u79BB",
                  distances.z,
                ]);
              }
              dis = dis + (factor * this.no_1.vo_1.sn_1 + distances.z * distances.z);
              if (dis > this.no_1.vo_1.mn_1) {
                break $l$block_1;
              }
              if (!equals(line, this.jo_1.fn_1)) {
                if (this.no_1.vo_1.ln_1) {
                  Companion_getInstance_0().cf([
                    step,
                    "\u52A0\u6743\u8DDD\u79BB",
                    dis + dis * 0.2 * factor + factor,
                    "\u8DDD\u79BB",
                    dis,
                    "\u56E0\u5B50",
                    factor,
                    "\u4FDD\u6301\u5F53\u524D\u8DEF\u7EBF",
                  ]);
                }
                dis = dis + (dis * 0.2 * factor + factor);
              }
              if (this.no_1.vo_1.ln_1) {
                var tmp_1 = Companion_getInstance_0();
                var tmp_2 = dis;
                var tmp_3 = this.no_1.vo_1.un_1;
                // Inline function 'kotlin.math.max' call
                // Inline function 'kotlin.arrayOf' call
                // Inline function 'kotlin.js.unsafeCast' call
                // Inline function 'kotlin.js.asDynamic' call
                var tmp$ret$12 = [
                  tmp0_safe_receiver.hm_1.tg(line.hm_1).vj(),
                  tmp0_safe_receiver.hm_1.tg(line.im_1).vj(),
                  tmp0_safe_receiver.im_1.tg(line.hm_1).vj(),
                  tmp0_safe_receiver.im_1.tg(line.im_1).vj(),
                ];
                var b_1 = min(tmp$ret$12) - this.no_1.vo_1.bo_1;
                var tmp_4 = tmp_2 + tmp_3 * Math.max(0.0, b_1);
                var tmp_5 = dis;
                var tmp_6 = this.no_1.vo_1.un_1;
                // Inline function 'kotlin.arrayOf' call
                // Inline function 'kotlin.js.unsafeCast' call
                // Inline function 'kotlin.js.asDynamic' call
                var tmp$ret$16 = [
                  tmp0_safe_receiver.hm_1.tg(line.hm_1).vj(),
                  tmp0_safe_receiver.hm_1.tg(line.im_1).vj(),
                  tmp0_safe_receiver.im_1.tg(line.hm_1).vj(),
                  tmp0_safe_receiver.im_1.tg(line.im_1).vj(),
                ];
                tmp_1.cf([step, "\u52A0\u6743\u8DDD\u79BB", tmp_4, tmp_5 + tmp_6 * min(tmp$ret$16)]);
              }
              var tmp_7 = dis;
              var tmp_8 = this.no_1.vo_1.un_1;
              // Inline function 'kotlin.math.max' call
              // Inline function 'kotlin.arrayOf' call
              // Inline function 'kotlin.js.unsafeCast' call
              // Inline function 'kotlin.js.asDynamic' call
              var tmp$ret$19 = [
                tmp0_safe_receiver.hm_1.tg(line.hm_1).vj(),
                tmp0_safe_receiver.hm_1.tg(line.im_1).vj(),
                tmp0_safe_receiver.im_1.tg(line.hm_1).vj(),
                tmp0_safe_receiver.im_1.tg(line.im_1).vj(),
              ];
              var b_2 = min(tmp$ret$19) - this.no_1.vo_1.bo_1;
              dis = tmp_7 + tmp_8 * Math.max(0.0, b_2);
              if (dis > this.no_1.vo_1.mn_1) {
                break $l$block_1;
              }
              if (this.jo_1.dn_1.uk()) {
                if (dmlen > 3) {
                  if (this.no_1.vo_1.ln_1) {
                    Companion_getInstance_0().cf([step, "\u52A0\u6743\u8DDD\u79BB", dis + (dmlen * 2) / 3, dmlen]);
                  }
                  dis = dis + (dmlen * 2) / 3;
                }
              }
              frangle = angle;
              if (!(forwardLength / 2 <= dmlength ? dmlength <= forwardLength : false)) {
                frangle = frangle + 30;
              }
              var ds = dmlength / forwardLength;
              if (ds < 1) {
                // Inline function 'kotlin.math.max' call
                var b_3 = ds;
                ds = 2 / Math.max(0.1, b_3);
              }
              if (this.no_1.vo_1.ln_1) {
                Companion_getInstance_0().cf([step, "\u52A0\u6743\u8DDD\u79BB", dis + ds, dmlength, forwardLength, ds]);
              }
              dis = dis + ds;
              var rd = RoadNet_getInstance().pm(line, tmp0_safe_receiver, matched, this.jo_1.dn_1);
              if (this.no_1.vo_1.ln_1) {
                Companion_getInstance_0().cf([
                  step,
                  "\u52A0\u6743\u8DDD\u79BB",
                  dis + rd * this.no_1.vo_1.vn_1,
                  rd,
                  this.no_1.vo_1.vn_1,
                  line.em_1,
                  tmp0_safe_receiver.em_1,
                ]);
              }
              dis = dis + rd * 2 * this.no_1.vo_1.vn_1;
              var aline = this.no_1.vo_1.do_1.n1(line.em_1);
              if (!(aline == null)) {
                altitude = (aline.fm_1.z * matched.tg(aline.im_1).tk() + aline.gm_1.z * matched.tg(aline.hm_1).tk()) / aline.jm_1.tk();
                Companion_getInstance_0().cf([
                  "\u6D77\u62D4",
                  altitude,
                  aline.em_1,
                  aline.fm_1.z,
                  matched.tg(aline.im_1).tk(),
                  aline.gm_1.z,
                  matched.tg(aline.hm_1).tk(),
                  aline.jm_1.tk(),
                ]);
                if (altitude > 0 && this.jo_1.in_1 > 0) {
                  // Inline function 'kotlin.math.abs' call
                  var x_4 = coord.z - this.jo_1.wm_1.z - (altitude - this.jo_1.in_1);
                  var d = Math.abs(x_4) * 10;
                  if (this.no_1.vo_1.ln_1) {
                    Companion_getInstance_0().cf([
                      step,
                      "\u52A0\u6743\u8DDD\u79BB",
                      "\u6D77\u62D4",
                      dis + d * this.no_1.vo_1.co_1,
                      d,
                      d,
                      this.no_1.vo_1.co_1,
                      line.em_1,
                      coord.z,
                      this.jo_1.wm_1.z,
                      altitude,
                      this.jo_1.in_1,
                    ]);
                  }
                  dis = dis + d * this.no_1.vo_1.co_1;
                } else {
                  dis = dis + 20 * this.no_1.vo_1.co_1;
                }
              } else {
                if (this.no_1.vo_1.do_1.p() > 0) {
                  dis = dis + 20 * this.no_1.vo_1.co_1;
                }
              }
              if (this.no_1.vo_1.ln_1) {
                Companion_getInstance_0().cf([
                  step,
                  "\u52A0\u6743\u8DDD\u79BB",
                  dis,
                  cp.ym_1.tg(matched).vj(),
                  distances,
                  forward,
                  forwardLength,
                  forwardDirection,
                  line.km_1,
                ]);
              }
            }
          }
          if (this.no_1.vo_1.ln_1) {
            Companion_getInstance_0().cf([
              step,
              "\u6293\u8DEF\u7684\u70B9\u7EBF",
              cp.wm_1.fg(),
              Companion_getInstance().rf_1.lg(cp.ym_1).fg(),
              Companion_getInstance().rf_1.lg(matched).fg(),
              line.fm_1.fg(),
              line.gm_1.fg(),
            ]);
          }
          if (cp.en_1 > dis) {
            cp.fn_1 = line;
            cp.en_1 = dis;
            cp.dn_1 = matched;
            cp.hn_1 = frangle;
            cp.in_1 = altitude;
            hasMatched = true;
          }
        }
        if (!hasMatched) {
          Companion_getInstance_0().qe("Hasn't matched");
          this.oo();
        }
        this.jo_1 = cp;
        Companion_getInstance_0().cf([this.jo_1]);
        if (cp.en_1 > this.no_1.vo_1.mn_1) {
          Companion_getInstance_0().cf(["cp.matchedDis > config.maxGraspDistance", cp.en_1, this.no_1.vo_1.mn_1]);
          this.oo();
        }
        var c = Companion_getInstance().rf_1.lg(cp.ym_1);
        Companion_getInstance_0().cf([
          "Moved",
          c.x,
          c.y,
          0,
          "",
          "",
          orient,
          "M",
          "1",
          step,
          accuracy,
          type,
          this.ko_1,
          this.lo_1,
          cp.en_1,
          cp.dn_1.tg(cp.xm_1).tg(this.ko_1),
          this.ko_1.wg(cp.dn_1.tg(cp.xm_1).tg(this.ko_1).cg(0.99)),
          this.no_1.vo_1.jn_1,
          coord,
          floorId,
          step,
          "\u6293\u8DEF\u70B9",
          type,
          "\u6293\u8DEF\u8DDD\u79BB",
          cp.en_1,
          "\u4F4D\u79FB\u957F\u5EA6",
          forwardLength,
          "\u4E0E\u8DEF\u7EBF\u5939\u89D2",
          cp.hn_1,
          "\u65F6\u95F4\u95F4\u9694",
          duration,
          "\u5F02\u5E38\u6570\u91CF",
          this.mo_1,
          "\u504F\u79FB\u6B21\u6570",
          this.lo_1,
          "\u504F\u79FB\u91CF",
          this.ko_1,
        ]);
        if (this.no_1.vo_1.ln_1) {
          Companion_getInstance_0().cf([
            step,
            "\u6293\u8DEF\u70B9",
            type,
            "\u6293\u8DEF\u8DDD\u79BB",
            cp.en_1,
            "\u4F4D\u79FB\u957F\u5EA6",
            forwardLength,
            "\u4E0E\u8DEF\u7EBF\u5939\u89D2",
            cp.hn_1,
            "\u65F6\u95F4\u95F4\u9694",
            duration,
            "\u5F02\u5E38\u6570\u91CF",
            this.mo_1,
            "\u504F\u79FB\u6B21\u6570",
            this.lo_1,
            "\u504F\u79FB\u91CF",
            this.ko_1,
          ]);
        }
        if (
          (type === Companion_getInstance_1().GPS || type === Companion_getInstance_1().sm_1) &&
          forwardLength < this.no_1.vo_1.qn_1 &&
          cp.hn_1 < this.no_1.vo_1.ao_1 &&
          duration.y1(new Long(0, 0)) > 0 &&
          duration.y1(new Long(10000, 0)) < 0 &&
          this.mo_1 === 0
        ) {
          var factor_0 = this.no_1.vo_1.yn_1 * (1 - cp.hn_1 / 90);
          this.ko_1 = this.ko_1.wg(cp.dn_1.tg(cp.xm_1).tg(this.ko_1).cg(factor_0));
          var tmp_9 = this;
          var tmp1_elvis_lhs = Companion_instance.ak(Companion_instance.zj(this.ko_1, this.no_1.vo_1.zn_1), this.no_1.vo_1.zn_1.g2());
          tmp_9.ko_1 = tmp1_elvis_lhs == null ? new vector3d() : tmp1_elvis_lhs;
          this.lo_1 = (this.lo_1 + 1) | 0;
        }
        return Companion_getInstance().rf_1.lg(cp.dn_1);
      } catch ($p) {
        if ($p instanceof Error) {
          var e = $p;
          Companion_getInstance_0().cf([coord, coord.z, this.no_1.uo_1.p()]);
          Companion_getInstance_0().cf([e]);
        } else {
          throw $p;
        }
      }
      return coord;
    };
    function Companion() {
      Companion_instance_1 = this;
      this.qm_1 = 0;
      this.GPS = 1;
      this.BLE = 2;
      this.rm_1 = 3;
      this.sm_1 = 11;
      this.tm_1 = 12;
      this.um_1 = false;
      this.vm_1 = new Long(0, 0);
      this.roadMapMatcher = new RoadMapMatcher();
    }
    protoOf(Companion).ap = function () {
      return this.GPS;
    };
    protoOf(Companion).bp = function () {
      return this.BLE;
    };
    protoOf(Companion).cp = function () {
      return this.roadMapMatcher;
    };
    var Companion_instance_1;
    function Companion_getInstance_1() {
      if (Companion_instance_1 == null) new Companion();
      return Companion_instance_1;
    }
    function setGeofences$parseConfig(conf) {
      var maxOffset = conf.ah("maxOffset");
      var routeAltitudes = HashMap_init_$Create$();
      var tmp0_safe_receiver = conf.ah("routeAltitudes");
      if (tmp0_safe_receiver == null) null;
      else {
        // Inline function 'kotlin.let' call
        // Inline function 'kotlin.contracts.contract' call
        var _iterator__ex2g4s = tmp0_safe_receiver.l();
        $l$loop_1: while (_iterator__ex2g4s.m()) {
          var route = _iterator__ex2g4s.n();
          var tmp = route.yg_1;
          var _destruct__k2r9zo = (!(tmp == null) ? isInterface(tmp, Entry) : false) ? tmp : THROW_CCE();
          // Inline function 'kotlin.collections.component1' call
          var k = _destruct__k2r9zo.j1();
          // Inline function 'kotlin.collections.component2' call
          var v = _destruct__k2r9zo.k1();
          k = (!(k == null) ? typeof k === "string" : false) ? k : THROW_CCE();
          var tmp0_elvis_lhs = v;
          var tmp_0;
          if (tmp0_elvis_lhs == null) {
            continue $l$loop_1;
          } else {
            tmp_0 = tmp0_elvis_lhs;
          }
          v = new hgjson(tmp_0);
          var tmp1_elvis_lhs = v.eh(0);
          var tmp_1;
          if (tmp1_elvis_lhs == null) {
            continue $l$loop_1;
          } else {
            tmp_1 = tmp1_elvis_lhs;
          }
          var f = tmp_1;
          var tmp2_elvis_lhs = v.eh(1);
          var tmp_2;
          if (tmp2_elvis_lhs == null) {
            continue $l$loop_1;
          } else {
            tmp_2 = tmp2_elvis_lhs;
          }
          var t = tmp_2;
          var routeLine = new RouteLine(k, new vector3d(f.fh(0), f.fh(1), f.fh(2)), new vector3d(t.fh(0), t.fh(1), t.fh(2)));
          // Inline function 'kotlin.collections.set' call
          var key = k;
          routeAltitudes.t3(key, routeLine);
        }
      }
      var tmp_3 = conf.bh("group");
      var tmp_4 = conf.dh("matching");
      var tmp_5 = conf.dh("debugging");
      var tmp_6 = conf.ch("maxGraspDistance");
      var tmp_7 = conf.ch("maxInterruptedTime");
      var tmp_8 = conf.ch("maxInterruptedDistance");
      var tmp_9 = conf.ch("maxHoldStillDistance");
      var tmp_10 = conf.ch("maxForwardDirectionDistance");
      var tmp_11 = conf.ch("minForwardDirectionDistance");
      var tmp_12 = conf.ch("routeDirectionFactor");
      var tmp_13 = conf.ch("keepDirectionFactor");
      var tmp_14 = conf.ch("nextRouteFactor");
      var tmp_15 = conf.ch("routeDistanceFactor");
      var tmp_16 = conf.ch("walkOrientationFactor");
      var tmp_17 = conf.ch("deviceOrientationFactor");
      var tmp_18 = conf.ch("offsetFactor");
      var tmp2_elvis_lhs_0 = maxOffset == null ? null : maxOffset.fh(0);
      var tmp_19 = tmp2_elvis_lhs_0 == null ? 0.0 : tmp2_elvis_lhs_0;
      var tmp4_elvis_lhs = maxOffset == null ? null : maxOffset.fh(1);
      var tmp_20 = tmp4_elvis_lhs == null ? 0.0 : tmp4_elvis_lhs;
      var tmp6_elvis_lhs = maxOffset == null ? null : maxOffset.fh(2);
      return new MatchConfig(
        tmp_3,
        tmp_4,
        tmp_5,
        tmp_6,
        tmp_7,
        tmp_8,
        tmp_9,
        tmp_10,
        tmp_11,
        tmp_12,
        tmp_13,
        tmp_14,
        tmp_15,
        tmp_16,
        tmp_17,
        tmp_18,
        new vector3d(tmp_19, tmp_20, tmp6_elvis_lhs == null ? 0.0 : tmp6_elvis_lhs),
        conf.ch("maxOffsetAngle"),
        conf.ch("maxNextRouteDistance"),
        conf.ch("altitudeFactor"),
        routeAltitudes,
      );
    }
    function RoadMapMatcher() {
      Companion_getInstance_1();
      this.qo_1 = "B000A11DMZ";
      this.ro_1 = ArrayList_init_$Create$();
      this.so_1 = HashMap_init_$Create$();
      this.to_1 = new vector3d();
      this.uo_1 = HashMap_init_$Create$();
      this.vo_1 = new MatchConfig();
      this.wo_1 = ArrayList_init_$Create$();
      this.xo_1 = HashMap_init_$Create$();
      this.yo_1 = hashMapOf([new Pair(Companion_getInstance_1().GPS, new MatchSession(this)), new Pair(Companion_getInstance_1().BLE, new MatchSession(this))]);
    }
    protoOf(RoadMapMatcher).setRoadMap = function (buildingId, str) {
      Companion_getInstance_0().cf([buildingId, str.length]);
      this.ro_1.h3();
      this.so_1.h3();
      this.qo_1 = buildingId;
      this.uo_1.h3();
      this.dp(str);
    };
    protoOf(RoadMapMatcher).setRoutes = function (buildingId, routes) {
      Companion_getInstance_0().cf([buildingId, routes.p()]);
      this.qo_1 = buildingId;
      this.uo_1 = routes;
    };
    protoOf(RoadMapMatcher).dp = function (str) {
      try {
        var tmp0_elvis_lhs = Companion_instance_0.xg(str);
        var tmp;
        if (tmp0_elvis_lhs == null) {
          return Unit_instance;
        } else {
          tmp = tmp0_elvis_lhs;
        }
        var routeJson = tmp;
        if (!routeJson.dh("success")) {
          return Unit_instance;
        }
        var tmp1_safe_receiver = routeJson.ah("result");
        var tmp2_elvis_lhs = tmp1_safe_receiver == null ? null : tmp1_safe_receiver.ah("features");
        var tmp_0;
        if (tmp2_elvis_lhs == null) {
          return Unit_instance;
        } else {
          tmp_0 = tmp2_elvis_lhs;
        }
        var featuresJson = tmp_0;
        var inductionVariable = 0;
        var last = featuresJson.p();
        if (inductionVariable < last)
          $l$loop_6: do {
            var i = inductionVariable;
            inductionVariable = (inductionVariable + 1) | 0;
            var tmp3_elvis_lhs = featuresJson.eh(i);
            var tmp_1;
            if (tmp3_elvis_lhs == null) {
              continue $l$loop_6;
            } else {
              tmp_1 = tmp3_elvis_lhs;
            }
            var feature = tmp_1;
            var featureJson = feature;
            var tmp4_safe_receiver = featureJson.ah("properties");
            var tmp5_elvis_lhs = tmp4_safe_receiver == null ? null : tmp4_safe_receiver.bh("ft_id");
            var featureId = tmp5_elvis_lhs == null ? "" : tmp5_elvis_lhs;
            var tmp6_safe_receiver = featureJson.ah("properties");
            var tmp7_elvis_lhs = tmp6_safe_receiver == null ? null : tmp6_safe_receiver.bh("floor_id");
            var floorId = tmp7_elvis_lhs == null ? "" : tmp7_elvis_lhs;
            // Inline function 'kotlin.collections.contains' call
            // Inline function 'kotlin.collections.containsKey' call
            var this_0 = this.so_1;
            if (!(isInterface(this_0, KtMap) ? this_0 : THROW_CCE()).l1(floorId)) {
              // Inline function 'kotlin.collections.set' call
              var this_1 = this.so_1;
              var value = this.ro_1.p();
              this_1.t3(floorId, value);
              this.ro_1.r2(floorId);
              // Inline function 'kotlin.collections.set' call
              var this_2 = this.uo_1;
              var value_0 = ArrayList_init_$Create$();
              this_2.t3(floorId, value_0);
            }
            var tmp8_safe_receiver = this.so_1.n1(floorId);
            var tmp9_elvis_lhs = tmp8_safe_receiver == null ? null : tmp8_safe_receiver;
            var z = tmp9_elvis_lhs == null ? 0.0 : tmp9_elvis_lhs;
            var tmp10_safe_receiver = featureJson.ah("geometry");
            var tmp11_elvis_lhs = tmp10_safe_receiver == null ? null : tmp10_safe_receiver.ah("coordinates");
            var tmp_2;
            if (tmp11_elvis_lhs == null) {
              continue $l$loop_6;
            } else {
              tmp_2 = tmp11_elvis_lhs;
            }
            var coordinatesJson = tmp_2;
            if (!(coordinatesJson.p() === 2)) {
              var inductionVariable_0 = 1;
              var last_0 = coordinatesJson.p();
              if (inductionVariable_0 < last_0)
                $l$loop_3: do {
                  var k = inductionVariable_0;
                  inductionVariable_0 = (inductionVariable_0 + 1) | 0;
                  var tmp12_elvis_lhs = coordinatesJson.eh((k - 1) | 0);
                  var tmp_3;
                  if (tmp12_elvis_lhs == null) {
                    continue $l$loop_3;
                  } else {
                    tmp_3 = tmp12_elvis_lhs;
                  }
                  var p0 = tmp_3;
                  var tmp13_elvis_lhs = coordinatesJson.eh(k);
                  var tmp_4;
                  if (tmp13_elvis_lhs == null) {
                    continue $l$loop_3;
                  } else {
                    tmp_4 = tmp13_elvis_lhs;
                  }
                  var p1 = tmp_4;
                  var v0 = new vector3d(p0.fh(0), p0.fh(1), z);
                  var v1 = new vector3d(p1.fh(0), p1.fh(1), z);
                  if (v0.equals(v1)) {
                    continue $l$loop_3;
                  }
                  var tmp14_safe_receiver = this.uo_1.n1(floorId);
                  if (tmp14_safe_receiver == null) null;
                  else tmp14_safe_receiver.r2(new RouteLine(featureId, v0, v1));
                } while (inductionVariable_0 < last_0);
            } else {
              var tmp15_elvis_lhs = coordinatesJson.eh(0);
              var tmp_5;
              if (tmp15_elvis_lhs == null) {
                continue $l$loop_6;
              } else {
                tmp_5 = tmp15_elvis_lhs;
              }
              var p0_0 = tmp_5;
              var tmp16_elvis_lhs = coordinatesJson.eh(1);
              var tmp_6;
              if (tmp16_elvis_lhs == null) {
                continue $l$loop_6;
              } else {
                tmp_6 = tmp16_elvis_lhs;
              }
              var p1_0 = tmp_6;
              var v0_0 = new vector3d(p0_0.fh(0), p0_0.fh(1), z);
              var v1_0 = new vector3d(p1_0.fh(0), p1_0.fh(1), z);
              if (v0_0.equals(v1_0)) {
                continue $l$loop_6;
              }
              var tmp17_safe_receiver = this.uo_1.n1(floorId);
              if (tmp17_safe_receiver == null) null;
              else tmp17_safe_receiver.r2(new RouteLine(featureId, v0_0, v1_0));
            }
          } while (inductionVariable < last);
      } catch ($p) {
        if ($p instanceof Error) {
          var e = $p;
          Companion_getInstance_0().cf([e]);
        } else {
          throw $p;
        }
      }
    };
    protoOf(RoadMapMatcher).setGeofences = function (geofs, mconfigs) {
      Companion_getInstance_0().cf([geofs, mconfigs]);
      this.wo_1.e4(geofs);
      this.xo_1.p4(mconfigs);
      Companion_getInstance_0().cf([hashCode(this), this.wo_1.p(), this.xo_1.p()]);
    };
    protoOf(RoadMapMatcher).setGeofencesJson = function (json) {
      if (json == null) return Unit_instance;
      var geofences = ArrayList_init_$Create$();
      var configs = HashMap_init_$Create$();
      var gs = json.ah("geofences");
      if (gs == null) {
        var tmp1_safe_receiver = json.ah("result");
        var tmp2_safe_receiver = tmp1_safe_receiver == null ? null : tmp1_safe_receiver.ah("features");
        if (tmp2_safe_receiver == null) null;
        else {
          // Inline function 'kotlin.also' call
          // Inline function 'kotlin.contracts.contract' call
          // Inline function 'com.indoor.roadmapmatcher.RoadMapMatcher.setGeofences.<anonymous>' call
          var _iterator__ex2g4s = tmp2_safe_receiver.l();
          $l$loop_1: while (_iterator__ex2g4s.m()) {
            var feature = _iterator__ex2g4s.n();
            var tmp0_safe_receiver = feature.zg("geometry");
            var tmp1_safe_receiver_0 = tmp0_safe_receiver == null ? null : tmp0_safe_receiver.ah("coordinates");
            var tmp2_elvis_lhs = tmp1_safe_receiver_0 == null ? null : tmp1_safe_receiver_0.eh(0);
            var tmp;
            if (tmp2_elvis_lhs == null) {
              continue $l$loop_1;
            } else {
              tmp = tmp2_elvis_lhs;
            }
            var coordinates = tmp;
            var coords = ArrayList_init_$Create$();
            var _iterator__ex2g4s_0 = coordinates.l();
            while (_iterator__ex2g4s_0.m()) {
              var c = _iterator__ex2g4s_0.n();
              coords.r2(new vector3d(c.fh(0), c.fh(1), c.fh(2)));
            }
            var tmp3_safe_receiver = feature.zg("properties");
            var tmp4_elvis_lhs = tmp3_safe_receiver == null ? null : tmp3_safe_receiver.bh("ft_id");
            var tmp_0;
            if (tmp4_elvis_lhs == null) {
              continue $l$loop_1;
            } else {
              tmp_0 = tmp4_elvis_lhs;
            }
            var featureId = tmp_0;
            var tmp5_safe_receiver = feature.zg("properties");
            var tmp6_elvis_lhs = tmp5_safe_receiver == null ? null : tmp5_safe_receiver.bh("floor_id");
            var floorId = tmp6_elvis_lhs == null ? "" : tmp6_elvis_lhs;
            geofences.r2(new Geofence(featureId, "RoadMapMatcher", featureId, floorId, coords));
            var tmp7_safe_receiver = feature.zg("properties");
            var tmp8_elvis_lhs = tmp7_safe_receiver == null ? null : tmp7_safe_receiver.ah("matchConfig");
            var tmp_1;
            if (tmp8_elvis_lhs == null) {
              continue $l$loop_1;
            } else {
              tmp_1 = tmp8_elvis_lhs;
            }
            var conf = tmp_1;
            // Inline function 'kotlin.collections.set' call
            var value = setGeofences$parseConfig(conf);
            configs.t3(featureId, value);
          }
        }
      } else {
        var inductionVariable = 0;
        var last = gs.p();
        if (inductionVariable < last)
          $l$loop_3: do {
            var i = inductionVariable;
            inductionVariable = (inductionVariable + 1) | 0;
            var tmp3_elvis_lhs = gs.o(i);
            var tmp_2;
            if (tmp3_elvis_lhs == null) {
              continue $l$loop_3;
            } else {
              tmp_2 = tmp3_elvis_lhs;
            }
            var geof = tmp_2;
            var coords_0 = ArrayList_init_$Create$();
            var tmp4_elvis_lhs_0 = geof.ah("coordinates");
            var tmp_3;
            if (tmp4_elvis_lhs_0 == null) {
              continue $l$loop_3;
            } else {
              tmp_3 = tmp4_elvis_lhs_0;
            }
            var cs = tmp_3;
            var inductionVariable_0 = 0;
            var last_0 = cs.p();
            if (inductionVariable_0 < last_0)
              $l$loop_4: do {
                var j = inductionVariable_0;
                inductionVariable_0 = (inductionVariable_0 + 1) | 0;
                var tmp5_elvis_lhs = cs.o(j);
                var tmp_4;
                if (tmp5_elvis_lhs == null) {
                  continue $l$loop_4;
                } else {
                  tmp_4 = tmp5_elvis_lhs;
                }
                var c_0 = tmp_4;
                coords_0.r2(new vector3d(c_0.fh(0), c_0.fh(1), c_0.fh(2)));
              } while (inductionVariable_0 < last_0);
            geofences.r2(new Geofence(geof.bh("name"), geof.bh("type"), geof.bh("group"), geof.bh("floorId"), coords_0));
          } while (inductionVariable < last);
        var tmp6_safe_receiver = json.ah("matchConfig");
        if (tmp6_safe_receiver == null) null;
        else {
          // Inline function 'kotlin.also' call
          // Inline function 'kotlin.contracts.contract' call
          // Inline function 'com.indoor.roadmapmatcher.RoadMapMatcher.setGeofences.<anonymous>' call
          var inductionVariable_1 = 0;
          var last_1 = tmp6_safe_receiver.p();
          if (inductionVariable_1 < last_1)
            $l$loop_5: do {
              var i_0 = inductionVariable_1;
              inductionVariable_1 = (inductionVariable_1 + 1) | 0;
              var tmp0_elvis_lhs = tmp6_safe_receiver.o(i_0);
              var tmp_5;
              if (tmp0_elvis_lhs == null) {
                continue $l$loop_5;
              } else {
                tmp_5 = tmp0_elvis_lhs;
              }
              var conf_0 = tmp_5;
              // Inline function 'kotlin.collections.set' call
              var key = conf_0.bh("group");
              var value_0 = setGeofences$parseConfig(conf_0);
              configs.t3(key, value_0);
            } while (inductionVariable_1 < last_1);
        }
      }
      this.setGeofences(geofences, configs);
    };
    protoOf(RoadMapMatcher).zo = function (coord, floorId) {
      // Inline function 'kotlin.collections.find' call
      var this_0 = this.wo_1;
      var tmp$ret$1;
      $l$block: {
        // Inline function 'kotlin.collections.firstOrNull' call
        var tmp0_iterator = this_0.l();
        while (tmp0_iterator.m()) {
          var element = tmp0_iterator.n();
          // Inline function 'com.indoor.roadmapmatcher.RoadMapMatcher.checkGeofence.<anonymous>' call
          if ((isBlank(floorId) || floorId === element.ho_1) && coord.zk(element.io_1)) {
            tmp$ret$1 = element;
            break $l$block;
          }
        }
        tmp$ret$1 = null;
      }
      var tmp0_safe_receiver = tmp$ret$1;
      var tmp1_elvis_lhs = tmp0_safe_receiver == null ? null : tmp0_safe_receiver.go_1;
      var type = tmp1_elvis_lhs == null ? "" : tmp1_elvis_lhs;
      var tmp = this;
      var tmp2_elvis_lhs = this.xo_1.n1(type);
      tmp.vo_1 = tmp2_elvis_lhs == null ? new MatchConfig() : tmp2_elvis_lhs;
    };
    protoOf(RoadMapMatcher).matchRoadMap = function (coord, floorId, type, accuracy, step, orient, timestamp) {
      var tmp0_safe_receiver = this.yo_1.n1(type);
      var tmp1_elvis_lhs = tmp0_safe_receiver == null ? null : tmp0_safe_receiver.po(coord, floorId, type, accuracy, step, orient, timestamp);
      return tmp1_elvis_lhs == null ? coord : tmp1_elvis_lhs;
    };
    //region block: exports
    _.$_$ = _.$_$ || {};
    _.$_$.a = Geofence;
    _.$_$.b = MatchConfig;
    _.$_$.c = Companion_getInstance_1;
    //endregion
    return _;
  })({}, kotlin_com_hgwen_hgutils_hgutils, kotlin_kotlin);

  //# sourceMappingURL=NewSDK-Exts-RoadMapMatcher.js.map
  var kotlin_NewSDK_Exts_CheckPoint = (function (_, kotlin_kotlin, kotlin_com_hgwen_hgutils_hgutils) {
    "use strict";
    //region block: imports
    var Long = kotlin_kotlin.$_$.w4;
    var hgutils_instance = kotlin_com_hgwen_hgutils_hgutils.$_$.l;
    var protoOf = kotlin_kotlin.$_$.o3;
    var initMetadataForClass = kotlin_kotlin.$_$.w2;
    var initMetadataForObject = kotlin_kotlin.$_$.z2;
    var equals = kotlin_kotlin.$_$.p2;
    var FunctionAdapter = kotlin_kotlin.$_$.g2;
    var isInterface = kotlin_kotlin.$_$.g3;
    var Comparator = kotlin_kotlin.$_$.t4;
    var hashCode = kotlin_kotlin.$_$.v2;
    var VOID = kotlin_kotlin.$_$.c;
    var toInt = kotlin_kotlin.$_$.l4;
    var toString = kotlin_kotlin.$_$.p4;
    var takeLast = kotlin_kotlin.$_$.g4;
    var compareValues = kotlin_kotlin.$_$.d2;
    var ArrayList_init_$Create$ = kotlin_kotlin.$_$.e;
    var HashMap_init_$Create$ = kotlin_kotlin.$_$.f;
    var Companion_instance = kotlin_com_hgwen_hgutils_hgutils.$_$.i;
    var Unit_instance = kotlin_kotlin.$_$.y;
    var Companion_getInstance = kotlin_com_hgwen_hgutils_hgutils.$_$.j;
    var split = kotlin_kotlin.$_$.e4;
    var joinToString = kotlin_kotlin.$_$.p1;
    var THROW_CCE = kotlin_kotlin.$_$.y4;
    var KtMap = kotlin_kotlin.$_$.b1;
    var first = kotlin_kotlin.$_$.h1;
    var toLong = kotlin_kotlin.$_$.q3;
    var removeFirstOrNull = kotlin_kotlin.$_$.y1;
    var sortWith = kotlin_kotlin.$_$.b2;
    var lastOrNull = kotlin_kotlin.$_$.s1;
    var last = kotlin_kotlin.$_$.t1;
    var compareTo = kotlin_kotlin.$_$.n2;
    var ensureNotNull = kotlin_kotlin.$_$.b5;
    //endregion
    //region block: pre-declaration
    initMetadataForClass(CheckPointResult, "CheckPointResult", CheckPointResult);
    initMetadataForObject(CheckPoint, "CheckPoint");
    initMetadataForClass(ScanInfo, "ScanInfo");
    initMetadataForClass(History, "History");
    initMetadataForClass(sam$kotlin_Comparator$0, "sam$kotlin_Comparator$0", VOID, VOID, [Comparator, FunctionAdapter]);
    initMetadataForObject(CheckPointAlgorithm, "CheckPointAlgorithm");
    //endregion
    function CheckPointResult() {
      this.ep_1 = "";
      this.fp_1 = "";
      this.gp_1 = "";
      this.hp_1 = "";
      this.ip_1 = "";
      this.jp_1 = 0.0;
      this.kp_1 = 0.0;
      this.lp_1 = 0;
      this.mp_1 = new Long(0, 0);
    }
    protoOf(CheckPointResult).toString = function () {
      return hgutils_instance.ji([this.ep_1, this.gp_1, this.hp_1, this.ip_1, this.fp_1, this.jp_1, this.kp_1, this.lp_1, this.mp_1]);
    };
    function CheckPoint() {
      CheckPoint_instance = this;
      this.np_1 = new CheckPointResult();
    }
    protoOf(CheckPoint).op = function (ssid, rssi, timestamp) {
      return CheckPointAlgorithm_getInstance().op(ssid, rssi, timestamp);
    };
    var CheckPoint_instance;
    function CheckPoint_getInstance() {
      if (CheckPoint_instance == null) new CheckPoint();
      return CheckPoint_instance;
    }
    function ScanInfo(ssid, rssi, timestamp) {
      this.wp_1 = ssid;
      this.xp_1 = rssi;
      this.yp_1 = timestamp;
    }
    protoOf(ScanInfo).toString = function () {
      return hgutils_instance.ji([this.wp_1, this.xp_1, this.yp_1]);
    };
    function History(ssid, rssi, fromTimestamp, toTimestamp) {
      this.zp_1 = ssid;
      this.aq_1 = rssi;
      this.bq_1 = fromTimestamp;
      this.cq_1 = toTimestamp;
    }
    protoOf(History).toString = function () {
      return hgutils_instance.ji([this.zp_1, this.aq_1, this.bq_1, this.cq_1]);
    };
    function sam$kotlin_Comparator$0(function_0) {
      this.dq_1 = function_0;
    }
    protoOf(sam$kotlin_Comparator$0).i7 = function (a, b) {
      return this.dq_1(a, b);
    };
    protoOf(sam$kotlin_Comparator$0).compare = function (a, b) {
      return this.i7(a, b);
    };
    protoOf(sam$kotlin_Comparator$0).k2 = function () {
      return this.dq_1;
    };
    protoOf(sam$kotlin_Comparator$0).equals = function (other) {
      var tmp;
      if (!(other == null) ? isInterface(other, Comparator) : false) {
        var tmp_0;
        if (!(other == null) ? isInterface(other, FunctionAdapter) : false) {
          tmp_0 = equals(this.k2(), other.k2());
        } else {
          tmp_0 = false;
        }
        tmp = tmp_0;
      } else {
        tmp = false;
      }
      return tmp;
    };
    protoOf(sam$kotlin_Comparator$0).hashCode = function () {
      return hashCode(this.k2());
    };
    function CheckPointAlgorithm$init$lambda(it) {
      // Inline function 'kotlin.text.uppercase' call
      // Inline function 'kotlin.js.asDynamic' call
      var tmp$ret$1 = toString(toInt(it), 16).toUpperCase();
      return takeLast("0000" + tmp$ret$1, 4);
    }
    function CheckPointAlgorithm$update$lambda(a, b) {
      // Inline function 'kotlin.comparisons.compareValuesBy' call
      // Inline function 'com.indoor.location.checkpoint.CheckPointAlgorithm.update.<anonymous>' call
      var tmp = b.xp_1;
      // Inline function 'com.indoor.location.checkpoint.CheckPointAlgorithm.update.<anonymous>' call
      var tmp$ret$1 = a.xp_1;
      return compareValues(tmp, tmp$ret$1);
    }
    function CheckPointAlgorithm() {
      CheckPointAlgorithm_instance = this;
      this.pp_1 = ArrayList_init_$Create$();
      this.qp_1 = HashMap_init_$Create$();
      this.rp_1 = 2000;
      this.sp_1 = ArrayList_init_$Create$();
      this.tp_1 = ArrayList_init_$Create$();
      this.up_1 = HashMap_init_$Create$();
      this.vp_1 = ArrayList_init_$Create$();
    }
    protoOf(CheckPointAlgorithm).eq = function (checkPointJson) {
      var tmp0_elvis_lhs = Companion_instance.xg(checkPointJson);
      var tmp;
      if (tmp0_elvis_lhs == null) {
        return Unit_instance;
      } else {
        tmp = tmp0_elvis_lhs;
      }
      var points = tmp;
      Companion_getInstance().cf(["CheckPoint\u84DD\u7259\u6570\u91CF", points.p()]);
      var _iterator__ex2g4s = points.l();
      while (_iterator__ex2g4s.m()) {
        var p = _iterator__ex2g4s.n();
        Companion_getInstance().cf([p]);
        var r = new CheckPointResult();
        r.gp_1 = p.bh("Floor");
        r.hp_1 = p.bh("WorkPosition");
        r.ip_1 = p.bh("Location");
        r.fp_1 = p.bh("EMarkLabelCode");
        r.jp_1 = p.ch("emarkLng");
        r.kp_1 = p.ch("emarkLat");
        var tmp_0 = r;
        var tmp_1 = p.bh("bleuuid");
        var tmp_2 = split(r.fp_1, ["#"]);
        tmp_0.ep_1 = tmp_1 + joinToString(tmp_2, "", VOID, VOID, VOID, VOID, CheckPointAlgorithm$init$lambda);
        // Inline function 'kotlin.collections.set' call
        var this_0 = this.qp_1;
        var key = r.ep_1;
        this_0.t3(key, r);
        Companion_getInstance().cf([r]);
        this.pp_1.r2(r.ep_1);
      }
    };
    protoOf(CheckPointAlgorithm).op = function (ssid, rssi, timestamp) {
      // Inline function 'kotlin.collections.contains' call
      // Inline function 'kotlin.collections.containsKey' call
      var this_0 = this.qp_1;
      if ((isInterface(this_0, KtMap) ? this_0 : THROW_CCE()).l1(ssid)) {
        var scanInfo = new ScanInfo(ssid, rssi, timestamp);
        this.sp_1.r2(scanInfo);
        // Inline function 'kotlin.collections.getOrPut' call
        var this_1 = this.up_1;
        var value = this_1.n1(ssid);
        var tmp;
        if (value == null) {
          // Inline function 'com.indoor.location.checkpoint.CheckPointAlgorithm.update.<anonymous>' call
          // Inline function 'kotlin.collections.arrayListOf' call
          var answer = ArrayList_init_$Create$();
          this_1.t3(ssid, answer);
          tmp = answer;
        } else {
          tmp = value;
        }
        tmp.r2(scanInfo);
        $l$loop: while (scanInfo.yp_1.a2(first(this.sp_1).yp_1).y1(toLong(this.rp_1)) > 0) {
          var tmp0_elvis_lhs = removeFirstOrNull(this.sp_1);
          var tmp_0;
          if (tmp0_elvis_lhs == null) {
            continue $l$loop;
          } else {
            tmp_0 = tmp0_elvis_lhs;
          }
          var scan = tmp_0;
          var tmp1_safe_receiver = this.up_1.n1(scan.wp_1);
          if (tmp1_safe_receiver == null) null;
          else tmp1_safe_receiver.f4(scan);
          var tmp2_safe_receiver = this.up_1.n1(scan.wp_1);
          if (tmp2_safe_receiver == null) null;
          else {
            // Inline function 'kotlin.collections.ifEmpty' call
            // Inline function 'kotlin.contracts.contract' call
            var tmp_1;
            if (tmp2_safe_receiver.i()) {
              // Inline function 'com.indoor.location.checkpoint.CheckPointAlgorithm.update.<anonymous>' call
              tmp_1 = CheckPointAlgorithm_getInstance().up_1.o4(scan.wp_1);
            } else {
              tmp_1 = tmp2_safe_receiver;
            }
          }
        }
        this.tp_1.h3();
        // Inline function 'kotlin.collections.iterator' call
        var _iterator__ex2g4s = this.up_1.o1().l();
        while (_iterator__ex2g4s.m()) {
          var _destruct__k2r9zo = _iterator__ex2g4s.n();
          // Inline function 'kotlin.collections.component1' call
          var ssid2 = _destruct__k2r9zo.j1();
          // Inline function 'kotlin.collections.component2' call
          var infos = _destruct__k2r9zo.k1();
          var maxInfo = first(infos);
          var _iterator__ex2g4s_0 = infos.l();
          while (_iterator__ex2g4s_0.m()) {
            var info = _iterator__ex2g4s_0.n();
            if (info.xp_1 > maxInfo.xp_1) {
              maxInfo = info;
            }
          }
          this.tp_1.r2(new ScanInfo(ssid2, maxInfo.xp_1, maxInfo.yp_1));
        }
        // Inline function 'kotlin.collections.sortByDescending' call
        var this_2 = this.tp_1;
        if (this_2.p() > 1) {
          // Inline function 'kotlin.comparisons.compareByDescending' call
          var tmp_2 = CheckPointAlgorithm$update$lambda;
          var tmp$ret$10 = new sam$kotlin_Comparator$0(tmp_2);
          sortWith(this_2, tmp$ret$10);
        }
        var maxScan = first(this.tp_1);
        var tmp3_safe_receiver = lastOrNull(this.vp_1);
        if (!((tmp3_safe_receiver == null ? null : tmp3_safe_receiver.zp_1) === maxScan.wp_1)) {
          this.vp_1.r2(new History(maxScan.wp_1, maxScan.xp_1, timestamp, timestamp));
        } else {
          last(this.vp_1).cq_1 = timestamp;
        }
        $l$loop_0: while (true) {
          var tmp_3 = first(this.vp_1).cq_1;
          // Inline function 'kotlin.Long.minus' call
          var other = this.rp_1;
          var tmp$ret$11 = timestamp.a2(toLong(other));
          if (!(tmp_3.y1(tmp$ret$11) < 0)) {
            break $l$loop_0;
          }
          removeFirstOrNull(this.vp_1);
        }
        var tmp_4 = first(this.vp_1).bq_1;
        // Inline function 'kotlin.Long.minus' call
        var other_0 = this.rp_1;
        var tmp$ret$12 = timestamp.a2(toLong(other_0));
        if (tmp_4.y1(tmp$ret$12) < 0) {
          var tmp_5 = first(this.vp_1);
          // Inline function 'kotlin.Long.minus' call
          var other_1 = this.rp_1;
          tmp_5.bq_1 = timestamp.a2(toLong(other_1));
        }
        var his = HashMap_init_$Create$();
        var _iterator__ex2g4s_1 = this.vp_1.l();
        while (_iterator__ex2g4s_1.m()) {
          var h = _iterator__ex2g4s_1.n();
          // Inline function 'kotlin.collections.set' call
          var key = h.zp_1;
          // Inline function 'kotlin.collections.getOrPut' call
          var key_0 = h.zp_1;
          var value_0 = his.n1(key_0);
          var tmp_6;
          if (value_0 == null) {
            // Inline function 'com.indoor.location.checkpoint.CheckPointAlgorithm.update.<anonymous>' call
            var answer_0 = new Long(0, 0);
            his.t3(key_0, answer_0);
            tmp_6 = answer_0;
          } else {
            tmp_6 = value_0;
          }
          var value_1 = tmp_6.z1(h.cq_1).a2(h.bq_1);
          his.t3(key, value_1);
        }
        var sid = CheckPoint_getInstance().np_1.ep_1;
        // Inline function 'kotlin.collections.set' call
        var key_1 = sid;
        // Inline function 'kotlin.Long.plus' call
        // Inline function 'kotlin.collections.getOrPut' call
        var key_2 = sid;
        var value_2 = his.n1(key_2);
        var tmp_7;
        if (value_2 == null) {
          // Inline function 'com.indoor.location.checkpoint.CheckPointAlgorithm.update.<anonymous>' call
          var answer_1 = new Long(0, 0);
          his.t3(key_2, answer_1);
          tmp_7 = answer_1;
        } else {
          tmp_7 = value_2;
        }
        var value_3 = tmp_7.z1(toLong(200));
        his.t3(key_1, value_3);
        var tmp$ret$19;
        $l$block_0: {
          // Inline function 'kotlin.collections.maxByOrNull' call
          var iterator = his.o1().l();
          if (!iterator.m()) {
            tmp$ret$19 = null;
            break $l$block_0;
          }
          var maxElem = iterator.n();
          if (!iterator.m()) {
            tmp$ret$19 = maxElem;
            break $l$block_0;
          }
          // Inline function 'com.indoor.location.checkpoint.CheckPointAlgorithm.update.<anonymous>' call
          var maxValue = maxElem.k1();
          do {
            var e = iterator.n();
            // Inline function 'com.indoor.location.checkpoint.CheckPointAlgorithm.update.<anonymous>' call
            var v = e.k1();
            if (compareTo(maxValue, v) < 0) {
              maxElem = e;
              maxValue = v;
            }
          } while (iterator.m());
          tmp$ret$19 = maxElem;
        }
        sid = ensureNotNull(tmp$ret$19).j1();
        if (!(sid === CheckPoint_getInstance().np_1.ep_1)) {
          var result = this.qp_1.n1(sid);
          Companion_getInstance().cf([sid, CheckPoint_getInstance().np_1.ep_1, maxScan, result]);
          if (!(result == null)) {
            CheckPoint_getInstance().np_1.ep_1 = result.ep_1;
            CheckPoint_getInstance().np_1.hp_1 = result.hp_1;
            CheckPoint_getInstance().np_1.ip_1 = result.ip_1;
            CheckPoint_getInstance().np_1.gp_1 = result.gp_1;
            CheckPoint_getInstance().np_1.fp_1 = result.fp_1;
            CheckPoint_getInstance().np_1.jp_1 = result.jp_1;
            CheckPoint_getInstance().np_1.kp_1 = result.kp_1;
            CheckPoint_getInstance().np_1.lp_1 = result.lp_1;
            CheckPoint_getInstance().np_1.mp_1 = timestamp;
          }
        }
        CheckPoint_getInstance().np_1.mp_1 = timestamp;
      }
      if (timestamp.a2(CheckPoint_getInstance().np_1.mp_1).y1(toLong(this.rp_1)) > 0) {
        CheckPoint_getInstance().np_1.ep_1 = "";
        CheckPoint_getInstance().np_1.hp_1 = "";
        CheckPoint_getInstance().np_1.ip_1 = "";
        CheckPoint_getInstance().np_1.gp_1 = "";
        CheckPoint_getInstance().np_1.fp_1 = "";
        CheckPoint_getInstance().np_1.jp_1 = 0.0;
        CheckPoint_getInstance().np_1.kp_1 = 0.0;
        CheckPoint_getInstance().np_1.lp_1 = 0;
        CheckPoint_getInstance().np_1.mp_1 = new Long(0, 0);
      }
      return CheckPoint_getInstance().np_1;
    };
    var CheckPointAlgorithm_instance;
    function CheckPointAlgorithm_getInstance() {
      if (CheckPointAlgorithm_instance == null) new CheckPointAlgorithm();
      return CheckPointAlgorithm_instance;
    }
    function init(_this__u8e3s4, checkPointJson) {
      CheckPointAlgorithm_getInstance().eq(checkPointJson);
    }
    //region block: exports
    _.$_$ = _.$_$ || {};
    _.$_$.a = init;
    _.$_$.b = CheckPoint_getInstance;
    //endregion
    return _;
  })({}, kotlin_kotlin, kotlin_com_hgwen_hgutils_hgutils);

  //# sourceMappingURL=NewSDK-Exts-CheckPoint.js.map
  var kotlin_NewSDK_Exts_StepLengthEstimator = (function (_, kotlin_kotlin, kotlin_com_hgwen_hgutils_hgutils) {
    "use strict";
    //region block: imports
    var imul = Math.imul;
    var Long = kotlin_kotlin.$_$.w4;
    var hgutils_instance = kotlin_com_hgwen_hgutils_hgutils.$_$.l;
    var protoOf = kotlin_kotlin.$_$.o3;
    var initMetadataForClass = kotlin_kotlin.$_$.w2;
    var vectornd_init_$Create$ = kotlin_com_hgwen_hgutils_hgutils.$_$.f;
    var matrixnd = kotlin_com_hgwen_hgutils_hgutils.$_$.b;
    var vector3d = kotlin_com_hgwen_hgutils_hgutils.$_$.c;
    var ArrayList_init_$Create$ = kotlin_kotlin.$_$.e;
    var ArrayList_init_$Create$_0 = kotlin_kotlin.$_$.d;
    var Unit_instance = kotlin_kotlin.$_$.y;
    var Companion_getInstance = kotlin_com_hgwen_hgutils_hgutils.$_$.j;
    var Companion_instance = kotlin_com_hgwen_hgutils_hgutils.$_$.n;
    var vector3d_init_$Create$ = kotlin_com_hgwen_hgutils_hgutils.$_$.e;
    var numberToLong = kotlin_kotlin.$_$.m3;
    var vector4d = kotlin_com_hgwen_hgutils_hgutils.$_$.d;
    var Companion_getInstance_0 = kotlin_com_hgwen_hgutils_hgutils.$_$.g;
    var toLong = kotlin_kotlin.$_$.q3;
    var ensureNotNull = kotlin_kotlin.$_$.b5;
    var hgmath_instance = kotlin_com_hgwen_hgutils_hgutils.$_$.k;
    var last = kotlin_kotlin.$_$.t1;
    var max = kotlin_kotlin.$_$.v1;
    var min = kotlin_kotlin.$_$.x1;
    var first = kotlin_kotlin.$_$.h1;
    var getProgressionLastElement = kotlin_kotlin.$_$.e2;
    var NoSuchElementException_init_$Create$ = kotlin_kotlin.$_$.q;
    var defineProp = kotlin_kotlin.$_$.o2;
    var initMetadataForObject = kotlin_kotlin.$_$.z2;
    var Enum = kotlin_kotlin.$_$.u4;
    var VOID = kotlin_kotlin.$_$.c;
    var getNumberHashCode = kotlin_kotlin.$_$.s2;
    var THROW_CCE = kotlin_kotlin.$_$.y4;
    var equals = kotlin_kotlin.$_$.p2;
    var anyToString = kotlin_kotlin.$_$.h2;
    var HashMap_init_$Create$ = kotlin_kotlin.$_$.f;
    var KtMap = kotlin_kotlin.$_$.b1;
    var isInterface = kotlin_kotlin.$_$.g3;
    var lastOrNull = kotlin_kotlin.$_$.s1;
    var Companion_getInstance_1 = kotlin_com_hgwen_hgutils_hgutils.$_$.h;
    var get_lastIndex = kotlin_kotlin.$_$.r1;
    var roundToInt = kotlin_kotlin.$_$.s3;
    var firstOrNull = kotlin_kotlin.$_$.g1;
    //endregion
    //region block: pre-declaration
    initMetadataForClass(TimeValue, "TimeValue", TimeValue);
    initMetadataForObject(InseKalmanFilter, "InseKalmanFilter");
    initMetadataForClass(LocationType, "LocationType", VOID, Enum);
    initMetadataForClass(LocationInfo, "LocationInfo", LocationInfo);
    initMetadataForClass(StepLengthHistory, "StepLengthHistory", StepLengthHistory);
    initMetadataForObject(StepLengthEstimator, "StepLengthEstimator");
    //endregion
    function TimeValue() {
      this.fq_1 = new Long(0, 0);
      this.gq_1 = 0.0;
      this.hq_1 = false;
      this.iq_1 = new Float32Array(3);
    }
    protoOf(TimeValue).toString = function () {
      return hgutils_instance.ji(["(%d,%f,%s)", this.fq_1, this.gq_1, this.hq_1 ? "T" : "F"]);
    };
    protoOf(TimeValue).jq = function (tv) {
      return this.gq_1 - tv.gq_1;
    };
    function InseKalmanFilter() {
      InseKalmanFilter_instance = this;
      this.kq_1 = vectornd_init_$Create$(16);
      this.lq_1 = 0.9999;
      this.mq_1 = 0.999;
      this.nq_1 = new matrixnd(16, 16).lj(1.0e-9);
      this.initialized = false;
      this.oq_1 = new vector3d();
      this.pq_1 = 0;
      this.qq_1 = ArrayList_init_$Create$();
      this.rq_1 = ArrayList_init_$Create$();
      this.sq_1 = null;
      this.tq_1 = null;
      this.uq_1 = null;
      this.vq_1 = 0.0;
      this.wq_1 = null;
      this.xq_1 = 300;
      this.yq_1 = 0.5;
      this.zq_1 = 3;
      this.ar_1 = null;
      this.br_1 = null;
      this.cr_1 = 200;
      var tmp = this;
      // Inline function 'kotlin.collections.MutableList' call
      var size = (this.cr_1 + 1) | 0;
      var list = ArrayList_init_$Create$_0(size);
      // Inline function 'kotlin.repeat' call
      // Inline function 'kotlin.contracts.contract' call
      var inductionVariable = 0;
      if (inductionVariable < size)
        do {
          var index = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          // Inline function 'kotlin.collections.MutableList.<anonymous>' call
          // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.magneticOrientations.<anonymous>' call
          list.r2(0.0);
        } while (inductionVariable < size);
      tmp.dr_1 = list;
      var tmp_0 = this;
      // Inline function 'kotlin.collections.MutableList' call
      var size_0 = (this.cr_1 + 1) | 0;
      var list_0 = ArrayList_init_$Create$_0(size_0);
      // Inline function 'kotlin.repeat' call
      // Inline function 'kotlin.contracts.contract' call
      var inductionVariable_0 = 0;
      if (inductionVariable_0 < size_0)
        do {
          var index_0 = inductionVariable_0;
          inductionVariable_0 = (inductionVariable_0 + 1) | 0;
          // Inline function 'kotlin.collections.MutableList.<anonymous>' call
          // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.gameOrientations.<anonymous>' call
          list_0.r2(0.0);
        } while (inductionVariable_0 < size_0);
      tmp_0.er_1 = list_0;
      this.fr_1 = ArrayList_init_$Create$_0((this.cr_1 + 1) | 0);
      var tmp_1 = this;
      // Inline function 'kotlin.collections.MutableList' call
      var size_1 = (this.cr_1 + 1) | 0;
      var list_1 = ArrayList_init_$Create$_0(size_1);
      // Inline function 'kotlin.repeat' call
      // Inline function 'kotlin.contracts.contract' call
      var inductionVariable_1 = 0;
      if (inductionVariable_1 < size_1)
        do {
          var index_1 = inductionVariable_1;
          inductionVariable_1 = (inductionVariable_1 + 1) | 0;
          // Inline function 'kotlin.collections.MutableList.<anonymous>' call
          // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.magnOrientations.<anonymous>' call
          var tmp$ret$4 = new vector3d();
          list_1.r2(tmp$ret$4);
        } while (inductionVariable_1 < size_1);
      tmp_1.gr_1 = list_1;
      var tmp_2 = this;
      // Inline function 'kotlin.collections.MutableList' call
      var size_2 = (this.cr_1 + 1) | 0;
      var list_2 = ArrayList_init_$Create$_0(size_2);
      // Inline function 'kotlin.repeat' call
      // Inline function 'kotlin.contracts.contract' call
      var inductionVariable_2 = 0;
      if (inductionVariable_2 < size_2)
        do {
          var index_2 = inductionVariable_2;
          inductionVariable_2 = (inductionVariable_2 + 1) | 0;
          // Inline function 'kotlin.collections.MutableList.<anonymous>' call
          // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.gyroOrientations.<anonymous>' call
          var tmp$ret$6 = new vector3d();
          list_2.r2(tmp$ret$6);
        } while (inductionVariable_2 < size_2);
      tmp_2.hr_1 = list_2;
      this.ir_1 = new vector3d();
      this.jr_1 = new vector3d();
      this.kr_1 = "No message";
      this.lr_1 = 0.0;
      this.mr_1 = 0.0;
      this.calibrated = false;
      this.nr_1 = new Long(0, 0);
      this.or_1 = new Long(0, 0);
    }
    protoOf(InseKalmanFilter).pr = function (_set____db54di) {
      this.initialized = _set____db54di;
    };
    protoOf(InseKalmanFilter).qr = function () {
      return this.initialized;
    };
    protoOf(InseKalmanFilter).init = function (initialOrientation) {
      Companion_getInstance().cf([
        "initialPos",
        initialOrientation,
        Companion_instance.cl(initialOrientation),
        Companion_instance.cl(initialOrientation).bl().ml(),
      ]);
      this.rr(vector3d_init_$Create$(116, 40, 0), Companion_instance.cl(initialOrientation).bl().nl(), new vector3d());
    };
    protoOf(InseKalmanFilter).sr = function (initialRotation) {
      Companion_getInstance().cf(["initialPos", initialRotation]);
      this.rr(vector3d_init_$Create$(116, 40, 0), initialRotation, new vector3d());
    };
    protoOf(InseKalmanFilter).rr = function (initialPos, initialAtt, initialVel) {
      Companion_getInstance().cf(["initialPos", initialPos, initialAtt, initialVel]);
      var inductionVariable = 0;
      if (inductionVariable <= 3)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          this.kq_1.kj(i, initialAtt.o(i));
        } while (inductionVariable <= 3);
      var inductionVariable_0 = 4;
      if (inductionVariable_0 <= 6)
        do {
          var i_0 = inductionVariable_0;
          inductionVariable_0 = (inductionVariable_0 + 1) | 0;
          this.kq_1.kj(i_0, 0.0);
        } while (inductionVariable_0 <= 6);
      var inductionVariable_1 = 7;
      if (inductionVariable_1 <= 9)
        do {
          var i_1 = inductionVariable_1;
          inductionVariable_1 = (inductionVariable_1 + 1) | 0;
          this.kq_1.kj(i_1, initialPos.o((i_1 - 7) | 0));
        } while (inductionVariable_1 <= 9);
      var inductionVariable_2 = 10;
      if (inductionVariable_2 <= 12)
        do {
          var i_2 = inductionVariable_2;
          inductionVariable_2 = (inductionVariable_2 + 1) | 0;
          this.kq_1.kj(i_2, initialVel.o((i_2 - 10) | 0));
        } while (inductionVariable_2 <= 12);
      var inductionVariable_3 = 13;
      if (inductionVariable_3 <= 15)
        do {
          var i_3 = inductionVariable_3;
          inductionVariable_3 = (inductionVariable_3 + 1) | 0;
          this.kq_1.kj(i_3, 0.0);
        } while (inductionVariable_3 <= 15);
      this.nq_1.lj(1.0e-9);
      this.initialized = true;
      this.dr_1.h3();
      this.er_1.h3();
      this.fr_1.h3();
      this.lr_1 = 0.0;
      this.mr_1 = 0.0;
      this.calibrated = false;
      this.nr_1 = new Long(0, 0);
      this.oo();
    };
    protoOf(InseKalmanFilter).updateAcceleration = function (x, y, z, timestamp) {
      this.tr(new vector3d(x, y, z), numberToLong(timestamp));
    };
    protoOf(InseKalmanFilter).tr = function (acc, timestamp) {
      this.oq_1 = acc.sg();
    };
    protoOf(InseKalmanFilter).updateGyroscope = function (x, y, z, timestamp) {
      this.ur(new vector3d(x, y, z), numberToLong(timestamp));
    };
    protoOf(InseKalmanFilter).ur = function (gyro, timestamp) {
      var tmp = this.oq_1;
      // Inline function 'kotlin.Long.div' call
      var tmp$ret$0 = timestamp.a2(this.or_1).j2() / 1000.0;
      this.vr(tmp, gyro, tmp$ret$0);
      this.or_1 = timestamp;
    };
    protoOf(InseKalmanFilter).vr = function (acc, gyro, dt) {
      this.or_1 = this.or_1.z1(numberToLong(dt * 1000));
      // Inline function 'kotlin.floatArrayOf' call
      var tmp$ret$0 = new Float32Array([acc.x, acc.y, acc.z]);
      this.wr(tmp$ret$0, this.or_1);
      if (!this.initialized) return Unit_instance;
      this.xr(acc, gyro, dt);
      var F = this.yr(acc, gyro, dt);
      var G = this.zr(this.kq_1, dt);
      var U = this.as();
      this.bs(F, U, G);
      this.cs();
    };
    protoOf(InseKalmanFilter).ds = function () {
      if (!this.initialized) return new vector4d();
      return new vector4d(this.kq_1.o(0), this.kq_1.o(1), this.kq_1.o(2), this.kq_1.o(3)).bl();
    };
    protoOf(InseKalmanFilter).oo = function () {
      this.qq_1.h3();
      this.rq_1.h3();
      this.xq_1 = 300;
      this.yq_1 = Companion_getInstance_0().af("DefaultIncreasementThresholdForPedometer", 0.5);
      this.zq_1 = Companion_getInstance_0().af("DefaultAccelerationDifferenceForPedometer", 3);
    };
    protoOf(InseKalmanFilter).wr = function (acc, ts) {
      var tv = new TimeValue();
      var tmp = tv;
      // Inline function 'kotlin.collections.copyOf' call
      // Inline function 'kotlin.js.asDynamic' call
      tmp.iq_1 = acc.slice();
      tv.fq_1 = ts;
      var tmp_0 = tv;
      // Inline function 'kotlin.math.sqrt' call
      var x = acc[0] * acc[0] + acc[1] * acc[1] + acc[2] * acc[2];
      tmp_0.gq_1 = Math.sqrt(x);
      if (this.sq_1 == null) {
        this.sq_1 = tv;
        this.tq_1 = tv;
        this.uq_1 = tv;
        return Unit_instance;
      }
      this.qq_1.r2(tv);
      $l$loop: while (true) {
        var tmp_1 = this.qq_1.o(0).fq_1;
        // Inline function 'kotlin.Long.minus' call
        var tmp$ret$3 = tv.fq_1.a2(toLong(5000));
        if (!(tmp_1.y1(tmp$ret$3) < 0)) {
          break $l$loop;
        }
        this.qq_1.y2(0);
      }
      this.es(tv);
    };
    protoOf(InseKalmanFilter).es = function (tv) {
      var delta = tv.jq(ensureNotNull(this.sq_1));
      // Inline function 'kotlin.math.abs' call
      if (Math.abs(delta) < 0.001) {
        return Unit_instance;
      }
      if (delta * this.vq_1 < 0 && tv.fq_1.a2(this.qq_1.o(0).fq_1).y1(new Long(1000, 0)) > 0 && this.qq_1.p() > 10) {
        this.tq_1 = tv;
        this.uq_1 = tv;
        var _iterator__ex2g4s = this.qq_1.l();
        while (_iterator__ex2g4s.m()) {
          var v = _iterator__ex2g4s.n();
          if (v.gq_1 < ensureNotNull(this.tq_1).gq_1) {
            this.tq_1 = v;
          } else if (v.gq_1 > ensureNotNull(this.uq_1).gq_1) {
            this.uq_1 = v;
          }
        }
        // Inline function 'kotlin.math.abs' call
        var x = ensureNotNull(this.uq_1).jq(ensureNotNull(this.tq_1));
        if (Math.abs(x) > this.zq_1) {
          this.fs();
        }
      }
      this.sq_1 = tv;
      this.vq_1 = delta;
    };
    protoOf(InseKalmanFilter).fs = function () {
      ensureNotNull(this.sq_1).hq_1 = this.vq_1 > 0;
      if (this.rq_1.p() > 0) {
        this.gs();
      } else {
        this.rq_1.r2(this.sq_1);
        this.pq_1 = (this.pq_1 + 1) | 0;
        Companion_getInstance().cf(["mStepCount+", (this.pq_1 / 2) | 0, this.pq_1, this.sq_1]);
        this.wq_1 = this.sq_1;
        if (ensureNotNull(this.sq_1).hq_1) {
          this.br_1 = this.sq_1;
        } else {
          this.ar_1 = this.sq_1;
        }
      }
      if (this.rq_1.p() > 10) {
        this.rq_1.y2(0);
      }
    };
    protoOf(InseKalmanFilter).gs = function () {
      var lastStep = this.rq_1.o((this.rq_1.p() - 1) | 0);
      var time = ensureNotNull(this.sq_1).fq_1.a2(ensureNotNull(this.wq_1).fq_1);
      if (ensureNotNull(lastStep).hq_1 === ensureNotNull(this.sq_1).hq_1) {
        if (
          (ensureNotNull(this.sq_1).hq_1 && ensureNotNull(this.sq_1).gq_1 > lastStep.gq_1) ||
          (!ensureNotNull(this.sq_1).hq_1 && ensureNotNull(this.sq_1).gq_1 < lastStep.gq_1)
        ) {
          Companion_getInstance().cf(["mStepCount=", (this.pq_1 / 2) | 0, this.pq_1, lastStep, this.sq_1]);
          this.rq_1.y2((this.rq_1.p() - 1) | 0);
          this.rq_1.r2(this.sq_1);
          var tmp;
          var tmp_0;
          if (ensureNotNull(this.sq_1).hq_1) {
            var tmp_1 = ensureNotNull(this.sq_1).fq_1;
            var tmp0_safe_receiver = this.br_1;
            var tmp1_elvis_lhs = tmp0_safe_receiver == null ? null : tmp0_safe_receiver.fq_1;
            tmp_0 = tmp_1.a2(tmp1_elvis_lhs == null ? new Long(0, 0) : tmp1_elvis_lhs).y1(toLong(this.xq_1)) > 0;
          } else {
            tmp_0 = false;
          }
          if (tmp_0) {
            tmp = true;
          } else {
            var tmp_2;
            if (!ensureNotNull(this.sq_1).hq_1) {
              var tmp_3 = ensureNotNull(this.sq_1).fq_1;
              var tmp2_safe_receiver = this.ar_1;
              var tmp3_elvis_lhs = tmp2_safe_receiver == null ? null : tmp2_safe_receiver.fq_1;
              tmp_2 = tmp_3.a2(tmp3_elvis_lhs == null ? new Long(0, 0) : tmp3_elvis_lhs).y1(toLong(this.xq_1)) > 0;
            } else {
              tmp_2 = false;
            }
            tmp = tmp_2;
          }
          if (tmp) {
            this.pq_1 = (this.pq_1 + 1) | 0;
            Companion_getInstance().cf(["mStepCount++", (this.pq_1 / 2) | 0, this.pq_1, time, this.sq_1]);
            this.wq_1 = this.sq_1;
            if (ensureNotNull(this.sq_1).hq_1) {
              this.br_1 = this.sq_1;
            } else {
              this.ar_1 = this.sq_1;
            }
          }
        }
      } else {
        // Inline function 'kotlin.math.abs' call
        var x = ensureNotNull(this.sq_1).jq(lastStep);
        var tmp_4 = Math.abs(x);
        // Inline function 'kotlin.math.abs' call
        var x_0 = ensureNotNull(this.uq_1).jq(ensureNotNull(this.tq_1));
        if (tmp_4 > Math.abs(x_0) * this.yq_1) {
          this.rq_1.r2(this.sq_1);
          var tmp_5;
          var tmp_6;
          if (ensureNotNull(this.sq_1).hq_1) {
            var tmp_7 = ensureNotNull(this.sq_1).fq_1;
            var tmp4_safe_receiver = this.br_1;
            var tmp5_elvis_lhs = tmp4_safe_receiver == null ? null : tmp4_safe_receiver.fq_1;
            tmp_6 = tmp_7.a2(tmp5_elvis_lhs == null ? new Long(0, 0) : tmp5_elvis_lhs).y1(toLong(this.xq_1)) > 0;
          } else {
            tmp_6 = false;
          }
          if (tmp_6) {
            tmp_5 = true;
          } else {
            var tmp_8;
            if (!ensureNotNull(this.sq_1).hq_1) {
              var tmp_9 = ensureNotNull(this.sq_1).fq_1;
              var tmp6_safe_receiver = this.ar_1;
              var tmp7_elvis_lhs = tmp6_safe_receiver == null ? null : tmp6_safe_receiver.fq_1;
              tmp_8 = tmp_9.a2(tmp7_elvis_lhs == null ? new Long(0, 0) : tmp7_elvis_lhs).y1(toLong(this.xq_1)) > 0;
            } else {
              tmp_8 = false;
            }
            tmp_5 = tmp_8;
          }
          if (tmp_5) {
            this.pq_1 = (this.pq_1 + 1) | 0;
            Companion_getInstance().cf(["mStepCount+", (this.pq_1 / 2) | 0, this.pq_1, time, this.sq_1]);
            this.wq_1 = this.sq_1;
            if (ensureNotNull(this.sq_1).hq_1) {
              this.br_1 = this.sq_1;
            } else {
              this.ar_1 = this.sq_1;
            }
          } else {
            Companion_getInstance().cf(["mStepCount*", (this.pq_1 / 2) | 0, this.pq_1, time, this.sq_1]);
          }
        }
      }
    };
    protoOf(InseKalmanFilter).hs = function () {
      return (this.pq_1 / 2) | 0;
    };
    protoOf(InseKalmanFilter).updateOrientation = function (x, y, z) {
      this.ir_1.vk(x, y, z);
      if (!this.initialized) {
        this.init(new vector3d(x, y, z));
      }
      this.is(x);
    };
    protoOf(InseKalmanFilter).is = function (orient) {
      while (this.dr_1.p() > this.cr_1) {
        this.dr_1.y2(0);
      }
      this.dr_1.r2(orient);
    };
    protoOf(InseKalmanFilter).cs = function () {
      while (this.er_1.p() > this.cr_1) {
        this.er_1.y2(0);
      }
      this.jr_1 = this.ds().ml().ol();
      var gameOrient = this.jr_1.x;
      // Inline function 'kotlin.collections.isNotEmpty' call
      if (!this.er_1.i()) {
        gameOrient = hgmath_instance.pi(gameOrient, last(this.er_1));
      }
      this.er_1.r2(gameOrient);
      while (this.fr_1.p() > this.cr_1) {
        this.fr_1.y2(0);
      }
      this.fr_1.r2(this.hs());
      this.js();
      if (this.or_1.a2(this.nr_1).y1(new Long(1000, 0)) < 0) {
        return Unit_instance;
      }
      if (!(this.er_1.p() > this.cr_1 && this.dr_1.p() > this.cr_1)) {
        return Unit_instance;
      }
      var tmp;
      // Inline function 'kotlin.math.abs' call
      var x = hgmath_instance.qi(max(this.er_1) - min(this.er_1));
      if (Math.abs(x) < 30) {
        tmp = ((this.hs() - first(this.fr_1)) | 0) < 2;
      } else {
        tmp = false;
      }
      if (tmp) {
        return Unit_instance;
      }
      var nestedLast = this.cr_1;
      var inductionVariable = 0;
      var last_0 = getProgressionLastElement(0, nestedLast, 10);
      if (inductionVariable <= last_0)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 10) | 0;
          var deltaGame = hgmath_instance.qi(this.er_1.o(i) - first(this.er_1));
          var deltaMagnetic = hgmath_instance.qi(this.dr_1.o(i) - first(this.dr_1));
          this.lr_1 = hgmath_instance.qi(deltaGame - deltaMagnetic);
          // Inline function 'kotlin.math.abs' call
          var x_0 = this.lr_1;
          if (Math.abs(x_0) > 5) {
            this.kr_1 = hgutils_instance.ji([
              "\u65B9\u5411\u53D8\u5316\u4E0D\u4E00\u81F4",
              i,
              this.lr_1,
              "G",
              deltaGame,
              this.er_1.o(i),
              first(this.er_1),
              "M",
              deltaMagnetic,
              this.dr_1.o(i),
              first(this.dr_1),
            ]);
            Companion_getInstance().qe(this.kr_1);
            var inductionVariable_0 = 0;
            // Inline function 'kotlin.math.min' call
            var a = i;
            var b = (this.cr_1 - 1) | 0;
            var last_1 = Math.min(a, b);
            if (inductionVariable_0 <= last_1)
              do {
                var j = inductionVariable_0;
                inductionVariable_0 = (inductionVariable_0 + 1) | 0;
                this.er_1.y2(0);
                this.dr_1.y2(0);
                this.fr_1.y2(0);
              } while (!(j === last_1));
            return Unit_instance;
          }
        } while (!(i === last_0));
      this.calibrated = true;
      this.nr_1 = this.or_1;
      this.mr_1 = hgmath_instance.qi(last(this.dr_1) - last(this.er_1));
      this.kr_1 = hgutils_instance.ji(["\u65B9\u5411\u57FA\u51C6", this.mr_1, last(this.dr_1), last(this.er_1)]);
      Companion_getInstance().qe(this.kr_1);
    };
    protoOf(InseKalmanFilter).js = function () {
      while (this.gr_1.p() > this.cr_1) {
        this.gr_1.y2(0);
      }
      this.gr_1.r2(this.ir_1.sg());
      while (this.hr_1.p() > this.cr_1) {
        this.hr_1.y2(0);
      }
      this.hr_1.r2(this.jr_1);
      if (this.hr_1.p() < this.cr_1 || this.gr_1.p() < this.cr_1) {
        return Unit_instance;
      }
      // Inline function 'kotlin.collections.minOf' call
      var iterator = this.gr_1.l();
      if (!iterator.m()) throw NoSuchElementException_init_$Create$();
      // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.checkAbnormalResult.<anonymous>' call
      var minValue = iterator.n().z;
      while (iterator.m()) {
        // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.checkAbnormalResult.<anonymous>' call
        var v = iterator.n().z;
        // Inline function 'kotlin.comparisons.minOf' call
        var a = minValue;
        minValue = Math.min(a, v);
      }
      var minM = minValue;
      // Inline function 'kotlin.collections.maxOf' call
      var iterator_0 = this.gr_1.l();
      if (!iterator_0.m()) throw NoSuchElementException_init_$Create$();
      // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.checkAbnormalResult.<anonymous>' call
      var maxValue = iterator_0.n().z;
      while (iterator_0.m()) {
        // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.checkAbnormalResult.<anonymous>' call
        var v_0 = iterator_0.n().z;
        // Inline function 'kotlin.comparisons.maxOf' call
        var a_0 = maxValue;
        maxValue = Math.max(a_0, v_0);
      }
      var maxM = maxValue;
      // Inline function 'kotlin.collections.minOf' call
      var iterator_1 = this.hr_1.l();
      if (!iterator_1.m()) throw NoSuchElementException_init_$Create$();
      // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.checkAbnormalResult.<anonymous>' call
      var minValue_0 = iterator_1.n().z;
      while (iterator_1.m()) {
        // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.checkAbnormalResult.<anonymous>' call
        var v_1 = iterator_1.n().z;
        // Inline function 'kotlin.comparisons.minOf' call
        var a_1 = minValue_0;
        minValue_0 = Math.min(a_1, v_1);
      }
      var minG = minValue_0;
      // Inline function 'kotlin.collections.maxOf' call
      var iterator_2 = this.hr_1.l();
      if (!iterator_2.m()) throw NoSuchElementException_init_$Create$();
      // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.checkAbnormalResult.<anonymous>' call
      var maxValue_0 = iterator_2.n().z;
      while (iterator_2.m()) {
        // Inline function 'com.indoor.steplengthestimator.InseKalmanFilter.checkAbnormalResult.<anonymous>' call
        var v_2 = iterator_2.n().z;
        // Inline function 'kotlin.comparisons.maxOf' call
        var a_2 = maxValue_0;
        maxValue_0 = Math.max(a_2, v_2);
      }
      var maxG = maxValue_0;
      if (maxM - minM < 10 && maxG - minG > 30) {
        Companion_getInstance().cf([
          "Min,Max,Max-Min",
          minM,
          maxM,
          maxM - minM,
          "--",
          minG,
          maxG,
          maxG - minG,
          "--",
          this.ir_1,
          this.jr_1,
          this.gr_1.p(),
          this.hr_1.p(),
        ]);
        this.ks(this.ir_1);
      }
    };
    protoOf(InseKalmanFilter).ks = function (initialOrientation) {
      Companion_getInstance().cf([
        "reinitialPos",
        initialOrientation,
        Companion_instance.cl(initialOrientation),
        Companion_instance.cl(initialOrientation).bl().ml(),
      ]);
      var initialPos = vector3d_init_$Create$(116, 40, 0);
      var initialAtt = Companion_instance.cl(initialOrientation).bl().nl();
      var initialVel = new vector3d();
      Companion_getInstance().cf(["reinitialPos", initialPos, initialAtt, initialVel]);
      var inductionVariable = 0;
      if (inductionVariable <= 3)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          this.kq_1.kj(i, initialAtt.o(i));
        } while (inductionVariable <= 3);
      var inductionVariable_0 = 4;
      if (inductionVariable_0 <= 6)
        do {
          var i_0 = inductionVariable_0;
          inductionVariable_0 = (inductionVariable_0 + 1) | 0;
          this.kq_1.kj(i_0, 0.0);
        } while (inductionVariable_0 <= 6);
      var inductionVariable_1 = 7;
      if (inductionVariable_1 <= 9)
        do {
          var i_1 = inductionVariable_1;
          inductionVariable_1 = (inductionVariable_1 + 1) | 0;
          this.kq_1.kj(i_1, initialPos.o((i_1 - 7) | 0));
        } while (inductionVariable_1 <= 9);
      var inductionVariable_2 = 10;
      if (inductionVariable_2 <= 12)
        do {
          var i_2 = inductionVariable_2;
          inductionVariable_2 = (inductionVariable_2 + 1) | 0;
          this.kq_1.kj(i_2, initialVel.o((i_2 - 10) | 0));
        } while (inductionVariable_2 <= 12);
      var inductionVariable_3 = 13;
      if (inductionVariable_3 <= 15)
        do {
          var i_3 = inductionVariable_3;
          inductionVariable_3 = (inductionVariable_3 + 1) | 0;
          this.kq_1.kj(i_3, 0.0);
        } while (inductionVariable_3 <= 15);
      this.nq_1.lj(1.0e-9);
      this.initialized = true;
      this.dr_1.h3();
      this.er_1.h3();
      this.fr_1.h3();
      this.mr_1 = 0.0;
    };
    protoOf(InseKalmanFilter).ls = function (_set____db54di) {
      this.calibrated = _set____db54di;
    };
    protoOf(InseKalmanFilter).ms = function () {
      return this.calibrated;
    };
    protoOf(InseKalmanFilter).getOrients = function () {
      return this.ds().ml().ol();
    };
    protoOf(InseKalmanFilter).getOrient = function () {
      return this.getOrients().x;
    };
    protoOf(InseKalmanFilter).getOrientation = function () {
      return this.calibrated ? hgmath_instance.qi(this.mr_1 + this.jr_1.x) : this.ir_1.x;
    };
    protoOf(InseKalmanFilter).xr = function (acc, gyro, dt) {
      var _destruct__k2r9zo = this.kq_1;
      var q0 = _destruct__k2r9zo.x7();
      var q1 = _destruct__k2r9zo.y7();
      var q2 = _destruct__k2r9zo.i9();
      var q3 = _destruct__k2r9zo.pl();
      var gbX = _destruct__k2r9zo.ql();
      var gbY = _destruct__k2r9zo.rl();
      var gbZ = _destruct__k2r9zo.sl();
      var pn = _destruct__k2r9zo.tl();
      var pe = _destruct__k2r9zo.ul();
      var pd = _destruct__k2r9zo.vl();
      var vn = _destruct__k2r9zo.wl();
      var ve = _destruct__k2r9zo.xl();
      var vd = _destruct__k2r9zo.yl();
      var abX = _destruct__k2r9zo.zl();
      var abY = _destruct__k2r9zo.am();
      var abZ = _destruct__k2r9zo.bm();
      var lambdaAccel = 1 - this.lq_1;
      var lambdaGyro = 1 - this.mq_1;
      var gravX = 0.0;
      var gravY = 0.0;
      var gravZ = 9.81;
      this.kq_1.kj(0, q0 + dt * q1 * (gbX / 2 - gyro.x / 2) + dt * q2 * (gbY / 2 - gyro.y / 2) + dt * q3 * (gbZ / 2 - gyro.z / 2));
      this.kq_1.kj(1, q1 - dt * q0 * (gbX / 2 - gyro.x / 2) + dt * q3 * (gbY / 2 - gyro.y / 2) - dt * q2 * (gbZ / 2 - gyro.z / 2));
      this.kq_1.kj(2, q2 - dt * q3 * (gbX / 2 - gyro.x / 2) - dt * q0 * (gbY / 2 - gyro.y / 2) + dt * q1 * (gbZ / 2 - gyro.z / 2));
      this.kq_1.kj(3, q3 + dt * q2 * (gbX / 2 - gyro.x / 2) - dt * q1 * (gbY / 2 - gyro.y / 2) - dt * q0 * (gbZ / 2 - gyro.z / 2));
      this.kq_1.kj(4, -gbX * (dt * lambdaGyro - 1));
      this.kq_1.kj(5, -gbY * (dt * lambdaGyro - 1));
      this.kq_1.kj(6, -gbZ * (dt * lambdaGyro - 1));
      this.kq_1.kj(7, pn + dt * vn);
      this.kq_1.kj(8, pe + dt * ve);
      this.kq_1.kj(9, pd + dt * vd);
      this.kq_1.kj(
        10,
        vn +
          dt *
            (q0 * (q0 * (abX - acc.x) - q3 * (abY - acc.y) + q2 * (abZ - acc.z)) -
              gravX +
              q2 * (q1 * (abY - acc.y) - q2 * (abX - acc.x) + q0 * (abZ - acc.z)) +
              q1 * (q1 * (abX - acc.x) + q2 * (abY - acc.y) + q3 * (abZ - acc.z)) -
              q3 * (q3 * (abX - acc.x) + q0 * (abY - acc.y) - q1 * (abZ - acc.z))),
      );
      this.kq_1.kj(
        11,
        ve +
          dt *
            (q0 * (q3 * (abX - acc.x) + q0 * (abY - acc.y) - q1 * (abZ - acc.z)) -
              gravY -
              q1 * (q1 * (abY - acc.y) - q2 * (abX - acc.x) + q0 * (abZ - acc.z)) +
              q2 * (q1 * (abX - acc.x) + q2 * (abY - acc.y) + q3 * (abZ - acc.z)) +
              q3 * (q0 * (abX - acc.x) - q3 * (abY - acc.y) + q2 * (abZ - acc.z))),
      );
      this.kq_1.kj(
        12,
        vd +
          dt *
            (q0 * (q1 * (abY - acc.y) - q2 * (abX - acc.x) + q0 * (abZ - acc.z)) -
              gravZ +
              q1 * (q3 * (abX - acc.x) + q0 * (abY - acc.y) - q1 * (abZ - acc.z)) -
              q2 * (q0 * (abX - acc.x) - q3 * (abY - acc.y) + q2 * (abZ - acc.z)) +
              q3 * (q1 * (abX - acc.x) + q2 * (abY - acc.y) + q3 * (abZ - acc.z))),
      );
      this.kq_1.kj(13, -abX * (dt * lambdaAccel - 1));
      this.kq_1.kj(14, -abY * (dt * lambdaAccel - 1));
      this.kq_1.kj(15, -abZ * (dt * lambdaAccel - 1));
    };
    protoOf(InseKalmanFilter).yr = function (acc, gyro, dt) {
      var _destruct__k2r9zo = this.kq_1;
      var q0 = _destruct__k2r9zo.x7();
      var q1 = _destruct__k2r9zo.y7();
      var q2 = _destruct__k2r9zo.i9();
      var q3 = _destruct__k2r9zo.pl();
      var gbX = _destruct__k2r9zo.ql();
      var gbY = _destruct__k2r9zo.rl();
      var gbZ = _destruct__k2r9zo.sl();
      var pn = _destruct__k2r9zo.tl();
      var pe = _destruct__k2r9zo.ul();
      var pd = _destruct__k2r9zo.vl();
      var vn = _destruct__k2r9zo.wl();
      var ve = _destruct__k2r9zo.xl();
      var vd = _destruct__k2r9zo.yl();
      var abX = _destruct__k2r9zo.zl();
      var abY = _destruct__k2r9zo.am();
      var abZ = _destruct__k2r9zo.bm();
      var amX = acc.x7();
      var amY = acc.y7();
      var amZ = acc.i9();
      var gmX = gyro.x7();
      var gmY = gyro.y7();
      var gmZ = gyro.i9();
      var lambdaAccel = 1 - this.lq_1;
      var lambdaGyro = 1 - this.mq_1;
      var F = new matrixnd(16, 16);
      F.jj(0, 0, 1.0);
      F.jj(0, 1, dt * (gbX / 2.0 - gmX / 2.0));
      F.jj(0, 2, dt * (gbY / 2.0 - gmY / 2.0));
      F.jj(0, 3, dt * (gbZ / 2.0 - gmZ / 2.0));
      F.jj(0, 4, (dt * q1) / 2.0);
      F.jj(0, 5, (dt * q2) / 2.0);
      F.jj(0, 6, (dt * q3) / 2.0);
      F.jj(1, 0, -dt * (gbX / 2.0 - gmX / 2.0));
      F.jj(1, 1, 1.0);
      F.jj(1, 2, -dt * (gbZ / 2.0 - gmZ / 2.0));
      F.jj(1, 3, dt * (gbY / 2.0 - gmY / 2.0));
      F.jj(1, 4, dt * q0 * (-1.0 / 2.0));
      F.jj(1, 5, (dt * q3) / 2.0);
      F.jj(1, 6, dt * q2 * (-1.0 / 2.0));
      F.jj(2, 0, -dt * (gbY / 2.0 - gmY / 2.0));
      F.jj(2, 1, dt * (gbZ / 2.0 - gmZ / 2.0));
      F.jj(2, 2, 1.0);
      F.jj(2, 3, -dt * (gbX / 2.0 - gmX / 2.0));
      F.jj(2, 4, dt * q3 * (-1.0 / 2.0));
      F.jj(2, 5, dt * q0 * (-1.0 / 2.0));
      F.jj(2, 6, (dt * q1) / 2.0);
      F.jj(3, 0, -dt * (gbZ / 2.0 - gmZ / 2.0));
      F.jj(3, 1, -dt * (gbY / 2.0 - gmY / 2.0));
      F.jj(3, 2, dt * (gbX / 2.0 - gmX / 2.0));
      F.jj(3, 3, 1.0);
      F.jj(3, 4, (dt * q2) / 2.0);
      F.jj(3, 5, dt * q1 * (-1.0 / 2.0));
      F.jj(3, 6, dt * q0 * (-1.0 / 2.0));
      F.jj(4, 4, -dt * lambdaGyro + 1.0);
      F.jj(5, 5, -dt * lambdaGyro + 1.0);
      F.jj(6, 6, -dt * lambdaGyro + 1.0);
      F.jj(7, 7, 1.0);
      F.jj(7, 10, dt);
      F.jj(8, 8, 1.0);
      F.jj(8, 11, dt);
      F.jj(9, 9, 1.0);
      F.jj(9, 12, dt);
      F.jj(10, 0, dt * (q0 * (abX - amX) * 2.0 - q3 * (abY - amY) * 2.0 + q2 * (abZ - amZ) * 2.0));
      F.jj(10, 1, dt * (q1 * (abX - amX) * 2.0 + q2 * (abY - amY) * 2.0 + q3 * (abZ - amZ) * 2.0));
      F.jj(10, 2, dt * (q2 * (abX - amX) * -2.0 + q1 * (abY - amY) * 2.0 + q0 * (abZ - amZ) * 2.0));
      F.jj(10, 3, -dt * (q3 * (abX - amX) * 2.0 + q0 * (abY - amY) * 2.0 - q1 * (abZ - amZ) * 2.0));
      F.jj(10, 10, 1.0);
      F.jj(10, 13, dt * (q0 * q0 + q1 * q1 - q2 * q2 - q3 * q3));
      F.jj(10, 14, -dt * (q0 * q3 * 2.0 - q1 * q2 * 2.0));
      F.jj(10, 15, dt * (q0 * q2 * 2.0 + q1 * q3 * 2.0));
      F.jj(11, 0, dt * (q3 * (abX - amX) * 2.0 + q0 * (abY - amY) * 2.0 - q1 * (abZ - amZ) * 2.0));
      F.jj(11, 1, -dt * (q2 * (abX - amX) * -2.0 + q1 * (abY - amY) * 2.0 + q0 * (abZ - amZ) * 2.0));
      F.jj(11, 2, dt * (q1 * (abX - amX) * 2.0 + q2 * (abY - amY) * 2.0 + q3 * (abZ - amZ) * 2.0));
      F.jj(11, 3, dt * (q0 * (abX - amX) * 2.0 - q3 * (abY - amY) * 2.0 + q2 * (abZ - amZ) * 2.0));
      F.jj(11, 11, 1.0);
      F.jj(11, 13, dt * (q0 * q3 * 2.0 + q1 * q2 * 2.0));
      F.jj(11, 14, dt * (q0 * q0 - q1 * q1 + q2 * q2 - q3 * q3));
      F.jj(11, 15, -dt * (q0 * q1 * 2.0 - q2 * q3 * 2.0));
      F.jj(12, 0, dt * (q2 * (abX - amX) * -2.0 + q1 * (abY - amY) * 2.0 + q0 * (abZ - amZ) * 2.0));
      F.jj(12, 1, dt * (q3 * (abX - amX) * 2.0 + q0 * (abY - amY) * 2.0 - q1 * (abZ - amZ) * 2.0));
      F.jj(12, 2, -dt * (q0 * (abX - amX) * 2.0 - q3 * (abY - amY) * 2.0 + q2 * (abZ - amZ) * 2.0));
      F.jj(12, 3, dt * (q1 * (abX - amX) * 2.0 + q2 * (abY - amY) * 2.0 + q3 * (abZ - amZ) * 2.0));
      F.jj(12, 12, 1.0);
      F.jj(12, 13, -dt * (q0 * q2 * 2.0 - q1 * q3 * 2.0));
      F.jj(12, 14, dt * (q0 * q1 * 2.0 + q2 * q3 * 2.0));
      F.jj(12, 15, dt * (q0 * q0 - q1 * q1 - q2 * q2 + q3 * q3));
      F.jj(13, 13, -dt * lambdaAccel + 1.0);
      F.jj(14, 14, -dt * lambdaAccel + 1.0);
      F.jj(15, 15, -dt * lambdaAccel + 1.0);
      return F;
    };
    protoOf(InseKalmanFilter).zr = function (x, dt) {
      var _destruct__k2r9zo = this.kq_1;
      var q0 = _destruct__k2r9zo.x7();
      var q1 = _destruct__k2r9zo.y7();
      var q2 = _destruct__k2r9zo.i9();
      var q3 = _destruct__k2r9zo.pl();
      var gbX = _destruct__k2r9zo.ql();
      var gbY = _destruct__k2r9zo.rl();
      var gbZ = _destruct__k2r9zo.sl();
      var pn = _destruct__k2r9zo.tl();
      var pe = _destruct__k2r9zo.ul();
      var pd = _destruct__k2r9zo.vl();
      var vn = _destruct__k2r9zo.wl();
      var ve = _destruct__k2r9zo.xl();
      var vd = _destruct__k2r9zo.yl();
      var abX = _destruct__k2r9zo.zl();
      var abY = _destruct__k2r9zo.am();
      var abZ = _destruct__k2r9zo.bm();
      var G = new matrixnd(16, 12);
      G.jj(0, 0, dt * q1 * (-1.0 / 2.0));
      G.jj(0, 1, dt * q2 * (-1.0 / 2.0));
      G.jj(0, 2, dt * q3 * (-1.0 / 2.0));
      G.jj(1, 0, (dt * q0) / 2.0);
      G.jj(1, 1, dt * q3 * (-1.0 / 2.0));
      G.jj(1, 2, (dt * q2) / 2.0);
      G.jj(2, 0, (dt * q3) / 2.0);
      G.jj(2, 1, (dt * q0) / 2.0);
      G.jj(2, 2, dt * q1 * (-1.0 / 2.0));
      G.jj(3, 0, dt * q2 * (-1.0 / 2.0));
      G.jj(3, 1, (dt * q1) / 2.0);
      G.jj(3, 2, (dt * q0) / 2.0);
      G.jj(10, 6, -dt * (q0 * q0 + q1 * q1 - q2 * q2 - q3 * q3));
      G.jj(10, 7, dt * (q0 * q3 * 2.0 - q1 * q2 * 2.0));
      G.jj(10, 8, -dt * (q0 * q2 * 2.0 + q1 * q3 * 2.0));
      G.jj(11, 6, -dt * (q0 * q3 * 2.0 + q1 * q2 * 2.0));
      G.jj(11, 7, -dt * (q0 * q0 - q1 * q1 + q2 * q2 - q3 * q3));
      G.jj(11, 8, dt * (q0 * q1 * 2.0 - q2 * q3 * 2.0));
      G.jj(12, 6, dt * (q0 * q2 * 2.0 - q1 * q3 * 2.0));
      G.jj(12, 7, -dt * (q0 * q1 * 2.0 + q2 * q3 * 2.0));
      G.jj(12, 8, -dt * (q0 * q0 - q1 * q1 - q2 * q2 + q3 * q3));
      return G;
    };
    protoOf(InseKalmanFilter).as = function () {
      var GyroscopeNoise = 4.0e-6;
      var GyroscopeBiasNoise = 4.0e-14;
      var AccelerometerNoise = 0.048;
      var AccelerometerBiasNoise = 4.0e-14;
      var U = new matrixnd(12, 12);
      U.jj(0, 0, GyroscopeNoise);
      U.jj(1, 1, GyroscopeNoise);
      U.jj(2, 2, GyroscopeNoise);
      U.jj(3, 3, GyroscopeBiasNoise);
      U.jj(4, 4, GyroscopeBiasNoise);
      U.jj(5, 5, GyroscopeBiasNoise);
      U.jj(6, 6, AccelerometerNoise);
      U.jj(7, 7, AccelerometerNoise);
      U.jj(8, 8, AccelerometerNoise);
      U.jj(9, 9, AccelerometerBiasNoise);
      U.jj(10, 10, AccelerometerBiasNoise);
      U.jj(11, 11, AccelerometerBiasNoise);
      return U;
    };
    protoOf(InseKalmanFilter).bs = function (F, U, G) {
      var Q = G.pj(U).pj(G.qj());
      this.nq_1.mj(F.pj(this.nq_1).pj(F.qj()).oj(Q));
    };
    var InseKalmanFilter_instance;
    function InseKalmanFilter_getInstance() {
      if (InseKalmanFilter_instance == null) new InseKalmanFilter();
      return InseKalmanFilter_instance;
    }
    var LocationType_INIT_instance;
    var LocationType_PDR_instance;
    var LocationType_BLE_TRI_instance;
    var LocationType_BLE_FP_instance;
    var LocationType_WIFI_instance;
    var LocationType_BLE_instance;
    var LocationType_GPS_instance;
    var LocationType_EKF_instance;
    var LocationType_AOA_instance;
    var LocationType_AUDIO_instance;
    var LocationType_RTK_instance;
    var LocationType_UWB_instance;
    var LocationType_entriesInitialized;
    function LocationType_initEntries() {
      if (LocationType_entriesInitialized) return Unit_instance;
      LocationType_entriesInitialized = true;
      LocationType_INIT_instance = new LocationType("INIT", 0);
      LocationType_PDR_instance = new LocationType("PDR", 1);
      LocationType_BLE_TRI_instance = new LocationType("BLE_TRI", 2);
      LocationType_BLE_FP_instance = new LocationType("BLE_FP", 3);
      LocationType_WIFI_instance = new LocationType("WIFI", 4);
      LocationType_BLE_instance = new LocationType("BLE", 5);
      LocationType_GPS_instance = new LocationType("GPS", 6);
      LocationType_EKF_instance = new LocationType("EKF", 7);
      LocationType_AOA_instance = new LocationType("AOA", 8);
      LocationType_AUDIO_instance = new LocationType("AUDIO", 9);
      LocationType_RTK_instance = new LocationType("RTK", 10);
      LocationType_UWB_instance = new LocationType("UWB", 11);
    }
    function LocationType(name, ordinal) {
      Enum.call(this, name, ordinal);
    }
    function LocationInfo(time, coord, step, angle, type, accuracy) {
      time = time === VOID ? new Long(0, 0) : time;
      coord = coord === VOID ? new vector3d() : coord;
      step = step === VOID ? -1 : step;
      angle = angle === VOID ? 0.0 : angle;
      type = type === VOID ? LocationType_INIT_getInstance() : type;
      accuracy = accuracy === VOID ? 0.0 : accuracy;
      this.ns_1 = time;
      this.os_1 = coord;
      this.ps_1 = step;
      this.qs_1 = angle;
      this.rs_1 = type;
      this.ss_1 = accuracy;
    }
    protoOf(LocationInfo).toString = function () {
      return hgutils_instance.ji([this.os_1, this.ps_1, this.qs_1, this.rs_1, this.ss_1, this.ns_1]);
    };
    protoOf(LocationInfo).hashCode = function () {
      var result = this.ns_1.hashCode();
      result = (imul(result, 31) + this.os_1.hashCode()) | 0;
      result = (imul(result, 31) + this.ps_1) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.qs_1)) | 0;
      result = (imul(result, 31) + this.rs_1.hashCode()) | 0;
      result = (imul(result, 31) + getNumberHashCode(this.ss_1)) | 0;
      return result;
    };
    protoOf(LocationInfo).equals = function (other) {
      if (this === other) return true;
      if (!(other instanceof LocationInfo)) return false;
      var tmp0_other_with_cast = other instanceof LocationInfo ? other : THROW_CCE();
      if (!this.ns_1.equals(tmp0_other_with_cast.ns_1)) return false;
      if (!this.os_1.equals(tmp0_other_with_cast.os_1)) return false;
      if (!(this.ps_1 === tmp0_other_with_cast.ps_1)) return false;
      if (!equals(this.qs_1, tmp0_other_with_cast.qs_1)) return false;
      if (!this.rs_1.equals(tmp0_other_with_cast.rs_1)) return false;
      if (!equals(this.ss_1, tmp0_other_with_cast.ss_1)) return false;
      return true;
    };
    function StepLengthHistory(time, steps, distance, stepSize, type, accuracy, from, to) {
      time = time === VOID ? new Long(0, 0) : time;
      steps = steps === VOID ? 0 : steps;
      distance = distance === VOID ? 0.0 : distance;
      stepSize = stepSize === VOID ? 0.0 : stepSize;
      type = type === VOID ? LocationType_INIT_getInstance() : type;
      accuracy = accuracy === VOID ? 0.0 : accuracy;
      from = from === VOID ? new vector3d() : from;
      to = to === VOID ? new vector3d() : to;
      this.ts_1 = time;
      this.us_1 = steps;
      this.vs_1 = distance;
      this.ws_1 = stepSize;
      this.xs_1 = type;
      this.ys_1 = accuracy;
      this.zs_1 = from;
      this.at_1 = to;
    }
    protoOf(StepLengthHistory).toString = function () {
      return anyToString(this);
    };
    function LocationType_INIT_getInstance() {
      LocationType_initEntries();
      return LocationType_INIT_instance;
    }
    function LocationType_BLE_getInstance() {
      LocationType_initEntries();
      return LocationType_BLE_instance;
    }
    function LocationType_GPS_getInstance() {
      LocationType_initEntries();
      return LocationType_GPS_instance;
    }
    function StepLengthEstimator() {
      StepLengthEstimator_instance = this;
      this.bt_1 = HashMap_init_$Create$();
      this.stepLength = Companion_getInstance_0().af("DefaultStepSize", 0.6);
      this.ct_1 = ArrayList_init_$Create$();
    }
    protoOf(StepLengthEstimator).dt = function (_set____db54di) {
      this.stepLength = _set____db54di;
    };
    protoOf(StepLengthEstimator).et = function () {
      return this.stepLength;
    };
    protoOf(StepLengthEstimator).updateLocation = function (type, longitude, latitude, altitude, accuracy, timestamp) {
      var locationType;
      switch (type) {
        case "GPS":
          locationType = LocationType_GPS_getInstance();
          break;
        case "BLE":
          locationType = LocationType_BLE_getInstance();
          break;
        default:
          locationType = LocationType_INIT_getInstance();
          break;
      }
      var locationInfo = new LocationInfo(
        numberToLong(timestamp),
        new vector3d(longitude, latitude, altitude),
        InseKalmanFilter_getInstance().hs(),
        InseKalmanFilter_getInstance().getOrientation(),
        locationType,
        accuracy,
      );
      this.ft(locationInfo);
    };
    protoOf(StepLengthEstimator).ft = function (loc) {
      // Inline function 'kotlin.collections.contains' call
      var this_0 = this.bt_1;
      // Inline function 'kotlin.collections.containsKey' call
      var key = loc.rs_1;
      if (!(isInterface(this_0, KtMap) ? this_0 : THROW_CCE()).l1(key)) {
        // Inline function 'kotlin.collections.set' call
        var this_1 = this.bt_1;
        var key_0 = loc.rs_1;
        var value = ArrayList_init_$Create$();
        this_1.t3(key_0, value);
      }
      var history = ensureNotNull(this.bt_1.n1(loc.rs_1));
      Companion_getInstance().cf(["\u6B65\u957F\u4F30\u7B97", loc, history.p()]);
      history.r2(loc);
      if (loc.ps_1 > Companion_getInstance_0().af("DefaultFromStepForStepSize", 0)) {
        switch (loc.rs_1.q1_1) {
          case 6:
            this.gt(history);
            break;
          case 5:
            this.ht(history);
            break;
          default:
            this.it(history);
            break;
        }
      }
    };
    protoOf(StepLengthEstimator).it = function (history) {};
    protoOf(StepLengthEstimator).ht = function (history) {
      var locs = ArrayList_init_$Create$();
      var dropCount = 0;
      var accuracyCount = 0;
      var inductionVariable = 0;
      var last_0 = (history.p() - 1) | 0;
      if (inductionVariable <= last_0)
        $l$loop_1: do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var his = history.o(i);
          if (!his.rs_1.equals(LocationType_BLE_getInstance())) {
            Companion_getInstance().cf(["\u9519\u8BEF\u7684\u5B9A\u4F4D\u7C7B\u578B", his]);
            continue $l$loop_1;
          }
          var last_1 = lastOrNull(locs);
          if (!(last_1 == null)) {
            if (((his.ps_1 - last_1.ps_1) | 0) > Companion_getInstance_0().af("DefaultBleSplitStepsForStepSize", 2)) {
              dropCount = i;
              break $l$loop_1;
            }
            if (Companion_getInstance_1().rf_1.eg(his.os_1, last_1.os_1) > Companion_getInstance_0().af("DefaultBleSplitDistanceForStepSize", 2)) {
              dropCount = i;
              break $l$loop_1;
            }
          }
          locs.r2(his);
        } while (inductionVariable <= last_0);
      if (dropCount > 0) {
        Companion_getInstance().cf(["\u79FB\u9664\u5B9A\u4F4D", dropCount]);
        var inductionVariable_0 = 0;
        var last_2 = dropCount;
        if (inductionVariable_0 <= last_2)
          do {
            var i_0 = inductionVariable_0;
            inductionVariable_0 = (inductionVariable_0 + 1) | 0;
            history.y2(0);
          } while (!(i_0 === last_2));
      }
      var tmp;
      if (locs.p() < 10) {
        tmp = true;
      } else {
        // Inline function 'kotlin.Long.div' call
        tmp =
          last(locs)
            .ns_1.a2(first(locs).ns_1)
            .c2(toLong(1000))
            .y1(toLong(Companion_getInstance_0().af("DefaultLocationDurationForStepSize", 20))) < 0;
      }
      if (tmp) {
        Companion_getInstance().cf(["\u5B9A\u4F4D\u70B9\u6570\u91CF", locs.p(), history.p(), last(locs).ns_1, first(locs).ns_1]);
        return Unit_instance;
      }
      if (dropCount > 0) {
        var inductionVariable_1 = 0;
        var last_3 = (locs.p() - 1) | 0;
        if (inductionVariable_1 <= last_3)
          do {
            var i_1 = inductionVariable_1;
            inductionVariable_1 = (inductionVariable_1 + 1) | 0;
            Companion_getInstance().cf(["\u5B9A\u4F4D\u5E8F\u5217", locs.o(i_1), i_1]);
          } while (inductionVariable_1 <= last_3);
      }
      var rarefy = this.jt(locs);
      if (dropCount > 0) {
        var inductionVariable_2 = 0;
        var last_4 = (rarefy.p() - 1) | 0;
        if (inductionVariable_2 <= last_4)
          do {
            var i_2 = inductionVariable_2;
            inductionVariable_2 = (inductionVariable_2 + 1) | 0;
            Companion_getInstance().cf(["\u5B9A\u4F4D\u5E8F\u5217\u62BD\u7A00", rarefy.o(i_2), i_2]);
          } while (inductionVariable_2 <= last_4);
      }
      var distance = 0.0;
      var inductionVariable_3 = 1;
      var last_5 = get_lastIndex(rarefy);
      if (inductionVariable_3 <= last_5)
        do {
          var i_3 = inductionVariable_3;
          inductionVariable_3 = (inductionVariable_3 + 1) | 0;
          distance = distance + Companion_getInstance_1().rf_1.eg(rarefy.o((i_3 - 1) | 0).os_1, rarefy.o(i_3).os_1);
        } while (!(i_3 === last_5));
      var steps = (last(rarefy).ps_1 - first(rarefy).ps_1) | 0;
      if (steps > 0) {
        this.stepLength = distance / steps;
        var loc = last(rarefy);
        Companion_getInstance().cf([
          "\u6B65\u957F",
          this.stepLength,
          distance,
          (last(rarefy).ps_1 - first(rarefy).ps_1) | 0,
          last(rarefy).ps_1,
          first(rarefy).ps_1,
          loc.rs_1,
        ]);
        var tmp_0;
        if (dropCount === 0) {
          // Inline function 'kotlin.collections.isNotEmpty' call
          tmp_0 = !this.ct_1.i();
        } else {
          tmp_0 = false;
        }
        if (tmp_0) {
          this.ct_1.y2(get_lastIndex(this.ct_1));
        }
        this.ct_1.r2(
          new StepLengthHistory(
            loc.ns_1,
            (last(rarefy).ps_1 - first(rarefy).ps_1) | 0,
            distance,
            this.stepLength,
            loc.rs_1,
            loc.ss_1,
            first(rarefy).os_1,
            last(rarefy).os_1,
          ),
        );
      }
    };
    protoOf(StepLengthEstimator).gt = function (history) {
      var locs = ArrayList_init_$Create$();
      var dropCount = 0;
      var accuracyCount = 0;
      var inductionVariable = 0;
      var last_0 = (history.p() - 1) | 0;
      if (inductionVariable <= last_0)
        $l$loop_3: do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          var his = history.o(i);
          if (!his.rs_1.equals(LocationType_GPS_getInstance())) {
            Companion_getInstance().cf(["\u9519\u8BEF\u7684\u5B9A\u4F4D\u7C7B\u578B", his, i]);
            continue $l$loop_3;
          }
          if (his.ss_1 > 10) accuracyCount = (accuracyCount + roundToInt(his.ss_1)) | 0;
          else if (his.ss_1 > 5) accuracyCount = (accuracyCount + 1) | 0;
          else if (accuracyCount > 0) {
            accuracyCount = (accuracyCount - 1) | 0;
          }
          if (accuracyCount > 10) {
            dropCount = (i + 1) | 0;
            break $l$loop_3;
          }
          var last_1 = lastOrNull(locs);
          if (!(last_1 == null)) {
            if (his.ps_1 === last_1.ps_1) {
              continue $l$loop_3;
            }
            if (((his.ps_1 - last_1.ps_1) | 0) > Companion_getInstance_0().af("DefaultGpsSplitStepsForStepSize", 10)) {
              dropCount = (i + 1) | 0;
              break $l$loop_3;
            }
            if (Companion_getInstance_1().rf_1.eg(his.os_1, last_1.os_1) > Companion_getInstance_0().af("DefaultGpsSplitDistanceForStepSize", 10.0)) {
              dropCount = (i + 1) | 0;
              break $l$loop_3;
            }
          }
          locs.r2(his);
        } while (inductionVariable <= last_0);
      if (dropCount > 0) {
        Companion_getInstance().cf(["\u79FB\u9664\u5B9A\u4F4D", dropCount]);
        var inductionVariable_0 = 0;
        var last_2 = dropCount;
        if (inductionVariable_0 < last_2)
          do {
            var i_0 = inductionVariable_0;
            inductionVariable_0 = (inductionVariable_0 + 1) | 0;
            history.y2(0);
          } while (inductionVariable_0 < last_2);
        var inductionVariable_1 = 0;
        var last_3 = (locs.p() - 1) | 0;
        if (inductionVariable_1 <= last_3)
          do {
            var i_1 = inductionVariable_1;
            inductionVariable_1 = (inductionVariable_1 + 1) | 0;
            Companion_getInstance().cf(["\u5B9A\u4F4D\u5E8F\u5217", locs.o(i_1), i_1]);
          } while (inductionVariable_1 <= last_3);
      }
      var tmp;
      if (locs.p() < 10) {
        tmp = true;
      } else {
        // Inline function 'kotlin.Long.div' call
        tmp =
          last(locs)
            .ns_1.a2(first(locs).ns_1)
            .c2(toLong(1000))
            .y1(toLong(Companion_getInstance_0().af("DefaultLocationDurationForStepSize", 10))) < 0;
      }
      if (tmp) {
        var tmp_0 = Companion_getInstance();
        var tmp_1 = locs.p();
        var tmp_2 = history.p();
        var tmp0_safe_receiver = lastOrNull(locs);
        var tmp_3 = tmp0_safe_receiver == null ? null : tmp0_safe_receiver.ns_1;
        var tmp1_safe_receiver = firstOrNull(locs);
        tmp_0.cf(["\u5B9A\u4F4D\u70B9\u6570\u91CF", tmp_1, tmp_2, tmp_3, tmp1_safe_receiver == null ? null : tmp1_safe_receiver.ns_1]);
        return Unit_instance;
      }
      var rarefy = this.jt(locs);
      if (dropCount > 0) {
        var inductionVariable_2 = 0;
        var last_4 = (rarefy.p() - 1) | 0;
        if (inductionVariable_2 <= last_4)
          do {
            var i_2 = inductionVariable_2;
            inductionVariable_2 = (inductionVariable_2 + 1) | 0;
            Companion_getInstance().cf(["\u5B9A\u4F4D\u5E8F\u5217\u62BD\u7A00", rarefy.o(i_2), i_2]);
          } while (inductionVariable_2 <= last_4);
      }
      var distance = 0.0;
      var inductionVariable_3 = 1;
      var last_5 = get_lastIndex(rarefy);
      if (inductionVariable_3 <= last_5)
        do {
          var i_3 = inductionVariable_3;
          inductionVariable_3 = (inductionVariable_3 + 1) | 0;
          distance = distance + Companion_getInstance_1().rf_1.eg(rarefy.o((i_3 - 1) | 0).os_1, rarefy.o(i_3).os_1);
        } while (!(i_3 === last_5));
      var steps = (last(rarefy).ps_1 - first(rarefy).ps_1) | 0;
      if (steps > 0) {
        this.stepLength = distance / steps;
        var loc = last(rarefy);
        Companion_getInstance().cf([
          "\u6B65\u957F",
          this.stepLength,
          distance,
          (last(rarefy).ps_1 - first(rarefy).ps_1) | 0,
          last(rarefy).ps_1,
          first(rarefy).ps_1,
          loc.rs_1,
        ]);
        this.ct_1.r2(
          new StepLengthHistory(
            loc.ns_1,
            (last(rarefy).ps_1 - first(rarefy).ps_1) | 0,
            distance,
            this.stepLength,
            loc.rs_1,
            loc.ss_1,
            first(rarefy).os_1,
            last(rarefy).os_1,
          ),
        );
      }
    };
    protoOf(StepLengthEstimator).jt = function (locs) {
      var rarefy = ArrayList_init_$Create$();
      var tmp = 0;
      var tmp_0 = locs.p();
      var tmp_1 = new Int32Array(tmp_0);
      while (tmp < tmp_0) {
        tmp_1[tmp] = 0;
        tmp = (tmp + 1) | 0;
      }
      var flags = tmp_1;
      flags[0] = 1;
      flags[(locs.p() - 1) | 0] = 1;
      this.kt(locs, flags, 0, (locs.p() - 1) | 0);
      var inductionVariable = 0;
      var last = locs.p();
      if (inductionVariable < last)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          if (flags[i] > 0) {
            rarefy.r2(locs.o(i));
          }
        } while (inductionVariable < last);
      return rarefy;
    };
    protoOf(StepLengthEstimator).kt = function (locs, flags, from, to) {
      var m = from;
      var md = 0.0;
      var f = Companion_getInstance_1().rf_1.kg(locs.o(from).os_1);
      var t = Companion_getInstance_1().rf_1.kg(locs.o(to).os_1);
      var inductionVariable = (from + 1) | 0;
      if (inductionVariable < to)
        do {
          var i = inductionVariable;
          inductionVariable = (inductionVariable + 1) | 0;
          // Inline function 'kotlin.math.abs' call
          var x = hgmath_instance.qi(locs.o(i).qs_1 - locs.o(from).qs_1);
          var tmp = Math.abs(x);
          // Inline function 'kotlin.math.abs' call
          var x_0 = hgmath_instance.qi(locs.o(i).qs_1 - locs.o(to).qs_1);
          var d = tmp * Math.abs(x_0);
          if (d > md) {
            md = d;
            m = i;
          }
        } while (inductionVariable < to);
      if (m > from && md > Companion_getInstance_0().af("DefaultDiluteAngle", 1000)) {
        flags[m] = 1;
        this.kt(locs, flags, from, m);
        this.kt(locs, flags, m, to);
      } else {
        m = from;
        md = 0.0;
        var inductionVariable_0 = (from + 1) | 0;
        if (inductionVariable_0 < to)
          do {
            var i_0 = inductionVariable_0;
            inductionVariable_0 = (inductionVariable_0 + 1) | 0;
            var d_0 = Companion_getInstance_1().rf_1.kg(locs.o(i_0).os_1).wk(f, t);
            if (d_0 > md) {
              md = d_0;
              m = i_0;
            }
          } while (inductionVariable_0 < to);
        if (m > from && md > Companion_getInstance_0().af("DefaultDiluteDistance", 1.0)) {
          flags[m] = 1;
          this.kt(locs, flags, from, m);
          this.kt(locs, flags, m, to);
        }
      }
    };
    var StepLengthEstimator_instance;
    function StepLengthEstimator_getInstance() {
      if (StepLengthEstimator_instance == null) new StepLengthEstimator();
      return StepLengthEstimator_instance;
    }
    //region block: post-declaration
    defineProp(protoOf(InseKalmanFilter), "stepCount", protoOf(InseKalmanFilter).hs);
    //endregion
    //region block: exports
    _.$_$ = _.$_$ || {};
    _.$_$.a = InseKalmanFilter_getInstance;
    _.$_$.b = StepLengthEstimator_getInstance;
    //endregion
    return _;
  })({}, kotlin_kotlin, kotlin_com_hgwen_hgutils_hgutils);

  //# sourceMappingURL=NewSDK-Exts-StepLengthEstimator.js.map
  //region block: imports
  var CheckPoint_getInstance = kotlin_NewSDK_Exts_CheckPoint.$_$.b;
  var init = kotlin_NewSDK_Exts_CheckPoint.$_$.a;
  var Long = kotlin_kotlin.$_$.w4;
  var Companion_getInstance = kotlin_com_hgwen_hgutils_hgutils.$_$.j;
  var StepLengthEstimator_getInstance = kotlin_NewSDK_Exts_StepLengthEstimator.$_$.b;
  var InseKalmanFilter_getInstance = kotlin_NewSDK_Exts_StepLengthEstimator.$_$.a;
  var vector4d = kotlin_com_hgwen_hgutils_hgutils.$_$.d;
  var vector3d = kotlin_com_hgwen_hgutils_hgutils.$_$.c;
  var Unit_instance = kotlin_kotlin.$_$.y;
  var Companion_getInstance_0 = kotlin_NewSDK_Exts_RoadMapMatcher.$_$.c;
  var hgjson = kotlin_com_hgwen_hgutils_hgutils.$_$.a;
  var arrayListOf = kotlin_kotlin.$_$.d1;
  var Geofence = kotlin_NewSDK_Exts_RoadMapMatcher.$_$.a;
  var MatchConfig = kotlin_NewSDK_Exts_RoadMapMatcher.$_$.b;
  var Pair = kotlin_kotlin.$_$.x4;
  var hashMapOf = kotlin_kotlin.$_$.j1;
  //endregion
  //region block: pre-declaration
  //endregion
  var RoadMapMatcher = {};
  var getRoadMapMatcherInstance = Companion_getInstance_0;
  var roadMapMatcherInstance = getRoadMapMatcherInstance().roadMapMatcher;
  RoadMapMatcher.roadMapMatcher = roadMapMatcherInstance;
  RoadMapMatcher.GPS = getRoadMapMatcherInstance().GPS;
  RoadMapMatcher.BLE = getRoadMapMatcherInstance().BLE;
  RoadMapMatcher.vector3d = vector3d;
  RoadMapMatcher.arrayListOf = arrayListOf;
  RoadMapMatcher.hashMapOf = hashMapOf;
  RoadMapMatcher.Geofence = Geofence;
  RoadMapMatcher.MatchConfig = MatchConfig;
  RoadMapMatcher.Pair = Pair;
  RoadMapMatcher.Geofence = Geofence;
  RoadMapMatcher.setGeofences = function (geofs, mconfigs) {
    roadMapMatcherInstance.setGeofences(geofs, mconfigs);
  };
  RoadMapMatcher.setGeofencesJson = function (jsonString) {
    roadMapMatcherInstance.setGeofencesJson(jsonString);
  };
  RoadMapMatcher.setRoadMap = function (token, buildingId) {
    // RoadMapMatcher_getInstance().setRoadMap(buildingId, floorId, message);
    var url = "https://map1a.daxicn.com/server39/daxi-manager/api/map/getRoadLink?token=" + token + "&bdid=" + buildingId;
    $["ajax"]({
      url: url,
      async: !0,
      method: "GET",
      success: function (t) {
        roadMapMatcherInstance.setRoadMap(buildingId, t);
        console.log("setRoadMap OK");
      },
      error: function (t) {
        console.log(t);
      },
    });
    var url = "https://map1a.daxicn.com/server39/daxi-manager/api/map/getMatchFences?token=" + token + "&bdid=" + buildingId;
    $["ajax"]({
      url: url,
      async: !0,
      method: "GET",
      success: function (t) {
        roadMapMatcherInstance.setGeofencesJson(new hgjson(t));
        console.log("setGeofence OK");
      },
      error: function (t) {
        console.log(t);
      },
    });
  };
  RoadMapMatcher.getVersion = function () {
    return "2025-01-18 06:13:41";
  };
  RoadMapMatcher.matchRoadMap = function (longitude, latitude, altitude, floorId, type, accuracy, step, orient, timestamp) {
    var mp = roadMapMatcherInstance.matchRoadMap(
      new vector3d(longitude, latitude, altitude),
      floorId,
      type,
      accuracy,
      step,
      orient,
      new Long(timestamp % 4294967296, Math.floor(timestamp / 4294967296)),
    );
    return [mp.x, mp.y];
  };
  return RoadMapMatcher;
})();
// function testRoadMapMatcher() {
//     RoadMapMatcher.setRoadMap("f70c88501d12b07e51e045871b8742ce", "B000A11DN6");
//     RoadMapMatcher.matchRoadMap(0.0, 0.0, 0.0, RoadMapMatcher.BLE, 0.0, 0, 0.0);
//     console.log("Test OK");
// }

// testRoadMapMatcher();
var matchRouter = false;

var WXAlert = (function () {
  var thisObject = {};

  // $('<div id="logcontainer" style="position:absolute;top:110px;left:0px;pointer-events:none;"></div>').insertAfter($("body>div").children().last().parent());
  thisObject.init = function (parentSelector) {
    if (thisObject.inited) {
      return;
    }
    var domStr =
      "<div id='log_view2' style='min-width:40vw;overflow-x:scroll;color: #000;font-weight: 600;word-break: break-word;'></div><div id='customlog' style='color: #000;font-weight: 600;'></div><div id='customlog2' style='color: #000;font-weight: 600; max-height:200px; overflow-y: scroll'></div><div id='customlog3' style='color: #000;font-weight: 600; max-height:200px; overflow-y: scroll'></div><div id='customlog4' style='color: #000;font-weight: 600; max-height:200px; overflow-y: scroll'></div><div id='customlog5' style='color: #000;font-weight: 600; max-height:200px; overflow-y: scroll'></div><div id='log_view' style='min-width:40vw;color: #000;font-weight: 600;'></div>";
    var parentDom = document.querySelector(parentSelector);
    if (!parentDom) {
      var parentDom = document.createElement("div");
      parentDom.id = "logcontainer";
      parentDom.style["position"] = "absolute";
      parentDom.style["top"] = "110px";
      parentDom.style["left"] = "0px";
      parentDom.style["pointer-events"] = "none";
      parentDom.innerHTML = domStr;
      var childNodes = document.body.childNodes;
      for (var i = childNodes.length - 1; i > 0; i--) {
        if (childNodes[i].tagName == "DIV") {
          childNodes[i].after(parentDom);
          break;
        }
      }
      $parentObject = parentDom;
    } else {
      parentDom.innerHTML = domStr;
      var $parentObject = parentDom;
    }

    // var $parentObject = document.getElementById(parentSelector);

    thisObject.$parentObject = $parentObject;
    thisObject.$logView = document.getElementById("log_view");
    thisObject.$logView2 = document.getElementById("log_view2");
    thisObject.$logViewBottom = document.getElementById("customlog");
    thisObject.$logViewBottom2 = document.getElementById("customlog2");
    thisObject.$logViewBottom3 = document.getElementById("customlog3");
    thisObject.$logViewBottom4 = document.getElementById("customlog4");
    thisObject.$logViewBottom5 = document.getElementById("customlog5");
    thisObject.logLevel = 0;
    thisObject.inited = true;
  };
  thisObject.begin = function (log_level) {
    if (!thisObject.$logView) return;
    thisObject.$logView.innerHTML = "";
    thisObject.logLevel = log_level || 0;
  };
  thisObject.log = function (msg, level, needBreak, replace) {
    if (!thisObject.$logView) return;
    if (level === undefined) {
      level = 0;
    }
    if (level >= thisObject.logLevel) {
      if (replace) {
        thisObject.$logView.innerHTML = msg + "<br/>";
      } else {
        thisObject.$logView.innerHTML = thisObject.$logView["innerHTML"] + msg + "<br/>";
      }

      if (needBreak) {
        alert(msg);
      }
    }
  };
  thisObject.log2 = function (msg, level, needBreak, replace) {
    if (!thisObject.$logView) return;
    if (level === undefined) {
      level = 0;
    }
    if (level >= thisObject.logLevel) {
      if (replace) {
        thisObject.$logView2["innerHTML"] = msg + "<br/>";
      } else {
        thisObject.$logView2["innerHTML"] = thisObject.$logView2["innerHTML"] + msg + "<br/>";
      }
      if (needBreak) {
        alert(msg);
      }
    }
  };
  thisObject.logCustom = function (msg, level, needBreak, replace) {
    //logcontainer
    if (!thisObject.$logView) return;
    if (level === undefined) {
      level = 0;
    }
    if (level >= thisObject.logLevel) {
      if (replace) {
        thisObject.$logViewBottom["innerHTML"] = msg + "<br/>";
      } else {
        thisObject.$logViewBottom["innerHTML"] = thisObject.$logViewBottom["innerHTML"] + "/n" + msg + "<br/>";
      }
      if (needBreak) {
        alert(msg);
      }
    }
  };
  thisObject.logCustom2 = function (msg, level, needBreak, replace) {
    //logcontainer
    if (!thisObject.$logView) return;
    if (level === undefined) {
      level = 0;
    }
    if (level >= thisObject.logLevel) {
      if (replace) {
        thisObject.$logViewBottom2["innerHTML"](msg + "<br/>");
      } else {
        thisObject.$logViewBottom2["innerHTML"](thisObject.$logViewBottom2.innerHTML + "/n" + msg + "<br/>");
      }
      if (needBreak) {
        alert(msg);
      }
    }
  };
  thisObject.logCustom3 = function (msg, level, needBreak, replace) {
    //logcontainer
    if (!thisObject.$logView) return;
    if (level === undefined) {
      level = 0;
    }
    if (level >= thisObject.logLevel) {
      if (replace) {
        thisObject.$logViewBottom3["innerHTML"] = msg + "<br/>";
      } else {
        thisObject.$logViewBottom3["innerHTML"] = thisObject.$logViewBottom3.innerHTML + "/n" + msg + "<br/>";
      }
      if (needBreak) {
        alert(msg);
      }
    }
  };
  thisObject.logCustom4 = function (msg, level, needBreak, replace) {
    //logcontainer
    if (!thisObject.$logView) return;
    if (level === undefined) {
      level = 0;
    }
    if (level >= thisObject.logLevel) {
      if (replace) {
        thisObject.$logViewBottom4["innerHTML"] = msg + "<br/>";
      } else {
        thisObject.$logViewBottom4["innerHTML"] = thisObject.$logViewBottom4.innerHTML + "/n" + msg + "<br/>";
      }
      if (needBreak) {
        alert(msg);
      }
    }
  };
  thisObject.logCustom5 = function (msg, level, needBreak, replace) {
    //logcontainer
    if (!thisObject.$logView) return;
    if (level === undefined) {
      level = 0;
    }
    if (level >= thisObject.logLevel) {
      if (replace) {
        thisObject.$logViewBottom5["innerHTML"] = msg + "<br/>";
      } else {
        thisObject.$logViewBottom5["innerHTML"] = thisObject.$logViewBottom5["innerHTML"] + "/n" + msg + "<br/>";
      }
      if (needBreak) {
        alert(msg);
      }
    }
  };

  thisObject.showMask = function (opaque, isClear) {
    var domInfo = document.getElementById("__mask_info_1");
    if (!domInfo) {
      domInfo = document.createElement("div");
      domInfo.id = "__mask_info_1";
      var cssStyle = {
        width: "100%",
        height: "100%",
        position: "absolute",
        "z-index": 99,
        opacity: opaque || 0.5,
        backgroundColor: "#000",
        left: 0,
        top: 0,
      };
      for (var key in cssStyle) {
        domInfo.style[key] = cssStyle[key];
      }
      document.body.appendChild(domInfo);
    }
    if (isClear) {
      domInfo.onclick = function (event) {
        domInfo.display = "none";
        // $(this)["hide"]();
      };
    }
    domInfo.display = "block";
  };

  thisObject.hideMask = function () {
    var domInfo = document.getElementById("__mask_info_1");

    if (domInfo && domInfo.remove) {
      domInfo.remove();
      return true;
    }
    return false;
  };
  thisObject.showNotifyMsgBox = function (callback, msg, btnName1, btnName2, cancelCB) {
    var $info = document.getElementById("_Msgbox_info2");
    if (msg === undefined) {
      msg = "";
    }
    btnName1 = btnName1 || "确定";
    if ($info && $info.remove) {
      $info.remove();
    }
    $info = "";
    thisObject.showMask();

    var domStr =
      '<div id="_Msgbox_info2"><ul><li style="list-style:none;width:100%;vertical-align:middel;box-sizing:border-box;padding:20px 13px 12px 14px;">' +
      msg +
      '</li><li class="clearfix btn_group" style="width:100%;display:flex;padding: 0px 10px;box-sizing: border-box;list-style:none;">';
    if (btnName2) {
      domStr +=
        '<span class="showMessageBox_normal_button" style="display:inline-block;flex:1;text-align:center;font-size:16px;line-height:40px;height:40px;border-top:1px solid #ccc">' +
        btnName2 +
        "</span>";
    }
    domStr +=
      '<span class="showMessageBox_highlight_button" style="color: #1c92f9;display:inline-block;flex:1;text-align:center;font-size:16px;line-height:40px;height:40px;border-top:1px solid #ccc;' +
      (btnName2 ? "border-left: 1px solid #ccc;" : "") +
      '">' +
      btnName1 +
      "</span></li></ul></div>";
    var dom = document.createElement("div");
    dom.innerHTML = domStr;
    $info = dom.querySelector("#_Msgbox_info2");
    var cssStyle = {
      position: "absolute",
      width: "70%",
      height: "fit-content",
      maxWidth: "300px",
      top: "35%",
      left: "50%",
      margin: "auto",
      zIndex: 100,
      background: "#fff",
      borderRadius: "10px",
      boxShadow: "0 2px 4px rgb(199, 199, 199)",
      padding: "0px",
      fontSize: "16px",
      border: "1px solid #f2f2f2",
      transform: "translate(-50%, -50%)",
    };
    for (var key in cssStyle) {
      $info.style[key] = cssStyle[key];
    }

    document.body.appendChild(dom);
    var hide = function () {
      $info.style.display = "none";
      thisObject.hideMask();
    };
    var highlight_button = $info.querySelector(".showMessageBox_highlight_button");
    if (highlight_button) {
      highlight_button.onclick = function (e) {
        hide();
        callback && callback();
      };
    }

    var btn_group = $info.querySelector(".showMessageBox_normal_button");
    btn_group &&
      (btn_group.onclick = function (e) {
        hide();
        cancelCB && cancelCB();
      });
  };
  // 从本地存储获取缓存的权限状态
  thisObject.getCachedPermission = function () {
    return localStorage.getItem("deviceMotionPermission");
  };

  // 缓存权限状态到本地存储
  thisObject.cachePermission = function (state) {
    localStorage.setItem("deviceMotionPermission", state);
  };

  thisObject.showDeviceMotionDialog = function (callback, cancelCB) {
    var thisObject = this;
    function cancelDefCB() {
      thisObject.showNotifyMsgBox(
        null,
        "您已禁止使用手机方向、运动,导航无法使用!若要使用导航功能请关闭本程序后重新进入,并同意使用手机方向、运动等位置权限",
        "确定",
      );
    }
    if (!cancelCB) {
      cancelCB = cancelDefCB;
    }
    if (window["DeviceMotionEvent"] && (!window["command"] || !window["command"]["platform"] || window["command"]["platform"] == "web")) {
      if (window["DeviceMotionEvent"]["requestPermission"]) {
        var cachedState = thisObject.getCachedPermission();
        // 如果已有缓存状态，直接处理
        if (cachedState) {
          //|| cachedState === 'denied'
          if (cachedState === "granted") {
            callback && callback(cachedState);
            return;
          }
          // else if(cachedState === 'denied'){
          //      cancelCB && cancelCB();
          //      return;
          // }
        }

        function getPermission() {
          window["DeviceMotionEvent"]
            ["requestPermission"]()
            ["then"](function (response) {
              if (response == "granted") {
                callback && callback(response);
              } else {
                cancelCB && cancelCB();
              }
            })
            .catch(function (err) {
              alert(JSON.stringify(err));
            });
        }
        //TODO 贵阳国际会议展览中心 开发中，不要展示地图，和授权弹框，开发完成后再打开。
        var bdid = window["command"]["bdid"] || window["command"]["buildingId"];
        if (bdid != "B000A11DQ9") {
          thisObject.showNotifyMsgBox(getPermission, "需要获取设备传感器授权请点击确定!", "确定", "取消", function () {
            cancelCB && cancelCB();
          });
        }
      } else {
        callback && callback();
      }
    } else {
      callback && callback();
    }
  };
  return thisObject;
})();

var EventTrigger = function () {
  var thisObject = this;
  this.handlers = {};
  var prototype = EventTrigger.prototype;
  prototype.on = function (t, e) {
    this.handlers[t] = this.handlers[t] || [];
    this.handlers[t].unshift(e);
    return this;
  };
  prototype.off = function (t, e) {
    var n = this.handlers[t];
    if (n) {
      if (!e) {
        delete this.handlers[t];
        return this;
      }
      var a = n.indexOf(e);
      n.splice(a, 1);
    }
    return this;
  };
  prototype.trigger = function (t) {
    if (this.handlers[t]) {
      for (var e = arguments.length, n = new Array(e > 1 ? e - 1 : 0), a = 1; a < e; a++) n[a - 1] = arguments[a];
      for (var o = n, i = 0, r = this.handlers[t].length; i < r; i++) {
        var s = this.handlers[t][i];
        s.apply(s, o);
      }
      return this;
    }
  };
};
window["DXWXLocEvent"] = new EventTrigger();
var WebSocketManager = function () {
  var thisObject = this;
  thisObject.wssState = "beforeCreate";
  thisObject.createSocket = function (url, options) {
    // !options["id"]?(options["id"] = options["userId"]):'';
    url = url || "wss://map.daxicn.com/ws/loc";
    if (url instanceof Array) {
      var index = parseInt((window["command"] && window["command"]["wsIndex"]) || 0);
      url = url[index];
    }
    thisObject.url = url;
    thisObject.options = options;

    thisObject.wssClient = new WebSocket(url); //"wss://map1a.daxicn.com/socketServer"
    // 将socket实例挂载到父iframe中，供全局使用
    if (window.parent) {
      console.log("挂载了wssClient实例");
      window.parent.ws = thisObject.wssClient;
    }
    thisObject.wssClient.onopen = function (event) {
      thisObject.wssState = "opened";
      var data = {
        id: options["userId"], //||options["id"],
        type: "bind",
        userId: options["userId"] + "",
        roleType: "receiver",
        timeStamp: new Date().getTime(),
      };
      thisObject.wssClient.send(JSON.stringify(data));
    };
    //对外提供的事件消息
    thisObject.onGetEvent = function (obj) {
      if (obj.signal && obj.signal.includes("changeTab")) {
        const id = obj.signal.split("id=")[1];
        console.log("拿到的数据为id", id);
        // window.parent.switchToPage(id);
        const idToPage = {
          home: "HomePage",
          map: "MapStateBrowse",
          media: "",
          service: "ServicePage",
          more: "ProfilePage",
        };
        const targetPage = idToPage[id];
        if (targetPage) {
          window?._;
          window?.DxApp?._stateManager?.pushState?.(targetPage, {});
        }
      }
      //存在地图没有加载完成，无法执行的情况
      if (obj.signal && window.locWebSocketOnGetEvent) {
        var params = {};
        var str = obj.signal.split("&");
        str.forEach(function (item) {
          var para = item.split("=");
          params[para[0]] = para[1];
        });
        window.locWebSocketOnGetEvent(params);
        var data = {
          id: options["userId"],
          userId: options["userId"] + "",
          type: "h5eventReceived",
          timeStamp: new Date().getTime(),
        };
        thisObject.wssClient.send(JSON.stringify(data));
      }
    };
    thisObject.wssClient.onmessage = function (event) {
      if (!event) {
        return;
      }
      var obj = JSON.parse(event.data);
      if (obj.type == "bind_result") {
        send_msg(thisObject.wssClient); //发送心跳
      }
      if (obj.type == "error") {
        // $("#msg").append("<li style='color: red'>"+myDate.toLocaleTimeString()+"&nbsp;&nbsp;"+obj.msg);
      }
      if (obj.type == "signal" || obj.type == "position") {
        if (options["onmessage"]) {
          options["onmessage"](obj);
        } else {
          window["hashchange"](obj.signal);
        }
      }
      if (obj.type == "postEventToH5") {
        //'method=mainPoiPage&buildingId=B000A11DEA';
        thisObject.onGetEvent(obj);
      }
      // if(obj.type == "xxx"){
      //   window["DXWXLocEvent"].trigger()
      // }
    };

    thisObject.wssClient.onerror = function (event) {
      // console.log("websocket error");
      // thisObject.wssState = "error";
      // setTimeout(function () {
      //     thisObject.createSocket(thisObject.url, options);
      // }, 1000);
    };
    thisObject.wssClient.onclose = function (event) {
      thisObject.wssState = "closed";
      if (event.code === 1006) {
        setTimeout(function () {
          thisObject.createSocket(thisObject.url, options);
        }, 1000);
      }
    };

    function send_msg(ws) {
      //发送心跳
      if (thisObject.isStop) {
        return;
      }
      var heart_str = JSON.stringify({
        type: "heart",
        id: options["id"],
        msg: "heart_res",
        roleType: "receiver",
      });
      thisObject.wssClient.send(heart_str);
      setTimeout(function () {
        send_msg(thisObject.wssClient);
      }, 20 * 1000);
    }

    window.onunload = function () {
      thisObject.closeSocket();
    };
  };
  thisObject.closeSocket = function () {
    if (thisObject.wssClient && thisObject.wssState == "opened") {
      thisObject.wssClient.close();
      thisObject.isStop = true;
    }
  };
  //对外提供的发送消息方法
  thisObject.postMessage = function (data) {
    if (thisObject.wssClient && thisObject.wssState == "opened") {
      thisObject.wssClient.send(JSON.stringify(data));
    }
  };
  return thisObject;
};
var GCJ2WGSUtils = (function () {
  var pi = 3.1415926535897932384626; //圆周率
  var a = 6378245.0; //克拉索夫斯基椭球参数长半轴a
  var ee = 0.00669342162296594323; //克拉索夫斯基椭球参数第一偏心率平方
  //转换纬度所需
  function transformLat(x, y) {
    var ret = -100.0 + 2.0 * x + 3.0 * y + 0.2 * y * y + 0.1 * x * y + 0.2 * Math.sqrt(Math.abs(x));
    ret += ((20.0 * Math.sin(6.0 * x * pi) + 20.0 * Math.sin(2.0 * x * pi)) * 2.0) / 3.0;
    ret += ((20.0 * Math.sin(y * pi) + 40.0 * Math.sin((y / 3.0) * pi)) * 2.0) / 3.0;
    ret += ((160.0 * Math.sin((y / 12.0) * pi) + 320 * Math.sin((y * pi) / 30.0)) * 2.0) / 3.0;
    return ret;
  }

  //转换经度所需
  function transformLon(x, y) {
    var ret = 300.0 + x + 2.0 * y + 0.1 * x * x + 0.1 * x * y + 0.1 * Math.sqrt(Math.abs(x));
    ret += ((20.0 * Math.sin(6.0 * x * pi) + 20.0 * Math.sin(2.0 * x * pi)) * 2.0) / 3.0;
    ret += ((20.0 * Math.sin(x * pi) + 40.0 * Math.sin((x / 3.0) * pi)) * 2.0) / 3.0;
    ret += ((150.0 * Math.sin((x / 12.0) * pi) + 300.0 * Math.sin((x / 30.0) * pi)) * 2.0) / 3.0;
    return ret;
  }

  // 判断坐标是否在国外
  function isOutOfChina(lat, lon) {
    if (lon < 72.004 || lon > 137.8347) return true;
    if (lat < 0.8293 || lat > 55.8271) return true;
    return false;
  }

  //转换
  function transform(lat, lon) {
    if (isOutOfChina(lat, lon)) {
      return { lon: lon, lat: lat, china: false };
    }
    var dLat = transformLat(lon - 105.0, lat - 35.0);
    var dLon = transformLon(lon - 105.0, lat - 35.0);
    var radLat = (lat / 180.0) * pi;
    var magic = Math.sin(radLat);
    magic = 1 - ee * magic * magic;
    var sqrtMagic = Math.sqrt(magic);
    dLat = (dLat * 180.0) / (((a * (1 - ee)) / (magic * sqrtMagic)) * pi);
    dLon = (dLon * 180.0) / ((a / sqrtMagic) * Math.cos(radLat) * pi);
    var mgLat = lat + dLat;
    var mgLon = lon + dLon;
    return { lon: mgLon, lat: mgLat, china: true };
  }

  //从GPS转高德
  function wgs84_To_Gcj02(lat, lon) {
    // LocateInfo info = new LocateInfo();
    if (isOutOfChina(lat, lon)) {
      return { lon: lon, lat: lat, china: false };
    } else {
      var dLat = transformLat(lon - 105.0, lat - 35.0);
      var dLon = transformLon(lon - 105.0, lat - 35.0);
      var radLat = (lat / 180.0) * pi;
      var magic = Math.sin(radLat);
      magic = 1 - ee * magic * magic;
      var sqrtMagic = Math.sqrt(magic);
      dLat = (dLat * 180.0) / (((a * (1 - ee)) / (magic * sqrtMagic)) * pi);
      dLon = (dLon * 180.0) / ((a / sqrtMagic) * Math.cos(radLat) * pi);
      var mgLat = lat + dLat;
      var mgLon = lon + dLon;
      return { lon: mgLon, lat: mgLat, china: true };
    }
  }

  //从高德转到GPS
  function gcj02_To_Wgs84(lat, lon) {
    var gps = transform(lat, lon);
    var lontitude = lon * 2 - gps.lon;
    var latitude = lat * 2 - gps.lat;
    return { lon: lontitude, lat: latitude, china: gps["china"] };
  }

  return {
    wgs84_To_Gcj02: wgs84_To_Gcj02,
    gcj02_To_Wgs84: gcj02_To_Wgs84,
  };
})();
var LocalizationUtils = {
  getCurrentTime: function () {
    return new Date().getTime();
  },
  isValidatePosition: function (position) {
    return position[0] != 0 && position[1] != 0 && !isNaN(position[0]) && !isNaN(position[1]);
  },
  distanceP2P: function (longitude1, latitude1, longitude2, latitude2) {
    var a = 6378137;
    var b = 6356752;
    var cosa = Math.cos((((latitude1 + latitude2) / 2) * Math.PI) / 180);
    var rr = (((a * b * Math.PI) / 180) * Math.PI) / 180 / ((a / b) * (1 - cosa * cosa) + (b / a) * cosa * cosa);
    var dx = cosa * (longitude1 - longitude2) * 1.0025;
    var dy = latitude1 - latitude2;
    var d = Math.sqrt(rr * (dx * dx + dy * dy));
    return d;
  },
  getPositionByDistanceAngle: function (dLng, dLat, z, dDistance, dAngle) {
    var dx = Math.sin((dAngle * Math.PI) / 180) * dDistance;
    var dy = Math.cos((dAngle * Math.PI) / 180) * dDistance;
    var dP2PLng = LocalizationUtils.distanceP2P(dLng - 1, dLat, dLng, dLat);
    var dLngDegPerM = 1.0 / dP2PLng;
    var dP2PLat = LocalizationUtils.distanceP2P(dLng, dLat - 1, dLng, dLat);
    var dLatDegPerM = 1.0 / dP2PLat;
    var p = [0, 0, 0];
    p[0] = dx * dLngDegPerM + dLng;
    p[1] = dy * dLatDegPerM + dLat;
    p[2] = z;
    return p;
  },
  getHttpObject: function () {
    var xhr = false;
    if (window.XMLHttpRequest) xhr = new XMLHttpRequest();
    if ("withCredentials" in xhr) {
      return xhr;
    } else if (typeof XDomainRequest != "undefined") {
      xhr = new XDomainRequest();
      return xhr;
    } else if (window.ActiveXObject) {
      xhr = new ActiveXObject("Microsoft.XMLHttp");
    }
    return xhr;
  },

  postData: function (url, data, onDataRecive, beforeSend, complete, error, dataType) {
    // if (window["wx"] && window["wx"]["request"]) {
    //     wx.request({
    //         "url": url,
    //         "method": "POST",
    //         'dataType': "json",
    //         'data': JSON.stringify(data),
    //         "contentType": "application/json",
    //         'timeout': 10000,
    //         'complete': complete || function () {
    //         },
    //         "success": function (e) {
    //             if (e) {
    //                 onDataRecive && onDataRecive(e["data"]);
    //             }
    //         },
    //         "fail": error || function (err) {
    //             console.log(err);
    //         }
    //     });

    // }
    var request = this.getHttpObject();
    if (request) {
      try {
        request.onreadystatechange = function () {
          var request = this;
          if (request.readyState === 4) {
            // success
            if (request.status == 200 || request.status == 304) {
              var type = request.getResponseHeader("Content-Type");
              if (type.indexOf("xml") != -1 && request.responseXML) {
                onDataRecive && onDataRecive(request.responseXML);
              } else if (type.indexOf("application/json") != -1) {
                try {
                  if (request.responseType == "json") {
                    onDataRecive && onDataRecive(request.response);
                  } else if (request.responseType == "text") {
                    onDataRecive && onDataRecive(JSON.parse(request.responseText));
                  }
                } catch (e) {
                  error && error(e.toString());
                }
              } else {
                var resultData = request.responseText;
                if (dataType == "json") {
                  resultData = JSON.parse(resultData);
                }
                onDataRecive && onDataRecive(resultData);
              }
            }
          }
        }; // event handler for mesh loading
        request.onerror = function (e) {
          error && error(e);
        };
        // request.dataObject = dataObject;
        request.open("POST", url, true);
        request.setRequestHeader("Content-Type", "application/json");
        // request.responseType = "arraybuffer";
        request.responseType = "json";
        request.timeout = 15000;
        request.ontimeout = function (e) {
          console.log("timeout ", e);
          error && error(e);
        };
        request.send(JSON.stringify(data));
        // request.url = url;
      } catch (error) {
        console.log(error);
        request.xmlhttp = null;
      }
      return request;
    }
  },
  jsonToUrl: function (url, data) {
    try {
      if (!data) {
        return url;
      }
      var tempArr = [];
      for (var i in data) {
        if (
          encodeURIComponent(data[i]) != "undefined" &&
          encodeURIComponent(data[i]) != null &&
          encodeURIComponent(data[i]) != "" &&
          encodeURIComponent(data[i])
        ) {
          var key = encodeURIComponent(i);
          var value = encodeURIComponent(data[i]);
          tempArr.push(key + "=" + value);
        }
      }
      var urlParamsStr = tempArr.join("&");
      if (url.indexOf("?") == -1) {
        url += "?";
      } else if (url.indexOf("?") != url.length - 1) {
        url += "&";
      }
      url += urlParamsStr;
      return url;
    } catch (err) {
      return "";
    }
  },
  getDataText: function (url, data, onDataRecive, beforeSend, complete, error, isAsync, dataType) {
    var xhr = this.getHttpObject();
    xhr.ontimeout = function () {
      failedCB && failedCB({ errMsg: "TimeOut" });
    };
    xhr.onreadystatechange = function () {
      if (xhr.readyState == 4) {
        if (xhr.status == 200 || xhr.status == 304) {
          var type = xhr.getResponseHeader("Content-Type");
          if (type.indexOf("xml") != -1 && xhr.responseXML) {
            onDataRecive && onDataRecive(xhr.responseXML);
          } else if (type.indexOf("application/json") != -1 || dataType == "json") {
            try {
              if (xhr.responseType == "json") {
                onDataRecive && onDataRecive(xhr.response);
              } else {
                onDataRecive && onDataRecive(JSON.parse(xhr.responseText));
              }
            } catch (e) {
              console.log(e);
              failedCB && failedCB(e.toString());
            }
          } else {
            var resultData = xhr.responseText;
            if (dataType == "json") {
              resultData = JSON.parse(resultData);
            }
            onDataRecive && onDataRecive(resultData);
          }
        } else {
          error && error(xhr.responseText);
        }
      }
    };
    url = this.jsonToUrl(url, data);
    isAsync == undefined || isAsync == true ? (isAsync = true) : (isAsync = false);
    xhr.open("GET", url, isAsync);
    xhr.send(null);
    return xhr;
  },
  getDataJson: function (url, data, onDataRecive, beforeSend, complete, error) {
    this.getDataText(url, data, onDataRecive, beforeSend, complete, error, true, "json");
  },
  loadByteStream: function (url, scb, fcb) {
    try {
      var request = this.getHttpObject();
      request.timeout = 15000;
      request.onreadystatechange = function () {
        var request = this;
        if (request.readyState === 4) {
          // success
          if (request.status !== 0 && request.status !== 200 && request.status !== 304) {
          } else {
            var byteStream = null;
            if (request.responseType == "arraybuffer" && request.response) {
              byteStream = request.response;
              scb && scb(byteStream);
              return;
            } else {
              if (request.mozResponseArrayBuffer) {
                byteStream = request.mozResponseArrayBuffer;
                scb && scb(bytStream);
                return;
              }
            }
            fcb && fcb();
          }
        }
      }; // event handler for mesh loading
      request.onerror = function (err) {
        console.log("error", err);
      };
      request.open("GET", url, true);
      request.responseType = "arraybuffer";

      request.url = url;
      request.send();
    } catch (error) {
      console.log(error);
      request.xmlhttp = null;
    }
    return request;
  },
  /**
   * 通过Blob方式下载文本
   * @param {String} url 数据的路径
   * @param {Function} scb 调用成功后的回调
   * @param {Function} fcb 调用失败后的回调
   */
  getDataTextViaBlob: function (url, scb, fcb) {
    this.loadByteStream(
      url,
      function (arrbuf) {
        this.arraybufferToString(arrbuf, "UTF-8", function (str) {
          scb && scb(str);
        });
      },
      fcb,
    );
  },
  arraybufferToString: function (buffer, encoding, callback) {
    var blob = new Blob([buffer], { type: "text/plain" });
    var reader = new FileReader();
    reader.onload = function (evt) {
      callback(evt.target.result);
    };
    reader.readAsText(blob, encoding);
  },
  toHexStringFixLength: function (strValue) {
    var intValue = parseInt(strValue);
    var strHex = intValue.toString(16).toUpperCase();
    var fixLengthHex = "0000" + strHex;
    fixLengthHex = fixLengthHex.substring(fixLengthHex.length - 4);
    return fixLengthHex;
  },
};
var MathUtils = (function () {
  var thisObject = {};
  thisObject.s_deg_to_rad = Math.PI / 180;
  thisObject.s_rad_to_deg = 180 / Math.PI;
  thisObject.earth_radius = 6378137.0;
  thisObject.equal = function (a, b) {
    if (Math.abs(b - a) <= 1e-6) return true;
    else return false;
  };
  thisObject.Vector3_copy = function (vec) {
    var newObject = [0, 0, 0];
    newObject[0] = vec[0];
    newObject[1] = vec[1];
    newObject[2] = vec[2];
    return newObject;
  };

  thisObject.Vector3_assign = function (retVal, vec) {
    retVal[0] = vec[0];
    retVal[1] = vec[1];
    retVal[2] = vec[2];
  };

  thisObject.Vector3_add = function (retVal, vec1, vec2) {
    retVal[0] = vec1[0] + vec2[0];
    retVal[1] = vec1[1] + vec2[1];
    retVal[2] = vec1[2] + vec2[2];
  };
  thisObject.Vector3_sub = function (retVal, vec1, vec2) {
    retVal[0] = vec1[0] - vec2[0];
    retVal[1] = vec1[1] - vec2[1];
    retVal[2] = vec1[2] - vec2[2];
    return retVal;
  };

  thisObject.Vector3_scale = function (retVal, vec1, scale) {
    retVal[0] = vec1[0] * scale;
    retVal[1] = vec1[1] * scale;
    retVal[2] = vec1[2] * scale;
    return retVal;
  };

  thisObject.Vector3_fromHeading = function (retVal, heading) {
    var cosTheta = Math.cos(heading);
    var sinTheta = Math.sin(heading);

    retVal[0] = sinTheta;
    retVal[1] = cosTheta;
    retVal[2] = 0;
  };

  thisObject.Vector3_length = function (vec) {
    return Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1] + vec[2] * vec[2]);
  };

  var vector_sub_temp = [0, 0, 0];
  thisObject.Vector3_distance = function (vec1, vec2) {
    thisObject.Vector3_sub(vector_sub_temp, vec1, vec2);
    return Math.sqrt(vector_sub_temp[0] * vector_sub_temp[0] + vector_sub_temp[1] * vector_sub_temp[1] + vector_sub_temp[2] * vector_sub_temp[2]);
  };

  thisObject.Vector3_distanceSquare = function (vec1, vec2) {
    thisObject.Vector3_sub(vector_sub_temp, vec1, vec2);
    return vector_sub_temp[0] * vector_sub_temp[0] + vector_sub_temp[1] * vector_sub_temp[1] + vector_sub_temp[2] * vector_sub_temp[2];
  };

  thisObject.Vector3_dot = function (vec1, vec2) {
    return vec1[0] * vec2[0] + vec1[1] * vec2[1] + vec1[2] * vec2[2];
  };

  thisObject.Vector3_mad = function (retVal, vec1, vec2, t) {
    retVal[0] = vec1[0] + vec2[0] * t;
    retVal[1] = vec1[1] + vec2[1] * t;
    retVal[2] = vec1[2] + vec2[2] * t;
  };

  thisObject.Vector3_cross = function (retVal, left, right) {
    var leftX = left[0];
    var leftY = left[1];
    var leftZ = left[2];
    var rightX = right[0];
    var rightY = right[1];
    var rightZ = right[2];

    var x = leftY * rightZ - leftZ * rightY;
    var y = leftZ * rightX - leftX * rightZ;
    var z = leftX * rightY - leftY * rightX;

    retVal[0] = x;
    retVal[1] = y;
    retVal[2] = z;

    return retVal;
  };

  thisObject.Vector3_normalize = function (retVal, vec) {
    var length = thisObject.Vector3_length(vec);
    //if ( length > 0.000001 )
    if (length > 0.0) {
      var r = 1 / length;
      retVal[0] = vec[0] * r;
      retVal[1] = vec[1] * r;
      retVal[2] = vec[2] * r;
    }
    return retVal;
  };

  thisObject.Vector3_transformCoord = function (retVal, vec, mat) {
    var vX = vec[0];
    var vY = vec[1];
    var vZ = vec[2];
    var vW = 1.0;

    var x = mat[0] * vX + mat[4] * vY + mat[8] * vZ + mat[12] * vW;
    var y = mat[1] * vX + mat[5] * vY + mat[9] * vZ + mat[13] * vW;
    var z = mat[2] * vX + mat[6] * vY + mat[10] * vZ + mat[14] * vW;
    // var w = matrix[3] * vX + matrix[7] * vY + matrix[11] * vZ + matrix[15] * vW;

    retVal[0] = x;
    retVal[1] = y;
    retVal[2] = z;
    // result.w = w;
    return retVal;
  };

  thisObject.Matrix_create = function () {
    return [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
  };

  thisObject.Matrix_fromTNBP = function (retVal, xAxis, yAxis, zAxis, vecP) {
    ((retVal[0] = xAxis[0]), (retVal[1] = xAxis[1]), (retVal[2] = xAxis[2]), (retVal[3] = 0));
    ((retVal[4] = yAxis[0]), (retVal[5] = yAxis[1]), (retVal[6] = yAxis[2]), (retVal[7] = 0));
    ((retVal[8] = zAxis[0]), (retVal[9] = zAxis[1]), (retVal[10] = zAxis[2]), (retVal[11] = 0));
    ((retVal[12] = vecP[0]), (retVal[13] = vecP[1]), (retVal[14] = vecP[2]), (retVal[15] = 1));

    return retVal;
  };

  thisObject.Matrix_inverse = function (result, matrix) {
    var a0 = matrix[0] * matrix[5] - matrix[1] * matrix[4];
    var a1 = matrix[0] * matrix[6] - matrix[2] * matrix[4];
    var a2 = matrix[0] * matrix[7] - matrix[3] * matrix[4];
    var a3 = matrix[1] * matrix[6] - matrix[2] * matrix[5];
    var a4 = matrix[1] * matrix[7] - matrix[3] * matrix[5];
    var a5 = matrix[2] * matrix[7] - matrix[3] * matrix[6];

    var b0 = matrix[8] * matrix[13] - matrix[9] * matrix[12];
    var b1 = matrix[8] * matrix[14] - matrix[10] * matrix[12];
    var b2 = matrix[8] * matrix[15] - matrix[11] * matrix[12];
    var b3 = matrix[9] * matrix[14] - matrix[10] * matrix[13];
    var b4 = matrix[9] * matrix[15] - matrix[11] * matrix[13];
    var b5 = matrix[10] * matrix[15] - matrix[11] * matrix[14];

    var det = a0 * b5 - a1 * b4 + a2 * b3 + a3 * b2 - a4 * b1 + a5 * b0;
    // if ( AnGeoMath<N>::fabs_(det) <= AnGeoMath<N>::s_zero_tolerance )
    //     return Matrix4x4<N>::s_zero;

    //Matrix4x4 mat_ret;
    result[0] = +matrix[5] * b5 - matrix[6] * b4 + matrix[7] * b3;
    result[4] = -matrix[4] * b5 + matrix[6] * b2 - matrix[7] * b1;
    result[8] = +matrix[4] * b4 - matrix[5] * b2 + matrix[7] * b0;
    result[12] = -matrix[4] * b3 + matrix[5] * b1 - matrix[6] * b0;
    result[1] = -matrix[1] * b5 + matrix[2] * b4 - matrix[3] * b3;
    result[5] = +matrix[0] * b5 - matrix[2] * b2 + matrix[3] * b1;
    result[9] = -matrix[0] * b4 + matrix[1] * b2 - matrix[3] * b0;
    result[13] = +matrix[0] * b3 - matrix[1] * b1 + matrix[2] * b0;
    result[2] = +matrix[13] * a5 - matrix[14] * a4 + matrix[15] * a3;
    result[6] = -matrix[12] * a5 + matrix[14] * a2 - matrix[15] * a1;
    result[10] = +matrix[12] * a4 - matrix[13] * a2 + matrix[15] * a0;
    result[14] = -matrix[12] * a3 + matrix[13] * a1 - matrix[14] * a0;
    result[3] = -matrix[9] * a5 + matrix[10] * a4 - matrix[11] * a3;
    result[7] = +matrix[8] * a5 - matrix[10] * a2 + matrix[11] * a1;
    result[11] = -matrix[8] * a4 + matrix[9] * a2 - matrix[11] * a0;
    result[15] = +matrix[8] * a3 - matrix[9] * a1 + matrix[10] * a0;

    var inv_det = 1.0 / det;
    for (var row = 0; row < 4; row++) {
      for (var col = 0; col < 4; col++) {
        result[(row << 2) + col] *= inv_det;
      }
    }

    return result;
  };

  thisObject.transformGeographicToECEF = function (vecOut, vecIn) {
    var longitude = vecIn[0],
      latitude = vecIn[1],
      radius = vecIn[2];
    var cos_lat = radius * Math.cos(latitude);
    vecOut[0] = cos_lat * Math.cos(longitude);
    vecOut[1] = cos_lat * Math.sin(longitude);
    vecOut[2] = radius * Math.sin(latitude);
  };

  thisObject.transformECEFToGeographic = function (vecOut, vecIn) {
    var x = vecIn[0],
      y = vecIn[1],
      z = vecIn[2];
    var ret_z = Math.sqrt(x * x + y * y + z * z);
    vecOut[0] = Math.atan2(y, x);
    vecOut[1] = Math.asin(z / ret_z);
    vecOut[2] = ret_z;
  };

  var matTemp = thisObject.Matrix_create();
  thisObject.matrixECEFToENU = function (matOut, vecIn) {
    var vec_x = [0, 0, 0],
      vec_y = [0, 0, 0],
      vec_z = thisObject.Vector3_copy(vecIn);
    var s_unit_z = [0, 0, 1];
    thisObject.Vector3_normalize(vec_z, vec_z);

    thisObject.Vector3_cross(vec_x, s_unit_z, vec_z);
    thisObject.Vector3_normalize(vec_x, vec_x);

    thisObject.Vector3_cross(vec_y, vec_z, vec_x);
    thisObject.Vector3_normalize(vec_y, vec_y);

    thisObject.Matrix_fromTNBP(matTemp, vec_x, vec_y, vec_z, vecIn);
    thisObject.Matrix_inverse(matOut, matTemp);
  };

  thisObject.matrixENUToECEF = function (matOut, vecIn) {
    var vec_x = [0, 0, 0],
      vec_y = [0, 0, 0],
      vec_z = thisObject.Vector3_copy(vecIn);
    var s_unit_z = [0, 0, 1];
    thisObject.Vector3_normalize(vec_z, vec_z);

    thisObject.Vector3_cross(vec_x, s_unit_z, vec_z);
    thisObject.Vector3_normalize(vec_x, vec_x);

    thisObject.Vector3_cross(vec_y, vec_z, vec_x);
    thisObject.Vector3_normalize(vec_y, vec_y);

    thisObject.Matrix_fromTNBP(matOut, vec_x, vec_y, vec_z, vecIn);
  };

  thisObject.createSphericalTransform = function (lng, lat, alt) {
    var st = {};
    st.matTNB = MathUtils.Matrix_create();
    st.matInverseTNB = MathUtils.Matrix_create();
    st.posOrigGeo = [0, 0, 0];
    MathUtils.transformGeographicToECEF(st.posOrigGeo, [lng * MathUtils.s_deg_to_rad, lat * MathUtils.s_deg_to_rad, MathUtils.earth_radius + alt]);
    MathUtils.matrixENUToECEF(st.matTNB, st.posOrigGeo);
    MathUtils.matrixECEFToENU(st.matInverseTNB, st.posOrigGeo);
    var posGeo = [0, 0, 0];
    st.transformGeographicToENU = function (vecENU, vecGeographic) {
      var lng = vecGeographic[0] * MathUtils.s_deg_to_rad;
      var lat = vecGeographic[1] * MathUtils.s_deg_to_rad;
      MathUtils.transformGeographicToECEF(posGeo, [lng, lat, MathUtils.earth_radius]);
      MathUtils.Vector3_transformCoord(vecENU, posGeo, st.matInverseTNB);
    };

    st.transformENUToGeographic = function (vecGeographic, vecENU) {
      MathUtils.Vector3_transformCoord(posGeo, vecENU, st.matTNB);
      MathUtils.transformECEFToGeographic(vecGeographic, posGeo);
      vecGeographic[0] *= MathUtils.s_rad_to_deg;
      vecGeographic[1] *= MathUtils.s_rad_to_deg;
      vecGeographic[2] = 0;
    };
    return st;
  };

  thisObject.getGeodeticCircleDegrees = function (lon1, lat1, lon2, lat2) {
    return thisObject.getGeodeticCircleRadians(
      lon1 * MathUtils.s_deg_to_rad,
      lat1 * MathUtils.s_deg_to_rad,
      lon2 * MathUtils.s_deg_to_rad,
      lat2 * MathUtils.s_deg_to_rad,
    );
  };

  thisObject.getGeodeticCircleRadians = function (lon1, lat1, lon2, lat2) {
    var a = Math.cos(lat1) * Math.cos(lat2) * Math.cos(lon1 - lon2) + Math.sin(lat1) * Math.sin(lat2);
    return Math.abs(Math.acos(a));
  };

  var segment1 = [0, 0, 0];
  var segment2 = [0, 0, 0];
  thisObject.pointTosegment = function (result, point, start, end) {
    var length = thisObject.Vector3_distanceSquare(end, start);
    if (MathUtils.equal(length, 0.0)) {
      return false;
    }
    thisObject.Vector3_sub(segment1, point, start);
    thisObject.Vector3_sub(segment2, end, start);
    result.offset = thisObject.Vector3_dot(segment1, segment2) / length;
    if (result.offset < 0 || result.offset > 1.0) {
      return false;
    }
    return true;
  };

  var getNearestPoint_temp = [0, 0, 0];
  thisObject.getNearestPoint = function (pos, result, start, end) {
    var dis = 0.0;
    thisObject.pointTosegment(result, pos, start, end);
    if (result.offset <= 0.0) {
      result.offset = 0.0;
      dis = thisObject.Vector3_distance(pos, start);
      thisObject.Vector3_assign(pos, start);
    } else if (result.offset >= 1) {
      result.offset = 1.0;
      dis = thisObject.Vector3_distance(pos, end);
      thisObject.Vector3_assign(pos, end);
    } else {
      thisObject.Vector3_sub(getNearestPoint_temp, end, start);
      thisObject.Vector3_mad(getNearestPoint_temp, start, getNearestPoint_temp, result.offset);
      //Vector3d pos1 = start + (end -start) * offset;
      dis = thisObject.Vector3_distance(pos, getNearestPoint_temp);
      thisObject.Vector3_assign(pos, getNearestPoint_temp);
    }
    return dis;
  };
  return thisObject;
})();
var locationLogManager = (function () {
  var thisObject = {};
  thisObject.type = 0;
  thisObject.handler = null;
  thisObject._locationResultArr = [];
  thisObject._sendTimer = null;
  thisObject.ctrlLocByUser = false;
  thisObject.startCollecting = false;
  var isIOSDevice = getDeviceType();
  var logServerUrl = "https://map2a.daxicn.com/locServer/";
  // var logServerUrl = "http://localhost:8080/wxlocLogtest/";
  thisObject.setLogServerUrl = function (url) {
    logServerUrl = url;
  };
  thisObject.startSendLog = function (options, callback) {
    if (options["ctrlLocByUser"] != undefined) {
      thisObject.ctrlLocByUser = options["ctrlLocByUser"];
    }
    options["deviceType"] = options["deviceType"] || (isIOSDevice ? "iphone" : "android");
    // options["deviceType"] = isIOSDevice ? "iphone":"android";
    var url = logServerUrl + "data/startLog";
    LocalizationUtils.postData(url, options, function (data) {
      thisObject.handler = data["handler"];
      callback && callback(data);
      thisObject._sendTimer = setInterval(function () {
        thisObject.sendLogs();
      }, 5000);
    });
  };
  thisObject.stopSendLog = function (callback) {
    if (!thisObject.handler) {
      return;
    }
    clearInterval(thisObject._sendTimer);
    thisObject._sendTimer = null;
    thisObject.sendLogs();
    var options = {
      handler: thisObject.handler,
    };
    var url = logServerUrl + "data/stopLog";
    LocalizationUtils.postData(url, options, function (data) {
      callback && callback(data);
    });
    thisObject.handler = null;
  };
  var lastLocResultTime = new Date().getTime();
  thisObject.addData = function (param) {
    if (thisObject.handler && (!thisObject.ctrlLocByUser || thisObject.startCollecting)) {
      var locaResArr = thisObject._locationResultArr;
      if (thisObject.selectedCollectPoint) {
        var p = thisObject.selectedCollectPoint;
        param["realPoint"] = [p["lng"], p["lat"], p["floorId"] || "", p["bdid"] || ""];
      }
      locaResArr.push(param);
    }
  };
  thisObject.setCollectPoint = function (point) {
    thisObject.selectedCollectPoint = point;
    thisObject.startCollecting = true;
  };
  thisObject.clearCollectPoint = function () {
    thisObject.selectedCollectPoint = null;
    thisObject.startCollecting = false;
  };
  thisObject.sendLogs = function () {
    if (thisObject.handler) {
      var locaResArr = thisObject._locationResultArr;
      if (locaResArr.length) {
        var url = logServerUrl + "data/postLocResult";
        var data = {
          handler: thisObject.handler,
          locResults: locaResArr,
        };
        thisObject._locationResultArr = [];
        LocalizationUtils.postData(
          url,
          data,
          function (data) {
            // thisObject._locationResultArr = [];
          },
          null,
          null,
          function (err) {
            thisObject._locationResultArr = locaResArr.concat(thisObject._locationResultArr);
            console.log("err", err);
          },
        );
      }
    }
  };

  return thisObject;
})();
var RoutePolyline = function () {
  var thisObject = this;
  thisObject._totalLength = 0;
  thisObject._lengthArray = [];
  thisObject._keysArray = [];
  thisObject._vectorData = [];
  thisObject._segmentCount = 0;
  // thisObject._floorIndex = 0;

  var prototype = RoutePolyline.prototype;
  prototype.init = function (vtx, floorId) {
    var thisObject = this;
    thisObject._floorId = floorId;
    thisObject._vectorData = vtx;
    thisObject._segmentCount = vtx.length - 1;
    thisObject._keysArray = new Array(vtx.length);
    thisObject._lengthArray = new Array(vtx.length - 1);
    thisObject._totalLength = 0;
    //std::vector<angeo_double> lengthlist;
    for (var ni = 0; ni < thisObject._segmentCount; ni++) {
      var seglength = MathUtils.Vector3_distance(vtx[ni + 1], vtx[ni]);
      thisObject._totalLength += seglength;
      thisObject._lengthArray[ni] = thisObject._totalLength;
      //lengthlist.push_back(m_length_array[ni]);
    }

    var v_t = 0;
    //std::vector<angeo_double> keylist;
    for (var ni = 0; ni < thisObject._segmentCount; ni++) {
      thisObject._keysArray[ni] = v_t;
      v_t += MathUtils.Vector3_distance(vtx[ni + 1], vtx[ni]) / thisObject._totalLength;
    }
    thisObject._keysArray[thisObject._segmentCount] = 1;
  };

  prototype.getPosition = function (key) {
    var result = [0, 0, 0];
    var index = this.getSegmentIndex(key);
    var prekey = this._keysArray[index];
    var deltalen = this.getLength(prekey, key);
    //var dir = [0,0,0];
    var vec1 = this._vectorData[index + 1];
    var vec2 = this._vectorData[index];
    if (!vec1) {
      var xxxx = 0;
    }
    MathUtils.Vector3_sub(result, vec1, vec2);
    MathUtils.Vector3_normalize(result, result);
    MathUtils.Vector3_mad(result, this._vectorData[index], result, deltalen);
    return result;
  };

  prototype.getTotalLength = function (key) {
    return this._totalLength;
  };

  prototype.getLength = function (key1, key2) {
    key1 = Math.min(1.0, Math.max(key1, 0.0));
    key2 = Math.min(1.0, Math.max(key2, 0.0));
    return this._totalLength * Math.abs(key2 - key1);
  };

  prototype.getSegmentCount = function () {
    return this._segmentCount;
  };

  prototype.getSegmentIndex = function (key) {
    var newKey = Math.min(1, Math.max(key, 0));
    var index = 0;
    for (; index <= this._segmentCount; index++) {
      var k = this._keysArray[index];
      if (k >= newKey) {
        break;
      }
    }
    return Math.max(0, index - 1);
  };

  prototype.getKey = function (length) {
    return length / this._totalLength;
  };

  prototype.getSegmentAngleFromKey = function (key) {
    var index = this.getSegmentIndex(key);
    return this.getSegmentAngleFromIndex(index);
  };

  prototype.getSegmentAngleFromIndex = function (index) {
    var vectorData = this._vectorData;

    var p1 = vectorData[index];
    if (!p1) {
      var i = 1111;
    }
    p1[2] = 0;

    var p2 = vectorData[index + 1];
    if (!p2) {
      var i = 1111;
    }
    p2[2] = 0;
    var dir = [0, 0, 0];
    MathUtils.Vector3_sub(dir, p2, p1);
    MathUtils.Vector3_normalize(dir, dir);
    var angle = Math.acos(MathUtils.Vector3_dot([0, 1, 0], dir));
    angle *= MathUtils.s_rad_to_deg;
    if (dir[0] < 0) {
      angle = 360 - angle;
    }
    return angle;
  };

  prototype.getSegmentSumLength = function (index) {
    return this._lengthArray[index];
  };

  prototype.getDeltaHeading = function (index1, index2) {
    var result = 0;
    for (var index = index1; index < index2; index++) {
      result += this.getSegmentAngleFromIndex(index + 1) - this.getSegmentAngleFromIndex(index);
    }
    return result;
  };

  prototype.getFloorIndex = function () {
    return this._floorIndex;
  };
  prototype.getFloorId = function () {
    return this._floorId;
  };
};
var RouteMatch = function (params) {
  var thisObject = this;
  thisObject._initialized = false;
  thisObject._routePolylineArray = [];
  // thisObject._matTNB = null;
  // thisObject._matInverseTNB = null;
  thisObject._st = null;
  thisObject._fromKey = 0;
  thisObject._targetKey = 0;
  thisObject._sampleIndex = 0;
  thisObject._samples = 5; //5;//10;
  thisObject._lastTime = -1;
  thisObject._curPolyline = null;
  thisObject._lastFloorId = -1;
  thisObject._updateCount = 0;
  thisObject._locationArray = [
    [0, 0, 0],
    [0, 0, 0],
  ];
  thisObject.params = params;

  var prototype = RouteMatch.prototype;
  prototype.startMatchRoute = function (routeData, usingLineHeading, naviStrictByLineDir) {
    this.usingLineHeading = usingLineHeading;
    this.naviStrictByLineDir = naviStrictByLineDir;
    routeJSON = JSON.parse(routeData);

    if (routeJSON["route"].length < 1) return false;
    var routeJO = routeJSON["route"][0];

    var pathJO = routeJO["path"];
    var startJO = pathJO["start"];
    var endJO = pathJO["end"];
    var naviInfoListJO = pathJO["naviInfoList"];
    var rawRoute = {};
    rawRoute.startPos = {
      position: [startJO["x"], startJO["y"], 0],
    };
    rawRoute.endPos = {
      position: [endJO["x"], endJO["y"], 0],
    };
    rawRoute.segmentArray = [];
    for (var i = 0; i < naviInfoListJO.length; i++) {
      var segmentJO = naviInfoListJO[i];
      var geometryJO = segmentJO["geometry"];
      var segment = {};
      segment.innerIndex = parseInt(segmentJO["innerFloorIndex"] || segmentJO["fnum"]);
      segment.floorId = segmentJO["floor"];
      segment.geometry = [];
      for (var j = 0; j < geometryJO.length; j++) {
        var pos = [geometryJO[j]["x"], geometryJO[j]["y"]];
        // var pos = [geometryJO[j]["x"], geometryJO[j]["y"], segment.innerIndex];
        segment.geometry.push(pos);
      }
      // var lineData = DaxiMap.DXRouteCircelSampler.resampler(segment.geometry);
      // segment.geometry = lineData[0];
      segment.geometry.forEach(function (item) {
        item[2] = segment.innerIndex;
      });
      rawRoute.segmentArray.push(segment);
    }
    thisObject.initialize(rawRoute);
    console.log("wx.loc.js startMatchRoute:" + JSON.stringify(rawRoute.startPos));
    if (window.location.search.indexOf("showLocMsg=true") != -1) {
      var msg = "导航抓路后定位 ------ :" + JSON.stringify(rawRoute.startPos);
      WXAlert.logCustom(msg, 1, false, true);
    }
    locationLogManager.addData({
      //导航抓路后的结果
      t: 7,
      d: new Date().getTime(),
      v: [rawRoute.startPos["position"][0], rawRoute.startPos["position"][1]],
      a: rawRoute.startPos["position"][2],
      h: rawRoute.startPos["position"][2],
      type: "GPS3",
    });
  };

  prototype.initialize = function (rawRoute) {
    var thisObject = this;
    var startPos = rawRoute.startPos.position;
    thisObject._st = MathUtils.createSphericalTransform(startPos[0], startPos[1], 0);
    thisObject._routePolylineArray = [];
    var segnum = rawRoute.segmentArray.length;
    var posTemp = [0, 0, 0];
    for (var j = 0; j < segnum; j++) {
      var routeSegment = rawRoute.segmentArray[j];
      var routeData = routeSegment.geometry;
      for (var i = 0; i < routeData.length; i++) {
        var vPoint = routeData[i];
        thisObject._st.transformGeographicToENU(posTemp, vPoint);
        // vPoint = GeocentricCoords::FromSpherical_d(vPoint.x  * math_d::s_deg_to_rad, vPoint.y * math_d::s_deg_to_rad, earth_radius);
        // vPoint = vPoint * m_transform.m_matInverseTNB;
        routeData[i][0] = posTemp[0];
        routeData[i][1] = posTemp[1];
        routeData[i][2] = 0;
      }
      var rpline = new RoutePolyline();
      rpline.init(routeData, routeSegment.floorId);
      thisObject._routePolylineArray.push(rpline);
    }

    thisObject._fromKey = 0;
    thisObject._targetKey = 0;
    thisObject._sampleIndex = 0;
    thisObject._lastTime = 0;
    thisObject._lastFloorId = -1;
    thisObject._locationArray = [
      [0, 0, 0],
      [0, 0, 0],
    ];
    thisObject._initialized = true;
  };

  prototype.finalize = function () {
    var thisObject = this;
    thisObject._initialized = false;
    thisObject._fromKey = 0;
    thisObject._targetKey = 0;
    thisObject._sampleIndex = 0;
    thisObject._lastTime = 0;
    thisObject._lastFloorId = -1;
    thisObject._locationArray = [
      [0, 0, 0],
      [0, 0, 0],
    ];
    thisObject._curPolyline = null;
    thisObject._routePolylineArray = [];
  };

  prototype.findRoutePolyline = function (locationResult) {
    var thisObject = this;
    if (!thisObject._initialized) {
      return null;
    }
    var floorId = locationResult.floorId;

    var matchPlylines = [];
    for (var i = 0; i < thisObject._routePolylineArray.length; i++) {
      var rpline = thisObject._routePolylineArray[i];
      if (rpline.getFloorId() == floorId) {
        matchPlylines.push(rpline);
      }
    }
    if (matchPlylines.length == 0) {
      return null;
    }
    if (matchPlylines.length == 1) {
      return matchPlylines[0];
    } else {
      var posTemp = [0, 0, 0];
      thisObject._st.transformGeographicToENU(posTemp, [locationResult[0], locationResult[1], locationResult[2]]);
      matchPlylines.forEach(function (line) {
        var vectorData = line._vectorData;
        var minDis = 9999999;
        for (var i = 1; i < vectorData.length; i++) {
          var invcs1 = MathUtils.Vector3_copy(posTemp);
          var vStart = vectorData[i - 1];
          var vEnd = vectorData[i];
          var vStart1 = MathUtils.Vector3_copy(vStart);
          var vEnd1 = MathUtils.Vector3_copy(vEnd);
          vStart1[2] = 0.0;
          vEnd1[2] = 0.0;
          var nearestPtResult = {
            offset: 0.0,
          };
          var dis = MathUtils.getNearestPoint(invcs1, nearestPtResult, vStart1, vEnd1);
          if (minDis > dis) {
            minDis = dis;
          }
        }
        line.minDis = minDis;
      });
      matchPlylines.sort(function (line1, line2) {
        return line1.minDis - line2.minDis;
      });
      return matchPlylines[0];
    }
  };
  prototype.update = function (locationResult) {
    try {
      var thisObject = this;
      if (thisObject._lastFloorId === -1 || thisObject._lastFloorId !== locationResult.floorId) {
        var rpline = thisObject.findRoutePolyline(locationResult);
        if (rpline !== null) {
          thisObject._curPolyline = rpline;
          thisObject._curKey = thisObject._fromKey = thisObject._targetKey = 0;
          thisObject._sampleIndex = 0;
          thisObject._lastFloorId = locationResult.floorId;
        }
        thisObject._updateCount = 0;
        // return;
      }
      thisObject._updateCount++;

      var result = [0, 0, 0];
      var vec = [locationResult[0], locationResult[1], 0];
      thisObject.speed = locationResult.speed;
      MathUtils.Vector3_assign(thisObject._locationArray[0], vec);
      if (!thisObject.matchLocationEx(locationResult, 1.3, result)) {
        MathUtils.Vector3_assign(thisObject._locationArray[1], vec);
      } else {
        MathUtils.Vector3_assign(thisObject._locationArray[1], result);
      }
    } catch (e) {
      console.log(e.toString());
    }
  };

  prototype.getNextMatchPosition = function (pos, noSample) {
    var thisObject = this;
    if (!thisObject._curPolyline) {
      return false;
    }
    var t;
    if (noSample) {
      t = thisObject._targetKey;
    } else {
      t;
      var fromKey;
      var targetKey;
      var sampleIndex;
      //AGO_EnterCriticalSection(m_criticalSection);

      fromKey = thisObject._fromKey;
      targetKey = thisObject._targetKey;
      sampleIndex = thisObject._sampleIndex;
      //AGO_LeaveCriticalSection(m_criticalSection);

      if (thisObject._sampleIndex < thisObject._samples) {
        thisObject._sampleIndex++;
      }
      var diffKey = thisObject._targetKey - thisObject._fromKey;
      if (diffKey < 0) {
        t = thisObject._fromKey + diffKey * ((thisObject._sampleIndex / thisObject._samples) * 0.3);
      } else {
        t = thisObject._targetKey;
      }

      t = Math.min(1.0, Math.max(t, 0.0));
    }

    thisObject._curKey = t;
    if (!t) {
      return false;
    }
    var result = thisObject._curPolyline.getPosition(t);

    thisObject._st.transformENUToGeographic(pos, result);
    var floorIndex = thisObject._curPolyline.getFloorIndex();

    pos[2] = floorIndex;

    return true;
  };

  function clampCurrentT(curPolyline, t, deltatime, maxMoveLength, speed) {
    var defaultSpeed = thisObject.speed || 1.3;
    var speed = speed || defaultSpeed;

    var defaultLen = maxMoveLength;
    defaultLen = Math.min((speed * deltatime) / 1000, defaultLen);
    if (t < thisObject._targetKey) {
      defaultLen = Math.min((defaultSpeed * deltatime) / 1000, defaultLen);
      defaultLen *= -0.5;
    }

    var lastlen = curPolyline.getLength(0, thisObject._targetKey);
    t = curPolyline.getKey(lastlen + defaultLen);
    t = Math.max(0, Math.min(1, t));
    return t;
  }

  prototype.matchLocationEx = function (location, speed, result) {
    var thisObject = this;
    var curPolyline = thisObject._curPolyline;
    if (curPolyline === null) {
      return false;
    }
    var match_result = 0;
    var totallength = curPolyline.getTotalLength(); // 整条路线的总长度
    var estUdis = 0; // 估计沿路线的最大距离

    // 根据时间间隔和速度推算下次抓路可能的最大、最小SegIndex
    var minSegIndex = 0;
    var maxSegIndex = curPolyline.getSegmentCount();
    var curtime = location.timeStamp;
    var deltatime = curtime - thisObject._lastTime;

    // if (thisObject._updateCount < 5 && false /*location.Accuracy == 3*/ ) { //使换层之后的5次更新内blereset抓路失效
    //   //match_result = 0;
    //   match_result = thisObject._curKey;
    // } else
    {
      if (thisObject._lastTime < 0) {
        deltatime = 200;
      }

      if (deltatime < 5000) {
        estUdis = (deltatime * speed * 2) / 1000;
        // estUdis = deltatime * speed * (10/thisObject._samples)/ 1000;
      }
      // 经纬度转局部坐标
      var invcs = [0, 0, 0];
      thisObject._st.transformGeographicToENU(invcs, [location[0], location[1], 0]);

      var mposList = [];
      var nearestPtResult = {
        offset: 0.0,
      };
      for (var index = minSegIndex; index < maxSegIndex; index++) {
        var vStart = curPolyline._vectorData[index];
        var vEnd = curPolyline._vectorData[index + 1];

        var vStart1 = MathUtils.Vector3_copy(vStart);
        var vEnd1 = MathUtils.Vector3_copy(vEnd);
        vStart1[2] = 0.0;
        vEnd1[2] = 0.0;

        //  计算GPS点到路线的垂直距离
        nearestPtResult.offset = 0.0;
        var invcs1 = MathUtils.Vector3_copy(invcs);
        var tmpVdis = MathUtils.getNearestPoint(invcs1, nearestPtResult, vStart1, vEnd1);
        var vPos1 = [0, 0, 0];
        MathUtils.Vector3_sub(vPos1, vEnd1, vStart1);
        MathUtils.Vector3_mad(vPos1, vStart1, vPos1, nearestPtResult.offset);
        //var vPos1 = vStart1 + (vEnd1 - vStart1)*dOffset;

        var minUdis = 0;
        if (index > 0) {
          minUdis = curPolyline.getSegmentSumLength(index - 1);
        }
        minUdis += MathUtils.Vector3_distance(curPolyline._vectorData[index], vPos1);

        var mpos = {};
        mpos.Udis = minUdis;
        mpos.Vdis = tmpVdis;
        mpos.Position = vPos1;
        mpos.Index = index;
        mpos.Offset = nearestPtResult.offset;
        //mpos.Heading = m_routePolyline->GetSegmentAngleFromIndex(index);
        mposList.push(mpos);
      }

      mposList.sort(function (a, b) {
        return a.Vdis - b.Vdis;
      });

      //sort(mposList.begin(), mposList.end(), Comp);

      //MatchPos* pminMatch = NULL;
      var psubminMatch = null;
      var pminMatch = mposList[0];
      if (mposList.length > 1) {
        psubminMatch = mposList[1];
      }
      if (pminMatch.Index < mposList.length - 1) {
        pminMatch.toNextPosDis = MathUtils.Vector3_distance(curPolyline._vectorData[pminMatch.Index + 1], vPos1);
      }
      thisObject.pminMatch = pminMatch;

      var t = pminMatch.Udis / totallength;
      // 判断是否是“完美匹配”
      var isPerfect;
      if (params["turnDontMatchRoute"]) {
        if (pminMatch.toNextPosDis != undefined && pminMatch.toNextPosDis < (params["turnRadius"] || 4)) {
          isPerfect = true;
        } else {
          isPerfect = thisObject.isPerfectMatch(pminMatch, psubminMatch, location);
        }
      } else {
        isPerfect = thisObject.isPerfectMatch(pminMatch, psubminMatch, location);
      }

      if (isPerfect /*|| location["locType"] != "BLE"*/) {
        match_result = t;
      } else {
        var lastSegId = curPolyline.getSegmentIndex(thisObject._targetKey);
        var curSegId = curPolyline.getSegmentIndex(t);
        var deltaSegId = Math.abs(curSegId - lastSegId);

        var lastDir = curPolyline.getSegmentAngleFromKey(thisObject._targetKey);
        var nextDir = curPolyline.getSegmentAngleFromKey(t);
        var deltaDir = Math.abs(lastDir - nextDir);

        var deltalen = curPolyline.getLength(thisObject._targetKey, t);
        var defaultLen = 2.5;
        var speed = 1.8;
        // if(deltaSegId == 1 && deltalen > estUdis && Math.abs(deltaDir - 90) < 30){ //L型路线
        //    // match_result = t;
        //     match_result = clampCurrentT(curPolyline, t, deltatime, defaultLen,speed);
        // }
        // else if(deltaSegId > 1 && deltaDir > 60){//u型路线

        //     match_result = clampCurrentT(curPolyline, t, deltatime, defaultLen );
        // }
        // else if(deltaDir < 60){ //同向或Z型路线

        //     match_result = clampCurrentT(curPolyline, t, deltatime, defaultLen,speed);
        // }
        // else{
        //    // match_result = t;
        //     match_result = clampCurrentT(curPolyline, t, deltatime, defaultLen );
        // }
        if (deltaSegId == 1 && deltalen > estUdis && Math.abs(deltaDir - 90) < 30) {
          //L型路线
          // match_result = t;
          match_result = clampCurrentT(curPolyline, t, deltatime, defaultLen);
        } else if (deltaSegId > 1 && deltaDir > 60) {
          //u型路线

          match_result = clampCurrentT(curPolyline, t, deltatime, defaultLen);
        }
        // else if(deltaDir < 60){ //同向或Z型路线

        //     match_result = clampCurrentT(curPolyline, t, deltatime, defaultLen,speed);
        // }
        else {
          // match_result = t;
          match_result = clampCurrentT(curPolyline, t, deltatime, defaultLen);
        }
      }

      //match_result = thisObject._kalmanFilter.update(match_result, 0,  0);
    }
    // 限制抓路不可反向
    //t = math_d::max_(t, m_targetKey);

    //AGO_EnterCriticalSection(m_criticalSection);
    thisObject._fromKey = thisObject._targetKey;
    thisObject._targetKey = match_result;
    thisObject._sampleIndex = 0;
    //AGO_LeaveCriticalSection(m_criticalSection);
    var minPos = curPolyline.getPosition(match_result);

    //::DebugTrace("TargetMatchPosition >>>> X:%lf; Y:%lf", minPos.x, minPos.y);
    thisObject._st.transformENUToGeographic(result, minPos);
    // result = minPos * m_transform.m_matTNB;
    // result = SphericalCoords::FromGeocentric_d(result);
    // result.x *= math_d::s_rad_to_deg;
    // result.y *= math_d::s_rad_to_deg;
    thisObject._lastTime = curtime;
    return true;
  };

  prototype.isPerfectMatch = function (minMathPos, subminMatchpos, location) {
    if (window.location.search.indexOf("showLocMsg=true") != -1) {
      var msg = "导航抓路前定位 ------ :" + location[0] + "," + location[1];
      WXAlert["logCustom"](msg, 1, false, true);
      locationLogManager.addData({
        t: 7,
        d: new Date().getTime(),
        v: [location[0], location[1]],
        a: location[2],
        h: location[2],
        type: "GPS3",
      });
    }
    if (!thisObject._curPolyline) {
      return false;
    }
    if (subminMatchpos === null) {
      return true;
    }

    var f = subminMatchpos.Vdis / minMathPos.Vdis; //最小次小
    var gpsHeading = location.heading || 0;
    var segDir = thisObject._curPolyline.getSegmentAngleFromIndex(minMathPos.Index); // minMathPos->Heading;

    // gpsHeading = segDir;

    var deltaheading = Math.abs(segDir - gpsHeading);
    deltaheading > 180 ? (deltaheading = 360 - deltaheading) : "";
    var lastDir = thisObject._curPolyline.getSegmentAngleFromKey(thisObject._targetKey);
    var deltaDir = Math.abs(lastDir - segDir);
    deltaDir > 180 ? (deltaDir = 360 - deltaDir) : "";
    // if (f > 2.0 && deltaheading < 45 && deltaDir < 100 && minMathPos.Vdis < 1) {
    params["location"] = params["location"] || {};
    var matchInfo = params["location"]["matchRouteInfo"] || {
      BLE: {
        matchDis: 8,
      },
      GPS: {
        matchDis: 100,
      },
    };
    var perfectDis = 100;

    var locType = location.locType;
    if (matchInfo[locType] && matchInfo[locType]["matchDis"]) {
      perfectDis = matchInfo[locType]["matchDis"];
    }
    var naviHeadingInfo = {
      useLineHeadingMaxdiff: 75,
      perfectHeadingDiff: 45,
    };
    if (matchInfo[locType] && matchInfo[locType]["naviHeading"]) {
      naviHeadingInfo = matchInfo[locType]["naviHeading"];
    }
    var usingLineHeading = this.usingLineHeading;
    var perfectHeadingDiff = 45;
    if (naviHeadingInfo && naviHeadingInfo["perfectHeadingDiff"]) {
      perfectHeadingDiff = naviHeadingInfo["perfectHeadingDiff"] || 45;
      if (deltaheading < perfectHeadingDiff) {
        location.heading = segDir;
      }
      // usingLineHeading = (deltaheading < perfectHeadingDiff) && usingLineHeading;
    }
    if (naviHeadingInfo && naviHeadingInfo["useLineHeadingMaxdiff"]) {
      usingLineHeading = deltaheading < naviHeadingInfo["useLineHeadingMaxdiff"] && usingLineHeading;
    }
    if (f > 1.8 && usingLineHeading && minMathPos.Vdis < perfectDis) {
      //忽略角度
      return true;
    }

    if (f > 1.8 && deltaheading < perfectHeadingDiff && deltaDir < 100 && minMathPos.Vdis < perfectDis) {
      /*if (window.location.search.indexOf("testBleVal=true") != -1 || window.location.search.indexOf("showLocMsg=true") != -1 ) {
        WXAlert.logCustom4("f: "+ f + "  deltaheading:" + deltaheading + " deltaDir" + deltaDir +" perfectDis:" + perfectDis + " true", 1, false, true);
      }*/

      return true;
    }
    /* if (window.location.search.indexOf("testBleVal=true") != -1 || window.location.search.indexOf("showLocMsg=true") != -1 ){
      WXAlert.logCustom4("f: "+ f + "  deltaheading:" + deltaheading + " deltaDir" + deltaDir +" perfectDis:" + perfectDis + " true", 1, false, true);
    }*/

    return false;
  };
};
// StepCounter
var StepCounter = function () {
  var thisObject = this;
  var var_acc = 0.0; // variance of the acceleration on the window L
  var min_acc_norm = 1.0 / 0; // minimum of the acceleration on the window L with kalmanfilter
  var max_acc_norm = -1.0 / 0; // maximum of the acceleration on the window L with kalmanfilter
  var threshold = -1.0 / 0; // threshold to detect a step
  var sensibility = 1.0 / 30; // sensibility to detect a step
  var countStep = 0; // number of steps
  var weight = 70.0; // weight of the pedestrian
  var stepSize = 50.0; // step size of the pedestrian (cm)
  var distance = 0.0; // total distance (cm)
  var calory = 0.0; // calory burned (C)
  var speed = 0.0; // instantaneous speed of the pedestrian (m/s)
  var meanSpeed = 0.0; // mean speed of the pedestrian (m/s)
  thisObject.acc_norm = new Array();
  thisObject.step_arr = new Array();
  thisObject.lastTimeStamp = 0; //LocalizationUtils.getCurrentTime();
  var MAX_STEP_FREQ = 1000 / 3; //≤Ω∆µ…œœﬁ
  var mIsWalking = false;
  var STEP_SENSE = 1.2;
  var STEPLENGTH = 0.5;

  var G = 1; // filter gain
  var Rw = 1; // noise power desirable
  var Rv = 9.8065; // noise power estimated

  var A = 1;
  var C = 1;
  var B = 0;
  var u = 0;
  var P = 0;
  var x = 0; // estimated signal without noise
  var y = 0; //measured

  function setCountStep(count) {
    countStep = count;
  }

  function setWeight(weight) {
    weight = weight;
  }

  function setStepSize(stepSize) {
    stepSize = stepSize;
  }

  function setMeanSpeed(meanSpeed) {
    meanSpeed = meanSpeed;
  }

  function setSensibility(sens) {
    sensibility = sens;
  }

  var prototype = StepCounter.prototype;
  // initialization of arrays
  prototype.createTable = function (lWindow) {
    var thisObject = this;
    var acc_norm = new Array();
    for (var i = 0; i < lWindow; i++) {
      acc_norm[i] = 1.0; //9.8;
    }
    var stepArr = new Array();
    for (var i = 0; i < lWindow; i++) {
      stepArr[i] = 0;
    }
    thisObject.acc_norm = acc_norm;
    thisObject.step_arr = stepArr;
  };

  // update arraysv
  prototype.update = function (x, y, z, currentTime) {
    var thisObject = this;
    if (thisObject.lastTimeStamp === 0) {
      thisObject.lastTimeStamp = currentTime;
    }
    var sensor = computeNorm(x, y, z, true);
    thisObject.acc_norm.push(sensor);

    if (thisObject.acc_norm.length > 0) {
      thisObject.acc_norm.shift();
    }
    onStep(thisObject.acc_norm, thisObject.step_arr, currentTime);
    onSpeed(thisObject.step_arr);
    return countStep;
  };

  // compute norm of the acceleration vector
  function computeNorm(x, y, z, filter) {
    var norm = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2) + Math.pow(z, 2));
    var norm_filt = norm;
    if (filter) {
      norm_filt = onFilteringKalman(norm);
    }
    return norm_filt / 9.80665;
  }

  // seek variance
  function varAcc(acc) {
    var param_sensibility = STEP_SENSE; //step sensibility ex:2.0
    var moy = 0.0; //mean?
    var moy2 = 0.0; //square mean
    for (var k = 0; k < acc.length - 1; k++) {
      moy += acc[k];
      moy2 += Math.pow(acc[k], 2);
    }
    var_acc = (Math.pow(moy, 2) - moy2) / acc.length;
    if (var_acc - 0.5 > 0.0) {
      var_acc -= 0.5;
    }
    if (0.0 !== var_acc) {
      setRv(var_acc);
      //setSensibility(param_sensibility*math_d::sqrt_(var_acc) / math_d::pow_(9.80665, 2));
      setSensibility((param_sensibility * Math.sqrt(var_acc)) / Math.pow(9.80665, 2));
    } else {
      // setSensibility(1./30.);
      setSensibility(0.03);
    }
    //setSensibility(sensibility*0.5);
  }

  // seek minimum
  function minAcc(acc) {
    var mini = 1 / 0;
    for (var k = 0; k < acc.length - 1; k++) {
      if (acc[k] < mini) {
        mini = acc[k];
      }
    }
    return mini;
  }

  // seek maximum
  function maxAcc(acc) {
    var maxi = -1.0 / 0;
    for (var k = 0; k < acc.length - 1; k++) {
      if (acc[k] > maxi) {
        maxi = acc[k];
      }
    }
    return maxi;
  }

  // compute the threshold
  function setThreshold(min, max) {
    threshold = (min + max) * 0.5;
  }

  // detect a step
  function onStep(acc, stepArr, currentTime) {
    varAcc(acc);
    min_acc_norm = minAcc(acc);
    max_acc_norm = maxAcc(acc);
    setThreshold(min_acc_norm, max_acc_norm);
    var diff = max_acc_norm - min_acc_norm;
    var isSensibility = Math.abs(diff) >= sensibility; // the acceleration has to go over the sensibility
    var isOverThreshold = acc[acc.length - 1] >= threshold && acc[acc.length - 2] < threshold; // if the acceleration goes over the threshold and the previous was below this threshold
    var isValidStep = stepArr[stepArr.length - 1] == 0;
    var lTempTime = currentTime; //LocalizationUtils.getCurrentTime();
    var isInterval = lTempTime - thisObject.lastTimeStamp > MAX_STEP_FREQ;
    var isValidVarAcc = var_acc < 250.0 && var_acc > 100.0;
    if (isSensibility && isOverThreshold && isValidStep && !isInterval && isValidVarAcc) {
    }
    if (isSensibility && isOverThreshold && isValidStep && isInterval && isValidVarAcc) {
      countStep++;
      stepArr.push(1);
      if (stepArr.length > 0) {
        stepArr.shift();
      }
      thisObject.lastTimeStamp = lTempTime;
    } else {
      stepArr.push(0);
      if (stepArr.length > 0) {
        stepArr.shift();
      }
    }
    setDistance();
  }

  // Compute total distance
  function setDistance() {
    distance = countStep * stepSize; //cm
  }

  // Compute instantaneous speed on 2 seconds
  function onSpeed(stepArr) {
    var stepin2s = 0.0;
    speed = 0.0;
    for (var k = 0; k < stepArr.length; k++) {
      stepin2s += stepArr[k];
    }
    var distin2s = stepin2s * stepSize;
    speed = distin2s / 100 / 2; //m/s

    if (stepArr[stepArr.length - 1] != 0 && speed != 0) {
      if (0 !== meanSpeed) {
        meanSpeed = (meanSpeed * (countStep - 1) + speed) / countStep;
      } else {
        meanSpeed = speed;
      }
    }
  }

  function onFilteringKalman(ech) {
    //signal: signal measured
    y = ech;
    if (0 == x) {
      var xx = 1 / C;
      x = xx * y;
      P = xx * Rv * xx;
    } else {
      // Kalman Filter: Prediction and covariance P
      x = A * x + B * u;
      P = A * P * A + Rw;
      // Gain
      G = (P * C * 1) / (C * P * C + Rv);
      // Correction
      x = x + G * (y - C * x);
      P = P - G * C * P;
    }
    return x;
  }

  function setRv(rv) {
    //signal: signal measured
    Rv = rv;
  }
};
///////////   三角定位 /////////////////
var BLETrilaterationAlgorithm = (function () {
  // Localization Utils;
  var LES_PDR = 0;
  var LES_BEACON = 1;
  var UPDATE_TYPE_ORIENTAION = 0;
  var UPDATE_TYPE_PDR = 1;
  var UPDATE_TYPE_BLE = 2;
  var UPDATE_TYPE_BLE_RESET = 3;
  // Map Building Object
  var MapBuilding = function () {
    var thisObject = this;
    thisObject.XMin = 99999999;
    thisObject.XMax = -99999999;
    thisObject.YMin = 99999999;
    thisObject.YMax = -99999999;
    thisObject.Factor = [0, 0];
    thisObject.BDID = "";
    thisObject.DataVer = 0;
    thisObject.Floors = [];
    thisObject.UUIDs = {};
  };

  // Map Floor Object
  var MapFloor = function () {
    var thisObject = this;
    thisObject.floorIndex = -9999;
    thisObject.floorId = "";
    thisObject.floorName = "";
    thisObject.Beacons = [];
    thisObject.GeofenceSet = {};
  };

  // Map Beacon
  var MapBeacon = function () {
    var thisObject = this;
    thisObject.beaconIndex = 0;
    thisObject.mac = "";
    thisObject.uuid = "";
    thisObject.major = "";
    thisObject.minor = "";
    thisObject.fid = "";
    thisObject.name = "";
    thisObject.floorIndex = 0;
    thisObject.x = 0;
    thisObject.y = 0;
  };

  // Localization Target State
  var LocalizationTargetState = function () {
    var thisObject = this;
    thisObject._isWalking = false;
    thisObject._sessionStepCount = 0;
    thisObject._totalStepCount = 0;
    thisObject._locationState = 0;
    thisObject._position = [0, 0, 0];
    thisObject._realPos = [0, 0, 0];
    thisObject._targetPos = [0, 0, 0];
    thisObject._accuracy = 0;
    thisObject._heading = 0;
    thisObject._velocity = 0;
    thisObject._timeStamp = 0;
    thisObject._weight = 0;
    thisObject._envirionmentState = 0;
    thisObject._lastLocationTime = 0;
    thisObject._filterResetTime = 0;
    thisObject._locationHisResultList = [];
    thisObject._lastResetTime = 0;
    thisObject._resetHeading = 0.0;
    thisObject._isAcureHeading = false;
    thisObject._lastStartHeading = 0.0;

    thisObject._beaconGroupIdMap = {};
    thisObject._lastGroupId = -1;
    thisObject._lastGroupIdTime = 0;

    var prototype = LocalizationTargetState.prototype;
    prototype.setPosition = function (pos) {
      var position = this._position;
      position[0] = pos[0];
      position[1] = pos[1];
      position[2] = pos[2];
    };

    prototype.setLastLocationTime = function (time) {
      this._lastLocationTime = time;
    };

    prototype.setLastResetTime = function (time) {
      this._lastResetTime = time;
    };

    prototype.getLastResetTime = function (time) {
      return this._lastResetTime;
    };

    prototype.getPosition = function (pos) {
      var position = this._position;
      return [position[0], position[1], position[2]];
    };

    prototype.getHeading = function () {
      return this._heading; //this._resetHeading;
    };

    prototype.resetHeading = function (heading) {
      this._heading = heading;
      this._resetHeading = heading;
      this._isAcureHeading = true;
    };

    prototype.updateHeading = function (heading) {
      if (this._isAcureHeading) {
        this._lastStartHeading = heading;
        this._isAcureHeading = false;
        return;
      }
      this._heading = this._resetHeading + (heading - this._lastStartHeading);
      this._lastStartHeading = heading;

      return this._heading;
    };

    prototype.PushHisFloor = function (floor) {
      this._locationHisResultList.push(floor);
    };

    prototype.PopHisFloor = function () {
      this._locationHisResultList.shift();
    };

    prototype.GetHisFloorSize = function () {
      return this._locationHisResultList.length;
    };

    prototype.getGeofence = function () {
      return this._geofence;
    };

    prototype.setGeofence = function (geofence) {
      this._geofence = geofence;
    };

    prototype.getGroupIdMap = function () {
      return this._beaconGroupIdMap;
    };

    prototype.getLastGroupId = function () {
      return this._lastGroupId;
    };
    prototype.getLastGroupIdTime = function () {
      return this._lastGroupIdTime;
    };

    prototype.setLastGroupId = function (lastGroupId) {
      this._lastGroupId = lastGroupId;
    };
    prototype.setLastGroupIdTime = function (lastGroupIdTIme) {
      this._lastGroupIdTime = lastGroupIdTIme;
    };
  };

  var LocalizationFilter = function () {
    var thisObject = this;
    thisObject.filter = new KalmenFilterForPositionVelocityState();
    var prototype = LocalizationFilter.prototype;
    prototype.init = function (bdid) {
      var thisObject = this;
      //thisObject.mapData = MapDataLoader.load(bdid);
      this.filter.initialize();
    };

    prototype.resetState = function () {
      this.filter.initialize();
    };

    prototype.update = function (x, y, t) {
      //WXAlert.log("filter update", 10);
      return this.filter.update(x, y, t);
    };

    prototype.reset = function (x, y) {
      this.filter.reset(x, y);
    };
  };

  // var LocationConfig = {
  //  SQ:0.5
  // };
  var ConfigDataObject = {
    Create: function () {
      var thisObject = {};
      thisObject.name = "";
      thisObject.NEARBY_DISTANCE = 40;
      thisObject.STEPLENGTH = 0.54;
      thisObject.SMOOTH_NEAR = 0.4;
      thisObject.SMOOTH_FAR = 0.18;
      thisObject.MIN_BLE_SCAN_RSSI = -86; //-86 wenzhongxin-82 wenfuer -86
      thisObject.HASGEOFENCE = false;
      thisObject.DETECT_ACTION_TIME = 5000;
      thisObject.BLE_MAX_DIS = 10;
      thisObject.KALMAN_RESET_FREQ = 4000;
      thisObject.EKF = true;
      thisObject.USEBLE = true;
      thisObject.USEPDR = true;
      thisObject.USEWIFI = false;
      thisObject.UPLOAD_LOG = false;
      thisObject.EMULATOR = false;
      thisObject.INDEXSRC = false;
      thisObject.PRESSURE = false;
      thisObject.BEACON_ENCODE = true;
      thisObject.IGNORE_MAJOR = false;
      thisObject.PSF_DEGREE = false; //true：degree（116.00，39.00）
      thisObject.isYCSMDT = false; //yinchuan shimin dating oushuceng
      thisObject.GHOST = true; //ghost mode:stop walking slowly move
      thisObject.LOCATION_ALGORITHM = 0;
      thisObject.GEOFENCE_COLLIDE = true;
      thisObject.SQ = 0.5;
      thisObject.BLE_KALMAN_RESET_RSSI = -69; //-69;//dayuecheng -67 jinyuan -78 wenzhongxin-69
      thisObject.STEP_SENSE = 1.2;
      thisObject.NAVI_SNAP_LINE_SQ = 1.0;
      thisObject.GROUPID_VALID_TIME = 15000;
      thisObject.GROUPID_COOLING_TIME = 10000;
      thisObject.RESET_INTERVAL = 50000;
      thisObject.CHANGEFLOOR_RESET_COUNT = 10;
      thisObject.MAX_NAVI_HEAD_LENGTH = 10;
      return thisObject;
    },
    Clone: function (src) {
      var newObject = {};
      newObject.CopyFrom(newObject, src);
      return newObject;
    },
    CopyFrom: function (dst, data) {
      var thisObject = dst;
      thisObject.name = data.name;
      thisObject.NEARBY_DISTANCE = data.NEARBY_DISTANCE;
      thisObject.STEPLENGTH = data.STEPLENGTH;
      thisObject.SMOOTH_NEAR = data.SMOOTH_NEAR;
      thisObject.SMOOTH_FAR = data.SMOOTH_FAR;
      thisObject.MIN_BLE_SCAN_RSSI = data.MIN_BLE_SCAN_RSSI; //wenzhongxin-82 wenfuer -86
      thisObject.HASGEOFENCE = data.HASGEOFENCE;
      thisObject.DETECT_ACTION_TIME = data.DETECT_ACTION_TIME;
      thisObject.BLE_MAX_DIS = data.BLE_MAX_DIS;
      thisObject.KALMAN_RESET_FREQ = data.KALMAN_RESET_FREQ;
      thisObject.EKF = data.EKF;
      thisObject.USEBLE = data.USEBLE;
      thisObject.USEPDR = data.USEPDR;
      thisObject.USEWIFI = data.USEWIFI;
      thisObject.UPLOAD_LOG = data.UPLOAD_LOG;
      thisObject.EMULATOR = data.EMULATOR;
      thisObject.INDEXSRC = data.INDEXSRC;
      thisObject.PRESSURE = data.PRESSURE;
      thisObject.BEACON_ENCODE = data.BEACON_ENCODE;
      thisObject.IGNORE_MAJOR = data.IGNORE_MAJOR;
      thisObject.PSF_DEGREE = data.PSF_DEGREE; //true：degree（116.00，39.00）
      thisObject.isYCSMDT = data.isYCSMDT; //yinchuan shimin dating oushuceng
      thisObject.GHOST = data.GHOST; //ghost mode:stop walking slowly move
      thisObject.LOCATION_ALGORITHM = data.LOCATION_ALGORITHM;
      thisObject.SQ = data.SQ;
      thisObject.BLE_KALMAN_RESET_RSSI = data.BLE_KALMAN_RESET_RSSI;
      thisObject.STEP_SENSE = data.STEP_SENSE;
      thisObject.NAME = data.NAME;
      thisObject.GEOFENCE_COLLIDE = data.GEOFENCE_COLLIDE;
      thisObject.NAVI_SNAP_LINE_SQ = data.NAVI_SNAP_LINE_SQ;
      thisObject.GROUPID_VALID_TIME = data.GROUPID_VALID_TIME;
      thisObject.GROUPID_COOLING_TIME = data.GROUPID_COOLING_TIME;
      thisObject.RESET_INTERVAL = data.RESET_INTERVAL;
      thisObject.CHANGEFLOOR_RESET_COUNT = data.CHANGEFLOOR_RESET_COUNT;
      thisObject.MAX_NAVI_HEAD_LENGTH = data.MAX_NAVI_HEAD_LENGTH;
    },
  };

  var LocationConfig = ConfigDataObject.Create();

  var LUDecomposition = (function () {
    var thisObject = {};
    thisObject.make = function (matA) {
      var lud = {};
      lud._LU = MatrixMxN.getArrayCopy(matA);
      lud._m = MatrixMxN.getRowDimension(matA);
      lud._n = MatrixMxN.getColumnDimension(matA);
      lud._pivsign = 1;
      lud._piv = new Array(lud._m);
      var piv = lud._piv;
      var LU = lud._LU;
      var m = lud._m;
      var n = lud._n;

      // piv.resize(lud._m);
      for (var i = 0; i < m; i++) {
        piv[i] = i;
      }
      var LUrowi = null;
      var LUcolj = new Array(m);
      //LUcolj.resize(m);

      // Outer loop.
      for (var j = 0; j < n; j++) {
        // Make a copy of the j-th column to localize references.
        for (var i = 0; i < m; i++) {
          LUcolj[i] = LU[i][j];
        }

        // Apply previous transformations.

        for (var i = 0; i < m; i++) {
          LUrowi = LU[i];

          // Most of the time is spent in the following dot product.
          var kmax = Math.min(i, j);
          var s = 0.0;
          for (var k = 0; k < kmax; k++) {
            s += LUrowi[k] * LUcolj[k];
          }

          LUrowi[j] = LUcolj[i] -= s;
        }

        // Find pivot and exchange if necessary.

        var p = j;
        for (var i = j + 1; i < m; i++) {
          if (Math.abs(LUcolj[i]) > Math.abs(LUcolj[p])) {
            p = i;
          }
        }
        if (p != j) {
          var k = 0;
          for (k = 0; k < n; k++) {
            var t = LU[p][k];
            LU[p][k] = LU[j][k];
            LU[j][k] = t;
          }
          k = piv[p];
          piv[p] = piv[j];
          piv[j] = k;
          lud._pivsign = -lud._pivsign;
        }

        // Compute multipliers.

        if (j < m && LU[j][j] != 0.0) {
          for (var i = j + 1; i < m; i++) {
            LU[i][j] /= LU[j][j];
          }
        }
      }

      return lud;
    };

    thisObject.isNonsingular = function (lud) {
      for (var j = 0; j < lud._n; j++) {
        if (lud._LU[j][j] == 0) return false;
      }
      return true;
    };

    thisObject.det = function (lud) {
      if (lud._m !== lud._n) {
        //throw new IllegalArgumentException("Matrix must be square.");
        //assert(0);
      }
      var d = lud._pivsign;
      for (var j = 0; j < lud._n; j++) {
        d *= lud._LU[j][j];
      }
      return d;
    };

    thisObject.solve = function (lud, matB) {
      if (MatrixMxN.getRowDimension(matB) != lud._m) {
        //console.log("Matrix row dimensions must agree.");
        //assert(0);
      }
      if (!thisObject.isNonsingular(lud)) {
        //console.log("Matrix is singular.");
        //assert(0);
      }

      // Copy right hand side with pivoting
      var nx = MatrixMxN.getColumnDimension(matB);
      var Xmat = MatrixMxN.getMatrixFromArray(matB, lud._piv, 0, nx - 1);
      var X = MatrixMxN.getArray(Xmat);
      var m = lud._m;
      var n = lud._n;

      // Solve L*Y = B(piv,:)
      for (var k = 0; k < n; k++) {
        for (var i = k + 1; i < n; i++) {
          for (var j = 0; j < nx; j++) {
            X[i][j] -= X[k][j] * lud._LU[i][k];
          }
        }
      }
      // Solve U*X = Y;
      for (var k = n - 1; k >= 0; k--) {
        for (var j = 0; j < nx; j++) {
          X[k][j] /= lud._LU[k][k];
        }
        for (var i = 0; i < k; i++) {
          for (var j = 0; j < nx; j++) {
            X[i][j] -= X[k][j] * lud._LU[i][k];
          }
        }
      }
      return Xmat;
    };
    return thisObject;
  })();

  var QRDecomposition = (function () {
    var thisObject = {};
    var Maths_hypot = function (a, b) {
      var r = 0;
      if (Math.abs(a) > Math.abs(b)) {
        r = b / a;
        r = Math.abs(a) * Math.sqrt(1 + r * r);
      } else if (b != 0) {
        r = a / b;
        r = Math.abs(b) * Math.sqrt(1 + r * r);
      } else {
        r = 0.0;
      }
      return r;
    };
    thisObject.make = function (matA) {
      // Initialize.
      var qrd = {};
      qrd._QR = MatrixMxN.getArrayCopy(matA);
      qrd._m = MatrixMxN.getRowDimension(matA);
      qrd._n = MatrixMxN.getColumnDimension(matA);
      qrd._Rdiag = new Array(qrd._n);
      var QR = qrd._QR;
      var Rdiag = qrd._Rdiag;
      var m = qrd._m;
      var n = qrd._n;

      // Main loop.
      for (var k = 0; k < n; k++) {
        // Compute 2-norm of k-th column without under/overflow.
        var nrm = 0;
        for (var i = k; i < m; i++) {
          nrm = Maths_hypot(nrm, QR[i][k]);
        }

        if (nrm != 0.0) {
          // Form k-th Householder vector.
          if (QR[k][k] < 0) {
            nrm = -nrm;
          }
          for (var i = k; i < m; i++) {
            QR[i][k] /= nrm;
          }
          QR[k][k] += 1.0;

          // Apply transformation to remaining columns.
          for (var j = k + 1; j < n; j++) {
            var s = 0.0;
            for (var i = k; i < m; i++) {
              s += QR[i][k] * QR[i][j];
            }
            s = -s / QR[k][k];
            for (var i = k; i < m; i++) {
              QR[i][j] += s * QR[i][k];
            }
          }
        }
        Rdiag[k] = -nrm;
      }
      return qrd;
    };

    thisObject.isFullRank = function (qrd) {
      var n = qrd._n;
      var Rdiag = qrd._Rdiag;
      for (var j = 0; j < n; j++) {
        if (Rdiag[j] == 0) return false;
      }
      return true;
    };

    thisObject.solve = function (qrd, matB) {
      var m = qrd._m;
      var n = qrd._n;
      var QR = qrd._QR;
      var Rdiag = qrd._Rdiag;
      if (MatrixMxN.getRowDimension(matB) != m) {
        //console.log("Matrix row dimensions must agree.");
        //assert(0);
      }
      if (!thisObject.isFullRank(qrd)) {
        //console.log("Matrix is rank deficient.");
        //assert(0);
      }

      // Copy right hand side
      var nx = MatrixMxN.getColumnDimension(matB);
      var X = MatrixMxN.getArrayCopy(matB);

      // Compute Y = transpose(Q)*B
      for (var k = 0; k < n; k++) {
        for (var j = 0; j < nx; j++) {
          var s = 0.0;
          for (var i = k; i < m; i++) {
            s += QR[i][k] * X[i][j];
          }
          s = -s / QR[k][k];
          for (var i = k; i < m; i++) {
            X[i][j] += s * QR[i][k];
          }
        }
      }
      // Solve R*X = Y;
      for (var k = n - 1; k >= 0; k--) {
        for (var j = 0; j < nx; j++) {
          X[k][j] /= Rdiag[k];
        }
        for (var i = 0; i < k; i++) {
          for (var j = 0; j < nx; j++) {
            X[i][j] -= X[k][j] * QR[i][k];
          }
        }
      }
      var tempMat = MatrixMxN.make(X, n, nx);
      return MatrixMxN.getMatrix(tempMat, 0, n - 1, 0, nx - 1);

      //return MatrixMxN(X, n, nx).getMatrix(0, n - 1, 0, nx - 1);
    };

    return thisObject;
  })();

  var MatrixMxN = (function () {
    var thisObject = {};
    thisObject.createMatrix = function (m, n) {
      var a = new Array(m);
      for (var i = 0; i < m; i++) {
        a[i] = new Array(n);
      }
      return a;
    };

    thisObject.makeMN = function (m, n) {
      var mat = {
        _m: m,
        _n: n,
      };
      mat._A = thisObject.createMatrix(m, n);
      return mat;
    };

    thisObject.makeMNV = function (m, n, s) {
      var mat = {
        _m: m,
        _n: n,
      };
      mat._A = thisObject.createMatrix(m, n);
      for (var i = 0; i < m; i++) {
        for (var j = 0; j < n; j++) {
          mat._A[i][j] = s;
        }
      }
      return mat;
    };

    thisObject.makeMNVarray = function (m, n, value2DArray) {
      var mat = {
        _m: m,
        _n: n,
      };
      mat._A = thisObject.createMatrix(m, n);
      for (var i = 0; i < m; i++) {
        for (var j = 0; j < n; j++) {
          mat._A[i][j] = value2DArray[i][j];
        }
      }
      return mat;
    };

    thisObject.make = function (A, m, n) {
      var mat = {
        _A: a,
        _m: m,
        _n: n,
      };
      return mat;
    };

    thisObject.getArray = function (mat) {
      return mat._A;
    };

    thisObject.getArrayCopy = function (mat) {
      var m = mat._m;
      var n = mat._n;
      var C = thisObject.createMatrix(m, n);

      for (var i = 0; i < m; i++) {
        for (var j = 0; j < n; j++) {
          C[i][j] = mat._A[i][j];
        }
      }
      return C;
    };

    thisObject.getRowDimension = function (mat) {
      return mat._m;
    };

    thisObject.getColumnDimension = function (mat) {
      return mat._n;
    };

    thisObject.get = function (mat, i, j) {
      return mat._A[i][j];
    };

    thisObject.set = function (mat, i, j, a) {
      mat._A[i][j] = a;
    };

    thisObject.getMatrix = function (mat, i0, i1, j0, j1) {
      var X = thisObject.makeMN(i1 - i0 + 1, j1 - j0 + 1);
      var B = thisObject.getArray(X);

      for (var i = i0; i <= i1; i++) {
        for (var j = j0; j <= j1; j++) {
          B[i - i0][j - j0] = mat._A[i][j];
        }
      }
      return X;
    };

    thisObject.getMatrixFromArray = function (mat, array, j0, j1) {
      var X = thisObject.makeMN(array.length, j1 - j0 + 1);
      var B = thisObject.getArray(X);
      for (var i = 0; i < array.length; i++) {
        for (var j = j0; j <= j1; j++) {
          B[i][j - j0] = mat._A[array[i]][j];
        }
      }
      return X;
    };

    thisObject.transpose = function (mat) {
      var m = mat._m;
      var n = mat._n;
      var X = thisObject.makeMN(n, m);
      var C = thisObject.getArray(X);
      for (var i = 0; i < m; i++) {
        for (var j = 0; j < n; j++) {
          C[j][i] = mat._A[i][j];
        }
      }
      return X;
    };

    thisObject.plus = function (matA, matB) {
      var m = matA._m;
      var n = matA._n;
      var X = thisObject.makeMN(m, n);
      var C = thisObject.getArray(X);
      for (var i = 0; i < m; i++) {
        for (var j = 0; j < n; j++) {
          C[i][j] = matA._A[i][j] + matB._A[i][j];
        }
      }
      return X;
    };

    thisObject.minus = function (matA, matB) {
      var m = matA._m;
      var n = matA._n;
      var X = thisObject.makeMN(m, n);
      var C = thisObject.getArray(X);
      for (var i = 0; i < m; i++) {
        for (var j = 0; j < n; j++) {
          C[i][j] = matA._A[i][j] - matB._A[i][j];
        }
      }
      return X;
    };

    thisObject.times = function (matA, matB) {
      if (matB._m !== matA._n) {
        //assert(0);
      }
      var X = thisObject.makeMN(matA._m, matB._n);
      var C = thisObject.getArray(X);
      var m = matA._m;
      var n = matA._n;
      var Bcolj = new Array(matA._n);

      for (var j = 0; j < matB._n; j++) {
        for (var k = 0; k < n; k++) {
          Bcolj[k] = matB._A[k][j];
        }
        for (var i = 0; i < m; i++) {
          var Arowi = matA._A[i];
          var s = 0;
          for (var k = 0; k < n; k++) {
            s += Arowi[k] * Bcolj[k];
          }
          C[i][j] = s;
        }
      }
      return X;
    };

    thisObject.solve = function (matA, matB) {
      return matA._m == matA._n ? LUDecomposition.solve(LUDecomposition.make(matA), matB) : QRDecomposition.solve(QRDecomposition.make(matA), matB);
    };

    thisObject.inverse = function (matA) {
      return thisObject.solve(matA, thisObject.identity(matA._m, matA._m));
    };

    thisObject.identity = function (m, n) {
      var X = thisObject.makeMN(m, n);
      var C = thisObject.getArray(X);
      for (var i = 0; i < m; i++) {
        for (var j = 0; j < n; j++) {
          C[i][j] = i == j ? 1.0 : 0.0;
        }
      }
      return X;
    };
    return thisObject;
  })();
  //////////////////////////// 滤波器 ///////////////////////
  var KalmenFilterForPositionVelocityState = function () {
    // the variance of the positioning error for observation
    var thisObject = this;

    thisObject.sigmaR = 2.0; //2 meters
    thisObject.dt = 1.0; // update every 1 second
    thisObject.sigmaQ = LocationConfig.SQ * Math.sqrt(2 / 3.1415926535); //误差源
    thisObject.GQGTrans = null;
    thisObject.F = null; //matrix for system process model
    thisObject.M = null; //matrix for observation mdoel
    thisObject.R = null;
    thisObject.I = null; //identity
    thisObject.covar_posteriori_state = null;
    thisObject.posteriori_state = null; //[position,velocity]
    // thisObject.posOrigGeo = [0,0,0];
    // thisObject.matInverseTNB = MathUtils.Matrix_create();
    // thisObject.matTNB = MathUtils.Matrix_create();
    thisObject.st = null;
    var prototype = KalmenFilterForPositionVelocityState.prototype;
    // Initialize() should be called after every updates to variance of errors
    prototype.initialize = function () {
      var thisObject = this;
      var dt = thisObject.dt;
      var sigmaR = thisObject.sigmaR;
      var sigmaQ = thisObject.sigmaQ;
      var dF = [
        [1, 0, dt, 0],
        [0, 1, 0, dt],
        [0, 0, 1, 0],
        [0, 0, 0, 1],
      ];
      var dQ = [
        [sigmaQ * sigmaQ, 0],
        [0, sigmaQ * sigmaQ],
      ];

      var dR = [
        [sigmaR * sigmaR, 0],
        [0, sigmaR * sigmaR],
      ];

      var dG = [
        [0, 0],
        [0, 0],
        [dt, 0],
        [0, dt],
      ];

      var dM = [
        [1, 0, 0, 0],
        [0, 1, 0, 0],
      ];

      var dcov = [
        [sigmaR * sigmaR, 0, 0, 0],
        [0, sigmaR * sigmaR, 0, 0],
        [0, 0, 15 * 15, 0],
        [0, 0, 0, 15 * 15],
      ];

      var Q = MatrixMxN.makeMNVarray(2, 2, dQ);
      var G = MatrixMxN.makeMNVarray(4, 2, dG);
      thisObject.R = MatrixMxN.makeMNVarray(2, 2, dR);
      thisObject.F = MatrixMxN.makeMNVarray(4, 4, dF);
      thisObject.M = MatrixMxN.makeMNVarray(2, 4, dM);
      thisObject.covar_posteriori_state = MatrixMxN.makeMNVarray(4, 4, dcov);
      thisObject.GQGTrans = MatrixMxN.times(MatrixMxN.times(G, Q), MatrixMxN.transpose(G));
      thisObject.I = MatrixMxN.identity(4, 4);
    };

    //force to sync location with the coordinate
    prototype.reset = function (lng, lat) {
      var thisObject = this;
      //console.log("lng:" + lng +",lat:" + lat);
      thisObject.st = MathUtils.createSphericalTransform(lng, lat, 0);
      // lng *= MathUtils.s_deg_to_rad;
      //      lat *= MathUtils.s_deg_to_rad;
      //      MathUtils.transformGeographicToECEF(thisObject.posOrigGeo, [lng, lat, MathUtils.earth_radius]);
      //      MathUtils.matrixENUToECEF(thisObject.matTNB, thisObject.posOrigGeo);
      //      MathUtils.matrixECEFToENU(thisObject.matInverseTNB, thisObject.posOrigGeo);
      var dc = [[0], [0], [0], [0]];
      thisObject.posteriori_state = MatrixMxN.makeMNVarray(4, 1, dc);
    };

    //fusing prediction with observed input coordinates
    prototype.update = function (lng, lat, t) {
      var thisObject = this;
      if (!thisObject.posteriori_state) {
        thisObject.reset(lng, lat);
      }

      // lng *= MathUtils.s_deg_to_rad;
      // lat *= MathUtils.s_deg_to_rad;
      //var posGeo = [0,0,0];

      // MathUtils.transformGeographicToECEF(posGeo, [lng, lat, MathUtils.earth_radius]);
      // MathUtils.Vector3_transformCoord(posCart, posGeo, thisObject.matInverseTNB);
      var posCart = [0, 0, 0];
      var posGeo = [0, 0, 0];
      thisObject.st.transformGeographicToENU(posCart, [lng, lat, 0]);
      // lng = posTemp[0];
      // lat = posTemp[1];

      //I.prediction
      var priori_state = MatrixMxN.times(thisObject.F, thisObject.posteriori_state); // priori_state[k] = F * posteriori_state[k-1];
      //Debug(priori_state,"x_bar");
      var covar_priori_state = MatrixMxN.plus(
        MatrixMxN.times(MatrixMxN.times(thisObject.F, thisObject.covar_posteriori_state), MatrixMxN.transpose(thisObject.F)),
        thisObject.GQGTrans,
      ); // F*covar_posteriori_state*F.T+[covariance matrix of system process noise]
      //Debug(covar_priori_state, "p_bar");
      //II.update
      var y = [[posCart[0]], [posCart[1]]];
      var Y = MatrixMxN.makeMNVarray(2, 1, y);

      //innovation(measuremnt residual): observed measurement - [observation model matrix] * priori_state
      var innovation = MatrixMxN.minus(Y, MatrixMxN.times(thisObject.M, priori_state));
      //Debug(innovation, "inno");
      //covariance of innovation
      //covar_innovation = [observation model matrix] * covar_priori_state * M.T + R
      // covar_innovation = (M * covar_priori_state * M.transpose()) + R;
      var covar_innovation = MatrixMxN.plus(
        MatrixMxN.times(MatrixMxN.times(thisObject.M, covar_priori_state), MatrixMxN.transpose(thisObject.M)),
        thisObject.R,
      );
      //Debug(covar_innovation, "mpmr");
      //kalman gain
      //MatrixMxN kalman_gain = covar_priori_state * M.transpose() * covar_innovation.inverse();
      var kalman_gain = MatrixMxN.times(MatrixMxN.times(covar_priori_state, MatrixMxN.transpose(thisObject.M)), MatrixMxN.inverse(covar_innovation));
      //Debug(kalman_gain, "k");
      //posteriori_state = priori_state + (kalman_gain * innovation);//posteriori_stat = priori_state + kalman_gain*(innovation)
      thisObject.posteriori_state = MatrixMxN.plus(priori_state, MatrixMxN.times(kalman_gain, innovation));
      //Debug(posteriori_state, "xXxxxxxxx");
      //covar_posteriori_state = (I - (kalman_gain * M)) * covar_priori_state;
      thisObject.covar_posteriori_state = MatrixMxN.times(MatrixMxN.minus(thisObject.I, MatrixMxN.times(kalman_gain, thisObject.M)), covar_priori_state);
      //Debug(covar_posteriori_state, "p");

      posCart[0] = MatrixMxN.get(thisObject.posteriori_state, 0, 0);
      posCart[1] = MatrixMxN.get(thisObject.posteriori_state, 1, 0);

      thisObject.st.transformENUToGeographic(posGeo, posCart);
      // MathUtils.Vector3_transformCoord(posGeo, posCart, thisObject.matTNB);
      // MathUtils.transformECEFToGeographic(posGeo, posGeo);
      return posGeo;
    };

    //variance of uncertainty in system process model
    prototype.setSystemProcessModelError = function (error) {
      this.sigmaQ = error;
    };

    //variance of uncertainty in observation model
    prototype.setObservationModelError = function (error) {
      this.sigmaR = error;
    };

    //
    prototype.setTimeFrequence = function (delta_time) {
      this.dt = delta_time;
    };
  };

  var KalmenFilterForSnapline = function () {};

  var DeviceConfigLoader = {
    loadDeviceConfig: function (baseUrl, bdid, callback) {
      function getPhoneType(phoneParam) {
        //正则,忽略大小写
        var pattern_phone = new RegExp("iphone", "i");
        var pattern_android = new RegExp("android", "i");
        var userAgentRaw = navigator.userAgent;
        var userAgent = navigator.userAgent.toLowerCase();
        var isAndroid = pattern_android.test(userAgent);
        var isIphone = pattern_phone.test(userAgent);
        var phoneType = "";
        var osName = "ios";
        if (isAndroid) {
          osName = "android";
          var androidIndex = userAgent.indexOf("android");
          androidAgentString = userAgent.substring(androidIndex);
          androidAgentRaw = userAgentRaw.substring(androidIndex);
          var androidIndex2 = androidAgentString.indexOf(";") + 2;
          androidAgentString = androidAgentString.substring(androidIndex2);
          androidAgentRaw = androidAgentRaw.substring(androidIndex2);
          var spaceIndex = androidAgentString.indexOf(" build");
          var fullResult = androidAgentString.substring(0, spaceIndex);
          var fullResultRaw = androidAgentRaw.substring(0, spaceIndex);
          fullResultRaw = fullResultRaw.replace(/ /g, "_");
          phoneType = fullResultRaw;
        } else if (isIphone) {
          //6   w=375    6plus w=414   5s w=320     5 w=320
          var wigth = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
          var height = window.innerHeight || document.documentElement.clientHeight || document.body.clientHeight;
          if (wigth > 400) {
            phoneType = "iPhone_6_Plus";
          } else if (wigth > 370) {
            if (height > 810) {
              phoneType = "iPhone_X";
            } else {
              phoneType = "iPhone_6";
            }
          } else if (wigth > 315) {
            phoneType = "iPhone_5s";
          } else {
            phoneType = "iPhone_4s";
          }
        } else {
          // phoneType = "您的设备太先进了";
        }
        phoneParam.osName = osName;
        phoneParam.deviceName = phoneType;
        return phoneType;
      }

      var GeofenceConfigObject = function () {
        var thisObject = this;
        thisObject.buidingData = null;
        thisObject.configSet = null;
        var proto = GeofenceConfigObject.prototype;

        var pointInPolygon = function (pos, polygon) {
          var inside = false;
          var polygonSize = polygon.length;
          var val1, val2;
          for (var i = 0; i < polygonSize; i++) {
            var p1 = polygon[(i + polygonSize) % polygonSize];
            var p2 = polygon[(i + 1 + polygonSize) % polygonSize];
            if (pos[1] < p2[1]) {
              if (pos[1] >= p1[1]) {
                val1 = (pos[1] - p1[1]) * (p2[0] - p1[0]);
                val2 = (pos[0] - p1[0]) * (p2[1] - p1[1]);
                if (val1 > val2) {
                  inside = !inside;
                }
              }
            } else if (pos[1] < p1[1]) {
              val1 = (pos[1] - p1[1]) * (p2[0] - p1[0]);
              val2 = (pos[0] - p1[0]) * (p2[1] - p1[1]);
              if (val1 < val2) {
                inside = !inside;
              }
            }
          }
          return inside;
        };
        proto.getGeofencesByPoint = function (lng, lat, z) {
          var thisObject = this;
          var floorObject = thisObject.buidingData[z];
          if (!floorObject) return null;
          var ret = null;
          var features = floorObject["features"];
          var featuresCount = features.length;
          if (featuresCount === 0) {
            return null;
          }
          var position = [lng * 3600, lat * 3600];
          for (var i = 0; i < featuresCount; i++) {
            var feature = features[i];
            //GeofenceType type = geofence->type;
            if (pointInPolygon(position, feature["geometry"]["coordinates"][0])) {
              ret = feature;
              break;
            }
          }
          return ret;
        };
      };

      function getConfigNameForCurrentDevice(geofenceConfig, osName, deviceName) {
        var configName = "";

        var osConfigSet = geofenceConfig[osName];
        if (osConfigSet) {
          var realDeviceName = "default";
          if (osConfigSet.hasOwnProperty(deviceName)) {
            realDeviceName = deviceName;
          }
          configName = osConfigSet[realDeviceName];
        }
        return configName;
      }

      function parseConfig(deviceConfig) {
        var configSet = {};
        var deviceConfigSet = deviceConfig["configSet"]["deviceConfigSet"];
        var buildingConfigSet = deviceConfig["configSet"]["buildingConfigSet"];
        var geofenceConfigSet = deviceConfig["configSet"]["geofenceConfigSet"];
        var buildingConfigId = buildingConfigSet["config_id"];
        var phoneParam = {};
        getPhoneType(phoneParam);

        var buildingConfigName = getConfigNameForCurrentDevice(buildingConfigSet, phoneParam.osName, phoneParam.deviceName);
        configSet[buildingConfigId] = createFromConfig(buildingConfigName, deviceConfigSet[buildingConfigName]);
        for (var i = 0; i < geofenceConfigSet.length; i++) {
          var geofenceConfig = geofenceConfigSet[i];
          var configId = geofenceConfig["config_id"];
          var configName = getConfigNameForCurrentDevice(geofenceConfig, phoneParam.osName, phoneParam.deviceName);
          configSet[configId] = createFromConfig(configName, deviceConfigSet[configName]);
        }

        return configSet;
        //return parseGeofences(configSet, configGeofence);
      }

      function parseGeofences(configSet, configGeofence) {
        var geofenceConfigSetForCurrentDevice = {};
        for (var floorName in configGeofence) {
          var defaultConfig = configSet[-1];
          if (!configGeofence.hasOwnProperty(floorName)) continue;

          var floorGeofenceSet = configGeofence[floorName]["geofences"];
          var floorNumber = floorGeofenceSet["floorNumber"];
          var currentFloorConfig = defaultConfig;
          var configId = floorGeofenceSet["config_id"];
          if (configId) {
            currentFloorConfig = configSet[configId];
          }
          floorGeofenceSet.configObject = currentFloorConfig;
          var features = floorGeofenceSet["features"];
          for (var i = 0; i < features.length; i++) {
            var feature = features[i];
            currentFeatureConfig = currentFloorConfig;
            var featureConfigId = feature["properties"]["config_id"];
            if (featureConfigId) {
              currentFeatureConfig = configSet[featureConfigId];
            }
            feature.type = feature["properties"]["type"];
            feature.configObject = currentFeatureConfig;
          }
          geofenceConfigSetForCurrentDevice[floorNumber] = floorGeofenceSet;
        }
        return geofenceConfigSetForCurrentDevice;
      }

      function createFromConfig(configName, rawConfig) {
        var configData = ConfigDataObject.Create();
        for (var objectName in rawConfig) {
          if (!rawConfig.hasOwnProperty(objectName)) continue;
          var val = rawConfig[objectName];
          configData.name = configName;
          if (objectName == "SMOOTH_NEAR") {
            configData.SMOOTH_NEAR = parseFloat(val);
          } else if (objectName == "SMOOTH_FAR") {
            configData.SMOOTH_FAR = parseFloat(val);
          } else if (objectName == "MIN_BLE_SCAN_RSSI") {
            configData.MIN_BLE_SCAN_RSSI = parseInt(val);
          } else if (objectName == "BLE_KALMAN_RESET_RSSI") {
            configData.BLE_KALMAN_RESET_RSSI = parseInt(val);
          } else if (objectName == "BLE_MAX_DIS") {
            configData.BLE_MAX_DIS = parseInt(val);
          } else if (objectName == "NEARBY_DISTANCE") {
            configData.NEARBY_DISTANCE = parseInt(val);
          } else if (objectName == "LOCATION_ALGORITHM") {
            configData.LOCATION_ALGORITHM = parseInt(val);
          } else if (objectName == "HASGEOFENCE") {
            configData.HASGEOFENCE = parseInt(val) === 1;
          } else if (objectName == "KALMAN_RESET_FREQ") {
            configData.KALMAN_RESET_FREQ = parseInt(val);
          } else if (objectName == "STEPLENGTH") {
            configData.STEPLENGTH = parseFloat(val);
          } else if (objectName == "GEOFENCE_COLLIDE") {
            configData.GEOFENCE_COLLIDE = val;
          } else if (objectName == "NAVI_SNAP_LINE_SQ") {
            configData.NAVI_SNAP_LINE_SQ = parseFloat(val);
          } else if (objectName == "RESET_INTERVAL") {
            configData.RESET_INTERVAL = parseInt(val);
          } else if (objectName == "CHANGEFLOOR_RESET_COUNT") {
            configData.CHANGEFLOOR_RESET_COUNT = parseInt(val);
          } else if (objectName == "MAX_NAVI_HEAD_LENGTH") {
            configData.MAX_NAVI_HEAD_LENGTH = parseFloat(val);
          }
        }
        return configData;
      }

      var urlConfig = baseUrl + bdid + "/device_config.json";
      var urlGeofence = baseUrl + bdid + "/" + bdid + ".json";

      LocalizationUtils.sendHttpRequest(
        urlConfig,
        function (deviceConfig) {
          var geofenceConfigObject = new GeofenceConfigObject();
          geofenceConfigObject.configSet = parseConfig(deviceConfig);
          LocalizationUtils.sendHttpRequest(
            urlGeofence,
            function (configGeofence) {
              //var geofenceConfigSetForCurrentDevice = parseConfig(deviceConfig, configGeofence);
              geofenceConfigObject.buildingData = parseGeofences(geofenceConfigObject.configSet, configGeofence);
              callback && callback(geofenceConfigObject);
            },
            function (e) {
              callback && callback(geofenceConfigObject);
            },
          );
        },
        function (e) {
          callback && callback();
        },
      );
    },
  };
  var BeaconDataLoader = {
    loadBeaconDataFromPSF: function (url, callback) {
      function readFloat32(parseContext) {
        var ret = parseContext.dataView.getFloat32(parseContext.cursor, true);
        parseContext.cursor += 4;
        return ret;
      }

      function readFloat64(parseContext) {
        var ret = parseContext.dataView.getFloat64(parseContext.cursor, true);
        parseContext.cursor += 8;
        return ret;
      }

      function readUint8(parseContext) {
        var ret = parseContext.dataView.getUint8(parseContext.cursor, true);
        parseContext.cursor++;
        return ret;
      }

      function readUint16(parseContext) {
        var ret = parseContext.dataView.getUint16(parseContext.cursor, true);
        parseContext.cursor += 2;
        return ret;
      }

      function readUint24(parseContext) {
        //var bytes = readBytes(parseContext, 3);
        var ret = 0;
        var dataView = parseContext.dataView;
        for (var ix = 0; ix < 3; ix++) {
          var bytes = dataView.getUint8(parseContext.cursor, true);
          ret += bytes << (ix * 8);
          parseContext.cursor++;
        }
        return ret;
      }

      function readUint32(parseContext) {
        var ret = parseContext.dataView.getUint32(parseContext.cursor, true);
        parseContext.cursor += 4;
        return ret;
      }

      function readBytes(parseContext, byteCount) {
        var ret = [];
        var dataView = parseContext.dataView;
        for (var ix = 0; ix < byteCount; ix++) {
          ret[ix] = dataView.getUint8(parseContext.cursor, true);
          parseContext.cursor++;
        }
        return ret;
      }

      var hexDigits = ["0", "1", "2", "3", "4", "5", "6", "7", "8", "9", "A", "B", "C", "D", "E", "F"];

      function readBytesToHexString(parseContext, byteCount) {
        var ret = "";
        var dataView = parseContext.dataView;
        for (var ix = 0; ix < byteCount; ix++) {
          var bytes = dataView.getUint8(parseContext.cursor, true);
          ret += hexDigits[(bytes >> 4) & 0x0f];
          ret += hexDigits[bytes & 0x0f];
          parseContext.cursor++;
        }
        return ret;
      }

      function readBytesToString(parseContext, byteCount) {
        return String.fromCharCode.apply(null, readBytes(parseContext, byteCount));
      }

      function readHeader(parseContext, fileHeader) {
        var dataView = parseContext.dataView;
        fileHeader.check_code = readUint32(parseContext);
        fileHeader.data_version = readUint16(parseContext);
        fileHeader.identifier = readBytes(parseContext, 8);
        fileHeader.data_size = readUint24(parseContext);
        fileHeader.floor_count = readUint8(parseContext);

        fileHeader.XMin = readFloat64(parseContext) / 3600;
        fileHeader.YMax = readFloat64(parseContext) / 3600;
        fileHeader.XMax = readFloat64(parseContext) / 3600;
        fileHeader.YMin = readFloat64(parseContext) / 3600;
        fileHeader.Factor[0] = readUint32(parseContext);
        fileHeader.Factor[1] = readUint32(parseContext);
        return fileHeader;
      }

      function getDegree(devideCount, p, pmax, pmin) {
        return (p * (pmax - pmin)) / devideCount + pmin;
      }

      function readFloorData(parseContext, mapBuilding, mapFloor) {
        var dataView = parseContext.dataView;
        mapFloor.section_code = readUint16(parseContext);
        mapFloor.beacon_count = readUint16(parseContext);

        for (var i = 0; i < mapFloor.beacon_count; i++) {
          var mapBeacon = new MapBeacon();
          mapFloor.Beacons.push(mapBeacon);
          mapBeacon.uuid = readBytesToHexString(parseContext, 2);
          mapBeacon.major = readBytesToHexString(parseContext, 2);
          mapBeacon.minor = readBytesToHexString(parseContext, 2);

          if (mapBuilding.data_version > 0) {
            mapBeacon.uuid = readBytesToHexString(parseContext, 2);
            mapBeacon.major = readBytesToHexString(parseContext, 2);
            mapBeacon.minor = readBytesToHexString(parseContext, 2);
          }

          mapBeacon.fid = mapBeacon.uuid + mapBeacon.major + mapBeacon.minor;
          mapBeacon.mac = mapBeacon.fid;
          mapBeacon.beaconIndex = i;
          mapBeacon.floorIndex = mapFloor.floorIndex;
          mapBeacon.type = readUint8(parseContext, 1);
          mapBeacon.reserved = readBytes(parseContext, 2);
          mapBeacon.beaconGroupId = readUint8(parseContext, 1);
          var longitude = readUint24(parseContext);
          var latitude = readUint24(parseContext);
          mapBeacon.x = getDegree(mapBuilding.Factor[0], longitude, mapBuilding.XMax, mapBuilding.XMin);
          mapBeacon.y = getDegree(mapBuilding.Factor[1], latitude, mapBuilding.YMax, mapBuilding.YMin);
          // if (mapBeacon.x > 117) {
          //     console.log("mapBeacon:" + JSON.stringify(mapBeacon));
          // }
        }
      }

      function readDataFromStream(byteStream) {
        var parseContext = {};
        parseContext.byteStream = byteStream;
        parseContext.dataView = new DataView(byteStream);
        parseContext.uint8Stream = new Uint8Array(byteStream);
        parseContext.cursor = 0;

        var mapBuilding = new MapBuilding();
        readHeader(parseContext, mapBuilding);
        for (var i = 0; i < mapBuilding.floor_count; i++) {
          var mapFloor = new MapFloor();
          mapFloor.floorIndex = i;
          mapFloor.floorId = "";
          mapFloor.floorName = "";
          mapBuilding.Floors.push(mapFloor);
          readFloorData(parseContext, mapBuilding, mapFloor);
        }
        return mapBuilding;
      }

      function loadByteStream(url, scb, fcb) {
        // LocalizationUtils.getDataBinary(url, {}, function (e) {
        //   successCallBack && successCallBack(e);
        // }, undefined, undefined, function (e) {
        //   errorCallBack && errorCallBack(e);
        // })
        if (window.XMLHttpRequest) {
          try {
            var request = new XMLHttpRequest();
            request.timeout = 15000;
            request.onreadystatechange = function () {
              var request = this;
              if (request.readyState === 4) {
                // success
                if (request.status !== 0 && request.status !== 200 && request.status !== 304) {
                } else {
                  var byteStream = null;
                  if (request.responseType == "arraybuffer" && request.response) {
                    byteStream = request.response;
                    if (byteStream === null) {
                      fcb && fcb();
                    } else {
                      scb && scb(byteStream);
                    }

                    return;
                  } else {
                    if (request.mozResponseArrayBuffer) {
                      byteStream = request.mozResponseArrayBuffer;
                      scb && scb(bytStream);
                      return;
                    }
                  }
                  fcb && fcb();
                }
              }
            }; // event handler for mesh loading
            request.onerror = function (err) {
              console.log("error", err);
            };
            request.open("GET", url, true);
            request.responseType = "arraybuffer";
            request.setRequestHeader("Access-Control-Allow-Headers", "*");

            request.setRequestHeader("Access-Control-Allow-Origin", "*");
            request.url = url;
            request.send();
          } catch (error) {
            request.xmlhttp = null;
          }
          return true;
        }

        return false;
      }

      loadByteStream(url, function (byteStream) {
        var mapData = readDataFromStream(byteStream);
        if (callback) {
          callback(mapData);
        }
      });
    },
  };

  var BeaconLocalization = function (localizationCore, url) {
    var _lastTime = LocalizationUtils.getCurrentTime();
    var _beaconScanInfoCache = {};
    var _localizationCore = localizationCore;
    var _localizationState = localizationCore._localizationState;
    var thisObject = this;
    var _mapData = null;
    thisObject._configData = null;
    var prototype = BeaconLocalization.prototype;
    prototype.init = function () {};

    prototype.loadMapData = function (bdid, callback) {
      var thisObject = this;
      thisObject.bdid = bdid;
      var configUrl = url.replace("{{bdid}}", bdid).replace("{{filename}}", "location.json");
      LocalizationUtils.getDataText(configUrl, {}, function (e) {
        // var configText = ab2str(e);
        if (thisObject.bdid == bdid) {
          if (typeof e == "string") {
            thisObject._configData = JSON.parse(e);
          } else {
            thisObject._configData = e;
          }
          var psfUrl = url.replace("{{bdid}}", bdid).replace("{{filename}}", bdid + ".psf");
          BeaconDataLoader.loadBeaconDataFromPSF(psfUrl, function (mapData) {
            _mapData = mapData;
            if (thisObject.bdid == bdid) {
              callback && callback(thisObject._configData);
            }
          });
        }
      });
    };

    function matchBeacons(beaconsScanInfos, mapBeaconInfos, lastPos) {
      var thisObject = this;
      //Match Request beacon with beacon fingerprint
      var retList = new Array();
      if (beaconsScanInfos.length <= 0) {
        return retList;
      }
      //Desc sort by beacon rssi
      beaconsScanInfos.sort(function (a, b) {
        return b.rssi - a.rssi;
      });

      // alert("for floor floor_count=" + floor_count);
      for (var bli = 0; bli < beaconsScanInfos.length; bli++) {
        var beaconsScanInfo = beaconsScanInfos[bli];
        //rssi is too small continue
        if (beaconsScanInfo.rssi < LocationConfig.MIN_BLE_SCAN_RSSI) {
          continue;
        }

        matchBeacon(beaconsScanInfo, mapBeaconInfos, lastPos, retList);
      }
      return retList;
    }

    function matchBeacon(beaconsScanInfo, mapBeaconInfos, lastPos, retList) {
      var floorCount = mapBeaconInfos.length;
      var req_fid = beaconsScanInfo.fid;

      for (var fli = 0; fli < floorCount; fli++) {
        //alert("for floor_count :" + fli + "，floor_count=" + floor_count);
        var mapFloorObject = mapBeaconInfos[fli];
        var beacon_z = mapFloorObject.floorIndex;
        var floorBeaconListSize = mapFloorObject.Beacons.length;
        //alert("floorBeaconListSize:" + floorBeaconListSize);
        for (var i = 0; i < floorBeaconListSize; i++) {
          var beaconInfo = mapFloorObject.Beacons[i];
          //alert("fid:"+beaconInfo.fid + "req_fid:" + req_fid);
          if (req_fid == beaconInfo.fid) {
            var beacon_x = beaconInfo.x;
            var beacon_y = beaconInfo.y;
            beaconsScanInfo.x = beacon_x;
            beaconsScanInfo.y = beacon_y;
            beaconsScanInfo.z = beacon_z;
            beaconsScanInfo.m_Floor = beacon_z;
            beaconsScanInfo.type = beaconInfo.type;
            beaconsScanInfo.beaconGroupId = beaconInfo.beaconGroupId;

            var req_rssi = beaconsScanInfo.rssi;

            if (lastPos && (lastPos[0] != 0 || lastPos[1] != 0)) {
              var distance = LocalizationUtils.distanceP2P(beacon_x, beacon_y, lastPos[0], lastPos[1]);
              if (distance > LocationConfig.NEARBY_DISTANCE && req_rssi < LocationConfig.BLE_KALMAN_RESET_RSSI) {
                continue;
              }
            }
            retList.push(beaconsScanInfo);
            //return;
          }
        }
      }
    }

    //calculate position by match beacons
    function getPosition(match_beacons) {
      //console.log("getPosition match_beacons.length=" + match_beacons.length + "<br/>");
      if (match_beacons.length < 1) {
        var position = new Position(0, 0, 0);
        return position;
      }

      var floor = calculateFloor(match_beacons);
      var position = calculatePosition(match_beacons, floor);
      return position;
    }

    //calculate floor by match beacons
    function calculateFloor(match_beacons) {
      //console.log("calculateFloor match_beacons.length=" + match_beacons.length + ",z=" + match_beacons[0].z  + "<br/>");
      if (match_beacons.length < 1) {
        return;
      }
      var floor = match_beacons[0].z;
      return floor;
    }

    //calculate floor by match beacons
    function calculatePosition(match_beacons, floor) {
      //console.log("calculatePosition start" + "<br/>");
      var match_beacons_size = match_beacons.length;
      if (match_beacons_size < 1) {
        return;
      }

      var position = new Position(0, 0, 0);
      for (var i = 0; i < match_beacons_size; i++) {
        var beacon = match_beacons[i];
        position.x += beacon.x;
        position.y += beacon.y;
        // document.write("calculatePosition x=" + position.x + ",y=" + position.x + ",z=" + position.z + "<br/>");
      }

      position.x /= match_beacons_size;
      position.y /= match_beacons_size;
      position.z = floor;
      // document.write("calculatePosition x=" + position.x + ",y=" + position.y + ",z=" + position.z + "<br/>");
      return position;
    }

    function updateFloorEvaluation(state, blePoints) {
      var resetFloor = SpecialBeaconResetFloor(state, blePoints);

      // if(resetFloor <= 0){
      //  console.log("resetFloor:" + resetFloor);
      // }
      if (resetFloor !== -1) {
        //alert("return:"+resetFloor);
        return resetFloor;
      }
      var muchFloor = CalculateMuchFloor(state, blePoints);
      var floor = muchFloor;

      // if(muchFloor <= 0){
      //  console.log("muchFloor:" + muchFloor);
      // }
      var stackFloor = CalculateStackFloor(state, blePoints, muchFloor);

      // if(stackFloor <= 0){
      //  console.log("stackFloor:" + stackFloor);
      // }
      var lastPosition_tmp = state.getPosition();
      //::DebugTrace("stackFloor=%d, muchFloor=%d , lastz=%f", stackFloor, muchFloor, lastPosition.z);
      if (stackFloor != muchFloor && lastPosition_tmp[0] && lastPosition_tmp[1]) {
        floor = lastPosition_tmp[2];
      } else {
        floor = muchFloor;
      }
      return floor;
    }

    function updatePositionEvaluation(state, mapBeaconInfos, floor, far, near, needReset) {
      var lastPosition_tmp = state.getPosition();
      var currentPosition = [0, 0, 0];
      var x = 0;
      var y = 0;
      var count = 0;
      for (var i = 0; i < mapBeaconInfos.length; i++) {
        var mp = mapBeaconInfos[i];
        if (floor == mp.z && 2 != mp.type) {
          var weight = GetRssiWeight(mp.rssi);
          x += mp.x * weight;
          y += mp.y * weight;
          count += weight;
        }
      }
      //::DebugTrace("UpdatePositionEvaluation : floor=%d , args.size=%d , count=%lf , x=%lf , y = %lf" , floor , args.beacons.size() , count , x , y);
      if (count > 0) {
        x /= count;
        y /= count;
        currentPosition[0] = x;
        currentPosition[1] = y;
        currentPosition[2] = floor;
      } else {
        return lastPosition_tmp;
      }

      //  }
      if (!currentPosition[0] || !currentPosition[1]) {
        // }
        return lastPosition_tmp;
      }

      if (!lastPosition_tmp[0] || !lastPosition_tmp[1]) {
        lastPosition_tmp = currentPosition;
        state.setPosition(currentPosition);
        return currentPosition;
      }

      //angeo_double dis = GeodeticCircleRadians(lastPosition.x * math_d::s_deg_to_rad, lastPosition.y* math_d::s_deg_to_rad, currentPosition.x* math_d::s_deg_to_rad, currentPosition.y* math_d::s_deg_to_rad);
      var dis = LocalizationUtils.distanceP2P(lastPosition_tmp[0], lastPosition_tmp[1], currentPosition[0], currentPosition[1]);
      //计算lastmp 到 最新的位置点的方位角
      var angle = getAngleByTwoPoint(lastPosition_tmp, currentPosition);
      var mHeading = state._heading;
      // 求角度差
      var angle_diff = Math.abs(angle - mHeading);
      // 将角度差统一为0-180度
      while (angle_diff > 180) {
        angle_diff = angle_diff % 360;
        angle_diff = 360.0 - angle_diff;
      }

      var distmp = dis * Math.cos(angle_diff * (Math.PI / 180.0));
      if (dis > LocationConfig.BLE_MAX_DIS) {
        lastPosition_tmp[0] = lastPosition_tmp[0] + (currentPosition[0] - lastPosition_tmp[0]) * far;
        lastPosition_tmp[1] = lastPosition_tmp[1] + (currentPosition[1] - lastPosition_tmp[1]) * far;
      } else {
        currentPosition[0] = lastPosition_tmp[0] + (currentPosition[0] - lastPosition_tmp[0]) * near;
        currentPosition[1] = lastPosition_tmp[1] + (currentPosition[1] - lastPosition_tmp[1]) * near;
        lastPosition_tmp = currentPosition;
        state.setPosition(lastPosition_tmp);
      }
      return lastPosition_tmp;
    }

    function updateFilterEvaulation(state, rawPosition, matchedBeacons, retArgs, resetFloor) {
      //::DebugTrace("----------------------------------Beacon KAL Begin--------------------------------------");
      var filter = _localizationCore._localizationFilter;
      var lastPosition = state.getPosition();
      if (!lastPosition[0] || !lastPosition[0]) {
        return rawPosition;
      }

      if (!rawPosition[0] || !rawPosition[1]) {
        return lastPosition;
      }

      if (matchedBeacons.length <= 0) {
        return lastPosition;
      }

      var firstMatchBeacon = matchedBeacons[0];
      var position = [rawPosition[0], rawPosition[1], rawPosition[2]];
      var currTime = LocalizationUtils.getCurrentTime(); //
      var resetTime = state._filterResetTime; //
      var difTIme = currTime - resetTime;

      if (difTIme > LocationConfig.KALMAN_RESET_FREQ && firstMatchBeacon.rssi >= LocationConfig.BLE_KALMAN_RESET_RSSI) {
        //最强信号的floor（即args.beacons[0].m_Floor）不能用于直接返回结果，floor的判断逻辑在updatefloor中，因此这里floor樱采用rawPosition.z，故不重新复制。
        position[0] = firstMatchBeacon.x;
        position[1] = firstMatchBeacon.y;
        if (LocationConfig.EKF) {
          filter.reset(position[0], position[1]);
        }
        retArgs.isReset = true;
        resetFloor = matchedBeacons.z;
        state._filterResetTime = currTime;
      } else {
        if (LocationConfig.EKF) {
          var c = filter.update(position[0], position[1], position[2]);
          if (0 != c[0] && 0 != c[1]) {
            state.setPosition([c[0], c[1], position[2]]);
            position[0] = c[0];
            position[1] = c[1];
          }
        } else {
        }
      }
      //::DebugTrace("----------------------------------Beacon KAL End--------------------------------------");
      return position;
    }

    /*
     Function:          SpecialBeaconResetFloor
     Desc:              SpecialBeacon type = 2 The beacon has strong signal, when change floor.
     Param:             Last state  and scan beacons.
     Return:            Default result : -1 or beacon`s floor.
     */
    function SpecialBeaconResetFloor(state, blePoints) {
      var res = -1;
      for (var m = 0; m < blePoints.length; m++) {
        var mp = blePoints[m];
        if (2 == mp.type && mp.rssi > LocationConfig.BLE_KALMAN_RESET_RSSI && mp.z != state.getPosition()[2]) {
          res = mp.z;
          break;
        }
      }
      return res;
    }

    function BeaconResetFloor(state, blePoints, diff_rssi) {
      var res_floor = -1;
      var max_rssi = -152;
      for (var m = 0; m < blePoints.length; m++) {
        var mp = blePoints[m];
        var reset_rssi = LocationConfig.BLE_KALMAN_RESET_RSSI;
        var min_scan_rssi = LocationConfig.MIN_BLE_SCAN_RSSI;
        var diff = reset_rssi - diff_rssi;
        if (mp.m_Rssi > diff && max_rssi < mp.rssi) {
          max_rssi = mp.rssi;
          res_floor = mp.z;
          //::DebugTrace("BeaconResetFloor 2 rssi=%d ,floor=%d , reset=%d , min_scan=%d , diff=%d , max=%d" ,mp.m_Rssi , mp.m_Floor , reset_rssi , min_scan_rssi , diff , max_rssi);
        }
      }

      return res_floor;
    }

    function CalculateStackFloor(state, mps, floor) {
      //return floor;
      state.PushHisFloor(floor);
      //::DebugTrace("CalculateStackFloor : GetHisFloorList");
      var floor_deque = state._locationHisResultList;
      //::DebugTrace("CalculateStackFloor : GetHisFloorSize");
      var floor_deque_size = state.GetHisFloorSize();
      //::DebugTrace("CalculateStackFloor : floor=%d size=%d", floor , floor_deque_size);
      //return floor;
      if (floor_deque_size < 3) {
        return state.getPosition()[2];
      }
      if (floor_deque_size > 6) {
        //::DebugTrace("CalculateStackFloor : pop");
        state.PopHisFloor();
        floor_deque_size = state.GetHisFloorSize();
      }

      var floor_map = new Array();
      for (var i = 0; i < floor_deque_size; i++) {
        var fl = floor_deque[i];
        if (floor_map[fl] === undefined) {
          floor_map[fl] = 1;
          //::DebugTrace( "CalculateStackFloor: m=%d , z=%d , new=1",i , fl);
        } else {
          floor_map[fl]++;
          //::DebugTrace("CalculateStackFloor: m=%d , z=%d",i , fl);
        }
      }
      var floor_cl = -1;
      var max = 0;
      for (fl in floor_map) {
        var floor_count = floor_map[fl];
        if (max < floor_count) {
          max = floor_count;

          floor_cl = parseInt(fl);
        }
      }
      //::DebugTrace("CalculateStackFloor max=%d , , floor=%d" , max , floor);
      if (max / floor_deque_size < 0.5) {
        floor_cl = state.getPosition()[2];
      }
      //    else{
      //        floor_cl = floor_cl;
      //    }
      return floor_cl;
    }

    function CalculateMuchFloor(state, mps) {
      var floor_map = {};
      for (var m = 0; m < mps.length; m++) {
        if (m.type === 3) {
          continue;
        }
        var mp = mps[m];
        var floorObj = {
          floor: -1,
          count: 0,
          weight: 0.0,
        };
        //::DebugTrace("calculateFloor: m=%d , mac=%s , x=%lf , y=%lf, z=%d",m, mp.m_Mac.c_str() , mp.m_X , mp.m_Y , mp.m_Floor);
        if (floor_map[mp.m_Floor] === undefined) {
          floorObj.floor = mp.m_Floor;
          floorObj.count = 1;
          floorObj.weight = GetRssiWeight(mp.rssi);
        } else {
          floorObj = floor_map[mp.m_Floor];
          floorObj.floor = mp.m_Floor;
          floorObj.count = floor_map[mp.m_Floor].count + 1;
          floorObj.weight = floorObj.weight + GetRssiWeight(mp.rssi);
          // floor_map[mp.m_Floor]= floor_map[mp.m_Floor]+1;
          //  ::DebugTrace("calculateFloor: m=%d , z=%d",m , mp.m_Floor);
        }
        floor_map[mp.m_Floor] = floorObj;
      }
      var floor = -1;
      var max_weight = 0;
      var max_count = 0;
      // var max = 0;
      for (var fl in floor_map) {
        var floorObj = floor_map[fl];
        var fl_weight = floorObj.weight;
        var fl_count = floorObj.count;
        var fl_floor_ = floorObj.floor;
        if (max_weight < fl_weight) {
          max_weight = fl_weight;
          max_count = fl_count;
          floor = fl_floor_;
        }
      }
      var prob = max_count / mps.length;
      if (prob < 0.4 && max_count > 0) {
        floor = state.getPosition()[2];
      }
      // if ((max / mps.length) < 0.6 && max > 0){
      //  floor = state.getPosition()[2];
      // }
      //alert("muchFloor4:" +floor);
      //::DebugTrace("calculateFloor max=%lf , , floor=%d" , max / (angeo_double)mps.size() , floor);
      return floor;
    }

    function CalculateMuchFloor_old(state, mps) {
      var floor_map = {};
      for (var m = 0; m < mps.length; m++) {
        var mp = mps[m];
        if (mp.type === 3) {
          continue;
        }
        if (floor_map[mp.m_Floor] === undefined) {
          floor_map[mp.m_Floor] = 1;
        } else {
          floor_map[mp.m_Floor] = floor_map[mp.m_Floor] + 1;
        }
      }
      var floor = -1;
      var max = 0;
      for (fl in floor_map) {
        var floor_count = floor_map[fl];
        if (max < floor_count) {
          max = floor_count;
          floor = parseInt(fl);
          if (isNaN(floor)) {
            floor = -1;
            console.log(floor);
          }
          // if(floor <= 0){
          //  console.log("max:"+ max + "," + fl);
          // }
        }
      }
      if (max / mps.length < 0.6 && max > 0) {
        floor = state.getPosition()[2];
        if (isNaN(floor)) {
          floor = -1;
          console.log(floor);
        }
      }
      if (isNaN(floor)) {
        floor = -1;
        console.log(floor);
      }
      return floor;
    }

    function getAngleByTwoPoint(start, end) {
      return getAngleByTwoPointInNorthEarth(start[0], end[0], start[1], end[1]);
    }

    function CalculateGroupId(state, mps) {
      var currTime = LocalizationUtils.getCurrentTime();
      var groupIdMap = state.getGroupIdMap();
      //for each ble points , save groupid to groupidmap.If device had exist , then update device.
      for (var i = 0; i < mps.length; i++) {
        var bm = mps[i];
        var groupid = bm.beaconGroupId;
        var fid = bm.fid;
        var curr_time = bm.timeStamp;
        groupIdMap[fid] = bm;
        /*if(groupIdMap.hasOwnProperty(fid)) {
            var oldScanInfo = groupIdMap[fid];
            if(oldScanInfo.rssi < bm.rssi){
              groupIdMap[fid] = bm;
            }else{
              oldScanInfo.timeStamp = bm.timeStamp;
            }
          }else{
            groupIdMap[fid] = bm;
          }
        */
      }
      var sortBeaconsList = [];
      for (var key in groupIdMap) {
        if (groupIdMap.hasOwnProperty(key)) {
          var scanInfo = groupIdMap[key];
          if (currTime - scanInfo.timeStamp > LocationConfig.GROUPID_VALID_TIME) {
            delete groupIdMap[key];
            continue;
          }
          sortBeaconsList.push(scanInfo);
        }
      }
      sortBeaconsList.sort(function (a, b) {
        return b.rssi - a.rssi;
      });
      var curr_groupid = sortBeaconsList[0].beaconGroupId;
      var last_groupid = state.getLastGroupId();
      var last_groupid_time = state.getLastGroupIdTime();
      // console.log("curr_groupid:" + curr_groupid + ";last_groupid:" + last_groupid);
      //GROUPID_COOLING_TIME
      if (
        (-1 == last_groupid || curr_groupid != last_groupid || last_groupid_time == 0 || last_groupid_time == undefined) &&
        currTime - last_groupid_time > LocationConfig.GROUPID_COOLING_TIME
      ) {
        last_groupid = curr_groupid;
        state.setLastGroupId(last_groupid);
        state.setLastGroupIdTime(currTime);
      }
      return last_groupid;
    }

    function getAngleByTwoPointInNorthEarth(x1, x2, y1, y2) {
      var diff_x = x2 - x1;
      var diff_y = y2 - y1;
      var length = Math.sqrt(diff_x * diff_x + diff_y * diff_y);
      if (length == 0) length = 1;
      var InvLength = 1 / length;
      var vec11 = 0;
      var vec12 = -1;
      var vec21 = diff_x * InvLength;
      var vec22 = -diff_y * InvLength;
      var dotValue = vec11 * vec21 + vec12 * vec22;
      var angle = (180.0 / Math.PI) * Math.acos(dotValue);
      if (diff_x < 0) {
        angle = 360 - angle;
      }
      return angle;
    }

    function GetRssiWeight(rssi) {
      var MAX_RSSI = -60;
      var MIN_RSSI = LocationConfig.MIN_BLE_SCAN_RSSI;
      var RANGE = MAX_RSSI - MIN_RSSI;
      //filter rssi in max to min.
      rssi = Math.max(MIN_RSSI, Math.min(MAX_RSSI, rssi));
      var diff = Math.max(rssi - MIN_RSSI, 0.5);
      var dRes = diff / RANGE;
      //::DebugTrace("GetRssiWeight : rssi=%d , min=%d , weight=%lf , diff=%d , range=%d", rssi , MIN_RSSI , dRes, diff, RANGE);
      return dRes;
    }

    var _bleUpdateArgs = {
      position: [0, 0, 0],
      heading: 0,
      eventSource: LES_BEACON,
      timeStamp: 0,
      updateType: UPDATE_TYPE_BLE,
    };

    function sendBLEScanUpdatedEvents(beaconScanInfos, timeStamp) {
      if (Object.keys(beaconScanInfos).length <= 0) {
        return;
      }

      if (!_mapData) {
        return;
      }
      var lastPosition = _localizationState.getPosition();
      ////////////////////////////////////////////////////////////////////
      var far = LocationConfig.SMOOTH_FAR;
      var near = LocationConfig.SMOOTH_NEAR;
      if (!_localizationState._isWalking && LocationConfig.GHOST) {
        far = LocationConfig.SMOOTH_FAR / 7;
        near = LocationConfig.SMOOTH_NEAR / 7;
      }
      var mapBeaconInfos = _mapData.Floors;
      var blePoints = matchBeacons(beaconScanInfos, mapBeaconInfos, lastPosition);
      var lastLocationTime = _localizationState._lastLocationTime;
      if (blePoints.length < 1) {
        return lastPosition;
      }

      // Calculate floor;
      var floor = updateFloorEvaluation(_localizationState, blePoints);
      var needReset = true;
      var isReset = false;
      var resetFloorIndex = floor;
      //============= Release location modle start (Release code)=========
      var rawPos = updatePositionEvaluation(_localizationState, blePoints, floor, far, near, needReset);
      if (!rawPos[0] || !rawPos[1]) {
        return newPos;
      }

      ///////////////////////////////////////////////////////
      // Position Fusion
      var retArgs = {
        isReset: false,
      };
      var newPos = [0, 0, floor];
      newPos = updateFilterEvaulation(_localizationState, rawPos, blePoints, retArgs, resetFloorIndex);
      newPos[2] = parseInt(floor);
      //============= Release location modle end (Release code)=========
      //calculate error value return
      if (!newPos[0] || !newPos[1]) {
        return newPos;
      }

      if (newPos[2] < 0) {
        return newPos;
      }

      _localizationState._lastLocationTime = beaconScanInfos[0].time;
      _localizationState.setPosition(newPos);

      _bleUpdateArgs.beaconGroupId = CalculateGroupId(_localizationState, blePoints);
      _bleUpdateArgs.position = newPos;
      _bleUpdateArgs.heading = _localizationState.getHeading();
      _bleUpdateArgs.timeStamp = beaconScanInfos[0].time;
      if (retArgs.isReset) {
        _bleUpdateArgs.floorIndex = resetFloorIndex;
        _bleUpdateArgs.updateType = UPDATE_TYPE_BLE_RESET;
      } else {
        _bleUpdateArgs.updateType = UPDATE_TYPE_BLE;
      }

      _localizationCore.onLocalizationSucceed(_bleUpdateArgs);
    }

    prototype.onBeaconsChanged = function (beaconScanInfos, timeStamp) {
      sendBLEScanUpdatedEvents(beaconScanInfos, timeStamp);
    };
  };

  var BeaconLocalizationEvaluation = function (token, bdid, framwork, locationUrl) {
    var thisObject = this;
    thisObject._bdid = "";
    thisObject._beaconLocalization = null;
    thisObject._localizationState = null;
    thisObject._localizationFilter = null;
    thisObject._onLocationUpdateCallback = null;
    thisObject._GeofenceBuildingObject = null;

    thisObject._lastBleUpdateTime = 0;
    thisObject._isDirty = true;
    thisObject.buildingData = {};
    thisObject.configData = null;
    thisObject.floorData = null;
    thisObject.loadingData = false;
    thisObject.currentBDID = "";
    thisObject._locationUrl = locationUrl.replace("{{token}}", token);
    thisObject._isFirstTime = true;
    thisObject._startTest = false;

    var prototype = BeaconLocalizationEvaluation.prototype;
    prototype.init = function () {
      var thisObject = this;
      thisObject._localizationState = new LocalizationTargetState();
      thisObject._localizationFilter = new LocalizationFilter();
      thisObject._localizationFilter.init();

      thisObject._beaconLocalization = new BeaconLocalization(this, thisObject._locationUrl);
      thisObject._beaconLocalization.init();
    };

    prototype.fini = function () {
      var thisObject = this;
      if (thisObject._beaconLocalization) {
        thisObject._beaconLocalization.fini();
        thisObject._beaconLocalization = null;
      }
    };

    prototype.start = function (bdid, callback, bdInfo) {
      var thisObject = this;
      thisObject._bdid = bdid;
      if (!thisObject.buildingData[token]) {
        thisObject.buildingData[token] = {};
      }
      if (thisObject.buildingData[token][bdid]) {
        thisObject.configData = thisObject.buildingData[token][bdid]["configData"];
        thisObject.floorData = thisObject.buildingData[token][bdid]["floorData"];
        callback && callback(thisObject.configData);
      } else {
        thisObject._beaconLocalization.loadMapData(bdid, function (mapData) {
          //bdInfo
          var floors = bdInfo.data.floors;
          var configData = {
              bdid: bdInfo.bdid,
              locatingMap: {},
              floorToFloorId: {},
              center: bdInfo.center,
              groundFloorId: bdInfo.groundFloorId,
              groundIndex: bdInfo.groundIndex,
            },
            floorData = {};

          // locatingMap  center floorToFloorId
          floors.forEach(function (floor) {
            configData["locatingMap"][floor.flindex] = floor.flid;
          });
          thisObject.buildingData[token][bdid] = {
            configData: configData,
            floorData: floorData,
          };
          if (thisObject._bdid == bdid) {
            thisObject.configData = thisObject.buildingData[token][bdid]["configData"];
            callback && callback(thisObject.configData);
          }
        });
      }

      thisObject._lastBleUpdateTime = LocalizationUtils.getCurrentTime();
    };

    prototype.stop = function () {
      // this.locationEngine.clean()
    };

    prototype.reset = function (loc) {
      if (loc && loc["lon"]) {
        _pdrUpdateArgs.position = { x: loc["lon"], y: loc["lat"], z: loc["floorIndex"] };
        _pdrUpdateArgs.floorId = loc["floorId"];
        this.onLocalizationSucceed(_pdrUpdateArgs);
      } else {
        thisObject._isFirstTime = true;
      }

      thisObject._lastBleUpdateTime = LocalizationUtils.getCurrentTime();
    };

    var _orientationUpdateArgs = {
      position: {
        x: 0,
        y: 0,
        z: 0,
      },
      heading: 0,
      eventSource: LES_PDR,
      timeStamp: 0,
      updateType: UPDATE_TYPE_ORIENTAION,
    };

    prototype.updateOrientation = function (orientation) {
      var thisObject = this;
      thisObject._localizationState.resetHeading(orientation);
    };

    prototype.updateScan = function (beaconScanInfos, timeStamp) {
      var thisObject = this;
      beaconScanInfos.forEach(function (item) {
        item.fid = item.mac;
      });
      thisObject._beaconLocalization.onBeaconsChanged(beaconScanInfos, timeStamp);
    };

    var _pdrUpdateArgs = {
      position: {
        x: 0,
        y: 0,
        z: 0,
      },
      heading: 0,
      eventSource: LES_PDR,
      timeStamp: 0,
      updateType: UPDATE_TYPE_PDR,
    };
    prototype.updateStep = function (stepData) {
      var thisObject = this;
      var localizationState = thisObject._localizationState;
      var localizationFilter = thisObject._localizationFilter;
      localizationState._resetHeading = stepData.heading;
      var lastPos = localizationState.getPosition();

      if (LocalizationUtils.isValidatePosition(lastPos)) {
        var newPos = LocalizationUtils.getPositionByDistanceAngle(
          lastPos[0],
          lastPos[1],
          lastPos[2],
          LocationConfig.STEPLENGTH,
          localizationState.getHeading(),
        );
        var needCollide = false;
        var pdr_geofence = null;
        if (LocationConfig.HASGEOFENCE && thisObject._GeofenceBuildingObject && thisObject._GeofenceBuildingObject.buidingData) {
          pdr_geofence = thisObject._GeofenceBuildingObject.getGeofencesByPoint(newPos[0], newPos[1], lastPos[2]);
          if (pdr_geofence === null) {
            return;
          }

          if (localizationState.getGeofence() !== pdr_geofence) {
            ConfigDataObject.CopyFrom(LocationConfig, pdr_geofence.configObject);
            localizationState.setGeofence(pdr_geofence);
          }

          if (-1 === pdr_geofence.type) {
            //-1:为定义的不可通行区域
            needCollide = true;
          } else if (3 === pdr_geofence.type) {
            //3:房间
            needCollide = true;
          } else if (5 == pdr_geofence.type) {
            //5:扶梯面
            needCollide = true;
          } else if (150 == pdr_geofence.type) {
            //150:室外不可通行区域，如，停车场
            needCollide = true;
          }

          if (needCollide && LocationConfig.GEOFENCE_COLLIDE == true && _GeofenceCollide) {
            return;
          } else {
            lastPos[0] = newPos[0];
            lastPos[1] = newPos[1];
          }
        }
        if (localizationFilter) {
          var c = localizationFilter.update(newPos[0], newPos[1]);
        }
        localizationState.setPosition(newPos);
        if (newPos[0] !== 0 && newPos[1] !== 0) {
          _pdrUpdateArgs.position = newPos;
          _pdrUpdateArgs.heading = localizationState._heading;
          _pdrUpdateArgs.step = stepData.step;
          _pdrUpdateArgs.timeStamp = stepData.timeStamp;

          thisObject.onLocalizationSucceed(_pdrUpdateArgs);
        }
      }
    };
    prototype.onLocalizationSucceed = function (posUpdateArgs) {
      // var locatingMap = this._beaconLocalization._configData.locatingMap;
      posUpdateArgs.locType = "BLE";
      posUpdateArgs.bdid = thisObject.configData.bdid;
      posUpdateArgs.floorId = thisObject.configData.locatingMap[posUpdateArgs.floorIndex];
      if (this._onLocationUpdateCallback) {
        this._onLocationUpdateCallback(posUpdateArgs);
      }
    };
  };

  var BLETrilaterationAlgorithm = {
    StepCounter: StepCounter,
    LocalizationUtils: LocalizationUtils,
    LocalizationAlgorithm: BeaconLocalizationEvaluation,
    DeviceConfigLoader: DeviceConfigLoader,
  };
  return BLETrilaterationAlgorithm;
})();
///////////   三角定位  end   /////////////////

///////////   指纹定位 /////////////////
var BLEFingerprintAlgorithm = (function () {
  var UPDATE_TYPE_ORIENTAION = 0;
  var UPDATE_TYPE_PDR = 1;
  var UPDATE_TYPE_BLE = 2;
  var UPDATE_TYPE_BLE_RESET = 3;

  var globalEventTrigger = new EventTrigger();

  var RSSBuildingUtils = (function () {
    var thisObject = {};
    thisObject.isInFreedoms = function (t, e, n) {
      return false;
    };
    thisObject.isInThisMap = function (t, e, n) {
      return true;
    };
    return thisObject;
  })();

  var RSSLocationDetermine = function (le) {
    var thisObject = this;
    thisObject.locationEngine = le;
    thisObject.worker = le.worker;

    var A = thisObject.worker;
    var y = globalEventTrigger;

    var prototype = RSSLocationDetermine.prototype;
    prototype.clear = function () {
      A.postMessage({
        type: "rc",
      });
    };
    prototype.reset = function () {
      thisObject.locationEngine.reset();
    };
    prototype.checkInScanResultAndProcess = function (t, callback, timeStamp) {
      var thisObject = this;

      return new Promise(function (n) {
        A.postMessage({
          timeStamp: timeStamp,
          type: "ri",
          data: t,
          el: {
            targetLon: thisObject.locationEngine.targetLon,
            targetLat: thisObject.locationEngine.targetLat,
            longitude: thisObject.locationEngine.longitude,
            latitude: thisObject.locationEngine.latitude,
            direction: thisObject.locationEngine.direction,
            floor: thisObject.locationEngine.floor,
            headingBegin: thisObject.locationEngine.headingBegin,
          },
        });

        y.off("rss").on("rss", n);
      });
    };

    thisObject.clear();
  };

  var RSSBuildingFloorDetermine = function (la, le) {
    var thisObject = this;
    thisObject.locationAlgorithm = la;
    thisObject.locationEngine = le;
    thisObject.floorData = {};
    thisObject.floor = 0;
    thisObject.lastTimeStamp = 0;
    thisObject.scoreBoard = [];
    thisObject.worker = la.worker;
    var A = thisObject.worker;
    var y = globalEventTrigger;
    var prototype = RSSBuildingFloorDetermine.prototype;
    prototype.init = function (e) {
      (e && this.setDataBase(e), (this.floorData = {}), (this.scoreBoard = []), (this.lastTimeStamp = new Date().getTime()));
    };

    prototype.setDataBase = function (t) {
      A.postMessage({
        type: "bs",
        data: t,
      });
    };

    prototype.getFloor = function (t) {
      return new Promise(function (e) {
        A.postMessage({
          type: "bf",
          data: t,
        });
        y.off("bfd").on("bfd", e);
      });
    };
  };

  var RSSLocationEngine = function (la, token, bdid, fingerUrl) {
    EventTrigger.call(this);
    var thisObject = this;
    thisObject.worker = la.worker;
    thisObject.la = la;
    thisObject.headingBegin = 0;
    thisObject.isWxapp = 0;
    thisObject.bfd = 0;
    thisObject.gpsOffset = 0;
    thisObject.freedomInterval = 0;
    thisObject.headingLockProcess = 0;
    thisObject.floor = 0;
    thisObject.projectId = la.bdid;
    thisObject.routeBearing = 0;
    thisObject.param = 0;
    thisObject.defaultParam = 0;
    thisObject.routeInfo = 0;
    thisObject.lat = 0;
    thisObject.lon = 0;
    thisObject.locType = "";
    thisObject.location = 0;
    thisObject.lockRegions = 0;
    thisObject.preFloor = 0;
    thisObject.longitude = 0;
    thisObject.latitude = 0;
    thisObject.floor = 0;
    thisObject.useGPS = 0;
    thisObject.changeFloorTime = 0;
    thisObject.isInThisMapCheck = 0;
    thisObject.realBeaconScanCount = 0;
    thisObject.direction = 0;
    thisObject.isInThisMap = 0;
    thisObject.isInThisMapCheckInterval = 0;
    thisObject.nextCheckGPSTime = 0;
    thisObject.nextTimeInterval = 0;
    thisObject.freedom = 0;
    thisObject.freedomOriOffset = 0;
    thisObject.processedHeading = 0;
    thisObject.catchLocationResults = null;
    thisObject.catchBleInfos = null;
    thisObject.lastBleLocatedTime = 0;
    thisObject.token = token || "11da506a647aae682d208c5c5bb43098";
    thisObject.projectId = bdid || "B000A11DFP";
    thisObject.enableBLEPredict = false;

    var A = thisObject.worker;
    var y = globalEventTrigger;
    var prototype = RSSLocationEngine.prototype;

    prototype.init = function (onLocalizationSucceed) {
      var thisObject = this;
      var n = this;
      n.clean();
      n.headingBegin = !0;
      n.freedomOriOffset = 0;
      n.bfd = new RSSBuildingFloorDetermine(la, n);
      n.bfd.init();
      n.setDefaultParameters();
      n.processedHeading = 1e-4;

      n.floor = 1;
      n.preFloor = 1;
      n.onLocalizationSucceed = onLocalizationSucceed;

      A.onmessage = function (t) {
        //console.log(event);
        var e = t.data.type,
          n = t.data.data;
        if (e == "data") {
          if (n.floor != undefined && n.floor != null) {
            y.trigger("data", n);
          }
        } else if (e == "bfd") {
          y.trigger("bfd", n);
        } else if (e == "rss") {
          y.trigger("rss", n);
        } else if (e == "step") {
          console.log(e);
        } else if (e == "fpresult") {
          y.trigger("fpresult", n);
        }
      };

      y.on("data", function (t) {
        // ble 变化返回
        if (t.latitude && t.longitude) {
          Object.assign(n, t);
          var location = {
            position: [t.longitude, t.latitude, t.floor],
            updateType: UPDATE_TYPE_BLE,
            heading: t.direction,
            timeStamp: new Date().getTime(),
            lblt: t.timeStamp,
            floor: t.floor,
            speed: t.speed,
            sls: t.sls,
            cac: t.cac,
            locType: t.locType,
            bdid: t.bdid,
            floorId: t.floorId,
          };
          n.onLocalizationSucceed(location);
          if (t.stepLength) {
            window["stepCount"] = t.stepCount;
            window["stepLength"] = t.stepLength;
          }
        } else {
          return;
        }
      });
      y.on("bfd", function (t) {
        Object.assign(n, t);
      });
      y.on("rss", function (t) {
        Object.assign(n, t);
      });
      y.on("fpresult", function (t) {
        var i = Date.now();
        var o = {
          projectId: n.projectId,
          token: n.token,
          scanResults: n.filterScanResults,
          floor: n.preFloor || n.floor,
          timeStamp: i,
        };
        n.dealFingerPrints(o, { data: t }, n.checkInFingerPrintsCallback, i, i);
      });
    };
    prototype.setGpsOffset = function (t) {
      this.gpsOffset = t;
    };

    prototype.setProjectId = function (t, bdInfo) {
      this.projectId = t;
      this.bdInfo = bdInfo;
    };

    prototype.checkFreedomRegionAndInThisMapProcedure = function () {
      var t = this,
        e = 0;
      var v = RSSBuildingUtils;
      (this.freedomInterval && clearInterval(this.freedomInterval),
        (this.freedomInterval = setInterval(function () {
          if (t.longitude && t.latitude && t.preFloor) {
            Date.now() - e > 15e3 &&
              ((e = Date.now()), (t.isInThisMap = (0, v.isInThisMap)([t.longitude, t.latitude])), t.isInThisMap && (t.isInThisMapCheck = !0));
            // Date.now() - e > 15e3 && (e = Date.now(), t.isInThisMap = true, t.isInThisMap && (t.isInThisMapCheck = !0));
            var n = (0, v.isInFreedoms)(t.longitude, t.latitude, t.preFloor);
            if (t.freedom !== n) {
              t.freedom = n;
              var a = {};
              if (n) {
                var o = n.split(",");
                ((a.StepFactor = o[0] ? parseFloat(o[0]) : void 0),
                  (a.GpsAccuracy = o[1] ? parseFloat(o[1]) : void 0),
                  (a.GpsOutsideLockRange = o[2] ? parseFloat(o[2]) : void 0),
                  (a.MinPowerLevelForGps = o[3] ? parseFloat(o[3]) : void 0),
                  (a.GpsInToOutThreshold = o[4] ? parseFloat(o[4]) : void 0),
                  (a.GpsOutToInThreshold = o[5] ? parseFloat(o[5]) : void 0),
                  (a.StrongBeaconPowerDirectIn = o[6] ? parseFloat(o[6]) : void 0),
                  (a.GpsCovariance = o[7] ? parseFloat(o[7]) : void 0),
                  (a.LockFloor = !!o[8]),
                  (a.OriOffset = o[9] ? parseFloat(o[9]) : 0),
                  (a.freedom = !0));
              }
              (t.setParameters(a), t.clearSaveSteps());
            }
          }
        }, 1500)));
      ((t.nextCheckGPSTime = Date.now() + 3e4),
        this.isInThisMapCheckInterval && clearInterval(this.isInThisMapCheckInterval),
        (this.isInThisMapCheckInterval = setInterval(function () {
          if (!(Date.now() - t.nextCheckGPSTime < 0 || t.isInThisMap)) {
            if (t.isInThisMapCheck) {
              var e = 0;
              t.longitude && t.latitude; //&& (e = v.distanceToTheMap([t.longitude, t.latitude]));
              var n = (e / 60) * 1e3;
              (n < 15e3 && (n = 15e3), (t.nextCheckGPSTime = Date.now() + n), t.trigger("gps-off"));
            } else (t.trigger("gps-on"), (t.nextCheckGPSTime = Date.now() + 8e3));
            t.isInThisMapCheck = !t.isInThisMapCheck;
          }
        }, 1e3)));
    };
    prototype.setRoute = function (t) {
      this.routeInfo = t;
    };

    prototype.clean = function (force) {
      A.postMessage({
        type: "lc",
        data: {
          clearForce: force,
        },
      });
    };
    // prototype.reset = function () {
    //   thisObject.location = 0;
    //   thisObject.lockRegions = 0;
    //   thisObject.longitude = 0;
    //   thisObject.latitude = 0;
    //   A.postMessage({
    //     "type": "reset",
    //     "data": {
    //       "clearForce": true
    //     }
    //   })
    // }
    prototype.reset = function (loc) {
      if (loc) {
        this.lon = this.longitude = loc["lon"];
        this.lat = this.latitude = loc["lat"];
        if (loc["floorIndex"] != undefined && loc["floorIndex"] != null) {
          A.postMessage({
            type: "ls",
            data: {
              floor: loc["floorIndex"],
              bleinfo: {
                longitude: this.lon,
                latitude: this.lat,
                distanceError: 1,
              },
              timestamp: Date.now(),
            },
          });
        }
      } else {
        thisObject.location = 0;
        thisObject.lockRegions = 0;
        thisObject.longitude = 0;
        thisObject.latitude = 0;
        A.postMessage({
          type: "reset",
          data: { clearForce: true },
        });
      }
    };

    prototype.loadJSONBuildingRSS = function (t) {
      var thisObject = this;
      thisObject.rss = new RSSLocationDetermine(this);
      thisObject.bfd.setDataBase(t);
      thisObject.isInThisMap = !1;
      thisObject.isInThisMapCheck = !0;
      thisObject.realBeaconScanCount = 0;
      // thisObject.checkFreedomRegionAndInThisMapProcedure();
      // thisObject.headingLockProcessingInit();
      A.postMessage({
        type: "lr",
        data: t,
      });
    };
    prototype.loadJSONBuildingBTRSS = function (t) {
      A.postMessage({
        type: "setBuildingData",
        data: t,
      });
    };

    prototype.setGeofenceData = function (t) {
      A.postMessage({
        type: "sgd",
        data: t,
      });
    };

    prototype.getLocation = function () {
      return this.isInThisMap
        ? {
            lng: Number(this.longitude),
            lat: Number(this.latitude),
            bearing: Number(this.processedHeading),
            floor: this.preFloor,
            gps: this.useGPS,
            accuracy: 5.0,
            targetPos: {
              lng: this.targetLon === undefined ? Number(this.longitude) : Number(this.targetLon),
              lat: this.targetLat === undefined ? Number(this.longitude) : Number(this.targetLat),
            },
            lockRange: this.useGPS ? this.param.GpsOutsideLockRange : this.param.lockRange,
          }
        : {
            lng: 0,
            lat: 0,
            bearing: Number(this.processedHeading),
            floor: null,
            gps: this.useGPS,
            accuracy: 0,
            targetPos: {
              lng: 0,
              lat: 0,
            },
            lockRange: this.param.lockRange,
          };
    };

    prototype.checkInDirection = function (t) {
      A.postMessage({
        type: "ld",
        data: Number(t) + 1e-4 + this.freedomOriOffset,
      });
    };

    prototype.getRealBeaconScanCount = function () {
      return this.realBeaconScanCount;
    };

    prototype.checkInScanResult = function (t, callback, timeStamp) {
      var e = this;
      this.handlePathBearing();
      var n = this;
      if (!timeStamp) {
        timeStamp = Date.now();
      }
      if (window.location.search.indexOf("testBleVal=true") != -1) {
        var msg = "</br> 页面蓝牙数量:" + t.length + JSON.stringify(t);

        WXAlert.log(msg, 1, false, true);
      }
      try {
        this.bfd
          .getFloor(t)
          ["then"](function (e) {
            // 定位校验测试
            if (window.location.search.indexOf("testBleVal=true") != -1) {
              var _date = new Date();
              var time = _date.getHours() + ":" + _date.getMinutes() + ":" + _date.getSeconds();
              var msg = time;
              if (t.rawCount) {
                msg += "  原始蓝牙的数: " + t.rawCount;
              }
              msg += "</br> 页面蓝牙数量:" + t.length + " 有效蓝牙数:" + e["filterScanResults"].length + " </br>" + JSON.stringify(e.filterScanResults);
              if (window["stepLength"]) {
                msg += "</br> 步数:" + (window["stepCount"] - 1) + "   步长:" + window["stepLength"];
              }

              WXAlert.log(msg, 1, false, true);
            }

            n.catchBleInfos = e.ble;
            n.filterScanResults = e["filterScanResults"];
            if (
              ((t = e["filterScanResults"]),
              (n.realBeaconScanCount = t.length),
              e &&
                e.suggestSwitchToGPS &&
                n.isInThisMapCheck &&
                (n.longitude && n.latitude ? n.param.MinPowerLevelForGps > -100 && n.trigger("gps-on") : n.trigger("gps-on")),
              e && !e.suggestSwitchToGPS && n.trigger("gps-off"),
              e && e.floor && (!n.longitude || !n.param.LockFloor))
            ) {
              var a = e.floor;
              var diffT = Date.now() - n.changeFloorTime;
              n.preFloor !== a ? console.log("changeFloor diffT:" + diffT) : "";
              //n.processNextFloorInitialLocation(a),
              (n.longitude && diffT < 5e3) || (n.preFloor !== a && ((n.changeFloorTime = Date.now()), n.setFloor(a)), (n.preFloor = a));
            }
          })
          ["then"](function () {
            var diffT = Date.now() - n.changeFloorTime;
            if (n.longitude && diffT < 2e3) {
              console.log("丢弃了", diffT);
            }
            (n.longitude && diffT < 1e3) || n.useGPS || e.checkInFingerPrints(t, timeStamp, callback);
            // if (window.location.search.indexOf("showLocMsg=true") != -1) {
            //     var msg = "Ble:" + t.length + "," + (t.length ? t[0]["id"] : "")
            //     WXAlert.log(msg, 1, false, true);
            // }
          });
      } catch (e) {
        alert(e.toString());
      }
    };

    prototype.checkInGPSData = function (gpsData, timeStamp) {
      var t = {
        clearEngine: false,
        delay: 1000,
        distanceError: gpsData.accuracy,
        longitude: gpsData.longitude,
        latitude: gpsData.latitude,
        traceDirection: 0,
        locType: gpsData.locType || "GPS",
      };
      var a = gpsData.floorIndex !== undefined ? gpsData.floorIndex : 1;
      A.postMessage({
        type: "ls",
        data: {
          floor: a,
          bleinfo: t,
          timeStamp: timeStamp,
          timestamp: timeStamp,
          locType: gpsData.locType || "GPS",
          bdid: gpsData.bdid,
          floorId: gpsData.floorId,
          accuracy: gpsData.accuracy,
        },
      });
      var wxLoc = thisObject.la.locationFramework._providerManager.getProvider("micro");
      if (wxLoc.debugListener && wxLoc.debugListener.length > 0) {
        wxLoc.debugListener[0]({
          type: "fp",
          data: [{ lon: gpsData.longitude, lat: gpsData.latitude, bdid: gpsData.bdid, floorId: gpsData.floorId }],
        });
      }
    };

    prototype.checkInBLEData = function (bleData, timeStamp) {
      // var t = {
      //     "clearEngine" : false,
      //     "delay" : 1000,
      //     "distanceError" : bleData.accuracy,
      //     "longitude": bleData.longitude,
      //     "latitude" : bleData.latitude,
      //     "traceDirection" : 0,
      //     "locType" : "GPS",

      // }

      bleData.bleinfo["locType"] = "BLE";
      A.postMessage({
        type: "ls",
        data: {
          floor: bleData.floor,
          bleinfo: bleData.bleinfo,
          timeStamp: timeStamp,
          locType: "BLE",
          bdid: bleData.bdid,
          floorId: bleData.floorId,
          accuracy: bleData.accuracy,
        },
      });
    };

    prototype.setFloor = function (t) {
      if (this.location) {
        this.lon && t != this.floor
          ? (this.floorChangeProcedure(this.lon, this.lat, 0.5), (this.floor = t))
          : t != this.floor && (this.floorChangeProcedure(), (this.floor = t));
      } else
        this.lon && t != this.floor
          ? (this.floorChangeProcedure(this.lon, this.lat, 0.5), (this.floor = t))
          : t != this.floor && (this.floorChangeProcedure(), (this.floor = t));
    };

    prototype.checkInBearing = function (t) {
      this.routeBearing = {
        time: Date.now(),
        bearing: t + 0.001,
      };
    };

    function postData(url, data, onDataRecive, beforeSend, complete, error) {
      $["ajax"]({
        url: url,
        type: "POST",
        dataType: "json",
        data: JSON.stringify(data),
        contentType: "application/json",
        timeout: 10000,
        beforeSend: beforeSend || function () {},
        complete: complete || function () {},
        success: onDataRecive || function () {},
        error: error || function () {},
      });
    }

    prototype.setBLEPredict = function (b) {
      this.enableBLEPredict = b;
    };
    prototype.dealFingerPrints = function (o, t, callback, timeStamp, i) {
      var e = this,
        n = this,
        a = this.preFloor || this.floor;
      var currTime = new Date().getTime();
      locationLogManager.addData({
        t: 8,
        sendT: timeStamp,
        d: currTime,
        res: t,
      });
      if (t === undefined || t.data === undefined || 0 === t.data.length) {
        return;
      }
      thisObject.lastBleLocatedTime = currTime;

      if (!(currTime - i > 8e3)) {
        var r = currTime - i;
        if (e.projectId == o["projectId"] && t && t.data && 0 != t.data.length) {
          var fingerData = t.data;
          var locationFramework = thisObject.la.locationFramework;
          var configData = locationFramework.getAlgorithm().getConfigData();
          var floorId = configData.locatingMap[o["floor"]];
          var wxLoc = thisObject.la.locationFramework._providerManager.getProvider("micro");
          if (wxLoc.debugListener && wxLoc.debugListener.length > 0) {
            wxLoc.debugListener[0]({
              type: "fp",
              data: fingerData,
              floorId: floorId,
              bdid: e.projectId,
            });
          }
          n.rss.checkInScanResultAndProcess(t.data, e)["then"](function (t) {
            A.postMessage({
              type: "la",
              data: {
                aloneTrace: t.aloneTrace,
                traceDirection: t.traceDirection,
              },
            });
            var maxRssi = -99;
            if (o && o.scanResults && o.scanResults.length > 0) {
              maxRssi = Math.max(o.scanResults[0].rssi, maxRssi);
            }

            if (!thisObject.enableBLEPredict) {
              if (!0 === t.clearEngine) {
                n.clean();
              }

              t.delay = r; // (n.LocType === "BLE"&&t.distanceError > 1e3)
              t.distanceError > 1e3 ||
                0 === t.longitude ||
                0 === t.latitude ||
                (n.longitude && a !== n.preFloor) ||
                (callback &&
                  callback({
                    rawBles: o,
                    fingerData: fingerData,
                    result: {
                      maxRssi: maxRssi,
                      floor: a,
                      bleinfo: t,
                      timestamp: timeStamp || i,
                    },
                  }));
            } else {
              if (!0 === t.clearEngine) {
                n.clean();
              }
              t.delay = r;
              t.distanceError > 1e3 ||
                0 === t.longitude ||
                0 === t.latitude ||
                (n.longitude && a !== n.preFloor) ||
                (A.postMessage({
                  type: "ls",
                  data: {
                    floor: a,
                    bleinfo: t,
                    timestamp: timeStamp || i,
                  },
                }),
                callback &&
                  callback({
                    rawBles: o,
                    fingerData: fingerData,
                    result: {
                      maxRssi: maxRssi,
                      floor: a,
                      bleinfo: t,
                      timestamp: timeStamp || i,
                    },
                  }));
            }
          });
        }
      }
    };

    prototype.checkInFingerPrints = function (t, timeStamp, callback) {
      var e = this,
        n = this,
        a = this.preFloor || this.floor;
      var i = Date.now();

      // 时间过长时清除定位
      if (thisObject.lastBleLocatedTime && i - thisObject.lastBleLocatedTime > 30 * 1000) {
        // khronus modify 30秒后会清除sls。造成pdr推不动
        // n.rss.reset();
      }

      var o = {
        projectId: this.projectId,
        token: this.token,
        scanResults: this.filterScanResults || t,
        floor: a,
        timeStamp: timeStamp,
      };
      o["scanResults"].filter(function (t) {
        return t["rssi"] - 0 < 0;
      });
      o["scanResults"].sort(function (a, b) {
        return b["rssi"] - a["rssi"] > 0 ? 1 : -1;
      });

      if (o["scanResults"].length > 20) {
        o["scanResults"].length = 20;
      }
      if (n.projectId && t.length > 0) {
        locationLogManager.addData({
          t: 15,
          sendT: timeStamp,
          d: new Date().getTime(),
          res: o,
        });
        if (n.bdInfo["offlineLoc"]) {
          n.checkInFingerPrintsCallback = callback;
          A.postMessage({
            type: "fp",
            data: o,
          });
        } else {
          postData(fingerUrl + "fingerprints2", o, function (t) {
            n.dealFingerPrints(o, t, callback, timeStamp, i);
          });
        }
      }
    };
    prototype.checkInLockRegions = function (t) {
      this.lockRegions = t;
    };

    prototype.checkInRealLocation = function (t) {
      this.location = t;
    };

    prototype.checkInOneTraceStep = function (t) {
      if (t && t["timeStamp"]) {
        this.lastTimeStamp = t["timeStamp"];
      }
      var locType = this.la.locationFramework._locationResult && this.la.locationFramework._locationResult.locType;
      if (this.la.locationFramework._routeMatcher._curPolyline) {
        t["stepH"] = this.la.locationFramework.stepH;
        if (locType == "AOA" && this.la.locationFramework.stepHAOA) {
          t["stepH"] = this.la.locationFramework.stepHAOA;
        }
      } else {
        t["stepH"] = this.la.locationFramework.locStepH;
        if (locType == "AOA" && this.la.locationFramework.locStepHAOA) {
          t["stepH"] = this.la.locationFramework.locStepHAOA;
        }
      }

      A.postMessage({
        type: "lt",
        data: t,
      });
    };

    prototype.floorChangeProcedure = function (t, e, n) {
      if (t != undefined && e != undefined) {
        A.postMessage({
          type: "lf",
          data: {
            lon: t,
            lat: e,
            cov: n,
          },
        });
      }
      this.rss && this.rss.clear();
    };

    prototype.processNextFloorInitialLocation = function (t, e, n) {
      var e = this.routeInfo;
      if (((this.lon = 0), (this.lat = 0), e)) {
        var n = 0;
        for (n = 0; n < e.length; n++)
          if (t == e[n].floor) {
            e[n].points.length >= 1
              ? ((this.lon = e[n].points[1][0]), (this.lat = e[n].points[1][1]))
              : 1 == e[n].points.length && ((this.lon = e[n].points[0][0]), (this.lat = e[n].points[0][1]));
            break;
          }
        this.routeInfo = this.routeInfo.splice(0, n);
      }
    };

    prototype.setDefaultParameters = function (t) {
      ((this.defaultParam = {}),
        t || (t = {}),
        t.DefaultMinPowerLevelForGps
          ? (this.defaultParam.DefaultMinPowerLevelForGps = t.DefaultMinPowerLevelForGps)
          : (this.defaultParam.DefaultMinPowerLevelForGps = -100),
        t.DefaultGpsInToOutThreshold
          ? (this.defaultParam.DefaultGpsInToOutThreshold = t.DefaultGpsInToOutThreshold)
          : (this.defaultParam.DefaultGpsInToOutThreshold = 2),
        t.DefaultGpsOutToInThreshold
          ? (this.defaultParam.DefaultGpsOutToInThreshold = t.DefaultGpsOutToInThreshold)
          : (this.defaultParam.DefaultGpsOutToInThreshold = 3),
        this.setParameters());
    };
    prototype.setToDefaultParameters = function (t) {
      ((this.param = {}),
        (this.param.MinPowerLevelForGps = this.defaultParam.DefaultMinPowerLevelForGps),
        (this.param.GpsInToOutThreshold = this.defaultParam.DefaultGpsInToOutThreshold),
        (this.param.GpsOutToInThreshold = this.defaultParam.DefaultGpsOutToInThreshold),
        (this.param.StrongBeaconPowerDirectIn = -70),
        (this.param.GpsAccuracy = 35),
        (this.param.GpsCovariance = 30),
        (this.param.GpsOutsideLockRange = 25),
        (this.param.StepFactor = 1),
        (this.param.freedom = !1),
        (this.param.deadnocking = !1),
        (this.param.LockFloor = !1),
        (this.param.lockRange = void 0),
        (this.param.OriOffset = 0));
    };

    prototype.setParameters = function (t) {
      (this.setToDefaultParameters(),
        t &&
          ((this.param.StrongBeaconPowerDirectIn = t.StrongBeaconPowerDirectIn || this.param.StrongBeaconPowerDirectIn),
          (this.param.GpsAccuracy = t.GpsAccuracy || this.param.GpsAccuracy),
          (this.param.GpsCovariance = t.GpsCovariance || this.param.GpsCovariance),
          (this.param.GpsOutsideLockRange = t.GpsOutsideLockRange || this.param.GpsOutsideLockRange),
          (this.param.lockRange = t.GpsOutsideLockRange),
          this.param.lockRange || (this.param.lockRange = void 0),
          (this.param.StepFactor = t.StepFactor || this.param.StepFactor),
          (this.param.MinPowerLevelForGps = t.MinPowerLevelForGps || this.param.MinPowerLevelForGps),
          (this.param.GpsInToOutThreshold = t.GpsInToOutThreshold || this.param.GpsInToOutThreshold),
          (this.param.GpsOutToInThreshold = t.GpsOutToInThreshold || this.param.GpsOutToInThreshold),
          (this.param.LockFloor = t.LockFloor),
          (this.param.freedom = t.freedom),
          (this.param.OriOffset = t.OriOffset || this.param.OriOffset),
          t.GpsCovariance && (this.param.deadnocking = !0)),
        (this.freedomOriOffset = this.param.OriOffset),
        A.postMessage({
          type: "sp",
          data: this.param,
        }));
    };

    prototype.clearSaveSteps = function (t) {
      A.postMessage({
        type: "cs",
        data: null,
      });
    };
    prototype.updateGPS = function (t) {
      var e = this.gpsOffset && t.latitude ? t.latitude + this.gpsOffset[1] : t.latitude,
        n = this.gpsOffset && t.longitude ? t.longitude + this.gpsOffset[0] : t.longitude;
      A.postMessage({
        type: "gp",
        data: {
          accuracy: t.accuracy,
          latitude: e,
          longitude: n,
        },
      });
    };

    prototype.handlePathBearing = function (t) {
      var t = Date.now() - ((this.routeBearing && this.routeBearing.time) || 0) > 1e3 ? void 0 : this.routeBearing.bearing;
      A.postMessage({
        type: "lan",
        data: {
          naviTraceDirection: t,
        },
      });
    };

    prototype.bearingDiff = function (t) {
      (t > 180 && (t -= 360), t < -180 && (t += 360), e > 180 && (e -= 360), e < -180 && (e += 360));
      var n = Math.abs(t - e);
      return (n > 180 && (n = 360 - n), n > 180 && (n = 360 - n), n);
    };

    prototype.headingLockProcessingInit = function () {
      var t = this;
      (this.headingLockProcess && clearInterval(this.headingLockProcess),
        (this.headingLockProcess = setInterval(function () {
          var e = 0;
          if (
            ((e =
              Date.now() - ((t.routeBearing && t.routeBearing.time) || 0) > 1e3 ||
              !t.routeBearing.bearing ||
              isNaN(t.routeBearing.bearing) ||
              !t.lastStepTimestamp ||
              Date.now() - t.lastStepTimestamp > 3e3
                ? t.direction
                : t.bearingDiff(t.routeBearing.bearing, t.direction) < 45
                  ? t.routeBearing.bearing
                  : t.direction),
            isNaN(t.processedHeading) || void 0 === t.processedHeading)
          )
            t.processedHeading = t.direction;
          else {
            t.processedHeading - e > 180 ? (e += 360) : t.processedHeading - e < -180 && (e -= 360);
            ((t.processedHeading = 0.75 * t.processedHeading + 0.25 * e),
              t.processedHeading >= 360 && (t.processedHeading -= 360),
              t.processedHeading <= 0 && (t.processedHeading += 360));
          }
        }, 60)));
    };
  };
  RSSLocationEngine.prototype = Object.create(EventTrigger.prototype);
  RSSLocationEngine.prototype.constructor = RSSLocationEngine;

  var LocationAlgorithm = function (params, locationFramework) {
    var fingerUrl = (params["ble"] && params["ble"]["serverUrl"]) || "https://map2a.daxicn.com/wx_server/";

    function createWorkerByContent(workerContent) {
      var blob = new Blob([workerContent], {
        type: "text/javascript",
      });
      var blobUrl = URL.createObjectURL(blob);
      var worker = new Worker(blobUrl);
      return worker;
    }
    var token = params["token"] || "";
    var bdid = params["bdid"] || "";
    var thisObject = this;
    thisObject.handler = "";
    thisObject.token = token;
    thisObject.baseURL = "https://map1a.daxicn.com/ol1/";
    thisObject.routeData = null;
    thisObject.worker = null;
    thisObject.buildingData = {};
    thisObject.configData = null;
    thisObject.floorData = null;
    thisObject.loadingData = false;
    thisObject.currentBDID = "";
    thisObject.locationFramework = locationFramework;
    thisObject.locPath = params["locPath"] || window["projectUrl"] || "../";
    thisObject._onLocationUpdateCallback = null;
    var prototype = LocationAlgorithm.prototype;
    prototype.init = function () {
      var thisObject = this;
      var workerContent =
        '!function () {\n\n    function getNow() {\n      return new Date().getTime();\n    }\n    \n    function obj2Arr(obj) {\n      var arr = [];\n      for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n          var d = obj[i];\n          d.mac = i;\n          arr.push(d);\n        }\n      }\n      return arr;\n    }\n    \n    function angleByLngLat(lng1, lat1, lng2, lat2) {\n      return 180.0 / Math.PI * (Math.atan2(\n        (lng2 - lng1) * Math.cos(lat2 / 180.0 * Math.PI), lat2 - lat1));\n    }\n    \n    function sortByKeyDesc(array, key) {\n      return array.sort(function(a, b) {\n        var x = parseFloat(a[key]);\n        var y = parseFloat(b[key]);\n        return ((x < y) ? 1 : ((x > y) ? -1 : 0));\n      });\n    }\n    \n    function sortByKey(array, key) {\n      return array.sort(function(a, b) {\n        var x = parseFloat(a[key]);\n        var y = parseFloat(b[key]);\n        return ((x < y) ? -1 : ((x > y) ? 1 : 0));\n      });\n    }\n    \n    function fingerPrintWeightingAverageCompare(scanResults, mGFP) {\n      var noResult = {\n        lon: 0,\n        lat: 0,\n        count: 0,\n        matchCount: 0,\n        diff: Number.MAX_VALUE\n      };\n      var diff = 0,\n        count = 0,\n        matchCount = 0,\n        p = 2,\n        k = 0;\n      if (mGFP.aps === null || mGFP.aps[0] === undefined || mGFP.aps[0].length === 0) {\n        return noResult;\n      }\n      // console.log(mGFP);\n    \n      for (var i in scanResults) {\n        if (scanResults[i].mac === mGFP.aps[0][0]) {\n          break;\n        }\n        k++;\n        if (k === 3) {\n          break;\n        }\n      }\n      if (k === 3 || scanResults.length === k) {\n        return noResult;\n      }\n      var refPowerScan = -Number.MAX_VALUE,\n        refPowerLocal = -Number.MAX_VALUE,\n        notInFirst = true;\n    \n      for (var i in scanResults) {\n        for (var j in mGFP.aps) {\n          if (scanResults[i].mac === mGFP.aps[j][0]) {\n            if (refPowerScan === -Number.MAX_VALUE) {\n              refPowerScan = scanResults[i].rssi;\n              refPowerLocal = mGFP.aps[j][1];\n              notInFirst = false;\n              break;\n            } else {\n              //var tempwd = mGFP.aps[j][1];\n              //var tempwd = scanResults[i].rssi;\n              var weighting = getWeightingValue(scanResults[i].rssi);\n              var weighting1 = getWeightingValue(mGFP.aps[j][1]);\n              diff += weighting * Math.pow((refPowerScan - scanResults[i].rssi) - (refPowerLocal - mGFP.aps[j][1]), p);\n              count += weighting;\n              matchCount++;\n              break;\n            }\n          }\n          if (j > 3 && notInFirst) {\n            break;\n          }\n        }\n        if (refPowerScan === -Number.MAX_VALUE)\n          break;\n      }\n      var diff1;\n      if (count === 0) {\n        diff1 = Number.MAX_VALUE;\n      } else {\n        diff1 = Math.pow(diff / count, 1 / p);\n        if (diff1 === 0)\n          diff1 = 0.0001;\n      }\n      return {\n        lon: parseFloat(mGFP.lon),\n        lat: parseFloat(mGFP.lat),\n        count: count,\n        matchCount: matchCount,\n        diff: diff1\n      }\n    \n    }\n    \n    function getWeightingValue(power) {\n      var weighting = Number.MAX_VALUE;\n    \n      if (power >= -110 && power <= -109.375)\n        weighting = 10;\n      else if (power > -109.375 && power <= -108.75)\n        weighting = 11.25;\n      else if (power > -108.75 && power <= -108.125)\n        weighting = 12.5;\n      else if (power > -108.125 && power <= -107.5)\n        weighting = 13.75;\n      else if (power > -107.5 && power <= -106.875)\n        weighting = 15;\n      else if (power > -106.875 && power <= -106.25)\n        weighting = 16.25;\n      else if (power > -106.25 && power <= -105.625)\n        weighting = 17.5;\n      else if (power > -105.625 && power <= -105)\n        weighting = 18.75;\n      else if (power > -105 && power <= -104.375)\n        weighting = 20;\n      else if (power > -104.375 && power <= -103.75)\n        weighting = 21.25;\n      else if (power > -103.75 && power <= -103.125)\n        weighting = 22.5;\n      else if (power > -103.125 && power <= -102.5)\n        weighting = 23.75;\n      else if (power > -102.5 && power <= -101.875)\n        weighting = 25;\n      else if (power > -101.875 && power <= -101.25)\n        weighting = 26.25;\n      else if (power > -101.25 && power <= -100.625)\n        weighting = 27.5;\n      else if (power > -100.625 && power <= -100)\n        weighting = 28.75;\n      else if (power > -100 && power <= -99.375)\n        weighting = 30;\n      else if (power > -99.375 && power <= -98.75)\n        weighting = 31.25;\n      else if (power > -98.75 && power <= -98.125)\n        weighting = 32.5;\n      else if (power > -98.125 && power <= -97.5)\n        weighting = 33.75;\n      else if (power > -97.5 && power <= -96.875)\n        weighting = 35;\n      else if (power > -96.875 && power <= -96.25)\n        weighting = 36.25;\n      else if (power > -96.25 && power <= -95.625)\n        weighting = 37.5;\n      else if (power > -95.625 && power <= -95)\n        weighting = 38.75;\n      else if (power > -95 && power <= -94.375)\n        weighting = 40;\n      else if (power > -94.375 && power <= -93.75)\n        weighting = 41.25;\n      else if (power > -93.75 && power <= -93.125)\n        weighting = 42.5;\n      else if (power > -93.125 && power <= -92.5)\n        weighting = 43.75;\n      else if (power > -92.5 && power <= -91.875)\n        weighting = 45;\n      else if (power > -91.875 && power <= -91.25)\n        weighting = 46.25;\n      else if (power > -91.25 && power <= -90.625)\n        weighting = 47.5;\n      else if (power > -90.625 && power <= -90)\n        weighting = 48.75;\n      else if (power > -90 && power <= -89.375)\n        weighting = 50;\n      else if (power > -89.375 && power <= -88.75)\n        weighting = 51.25;\n      else if (power > -88.75 && power <= -88.125)\n        weighting = 52.5;\n      else if (power > -88.125 && power <= -87.5)\n        weighting = 53.75;\n      else if (power > -87.5 && power <= -86.875)\n        weighting = 55;\n      else if (power > -86.875 && power <= -86.25)\n        weighting = 56.25;\n      else if (power > -86.25 && power <= -85.625)\n        weighting = 57.5;\n      else if (power > -85.625 && power <= -85)\n        weighting = 58.75;\n      else if (power > -85 && power <= -84.375)\n        weighting = 60;\n      else if (power > -84.375 && power <= -83.75)\n        weighting = 61.25;\n      else if (power > -83.75 && power <= -83.125)\n        weighting = 62.5;\n      else if (power > -83.125 && power <= -82.5)\n        weighting = 63.75;\n      else if (power > -82.5 && power <= -81.875)\n        weighting = 65;\n      else if (power > -81.875 && power <= -81.25)\n        weighting = 66.25;\n      else if (power > -81.25 && power <= -80.625)\n        weighting = 67.5;\n      else if (power > -80.625 && power <= -80)\n        weighting = 68.75;\n      else if (power > -80 && power <= -79.375)\n        weighting = 70;\n      else if (power > -79.375 && power <= -78.75)\n        weighting = 71.25;\n      else if (power > -78.75 && power <= -78.125)\n        weighting = 72.5;\n      else if (power > -78.125 && power <= -77.5)\n        weighting = 73.75;\n      else if (power > -77.5 && power <= -76.875)\n        weighting = 75;\n      else if (power > -76.875 && power <= -76.25)\n        weighting = 76.25;\n      else if (power > -76.25 && power <= -75.625)\n        weighting = 77.5;\n      else if (power > -75.625 && power <= -75)\n        weighting = 78.75;\n      else if (power > -75 && power <= -74.375)\n        weighting = 80;\n      else if (power > -74.375 && power <= -73.75)\n        weighting = 81.25;\n      else if (power > -73.75 && power <= -73.125)\n        weighting = 82.5;\n      else if (power > -73.125 && power <= -72.5)\n        weighting = 83.75;\n      else if (power > -72.5 && power <= -71.875)\n        weighting = 85;\n      else if (power > -71.875 && power <= -71.25)\n        weighting = 86.25;\n      else if (power > -71.25 && power <= -70.625)\n        weighting = 87.5;\n      else if (power > -70.625 && power <= -70)\n        weighting = 88.75;\n      else if (power > -70 && power <= -69.375)\n        weighting = 90;\n      else if (power > -69.375 && power <= -68.75)\n        weighting = 91.25;\n      else if (power > -68.75 && power <= -68.125)\n        weighting = 92.5;\n      else if (power > -68.125 && power <= -67.5)\n        weighting = 93.75;\n      else if (power > -67.5 && power <= -66.875)\n        weighting = 95;\n      else if (power > -66.875 && power <= -66.25)\n        weighting = 96.25;\n      else if (power > -66.25 && power <= -65.625)\n        weighting = 97.5;\n      else if (power > -65.625 && power <= -65)\n        weighting = 98.75;\n      else if (power > -65 && power <= -64.375)\n        weighting = 100;\n      else if (power > -64.375 && power <= -63.75)\n        weighting = 101.25;\n      else if (power > -63.75 && power <= -63.125)\n        weighting = 102.5;\n      else if (power > -63.125 && power <= -62.5)\n        weighting = 103.75;\n      else if (power > -62.5 && power <= -61.875)\n        weighting = 105;\n      else if (power > -61.875 && power <= -61.25)\n        weighting = 106.25;\n      else if (power > -61.25 && power <= -60.625)\n        weighting = 107.5;\n      else if (power > -60.625 && power <= -60)\n        weighting = 108.75;\n      else if (power > -60 && power <= -59.375)\n        weighting = 110;\n      else if (power > -59.375 && power <= -58.75)\n        weighting = 111.25;\n      else if (power > -58.75 && power <= -58.125)\n        weighting = 112.5;\n      else if (power > -58.125 && power <= -57.5)\n        weighting = 113.75;\n      else if (power > -57.5 && power <= -56.875)\n        weighting = 115;\n      else if (power > -56.875 && power <= -56.25)\n        weighting = 116.25;\n      else if (power > -56.25 && power <= -55.625)\n        weighting = 117.5;\n      else if (power > -55.625 && power <= -55)\n        weighting = 118.75;\n      else if (power > -55 && power <= -54.375)\n        weighting = 120;\n      else if (power > -54.375 && power <= -53.75)\n        weighting = 121.25;\n      else if (power > -53.75 && power <= -53.125)\n        weighting = 122.5;\n      else if (power > -53.125 && power <= -52.5)\n        weighting = 123.75;\n      else if (power > -52.5 && power <= -51.875)\n        weighting = 125;\n      else if (power > -51.875 && power <= -51.25)\n        weighting = 126.25;\n      else if (power > -51.25 && power <= -50.625)\n        weighting = 127.5;\n      else if (power > -50.625 && power <= -50)\n        weighting = 128.75;\n      else if (power > -50 && power <= -49.375)\n        weighting = 130;\n      else if (power > -49.375 && power <= -48.75)\n        weighting = 131.25;\n      else if (power > -48.75 && power <= -48.125)\n        weighting = 132.5;\n      else if (power > -48.125 && power <= -47.5)\n        weighting = 133.75;\n      else if (power > -47.5 && power <= -46.875)\n        weighting = 135;\n      else if (power > -46.875 && power <= -46.25)\n        weighting = 136.25;\n      else if (power > -46.25 && power <= -45.625)\n        weighting = 137.5;\n      else if (power > -45.625 && power <= -45)\n        weighting = 138.75;\n      else if (power > -45 && power <= -44.375)\n        weighting = 140;\n      else if (power > -44.375 && power <= -43.75)\n        weighting = 141.25;\n      else if (power > -43.75 && power <= -43.125)\n        weighting = 142.5;\n      else if (power > -43.125 && power <= -42.5)\n        weighting = 143.75;\n      else if (power > -42.5 && power <= -41.875)\n        weighting = 145;\n      else if (power > -41.875 && power <= -41.25)\n        weighting = 146.25;\n      else if (power > -41.25 && power <= -40.625)\n        weighting = 147.5;\n      else if (power > -40.625 && power <= -40)\n        weighting = 148.75;\n      else if (power > -40 && power <= -39.375)\n        weighting = 150;\n      else if (power > -39.375 && power <= -38.75)\n        weighting = 151.25;\n      else if (power > -38.75 && power <= -38.125)\n        weighting = 152.5;\n      else if (power > -38.125 && power <= -37.5)\n        weighting = 153.75;\n      else if (power > -37.5 && power <= -36.875)\n        weighting = 155;\n      else if (power > -36.875 && power <= -36.25)\n        weighting = 156.25;\n      else if (power > -36.25 && power <= -35.625)\n        weighting = 157.5;\n      else if (power > -35.625 && power <= -35)\n        weighting = 158.75;\n      else if (power > -35 && power <= -34.375)\n        weighting = 160;\n      else if (power > -34.375 && power <= -33.75)\n        weighting = 161.25;\n      else if (power > -33.75 && power <= -33.125)\n        weighting = 162.5;\n      else if (power > -33.125 && power <= -32.5)\n        weighting = 163.75;\n      else if (power > -32.5 && power <= -31.875)\n        weighting = 165;\n      else if (power > -31.875 && power <= -31.25)\n        weighting = 166.25;\n      else if (power > -31.25 && power <= -30.625)\n        weighting = 167.5;\n      else if (power > -30.625 && power <= -30)\n        weighting = 168.75;\n      else if (power > -30 && power <= -29.375)\n        weighting = 170;\n      else if (power > -29.375 && power <= -28.75)\n        weighting = 171.25;\n      else if (power > -28.75 && power <= -28.125)\n        weighting = 172.5;\n      else if (power > -28.125 && power <= -27.5)\n        weighting = 173.75;\n      else if (power > -27.5 && power <= -26.875)\n        weighting = 175;\n      else if (power > -26.875 && power <= -26.25)\n        weighting = 176.25;\n      else if (power > -26.25 && power <= -25.625)\n        weighting = 177.5;\n      else if (power > -25.625 && power <= -25)\n        weighting = 178.75;\n      else if (power > -25 && power <= -24.375)\n        weighting = 180;\n      else if (power > -24.375 && power <= -23.75)\n        weighting = 181.25;\n      else if (power > -23.75 && power <= -23.125)\n        weighting = 182.5;\n      else if (power > -23.125 && power <= -22.5)\n        weighting = 183.75;\n      else if (power > -22.5 && power <= -21.875)\n        weighting = 185;\n      else if (power > -21.875 && power <= -21.25)\n        weighting = 186.25;\n      else if (power > -21.25 && power <= -20.625)\n        weighting = 187.5;\n      else if (power > -20.625 && power <= -20)\n        weighting = 188.75;\n      else if (power > -20 && power <= -19.375)\n        weighting = 190;\n      else if (power > -19.375 && power <= -18.75)\n        weighting = 191.25;\n      else if (power > -18.75 && power <= -18.125)\n        weighting = 192.5;\n      else if (power > -18.125 && power <= -17.5)\n        weighting = 193.75;\n      else if (power > -17.5 && power <= -16.875)\n        weighting = 195;\n      else if (power > -16.875 && power <= -16.25)\n        weighting = 196.25;\n      else if (power > -16.25 && power <= -15.625)\n        weighting = 197.5;\n      else if (power > -15.625 && power <= -15)\n        weighting = 198.75;\n      else if (power > -15 && power <= -14.375)\n        weighting = 200;\n      else if (power > -14.375 && power <= -13.75)\n        weighting = 201.25;\n      else if (power > -13.75 && power <= -13.125)\n        weighting = 202.5;\n      else if (power > -13.125 && power <= -12.5)\n        weighting = 203.75;\n      else if (power > -12.5 && power <= -11.875)\n        weighting = 205;\n      else if (power > -11.875 && power <= -11.25)\n        weighting = 206.25;\n      else if (power > -11.25 && power <= -10.625)\n        weighting = 207.5;\n      else if (power > -10.625 && power <= -10)\n        weighting = 208.75;\n      else if (power > -10)\n        weighting = 210;\n    \n      return weighting;\n    }\n    \n    \n    \n    var RSSLocationEngine = function(){\n      var thisObject = this;\n      thisObject.buildingMaps = {};\n      // thisObject.setDataBase = function(btrss){\n      //   thisObject.database = btrss;\n      // }\n    \n      RSSLocationEngine.prototype.setBuildingData = function(params){\n        // console.log(key);\n        let key = params["bdid"];\n        let btrssData = params["btrssData"];\n        let floorData = params["floorData"];\n        var thisObject = this;\n    \n        var building = thisObject.buildingMaps[key];\n        if(!building){\n          if(btrssData && floorData){\n            building = {};\n            building.btrssData = btrssData;\n            building.locatingMap = floorData.locatingMap;\n            console.log(building.locatingMap);\n            thisObject.buildingMaps[key] = building;\n          }else{\n            return undefined;\n          }\n        }\n\n        return building;\n      }\n      RSSLocationEngine.prototype.getBuildingById = function(key){\n        var thisObject = this;\n        var building = thisObject.buildingMaps[key];\n        return building;\n      }\n      RSSLocationEngine.prototype.delBuildingById = function(bdid){\n        var thisObject = this;\n        \n        if(thisObject.buildingMaps[bdid]){\n          delete thisObject.buildingMaps[bdid];\n          console.log("del delBuildingById",bdid);\n        }\n      }\n    \n      RSSLocationEngine.prototype.getPossibleFingerPrintList= function(param) {\n        var data = this.getBuildingById(param.projectId)\n        if(data){\n          return this.getPossibleFingerPrintListInner(data, param)\n        }\n        return undefined;\n      }\n    \n      RSSLocationEngine.prototype.getPossibleFingerPrintListInner= function(database, param) {\n        var _this = this;\n        var fingerpintList = [];\n    \n        //var floor = parseInt(param.floor) -1;\n        var floor = database.locatingMap[param.floor];//parseInt(param.floor) -1;\n        \n        if(floor===undefined){\n          return [];\n        }\n        var scanResults = param.scanResults;\n        function getTraceAngle(mGFPList){\n          var traceAngle = 0;\n          if(mGFPList.length < 2){\n               return traceAngle;\n          }\n          var startNodeLon = mGFPList[0].lon;\n          var startNodeLat = mGFPList[0].lat;\n          var endNodeLon = mGFPList[mGFPList.length - 1].lon;\n          var endNodeLat = mGFPList[mGFPList.length - 1].lat;\n          traceAngle = angleByLngLat(startNodeLon, startNodeLat, endNodeLon, endNodeLat);\n          return traceAngle;\n        }\n    \n        // console.log(scanResults);\n        for (var i in scanResults) {\n          scanResults[i].mac  = scanResults[i].id; \n        }\n        database.btrssData[floor].btrss.forEach(function(mGFPList) {\n          mGFPList.forEach(function(mGFP) {\n            var fpi = fingerPrintWeightingAverageCompare(scanResults, mGFP);\n            if (fpi.lon !== 0 && fpi.diff !== Number.MAX_VALUE) {\n              fpi.traceAngle = getTraceAngle(mGFPList);\n     \n              fingerpintList.push(fpi);\n            }\n          });\n    \n        });\n        var sortList = sortByKey(fingerpintList, "diff");\n        sortList = sortList.slice(0,10);\n        \n        return sortList;\n      }\n      return thisObject;\n    }\n    \n    \n    "function" != typeof Object.assign && (Object.assign = function (t) {\n        if (null == t) {\n            throw new TypeError("Cannot convert undefined or null to object")\n        }\n        for (var e = Object(t), a = 1; a < arguments.length; a++) {\n            var i = arguments[a];\n            if (null != i) {\n                for (var n in i) {\n                    i.hasOwnProperty(n) && (e[n] = i[n])\n                }\n            }\n        }\n        return e\n    });\n    let locationEngine = new RSSLocationEngine();\n\n    var GeofenceConfigObject = function () {\n        var thisObject = this;\n        thisObject.buidingData = null;\n        thisObject.configSet = null;\n        var proto = GeofenceConfigObject.prototype;\n\n        var pointInPolygon = function (pos, polygon) {\n            var inside = false;\n            var polygonSize = polygon.length;\n            var val1, val2\n            for (var i = 0; i < polygonSize; i++) {\n                var p1 = polygon[(i + polygonSize) % polygonSize];\n                var p2 = polygon[(i + 1 + polygonSize) % polygonSize];\n                if (pos[1] < p2[1]) {\n                    if (pos[1] >= p1[1]) {\n                        val1 = (pos[1] - p1[1]) * (p2[0] - p1[0]);\n                        val2 = (pos[0] - p1[0]) * (p2[1] - p1[1]);\n                        if (val1 > val2) {\n                            inside = !inside;\n                        }\n                    }\n                } else if (pos[1] < p1[1]) {\n                    val1 = (pos[1] - p1[1]) * (p2[0] - p1[0]);\n                    val2 = (pos[0] - p1[0]) * (p2[1] - p1[1]);\n                    if (val1 < val2) {\n                        inside = !inside;\n                    }\n                }\n            }\n            return inside;\n        }\n        proto.getGeofencesByPoint = function (lng, lat, z) {\n            var thisObject = this;\n            if(!thisObject.buidingData){\n                return null;\n            }\n            var floorObject = thisObject.buidingData[z];\n            if (!floorObject) return null;\n            var ret = null;\n            var features = floorObject["features"];\n            var featuresCount = features.length;\n            if (featuresCount === 0) {\n                return null;\n            }\n            var position = [lng, lat];\n            for (var i = 0; i < featuresCount; i++) {\n                var feature = features[i];\n                //GeofenceType type = geofence->type;\n                if (pointInPolygon(position, feature["geometry"]["coordinates"][0])) {\n                    ret = feature;\n                    break;\n                }\n            }\n            return ret;\n        }\n    }\n    var geofenceConfigObj = new GeofenceConfigObject();\n    var\n       /* I = 30,//10\n        BigRangeCount = 6,//3,\n        SmallObserveRadius = 15,//5\n        ToleranceCount = 10,//5,*/\n\n        I = 10,\n        BigRangeCount = 3,\n        SmallObserveRadius = 5,\n        ToleranceCount = 5,\n        r = postMessage,\n        D = {},\n        s = !1,\n        n = 0,\n        l = [];\n\n    function t() {\n        Object.assign(this, {\n            clc: 0,\n            ctgg: null,\n            ff: !1,\n            pcs: !1,\n            obr: I,\n            elg: !1,\n            isDirectIntoSmallLocating: !1,\n            snc: 0\n        })\n    }\n    t.prototype = {\n        c: function () {\n            this.clc = 0, this.ctgg = null, this.ff = !1, this.pcs = !1, this.obr = I, this.elg = !1, this.snc = 0\n        },\n        cip: function (t, e) {\n            var a = this;\n            this.el = e;\n            var i = t,\n                n = [],\n                o = [];\n            for (var c in this.el.longitude && this.el.latitude && (i = i.filter(function (t) {\n                    return t.diff < 1000\n                })), \n                a.el.longitude && D.deadnocking && (a.clc = BigRangeCount,\n                 a.obr = I), \n                 a.isDirectIntoSmallLocating && (a.clc = ToleranceCount, \n                 a.isDirectIntoSmallLocating = !1), i) {\n                var r = i[c],\n                    s = P(a.el.longitude, a.el.latitude, r.lon, r.lat),\n                    l = {\n                        lon: r.lon,\n                        lat: r.lat\n                    };\n                if (a.el.longitude && a.el.latitude ? a.clc <= BigRangeCount ? (n.push(l),\n                 o.push(r)) : s <= a.obr && (n.push(l), \n                 o.push(r)) : (n.push(l), \n                 o.push(r)), 4 == c) {\n                    break\n                }\n            }\n            var h = !1,\n                u = {\n                    distanceError: 3000,\n                    traceDirection: 0\n                },\n                g = 0,\n                d = 0,\n                f = 0,\n                v = 10000,\n                p = null,\n                S = null;\n            if (0 !== o.length) {\n                if (2 <= o.length) {\n                    var b = 0,\n                        M = 0,\n                        m = 0,\n                        L = 10000,\n                        T = 10000,\n                        _ = 0;\n                    for (var E in o) {\n                        b = o[E].lon, M = o[E].lat, o.forEach(function (t) {\n                            m += Math.pow(P(b, M, t.lon, t.lat), 2)\n                        }), m < L ? (T = L, L = m, _ = E) : m < T && (T = m), m = 0\n                    }\n                    v = Math.sqrt(L / (o.length - 1)), o.forEach(function (t) {\n                        Number(t.lon), Number(t.lat)\n                    }), \n                    0 != o[_].mc && (g = o[_].lon, d = o[_].lat, f = o[_].traceAngle, a.el.blelon = g, a.el.blelat = d, p = o[_].bfp, S = o[_].btr, h = !0)\n                } else {\n                    g = o[0].lon, d = o[0].lat, f = o[0].traceAngle, a.el.blelon = g, a.el.blelat = d, p = o[0].bfp, S = o[0].btr, h = !(v = 0)\n                }\n            }\n            g && d && 0 !== g && 0 !== d ? P(g, d, a.el.longitude, a.el.latitude) < k && (u.aloneTrace = !0,\n            u.traceDirection = f) : u.aloneTrace = !1;\n            return a.clc <= BigRangeCount && (0 === a.clc ? v < 1000 && (u.distanceError = 0.5, u.longitude = g, u.latitude = d, u.lfg = p, this.ctgg = S, u.clearEngine = !0, a.ff = !0) : v < 10 ? (u.distanceError = 1, u.longitude = g, u.latitude = d, u.lfg = p, a.ctgg = S, 1 === this.clc && (u.clearEngine = !0), a.pcs = !0, a.clc = BigRangeCount) : a.pcs, BigRangeCount == a.clc && (a.pcs ? (a.obr = I, a.pcs = !1) : (a.clc = -1, a.ff = !1))), BigRangeCount < a.clc && (a.clc, BigRangeCount + 2 == a.clc && (a.clc = BigRangeCount + 1), h && v < 2 * a.obr || a.el.headingBegin && v < 10 ? (a.el.headingBegin ? u.distanceError = 40 : u.distanceError = 3, u.longitude = g, u.latitude = d, u.lfg = p, a.ctgg = S, a.elg && (a.el.headingBegin ? a.obr = SmallObserveRadius : a.obr = I, a.snc = 0, a.elg = !1)) : h || (a.elg = !0, a.snc++, a.obr++, 5 < a.snc && (u.clearEngine = !0, a.snc = 0, a.el.headingBegin ? a.obr = SmallObserveRadius : a.obr = I, a.elg = !1, a.clc = -1, a.ff = !1), u.distanceError = 3000, u.longitude = a.el.longitude, u.latitude = a.el.latitude)), a.clc++, u\n        }\n    };\n    Number.MAX_VALUE;\n    var k = 10,\n        g = 1,\n        e = 0.965,\n        h = !1,\n        o = 0;\n\n    function a(t) {\n        t && (this.rss = t), this.c()\n    }\n\n    function i(t) {\n        t && this.sdb(t), this.FDI = null, this.lst = 0, this.floorData = {}, this.sb = [], this.bleData = {}\n    }\n\n    function u(t, n) {\n        return t.sort(function (t, e) {\n            var a = parseFloat(t[n]),\n                i = parseFloat(e[n]);\n            return a < i ? 1 : i < a ? -1 : 0\n        })\n    }\n\n    function P(t, e, a, i) {\n        e *= Math.PI / 180, i *= Math.PI / 180, t *= Math.PI / 180;\n        for (var n = 6378137, o = 6356752.3142, c = (n - o) / n, r = (a *= Math.PI / 180) - t, s = 0, l = Math.atan((1 - c) * Math.tan(e)), h = Math.atan((1 - c) * Math.tan(i)), u = Math.cos(l), g = Math.cos(h), d = Math.sin(l), f = Math.sin(h), v = u * g, p = d * f, S = 0, b = 0, M = 0, m = 0, L = 0, T = 0, _ = 0, E = 0, I = r, D = 0; D < 20; D++) {\n            var k = I;\n            _ = Math.cos(I);\n            var P = g * (E = Math.sin(I)),\n                G = u * f - d * g * _,\n                O = P * P + G * G;\n            L = p + v * _;\n            var F = 0 == (T = Math.sqrt(O)) ? 0 : v * E / T,\n                B = 0.006739496756586903 * (M = 1 - F * F);\n            s = 1 + B / 16384 * (4096 + B * (B * (320 - 175 * B) - 768));\n            var A = B / 1024 * (256 + B * (B * (74 - 47 * B) - 128)),\n                w = c / 16 * M * (4 + c * (4 - 3 * M)),\n                y = (m = 0 == M ? 0 : L - 2 * p / M) * m;\n            b = A * T * (m + A / 4 * (L * (2 * y - 1) - A / 6 * m * (4 * T * T - 3) * (4 * y - 3)));\n            var R = ((I = r + (1 - w) * c * F * ((S = Math.atan2(T, L)) + w * T * (m + w * L * (2 * m * m - 1)))) - k) / I;\n            if (Math.abs(R) < 1e-12) {\n                break\n            }\n        }\n        return o * s * (S - b)\n    }\n    a.prototype = {\n        c: function (force) {\n            if(force){\n                this.longitude = 0;\n                this.latitude = 0;\n                this.tlt = 0;\n                this.tln = 0;\n            }\n            this.longitude = this.longitude || 0,\n            this.latitude = this.latitude || 0,\n            this.locType = "";\n            this.tlt = this.tlt||0,\n            this.tln = this.tln||0,\n            this.lonAvg = 0,\n            this.latAvg = 0,\n            this.direction = 0,\n            this.cac = null,\n            this.headingBegin = !0,\n            this.cf = "na",\n            this.sls = [],\n            this.lts = 0,\n            this.traceDirection = 0,\n            this.totalLength = 0,\n            this.aloneTrace = !1, this.naviTraceDirection = void 0, h = !1\n        },\n        setParameters: function () {\n            g = D.StepFactor ? D.StepFactor : 1\n        },\n        fcc: function (t, e, a) {\n            this.sls = [], this.longitude = t || 0, this.latitude = e || 0, this.tlt = e || 0, this.tln = t || 0, this.lonAvg = t || 0, this.latAvg = e || 0, this.cac = a || null, this.rss && (a ? this.rss.isDirectIntoSmallLocating = !0 : this.rss.c())\n        },\n        cjb: function () {\n            this.tst();\n            var t = this;\n            clearInterval(this.stepInterval);\n            this.stepInterval = setInterval(function () {\n                t.tlt && t.tln && (t.longitude && t.latitude || (t.longitude = t.tln, t.latitude = t.tlt), t.latitude = e * t.latitude + (1 - e) * t.tlt, t.longitude = e * t.longitude + (1 - e) * t.tln);\n            }, 40);\n            clearInterval(this.locInterval);\n            this.locInterval = setInterval(function () {\n                if(t.longitude && t.latitude){\n                    r({\n                        type: "data",\n                        data: {\n                            floor: t.floor,\n                            floorId:t.floorId,\n                            longitude: t.longitude,\n                            latitude: t.latitude,\n                            direction: t.direction,\n                            useGPS: s,\n                            speed: t.speed,\n                            locType : t.locType,\n                            sls:t.sls,\n                            stepCount:t.currStepCount,\n                            stepLength:t.currStepLength,\n                            timeStamp:t.bleinfoTime\n                        }\n                    })\n                }\n\n            }, 500), h = !1, o = 0\n        },\n        glt: function () {\n            return r({\n                type: "getLocation",\n                data: {\n                    lng: this.longitude - 0,\n                    lat: this.latitude - 0,\n                    bearing: this.direction - 0,\n                    floor: this.floor\n                }\n            }), {\n                lng: this.longitude - 0,\n                lat: this.latitude - 0,\n                bearing: this.direction - 0,\n                floor: this.floor\n            }\n        },\n        cid: function (t) {\n            this.direction = t\n        },\n        cis: function (t) {\n            this.bdid = t.bdid,\n            this.floor = t.floor,\n            this.floorId = t.floorId,\n            this.cf = this.floor, \n            this.lonAvg = t.bleinfo.longitude, \n            this.latAvg = t.bleinfo.latitude, \n            this.locType = t.bleinfo.locType,\n            this.bleinfoTime = t.timeStamp;\n            D.deadnocking && (t.bleinfo.distanceError = 100);\n            var e = void 0 === t.bleinfo.delay ? 2500 : t.bleinfo.delay + 2500;\n            h && s || this.clts((new Date).getTime() - e, this.latAvg, this.lonAvg, t.bleinfo.distanceError)\n        },\n        clts: function (t, e, a, i) {\n            var n = this;\n            if (null == this.cac) {\n                return this.tlt = e, this.tln = a, this.latitude = e, this.longitude = a, void(this.cac = i);\n            }\n            var o = this.fct(t),\n                c = !1;\n            if (0 < this.sls.length && t > this.sls[this.sls.length - 1].timestamp && (c = !0), null == o && (c = !0), c) {\n                return this.tlt = i / (this.cac + i) * this.tlt + this.cac / (this.cac + i) * e, this.tln = i / (this.cac + i) * this.tln + this.cac / (this.cac + i) * a, void(this.cac = this.cac * i / (this.cac + i));\n            }\n            var r = !1,\n                s = null,\n                l = null;\n            this.sls.forEach(function (t) {\n                r && (t.lon = s.longitude, t.lat = s.latitude, t.cac = l.cac + 0.5, s = n.csot(t), l = t), (t === o || r) && t === o && (r = !0, t.lat = i / (t.cac + i) * t.lat + t.cac / (t.cac + i) * e, t.lon = i / (t.cac + i) * t.lon + t.cac / (t.cac + i) * a, t.cac = t.cac * i / (t.cac + i), s = n.csot(t), l = t)\n            });\n            null !== s && (this.tlt = s.latitude, this.tln = s.longitude, this.cac = l.cac);\n        },\n        csot: function (t) {\n            var e = 6378137,\n                a = t.stepLength,\n                i = t.direction * Math.PI / 180,\n                n = t.lat * Math.PI / 180,\n                o = t.lon * Math.PI / 180,\n                c = Math.asin(Math.sin(n) * Math.cos(a / e) + Math.cos(n) * Math.cos(i) * Math.sin(a / e)),\n                r = o + Math.atan2(Math.cos(n) * Math.sin(i) * Math.sin(a / e), Math.cos(a / e) - Math.sin(n) * Math.sin(c));\n            return c = 180 * c / Math.PI, {\n                longitude: r = 180 * r / Math.PI,\n                latitude: c\n            }\n        },\n        fct: function (a) {\n            var i = Number.MAX_VALUE,\n                n = null;\n            return this.sls.forEach(function (t) {\n                var e = Math.abs(a - t.timestamp);\n                e < i && (n = t, i = e)\n            }), n\n        },\n        g:function (deg){\n            var rad = deg/180*Math.PI;\n            return 0.97803185*(1+0.005278895*Math.pow(Math.sin(rad),2)+0.000023461*Math.pow(Math.sin(rad),4));\n        },\n        cios : function(data){\n            D.deadnocking && (this.cac = BigRangeCount);\n            this.ftn2 = data["timeStamp"]||(new Date).getTime();\n            if(!this.ftn1){\n                this.ftn1 = this.ftn2 - 600;\n            }\n            // var t = 1000 / (this.ftn2 - (this.ftn1 || 0));\n            // var e = 2.6 * g * (1.7 * (4.5 * t + 10) - 5.84071 + 0); //* (this.cosLat ||0.8660254037844387); //0.93\n            // e /= 100;\n            var a = this.g(this.tlt);\n            var t = 1000 / (this.ftn2 - (this.ftn1 || 0)),\n            e = (2.6 * g * ((data["stepH"]||1.7) * (4.5 * t + 10) - 5.84071 + 0) * (a ||0.93))/100;\n            this.totalLength += e; \n            this.ftn1 = this.ftn2;\n            if(null !== this.cac) {\n                var a = this.direction;\n                if (180 < a && (a -= 360), this.aloneTrace && this.traceDirection || void 0 !== this.naviTraceDirection) {\n                    var i;\n                    if(void 0 !== this.naviTraceDirection){\n                        i = this.naviTraceDirection;\n                    }else{\n                        i = this.traceDirection;\n                    }\n                    u(a, i) < 45 ? a = i : (0 < i && (i -= 360), u(a, i += 180) < 45 && (a = i))\n                }\n                this.lts = this.ftn2;//(new Date).getTime();\n                var n = {\n                    timestamp: this.lts,\n                    lon: this.tln,\n                    lat: this.tlt,\n                    direction: a,\n                    stepLength: e,\n                    speed:e*t,\n                    cac: this.cac\n                };\n                this.currStepLength = e;\n                this.currStepCount = data["step"];\n                // console.log("currStepLength:" + this.currStepLength + ",step:" + this.currStepCount + ",totalLength:" + this.totalLength);\n                // r({\n                //     type: "step",\n                //     data: {\n                //         stepCount:data["step"],\n                //         timestamp: this.lts,\n                //         stepLength: e\n                //     }\n                // })\n                this.speed = n.speed;\n                this.sls.push(n);\n                if(40 < this.sls.length){\n                  this.sls = this.sls.slice(1)\n                }\n                var o = 6378137,\n                    c = a * Math.PI / 180,\n                    r = this.tlt * Math.PI / 180,\n                    s = this.tln * Math.PI / 180,\n                    l = Math.asin(Math.sin(r) * Math.cos(e / o) + Math.cos(r) * Math.cos(c) * Math.sin(e / o)),\n                    h = s + Math.atan2(Math.cos(r) * Math.sin(c) * Math.sin(e / o), Math.cos(e / o) - Math.sin(r) * Math.sin(l));\n                var tln =  180 * h / Math.PI;\n                var tlt = 180 * l / Math.PI;\n                var geofence = geofenceConfigObj.getGeofencesByPoint(tln,tlt,this.floorId);\n                if(geofenceConfigObj && geofenceConfigObj.buidingData && geofenceConfigObj.buidingData["strictLocGeofence"] && !geofence){\n                    return;\n                }\n                this.tlt = tlt;\n                this.tln = tln;\n                this.cac += 0.5;\n                console.log("cac:",this.cac)\n            }\n            function u(t, e) {\n                var a = Math.abs(t - e);\n                return 180 < a && (a = 360 - a), a\n            }\n        },\n        tst: function () {\n            this.headingBegin = !1\n        },\n        alt: function () {\n            return !1\n        },\n        setNaviTraceDirection: function (t) {\n            this.naviTraceDirection = t\n        },\n        setAloneTrace: function (t, e) {\n            this.aloneTrace = t, this.traceDirection = e\n        },\n        clearSaveSteps: function () {\n            this.sls = []\n        },\n        correctParams: function(data){\n            if(data["I"] && typeof data["I"] == "number"){\n                I = data["I"];\n            }\n            if(data["BigRangeCount"] && typeof data["BigRangeCount"] == "number"){\n                BigRangeCount = data["BigRangeCount"];\n            }\n            if(data["SmallObserveRadius"] && typeof data["SmallObserveRadius"] == "number"){\n                SmallObserveRadius = data["SmallObserveRadius"];\n            }\n            if(data["ToleranceCount"] && typeof data["ToleranceCount"] == "number"){\n                ToleranceCount = data["ToleranceCount"];\n            }\n        },\n        setGeofence:function(a){\n            geofenceConfigObj.buidingData = a;\n        },\n        updateGPS: function (t) {\n            if (h && D.freedom) {\n                s || this.clearSaveSteps(), s = !0\n            } else {\n                if (t && t.accuracy < D.GpsAccuracy && h) {\n                    if ((this.tln || this.tlt) && ++n < 5) {\n                        return\n                    }\n                    s || this.clearSaveSteps(), s = !0\n                } else {\n                    n = 0\n                }\n            }\n            s && t.accuracy < D.GpsAccuracy && (this.floor || (this.floor = "1"), D.freedom ? this.clts((new Date).getTime() - 3000, t.latitude, t.longitude, D.GpsCovariance / 5) : (this.tln = t.longitude, this.tlt = t.latitude, this.cac = BigRangeCount))\n        }\n    }, i.prototype = {\n        sdb: function (t) {\n            this.bldb = t, this.floorData = t.floorData, this.bleData = t.bleData\n        },\n        isInThisBuilding: function (t) {\n            var e = this,\n                a = 0,\n                i = !1;\n                l = [];\n            return !!e.floorData && (t.forEach || (t = []),\n                t.forEach(function (t) {\n                if (0 === t.rssi) {\n                    return !0\n                }\n                void 0 !== e.floorData[t.id] && (l.push(t), 0, t.rssi > D.StrongBeaconPowerDirectIn && (i = !0), t.rssi > D.MinPowerLevelForGps && a++)\n            }),\n            h ? a >= D.GpsOutToInThreshold ? o++ : o = 0 : a <= D.GpsInToOutThreshold ? o++ : o = 0,\n            3 <= o && (h = !h, o = 0),\n            i ? (o = 0, h = !1) : h || (s && v.clearSaveSteps(), s = !1, n = 0),\n            a >= D.GpsOutToInThreshold\n            )\n        },\n        // filterData:function(fl,  t){\n        //     var temp = [];\n        //     if (t.forEach){\n        //         t.forEach(function (ap) {\n        //             if(ap.)\n        //         });\n        //     }\n        // }\n        getFloor: function (t) {\n            var i = 0,\n                n = this,\n                o = {};\n            if (t.forEach && n.floorData) {\n                var bleJson = [];\n                t.forEach(function (ap) {\n                    // get ble position\n                    var data = n.bleData[ap.id];\n                    if(data){\n                        var data1 = {\n                            lon:data.lon,\n                            lat:data.lat,\n                            floor:data.fl,\n                            id:ap.id,\n                            rssi:ap.rssi\n                        };\n                        bleJson.push(data1) ;\n                    }\n                    if (0 === ap.rssi || ap.rssi < -77) {\n                        return !0;\n                    }\n                    if (i < 8) {\n                        var e = n.floorData[ap.id];\n                        if (void 0 !== e) {\n                            for (var a in e) {\n                                o[a] || (o[a] = 0);\n                                o[a] += Number(e[a]) * (8 - i);\n                            }\n                            i++\n                        }\n                        if (8 < i) {\n                            return !1;\n                        }\n                    }\n\n                });\n                var a = [];\n                for (var floorIndex in o) {\n                    a.push({\n                        floor: floorIndex,\n                        so: o[floorIndex],\n                        ble:bleJson\n                    })\n                }\n\n                1 < a.length && u(a, "so");\n                var c = !1;\n                if (0 !== a.length) {\n                    this.sb.forEach(function (ap) {\n                        var e = (new Date).getTime();\n                        if(ap.floor == a[0].floor){\n                            c = !0;\n                            ap.so += (e - n.lst) / 1000 * 1.5;\n                            10 < ap.so && (ap.so = 10);\n                        }else{\n                            ap.so -= (e - n.lst) / 1000;\n                            ap.so < 0 && (ap.so = 0);\n                        }\n                        //ap.floor == a[0].floor ? (c = !0, ap.so += (e - n.lst) / 1000 * 1.5, 10 < ap.so && (ap.so = 10)) : (ap.so -= (e - n.lst) / 1000, ap.so < 0 && (ap.so = 0))\n                    });\n                    c || this.sb.push({\n                        floor: a[0].floor,\n                        so: 3,\n                        ble: a[0].ble\n                    });\n\n                    1 < this.sb.length && u(this.sb, "so");\n                    this.lst = (new Date).getTime();\n                    JSON.stringify(this.sb);\n                    if(this.sb.length !== 0){\n                        this.sb[0].ble = bleJson;\n                    }\n\n                    return Object.assign({}, this.sb[0]);\n                }\n            }\n        }\n        // getFloor: function (t) {\n        //     var i = 0,\n        //         n = this,\n        //         o = {};\n        //     if (t.forEach && n.floorData) {\n        //         var bleJson = [];\n        //         t.forEach(function (ap) {\n        //             // get ble position\n        //             var data = n.bleData[ap.id];\n        //             if(data){\n        //                 var data1 = {\n        //                     lon:data.lon,\n        //                     lat:data.lat,\n        //                     floor:data.fl,\n        //                     id:ap.id,\n        //                     rssi:ap.rssi\n        //                 }\n        //                 bleJson.push(data1) ;\n        //                 // ap.floor =\n        //             }\n        //             if (0 === ap.rssi || ap.rssi < -77) {\n        //                 return !0\n        //             }\n        //             if (i < 8) {\n        //                 var e = n.floorData[ap.id];\n        //                 if (void 0 !== e) {\n        //                     for (var a in e) {\n        //                         o[a] || (o[a] = 0);\n        //                         o[a] += Number(e[a]) * (8 - i);\n        //                     }\n        //                     i++\n        //                 }\n        //                 if (8 < i) {\n        //                     return !1\n        //                 }\n        //             }\n\n        //         });\n        //         var a = [];\n        //         for (var floorIndex in o) {\n        //             a.push({\n        //                 floor: floorIndex,\n        //                 so: o[floorIndex],\n        //                 ble:bleJson\n        //             })\n        //         }\n\n        //         1 < a.length && u(a, "so");\n        //         var c = !1;\n        //         if (0 !== a.length) {\n        //             this.sb.forEach(function (ap) {\n        //                 var e = (new Date).getTime();\n        //                 if(ap.floor == a[0].floor){\n        //                     c = !0;\n        //                     ap.so += (e - n.lst) / 1000 * 1.5;\n        //                     10 < ap.so && (ap.so = 10);\n        //                 }else{\n        //                     ap.so -= (e - n.lst) / 1000;\n        //                     ap.so < 0 && (ap.so = 0);\n        //                 }\n        //                 //ap.floor == a[0].floor ? (c = !0, ap.so += (e - n.lst) / 1000 * 1.5, 10 < ap.so && (ap.so = 10)) : (ap.so -= (e - n.lst) / 1000, ap.so < 0 && (ap.so = 0))\n        //             });\n        //             c || this.sb.push({\n        //                 floor: a[0].floor,\n        //                 so: 3,\n        //                 ble: a[0].ble\n        //             });\n\n        //             1 < this.sb.length && u(this.sb, "so");\n        //             this.lst = (new Date).getTime();\n        //             JSON.stringify(this.sb);\n        //             if(this.sb.length !== 0){\n        //                 this.sb[0].ble = bleJson;\n        //             }\n\n        //             return Object.assign({}, this.sb[0]);\n        //         }\n        //     }\n        // }\n    };\n    var d = new i,\n        f = new t,\n        v = new a(f);\n    onmessage = function (t) {\n        var e = t.data.type,\n            a = t.data.data || {},\n            i = t.data.el;\n        switch (e) {\n            case "rc":\n                f.c();\n                break;\n             case "reset":\n                f.c();\n                v.fcc(0,0,0);\n                 break;\n            case "rs":\n                break;\n            case "ri":\n                var n = f.cip(a, i);\n                r({\n                    type: "rss",\n                    data: n\n                });\n                break;\n            case "lr":\n                v.cjb();\n                break;\n            case "ld":\n                v.cid(a);\n                break;\n            case "ls":\n                v.cis(a);\n                break;\n            case "lt":\n                v.cios(a);\n                break;\n            case "lc":\n                v.c(a["clearForce"]);\n                break;\n            case "lf":\n                v.fcc(a.lon, a.lat, a.cov);\n                break;\n            case "bs":\n                d.sdb(a);\n                break;\n            case "bf":\n                l = [];\n                var o = d.isInThisBuilding(a),\n                    c = {};\n                o = true;\n                o && (c = d.getFloor(a) || []);\n                c.suggestSwitchToGPS = h;\n                s && (c.floor = "1");\n                Object.assign(c, {\n                    filterScanResults: l\n                });\n                r({\n                    type: "bfd",\n                    data: c\n                });\n                break;\n            case "sp":\n                D = a || {}, v.setParameters();\n                break;\n            case "la":\n                v.setAloneTrace(a.aloneTrace, a.traceDirection);\n                break;\n            case "lan":\n                v.setNaviTraceDirection(a.naviTraceDirection);\n                break;\n            case "gp":\n                v.updateGPS(a);\n                break;\n            case "cs":\n                v.clearSaveSteps();\n                break;\n            case "correctParams":\n                v.correctParams(a);\n                break;\n            case "setGeofence":\n                v.setGeofence(a);\n                break;\n            case "sgd":\n                v.setGeofence(a);\n                break;\n            case "setBuildingData":\n                locationEngine.setBuildingData(a);\n                break;\n            case "fp":\n                var possibleFingerPrintList = locationEngine.getPossibleFingerPrintList(a);\n                r({\n                    type: "fpresult",\n                    data: possibleFingerPrintList\n                })\n                break;\n        }\n    }\n}();';
      var worker = createWorkerByContent(workerContent);
      // var worker = new Worker(thisObject.locPath + 'location-raw-wuhan.js?t=' + window["version"] || "11");
      // var worker = new Worker(thisObject.locPath + 'location-raw.js?t=' + window["version"] || "11");

      thisObject.worker = worker;
      thisObject.locationEngine = new RSSLocationEngine(this, token, bdid, fingerUrl);
      thisObject.locationEngine.init(function (e) {
        var floorIndex = e.floor;
        var floorId = e.floorId;
        if (!floorId && thisObject.configData) {
          floorIndex = thisObject.configData.floorToFloorId[e.floor];
          floorId = thisObject.configData.locatingMap[e.floor];
        }
        e["floorIndex"] = floorIndex || floorId;
        e["floorId"] = floorId;
        e["bdid"] = e.bdid || thisObject.bdid;
        thisObject._onLocationUpdateCallback && thisObject._onLocationUpdateCallback(e);
      });

      if (params["correctParams"]) {
        thisObject.worker.postMessage({
          type: "correctParams",
          data: params["correctParams"],
        });
      }
      if (params["strictLocGeofence"]) {
        thisObject.worker.postMessage({
          type: "setGeofence",
          data: params["strictLocGeofence"],
        });
      }
    };

    prototype.fini = function () {
      var thisObject = this;
    };

    prototype.start = function (bdid, callback, bdInfo) {
      var thisObject = this;
      thisObject.bdid = bdid;
      thisObject.locationEngine.setProjectId(bdid, bdInfo);
      var url = fingerUrl + "getContent?bdid=" + thisObject.bdid;

      if (!thisObject.buildingData[token]) {
        thisObject.buildingData[token] = { bdid: bdid };
      }
      if (thisObject.buildingData[token][bdid]) {
        thisObject.configData = thisObject.buildingData[token][bdid]["configData"];
        thisObject.floorData = thisObject.buildingData[token][bdid]["floorData"];

        thisObject.locationEngine.loadJSONBuildingRSS(thisObject.floorData);
        callback && callback(thisObject.configData);
      } else {
        thisObject.buildingData[token][bdid] = { bdid: bdid };
        LocalizationUtils.getDataJson(url + "&filename=config.json&t=" + new Date().getTime(), {}, function (config_t) {
          if (typeof config_t == "string") {
            var configData = JSON.parse(config_t);
          } else {
            var configData = config_t;
          }

          thisObject.buildingData[token][bdid]["configData"] = configData;
          if (thisObject.bdid == bdid) {
            thisObject.configData = configData;
            if (thisObject.buildingData[token][bdid]["floorData"]) {
              callback && callback(thisObject.configData);
            }
          }
        });
        LocalizationUtils.getDataJson(url + "&filename=floorData.json&t=" + new Date().getTime(), {}, function (t) {
          if (typeof t == "string") {
            var floorData = JSON.parse(t);
          } else {
            var floorData = t;
          }

          thisObject.buildingData[token][bdid]["floorData"] = floorData;

          if (thisObject.bdid == bdid) {
            thisObject.floorData = floorData;
            thisObject.locationEngine.loadJSONBuildingRSS(floorData);
            // callback && callback(thisObject.configData);
            if (thisObject.buildingData[token][bdid]["configData"]) {
              callback && callback(thisObject.configData);
            }
          }

          if (thisObject.buildingData[token][bdid]["btrssData"]) {
            thisObject.locationEngine.loadJSONBuildingBTRSS(thisObject.buildingData[token][bdid]);
          }
        });
        if (bdInfo && bdInfo["offlineLoc"]) {
          LocalizationUtils.getDataJson(url + "&filename=btrssData.json&t=" + new Date().getTime(), {}, function (t) {
            if (typeof t == "string") {
              var btrssData = JSON.parse(t);
            } else {
              var btrssData = t;
            }

            thisObject.buildingData[token][bdid]["btrssData"] = btrssData;
            if (thisObject.buildingData[token][bdid]["floorData"]) {
              thisObject.locationEngine.loadJSONBuildingBTRSS(thisObject.buildingData[token][bdid]);
            }

            if (thisObject.bdid == bdid) {
              thisObject.btrssData = btrssData;
              // thisObject.locationEngine.loadJSONBuildingRSS(floorData);
              // callback && callback(thisObject.configData);
            }
          });
        }
      }
    };

    prototype.stop = function () {
      this.locationEngine.clean(true);
    };
    prototype.getBeaconData = function () {
      if (thisObject.configData && thisObject.floorData) {
        var locatingMap = thisObject.configData["locatingMap"];
        var beaconData = {};
        var bleData = thisObject.floorData["bleData"];
        for (var key in bleData) {
          var bleInfo = bleData[key];
          var fl = bleInfo["fl"];
          var floorId = locatingMap[fl];
          if (!beaconData[floorId]) {
            beaconData[floorId] = [];
          }
          beaconData[floorId].push({
            id: key,
            text: key,
            floorId: floorId,
            lon: bleInfo["lon"],
            lat: bleInfo["lat"],
          });
        }
        return beaconData;
      }
      return null;
    };

    prototype.clean = function () {
      thisObject.locationEngine.clean(true);
    };
    prototype.reset = function () {
      thisObject.locationEngine.reset(true);
    };

    prototype.setBLEPredict = function (b) {
      thisObject.locationEngine.setBLEPredict(b);
    };

    prototype.setGeofenceData = function (t) {
      var thisObject = this;
      thisObject.locationEngine.setGeofenceData(t);
    };
    prototype.beginLocation = function (callback) {
      callback();
    };
    prototype.updateOrientation = function (orientation) {
      var thisObject = this;
      var routeMatcher = this.locationFramework._routeMatcher;
      var _curPolyline = routeMatcher._curPolyline;
      if (_curPolyline && routeMatcher.naviStrictByLineDir && routeMatcher.naviStrictByLineDir) {
        var heading = _curPolyline.getSegmentAngleFromIndex(_curPolyline.getSegmentIndex(this.locationFramework._routeMatcher._targetKey));
        thisObject.locationEngine.checkInDirection(heading);
      } else {
        thisObject.locationEngine.checkInDirection(orientation);
      }
    };
    prototype.updateStep = function (data) {
      // var routeMatcher = this.locationFramework._routeMatcher;
      // var _curPolyline = routeMatcher._curPolyline;
      // if(_curPolyline && routeMatcher.naviStrictByLineDir && routeMatcher.naviStrictByLineDir){
      // 	data["heading"] = _curPolyline.getSegmentAngleFromIndex(_curPolyline.getSegmentIndex(this.locationFramework._routeMatcher._targetKey))
      // }
      this.locationEngine.checkInOneTraceStep(data);
    };
    prototype.updateScan = function (beacons, timeStamp) {
      var list = [];
      var thisObject = this;
      beacons.forEach(function (item) {
        list.push({
          id: item["fid"] || item["id"],
          rssi: item["rssi"],
        });
      });
      list.rawCount = beacons.rawCount;
      thisObject.location(
        list,
        function (data) {
          locationFramework.fingerData = data["fingerData"];
          if (locationFramework && locationFramework.locationListener && locationFramework.locationListener["onFingerprintSuccess"]) {
            locationFramework.locationListener["onFingerprintSuccess"](data["fingerData"], thisObject.locationEngine.catchBleInfos);
          }
          locationFramework.getAlgorithm()._locationComposer.setBleData(data);

          var floor = data.result.floor;

          var diff = 0.5;
          if (locationFramework.fingerData.length > 0) {
            diff = locationFramework.fingerData[0].diff;
          }

          var bleInfo = data.result.bleinfo;
          var result = {
            floor: floor,
            longitude: bleInfo.longitude,
            latitude: bleInfo.latitude,
            position: [bleInfo.longitude, bleInfo.latitude],
            direction: thisObject.locationEngine.direction,
            locType: "BLE",
            lblt: data.result.timestamp,
            cac: diff,
            bleinfo: bleInfo,
            timeStamp: data.result.timestamp,
            maxRssi: data.result.maxRssi,
          };

          if (window.location.search.indexOf("showLocMsg=true") != -1) {
            WXAlert.logCustom5("BLE maxRssi:" + result.maxRssi, 1, false, true);
          }
          // WXAlert.logCustom5(msg, 1, false, true);
          var configData = locationFramework.getAlgorithm().getConfigData();

          var floorIndex = configData.floorToFloorId[floor];
          var floorId = configData.locatingMap[floor];
          result["floorIndex"] = floorIndex;
          result["floorId"] = floorId;
          result["bdid"] = locationFramework.getAlgorithm()._bdid;

          locationFramework.getAlgorithm()._locationComposer.onLocationResultUpdate(result);
        },
        timeStamp,
      );
    };

    prototype.location = function (beacons, callback, timeStamp) {
      this.locationEngine.checkInScanResult(beacons, callback, timeStamp);
    };

    prototype.updateGPSDataAsMeasureData = function (gpsData, timeStamp) {
      if (!this.lrInit && (!this.buildingData[this.token] || !this.buildingData[this.token][this.bdid])) {
        this.locationEngine.loadJSONBuildingRSS({});
        this.lrInit = true;
      }
      this.locationEngine.checkInGPSData(gpsData, timeStamp);
    };

    prototype.updateBLEDataAsMeasureData = function (bleData, timeStamp) {
      this.locationEngine.checkInBLEData(bleData, timeStamp);
    };

    prototype.updateLocation = function (positionData, callback) {
      postData(thisObject.baseURL + "updateLocation?h=" + thisObject.handler + "&s=" + Math.random(), positionData, callback);
    };

    prototype.getPosition = function () {
      postData(thisObject.baseURL + "getPosition?h=" + thisObject.handler + "&s=" + Math.random(), msg, function (e) {
        _bleUpdateArgs.position = [e.location.x, e.location.y, e.location.z];
        _bleUpdateArgs.heading = thisObject.locationCore._localizationState.getHeading();
        _bleUpdateArgs.timeStamp = e.timeStamp;
        _bleUpdateArgs.updateType = e.updateType;
        callback(_bleUpdateArgs);
      });
    };

    prototype.startMatchRoute = function (routeData, callback) {
      thisObject.routeData = JSON.parse(routeData);
      postData(thisObject.baseURL + "startMatchRoute?h=" + thisObject.handler + "&s=" + Math.random(), thisObject.routeData, function (ret) {
        //callback(_bleUpdateArgs);
      });
    };

    prototype.stopMatchRoute = function () {
      if (!thisObject.routeData) return;
      thisObject.routeData = null;
      postData(thisObject.baseURL + "stopMatchRoute?h=" + thisObject.handler + "&s=" + Math.random(), {}, function (ret) {});
    };
  };

  var BLEFingerprintAlgorithm = {
    LocalizationAlgorithm: LocationAlgorithm,
  };
  return BLEFingerprintAlgorithm;
})();

///////////   指纹定位  end   /////////////////
function getDeviceType() {
  var t = navigator.userAgent.toLowerCase();
  return t.indexOf("android") > -1 || t.indexOf("Android") > -1 || !window["DeviceOrientationEvent"] || (t.indexOf("ucweb") > -1 && t.indexOf("linux") > -1)
    ? !1
    : !0;
}
var WXLocationEntity = (function () {
  var WXLocation = function () {
    var prototype = WXLocation.prototype;
    prototype["init"] = function (success, error, params, bdlist) {
      var thisObject = this;

      var postLocRes = params["postLocRes"];
      var userId = params["userId"];
      thisObject.postLocRes = postLocRes;
      thisObject.ctrlLocByUser = params["ctrlLocByUser"] || false;
      thisObject.userId = userId;
      thisObject.sessionKey = params["sessionKey"] || "";
      thisObject.deviceName = params["device"] || "";

      thisObject.locationCore = new LocalizationFramework();

      thisObject.locationCore._onLocationUpdateCallback = success;
      thisObject.locationCore.init(this, params); //token, bdid, configUrl, postLocRes, userId, thisObject.sessionKey, version, unique_deviceno, params["id"], params["wsLocUrl"]);
      if (params["matchInfo"] && params["matchInfo"]["GPS"] && params["matchInfo"]["GPS"]["matchRouter"]) {
        matchRouter = true;
      }
      //     var bdid = window["command"]["bdid"] || window["command"]["buildingId"];
      //     if(token && bdid){
      //         matchRouter = true
      //         RoadMapMatcher.setRoadMap(token, bdid)
      //     }
      // }

      window.addEventListener("message", function (e) {
        var realEvent = e["originalEvent"] || e,
          data = realEvent["data"],
          swin = realEvent["source"],
          origin = realEvent["origin"],
          protocol;
        try {
          protocol = JSON.parse(data);

          if (protocol["data"] && protocol["data"]["method"]) {
            var method = protocol["data"]["method"];
            window[method] && window[method](protocol["data"]["data"]);
          }
        } catch (error) {}
      });
      if (bdlist) {
        thisObject.locationCore.setBuildingsData(bdlist);
      }
    };

    prototype["registBleStateListener"] = function (callback) {
      this.locationCore.registBleStateListener(callback);
    };
    prototype["registGPSStateListener"] = function (callback) {
      this.locationCore.registGPSStateListener(callback);
    };
    prototype["registDebugListener"] = function (callback) {
      this.locationCore && this.locationCore.registDebugListener && this.locationCore.registDebugListener(callback);
    };
    prototype["setBuildingsData"] = function (bdListData) {
      this.locationCore.setBuildingsData(bdListData);
    };
    prototype["fini"] = function () {
      this.locationCore.fini();
    };
    prototype["isLocating"] = function () {
      this.locationCore.startTestFunc();
    };
    prototype["relocation"] = function () {
      this.locationCore.reset();
    };
    prototype["clean"] = function () {
      var mp = this.locationCore._providerManager.getProvider("micro");
      mp.resetLocalizationTimeStamp();
      this.locationCore.reset();
    };
    prototype["startMatchRoute"] = function (routeData, usingLineHeading, naviStrictByLineDir) {
      this.locationCore._routeMatcher.startMatchRoute(routeData, usingLineHeading, naviStrictByLineDir);
    };
    prototype["stopMatchRoute"] = function (loc) {
      if (this.locationCore._routeMatcher) {
        this.locationCore._routeMatcher.finalize();
        if (loc) {
          // 偏离导航重置定位点的去除抓路 ，防止定位更新慢重新导航后定位点没有更新的问题

          this.locationCore.onLocalizationSucceed(loc, true);
          // var locator = this.locationCore.getAlgorithm();
          // locator._locationComposer.onLocationResultUpdate(pos);
        }
      }
    };
    prototype["locationLogManager"] = locationLogManager;
    prototype["onBleUpdate"] = function (bleData) {
      // var mp = this.locationCore._providerManager.getProvider("micro");
      // mp.testBleChanged(bleData["beacons"]);
      // mp.testBleChanged(bleData["beacons"]);
      var scanInfolist = [];
      var beacons = bleData["beacons"];
      var recordTime = beacons[0]["datetime"] || beacons[0]["t"];
      var headingArray = [];
      for (var i = 0; i < beacons.length; i++) {
        var beaconJson = beacons[i];
        var rssi = parseInt(beaconJson["rssi"]);
        var heading = parseFloat(beaconJson["heading"]);
        if (heading) {
          headingArray.push(heading);
        }
        if (rssi < MIN_BLE_SCAN_RSSI || rssi > -40) continue;
        var beaconScanInfo = new BeaconScanInfo();
        beaconScanInfo.rssi = rssi;
        beaconScanInfo.time = recordTime;
        beaconScanInfo.fid = beaconJson["major"] + "_" + beaconJson["minor"];
        scanInfolist.push(beaconScanInfo);
      }

      this.locationCore._locatorManager.getCurrentLocator().onBleReport(scanInfolist);
    };
    prototype["resetSimulate"] = function () {
      var mp = this.locationCore._providerManager.getProvider("micro");
      mp.resetLocalizationTimeStamp();
      this.locationCore.clean(true);
    };

    prototype["onStepUpdate"] = function (accData) {
      var fusion = this.locationCore._locatorManager.getCurrentLocator();
      fusion.testStepUpdate(accData);
    };

    prototype["onGPSUpdate"] = function (data) {
      var mp = this.locationCore._providerManager.getProvider("micro");
      mp.testOnGPSUpdate(data);
    };
    prototype["onAOAUpdate"] = function (data) {
      var mp = this.locationCore._providerManager.getProvider("micro");
      var val = data["pos"];
      var aoaData = {
        longitude: parseFloat(val[0]),
        latitude: parseFloat(val[1]),
        floorId: data["flid"],
        bdid: data["bdid"],
        // "heading": parseFloat(e["h"]),
        // "accuracy": parseFloat(e["a"]),
        t: data["d"],
        timeStamp: Date.now(),
        locType: "AOA",
      };
      // if(this.locationCore.locationFramework._routeMatcher._curPolyline){
      // 	if(e["a"]!=undefined){
      //         aoaData["accuracy"] =  parseFloat(e["a"]);
      //     }
      // }else{
      aoaData["accuracy"] = parseFloat(data["a"] || 3);

      // }
      if (data["h"]) {
        aoaData["heading"] = parseFloat(data["h"]);
      }
      mp.trigger("aoa", aoaData);
    };
    prototype["on5GUpdate"] = function (data) {
      // update5GData
      var mp = this.locationCore._providerManager.getProvider("5gProvider");
      if (mp) {
        var val = data["pos"] || data["v"];
        var result = {
          longitude: parseFloat(val[0]),
          latitude: parseFloat(val[1]),
          floorId: data["flid"],
          bdid: data["bdid"],
          t: data["d"],
          timeStamp: Date.now(),
          locType: "5G",
          force: data["force"],
        };
        var heading = data["h"] != undefined ? data["h"] : data["heading"];
        if (heading != undefined) {
          result["heading"] = parseFloat(heading);
        }
        mp["update5GData"](result);
      }
    };
    prototype["onOrientationUpdate"] = function (orientation) {
      var mp = this.locationCore._providerManager.getProvider("micro");
      mp.testOrientationChanged(orientation);
    };
    prototype["getBleState"] = function () {
      return this.locationCore._providerManager.getProvider("micro")["getBleState"]();
    };
    prototype["getGPSState"] = function () {
      return this.locationCore._providerManager.getProvider("micro")["getGPSState"]();
    };
    prototype["get5GState"] = function () {
      return this.locationCore._providerManager.getProvider("5gProvider")["getOpenState"]();
    };
    prototype["register5GPhoneNumber"] = function (phoneNum, successCB, failedCB) {
      return this.locationCore._providerManager.getProvider("5gProvider")["registerPhoneNumber"](phoneNum, successCB, failedCB);
    };
    prototype["unregister5GPhoneNumber"] = function (successCB, failedCB) {
      return this.locationCore._providerManager.getProvider("5gProvider")["unregisterPhoneNumber"](successCB, failedCB);
    };

    prototype["setSensorStatus"] = function (data) {
      var provider = this.locationCore._providerManager.getProvider("micro");
      for (var key in data) {
        if (key == "BLE") {
          provider.setBleState(data["BLE"]);
        }
        if (key == "GPS") {
          provider.setGPSState(data["GPS"]);
        }
      }
    };
    prototype["sendBeaconsData"] = function (beacons) {
      this.locationCore.sendBeaconsData(beacons);
    };
    prototype["sendGPSData"] = function (gps) {
      this.locationCore.sendGPSData(gps);
    };
    prototype["sendHeadingData"] = function (heading) {
      this.locationCore.sendHeadingData(heading);
    };
    prototype["sendStep"] = function (data) {
      this.locationCore.sendStep(data);
    };
    prototype["sendAOAResult"] = function (data) {
      this.locationCore.sendAOAResult(data);
    };
    prototype["send5GResult"] = function (data) {
      this.locationCore.send5GResult(data);
    };
    prototype["setGeofenceData"] = function (data) {
      this.locationCore.setGeofenceData(data);
    };
    prototype["onLocationResultUpdate"] = function (result) {
      this.locationCore.onLocalizationSucceed(result);
    };
    prototype["updateLocation"] = function (result) {
      return this.locationCore.updateLocation(result);
    };
    prototype["getCurrentBeaconData"] = function (successCB) {
      var beaconData = null;
      var algorithm = this.locationCore.getAlgorithm();
      if (algorithm) {
        beaconData = algorithm.getBeaconData();
      }
      if (successCB) {
        successCB(beaconData);
      } else {
        return beaconData;
      }
    };
    prototype["setWXLocationResult"] = function (loc) {
      var algorithm = this.locationCore.getAlgorithm();
      if (algorithm && algorithm._localizationAlgorithm.locationEngine) {
        var flIndex = algorithm.getFloorIndex(loc.bdid, loc.floorId);
        loc.floorIndex = flIndex;
        algorithm._localizationAlgorithm.locationEngine.reset(loc);
      }
    };
    prototype["changeBuilding"] = function (bdid) {
      this.locationCore.changeBuilding(bdid);
    };
    prototype["setStepH"] = function (h) {
      this.locationCore.setStepH && this.locationCore.setStepH(h);
    };
    prototype["setLocStepH"] = function (h) {
      this.locationCore.setLocStepH && this.locationCore.setLocStepH(h);
    };
    prototype["setStepHAOA"] = function (h) {
      this.locationCore.setStepHAOA && this.locationCore.setStepHAOA(h);
    };
    prototype["setLocStepHAOA"] = function (h) {
      this.locationCore.setLocStepHAOA && this.locationCore.setLocStepHAOA(h);
    };
    prototype["setStrictLocArea"] = function (h) {
      this.locationCore.setStrictLocArea && this.locationCore.setStrictLocArea(h);
    };
  };

  var isIOSDevice = false;
  var STEPLENGTH = 0.54;
  var MIN_BLE_SCAN_RSSI = -100;
  var updateIntervel = 0;
  var SMOOTH_NEAR = 0.4;
  var SMOOTH_FAR = 0.3;
  var GHOST = true;
  var NEARBY_DISTANCE = 100;
  var BLE_KALMAN_RESET_RSSI = -69;
  var BLE_MAX_DIS = 10;
  var KALMAN_RESET_FREQ = 4000;
  var DETECT_ACTION_TIME = 5000;
  var EKF = true;

  var LES_PDR = 0;
  var LES_BEACON = 1;
  var UPDATE_TYPE_ORIENTAION = 0;
  var UPDATE_TYPE_PDR = 1;
  var UPDATE_TYPE_BLE = 2;
  var UPDATE_TYPE_BLE_RESET = 3;
  var ALERT_LEVEL = 10;

  // Beacon Scan Info
  var BeaconScanInfo = function (id, uuid, major, minor, mac, rssi, x, y, z, type, time, accuracy, heading) {
    this.id = id;
    this.uuid = uuid;
    this.major = major;
    this.minor = minor;
    this.mac = mac;
    this.rssi = rssi;
    this.x = x;
    this.y = y;
    this.z = z;
    this.type = type;
    this.time = time;
    this.accuracy = accuracy;
    this.heading = heading;
    this.count = 0;
  };

  var LocationResult = function () {
    var thisObject = this;
    thisObject.position = [0, 0, 0];
    thisObject.timeStamp = 0;
    thisObject.updateType = 0;
    thisObject.heading = 0;
  };

  // OrientationProvider
  var OrientationProvider = function (localizationCore) {
    EventTrigger.call(this);
    this._timeStamp = 0;
    this.alpha = 0;
    this._orientation = 0; //window.orientation;
    this._started = false;
    var prototype = OrientationProvider.prototype;
    prototype.init = function () {};

    prototype.fini = function () {};
    prototype.start = function () {
      var thisObject = this;
      if (isIOSDevice) {
        function _inner_onDeviceOrietation(t) {
          var heading = Math.round(t["webkitCompassHeading"] ? 0 - t["webkitCompassHeading"] : t.alpha);
          heading -= thisObject._orientation;
          if (t.timeStamp - thisObject._timeStamp >= 100) {
            thisObject._timeStamp = t.timeStamp;
            var n = Math.abs(thisObject.alpha - heading);
            if (n > 5) {
              heading = ~~heading;
              thisObject.alpha = heading; //thisObject.heading;
              thisObject.trigger("heading", 360 - heading);
            }
          }
        }

        if (!thisObject._started) {
          thisObject._started = true;
          window.addEventListener("deviceorientation", _inner_onDeviceOrietation, true);
          window.addEventListener(
            "orientationchange",
            function () {
              thisObject._orientation = window.orientation;
            },
            true,
          );
        }
      } else {
        //监听设备方向上变化
        // function _inner_onDeviceOrietation(event) {
        //    var alpha = event.alpha, //设备沿z方向的旋转 水平面上-360～260
        //         beta = event.beta,  // 设备沿x轴方向的旋转 由前向后 -180 ～180
        //         gamma = event.gamma;  // 设备延y轴旋转 由左向右    -90～90
        //         webkitCompassHeading = event.webkitCompassHeading;
        //    var currTime = LocalizationUtils.getCurrentTime();
        //    locationLogManager.addData({ //
        //       "t": 12,
        //       "d": currTime,
        //       "v": {"alpha":alpha,"beta":beta,"gamma":gamma,"heading":webkitCompassHeading}
        //     });
        // }
        // window.addEventListener("deviceorientation",_inner_onDeviceOrietation);
        function a(t, e, i) {
          if (Math.abs(e) < 70) return t;
          var o = t * (Math.PI / 180),
            a = e * (Math.PI / 180),
            n = i * (Math.PI / 180),
            r = Math.cos(o),
            s = Math.sin(o),
            l = Math.sin(a),
            u = Math.cos(n),
            h = Math.sin(n),
            d = -r * h - s * l * u,
            c = -s * h + r * l * u,
            f = Math.atan2(d, c);
          return ~~-(f *= 180 / Math.PI);
        }

        window.addEventListener("deviceorientation", function t(i) {
          (window.removeEventListener("deviceorientation", t),
            void 0 !== i.webkitCompassHeading
              ? window.addEventListener("deviceorientation", function (t) {
                  // n(t, !0)
                })
              : window.addEventListener("deviceorientationabsolute", function (t) {
                  if (t.alpha) {
                    o = !0;
                    var i = {
                      alpha: a(t.alpha, t.beta, t.gamma),
                      beta: t.beta,
                      gamma: t.gamma,
                    };
                    heading = 360 - i.alpha;
                    thisObject.alpha = i.alpha; //thisObject.heading;
                    thisObject.trigger("heading", heading);
                    // n(i, !0)
                  }
                }));
        });
      }
    };
    prototype.stop = function () {
      if (this._started) {
      }
      // wx.stopCompass();
    };
  };
  OrientationProvider.prototype = Object.create(EventTrigger.prototype);
  OrientationProvider.prototype.constructor = OrientationProvider;

  // GPSProvider
  var GPSProvider = function () {
    EventTrigger.call(this);
    var thisObject = this;
    thisObject._heading = 0;
    thisObject._isLocating = false;
    thisObject._updateInterval = null;
    thisObject._lastLocationResult = {
      latitude: 0,
      longitude: 0,
      floorIndex: 0,
      speed: 0,
      accuracy: 100,
      isIndoor: false,
      heading: 0,
      updateType: 0,
      source: 100,
      mGPSLocationType: 1,
      timeStamp: LocalizationUtils.getCurrentTime(),
    };
    var prototype = GPSProvider.prototype;

    prototype.init = function () {};
    prototype.fini = function () {};

    prototype.start = function () {
      if (thisObject._isLocating === false) {
        //实时更新位置信息
        thisObject.updateInterval = setInterval(thisObject.updateLocation, 5000);
        thisObject._isLocating = true;
      }
    };

    prototype.stop = function () {
      if (thisObject._updateInterval) {
        thisObject._isLocating = false;
        clearInterval(thisObject._updateInterval);
        thisObject._updateInterval = null;
      }
    };

    prototype.updateLocation = function () {
      var that = this;
      wx.getLocation({
        type: "gcj02", //gps定位
        altitude: true,
        // isHighAccuracy:true,
        success: function (res) {
          var locationResult = thisObject._lastLocationResult;

          if (locationResult.latitude !== res.latitude || locationResult.longitude !== res.longitude || locationResult.accuracy != res.accuracy) {
            // console.log(res)
            var gpsData = {
              latitude: res.latitude,
              longitude: res.longitude,
              floorIndex: 0,
              speed: res.speed || 0,
              accuracy: res.accuracy || 10,
              isIndoor: false,
              heading: thisObject._heading,
              updateType: 0,
              source: 100,
              mGPSLocationType: res.accuracy > 30 ? 1 : 0,
              timeStamp: LocalizationUtils.getCurrentTime(),
            };
            // alert(JSON.stringify(res));
            thisObject.trigger("gps", gpsData);
            thisObject._lastLocationResult = gpsData;
          }
        },
        complete: function (res) {
          console.log(res);
        },
      });
    };

    prototype.onOrientationChanged = function (e) {
      thisObject._heading = e;
    };
  };
  GPSProvider.prototype = Object.create(EventTrigger.prototype);
  GPSProvider.prototype.constructor = GPSProvider;
  var AOAProvider = function (aoaWSSUrl, aoaConfig) {
    EventTrigger.call(this);
    var thisObject = this;
    thisObject._updateInterval = null;
    thisObject._lastLocationResult = {
      latitude: 0,
      longitude: 0,
      floorIndex: 0,
      floorId: "",
      speed: 0,
      accuracy: 100,
      isIndoor: false,
      heading: 0,
      updateType: 0,
      source: 100,
      mGPSLocationType: 1,
      timeStamp: LocalizationUtils.getCurrentTime(),
    };
    var floorMap = (aoaConfig && aoaConfig["floorData"]) || {
      //国博
      1: "DX0002870100200001",
      2: "DX0002870100200001",
      3: "DX0002870110100001",
      4: "DX0002870110100001",
      5: "DX0002870110300001",
      6: "DX0002870110400001",
    };
    var mapCheckPoint = (aoaConfig && aoaConfig["rect"]) || [
      0.001038174951524896, 0.029656173677020673, 1.2957782708e7, -0.029301929162035514, 0.0011598371778042378, 4852305.732,
    ];
    var prototype = AOAProvider.prototype;

    prototype.init = function (unique_deviceno, token, bdid) {
      this.unique_deviceno = unique_deviceno;
      this.token = token;
    };
    prototype.fini = function () {};

    prototype.start = function () {
      if (!this.unique_deviceno) {
        return;
      }
      var that = this;

      function websocket() {
        var wss_url = aoaWSSUrl ? aoaWSSUrl + that.unique_deviceno : "wss://lxdwyq.chnmuseum.cn/wss"; //国博测试
        var ws = new WebSocket(wss_url); //连接服务器
        that.ws = ws;
        ws.onopen = function (obj) {
          that.wsOpened = true;
          console.log("建立链接");
        };
        ws.onmessage = function (event) {
          try {
            var obj = JSON.parse(event.data);
            if (obj.type == "bind") {
              var data = {
                type: "bind",
                data: {
                  unique_deviceno: that.unique_deviceno,
                  p: "wx",
                  uid: "xxxtest",
                  nickname: "test",
                  phone: window["command"] && window["command"]["platform"] ? window["command"]["platform"] : "",
                },
              };
              //执行绑定操作
              ws.send(JSON.stringify(data));
            }
            if (obj.type == "bind_result") {
              send_msg(ws); //发送心跳
            }
            if (obj.type == "error") {
              // $("#msg").append("<li style='color: red'>"+myDate.toLocaleTimeString()+"&nbsp;&nbsp;"+obj.msg);
            }
            if (obj.type == "position") {
              if (window.location.search.indexOf("showLocMsg2=true") != -1) {
                // var msg = "resultType:"+result.locType + "   timeStamp:"+result.timeStamp+" <br/> heading"+result.heading;
                // WXAlert.log2(JSON.stringify(obj), 1, false, true);
              }
              try {
                var data = obj["data"];
                if (data["longitude"] && data["latitude"]) {
                  data["locType"] = "AOA";
                  data["timeStamp"] = data["timeStamp"] || new Date().getTime();
                } else if (data["aoa_data"]) {
                  var aoa_data = data["aoa_data"];
                  if (aoa_data && aoa_data["ts"]) {
                    data["timeStamp"] = parseInt(aoa_data["ts"]);
                    var diffTime = Date.now() - data["timeStamp"];
                    aoa_data["diffTime"] = diffTime;
                    if (diffTime > 2000) {
                      // console.log("aoa diffTime:", diffTime);
                    }
                    if (diffTime > 8000 || aoa_data["pkt"] <= 1) {
                      // 大于8s或者pkt小于等于1过滤
                      return;
                    }
                  } else {
                    data["timeStamp"] = data["timeStamp"] || new Date().getTime();
                  }
                  var points = data["point"];
                  var map_id = data["map_id"];
                  var use_type = data["use_type"];
                  data["floorId"] = floorMap[map_id];
                  data["bdid"] = "B000A11DJM";
                  data["locType"] = "AOA";
                  data["timeStamp"] = data["timeStamp"] || new Date().getTime();
                  var lon = 0,
                    lat = 0;

                  if (points instanceof Array) {
                    points.forEach(function (point) {
                      //show_time 是中海达那边文档数据多个 每个有showTime 属性
                      point[0] =
                        window["DaxiApp"] &&
                        window["DaxiApp"].naviMath.transformMectroXToLon(mapCheckPoint[0] * point["x"] + mapCheckPoint[1] * point["y"] + mapCheckPoint[2]);
                      point[1] =
                        window["DaxiApp"] &&
                        window["DaxiApp"].naviMath.transformMectroYToLat(mapCheckPoint[3] * point["x"] + mapCheckPoint[4] * point["y"] + mapCheckPoint[5]);
                      lon += point[0]; //*point["show_time"];
                      lat += point[1]; //*point["show_time"];
                    });
                    var pex = 1 / points.length;
                    lon *= pex;
                    lat *= pex;
                  }

                  data["longitude"] = lon;
                  data["latitude"] = lat;
                }
              } catch (e) {
                alert(e.toString());
              }

              if (data["longitude"] && data["latitude"]) {
                //if (data["locType"] == "AOA" && (window.location.search.indexOf("testBleVal=true") != -1 || window.location.search.indexOf("showLocMsg=true") != -1 )) {
                if (data["locType"] == "AOA") {
                  var msg = "AOA Message" + data["timeStamp"] + "  confidence:" + data["confidence"] + " ID:" + data["baseId"];
                  //WXAlert.logCustom2(msg, 1, false, true);
                }
                that.trigger("aoa", data);
              }
            }
          } catch (e) {
            console.log("AOA 异常");
          }
        };
        ws.onclose = function (event) {
          that.wsOpened = false;
          if (that.isStop) {
            return;
          }
          setTimeout(function () {
            websocket();
          }, 1000);
        };
        ws.onerror = function (event) {
          if (that.isStop) {
            return;
          }
          if (!that.wsOpened) {
            websocket();
          }
        };
        window.onunload = function () {
          //发断开链接的消息
          // ws.postMessage();
        };
      }

      function send_msg(ws) {
        //发送心跳
        var obj = { type: "heart", data: "heart_response", unique_deviceno: that.unique_deviceno };
        var heart_str = JSON.stringify(obj);
        if (ws.readyState == WebSocket.OPEN) {
          ws.send(heart_str);
        }
        clearTimeout(that.timer);
        that.timer = setTimeout(function () {
          if (ws.readyState == WebSocket.OPEN) {
            send_msg(ws);
          }
        }, 10 * 1000);
      }
      websocket();
    };
    prototype.updateAOAData = function (obj) {
      if (obj.type == "aoa") {
        var data = obj["data"];
        var points = data["point"];
        var map_id = data["map_id"];
        var use_type = data["use_type"]; //use_type:地图类型1展厅地图2楼层地图
        data["floorId"] = floorMap[map_id];
        data["bdid"] = "B000A11DJM";
        data["locType"] = "AOA";
        if (data["aoa_data"] && data["aoa_data"]["ts"]) {
          data["timeStamp"] = data["aoa_data"]["ts"];
        } else {
          data["timeStamp"] = data["timeStamp"] || data["lastLocalTime"] || new Date().getTime();
        }

        var lon = 0,
          lat = 0;

        if (points instanceof Array) {
          points.forEach(function (point) {
            //show_time 是中海达那边文档数据多个 每个有showTime 属性
            point[0] =
              window["DaxiApp"] &&
              window["DaxiApp"].naviMath.transformMectroXToLon(mapCheckPoint[0] * point["x"] + mapCheckPoint[1] * point["y"] + mapCheckPoint[2]);
            point[1] =
              window["DaxiApp"] &&
              window["DaxiApp"].naviMath.transformMectroYToLat(mapCheckPoint[3] * point["x"] + mapCheckPoint[4] * point["y"] + mapCheckPoint[5]);
            lon += point[0]; //*point["show_time"];
            lat += point[1]; //*point["show_time"];
          });
          var pex = 1 / points.length;
          lon *= pex;
          lat *= pex;
          data["longitude"] = lon;
          data["latitude"] = lat;
        }

        // if (lon && lat) {
        this.trigger("aoa", data);
        // }
      }
    };

    prototype.stop = function () {
      if (this.ws) {
        this.isStop = true;
        this.ws.close();
      }
    };

    prototype.updateLocation = function () {};

    prototype.onOrientationChanged = function (e) {
      thisObject._heading = e;
    };
  };
  AOAProvider.prototype = Object.create(EventTrigger.prototype);
  AOAProvider.prototype.constructor = AOAProvider;

  //国博AOA
  var AOA_GuoBoProvider = function () {
    EventTrigger.call(this);
    var thisObject = this;
    thisObject._updateInterval = null;
    thisObject._lastLocationResult = {
      latitude: 0,
      longitude: 0,
      floorIndex: 0,
      floorId: "",
      speed: 0,
      accuracy: 100,
      isIndoor: false,
      heading: 0,
      updateType: 0,
      source: 100,
      mGPSLocationType: 1,
      timeStamp: LocalizationUtils.getCurrentTime(),
    };
    var floorMap = {
      1: "DX0002870100200001",
      2: "DX0002870100200001",
      3: "DX0002870110100001",
      4: "DX0002870110100001",
      5: "DX0002870110300001",
      6: "DX0002870110400001",
    };
    var mapCheckPoint = [0.001038174951524896, 0.029656173677020673, 1.2957782708e7, -0.029301929162035514, 0.0011598371778042378, 4852305.732];
    var prototype = AOA_GuoBoProvider.prototype;

    prototype.init = function (unique_deviceno, token, bdid) {
      this.unique_deviceno = unique_deviceno;
      this.token = token;
    };
    prototype.fini = function () {};

    prototype.start = function () {
      if (!this.unique_deviceno) {
        return;
      }
      var that = this;

      function websocket() {
        var wss_url = "wss://lxdwyq.chnmuseum.cn/wss"; //国博测试
        var ws = new WebSocket(wss_url); //连接服务器
        that.ws = ws;
        ws.onopen = function (obj) {
          console.log("建立链接");
        };
        ws.onmessage = function (event) {
          try {
            var obj = JSON.parse(event.data);
            if (obj.type == "bind") {
              var data = {
                type: "bind",
                data: {
                  unique_deviceno: that.unique_deviceno,
                  p: "wx",
                  uid: "xxxtest",
                  nickname: "test",
                  phone: window["command"] && window["command"]["platform"] ? window["command"]["platform"] : "",
                },
              };
              //执行绑定操作
              ws.send(JSON.stringify(data));
            }
            if (obj.type == "bind_result") {
              send_msg(ws); //发送心跳
            }
            if (obj.type == "error") {
              // $("#msg").append("<li style='color: red'>"+myDate.toLocaleTimeString()+"&nbsp;&nbsp;"+obj.msg);
            }
            if (obj.type == "position") {
              var data = obj["data"];
              var aoa_data = data["aoa_data"];

              if (aoa_data && aoa_data["ts"]) {
                data["timeStamp"] = parseInt(aoa_data["ts"]);
                var diffTime = Date.now() - data["timeStamp"];
                aoa_data["diffTime"] = diffTime;
                if (diffTime > 2000) {
                  // console.log("aoa diffTime:", diffTime);
                }
                if (diffTime > 8000 || aoa_data["pkt"] <= 1) {
                  // 大于8s或者pkt小于等于1过滤
                  return;
                }
              } else {
                data["timeStamp"] = data["timeStamp"] || new Date().getTime();
              }
              var points = data["point"];
              var map_id = data["map_id"];
              var use_type = data["use_type"];
              data["floorId"] = floorMap[map_id];
              data["bdid"] = "B000A11DJM";
              data["locType"] = "AOA";
              data["timeStamp"] = data["timeStamp"] || new Date().getTime();

              var lon = 0,
                lat = 0;

              if (points instanceof Array) {
                points.forEach(function (point) {
                  //show_time 是中海达那边文档数据多个 每个有showTime 属性
                  point[0] = window["DaxiApp"].naviMath.transformMectroXToLon(mapCheckPoint[0] * point["x"] + mapCheckPoint[1] * point["y"] + mapCheckPoint[2]);
                  point[1] = window["DaxiApp"].naviMath.transformMectroYToLat(mapCheckPoint[3] * point["x"] + mapCheckPoint[4] * point["y"] + mapCheckPoint[5]);
                  lon += point[0]; //*point["show_time"];
                  lat += point[1]; //*point["show_time"];
                });
                var pex = 1 / points.length;
                lon *= pex;
                lat *= pex;
              }

              data["longitude"] = lon;
              data["latitude"] = lat;
              // //定位日志上传
              // locationLogManager.addData({
              //     "t": 11,
              //     "d": new Date().getTime(),
              //     "pos": [lon, lat],
              //     "flid": data["floorId"],
              //     "raw": {
              //         "map_id": map_id,
              //         "points": points,
              //         "aoa_data": data["aoa_data"] || '',
              //         "use_type": use_type
              //     }
              // })
              if (lon && lat) {
                that.trigger("aoa", data);
              }
            }
          } catch (e) {
            console.log("AOA 异常");
          }
        };
        ws.onclose = function (event) {
          if (that.isStop) {
            return;
          }
          setTimeout(function () {
            websocket();
          }, 10000);
        };
        ws.onerror = function (event) {
          if (that.isStop) {
            return;
          }
          setTimeout(function () {
            websocket();
          }, 10000);
        };
        window.onunload = function () {
          //发断开链接的消息
          // ws.postMessage();
        };
      }

      function send_msg(ws) {
        //发送心跳
        var heart_str = '{"type":"heart","data":"heart_response"}';
        ws.send(heart_str);
        setTimeout(function () {
          if (ws.readyState == WebSocket.OPEN) {
            send_msg(ws);
          }
        }, 30 * 1000);
      }
      websocket();
    };
    prototype.updateAOAData = function (obj) {
      if (obj.type == "aoa") {
        var data = obj["data"];
        var points = data["point"];
        var map_id = data["map_id"];
        var use_type = data["use_type"]; //use_type:地图类型1展厅地图2楼层地图
        data["floorId"] = floorMap[map_id];
        data["bdid"] = "B000A11DJM";
        data["locType"] = "AOA";
        if (data["aoa_data"] && data["aoa_data"]["ts"]) {
          data["timeStamp"] = data["aoa_data"]["ts"];
        } else {
          data["timeStamp"] = data["timeStamp"] || data["lastLocalTime"] || new Date().getTime();
        }

        var lon = 0,
          lat = 0;

        if (points instanceof Array) {
          points.forEach(function (point) {
            //show_time 是中海达那边文档数据多个 每个有showTime 属性
            point[0] = window["DaxiApp"].naviMath.transformMectroXToLon(mapCheckPoint[0] * point["x"] + mapCheckPoint[1] * point["y"] + mapCheckPoint[2]);
            point[1] = window["DaxiApp"].naviMath.transformMectroYToLat(mapCheckPoint[3] * point["x"] + mapCheckPoint[4] * point["y"] + mapCheckPoint[5]);
            lon += point[0]; //*point["show_time"];
            lat += point[1]; //*point["show_time"];
          });
          var pex = 1 / points.length;
          lon *= pex;
          lat *= pex;
        }

        data["longitude"] = lon;
        data["latitude"] = lat;
        if (lon && lat) {
          this.trigger("aoa", data);
        }
      }
    };

    prototype.stop = function () {
      if (this.ws) {
        this.isStop = true;
        this.ws.close();
      }
    };

    prototype.updateLocation = function () {};

    prototype.onOrientationChanged = function (e) {
      thisObject._heading = e;
    };
  };
  AOA_GuoBoProvider.prototype = Object.create(EventTrigger.prototype);
  AOA_GuoBoProvider.prototype.constructor = AOA_GuoBoProvider;

  var G5Provider = function (params) {
    EventTrigger.call(this);
    this.params = params;
    var thisObject = this;
    thisObject._updateInterval = null;
    thisObject._lastLocationResult = {
      latitude: 0,
      longitude: 0,
      floorIndex: 0,
      floorId: "",
      speed: 0,
      accuracy: 100,
      isIndoor: false,
      heading: 0,
      updateType: 0,
      source: 100,
      mGPSLocationType: 1,
      timeStamp: LocalizationUtils.getCurrentTime(),
    };

    var prototype = G5Provider.prototype;

    prototype.init = function (token) {
      this.token = token;
      this.socketManager = new WebSocketManager();
    };
    prototype.fini = function () {};

    prototype.start = function () {
      var url = (params["5G"]["wssUrl"] || "wss://map1a.daxicn.com/wss-hw-lcs/websocket/") + params["userId"];
      this.socketManager.createSocket(url, {
        onmessage: function (data) {
          this.update5GData(data["signal"] || data["data"]);
        },
      });
    };
    prototype.registerPhoneNumber = function (phone, successCB, failedCB) {
      //手机号订阅
      this.phone = phone;
      var thisObject = this;
      var url = params["5G"]["registUrl"] || "https://map1a.daxicn.com/server39/hw-lcs/location/periodic";
      LocalizationUtils.getDataJson(
        url,
        { id: phone },
        function (data) {
          if (typeof data == "string") {
            data = JSON.parse(data);
          }
          if (data["success"]) {
            thisObject.start();
            successCB && successCB(data);
          }
        },
        null,
        null,
        function (data) {
          failedCB && failedCB(data);
        },
      );
    };
    prototype.unregisterPhoneNumber = function (successCB, failedCB) {
      var thisObject = this;
      var url = params["5G"]["unregistUrl"] || "https://map1a.daxicn.com/server39/hw-lcs/location/cancel";
      LocalizationUtils.getDataJson(
        url,
        { id: this.phone },
        function (data) {
          if (typeof data == "string") {
            data = JSON.parse(data);
          }
          if (data["success"]) {
            thisObject.stop();
            successCB && successCB(data);
          }
        },
        null,
        null,
        function (data) {
          failedCB && failedCB(data);
        },
      );
    };
    prototype.update5GData = function (obj) {
      // locUpdate
      //处理定位数据
      // this.trigger("locUpdate",obj);
      this.trigger("5g", obj);
    };

    prototype.stop = function () {
      this.phone = "";
    };
    prototype.getOpenState = function () {
      if (this.phone) {
        return true;
      } else {
        return false;
      }
    };
    prototype.onOrientationChanged = function (e) {
      thisObject._heading = e;
    };
  };
  G5Provider.prototype = Object.create(EventTrigger.prototype);
  G5Provider.prototype.constructor = G5Provider;
  var bleOpened = true;
  MicroProgramDataProvider = function (params) {
    console.log("走了这里的逻辑-7", params);
    EventTrigger.call(this);
    var thisObject = this;
    thisObject._heading = 0;
    thisObject._isStart = false;
    thisObject.isLocated = false;

    WXAlert.init("logcontainer");

    function parseBeaconFromHash(beaconsStr) {
      var scanInfolist = [];
      var recordTime = LocalizationUtils.getCurrentTime();
      var headingArray = [];
      var beaconsInfo = beaconsStr.split(";");
      for (var i = 0; i < beaconsInfo.length; i++) {
        var arr = beaconsInfo[i].split(",");
        if (arr.length < 4) {
          continue;
        }
        var beaconScanInfo = new BeaconScanInfo();
        var macInfoArr = arr[0].split("_");
        beaconScanInfo.uuid = macInfoArr[0];
        beaconScanInfo.major = macInfoArr[1];
        beaconScanInfo.minor = macInfoArr[2];
        beaconScanInfo.fid = beaconScanInfo.major + "_" + beaconScanInfo.minor;
        beaconScanInfo.mac = macInfoArr[0] + LocalizationUtils.toHexStringFixLength(macInfoArr[1]) + LocalizationUtils.toHexStringFixLength(macInfoArr[2]);
        var rssi = (beaconScanInfo.rssi = parseInt(arr[1]));
        beaconScanInfo.heading = parseInt(arr[2]);
        beaconScanInfo.accuracy = parseInt(arr[3]);
        if (arr[4]) {
          //华为需要完整的UUID
          beaconScanInfo.rawuuid = arr[4];
        }
        beaconScanInfo.type = 0;
        beaconScanInfo.time = recordTime;
        if (rssi < MIN_BLE_SCAN_RSSI || rssi > -40) continue;
        scanInfolist.push(beaconScanInfo);
        headingArray.push(beaconScanInfo.heading);
      }
      return scanInfolist;
    }

    function parseResultFromHash(hash) {
      //"P,"
      var arr = hash.split(",");
      var result = {
        longitude: parseFloat(arr[0]),
        latitude: parseFloat(arr[1]),
        floorIndex: parseFloat(arr[2]),
        bdid: arr[3],
        floorId: arr[4],
        heading: parseFloat(arr[5]),
        accuracy: parseFloat(arr[6]),
        locType: arr[7],
        updateType: arr[8],
        t: parseFloat(arr[9]) || new Date().getTime(),
        isIndoorAreaGPS: parseFloat(arr[10]),
      };
      if (result["locType"] == "GPS") {
        delete result["floorIndex"];
        result["altitude"] = parseFloat(arr[2] || 0);
      }
      return result;
    }

    function parseGPSFromHash(hash) {
      var arr = hash.split(",");
      var gpsData = {
        longitude: parseFloat(arr[0]),
        latitude: parseFloat(arr[1]),
        heading: parseFloat(arr[2]),
        accuracy: parseFloat(arr[3]),
        t: parseFloat(arr[4]) || new Date().getTime(),
        altitude: parseFloat(arr[5] || 0),
        source: 100,
      };
      return gpsData;
    }

    function watchBeaconsSuccess(beacons) {
      var scanInfolist = [];
      var recordTime = LocalizationUtils.getCurrentTime();
      var headingArray = [];
      for (var i = 0; i < beacons.length; i++) {
        var beaconJson = beacons[i];
        var rssi = parseInt(beaconJson["rssi"]);
        var heading = parseFloat(beaconJson["heading"]);
        if (heading) {
          headingArray.push(heading);
        }

        if (rssi < MIN_BLE_SCAN_RSSI || rssi > -40) continue;

        var beaconScanInfo = new BeaconScanInfo();
        var beaconUUID = beaconJson["uuid"];
        var beaconMajor = LocalizationUtils.toHexStringFixLength(beaconJson["major"]);
        var beaconMinor = LocalizationUtils.toHexStringFixLength(beaconJson["minor"]);
        beaconScanInfo.uuid = beaconUUID;
        beaconScanInfo.major = beaconJson["major"];
        beaconScanInfo.minor = beaconJson["minor"];
        beaconScanInfo.rssi = rssi;
        beaconScanInfo.time = recordTime;
        beaconScanInfo.mac = beaconUUID + beaconMajor + beaconMinor;
        beaconScanInfo.fid = beaconJson["major"] + "_" + beaconJson["minor"];
        scanInfolist.push(beaconScanInfo);
      }
      return scanInfolist;
    }

    var gpsOpened = true;

    var locationTipObj = null;
    var bleTipNotice = null;
    var headingTipNotice = null;
    var headingTipNotice2 = null;
    var hashFirst = true;
    // var __isBleFirst = true;
    // var lastTime = Date.now();
    var currentHash = "";
    var lastHash = "";

    function getHash(data) {
      var hash;
      if (typeof data == "string") {
        hash = data;
      } else {
        // location hash 变化
        hash = window.location.hash;
        if (hash == lastHash) {
          return;
        }
        lastHash = currentHash;
        currentHash = hash;
        hash = window.location.hash;
        window.history.replaceState(
          {
            hash: hash,
          },
          "hashchageView",
          window.location.href,
        );
      }
      window.lastHashCount = window.history.length;
      if (hash && hash.length > 1) {
        try {
          if (hash[0] == "#") {
            hash = decodeURIComponent(hash.slice(1));
          }
          if (!command["useNormalLoc"] && window["indoorLocalAlgorithms"] == "huawei") {
            //GPS和蓝牙同时定位触发导致华为定位跳动，获取到GPS和蓝牙时去掉GPS
            if (hash.indexOf("G,") != -1 && hash.indexOf("B,") != -1) {
              hash = hash.replace(/G,(\d|,|\.)+\|/g, "");
            }
          }

          var paramArray = hash.split("|");
          var text = "请打开";
          for (var i = 0; i < paramArray.length; i++) {
            var param = paramArray[i];
            var index = param.indexOf(",");
            var type = param.slice(0, index);
            var data = param.slice(index + 1);

            if (type === "B") {
              if (window["command"] && window["command"]["disabledBLE"] && window["command"]["disabledBLE"] == "true") {
                continue;
              } else if (params["disabledBLE"] && window["command"]["disabledBLE"] != "false") {
                continue;
              }
              //parse BLEData
              var arr = data.split("~C~");
              var rawCount = arr.length >= 2 ? arr[1] : 0;
              var timeStamp = Date.now();
              if (rawCount && rawCount.indexOf("~t~") != -1) {
                var _arr = rawCount.split("~t~");
                rawCount = _arr[0];
                _arr[1] ? (timeStamp = parseInt(_arr[1])) : "";
              }
              data = arr[0];
              var bleData = parseBeaconFromHash(data);
              bleData.rawCount = rawCount;
              thisObject.trigger("ble", bleData, timeStamp);
            } else if (type === "G") {
              //parse GPSData
              if (!params["gpsLocByH5"] && !((window["command"] && window["command"]["disabledGPS"] == "true") || params["disabledGPS"])) {
                var gpsData = parseGPSFromHash(data);
                thisObject.trigger("gps", gpsData);
              }
            } else if (type === "H") {
              if (window["command"] && window["command"]["useMiniProjHeading"]) {
                var heading = parseFloat(data);
                var t = parseFloat(data.slice(data.indexOf(",") + 1));

                globalValues.headingWX = heading;
                globalValues.stepOrient = heading;
                var f = globalValues.orientationHistory.pop();
                while (f && f[1] < t) {
                  f = globalValues.orientationHistory.pop();
                }
                if (f) {
                  globalValues.headingDelta = heading - f[0];
                  //hglog.d("方向WXH5", globalValues.headingDelta, data, heading, t, f);
                }
                thisObject.trigger("heading", heading);
                //globalValues.debugInfo.orientation = "方向" + data + "," + Optimizer_instance.round(globalValues.headingDelta, 2);
              }
            } else if (type == "D") {
              //heading 状态
              if (window.location.search.indexOf("headingErrTip=true") != -1) {
                var msg = "Compass:" + data;
                //WXAlert.logCustom3(msg, 1, false, true);
              }
              if (data == "unreliable" || data == "unknow" || data == "low" || data == "no-contact") {
                if (window.location.search.indexOf("headingErrTip=true") != -1) {
                  if (!headingTipNotice2) {
                    var domString =
                      "<div style='width:80%; position:absolute; left:50%;top:50%;transform:translate(-50%, -80%);background: #fff; color: #666; text-align: center; font-size: 16px; padding:30px 10px;border-radius: 10px'><div style='padding:20px 0; font-size: 20px; color:#333'>罗盘校准</div><div style='padding:0 0 20px; font-size: 16px; color: #959595'>手机受到磁场干扰</div><div><img src='../../../map_sdk/map/assets/images/shake.gif' width='90%' alt=''></div><div style='padding:20px 0; font-size: 20px; color:#333'>请沿8字形校准手机</div><div style='padding:0 0 20px; font-size: 16px; color: #959595'>完成后定位更精准</div></div>";
                    headingTipNotice2 = window["DaxiMap"] && window["DaxiMap"]["DXMapUtils"].domUtil.tipDomMessage(domString);
                  } else {
                    headingTipNotice2.show();
                  }
                } else {
                  if (headingTipNotice) {
                    headingTipNotice.removed();
                    headingTipNotice = null;
                    headingTipNotice =
                      window["DaxiApp"] &&
                      window["DaxiApp"]["domUtil"].tipNotice("方向角不准,请检查校验方向角", 2000, null, {
                        bottom: "80%",
                        subStyle: {
                          color: "#2ba5fb",
                          "font-weight": 600,
                        },
                      });
                  }
                }
              } else {
                headingTipNotice2 && headingTipNotice2.hide();
                headingTipNotice2 = null;
              }
            } else if (type == "P") {
              var resData = parseResultFromHash(data);
              thisObject.trigger("result", resData);
            } else if (type == "locRes") {
              var resData = parseResultFromHash(data);
              if (location.search.indexOf("showLocMsg=true") != -1) {
                var msg = "小程序定位结果:" + JSON.stringify(resData);
                WXAlert.logCustom3(msg, 1, false, true);
              }
              thisObject.debugListener &&
                thisObject.debugListener.forEach(function (callback) {
                  callback &&
                    callback({
                      type: "minProgLocRes",
                      data: resData,
                    });
                });
            } else if (type == "GPS") {
              // GPS 状态变化
              var newGpsOpened = data == 0 ? false : true;
              if (newGpsOpened != gpsOpened) {
                thisObject.setGPSState(newGpsOpened);
                // thisObject.gpsStateListener && thisObject.gpsStateListener.forEach(function (callback) {
                //   callback && callback({
                //     "state": newGpsOpened
                //   });
                // });
              }
              // gpsOpened = newGpsOpened;
              // (gpsOpened == false) ? text += "位置服务": "";
            } else if (type == "BLE") {
              // BLE 状态变化
              var newBleOpened = data == 0 ? false : true;
              if (newBleOpened != bleOpened) {
                thisObject.setBleState(newBleOpened);
              }
              if (bleOpened == false) {
                if (gpsOpened == false) {
                  text += "与";
                }
                text += "蓝牙";
              }
            } else if (type == "ACC") {
              var arr = data.split(",");
              var x = arr[0],
                y = arr[1],
                z = arr[2];
              var AccData = { x: parseFloat(x), y: parseFloat(y), z: parseFloat(z) };
              var ACCEvent = new CustomEvent("ACCEvent", { detail: { accelerationIncludingGravity: AccData } });
              window.dispatchEvent(ACCEvent);
            }
          }
          // if (!bleOpened && (!bleTipNotice || bleTipNotice.removed())) {
          //   bleTipNotice = window["DaxiApp"]["domUtil"].tipNotice('请打开蓝牙', 2000, null, {
          //     "bottom": "80%",
          //     "subStyle": {
          //       "color": "#2ba5fb",
          //       "font-weight": 600
          //     }
          //   });
          // } else if (bleTipNotice) {
          //   bleTipNotice.hide();
          //   bleTipNotice = null;
          // }
          // if (!gpsOpened && (!locationTipObj || locationTipObj.removed())) {
          //   locationTipObj = window["DaxiApp"]["domUtil"].tipNotice('获取位置失败，请确认设备或当前环境是否能接受到定位', 2000, null, {
          //     "bottom": "80%",
          //     "subStyle": {
          //       "color": "#2ba5fb",
          //       "font-weight": 600
          //     }
          //   });
          //   // window["DaxiApp"]["domUtil"].tipNotice(text,2000,null,{"bottom":"80%","subStyle":{"color":"#2ba5fb","font-weight":600}});
          // } else if (locationTipObj) {
          //   locationTipObj.hide();
          //   locationTipObj = null;
          // }
          // window.history.replaceState({
          //   "hash": window.location.hash
          // }, "hashchageView", window.location.href);
          // if (window.history.length > 2 && window["command"] && window["command"]["container"] == "wechat") {

          //   if (hashFirst) {
          //     hashFirst = false;
          //     window.history.go(2 - window.history.length);

          //   } else {
          //     window.history.go(-1);

          //   }

          // }
        } catch (e) {
          console.log("error hash:", e);
          // if (window.history.length > 2 && window["command"] && window["command"]["container"] == "wechat") {
          //   // console.log("window.history.length:",window.history.length)
          //   if (hashFirst) {
          //     hashFirst = false;
          //     window.history.go(2 - window.history.length);
          //   } else {
          //     window.history.go(-1);
          //   }

          // }
        }
        // if(window.history.length > 2 && window["command"] && window["command"]["container"] == "wechat"){
        //   // console.log("window.history.length:",window.history.length)
        //   debugger
        //   window.history.go(2-window.history.length);
        // }
      }
    }
    window["hashchange"] = getHash;
    var prototype = MicroProgramDataProvider.prototype;

    prototype.init = function () {};
    prototype.fini = function () {};
    prototype.registBleStateListener = function (callback) {
      if (!this.bleStateListener) {
        this.bleStateListener = [];
      }
      this.bleStateListener.push(callback);
    };
    prototype.registGPSStateListener = function (callback) {
      if (!this.gpsStateListener) {
        this.gpsStateListener = [];
      }
      this.gpsStateListener.push(callback);
    };

    prototype.registDebugListener = function (callback) {
      if (!this.debugListener) {
        this.debugListener = [];
      }
      this.debugListener.push(callback);
    };
    prototype.start = function () {
      var command = window["command"] || {};
      console.log("链接socket--command", command["testLocWs"], command);
      try {
        if (navigator.userAgent.indexOf("AliApp") > -1 && window["my"] && window["my"]["postMessage"]) {
          window["my"]["onMessage"] = function (e) {
            var str = decodeURIComponent(e.hash);

            try {
              // window["hashchange"](str);
              getHash(str);
            } catch (e) {
              alert(e.toString());
            }
          };
        } else if (window["AlipayJSBridge"] && window["AlipayJSBridge"]["call"]) {
          window["AlipayJSBridge"] &&
            window["AlipayJSBridge"]["call"](
              "stopBeaconDiscovery",
              {
                uuids: [
                  "AB8190D5-D11E-4941-ACC4-42F30510B408",
                  "FDA50693-A4E2-4FB1-AFCF-C6EB07647825",
                  "FDA50693-A4E2-4FB1-AFCF-C6EB07647829",
                  "A6941001-B305-11E7-ABC4-CEC278B6B50A",
                  "5A4FEBC8-EDB2-B8F6-9492-42DD8AE715E9",
                  "B3CCF8A5-4B67-41DF-870F-D42E34229F25",
                ],
              },
              function (res) {},
            );
          window["AlipayJSBridge"] &&
            window["AlipayJSBridge"]["call"](
              "startBeaconDiscovery",
              {
                uuids: [
                  "AB8190D5-D11E-4941-ACC4-42F30510B408",
                  "FDA50693-A4E2-4FB1-AFCF-C6EB07647825",
                  "FDA50693-A4E2-4FB1-AFCF-C6EB07647829",
                  "A6941001-B305-11E7-ABC4-CEC278B6B50A",
                  "5A4FEBC8-EDB2-B8F6-9492-42DD8AE715E9",
                  "B3CCF8A5-4B67-41DF-870F-D42E34229F25",
                ],
              },
              function () {
                document.addEventListener("beaconUpdate", function (msg) {
                  var beacons = msg["data"]["beacons"];
                  var bleData = watchBeaconsSuccess(beacons);
                  bleData.rawCount = beacons.length;
                  thisObject.trigger("ble", bleData);
                });
              },
            );
        } else if (command && (command["testLocWs"] == "true" || command["testLocWs"] == true || command["postMessageWSS"])) {
          var locWebSocket = new WebSocketManager();
          console.log("走了这里---", command["testLocWs"]);
          locWebSocket.createSocket(params["wsLocUrl"], params);
          window["locWebSocketPostMessage"] = locWebSocket.postMessage;
        } else if (command["eventByWSS"]) {
          var locWebSocket = new WebSocketManager();
          locWebSocket.createSocket(params["wsLocUrl"], params);
          window["locWebSocketPostMessage"] = locWebSocket.postMessage;
          getHash();
          window.removeEventListener("hashchange", getHash);
          window.addEventListener("hashchange", getHash);
        } else {
          getHash();
          window.removeEventListener("hashchange", getHash);
          window.addEventListener("hashchange", getHash);
        }
      } catch (e) {
        alert(e.toString());
      }

      thisObject._isStart = true;
    };
    prototype.testOrientationChanged = function (event) {
      thisObject.trigger("heading", event["v"][0]);
    };

    prototype.testOnGPSUpdate = function (e) {
      var val = e["v"];
      var gpsData = {
        longitude: parseFloat(val[0]),
        latitude: parseFloat(val[1]),
        heading: parseFloat(e["h"]),
        accuracy: parseFloat(e["a"]),
        t: e["d"],
        source: 100,
      };
      thisObject.trigger("gps", gpsData);
    };

    thisObject._beaconScanLRU = {};
    prototype.testBleChanged = function (beacons) {
      var scanInfolist = [];
      var recordTime = beacons[0]["datetime"] || beacons[0]["t"];
      var headingArray = [];
      for (var i = 0; i < beacons.length; i++) {
        var beaconJson = beacons[i];
        var rssi = parseInt(beaconJson["rssi"]);
        var heading = parseFloat(beaconJson["heading"]);
        if (heading) {
          headingArray.push(heading);
        }
        if (rssi < MIN_BLE_SCAN_RSSI || rssi > -40) continue;
        var beaconScanInfo = new BeaconScanInfo();
        beaconScanInfo.rssi = rssi;
        beaconScanInfo.time = recordTime;
        beaconScanInfo.fid = beaconJson["major"] + "_" + beaconJson["minor"];
        scanInfolist.push(beaconScanInfo);
      }
      OnBLEScanUpdated(recordTime, scanInfolist);
      // if (headingArray.length > 0) {
      //   thisObject.trigger("heading", headingArray[0]);
      // }
    };
    prototype.resetLocalizationTimeStamp = function () {
      thisObject._preBeaconLocalizationTimeStamp = 0;
    };
    thisObject._intervalForBeaconLocalization = 1000;

    function OnBLEScanUpdated(timeStamp, scanInfolist) {
      putScanData(scanInfolist);
      if (timeStamp - thisObject._preBeaconLocalizationTimeStamp < thisObject._intervalForBeaconLocalization) {
        return;
      }
      var outputScanInfolist = [];
      popScanData(outputScanInfolist);
      if (outputScanInfolist.length > 0) {
        postBeaconData(timeStamp, outputScanInfolist);
      }
      thisObject._preBeaconLocalizationTimeStamp = timeStamp;
    }

    function putScanData(scanInfolist) {
      var lru = thisObject._beaconScanLRU;
      for (var i = 0; i < scanInfolist.length; i++) {
        var scanBeaconInfo = scanInfolist[i];
        //console.log("push rssi" + scanBeaconInfo.rssi);
        var fid = scanBeaconInfo.fid;
        if (lru.hasOwnProperty(fid)) {
          lru[fid].rssi += scanBeaconInfo.rssi;
          lru[fid].count++;
        } else {
          lru[fid] = scanBeaconInfo;
          lru[fid].count = 1;
        }
      }
    }

    function popScanData(scanInfoList) {
      var lru = thisObject._beaconScanLRU;
      for (var fid in lru) {
        if (lru.hasOwnProperty(fid)) {
          var beaconInfo = lru[fid];
          beaconInfo.rssi /= beaconInfo.count;
          var scanData = {
            id: beaconInfo.fid,
            rssi: beaconInfo.rssi,
          };
          scanInfoList.push(scanData);
        }
      }
      thisObject._beaconScanLRU = {};
    }

    function postBeaconData(timeStamp, beacons) {
      bleOpened = true;
      thisObject.trigger("ble", beacons, timeStamp);
    }

    prototype.postBeaconData = postBeaconData;

    prototype.stop = function () {
      if (thisObject._isStart === true) {
        window.removeEventListener("hashchange", getHash);
      }
    };

    prototype.onOrientationChanged = function (e) {
      thisObject._heading = e;
    };
    prototype.getBleState = function () {
      return bleOpened;
    };
    prototype.setBleState = function (status) {
      bleOpened = status == 0 ? false : true;
      this.bleStateListener &&
        this.bleStateListener.forEach(function (callback) {
          callback &&
            callback({
              state: bleOpened,
            });
        });
    };

    prototype.getGPSState = function () {
      return gpsOpened;
    };
    prototype.setGPSState = function (status) {
      gpsOpened = status == 0 ? false : true;
      this.gpsStateListener &&
        this.gpsStateListener.forEach(function (callback) {
          callback &&
            callback({
              state: gpsOpened,
            });
        });
    };
  };
  MicroProgramDataProvider.prototype = Object.create(EventTrigger.prototype);
  MicroProgramDataProvider.prototype.constructor = MicroProgramDataProvider;
  // PedProvider
  var PedProvider = function (localizationCore) {
    EventTrigger.call(this);
    var thisObject = this;
    thisObject._heading = 0;
    thisObject._isStart = false;
    var _stepCount = 0;
    var _isWalking = false;
    var _stepCounter = new StepCounter();
    var prototype = PedProvider.prototype;

    prototype.init = function () {};
    prototype.fini = function () {};
    prototype.start = function () {
      if (window["DeviceMotionEvent"]) {
        // if (isIOSDevice && !thisObject._isStart) {
        window.addEventListener("devicemotion", onAccChanged, false);
        window.addEventListener(
          "ACCEvent",
          function (data) {
            onAccChanged(data.detail);
          },
          false,
        );
        thisObject._isStart = true;
        // } else {
        //   window.addEventListener("devicemotion", onAccChanged, false);
        // }
      }
    };

    prototype.stop = function () {
      if (thisObject._isStart) {
        window.addEventListener("devicemotion", onAccChanged, false);
        window.addEventListener(
          "ACCEvent",
          function (data) {
            onAccChanged(data.detail);
          },
          false,
        );
      }
    };

    prototype.onOrientationChanged = function (e) {
      this._heading = e;
    };
    var gyroTimestamp = LocalizationUtils.getCurrentTime();
    var gyroInterval = 18;
    var gyroTimestamps = [];
    var gyroCount = 0;
    var lastAcceleration = null;

    function onAccChanged(event) {
      var gyro = event.rotationRate;
      var accGravity = event.accelerationIncludingGravity;
      var acc = event.acceleration;
      var currentTimeStamp = LocalizationUtils.getCurrentTime(); //event.time; // || LocalizationUtils.getCurrentTime();
      if (gyroCount == 0) {
        gyroTimestamp = currentTimeStamp;
      } else {
        gyroTimestamp += gyroInterval;
      }
      if (gyroCount % 100 == 0) {
        gyroTimestamps.push(currentTimeStamp);
      }
      while (gyroTimestamps.length > 100) {
        gyroTimestamps.pop();
      }
      if (gyroTimestamps.length > 1) {
        gyroInterval = (gyroTimestamps[gyroTimestamps.length - 1] - gyroTimestamps[0]) / (gyroTimestamps.length - 1) / 100;
      }
      gyroCount++;
      // Optimizer_instance.updateAcceleration(accGravity.x, accGravity.y, -accGravity.z, gyroTimestamp);
      // Optimizer_instance.updateGyroscope(gyro.alpha / 180 * Math.PI, gyro.beta / 180 * Math.PI, gyro.gamma / 180 * Math.PI, gyroTimestamp);
      // if(!lastAcceleration || (lastAcceleration.x != acc.x || lastAcceleration.y != acc.y || lastAcceleration.z!= acc.z)){
      //     locationLogManager.addData({
      //       "t": 13,
      //       "d": currentTimeStamp,
      //       "v": {"accGravity":{"x":accGravity.x,"y":accGravity.y,"z":accGravity.z},"acc":{"x":acc.x,"y":acc.y,"z":acc.z}},
      //     });
      //     lastAcceleration = acc;
      // }

      var accInterval = 16.666;
      if (_stepCounter.acc_norm.length < 2 || _stepCounter.step_arr.length < 2) {
        if (accInterval != 0) {
          _stepCounter.createTable(2000 / accInterval + 0.5);
        }
      } else {
        var countStep = _stepCounter.update(accGravity.x, accGravity.y, accGravity.z, currentTimeStamp);
        if (_stepCount < countStep) {
          _stepCount = countStep;
          if (!_isWalking) {
            _isWalking = true;
            sendStartWalkingEvent();
          }
          sendStepDetectedEvent(currentTimeStamp);
          return;
        }
      }
      if (currentTimeStamp - _stepCounter.lastTimeStamp >= DETECT_ACTION_TIME) {
        _isWalking = false;
        sendStopWalkingEvent();
      }
    }

    var rawPDRDistance = 0;
    var filterPDRDistance = 0;
    var currentStepCount = 0;

    function sendStepDetectedEvent(timeStamp) {
      var pedData = {
        step: _stepCount,
        heading: thisObject._heading,
        timeStamp: timeStamp,
      };
      if (window.location.search.indexOf("testBleVal=true") != -1 || window.location.search.indexOf("showLocMsg=true") != -1) {
        var msg = "Step:" + _stepCount;
        WXAlert.logCustom3(msg, 1, false, true);
      }
      thisObject.trigger("ped", pedData);
      return;
    }

    function sendStartWalkingEvent() {
      rawPDRDistance = 0;
      filterPDRDistance = 0;
      currentStepCount = 0;
    }

    function sendStopWalkingEvent() {}
  };
  PedProvider.prototype = Object.create(EventTrigger.prototype);
  PedProvider.prototype.constructor = PedProvider;

  // StationDetermine
  var BuildingDetermine = function (framework) {
    EventTrigger.call(this);
    var thisObject = this;
    thisObject._framework = framework;
    thisObject._buildingDetermineAlgo = null;
    var prototype = BuildingDetermine.prototype;
    prototype.init = function () {};

    prototype.fini = function () {};

    prototype.onGPSReport = function () {};
  };
  BuildingDetermine.prototype = Object.create(EventTrigger.prototype);
  BuildingDetermine.prototype.constructor = BuildingDetermine;
  // 允许定位类型
  var REGION_TYPE_GPS = 1;
  var REGION_TYPE_BLE_GPS = 2;
  var REGION_TYPE_BLE = 3;

  var REGION_TYPE_OUTDOOR = 1;
  var REGION_TYPE_PARK = 2;
  var REGION_TYPE_INDOOR = 3;
  // LocationComposer
  var LocationComposer = function (framework, params) {
    EventTrigger.call(this);
    var thisObject = this;
    thisObject._samplerArray = [];
    thisObject._signalLocResArray = [];
    thisObject._AOAResArray = [];
    thisObject._BLEResArray = [];
    thisObject._AOAToGPSResArray = [];
    thisObject._BLEToGPSResArray = [];
    thisObject._lastAccurateGPSTick = 0;
    thisObject._lastBleResetTime = 0;
    thisObject.mIsIndoor = false;
    thisObject._lastLocationResult = null;
    thisObject._lastRegionType = "";
    thisObject._beaconLocationSuccess = false;
    thisObject._stepCount = 0;
    // thisObject._locatingMapList = {};
    var SampleCount = 10;
    var InToOutThreshold = 0.4;
    var OutToInThreshold = 0.6;
    var LocationStatusUnknown = 0;
    var LocationStatusIndoor = 1;
    var LocationStatusOutdoor = 2;
    thisObject.params = params;
    thisObject._currentLocType = "UNKNOWN";

    var prototype = LocationComposer.prototype;
    prototype.init = function () {
      // this.parkExtent = { "type": "Feature", "properties": { "id": null }, "geometry": { "type": "Polygon", "coordinates": [[[117.38123796, 39.03113687], [117.38850101, 39.02397494], [117.38342503, 39.02088199], [117.37744391, 39.02609001], [117.37711895, 39.02679783], [117.37703986, 39.02761907], [117.37729649, 39.02847269], [117.37779625, 39.02903895], [117.37830149, 39.0294183], [117.38123796, 39.03113687]]] } };
      // this.indoorExtent = { "type": "Feature", "properties": { "id": null }, "geometry": { "type": "Polygon", "coordinates": [ [ [ 117.37738903, 39.02858502 ], [ 117.37762743, 39.02883773 ], [ 117.38133047, 39.03093771 ], [ 117.38429291, 39.02777288 ], [ 117.38353932, 39.0273128 ], [ 117.38438972, 39.02640868 ], [ 117.385165, 39.02684331 ], [ 117.38822777, 39.02359766 ], [ 117.38416814, 39.021307 ], [ 117.38111956, 39.02458033 ], [ 117.38167896, 39.02490477 ], [ 117.38092729, 39.02569053 ], [ 117.38036623, 39.02537386 ], [ 117.37738903, 39.02858502 ] ] ] } };
    };
    var pointInPolygon = function (pos, polygon) {
      if (!polygon) {
        return false;
      }
      var inside = false;
      var polygonSize = polygon.length;
      var val1, val2;
      for (var i = 0; i < polygonSize; i++) {
        var p1 = polygon[(i + polygonSize) % polygonSize];
        var p2 = polygon[(i + 1 + polygonSize) % polygonSize];
        if (pos[1] < p2[1]) {
          if (pos[1] >= p1[1]) {
            val1 = (pos[1] - p1[1]) * (p2[0] - p1[0]);
            val2 = (pos[0] - p1[0]) * (p2[1] - p1[1]);
            if (val1 > val2) {
              inside = !inside;
            }
          }
        } else if (pos[1] < p1[1]) {
          val1 = (pos[1] - p1[1]) * (p2[0] - p1[0]);
          val2 = (pos[0] - p1[0]) * (p2[1] - p1[1]);
          if (val1 < val2) {
            inside = !inside;
          }
        }
      }
      return inside;
    };

    prototype.fini = function () {
      thisObject._samplerArray = [];
    };

    prototype.onLocationResultUpdate = function (result, type) {
      if (result.longitude < 5 || result.latitude < 5) {
        return;
      }
      result.locType = result.locType || type;
      var locator = framework._locatorManager.getCurrentLocator();
      var building = this.checkinBuilding(locator, result);
      this._stepCount = result.step || this._stepCount;
      if (!result.bdid || !result.floorId) {
        this.checkIsIndoorStrategy(result, building);
      }
      if (building && this.building != building) {
        locator.onBuildingChanged({
          bdid: building.bdid,
        });
        this.building = building;
      }
      if (!result["force"]) {
        var changed = this.checkSwitcher(result, building);
        if (!changed) {
          return;
        }
      }

      this._lastLocationResult = result;
      result.step = this._stepCount;
      this.trigger("pos", result);
      if (window.location.search.indexOf("showLocMsg=true") != -1) {
        var msg = "resultType:" + (result.rawLocType || result.locType) + ",t:" + result.timeStamp + ",h:" + parseInt(result.heading) + ",";
        if (result.locType == "BLE") {
          // WXAlert.log2(msg, 1, false, true);
          // msg += "bltl:" + result.bltl  + ",";
          msg += "p:" + JSON.stringify(result.position) + ",";
          msg += "cac:" + result.cac;
          //WXAlert.log2(msg, 1, false, true);
        } else {
          msg += "p:" + JSON.stringify(result.position) + ",";
          msg += "acc" + result.accuracy;
          //WXAlert.log2(msg, 1, false, true);
        }
        WXAlert.logCustom(msg, 1, false, true);
      }

      this.lastResult = result;
    };

    // 切换器
    var aoaSteplength = isIOSDevice ? 30 : 20,
      aoaValidSave = isIOSDevice ? 4 : 2,
      minAoaStepLength = isIOSDevice ? 20 : 12;

    prototype.getMatchRegion = function (result, building) {
      var matchGeo = undefined;
      if (building && building["geofence"] && building["geofence"]["RegionGeoFence"]) {
        //混合定位区域
        building["geofence"]["RegionGeoFence"].forEach(function (item) {
          if (result["floorId"] && result["floorId"] != item["properties"]["FL_ID"]) {
            return;
          }
          var coodinates = item["geometry"]["coordinates"][0];
          if (pointInPolygon([result["position"][0], result["position"][1]], coodinates)) {
            matchGeo = item;
          }
        });

        // //如果当前有定位新定位不在区域里 且定位类型不是混合区域的定位类型 并且上一次定位类型跟当前不一样
        // if(this.lastResult && params["mixMajorLocType"] && !matchGeo && (Date.now() - result.timeStamp)<4000 && result.locType != params["mixMajorLocType"] && result.locType!=this.lastResult.locType){
        //   return false;
        // }

        // if (matchGeo && matchGeo["properties"]["LocType"] != result.locType && (this._currentLocType  != result.locType)) {
        //     return false;
        // }
      }
      return matchGeo;
    };

    prototype.checkSwitcher = function (result, building) {
      if (result.locType == "AOA") {
        if (result["aoa_data"] && result["aoa_data"]["pkt"] >= 2 && result["diffTime"] < 2) {
          if (this._AOAResArray.length > aoaSteplength) {
            this._AOAResArray.shift();
          }
          this._AOAResArray.push(result);
        }
      }

      var matchGeo = this.getMatchRegion(result, building);

      if (result.locType == "AOA") {
        if (
          (params["locRegionType"] == "BLE" && matchGeo && matchGeo["properties"]["LocType"] != "BLE") ||
          ((!params["locRegionType"] || params["locRegionType"] == "AOA") && (!matchGeo || matchGeo["properties"]["LocType"] != "AOA"))
        ) {
          result.accuracy = 30;
        }
        // else{
        // 	result.accuracy = 3;
        // }
      }
      // var locType = result.rawLocType ||result.locType;
      result.matchGeo = matchGeo;
      if (!this.lastResult || this.lastResult.locType == result.locType) {
        return result;
      } else {
        if (this[this.lastResult.locType + "To" + result.locType]) {
          return this[this.lastResult.locType + "To" + result.locType](result, matchGeo, building);
        } else {
          return result;
        }
      }
    };

    prototype.setBleData = function (bleData) {
      // if (this.lastResult && this.lastResult.locType == "AOA") {
      if (this._BLEResArray.length >= 10) {
        this._BLEResArray.shift();
      }
      this._BLEResArray.push(bleData);
      // }
    };
    prototype.AOAToBLE = function (result, matchGeo, building) {
      //result.locType == BLE
      // if (this.lastResult && this.lastResult.locType == "AOA") {
      var validCount = 0;
      var time = result.timeStamp;

      if (this.lastResult["aoa_data"] && time - this.lastResult["aoa_data"]["ts"] > 6000) {
        locationLogManager.addData({
          t: 14,
          d: time,
          msg: 'AOAToBLE: time - this.lastResult["aoa_data"]["ts"] > 6000 ',
        });
        return result;
      }
      // if(framework.strictLocArea){
      // 	if(!this.lastResult.matchGeo || this.lastResult.matchGeo["properties"]["LocType"] != "AOA"){
      // 		return result;
      // 	}
      // 	return false;

      // }
      if (this._BLEResArray.length >= 0) {
        // result
        this._BLEResArray.forEach(function (item) {
          if (item["result"]["bleinfo"]["distanceError"] <= 40 && time - item["result"]["timestamp"] <= 8000) {
            validCount++;
          }
        });
        if (validCount >= 0 || time - this.lastResult.timeStamp > 4000) {
          var aoaValidCount = 0;
          var maxPkt = 0;
          this._AOAResArray.forEach(function (item) {
            if (item["aoa_data"]) {
              var pkt = item["aoa_data"]["pkt"];
              if (isIOSDevice) {
                if (item["aoa_data"] && time - item["timeStamp"] <= 6000 && item["diffTime"] < 2 && pkt >= 5) {
                  //4
                  maxPkt = pkt > maxPkt ? pkt : maxPkt;
                  aoaValidCount++;
                }
              } else {
                if (item["aoa_data"] && time - item["timeStamp"] <= 6000 && item["diffTime"] < 3 && pkt >= 2) {
                  maxPkt = pkt > maxPkt ? pkt : maxPkt;
                  aoaValidCount++;
                }
              }
            } else if (time - item["timeStamp"] <= 6000 && item["diffTime"] < 3) {
              aoaValidCount++;
            }
          });
          // var maxInValid = isIOSDevice?6:3;
          //var bleTime = result.lblt; //蓝牙指纹的时间 有pkt的
          if (this._AOAResArray.length >= 20 && aoaValidCount < this._AOAResArray.length * 0.25) {
            //蓝牙定位成功且没有AOA数据后3秒
            this._AOAResArray = []; //清除AOA的历史缓存
            this._BLEResArray = [];
            locationLogManager.addData({
              t: 14,
              d: time,
              msg:
                "AOAToBLE: " +
                (this._AOAResArray.length >= 20 && aoaValidCount < this._AOAResArray.length * 0.25
                  ? "(this._AOAResArray.length >= 20 && aoaValidCount < this._AOAResArray.length*0.25)"
                  : "(time - this.lastResult.timeStamp)>3000 AOA时间是7秒之前"),
            });
            return result;
          }
        }
      }
      var currPos = this._lastLocationResult.position;
      // var distance = LocalizationUtils.distanceP2P(currPos[0], currPos[1], result["position"][0], result["position"][1]);
      // if(distance > 8 && this.lastResult.matchGeo&& (time - this.lastResult.timeStamp) <1200){ // 但时间内 定位差距比较大认为是错误的
      // 	return false;
      // }
      if (params["locRegionType"] == "BLE") {
        if (matchGeo && pointInPolygon([currPos[0], currPos[1]], matchGeo["geometry"]["coordinates"][0])) {
          // 蓝牙定位已经推到了AOA区域 切AOA
          framework.getAlgorithm()._localizationAlgorithm.clean();
          this._BLEResArray = [];
          return result;
        } else if (time - this.lastResult.timeStamp > 4000) {
          this._AOAResArray = []; //清除AOA的历史缓存
          this._BLEResArray = [];
          return result;
        }
      } else {
        // AOA 围栏
        var currMatchGeo = this.getMatchRegion(framework._locationResult, building);
        if (
          !currMatchGeo ||
          currMatchGeo["properties"]["LocType"] != "AOA" || //aoa 定位已经不在aoa区域
          time - this.lastResult.timeStamp > 4000 || // AOA时间间隔长了
          this._BLEResArray.length
        ) {
          //没有pkt参数且 AOA已经出了AOA区域
          this._AOAResArray = []; //清除AOA的历史缓存
          this._BLEResArray = [];

          return result;
        }
      }
    };
    prototype.BLEToAOA = function (result, matchGeo, building) {
      // if(framework.strictLocArea){
      // 	if(this.lastResult.matchGeo && this.lastResult.matchGeo["properties"]["LocType"] == "AOA" && matchGeo && matchGeo["properties"]["LocType"] == "AOA"){
      // 		framework.getAlgorithm()._localizationAlgorithm.clean();
      //         this._BLEResArray = [];
      // 		return result;
      // 	}
      // 	return false;
      // }
      var time = Date.now();
      if (result["aoa_data"]) {
        //目前国博的
        if (result["diffTime"] > 3) {
          //较早信号切换时视为无效
          return;
        }
        var minAOAChangePkt = isIOSDevice ? 6 : 2;
        if (!result["aoa_data"]["pkt"] && time - this.lastResult.lblt > 5000) {
          //无pkt值的情况 目前非国博的
          framework.getAlgorithm()._localizationAlgorithm.clean();
          this._BLEResArray = [];
          return result;
        } else if (result["aoa_data"]["pkt"] >= minAOAChangePkt && result["diffTime"] < 2) {
          //有pkt值的情况 非国博的
          var validCount = 0;
          this._AOAResArray.forEach(function (item) {
            if (item["aoa_data"] && item["diffTime"] <= 4 && item["aoa_data"]["pkt"] >= 3) {
              if (!isIOSDevice || item["aoa_data"]["pkt"] >= 5) {
                validCount++;
              }
            }
          });
          var strongSignal = isIOSDevice ? 13 : 5;
          var curCount = this._AOAResArray.length; //minAoaStepLength //curCount
          if (
            (curCount >= minAoaStepLength && validCount >= curCount * 0.7) ||
            (time - this.lastResult.lblt > 7000 && result["diffTime"] < 2 && result["aoa_data"]["pkt"] >= minAOAChangePkt) ||
            (result["aoa_data"]["pkt"] > strongSignal && validCount > curCount * 0.5)
          ) {
            // if ((curCount>=minAoaStepLength && validCount >= aoaSteplength*0.7)||(time - this.lastResult.lblt > 7000 && result["diffTime"] < 2 )) { //&& result["aoa_data"]["pkt"] >=minAOAChangePkt
            // 清除BLE定位 停用location setInterval
            framework.getAlgorithm()._localizationAlgorithm.clean();
            this._BLEResArray = [];
            return result;
          }
        }
        return false; //不切换
      }
      // else if (time - this.lastResult.lblt > 14000) {
      //     // framework.getAlgorithm()._localizationAlgorithm.clean();
      //     this._BLEResArray = [];
      //     locationLogManager.addData({
      //         "t": 14,
      //         "d": time,
      //         "msg": "BLEToAOA: " + 'time - this.lastResult.lblt>8000 蓝牙时间是8秒之前'
      //     })
      //     return result;
      // }
      else {
        var currPos = this._lastLocationResult.position;
        if (params["locRegionType"] == "BLE") {
          var currMatchGeo = this.getMatchRegion(framework._locationResult, building);
          if (!currMatchGeo || currMatchGeo["properties"]["LocType"] != "BLE") {
            // 蓝牙定位已经推到了AOA区域 切AOA
            // framework.getAlgorithm()._localizationAlgorithm.clean();
            this._BLEResArray = [];
            return result;
          }
        } else {
          if (matchGeo && matchGeo["properties"]["LocType"] == "AOA") {
            var coodinates = matchGeo["geometry"]["coordinates"][0];
            if (pointInPolygon([currPos[0], currPos[1]], coodinates)) {
              // 蓝牙定位已经推到了AOA区域 切AOA
              // framework.getAlgorithm()._localizationAlgorithm.clean();
              this._BLEResArray = [];
              return result;
            }
          }
        }
      }
      return false;
    };

    prototype.AOAToGPS = function (result, matchGeo, building) {
      var currMatchGeo = this.getMatchRegion(framework._locationResult, building);
      if (params["locRegionType"] == "AOA") {
        if (!currMatchGeo || currMatchGeo["properties"]["LocType"] == "GPS") {
          return result;
        }
      }
      if (this.lastResult && this.lastResult.locType == "AOA") {
        var validCount = 0;
        var nowTime = Date.now();
        var lastDiffTime = nowTime - this.lastResult.timeStamp;
        if (lastDiffTime < 10000 || result.accuracy > 15) {
          //  GPS 信号弱或者AOA 时间较新不GPS数据过滤
          return false;
        } else if (lastDiffTime > 30000 && result.accuracy < 6) {
          this._AOAToGPSResArray.length = 0;
          return result;
        } else if (result.accuracy < 10) {
          //做积累
          this._AOAToGPSResArray.push(result);
          if (this._AOAToGPSResArray.length > 15) {
            this._AOAToGPSResArray.shift();
          }
          var validCount = 0;
          this._AOAToGPSResArray.forEach(function (result) {
            if (nowTime - result.timeStamp < 20000) {
              validCount++;
            }
          });
          if (validCount > 7 && this._AOAToGPSResArray.length < validCount * 1.5) {
            this._AOAToGPSResArray.length = 0;
            return result;
          }
        }
      }
      return false;
    };
    prototype.GPSToAOA = function (result, matchGeo, building) {
      if (result["aoa_data"]) {
        if (result["aoa_data"]["pkt"] > 2 && result["diffTime"] < 6) {
          return result;
        } else {
          return false;
        }
      } else {
        if (matchGeo && matchGeo["properties"]["LocType"] == "AOA") {
          return result;
        }
        var currMatchGeo = this.getMatchRegion(framework._locationResult, building);
        if (params["locRegionType"] == "AOA") {
          if (currMatchGeo && currMatchGeo["properties"]["LocType"] == "AOA") {
            return result;
          }
        }
      }
      return result;
    };
    prototype.BLEToGPS = function (result, matchGeo, building) {
      var BLEToGPSMaxRssi = building["BLEToGPSMaxRssi"] || params["BLEToGPSMaxRssi"] || -79;

      if (this.lastResult && this.lastResult.locType == "BLE") {
        var validCount = 0;
        var nowTime = Date.now();
        var lastDiffTime = nowTime - (this.lastResult.lblt || this.lastResult.timeStamp);
        var gpsValidAcc = (building && building["gpsValidAcc"]) || params["gpsValidAcc"]; //||10;
        var _localizationAlgorithm = framework.getAlgorithm()._localizationAlgorithm;
        if (matchGeo && matchGeo["properties"]["LocType"] == "BLE") {
          var coodinates = matchGeo["geometry"]["coordinates"][0];
          if (pointInPolygon([this.lastResult["position"][0], this.lastResult["position"][1]], coodinates)) {
            // 定位都在蓝牙区域里
            this._BLEToGPSResArray.length = 0;
            return false;
          }
        }

        if (matchGeo && matchGeo["properties"]["LocType"] == "GPS") {
          //  && result.accuracy < gpsValidAcc
          var coodinates = matchGeo["geometry"]["coordinates"][0];
          if (
            (this.lastResult.floorId == matchGeo["properties"]["FL_ID"] &&
              pointInPolygon([this.lastResult["position"][0], this.lastResult["position"][1]], coodinates)) ||
            this.lastResult.maxRssi <= BLEToGPSMaxRssi
          ) {
            // 蓝牙定位已经推到了GPS区域 切GPS
            this._BLEToGPSResArray.length = 0;
            if (!params["gpspdr"]) {
              framework.getAlgorithm()._localizationAlgorithm.clean();
            }
            return result;
          }
        }
        // var lastFingerTime = this.lastResult &&(Date.now() - this.lastResult.timeStamp)||0 ;
        if (building["locRegionType"] == "BLE") {
          var currMatchGeo = this.getMatchRegion(framework._locationResult, building);
        }
        if (
          ((this.lastResult.maxRssi <= BLEToGPSMaxRssi && (!this.lastResult.matchGeo || this.lastResult.matchGeo["properties"]["LocType"] == "GPS")) ||
            (building["locRegionType"] == "BLE" && (!currMatchGeo || currMatchGeo["properties"]["LocType"] == "GPS"))) &&
          (!matchGeo || matchGeo["properties"]["LocType"] == "GPS")
        ) {
          this._BLEToGPSResArray.length = 0;
          if (!params["gpspdr"]) {
            framework.getAlgorithm()._localizationAlgorithm.clean();
          }
          return result;
        }

        var bleInvalidTime = (building && building["bleInvalidTime"]) || params["bleInvalidTime"] || 30000;
        if (lastDiffTime < bleInvalidTime || result.accuracy > gpsValidAcc) {
          //  GPS 信号弱或者BLE 时间较新不GPS数据过滤
          return false;
        }
        // else if (lastDiffTime >= 15000 && result.accuracy < 5) {

        //     this._BLEToGPSResArray.length = 0;
        //     // framework.getAlgorithm()._localizationAlgorithm.clean();
        //     _localizationAlgorithm && _localizationAlgorithm.updateGPSDataAsMeasureData(result, new Date().getTime());
        //     return result;
        // }
        else if (
          building["noGroundFloorDisableGPS"] &&
          (result.floorId != this.lastResult.floorId || (this.lastResult.matchGeo && this.lastResult.matchGeo["properties"]["LocType"] == "BLE"))
        ) {
          //非地面层定位 蓝牙区域里不应该切gps 应先到地面层或者出蓝牙区域
          return false;
        } else if (lastDiffTime > bleInvalidTime) {
          //|| result.accuracy <= gpsValidAcc
          this._BLEToGPSResArray.length = 0;

          if (!params["gpspdr"]) {
            framework.getAlgorithm()._localizationAlgorithm.clean();
          }
          return result;
        }
      }
      return false;
    };
    prototype.GPSToBLE = function (result, matchGeo, building) {
      var time = Date.now();
      var GPSToBLEMaxRssi = building["GPSToBLEMaxRssi"] || params["GPSToBLEMaxRssi"] || -76;
      // GPS区域全部画围栏 情况
      if (building["locRegionType"] == "GPS" && !matchGeo && !this.lastResult.matchGeo) {
        this._BLEToGPSResArray.length = 0;
        return result;
      }

      if (time - result.lblt < 2000 && result.maxRssi >= GPSToBLEMaxRssi) {
        if (matchGeo && matchGeo["properties"]["LocType"] == "BLE") {
          var coodinates = matchGeo["geometry"]["coordinates"][0];
          if (building["locRegionType"] != "GPS" || pointInPolygon([this.lastResult["position"][0], this.lastResult["position"][1]], coodinates)) {
            // GPS 定位已经推到蓝牙区域 切蓝牙，蓝牙需要重新积累否则，切GPS后会有可能切回蓝牙
            // framework.getAlgorithm()._localizationAlgorithm.clean();
            this._BLEToGPSResArray.length = 0;
            if (window.location.search.indexOf("showLocMsg=true") != -1) {
              WXAlert.logCustom5("BLE maxRssi:" + result.maxRssi + ",to Indoor", 1, false, true);
            }

            return result;
          }
        }
        var nowTime = Date.now();
        var lastDiffTime = nowTime - this.lastResult.timeStamp; //GPS定位结果与现在的时间差
        var gspInvalidTime = building["gspInvalidTime"] || params["gspInvalidTime"];
        // if(this.lastResult["accuracy"] > 15 || (!building["gspInvalidTime"]||lastDiffTime > building["gspInvalidTime"])){ //GPS 长时间没有切蓝牙
        var gpsValidAcc = (building && building["gpsValidAcc"]) || params["gpsValidAcc"] || 10;
        var validCount = 0;
        this._BLEResArray.forEach(function (item) {
          var bleInfo = item.result;
          if (nowTime - bleInfo.timestamp < 7000 && bleInfo.maxRssi >= -70) {
            validCount++;
          }
        });
        if (result.maxRssi >= -66 || validCount >= 4) {
          //很强信号 直接切 不判断围栏 室内GPS不可靠
          return result;
        }
        var lastResult = this.lastResult;
        if (lastResult.matchGeo) {
          var coodinates = lastResult.matchGeo["geometry"]["coordinates"][0];
          if (lastResult.matchGeo["properties"]["FL_ID"] == result.floorId && pointInPolygon([result["position"][0], result["position"][1]], coodinates)) {
            return false;
          }
          if (lastResult.accuracy < gpsValidAcc) {
            return false;
          }
        } else if (!building["locRegionType"] || building["locRegionType"] != "GPS") {
          return result;
        }

        if (!gspInvalidTime || lastDiffTime > gspInvalidTime) {
          //GPS 长时间没有,切蓝牙
          // framework.getAlgorithm()._localizationAlgorithm.clean();
          this._BLEToGPSResArray.length = 0;
          return result;
        }
      } else {
        // framework.getAlgorithm()._localizationAlgorithm.clean();
        return false;
      }
    };
    prototype.checkIsIndoorStrategy = function (result, locationConfig) {
      // var thisObject = this;
      // var locState = LocationStatusOutdoor; //LocationStatusUnknown;
      // result.isIndoor = false;
      // result.isIndoorAreaGPS = false;
      if (locationConfig == null) return;
      if (this.params["regionUrl"] && !locationConfig["regionData"] && !locationConfig["regdataLoading"]) {
        var url = this.params["regionUrl"].replace("{{token}}", this.params["token"]).replace("{{bdid}}", locationConfig["bdid"]);
        locationConfig["regdataLoading"] = true;
        LocalizationUtils.getDataText(url + "?t=" + new Date().getTime(), {}, function (t) {
          if (typeof t == "string") {
            var geodata = JSON.parse(t);
          } else {
            var geodata = t;
          }
          for (var key in geodata) {
            locationConfig[key] = geodata[key];
          }
        });
      }
      // var currTime = LocalizationUtils.getCurrentTime();
      // var indoorCoordinates = (locationConfig.indoorExtent && locationConfig.indoorExtent["geometry"]["coordinates"][0]);
      var parkCoordinates = locationConfig.parkExtent && locationConfig.parkExtent["geometry"]["coordinates"][0];
      if (!parkCoordinates) {
        return;
      }
      // if (result.locType == "AOA" && (window.location.search.indexOf("testBleVal=true") != -1 || window.location.search.indexOf("showLocMsg=true") != -1)) {
      //     // Optimizer_instance.updateLocation("BLE", result["position"][0], result["position"][1], 0, 2, currTime);
      //     result["diffTime"] = ((Date.now() - result["timeStamp"]) * 0.001).toFixed(2) * 1;
      //     var msg = "type: AOA " + result["timeStamp"] + "  diffTime:" + result["diffTime"] + "  confidence:" + result["confidence"] + "  position:" + JSON.stringify(result["position"]);
      //     if (result["aoa_data"]) {
      //         msg += "<br> pkt:" + result["aoa_data"]["pkt"];
      //         msg += " pkt1:" + result["aoa_data"]["pkt1"];
      //         msg += " pkt2:" + result["aoa_data"]["pkt2"];
      //     }
      //     WXAlert.logCustom(msg, 1, false, true);
      //     result.floorId && (result.isIndoor = true);
      //     locState = LocationStatusIndoor;
      //     return locState;
      // } else if (result.source != 100) { //蓝牙信号 室内或者园区蓝牙范围
      //     //通过Beacon判断是否为室内
      //     thisObject._lastBleResetTime = result.lblt;
      //     if (currTime - thisObject._lastBleResetTime > 15000) { // Beacon Location Failed
      //         thisObject._beaconLocationSuccess = false;
      //     } else {
      //         thisObject._beaconLocationSuccess = true;

      //     }
      //     // Optimizer_instance.updateLocation("BLE", result["position"][0], result["position"][1], 0, 2, currTime);
      //     if (thisObject._beaconLocationSuccess) { //蓝牙定位成功
      //         locState = LocationStatusIndoor;
      //         result.isIndoor = true;
      //     } else { // 通过范围判断是否在室内
      //         var inParkRegion = false;
      //         var pos = result["position"];
      //         var inIndoorRegion = pointInPolygon([pos[0], pos[1]], indoorCoordinates);
      //         if (inIndoorRegion) {
      //             locState = LocationStatusIndoor;
      //             result.isIndoor = true;
      //         }
      //     }
      //     return locState;
      // } else { //GPS信号, 辅助判断
      //     var centerPnt = locationConfig.center;
      //     // Optimizer_instance.updateLocation("GPS", result.longitude, result.latitude, 0, result.accuracy, currTime);
      //     var distance = LocalizationUtils.distanceP2P(centerPnt[0], centerPnt[1], result.longitude, result.latitude);
      //     var range = locationConfig.mRange || 500;
      var inParkRegion = false;
      inParkRegion = pointInPolygon([result.longitude, result.latitude], parkCoordinates);
      if (inParkRegion) {
        // 如果精度比较高直接使用
        if (locationConfig["forceCloseGPS"]) {
          return -1; //院区范围强制不使用GPS
        }
        if (!result.floorId) {
          result.floorIndex = locationConfig["groundFloorIndex"];
          result.floorId = locationConfig["groundFloorId"];
        }
        !result.bdid && (result.bdid = locationConfig.bdid);
        // var inIndoorRegion = pointInPolygon([result.longitude, result.latitude], indoorCoordinates);
        // if (!thisObject._lastLocationResult) { //第一次
        //     if (inIndoorRegion || inParkRegion) {
        //         result.isIndoor = true;
        //         result.isIndoorAreaGPS = true;
        //         locState = LocationStatusIndoor;
        //     }
        //     return locState;
        // } else {
        //     result.isIndoor = true;
        //     result.isIndoorAreaGPS = true;
        //     locState = LocationStatusIndoor;
        //     return locState
        // }
      }
      // else {
      //     result.bdid = "outdoor";
      //     result.isIndoor = false;
      //     if (result.accuracy < 20) {
      //         locState = LocationStatusOutdoor;
      //         thisObject._lastAccurateGPSTick = currTime;
      //     } else {
      //         var isPosNearByBuilding = ((distance - range - result.accuracy) <= 0);
      //         if (isPosNearByBuilding == false) {
      //             locState = LocationStatusOutdoor;
      //         }
      //     }
      // }
      // return locState;
      // }
    };
    prototype.checkinBuilding = function (locator, result) {
      var nearestBuilding = null;
      var buildingData = locator.getBuildingsData();
      if (!buildingData) {
        return nearestBuilding;
      }
      var pos = result.position;
      var bdlist = buildingData["list"] || buildingData["bdlist"] || buildingData["filelist"];
      var minDistance = Number.MAX_VALUE;
      var source = result.source;
      if (bdlist) {
        for (var key in bdlist) {
          var bdInfo = bdlist[key];
          if (source != 100) {
            if (bdInfo["bdid"] == result["bdid"]) {
              return bdInfo;
            }
          } else {
            if (locator._bdid && bdInfo["bdid"] == locator._bdid) {
              //bdInfo.indoorExtent["geometry"]["coordinates"][0]
              return bdInfo;
            }
            var center = bdInfo["center"];
            var range = bdInfo["mRange"] || 1000;
            var gpsOffset = bdInfo["gpsOffset"];
            var lon = pos[0],
              lat = pos[1];
            if (gpsOffset) {
              lon += gpsOffset[0];
              lat += gpsOffset[1];
            }
            var distance = LocalizationUtils.distanceP2P(center[0], center[1], lon, lat);
            if (distance < minDistance && distance < range * 2) {
              minDistance = distance;
              nearestBuilding = bdInfo;
            }
          }
        }
      }
      if (nearestBuilding && source == 100) {
        var gpsOffset = nearestBuilding["gpsOffset"];
        if (gpsOffset) {
          result.longitude += gpsOffset[0];
          result.latitude += gpsOffset[1];
          pos[0] = result.longitude;
          pos[1] = result.latitude;
        }
      }
      return nearestBuilding;
    };
  };

  LocationComposer.prototype = Object.create(EventTrigger.prototype);
  LocationComposer.prototype.constructor = LocationComposer;

  // FusionLocator
  var FusionLocator = function (framework, params) {
    //token, bdid, bsfUrl) {
    EventTrigger.call(this);
    var thisObject = this;
    thisObject._heading = 0;
    thisObject._baseRootPath = "";
    thisObject._localizationAlgorithm = null;
    thisObject._stationDetermine = null;
    thisObject._locationComposer = null;
    thisObject._configData = null;
    thisObject._lastLocationResult = null;
    thisObject._buidingsData = null;
    thisObject._deviceMotionDeneied = false;
    thisObject._isFirstBle = true;
    thisObject._lastScanBleTime = 0;
    var sessionKey = params["sskey"] || "",
      userId = params["userId"] || "",
      token = params["token"],
      bdid = params["bdid"],
      bsfUrl = params["configUrl"] || "";
    thisObject.sessionKey = sessionKey || "";
    thisObject.userId = userId;
    thisObject._lastOrientationUpdateTime = 0;
    var prototype = FusionLocator.prototype;

    prototype.init = function (sessionKey, userId) {
      var command = window["command"] || {};
      if (command["testVersion"]) {
        alert(window["version"]);
      }

      thisObject._stationDetermine = new BuildingDetermine();

      thisObject._fplocalizationAlgorithm = new BLEFingerprintAlgorithm.LocalizationAlgorithm(params, framework);
      thisObject._fplocalizationAlgorithm.init();
      thisObject._fplocalizationAlgorithm._onLocationUpdateCallback = thisObject.onLocationReport;
      // 三角定位
      thisObject._trilLocalizationAlgorithm = new BLETrilaterationAlgorithm.LocalizationAlgorithm(token, bdid, framework, bsfUrl);
      thisObject._trilLocalizationAlgorithm.init();
      thisObject._trilLocalizationAlgorithm._onLocationUpdateCallback = thisObject.onLocationReport;

      thisObject._locationComposer = new LocationComposer(framework, params);
      thisObject._locationComposer.init();
      thisObject._locationComposer.on("pos", thisObject.onLocationComposerResult);
    };

    prototype.fini = function () {
      if (thisObject._stationDetermine) {
        thisObject._stationDetermine.fini();
        thisObject._stationDetermine = null;
      }

      if (thisObject._locationComposer) {
        thisObject._locationComposer.fini();
        thisObject._locationComposer = null;
      }
    };
    prototype.setDeviceMotionDeneied = function () {
      thisObject._deviceMotionDeneied = true;
    };
    prototype.setBuildingsData = function (buidingsData) {
      var bdlist = buidingsData["list"] || buidingsData["bdlist"] || buidingsData["filelist"];
      bdlist.forEach(function (bdInfo) {
        if (!bdInfo["center"] && bdInfo["location"]) {
          bdInfo["center"] = bdInfo["location"].split(",").map(function (str) {
            return parseFloat(str);
          });
          bdInfo["mRange"] = bdInfo["center"][2];
        }
        if (!bdInfo["indoorExtent"] && bdInfo["data"] && bdInfo["data"]["rect"]) {
          var polygon = [];
          var arr = bdInfo["data"]["rect"].split(",").map(function (str) {
            return parseFloat(str);
          });
          var polygon = [
            [arr[0], arr[1]],
            [arr[2], arr[1]],
            [arr[2], arr[3]],
            [arr[0], arr[3]],
            [arr[0], arr[1]],
          ];
          bdInfo["indoorExtent"] = {
            type: "Feature",
            properties: {
              id: null,
            },
            geometry: {
              type: "Polygon",
              coordinates: [polygon],
            },
          };
        }
        if (!bdInfo["parkExtent"]) {
          bdInfo["parkExtent"] = bdInfo["indoorExtent"];
        }
        if (!bdInfo["groundFloorIndex"]) {
          bdInfo["groundFloorIndex"] = 0;
        }
        if (!bdInfo["groundFloorId"]) {
          bdInfo["groundFloorId"] = bdInfo["data"]["initfloor"];
        }
      });

      thisObject._buidingsData = {
        bdlist: bdlist,
      };
      thisObject._buidingsData.maxBounds = buidingsData["maxBounds"];
      thisObject._buidingsData.showOutDoorMap = buidingsData["showOutDoorMap"];
      thisObject._buidingsData.location = buidingsData["location"];
      if (thisObject._lastBdid) {
        var bdInfo = thisObject.getBDInfoDataByBDID(thisObject._lastBdid);
        bdInfo && thisObject.onBuildingChanged(bdInfo);
      }
      var options = {
        enableHighAccuracy: true,
        timeout: 5000,
        maximumAge: 0,
      };
      // if( window["command"]["mapType"] !="unimap" && window["command"]["buildingId"] != "B000A11DPG" && !window["command"]["disabledH5Location"] ){
      //     navigator.geolocation.getCurrentPosition(function (pos) {
      //         var crd = pos.coords;
      //         var pos = GCJ2WGSUtils.wgs84_To_Gcj02(crd["latitude"], crd["longitude"])
      //         var gpsData = {
      //             "longitude": pos["lon"],
      //             "latitude": pos["lat"],
      //              "altitude": crd["altitude"],
      //             "heading": 0,
      //             "accuracy": crd["accuracy"],
      //             "t": new Date().getTime(),
      //             "source": 100,
      //             "geoLocated": true
      //         };

      //         var providerManager = framework._providerManager.getProvider("micro");
      //         ;
      //         providerManager.trigger("gps", gpsData);

      //     }, function (err) {
      //         console.log(err.message);
      //     }, options);
      // }
    };

    prototype.getBuildingsData = function () {
      return thisObject._buidingsData;
    };
    prototype.getFloorIndex = function (bdid, floorId) {
      var bdInfo = this.getBDInfoDataByBDID(bdid);
      if (bdInfo) {
        if (bdInfo["locatingMap"]) {
          for (var flindex in bdInfo["locatingMap"]) {
            if (bdInfo["locatingMap"][flindex] == floorId) {
              return flindex;
            }
          }
        } else {
          var floors = bdInfo["data"]["floors"];
          for (var i in floors) {
            if (floors[i]["flid"] == floorId) {
              return floors[i]["flindex"];
            }
          }
        }
      }
      return null;
    };
    prototype.getBDInfoDataByBDID = function (bdid) {
      if (!thisObject._buidingsData) {
        return null;
      }
      var buidingsData = thisObject._buidingsData["bdlist"];
      var bdInfo = null;
      buidingsData.forEach(function (item) {
        if (item.bdid == bdid) {
          bdInfo = item;
        }
      });
      return bdInfo;
    };
    prototype.clean = function () {
      thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.clean(true);
    };
    prototype.reset = function () {
      thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.reset(true);
    };

    prototype.start = function () {
      var providerManager = framework._providerManager;
      //ios heading
      var orientation = null;
      var thisObject = this;
      // if (!window["command"] || !window["command"]["disableH5Heading"]) {

      // }
      if (bdid) {
        var bdInfo = thisObject.getBDInfoDataByBDID(bdid);
        bdInfo && thisObject.onBuildingChanged(bdInfo);
      }
      {
        var mp = providerManager.getProvider("micro");
        if (mp) {
          // 不同信号的监听 使用
          mp.on("gps", this.onGPSReport);
          mp.on("ble", this.onBleReport);
          //android heading
          mp.on("heading", this.onHeadingReport);
          mp.on("result", this.onLocReport);
          mp.on("aoa", this.onAoaReport);

          mp.start(thisObject.sessionKey, thisObject.userId);
          var options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0,
          };
          var command = window["command"] || {};
          if (command["mapType"] != "unimap" && command["buildingId"] != "B000A11DPG" && !command["disabledH5Location"]) {
            navigator.geolocation.getCurrentPosition(
              function (pos) {
                var crd = pos.coords;
                var pos = GCJ2WGSUtils.wgs84_To_Gcj02(crd["latitude"], crd["longitude"]);
                var gpsData = {
                  longitude: pos["lon"],
                  latitude: pos["lat"],
                  heading: 0,
                  altitude: crd["altitude"],
                  accuracy: crd["accuracy"],
                  t: new Date().getTime(),
                  source: 100,
                  geoLocated: true,
                };
                mp.trigger("gps", gpsData);
              },
              function (err) {
                console.log(err.message);
              },
              options,
            );
          }
          // if (command["sendLocType"] && command["mapType"] !="unimap" && (command["sendLocType"] == "wss" && command["gpsLocByH5"])) {
          if (
            params["gpsLocByH5"] ||
            (command["sendLocType"] &&
              command["mapType"] != "unimap" &&
              (command["sendLocType"] == "h5" || command["gpsLocByH5"]) &&
              !command["disabledH5Location"])
          ) {
            navigator.geolocation.watchPosition(
              function (pos) {
                var crd = pos.coords;
                var pos = GCJ2WGSUtils.wgs84_To_Gcj02(crd["latitude"], crd["longitude"]);
                var gpsData = {
                  longitude: pos["lon"],
                  latitude: pos["lat"],
                  heading: 0,
                  altitude: crd["altitude"],
                  accuracy: crd["accuracy"],
                  t: new Date().getTime(),
                  source: 100,
                  geoLocated: true,
                };
                mp.trigger("gps", gpsData);
              },
              function (err) {
                console.log(err.message);
              },
              options,
            );
          }
        }
      }
      {
        var aoa = providerManager.getProvider("aoa");
        if (aoa) {
          aoa.on("aoa", this.onAoaReport);
          aoa.start();
        }
      }
      {
        var ped = providerManager.getProvider("ped");
        orientation = providerManager.getProvider("orientation");

        if (ped) {
          if (orientation) {
            orientation.on("heading", this.onHeadingReport);
          }
          ped.on("ped", this.onPedReport);
          WXAlert.showDeviceMotionDialog(
            function () {
              orientation && orientation.start();
              ped.start();
            },
            function () {
              framework.showDeviceMotionDenyTip();
              thisObject.setDeviceMotionDeneied(true);
            },
          );
        }
      }
      //
      {
        var _5gProvider = providerManager.getProvider("5gProvider");
        if (_5gProvider) {
          _5gProvider.on("5g", this.on5GReport);
          _5gProvider.start();
        }
      }
    };

    prototype.stop = function () {};

    prototype.getConfigData = function () {
      return thisObject._configData;
    };
    prototype.getBeaconData = function () {
      return thisObject._localizationAlgorithm.getBeaconData();
    };

    prototype.onOrientationChanged = function (angel) {
      thisObject._heading = angel;
      var currTime = LocalizationUtils.getCurrentTime();
      thisObject._localizationAlgorithm.updateOrientation(angel);
      locationLogManager.addData({
        t: 3,
        d: currTime,
        v: [angel, 0, 0],
      });
      if (currTime - thisObject._lastOrientationUpdateTime > 2000) {
        if (thisObject._lastLocationResult) {
          thisObject._lastLocationResult.heading = angel;
        }
        thisObject._lastOrientationUpdateTime = currTime;
      }
    };
    prototype.onGPSReport = function (data) {
      var bdid = thisObject._bdid;
      var initFloor;
      if (bdid) {
        var bdInfo = thisObject.getBDInfoDataByBDID(bdid);
        initFloor = bdInfo["data"]["initfloor"];
      }
      /*武研GPS偏移纠正*/
      // return;
      // data.longitude -= 0.00003015;
      // data.latitude -= 0.00009254;
      locationLogManager.addData({
        t: 7,
        d: new Date().getTime(),
        v: [data.longitude, data.latitude, data.altitude],
        a: data.accuracy,
        h: thisObject._heading,
        type: "GPS1",
        floorId: data.floorId || initFloor,
      });
      if (window.location.search.indexOf("showLocMsg=true") != -1) {
        var msg =
          "获取GPS原始定位 ------ :" + data.longitude + "," + data.latitude + "," + data.altitude + " acc: " + data.accuracy + ",floorID:" + data.floorId ||
          initFloor;
        WXAlert["log"](msg, 1, false, true);
      }
      var matched = RoadMapMatcher.matchRoadMap(
        data.longitude,
        data.latitude,
        data.altitude || 0,
        data.floorId || initFloor,
        RoadMapMatcher.GPS,
        data.accuracy || 0,
        0,
        thisObject._heading,
        new Date().getTime(),
      );
      if (matchRouter) {
        data.rawLonLat = { longitude: data.longitude, latitude: data.latitude, altitude: data.altitude };
        data.longitude = matched[0];
        data.latitude = matched[1];
        if (window.location.search.indexOf("showLocMsg=true") != -1) {
          var msg = "GPS抓路后定位 ------ :" + matched[0] + "," + matched[1] + ",floorID:" + (data.floorId || initFloor);
          WXAlert["log2"](msg, 1, false, true);
          locationLogManager.addData({
            t: 7,
            d: new Date().getTime(),
            v: [matched[0], matched[1], data.altitude],
            a: data.accuracy,
            h: thisObject._heading,
            type: "GPS2",
            floorId: data.floorId || initFloor,
          });
        }
      }

      if (thisObject._heading != undefined) {
        data.heading = thisObject._heading;
      }

      if (!thisObject._buidingsData) {
        data.position = [data.longitude, data.latitude];
        data.source = 100;
        thisObject._locationComposer.onLocationResultUpdate(data, "GPS");
        return;
      }
      // ?????
      // if (data["geoLocated"] && thisObject._locationComposer._lastLocationResult && !thisObject._locationComposer._lastLocationResult["geoLocated"]) {
      //     return;
      // }
      if (thisObject._buidingsData) {
        data.accuracy = data.accuracy * (thisObject._buidingsData["GPSAccuracyScale"] || 0.1);
        if (thisObject._buidingsData.location && thisObject._buidingsData.location["disableGPS"]) {
          return;
        }
        if (thisObject._buidingsData.maxBounds) {
          //地图范围之外的过滤掉
          var maxBounds = thisObject._buidingsData.maxBounds;
          if (data.longitude < maxBounds[0][0] || data.longitude > maxBounds[1][0] || data.latitude < maxBounds[0][1] || data.latitude > maxBounds[1][1]) {
            return;
          }
        }
      }
      //SendHash
      data.position = [data.longitude, data.latitude];
      data.source = 100;

      var now = Date.now();
      data.timeStamp = (data.t && now - data.t < 10000 && data.t) || Date.now();

      thisObject._locationComposer.onLocationResultUpdate(data, "GPS");
      ////定位日志上传
      // locationLogManager.addData({
      //     "t": 7,
      //     "d": data.t || data.timeStamp,
      //     "v": data.position,
      //     "a": data.accuracy,
      //     "h": data.heading,
      //     "f":data.floorId
      // })
    };
    prototype.onLocReport = function (data) {
      if (data["locType"] == "GPS") {
        if (window.location.search.indexOf("showLocMsg=true") != -1) {
          var msg = "获取GPS原始定位 ------ :" + data.longitude + "," + data.latitude + "," + data.altitude;
          WXAlert["log"](msg, 1, false, true);
          locationLogManager.addData({
            t: 7,
            d: new Date().getTime(),
            v: [data.longitude, data.latitude, data.altitude],
            a: data.accuracy,
            h: thisObject._heading,
            type: "GPS1",
            floorId: data.floorId,
          });
        }
        var matched = RoadMapMatcher.matchRoadMap(
          data.longitude,
          data.latitude,
          data.altitude || 0,
          data.floorId,
          RoadMapMatcher.GPS,
          data.accuracy || 0,
          0,
          thisObject._heading,
          new Date().getTime(),
        );
        if (matchRouter) {
          data.rawLonLat = { longitude: data.longitude, latitude: data.latitude, altitude: data.altitude };
          data.longitude = matched[0];
          data.latitude = matched[1];
        }

        if (window.location.search.indexOf("showLocMsg=true") != -1) {
          var msg = "GPS抓路后定位 ------ :" + matched[0] + "," + matched[1];
          // WXAlert["log2"](msg, 1, false, true);
          locationLogManager.addData({
            t: 7,
            d: new Date().getTime(),
            v: [matched[0], matched[1], data.altitude],
            a: data.accuracy,
            h: thisObject._heading,
            type: "GPS2",
            floorId: data.floorId,
          });
        }
      }
      if (thisObject._heading != undefined) {
        data.heading = thisObject._heading;
      }
      data["position"] = [data["longitude"], data["latitude"], data["floorIndex"]];
      thisObject._fplocalizationAlgorithm._onLocationUpdateCallback(data);
      // thisObject.onLocationComposerResult(data);
    };
    prototype.onBleReport = function (beacons, timeStamp) {
      var command = window["command"] || {};
      var currTime = Date.now();
      if (window["command"] && window["command"]["onlyShowBle"]) {
        var msg = "原始蓝牙数：" + beacons.length;
        beacons.forEach(function (item) {
          msg += "</br>" + (item.fid || item.major + "_" + item.minor) + "_" + item["rssi"];
        });
        WXAlert.log(msg, 1, false, true);
        return;
      }
      if (
        (thisObject._buidingsData && window["command"] && command["ignoreGps"]) ||
        !thisObject._lastLocationResult ||
        !thisObject._lastLocationResult.floorId ||
        currTime - thisObject._lastScanBleTime > 60000
      ) {
        //请求判断building 然后定位
        var url = "https://map1a.daxicn.com/daxi-manager/api/map/queryBuildingByBLE";
        var beaconsStr = "";
        beacons.forEach(function (item) {
          beaconsStr.length > 0 ? (beaconsStr += ",") : "";
          beaconsStr += item.fid || item.major + "_" + item.minor;
        });
        var data = { token: params["token"] || command["token"], beacons: beaconsStr };
        LocalizationUtils.getDataJson(
          url,
          data,
          function (data) {
            if (typeof data == "string") {
              data = JSON.parse(data);
            }
            if (data.code == 200) {
              var result = data["result"];
              var bdid = result["bdid"];
              if (bdid && (!thisObject._lastLocationResult || bdid != thisObject._lastLocationResult.bdid)) {
                thisObject.onBuildingChanged({ bdid: bdid }, function () {
                  thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.updateScan(beacons, timeStamp);
                });
              }
              thisObject._lastScanBleTime = currTime;
            }
          },
          null,
          null,
          function (err) {
            console.log("蓝牙判别区域失败");
          },
        );
      }
      if (thisObject._isFirstBle) {
        // 通过蓝牙判断当前bdid 切换 building
        thisObject._isFirstBle = false;
        thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.updateScan(beacons, timeStamp);
      } else {
        // var diffTime = (currTime - timeStamp < 2500)?(2500-(currTime - timeStamp)):10;
        // setTimeout(function(){
        thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.updateScan(beacons, timeStamp);
        // },diffTime);
      }

      beacons.forEach(function (item) {
        if (!item.mac && item.fid) {
          var arr = item.fid.split("_");
          if (arr.length == 2) {
            item.mac = "FDA5" + LocalizationUtils.toHexStringFixLength(arr[0]) + LocalizationUtils.toHexStringFixLength(arr[1]);
          }
        }
        locationLogManager.addData({
          t: 6,
          d: item.time || currTime,
          r: item.rssi,
          f: item.mac,
          h: item.heading,
        });
      });
    };
    prototype.onAoaReport = function (data) {
      if (data.heading == undefined) {
        data.heading = thisObject._heading;
      }
      data.position = [data.longitude, data.latitude];

      // if(thisObject._localizationAlgorithm.locationFramework._routeMatcher._curPolyline){
      //     //导航不处理

      // }else{
      //     data["accuracy"] =  parseFloat(data["accuracy"]||3);
      // }
      data["accuracy"] = parseFloat(data["accuracy"] || 8);
      var now = Date.now();
      data.timeStamp = (data.t && now - data.t < 10000 && data.t) || Date.now();
      data.source = 100;
      //定位日志上传
      var points = data["point"];
      var map_id = data["map_id"];
      var use_type = data["use_type"];
      locationLogManager.addData({
        t: 11,
        d: new Date().getTime(),
        pos: [data["longitude"], data["latitude"]],
        flid: data["floorId"],
        bdid: data["bdid"],
        locType: data["locType"],
        raw: {
          map_id: map_id,
          points: points,
          aoa_data: data["aoa_data"] || "",
          use_type: use_type,
          confidence: data["confidence"],
        },
      });
      data["locType"] = "AOA";
      // data["rawLocType"] = "AOA";

      thisObject._locationComposer.onLocationResultUpdate(data, "GPS");
      // thisObject._locationComposer.onLocationResultUpdate(data, "aoa");
    };
    prototype.on5GReport = function (data) {
      var location = {
        bdid: data["bdid"],
        longitude: data["longitude"],
        latitude: data["latitude"],
        position: [data["longitude"], data["latitude"], data["floorId"]],
        // "updateType": UPDATE_TYPE_BLE,
        heading: thisObject._heading,
        timeStamp: new Date().getTime(),
        floorId: data["floorId"],
        speed: "",
        rawLocType: "5G",
        locType: "AOA",
        accuracy: data["accuracy"] || 3,
        //   "force":true
      };
      // thisObject._localizationAlgorithm.setLocation(location["floorId"],data["longitude"], data["latitude"],0.5);
      thisObject._locationComposer.onLocationResultUpdate(location);
    };
    prototype.onOtherReport = function (data) {};
    prototype.onHeadingReport = function (data) {
      // globalValues.orientationHistory.push([data, Date.now()]);
      // while (globalValues.orientationHistory.length > 1000) {
      //     globalValues.orientationHistory.pop();
      // }
      // //hglog.d("onHeadingReport 14254", data, globalValues.headingWX, globalValues.headingDelta, data + globalValues.headingDelta);
      // globalValues.headingH5 = data;
      // data += globalValues.headingDelta;
      if (params["showLocMsg"] || (window["command"] && window["command"]["showLocMsg"])) {
        WXAlert.logCustom4("heading:" + data, 1, false, true);
      }
      window["DXWXLocEvent"].trigger("heading", data);
      if (data !== thisObject._heading) {
        thisObject._heading = data;
        if (thisObject._localizationAlgorithm) {
          thisObject._localizationAlgorithm.updateOrientation(data);
        }
        framework.setDirty();
        var currTime = LocalizationUtils.getCurrentTime();
        locationLogManager.addData({
          t: 3,
          d: currTime,
          v: [data, 0, 0],
        });
      }
    };

    prototype.onLocationReport = function (data) {
      //sendHash
      locationLogManager.addData({
        t: 16,
        d: data.timeStamp,
        v: data,
      });

      thisObject._lastLocationResult = data;

      framework.onLocalizationSucceed(data);
      if (data.sls && data.sls.length > 0) {
        var wxLoc = this.locationFramework._providerManager.getProvider("micro");
        if (wxLoc.debugListener && wxLoc.debugListener.length > 0) {
          wxLoc.debugListener[0]({
            type: "sls",
            data: data.sls,
          });
        }
      }
    };

    prototype.onPedReport = function (data) {
      if (thisObject._localizationAlgorithm) {
        data.heading = data["heading"] || thisObject._heading;
        thisObject._localizationAlgorithm.updateStep(data);
        locationLogManager.addData({
          t: 4,
          d: data.timeStamp,
          s: data.step,
          v: data.heading,
        });
      }
    };
    prototype.testStepUpdate = function (data) {
      thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.updateStep({ timeStep: data["d"], stepCount: data["s"], heading: data["v"] });
    };

    prototype.onLocationComposerResult = function (data) {
      if (!isIOSDevice) {
        data.heading = thisObject._heading;
      }
      data.floorIndex = data.floorIndex || 0;
      data.floorId = data.floorId || "";
      data.bdid = data.bdid || "";
      data.accuracy = data.cac || data.accuracy;

      if (data.locType === "BLE") {
        if (thisObject._buidingsData) {
          var scale = thisObject._buidingsData["BLEAccuracyScale"] || 1.0;
          data.cac = data.cac * scale;
          data.accuracy *= scale;
        }

        thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.updateBLEDataAsMeasureData(data, new Date().getTime());
      } else {
        // 非BLE按GPS处理
        if (thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.updateGPSDataAsMeasureData) {
          if (params["gpspdr"]) {
            thisObject._localizationAlgorithm.updateGPSDataAsMeasureData(data, new Date().getTime());
          } else {
            if (!data["nopdr"] && data["locType"] != "GPS") {
              //native 传输数据  (data["locType"]!="GPS" || (!thisObject._lastLocationResult || thisObject._lastLocationResult.locType == data.locType))
              thisObject._localizationAlgorithm.updateGPSDataAsMeasureData(data, new Date().getTime());
              return;
            }
            thisObject._lastLocationResult = data;
            framework.onLocalizationSucceed(data);
          }
        } else {
          thisObject._lastLocationResult = data;
          framework.onLocalizationSucceed(data);
        }
      }
    };
    prototype.onBuildingChanged = function (data, callback) {
      if (thisObject._deviceMotionDeneied) {
        framework.showDeviceMotionDenyTip();
      }
      if (data && data.bdid) {
        if (thisObject._bdid !== data.bdid) {
          var bdInfo = thisObject.getBDInfoDataByBDID(data.bdid);
          if (!bdInfo) {
            thisObject._lastBdid = data.bdid;
            return;
          }
          if (matchRouter) {
            RoadMapMatcher.setRoadMap(token, data.bdid);
          }
          thisObject._bdid = bdInfo.bdid;
          var algorithm = bdInfo.algorithm;
          if (algorithm == "fingerprint") {
            thisObject._localizationAlgorithm = thisObject._fplocalizationAlgorithm;
          } else {
            thisObject._localizationAlgorithm = thisObject._trilLocalizationAlgorithm;
          }
          // change Building
          thisObject._localizationAlgorithm.stop();
          thisObject._localizationAlgorithm.start(
            data.bdid,
            function (configData) {
              thisObject._configData = configData;
              callback && callback();
            },
            bdInfo,
          );
        } else if (thisObject._configData) {
          callback && callback();
        }
      } else {
        thisObject._localizationAlgorithm = thisObject._fplocalizationAlgorithm; //解决未进入园区范围内 GPS定位无法生效的问题
      }
    };
  };
  // HuaweiLocator
  var HuaweiLocator = function (framework, params) {
    var thisObject = this;
    thisObject._heading = 0;
    thisObject._baseRootPath = "";
    thisObject._localizationAlgorithm = null;
    thisObject._stationDetermine = null;
    thisObject._locationComposer = null;
    thisObject._configData = null;
    thisObject._lastLocationResult = null;
    thisObject._buidingsData = null;
    thisObject._deviceMotionDeneied = false;
    thisObject._isFirstBle = true;
    var sessionKey = params["sskey"] || "",
      userId = params["userId"] || "",
      token = params["token"],
      bdid = params["bdid"],
      bsfUrl = params["configUrl"] || "";
    thisObject.sessionKey = sessionKey || "";
    thisObject.userId = userId;
    thisObject._lastOrientationUpdateTime = 0;
    var prototype = HuaweiLocator.prototype;
    prototype.init = function (sessionKey, userId) {
      thisObject._baseRootPath = "https://map1a.daxicn.com/service/getFile?bdid={{bdid}}&filename={{filename}}&t={{timeTick}}";
      thisObject._stationDetermine = new BuildingDetermine();

      thisObject._fplocalizationAlgorithm = new BLEFingerprintAlgorithm.LocalizationAlgorithm(params, framework);
      thisObject._fplocalizationAlgorithm.init();
      thisObject._fplocalizationAlgorithm._onLocationUpdateCallback = thisObject.onLocationReport;
      // 三角定位
      thisObject._trilLocalizationAlgorithm = new BLETrilaterationAlgorithm.LocalizationAlgorithm(token, bdid, framework, bsfUrl);
      thisObject._trilLocalizationAlgorithm.init();
      thisObject._trilLocalizationAlgorithm._onLocationUpdateCallback = thisObject.onLocationReport;

      thisObject._locationComposer = new LocationComposer(framework, params);
      thisObject._locationComposer.init();
      thisObject._locationComposer.on("pos", thisObject.onLocationComposerResult);
    };

    prototype.fini = function () {
      if (thisObject._stationDetermine) {
        thisObject._stationDetermine.fini();
        thisObject._stationDetermine = null;
      }

      if (thisObject._locationComposer) {
        thisObject._locationComposer.fini();
        thisObject._locationComposer = null;
      }
    };
    prototype.setDeviceMotionDeneied = function () {
      thisObject._deviceMotionDeneied = true;
    };
    prototype.setBuildingsData = function (buidingsData) {
      var bdlist = buidingsData["list"] || buidingsData["bdlist"] || buidingsData["filelist"];
      bdlist.forEach(function (bdInfo) {
        if (!bdInfo["center"] && bdInfo["location"]) {
          bdInfo["center"] = bdInfo["location"].split(",").map(function (str) {
            return parseFloat(str);
          });
          bdInfo["mRange"] = bdInfo["center"][2];
        }
        if (!bdInfo["indoorExtent"] && bdInfo["data"] && bdInfo["data"]["rect"]) {
          var polygon = [];
          var arr = bdInfo["data"]["rect"].split(",").map(function (str) {
            return parseFloat(str);
          });
          var polygon = [
            [arr[0], arr[1]],
            [arr[2], arr[1]],
            [arr[2], arr[3]],
            [arr[0], arr[3]],
            [arr[0], arr[1]],
          ];
          bdInfo["indoorExtent"] = {
            type: "Feature",
            properties: {
              id: null,
            },
            geometry: {
              type: "Polygon",
              coordinates: [polygon],
            },
          };
        }
        if (!bdInfo["parkExtent"]) {
          bdInfo["parkExtent"] = bdInfo["indoorExtent"];
        }
        if (!bdInfo["groundFloorIndex"]) {
          bdInfo["groundFloorIndex"] = 0;
        }
        if (!bdInfo["groundFloorId"]) {
          bdInfo["groundFloorId"] = bdInfo["data"]["initfloor"];
        }
      });

      thisObject._buidingsData = {
        bdlist: bdlist,
      };
      thisObject._buidingsData.maxBounds = buidingsData["maxBounds"];
      thisObject._buidingsData.showOutDoorMap = buidingsData["showOutDoorMap"];
      thisObject._buidingsData.location = buidingsData["location"];
      if (thisObject._lastBdid) {
        var bdInfo = thisObject.getBDInfoDataByBDID(thisObject._lastBdid);
        bdInfo && thisObject.onBuildingChanged(bdInfo);
      }
    };

    prototype.getBuildingsData = function () {
      return thisObject._buidingsData;
    };
    prototype.getBDInfoDataByBDID = function (bdid) {
      if (!thisObject._buidingsData) {
        return null;
      }
      var buidingsData = thisObject._buidingsData["bdlist"];
      var bdInfo = null;
      buidingsData.forEach(function (item) {
        if (item.bdid == bdid) {
          bdInfo = item;
        }
      });
      return bdInfo;
    };
    prototype.clean = function () {
      thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.clean(true);
    };
    prototype.reset = function () {
      thisObject._localizationAlgorithm && thisObject._localizationAlgorithm.reset(true);
    };
    prototype.start = function () {
      var providerManager = framework._providerManager;

      var orientation = null;
      // // if(isIOSDevice){
      // orientation = providerManager.getProvider("orientation");
      // if(orientation){
      // 	orientation.on("heading", this.onHeadingReport);
      // 	orientation.start();
      // }
      // // }
      if (bdid) {
        var bdInfo = thisObject.getBDInfoDataByBDID(bdid);
        bdInfo && thisObject.onBuildingChanged(bdInfo);
      }
      {
        var mp = providerManager.getProvider("micro");
        if (mp) {
          // 不同信号的监听 使用
          mp.on("gps", this.onGPSReport);
          mp.on("ble", this.onBleReport);
          //android heading
          mp.on("heading", this.onHeadingReport);
          mp.start(thisObject.sessionKey, thisObject.userId);
        }
      }
      {
        var aoa = providerManager.getProvider("aoa");
        if (aoa) {
          aoa.on("aoa", this.onAoaReport);
          aoa.start();
        }
      }
      {
        var ped = providerManager.getProvider("ped");
        if (ped) {
          ped.on("ped", this.onPedReport);
          if (orientation) {
            orientation.on("heading", this.onHeadingReport);
          }
          ped.on("ped", this.onPedReport);
          WXAlert.showDeviceMotionDialog(
            function () {
              orientation && orientation.start();
              ped.start();
            },
            function () {
              framework.showDeviceMotionDenyTip();
              thisObject.setDeviceMotionDeneied(true);
            },
          );
          // ped.start();
        }
      }
      //
      {
        var _5gProvider = providerManager.getProvider("5gProvider");
        if (_5gProvider) {
          _5gProvider.on("5g", this.on5GReport);
          _5gProvider.start();
        }
      }
    };

    prototype.stop = function () {};

    prototype.getConfigData = function () {
      return thisObject._configData;
    };
    prototype.getBeaconData = function () {
      return thisObject._localizationAlgorithm.getBeaconData();
    };
    prototype.onOrientationChanged = function (angel) {
      thisObject._heading = angel;
      thisObject._localizationAlgorithm.updateOrientation(angel);
      var currTime = LocalizationUtils.getCurrentTime();
      if (currTime - thisObject._lastOrientationUpdateTime > 2000) {
        if (thisObject._lastLocationResult) {
          thisObject._lastLocationResult.heading = angel;
          // framework.onLocalizationSucceed(thisObject._lastLocationResult);
        }
        thisObject._lastOrientationUpdateTime = currTime;
      }
    };

    prototype.onGPSReport = function (data, hash) {
      //SendHash
      data.position = [data.longitude, data.latitude];
      // thisObject._locationComposer.onLocationResultUpdate(data,"GPS",hash);
    };

    prototype.onBleReport = function (beacons, hash) {
      var url = "https://map1a.daxicn.com/hwquery/queryBeacons";
      LocalizationUtils.postData(
        url,
        { beacons: beacons },
        function (data) {
          if (data["code"] == 0) {
            data.heading = thisObject._heading;
            thisObject._locationComposer.onLocationResultUpdate(data);
          }
        },
        null,
        null,
        function (err) {
          console.log("err", err);
        },
      );
    };
    prototype.on5GReport = function (data) {
      var location = {
        bdid: data["bdid"],
        longitude: data["longitude"],
        latitude: data["latitude"],
        position: [data["longitude"], data["latitude"], data["floorId"]],
        // "updateType": UPDATE_TYPE_BLE,
        heading: thisObject._heading,
        timeStamp: new Date().getTime(),
        floorId: data["floorId"],
        speed: "",
        locType: "5G",
        accuracy: data["accuracy"] || 3,
        //   "force":true
      };
      // thisObject._localizationAlgorithm.setLocation(location["floorId"],data["longitude"], data["latitude"],0.5);
      thisObject._locationComposer.onLocationResultUpdate(location);
    };

    prototype.onHeadingReport = function (data, hash) {
      if (data !== thisObject._heading) {
        thisObject._heading = data;
        thisObject._localizationAlgorithm.updateOrientation(data, hash);
        framework.setDirty();
      }
    };

    prototype.onLocationReport = function (data, hash) {
      //sendHash
      thisObject._locationComposer.onLocationResultUpdate(data, "BLE", hash);
    };

    prototype.onPedReport = function (data) {
      data.heading = thisObject._heading;
      thisObject._localizationAlgorithm.updateStep(data);
      if (BLETrilaterationAlgorithm.LocalizationUtils.getCurrentTime() - thisObject.mLastUpdateTime > 1000) {
        var locationResult = thisObject._localizationAlgorithm.getLocationResult();
        locationResult.step = data.step;
        thisObject._locationComposer.onLocationResultUpdate(locationResult, "PED");
      }
    };

    prototype.onLocationComposerResult = function (data) {
      if (!isIOSDevice) {
        data.heading = thisObject._heading;
      }

      data.floorIndex = data.floorIndex || 0;
      data.floorId = data.floorId || "";
      data.bdid = data.bdid || "";

      thisObject._lastLocationResult = data;
      framework.onLocalizationSucceed(data);
    };

    prototype.onBuildingChanged = function (data) {
      if (thisObject._deviceMotionDeneied) {
        framework.showDeviceMotionDenyTip();
      }
      if (data && data.bdid && thisObject._bdid !== data.bdid) {
        var bdInfo = thisObject.getBDInfoDataByBDID(data.bdid);
        if (!bdInfo) {
          thisObject._lastBdid = data.bdid;
          return;
        }
        if (matchRouter) {
          RoadMapMatcher.setRoadMap(params["token"] || (window["command"] && window["command"]["token"]), data.bdid);
        }
        thisObject._bdid = bdInfo.bdid;
        var algorithm = bdInfo.algorithm;
        if (algorithm == "fingerprint") {
          thisObject._localizationAlgorithm = thisObject._fplocalizationAlgorithm;
        } else {
          thisObject._localizationAlgorithm = thisObject._trilLocalizationAlgorithm;
        }
        // change Building
        thisObject._localizationAlgorithm.stop();
        thisObject._localizationAlgorithm.start(
          data.bdid,
          function (configData) {
            thisObject._configData = configData;
          },
          bdInfo,
        );
      }
    };
  };

  // ProviderManager
  var ProviderManager = function () {
    var thisObject = this;
    thisObject._providers = {};
    var prototype = ProviderManager.prototype;
    prototype.init = function () {};

    prototype.fini = function () {};

    prototype.register = function (name, provider) {
      thisObject._providers[name] = provider;
    };

    prototype.unregister = function (name) {};

    prototype.getProvider = function (name) {
      return thisObject._providers[name];
    };
  };

  // LocatorManager
  var LocatorManager = function () {
    // var thisObject = this;
    this._locators = {};
    this._currentLocator = null;
    var prototype = LocatorManager.prototype;
    prototype.init = function () {};

    prototype.fini = function () {};

    prototype.register = function (name, locator) {
      this._locators[name] = locator;
    };

    prototype.unregister = function (name) {
      delete this._locators[name];
    };

    prototype.activeLocator = function (name) {
      var locator = this._locators[name];
      if (locator) {
        if (this._currentLocator) {
          this._currentLocator.stop();
        }
        this._currentLocator = locator;
        locator.start();
      }
    };

    prototype.getCurrentLocator = function () {
      return this._currentLocator;
    };
  };

  // LocalizationFramework
  var LocalizationFramework = function () {
    var thisObject = this;
    thisObject._onLocationUpdateCallback = null;
    thisObject._lastBleUpdateTime = 0;
    thisObject._isFirstTime = true;
    thisObject._startTest = false;
    thisObject._isDirty = true;

    thisObject._locationTimer = null;
    thisObject._locationResult = null; // new LocationResult;
    thisObject._providerManager = null;
    thisObject._locatorManager = null;
    thisObject._routeMatcher = null;
    thisObject._locationConfig = null;
    thisObject._userId = "";
    thisObject._postLocRes = "";
    thisObject._ssKey = "";
    thisObject._version = 0;
    thisObject._locationResultArr = [];
    thisObject._locationListener = null;
    thisObject._deviceMotionDeneied = false;

    var prototype = LocalizationFramework.prototype;
    prototype.fini = function () {
      var thisObject = this;

      if (thisObject._locationTimer) {
        clearInterval(thisObject._locationTimer);
        thisObject._locationTimer = null;
      }

      if (thisObject._providerManager) {
        thisObject._providerManager.fini();
        thisObject._providerManager = null;
      }

      if (thisObject._locatorManager) {
        thisObject._locatorManager.fini();
        thisObject._locatorManager = null;
      }
    };

    prototype.init = function (wxLocation, params) {
      // token, bdid, psfUrl, postLocRes, userId, sskey, version, unique_deviceno, id, wsLocUrl) { //bdid, configUrl, postLocRes,userId,thisObject.sessionKey
      var thisObject = this;
      this.params = params;
      var bdid = params["bdid"];
      var token = params["token"];
      var type = params["locType"];
      var id = params["id"];
      var wsLocUrl = params["wsLocUrl"];
      var postLocRes = params["postLocRes"];
      var userId = params["userId"];
      var configUrl = params["configUrl"];
      params["id"] = params["id"] || userId;
      thisObject.wxLocation = wxLocation;
      thisObject.stepH = params["naviPersonH"] || 1.7;
      thisObject.locStepH = params["locPersonH"] || 1.7;

      thisObject.sessionKey = params["sessionKey"] || "";
      thisObject.deviceName = params["device"] || "";
      var unique_deviceno = params["unique_deviceno"] || params["uniqueid"] || "";
      if (params["aoa"]) {
        var aoaWSSUrl = params["aoa"]["wssUrl"];
      }

      var version = params["version"] || 0;

      isIOSDevice = getDeviceType();
      thisObject._userId = userId;
      thisObject._postLocRes = postLocRes;
      if (params["logServerUrl"]) {
        locationLogManager.setLogServerUrl(params["logServerUrl"]);
      }

      thisObject._ssKey = params["sessionKey"] || "";
      version && (thisObject._version = version);

      thisObject.bdid = bdid;
      thisObject._routeMatcher = new RouteMatch(params);
      thisObject._lastBleUpdateTime = LocalizationUtils.getCurrentTime();
      // create ProviderManager
      thisObject._providerManager = new ProviderManager();
      thisObject._providerManager.init();

      if (!(params["platform"] == "android_web" || params["platform"] == "ios_web")) {
        {
          var orientation = new OrientationProvider();
          orientation.init();
          thisObject._providerManager.register("orientation", orientation);
        }
      }
      {
        var mp = new MicroProgramDataProvider(params);
        mp.init();
        thisObject._providerManager.register("micro", mp);
      }
      {
        var pedProvider = new PedProvider();
        pedProvider.init();
        thisObject._providerManager.register("ped", pedProvider);
      }
      if (unique_deviceno) {
        if (!(window["command"] && window["command"]["disabledAOA"] && window["command"]["disabledAOA"] == "true") && !params["disabledAOA"]) {
          if ((window["command"] && window["command"]["token"]) == "71167c4108bb193cde69298ad22e2b86") {
            //国博
            var aoaProvider = new AOA_GuoBoProvider(aoaWSSUrl, params["aoa"]);
          } else {
            var aoaProvider = new AOAProvider(aoaWSSUrl, params["aoa"]);
          }
          //var aoaProvider = new AOAProvider(aoaWSSUrl, params["aoa"]);
          aoaProvider.init(unique_deviceno, token, bdid);
          thisObject._providerManager.register("aoa", aoaProvider);
        }
      }
      if (params["5G"]) {
        var _5gProvider = new G5Provider(params);
        _5gProvider.init();
        thisObject._providerManager.register("5gProvider", _5gProvider);
      }

      // create LocatorManager
      thisObject._locatorManager = new LocatorManager();
      thisObject._locatorManager.init();

      if (window["indoorLocalAlgorithms"] == "huawei") {
        //register huawei
        {
          var huaweiLocator = new HuaweiLocator(thisObject, params);
          huaweiLocator.init(thisObject._ssKey, params);
          thisObject._locatorManager.register("huawei", huaweiLocator);
        }
      } else {
        // register locator
        {
          var fusionLocator = new FusionLocator(thisObject, params); //token, bdid, configUrl);
          fusionLocator.init(thisObject._ssKey, params);
          thisObject._locatorManager.register("fusion", fusionLocator);
        }
      }

      // WXAlert.showDeviceMotionDialog(function () {
      if (window["indoorLocalAlgorithms"] == "huawei") {
        thisObject.setAlgorithm("huawei");
      } else {
        thisObject.setAlgorithm("fusion");
      }
      // }, function () {
      //     thisObject.showDeviceMotionDenyTip();
      //     thisObject._deviceMotionDeneied = true;
      //     fusionLocator.setDeviceMotionDeneied(true);
      // });

      setInterval(function () {
        thisObject.sendLocation();
      }, params["rate"] || 1000);
    };
    prototype.setStepH = function (h) {
      thisObject.stepH = h;
    };
    prototype.setLocStepH = function (h) {
      thisObject.locStepH = h;
    };
    prototype.setStepHAOA = function (h) {
      thisObject.setStepHAOA = h;
    };
    prototype.setLocStepHAOA = function (h) {
      thisObject.locStepHAOA = h;
    };
    prototype.setStrictLocArea = function (b) {
      thisObject.strictLocArea = b;
    };
    prototype.sendLocation = function () {
      if (thisObject._isDirty && thisObject._locationResult && thisObject._onLocationUpdateCallback) {
        thisObject._isDirty = false;
        var lr = thisObject._locationResult;
        var realPos = [lr.position[0], lr.position[1], lr.position[2]];
        // var heading = thisObject._locationResult["heading"] || thisObject._locatorManager._currentLocator._heading;
        var heading = thisObject._locatorManager._currentLocator._heading || thisObject._locationResult["heading"];
        var position = realPos;
        var targetPos = [lr.position[0], lr.position[1], lr.position[2]]; //[lr.targetPos.lng, lr.targetPos.lat, lr.floor];
        var routeMatch = thisObject._routeMatcher;

        if (routeMatch) {
          var nextPos = MathUtils.Vector3_copy(routeMatch._locationArray[1]);
          var targetPos = nextPos;
          if (routeMatch.getNextMatchPosition(nextPos)) {
            position = nextPos;
          }
        }
        var positionX = position[0];
        var positionY = position[1];
        var floorIndex = position[2] || targetPos[2];
        if (!positionX || !positionY) return;
        var retVal = {
          code: 220,
          location: {
            x: positionX,
            y: positionY,
            z: floorIndex,
            r: 5,
            a: heading,
            floorId: lr.floorId || "",
            bdid: lr.bdid,
          },
          locType: lr.locType,
          isIndoorAreaGPS: lr.isIndoorAreaGPS,
          real_pos: {
            x: realPos[0],
            y: realPos[1],
            z: targetPos[2],
            floorId: lr.floorId || "",
          },
          target_pos: {
            x: targetPos[0],
            y: targetPos[1],
            z: targetPos[2],
          },
          timeStamp: lr.timeStamp,
          receiveTime: lr.receiveTime,
        };
        /*var curPolyline = thisObject._routeMatcher._curPolyline;
        if(curPolyline && window.location.href.indexOf("usingSegmentHeading=true") != -1){
          //把方向角改为路线角度
          var segmentAngle =  thisObject._routeMatcher._curPolyline.getSegmentAngleFromKey(thisObject._routeMatcher._curKey);
          retVal.location.a = segmentAngle
        }*/
        thisObject._onLocationUpdateCallback(retVal);
        thisObject._isDirty = false;
      }
    };
    prototype.showDeviceMotionDenyTip = function () {
      WXAlert.showNotifyMsgBox(
        null,
        "您已禁止使用手机方向、运动,导航无法使用!若要使用导航功能请关闭本程序后重新进入,并同意使用手机方向、运动等位置权限",
        "确定",
      );
    };
    prototype.setBuildingsData = function (buildingData) {
      var locator = this.getAlgorithm();
      if (locator && locator.setBuildingsData) {
        locator.setBuildingsData(buildingData);
      }
      thisObject.buildingData = buildingData;
    };
    prototype.registBleStateListener = function (callback) {
      thisObject._providerManager.getProvider("micro").registBleStateListener(callback);
    };
    prototype.registGPSStateListener = function (callback) {
      thisObject._providerManager.getProvider("micro").registGPSStateListener(callback);
    };
    prototype.registDebugListener = function (callback) {
      thisObject._providerManager.getProvider("micro").registDebugListener(callback);
    };
    prototype.reset = function () {
      thisObject._isFirstTime = true;
      thisObject._lastBleUpdateTime = LocalizationUtils.getCurrentTime();
      var locator = thisObject._locatorManager.getCurrentLocator();
      if (locator && locator.reset) {
        locator.reset();
      }
      thisObject._isDirty = false;
    };
    prototype.clean = function () {
      var locator = thisObject._locatorManager.getCurrentLocator();
      if (locator && locator.clean) {
        locator.clean(true);
      }
      thisObject._isDirty = false;
    };

    prototype.setAlgorithm = function (name) {
      if (name !== thisObject._algorithm) {
        thisObject._algorithm = name;
        thisObject._locatorManager.activeLocator(name);
        if (thisObject.buildingData) {
          thisObject.setBuildingsData(thisObject.buildingData);
        }
        thisObject._locatorManager.getCurrentLocator().onBuildingChanged({
          bdid: thisObject.bdid,
        });
      }
    };
    prototype.getAlgorithm = function (name) {
      return thisObject._locatorManager.getCurrentLocator();
    };
    prototype.getLocationConfig = function () {
      return _locationConfig;
    };

    prototype.setDirty = function () {
      thisObject._isDirty = true;
    };
    var lastLocResultTime = new Date().getTime();

    prototype.onLocalizationSucceed = function (posUpdateArgs, updateForce) {
      if (!posUpdateArgs.position[0] || !posUpdateArgs.position[1]) {
        return;
      }
      var isFirst = false;
      if (!thisObject._locationResult) {
        isFirst = true;
      }
      posUpdateArgs.heading = ~~posUpdateArgs.heading;
      posUpdateArgs.longitude = posUpdateArgs.position[0] = posUpdateArgs.position[0].toFixed(6) * 1;
      posUpdateArgs.latitude = posUpdateArgs.position[1] = posUpdateArgs.position[1].toFixed(6) * 1;
      if (thisObject._locationResult && thisObject._locationResult.position) {
        if (posUpdateArgs.position[0] == thisObject._locationResult.position[0] && posUpdateArgs.position[1] == thisObject._locationResult.position[1]) {
          return;
        }
        // var lastPos = [thisObject._locationResult.position[0], thisObject._locationResult.position[1]];
        // var dis = LocalizationUtils.distanceP2P(posUpdateArgs.position[0], posUpdateArgs.position[1], lastPos[0], lastPos[1]);
        // if (dis < 0.1 && posUpdateArgs.heading == thisObject._locationResult.heading) {
        //     return;
        // }
      }

      thisObject._locationResult = posUpdateArgs;
      var floorIndex = parseInt(posUpdateArgs.floorIndex || 0);
      thisObject._locationResult.position[2] = floorIndex;
      var realPos = [posUpdateArgs.position[0], posUpdateArgs.position[1], floorIndex];
      var t = posUpdateArgs.timeStamp || posUpdateArgs.t;
      realPos.heading = posUpdateArgs.heading;
      realPos.timeStamp = t;
      realPos.speed = posUpdateArgs.speed;
      realPos.floorId = posUpdateArgs.floorId;
      realPos.locType = posUpdateArgs.locType;
      var curPolyline = thisObject._routeMatcher._curPolyline;
      if (curPolyline && window.location.href.indexOf("usingSegmentHeading=true") != -1) {
        //把方向角改为路线角度
        var segmentAngle = thisObject._routeMatcher._curPolyline.getSegmentAngleFromKey(thisObject._routeMatcher._curKey);
        realPos.heading = segmentAngle;
      }
      thisObject._routeMatcher.update(realPos);

      thisObject._isDirty = true;
      var locRes = {
        t: 10,
        d: t,
        result: posUpdateArgs,
        locT: posUpdateArgs.locType,
      };
      // posUpdateArgs.heading = ~~realPos.heading;
      _locationModuleAdapter.addLocationLog ? _locationModuleAdapter.addLocationLog(locationLogManager, locRes) : locationLogManager.addData(locRes);
      if (isFirst || updateForce) {
        thisObject.sendLocation();
      }
      return;
    };
    prototype.changeBuilding = function (bdid) {
      if (thisObject._deviceMotionDeneied) {
        WXAlert.showNotifyMsgBox(
          null,
          "您已禁止使用手机方向、运动,导航无法使用!若要使用导航功能请关闭本程序后重新进入,并同意使用手机方向、运动等位置权限",
          "确定",
        );
      }
      var locator = thisObject._locatorManager.getCurrentLocator();
      locator &&
        locator.onBuildingChanged({
          bdid: bdid,
        });
      thisObject.bdid = bdid;
    };
    prototype.setSensorStatus = function (sensorStatus) {};
    prototype.sendBeaconsData = function (beacons) {
      bleOpened = true;
      if (!(window["command"] && window["command"]["disabledBLE"] && window["command"]["disabledBLE"] == "true") && !this.params["disabledBLE"]) {
        this._providerManager.getProvider("micro").trigger("ble", beacons);
      }
    };
    prototype.sendGPSData = function (gpsData) {
      this._providerManager.getProvider("micro").trigger("gps", gpsData);
    };
    prototype.sendHeadingData = function (heading) {
      this._providerManager.getProvider("micro").trigger("heading", heading);
    };
    prototype.sendStep = function (data) {
      if (data["heading"]) {
        this._providerManager.getProvider("micro").trigger("heading", data["heading"]);
      }
      this._providerManager.getProvider("ped").trigger("ped", data);
    };
    prototype.sendAOAResult = function (data) {
      if (!(window["command"] && window["command"]["disabledAOA"] && window["command"]["disabledAOA"] == "true") && !this.params["disabledAOA"]) {
        // this._providerManager.getProvider("aoa")["updateAOAData"](data);
        if (data["data"] && data["data"]["longitude"] && data["data"]["latitude"]) {
          this._providerManager.getProvider("micro").trigger("aoa", data["data"]);
        } else {
          this._providerManager.getProvider("aoa")["updateAOAData"](data);
        }
      }
    };
    prototype.send5GResult = function (data) {
      if (data["data"] && data["data"]["longitude"] && data["data"]["latitude"]) {
        // this._providerManager.getProvider('micro').trigger("5g", data["data"]);

        if (!_5gProvider) {
          this.getAlgorithm().on5GReport(data["data"]);
        } else {
          var _5gProvider = this._providerManager.getProvider("5gProvider")["update5GData"](data);
        }
      }
      // else{
      //     this._providerManager.getProvider("5gProvider")["update5GData"](data);
      // }
    };
    prototype.setGeofenceData = function (data) {
      this.getAlgorithm()._fplocalizationAlgorithm.setGeofenceData(data);
    };
  };
  var wxLocationCore = new WXLocation();
  {
    //
    window["wxclean"] = function () {
      wxLocationCore["clean"]();
    };
    window["onBleUpdate"] = function (data) {
      wxLocationCore["onBleUpdate"](data);
    };
    window["onStepUpdate"] = function (data) {
      wxLocationCore["onStepUpdate"](data);
    };
    window["onGPSUpdate"] = function (data) {
      wxLocationCore["onGPSUpdate"](data);
    };
    window["onAOAUpdate"] = function (data) {
      wxLocationCore["onAOAUpdate"](data);
    };
    window["onOrientationUpdate"] = function (data) {
      wxLocationCore["onOrientationUpdate"](data);
    };
    window["changeBuilding"] = function (bdid) {
      wxLocationCore["changeBuilding"](bdid);
    };
  }
  return wxLocationCore;
})();
window["WXLocationEntity"] = WXLocationEntity;
