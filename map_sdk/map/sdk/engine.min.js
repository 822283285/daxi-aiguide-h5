/*
 RequireJS 2.1.6 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 Available via the MIT or new BSD license.
 see: http://github.com/jrburke/requirejs for details

  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 A lightweight CommonJS Promises/A and when() implementation
 when is part of the cujo.js family of libraries (http://cujojs.com/)

 Licensed under the MIT License at:
 http://www.opensource.org/licenses/mit-license.php

 @version 1.7.1


 Grauw URI utilities

 See: http://hg.grauw.nl/grauw-lib/file/tip/src/uri.js

 @author Laurens Holst (http://www.grauw.nl/)

   Copyright 2012 Laurens Holst

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.

*/
(function(b){function a(a){return"[object Function]"===I.call(a)}function d(a){return"[object Array]"===I.call(a)}function c(a,d){if(a){var c;for(c=0;c<a.length&&(!a[c]||!d(a[c],c,a));c+=1);}}function e(a,d){if(a){var c;for(c=a.length-1;-1<c&&(!a[c]||!d(a[c],c,a));c-=1);}}function h(a,c){return y.call(a,c)}function l(a,c){return h(a,c)&&a[c]}function g(a,c){for(var d in a)if(h(a,d)&&c(a[d],d))break}function k(a,c,d,b){c&&g(c,function(c,f){if(d||!h(a,f))b&&"string"!==typeof c?(a[f]||(a[f]={}),k(a[f],
c,d,b)):a[f]=c});return a}function n(a,c){return function(){return c.apply(a,arguments)}}function f(a){throw a;}function m(a){if(!a)return a;var d=b;c(a.split("."),function(a){d=d[a]});return d}function q(a,c,d,b){c=Error(c+"\nhttp://requirejs.org/docs/errors.html#"+a);c.requireType=a;c.requireModules=b;d&&(c.originalError=d);return c}function x(e){function p(a,c,d){var b,f,m,e,q,g,r,k=c&&c.split("/");b=k;var h=aa.map,n=h&&h["*"];if(a&&"."===a.charAt(0))if(c){b=l(aa.pkgs,c)?k=[c]:k.slice(0,k.length-
1);c=a=b.concat(a.split("/"));for(b=0;c[b];b+=1)if(f=c[b],"."===f)c.splice(b,1),b-=1;else if(".."===f)if(1!==b||".."!==c[2]&&".."!==c[0])0<b&&(c.splice(b-1,2),b-=2);else break;b=l(aa.pkgs,c=a[0]);a=a.join("/");b&&a===c+"/"+b.main&&(a=c)}else 0===a.indexOf("./")&&(a=a.substring(2));if(d&&h&&(k||n)){c=a.split("/");for(b=c.length;0<b;b-=1){m=c.slice(0,b).join("/");if(k)for(f=k.length;0<f;f-=1)if(d=l(h,k.slice(0,f).join("/")))if(d=l(d,m)){e=d;q=b;break}if(e)break;!g&&n&&l(n,m)&&(g=l(n,m),r=b)}!e&&g&&
(e=g,q=r);e&&(c.splice(0,q,e),a=c.join("/"))}return a}function r(a){G&&c(document.getElementsByTagName("script"),function(c){if(c.getAttribute("data-requiremodule")===a&&c.getAttribute("data-requirecontext")===Y.contextName)return c.parentNode.removeChild(c),!0})}function x(a){var c=l(aa.paths,a);if(c&&d(c)&&1<c.length)return r(a),c.shift(),Y.require.undef(a),Y.require([a]),!0}function s(a){var c,d=a?a.indexOf("!"):-1;-1<d&&(c=a.substring(0,d),a=a.substring(d+1,a.length));return[c,a]}function A(a,
c,d,b){var f,m,e=null,q=c?c.name:null,g=a,r=!0,k="";a||(r=!1,a="_@r"+(va+=1));a=s(a);e=a[0];a=a[1];e&&(e=p(e,q,b),m=l(oa,e));a&&(e?k=m&&m.normalize?m.normalize(a,function(a){return p(a,q,b)}):p(a,q,b):(k=p(a,q,b),a=s(k),e=a[0],k=a[1],d=!0,f=Y.nameToUrl(k)));d=!e||m||d?"":"_unnormalized"+(wa+=1);return{prefix:e,name:k,parentMap:c,unnormalized:!!d,url:f,originalName:g,isDefine:r,id:(e?e+"!"+k:k)+d}}function z(a){var c=a.id,d=l(da,c);d||(d=da[c]=new Y.Module(a));return d}function C(a,c,d){var b=a.id,
f=l(da,b);if(!h(oa,b)||f&&!f.defineEmitComplete)if(f=z(a),f.error&&"error"===c)d(f.error);else f.on(c,d);else"defined"===c&&d(oa[b])}function w(a,d){var b=a.requireModules,f=!1;if(d)d(a);else if(c(b,function(c){if(c=l(da,c))c.error=a,c.events.error&&(f=!0,c.emit("error",a))}),!f)t.onError(a)}function M(){$.length&&(K.apply(ma,[ma.length-1,0].concat($)),$=[])}function u(a){delete da[a];delete sa[a]}function J(a,d,b){var f=a.map.id;a.error?a.emit("error",a.error):(d[f]=!0,c(a.depMaps,function(c,f){var m=
c.id,e=l(da,m);!e||a.depMatched[f]||b[m]||(l(d,m)?(a.defineDep(f,oa[m]),a.check()):J(e,d,b))}),b[f]=!0)}function E(){var a,d,b,f,m=(b=1E3*aa.waitSeconds)&&Y.startTime+b<(new Date).getTime(),e=[],p=[],k=!1,h=!0;if(!B){B=!0;g(sa,function(c){a=c.map;d=a.id;if(c.enabled&&(a.isDefine||p.push(c),!c.error))if(!c.inited&&m)x(d)?k=f=!0:(e.push(d),r(d));else if(!c.inited&&c.fetched&&a.isDefine&&(k=!0,!a.prefix))return h=!1});if(m&&e.length)return b=q("timeout","Load timeout for modules: "+e,null,e),b.contextName=
Y.contextName,w(b);h&&c(p,function(a){J(a,{},{})});m&&!f||!k||!G&&!L||qa||(qa=setTimeout(function(){qa=0;E()},50));B=!1}}function O(a){h(oa,a[0])||z(A(a[0],null,!0)).init(a[1],a[2])}function y(a){a=a.currentTarget||a.srcElement;var c=Y.onScriptLoad;a.detachEvent&&!D?a.detachEvent("onreadystatechange",c):a.removeEventListener("load",c,!1);c=Y.onScriptError;a.detachEvent&&!D||a.removeEventListener("error",c,!1);return{node:a,id:a&&a.getAttribute("data-requiremodule")}}function v(){var a;for(M();ma.length;){a=
ma.shift();if(null===a[0])return w(q("mismatch","Mismatched anonymous define() module: "+a[a.length-1]));O(a)}}var B,I,Y,Q,qa,aa={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{},config:{}},da={},sa={},la={},ma=[],oa={},ua={},va=1,wa=1;Q={require:function(a){return a.require?a.require:a.require=Y.makeRequire(a.map)},exports:function(a){a.usingExports=!0;if(a.map.isDefine)return a.exports?a.exports:a.exports=oa[a.map.id]={}},module:function(a){return a.module?a.module:a.module={id:a.map.id,uri:a.map.url,
config:function(){var c=l(aa.pkgs,a.map.id);return(c?l(aa.config,a.map.id+"/"+c.main):l(aa.config,a.map.id))||{}},exports:oa[a.map.id]}}};I=function(a){this.events=l(la,a.id)||{};this.map=a;this.shim=l(aa.shim,a.id);this.depExports=[];this.depMaps=[];this.depMatched=[];this.pluginMaps={};this.depCount=0};I.prototype={init:function(a,c,d,b){b=b||{};if(!this.inited){this.factory=c;if(d)this.on("error",d);else this.events.error&&(d=n(this,function(a){this.emit("error",a)}));this.depMaps=a&&a.slice(0);
this.errback=d;this.inited=!0;this.ignore=b.ignore;b.enabled||this.enabled?this.enable():this.check()}},defineDep:function(a,c){this.depMatched[a]||(this.depMatched[a]=!0,this.depCount-=1,this.depExports[a]=c)},fetch:function(){if(!this.fetched){this.fetched=!0;Y.startTime=(new Date).getTime();var a=this.map;if(this.shim)Y.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],n(this,function(){return a.prefix?this.callPlugin():this.load()}));else return a.prefix?this.callPlugin():this.load()}},
load:function(){var a=this.map.url;ua[a]||(ua[a]=!0,Y.load(this.map.id,a))},check:function(){if(this.enabled&&!this.enabling){var c,d,b=this.map.id;d=this.depExports;var m=this.exports,e=this.factory;if(!this.inited)this.fetch();else if(this.error)this.emit("error",this.error);else if(!this.defining){this.defining=!0;if(1>this.depCount&&!this.defined){if(a(e)){if(this.events.error&&this.map.isDefine||t.onError!==f)try{m=Y.execCb(b,e,d,m)}catch(q){c=q}else m=Y.execCb(b,e,d,m);this.map.isDefine&&((d=
this.module)&&void 0!==d.exports&&d.exports!==this.exports?m=d.exports:void 0===m&&this.usingExports&&(m=this.exports));if(c)return c.requireMap=this.map,c.requireModules=this.map.isDefine?[this.map.id]:null,c.requireType=this.map.isDefine?"define":"require",w(this.error=c)}else m=e;this.exports=m;if(this.map.isDefine&&!this.ignore&&(oa[b]=m,t.onResourceLoad))t.onResourceLoad(Y,this.map,this.depMaps);u(b);this.defined=!0}this.defining=!1;this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",
this.exports),this.defineEmitComplete=!0)}}},callPlugin:function(){var a=this.map,c=a.id,d=A(a.prefix);this.depMaps.push(d);C(d,"defined",n(this,function(d){var b,f;f=this.map.name;var m=this.map.parentMap?this.map.parentMap.name:null,e=Y.makeRequire(a.parentMap,{enableBuildCallback:!0});if(this.map.unnormalized){if(d.normalize&&(f=d.normalize(f,function(a){return p(a,m,!0)})||""),d=A(a.prefix+"!"+f,this.map.parentMap),C(d,"defined",n(this,function(a){this.init([],function(){return a},null,{enabled:!0,
ignore:!0})})),f=l(da,d.id)){this.depMaps.push(d);if(this.events.error)f.on("error",n(this,function(a){this.emit("error",a)}));f.enable()}}else b=n(this,function(a){this.init([],function(){return a},null,{enabled:!0})}),b.error=n(this,function(a){this.inited=!0;this.error=a;a.requireModules=[c];g(da,function(a){0===a.map.id.indexOf(c+"_unnormalized")&&u(a.map.id)});w(a)}),b.fromText=n(this,function(d,f){var m=a.name,p=A(m),g=ga;f&&(d=f);g&&(ga=!1);z(p);h(aa.config,c)&&(aa.config[m]=aa.config[c]);
try{t.exec(d)}catch(k){return w(q("fromtexteval","fromText eval for "+c+" failed: "+k,k,[c]))}g&&(ga=!0);this.depMaps.push(p);Y.completeLoad(m);e([m],b)}),d.load(a.name,e,b,aa)}));Y.enable(d,this);this.pluginMaps[d.id]=d},enable:function(){sa[this.map.id]=this;this.enabling=this.enabled=!0;c(this.depMaps,n(this,function(a,c){var d,b;if("string"===typeof a){a=A(a,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap);this.depMaps[c]=a;if(d=l(Q,a.id)){this.depExports[c]=d(this);return}this.depCount+=
1;C(a,"defined",n(this,function(a){this.defineDep(c,a);this.check()}));this.errback&&C(a,"error",n(this,this.errback))}d=a.id;b=da[d];h(Q,d)||!b||b.enabled||Y.enable(a,this)}));g(this.pluginMaps,n(this,function(a){var c=l(da,a.id);c&&!c.enabled&&Y.enable(a,this)}));this.enabling=!1;this.check()},on:function(a,c){var d=this.events[a];d||(d=this.events[a]=[]);d.push(c)},emit:function(a,d){c(this.events[a],function(a){a(d)});"error"===a&&delete this.events[a]}};Y={config:aa,contextName:e,registry:da,
defined:oa,urlFetched:ua,defQueue:ma,Module:I,makeModuleMap:A,nextTick:t.nextTick,onError:w,configure:function(a){a.baseUrl&&"/"!==a.baseUrl.charAt(a.baseUrl.length-1)&&(a.baseUrl+="/");var b=aa.pkgs,f=aa.shim,m={paths:!0,config:!0,map:!0};g(a,function(a,c){m[c]?"map"===c?(aa.map||(aa.map={}),k(aa[c],a,!0,!0)):k(aa[c],a,!0):aa[c]=a});a.shim&&(g(a.shim,function(a,c){d(a)&&(a={deps:a});!a.exports&&!a.init||a.exportsFn||(a.exportsFn=Y.makeShimExports(a));f[c]=a}),aa.shim=f);a.packages&&(c(a.packages,
function(a){a="string"===typeof a?{name:a}:a;b[a.name]={name:a.name,location:a.location||a.name,main:(a.main||"main").replace(P,"").replace(H,"")}}),aa.pkgs=b);g(da,function(a,c){a.inited||a.map.unnormalized||(a.map=A(c))});(a.deps||a.callback)&&Y.require(a.deps||[],a.callback)},makeShimExports:function(a){return function(){var c;a.init&&(c=a.init.apply(b,arguments));return c||a.exports&&m(a.exports)}},makeRequire:function(c,d){function b(f,m,p){var g,k;d.enableBuildCallback&&m&&a(m)&&(m.__requireJsBuild=
!0);if("string"===typeof f){if(a(m))return w(q("requireargs","Invalid require call"),p);if(c&&h(Q,f))return Q[f](da[c.id]);if(t.get)return t.get(Y,f,c,b);g=A(f,c,!1,!0);g=g.id;return h(oa,g)?oa[g]:w(q("notloaded",'Module name "'+g+'" has not been loaded yet for context: '+e+(c?"":". Use require([])")))}v();Y.nextTick(function(){v();k=z(A(null,c));k.skipMap=d.skipMap;k.init(f,m,p,{enabled:!0});E()});return b}d=d||{};k(b,{isBrowser:G,toUrl:function(a){var d,b=a.lastIndexOf("."),f=a.split("/")[0];-1!==
b&&("."!==f&&".."!==f||1<b)&&(d=a.substring(b,a.length),a=a.substring(0,b));return Y.nameToUrl(p(a,c&&c.id,!0),d,!0)},defined:function(a){return h(oa,A(a,c,!1,!0).id)},specified:function(a){a=A(a,c,!1,!0).id;return h(oa,a)||h(da,a)}});c||(b.undef=function(a){M();var d=A(a,c,!0),b=l(da,a);delete oa[a];delete ua[d.url];delete la[a];b&&(b.events.defined&&(la[a]=b.events),u(a))});return b},enable:function(a){l(da,a.id)&&z(a).enable()},completeLoad:function(a){var c,d,b=l(aa.shim,a)||{},f=b.exports;for(M();ma.length;){d=
ma.shift();if(null===d[0]){d[0]=a;if(c)break;c=!0}else d[0]===a&&(c=!0);O(d)}d=l(da,a);if(!c&&!h(oa,a)&&d&&!d.inited)if(!aa.enforceDefine||f&&m(f))O([a,b.deps||[],b.exportsFn]);else return x(a)?void 0:w(q("nodefine","No define call for "+a,null,[a]));E()},nameToUrl:function(a,c,b){var f,m,e,q,p,g;if(t.jsExtRegExp.test(a))q=a+(c||"");else{f=aa.paths;m=aa.pkgs;q=a.split("/");for(p=q.length;0<p;p-=1)if(g=q.slice(0,p).join("/"),e=l(m,g),g=l(f,g)){d(g)&&(g=g[0]);q.splice(0,p,g);break}else if(e){a=a===
e.name?e.location+"/"+e.main:e.location;q.splice(0,p,a);break}q=q.join("/");q+=c||(/\?/.test(q)||b?"":".js");q=("/"===q.charAt(0)||q.match(/^[\w\+\.\-]+:/)?"":aa.baseUrl)+q}return aa.urlArgs?q+((-1===q.indexOf("?")?"?":"&")+aa.urlArgs):q},load:function(a,c){t.load(Y,a,c)},execCb:function(a,c,d,b){return c.apply(b,d)},onScriptLoad:function(a){if("load"===a.type||N.test((a.currentTarget||a.srcElement).readyState))F=null,a=y(a),Y.completeLoad(a.id)},onScriptError:function(a){var c=y(a);if(!x(c.id))return w(q("scripterror",
"Script error for: "+c.id,a,[c.id]))}};Y.require=Y.makeRequire();return Y}function p(){if(F&&"interactive"===F.readyState)return F;e(document.getElementsByTagName("script"),function(a){if("interactive"===a.readyState)return F=a});return F}var s,r,z,t,w,u,v,A,F,M,C,J,O=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/mg,E=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,H=/\.js$/,P=/^\.\//,B=Object.prototype,I=B.toString,y=B.hasOwnProperty,K=Array.prototype.splice,G=!("undefined"===typeof window||!navigator||
!window.document),L=!G&&"undefined"!==typeof importScripts,N=G&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,D="undefined"!==typeof opera&&"[object Opera]"===opera.toString(),Q={},X={},$=[],ga=!1;if("undefined"===typeof z){if("undefined"!==typeof s){if(a(s))return;X=s;s=void 0}"undefined"===typeof r||a(r)||(X=r,r=void 0);t=s=function(a,c,b,f){var m,e="_";d(a)||"string"===typeof a||(m=a,d(c)?(a=c,c=b,b=f):a=[]);m&&m.context&&(e=m.context);(f=l(Q,e))||(f=Q[e]=t.s.newContext(e));
m&&f.configure(m);return f.require(a,c,b)};t.config=function(a){return t(a)};t.nextTick="undefined"!==typeof setTimeout?function(a){setTimeout(a,4)}:function(a){a()};r||(r=t);t.version="2.1.6";t.jsExtRegExp=/^\/|:|\?|\.js$/;t.isBrowser=G;r=t.s={contexts:Q,newContext:x};t({});c(["toUrl","undef","defined","specified"],function(a){t[a]=function(){var c=Q._;return c.require[a].apply(c,arguments)}});G&&(w=r.head=document.getElementsByTagName("head")[0],u=document.getElementsByTagName("base")[0])&&(w=r.head=
u.parentNode);t.onError=f;t.load=function(a,c,d){var b=a&&a.config||{},f;if(G)return f=b.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),f.type=b.scriptType||"text/javascript",f.charset="utf-8",f.async=!0,f.setAttribute("data-requirecontext",a.contextName),f.setAttribute("data-requiremodule",c),!f.attachEvent||f.attachEvent.toString&&0>f.attachEvent.toString().indexOf("[native code")||D?(f.addEventListener("load",a.onScriptLoad,!1),f.addEventListener("error",
a.onScriptError,!1)):(ga=!0,f.attachEvent("onreadystatechange",a.onScriptLoad)),f.src=d,M=f,u?w.insertBefore(f,u):w.appendChild(f),M=null,f;if(L)try{importScripts(d),a.completeLoad(c)}catch(m){a.onError(q("importscripts","importScripts failed for "+c+" at "+d,m,[c]))}};G&&e(document.getElementsByTagName("script"),function(a){w||(w=a.parentNode);if(v=a.getAttribute("data-main"))return C=v,X.baseUrl||(A=C.split("/"),C=A.pop(),J=A.length?A.join("/")+"/":"./",X.baseUrl=J),C=C.replace(H,""),t.jsExtRegExp.test(C)&&
(C=v),X.deps=X.deps?X.deps.concat(C):[C],!0});z=function(c,b,f){var m,e;"string"!==typeof c&&(f=b,b=c,c=null);d(b)||(f=b,b=null);!b&&a(f)&&(b=[],f.length&&(f.toString().replace(O,"").replace(E,function(a,c){b.push(c)}),b=(1===f.length?["require"]:["require","exports","module"]).concat(b)));ga&&(m=M||p())&&(c||(c=m.getAttribute("data-requiremodule")),e=Q[m.getAttribute("data-requirecontext")]);(e?e.defQueue:$).push([c,b,f])};z.amd={jQuery:!0};t.exec=function(a){return eval(a)};t(X);b.requirejs=s;b.definejs=
z}})(this);definejs("../../../closure_compiler/ThirdParty/requirejs-2.1.6/require",function(){});definejs("Framework/AppState",[],function(){return{texture_count:0,mesh_count:0,texture_request_count:0,texture_real_create_count:0,texture_real_release_count:0,texture_create_count:0,texture_release_count:0,patch_count:0,frame_states:{triangles_per_frame:0,meshes_per_frame:0,texels_per_frame:0,textures_per_frame:0,frame_counter:0,frame_start_tick:0}}});
definejs("Framework/ConfigOptions",[],function(){var b={textureDataURLMap:{"texture/wall_ssao_red.jpg":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQABLAEsAAD/4QCARXhpZgAATU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAAEsAAAAAQAAASwAAAABAAKgAgAEAAAAAQAAAICgAwAEAAAAAQAAAIAAAAAA/+0AOFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAAOEJJTQQlAAAAAAAQ1B2M2Y8AsgTpgAmY7PhCfv/iD/BJQ0NfUFJPRklMRQABAQAAD+BhcHBsAhAAAG1udHJSR0IgWFlaIAflAAEAAQAIAB8AOWFjc3BBUFBMAAAAAEFQUEwAAAAAAAAAAAAAAAAAAAAAAAD21gABAAAAANMtYXBwbAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEmRlc2MAAAFcAAAAYmRzY20AAAHAAAAEgmNwcnQAAAZEAAAAI3d0cHQAAAZoAAAAFHJYWVoAAAZ8AAAAFGdYWVoAAAaQAAAAFGJYWVoAAAakAAAAFHJUUkMAAAa4AAAIDGFhcmcAAA7EAAAAIHZjZ3QAAA7kAAAAMG5kaW4AAA8UAAAAPmNoYWQAAA9UAAAALG1tb2QAAA+AAAAAKHZjZ3AAAA+oAAAAOGJUUkMAAAa4AAAIDGdUUkMAAAa4AAAIDGFhYmcAAA7EAAAAIGFhZ2cAAA7EAAAAIGRlc2MAAAAAAAAACERpc3BsYXkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABtbHVjAAAAAAAAACYAAAAMaHJIUgAAABQAAAHYa29LUgAAAAwAAAHsbmJOTwAAABIAAAH4aWQAAAAAABIAAAIKaHVIVQAAABQAAAIcY3NDWgAAABYAAAIwZGFESwAAABwAAAJGbmxOTAAAABYAAAJiZmlGSQAAABAAAAJ4aXRJVAAAABQAAAKIZXNFUwAAABIAAAKccm9STwAAABIAAAKcZnJDQQAAABYAAAKuYXIAAAAAABQAAALEdWtVQQAAABwAAALYaGVJTAAAABYAAAL0emhUVwAAAAoAAAMKdmlWTgAAAA4AAAMUc2tTSwAAABYAAAMiemhDTgAAAAoAAAMKcnVSVQAAACQAAAM4ZW5HQgAAABQAAANcZnJGUgAAABYAAANwbXMAAAAAABIAAAOGaGlJTgAAABIAAAOYdGhUSAAAAAwAAAOqY2FFUwAAABgAAAO2ZW5BVQAAABQAAANcZXNYTAAAABIAAAKcZGVERQAAABAAAAPOZW5VUwAAABIAAAPecHRCUgAAABgAAAPwcGxQTAAAABIAAAQIZWxHUgAAACIAAAQac3ZTRQAAABAAAAQ8dHJUUgAAABQAAARMcHRQVAAAABYAAARgamFKUAAAAAwAAAR2AEwAQwBEACAAdQAgAGIAbwBqAGnO7LfsACAATABDAEQARgBhAHIAZwBlAC0ATABDAEQATABDAEQAIABXAGEAcgBuAGEAUwB6AO0AbgBlAHMAIABMAEMARABCAGEAcgBlAHYAbgD9ACAATABDAEQATABDAEQALQBmAGEAcgB2AGUAcwBrAOYAcgBtAEsAbABlAHUAcgBlAG4ALQBMAEMARABWAOQAcgBpAC0ATABDAEQATABDAEQAIABjAG8AbABvAHIAaQBMAEMARAAgAGMAbwBsAG8AcgBBAEMATAAgAGMAbwB1AGwAZQB1AHIgDwBMAEMARAAgBkUGRAZIBkYGKQQaBD4EOwRMBD4EQAQ+BDIEOAQ5ACAATABDAEQgDwBMAEMARAAgBeYF0QXiBdUF4AXZX2mCcgBMAEMARABMAEMARAAgAE0A4AB1AEYAYQByAGUAYgBuAP0AIABMAEMARAQmBDIENQRCBD0EPgQ5ACAEFgQaAC0ENAQ4BEEEPwQ7BDUEOQBDAG8AbABvAHUAcgAgAEwAQwBEAEwAQwBEACAAYwBvAHUAbABlAHUAcgBXAGEAcgBuAGEAIABMAEMARAkwCQIJFwlACSgAIABMAEMARABMAEMARAAgDioONQBMAEMARAAgAGUAbgAgAGMAbwBsAG8AcgBGAGEAcgBiAC0ATABDAEQAQwBvAGwAbwByACAATABDAEQATABDAEQAIABDAG8AbABvAHIAaQBkAG8ASwBvAGwAbwByACAATABDAEQDiAOzA8cDwQPJA7wDtwAgA78DuAPMA70DtwAgAEwAQwBEAEYA5AByAGcALQBMAEMARABSAGUAbgBrAGwAaQAgAEwAQwBEAEwAQwBEACAAYQAgAEMAbwByAGUAczCrMOkw/ABMAEMARAAAdGV4dAAAAABDb3B5cmlnaHQgQXBwbGUgSW5jLiwgMjAyMQAAWFlaIAAAAAAAAPMWAAEAAAABFspYWVogAAAAAAAAgwoAAD1u////vFhZWiAAAAAAAABL+gAAtCEAAArgWFlaIAAAAAAAACfSAAAOcAAAyJFjdXJ2AAAAAAAABAAAAAAFAAoADwAUABkAHgAjACgALQAyADYAOwBAAEUASgBPAFQAWQBeAGMAaABtAHIAdwB8AIEAhgCLAJAAlQCaAJ8AowCoAK0AsgC3ALwAwQDGAMsA0ADVANsA4ADlAOsA8AD2APsBAQEHAQ0BEwEZAR8BJQErATIBOAE+AUUBTAFSAVkBYAFnAW4BdQF8AYMBiwGSAZoBoQGpAbEBuQHBAckB0QHZAeEB6QHyAfoCAwIMAhQCHQImAi8COAJBAksCVAJdAmcCcQJ6AoQCjgKYAqICrAK2AsECywLVAuAC6wL1AwADCwMWAyEDLQM4A0MDTwNaA2YDcgN+A4oDlgOiA64DugPHA9MD4APsA/kEBgQTBCAELQQ7BEgEVQRjBHEEfgSMBJoEqAS2BMQE0wThBPAE/gUNBRwFKwU6BUkFWAVnBXcFhgWWBaYFtQXFBdUF5QX2BgYGFgYnBjcGSAZZBmoGewaMBp0GrwbABtEG4wb1BwcHGQcrBz0HTwdhB3QHhgeZB6wHvwfSB+UH+AgLCB8IMghGCFoIbgiCCJYIqgi+CNII5wj7CRAJJQk6CU8JZAl5CY8JpAm6Cc8J5Qn7ChEKJwo9ClQKagqBCpgKrgrFCtwK8wsLCyILOQtRC2kLgAuYC7ALyAvhC/kMEgwqDEMMXAx1DI4MpwzADNkM8w0NDSYNQA1aDXQNjg2pDcMN3g34DhMOLg5JDmQOfw6bDrYO0g7uDwkPJQ9BD14Peg+WD7MPzw/sEAkQJhBDEGEQfhCbELkQ1xD1ERMRMRFPEW0RjBGqEckR6BIHEiYSRRJkEoQSoxLDEuMTAxMjE0MTYxODE6QTxRPlFAYUJxRJFGoUixStFM4U8BUSFTQVVhV4FZsVvRXgFgMWJhZJFmwWjxayFtYW+hcdF0EXZReJF64X0hf3GBsYQBhlGIoYrxjVGPoZIBlFGWsZkRm3Gd0aBBoqGlEadxqeGsUa7BsUGzsbYxuKG7Ib2hwCHCocUhx7HKMczBz1HR4dRx1wHZkdwx3sHhYeQB5qHpQevh7pHxMfPh9pH5Qfvx/qIBUgQSBsIJggxCDwIRwhSCF1IaEhziH7IiciVSKCIq8i3SMKIzgjZiOUI8Ij8CQfJE0kfCSrJNolCSU4JWgllyXHJfcmJyZXJocmtyboJxgnSSd6J6sn3CgNKD8ocSiiKNQpBik4KWspnSnQKgIqNSpoKpsqzysCKzYraSudK9EsBSw5LG4soizXLQwtQS12Last4S4WLkwugi63Lu4vJC9aL5Evxy/+MDUwbDCkMNsxEjFKMYIxujHyMioyYzKbMtQzDTNGM38zuDPxNCs0ZTSeNNg1EzVNNYc1wjX9Njc2cjauNuk3JDdgN5w31zgUOFA4jDjIOQU5Qjl/Obw5+To2OnQ6sjrvOy07azuqO+g8JzxlPKQ84z0iPWE9oT3gPiA+YD6gPuA/IT9hP6I/4kAjQGRApkDnQSlBakGsQe5CMEJyQrVC90M6Q31DwEQDREdEikTORRJFVUWaRd5GIkZnRqtG8Ec1R3tHwEgFSEtIkUjXSR1JY0mpSfBKN0p9SsRLDEtTS5pL4kwqTHJMuk0CTUpNk03cTiVObk63TwBPSU+TT91QJ1BxULtRBlFQUZtR5lIxUnxSx1MTU19TqlP2VEJUj1TbVShVdVXCVg9WXFapVvdXRFeSV+BYL1h9WMtZGllpWbhaB1pWWqZa9VtFW5Vb5Vw1XIZc1l0nXXhdyV4aXmxevV8PX2Ffs2AFYFdgqmD8YU9homH1YklinGLwY0Njl2PrZEBklGTpZT1lkmXnZj1mkmboZz1nk2fpaD9olmjsaUNpmmnxakhqn2r3a09rp2v/bFdsr20IbWBtuW4SbmtuxG8eb3hv0XArcIZw4HE6cZVx8HJLcqZzAXNdc7h0FHRwdMx1KHWFdeF2Pnabdvh3VnezeBF4bnjMeSp5iXnnekZ6pXsEe2N7wnwhfIF84X1BfaF+AX5ifsJ/I3+Ef+WAR4CogQqBa4HNgjCCkoL0g1eDuoQdhICE44VHhauGDoZyhteHO4efiASIaYjOiTOJmYn+imSKyoswi5aL/IxjjMqNMY2Yjf+OZo7OjzaPnpAGkG6Q1pE/kaiSEZJ6kuOTTZO2lCCUipT0lV+VyZY0lp+XCpd1l+CYTJi4mSSZkJn8mmia1ZtCm6+cHJyJnPedZJ3SnkCerp8dn4uf+qBpoNihR6G2oiailqMGo3aj5qRWpMelOKWpphqmi6b9p26n4KhSqMSpN6mpqhyqj6sCq3Wr6axcrNCtRK24ri2uoa8Wr4uwALB1sOqxYLHWskuywrM4s660JbSctRO1irYBtnm28Ldot+C4WbjRuUq5wro7urW7LrunvCG8m70VvY++Cr6Evv+/er/1wHDA7MFnwePCX8Lbw1jD1MRRxM7FS8XIxkbGw8dBx7/IPci8yTrJuco4yrfLNsu2zDXMtc01zbXONs62zzfPuNA50LrRPNG+0j/SwdNE08bUSdTL1U7V0dZV1tjXXNfg2GTY6Nls2fHadtr724DcBdyK3RDdlt4c3qLfKd+v4DbgveFE4cziU+Lb42Pj6+Rz5PzlhOYN5pbnH+ep6DLovOlG6dDqW+rl63Dr++yG7RHtnO4o7rTvQO/M8Fjw5fFy8f/yjPMZ86f0NPTC9VD13vZt9vv3ivgZ+Kj5OPnH+lf65/t3/Af8mP0p/br+S/7c/23//3BhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbdmNndAAAAAAAAAABAAEAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAQAAbmRpbgAAAAAAAAA2AACuAAAAUgAAAEPAAACwwAAAJoAAAA2AAABQAAAAVEAAAjMzAAIzMwACMzMAAAAAAAAAAHNmMzIAAAAAAAEMcgAABfj///MdAAAHugAA/XL///ud///9pAAAA9kAAMBxbW1vZAAAAAAAAAYQAACgRAAAAADZk12AAAAAAAAAAAAAAAAAAAAAAHZjZ3AAAAAAAAMAAAACZmYAAwAAAAJmZgADAAAAAmZmAAAAAjMzNAAAAAACMzM0AAAAAAIzMzQA/8AAEQgAgACAAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/bAEMAAQEBAQEBAgEBAgICAgICAwICAgIDBAMDAwMDBAUEBAQEBAQFBQUFBQUFBQYGBgYGBgcHBwcHCAgICAgICAgICP/bAEMBAQEBAgICAwICAwgFBAUICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICP/dAAQACP/aAAwDAQACEQMRAD8A/te3rRvWqXmE9T+tJv8AevW50fuvsmXt60b1qjv96N/vRzoPZMueYvv/AJ/CjzF9/wDP4VT3+9G/3o50P2Zc8xff/P4UeYvv/n8Kp7/ejf70c6D2Zc8xff8Az+FHmL7/AOfwql5g9TR5g9TRzoPZl3zF9/8AP4UeYvv/AJ/CqXmD1NHmD1o50Hsy75i+/wDn8KPMX3/z+FUd60b1o50Hsy/5g/z/APqo8xff/P4VQ3rRvWjnQezP/9D+0TzFo8xaz/M/z/kUeZ/n/Irq52f0P7Ev+av+T/8AWo81f8n/AOtWf5n+ef8ACjzP88/4UrsPYmh5q/5P/wBam+avv/n8Ko+Z/nn/AAo8z/PP+FPmYexL3mr7/wCfwo81ff8Az+FUfM/zz/hS+aO/86Odh7Eu+avv/n8KPNX3/wA/hVHzV/yf/rUeav8Ak/8A1qOdh7Ev+ctHnLVDzV/yf/rUeav+T/8AWqQ9iX/OWjzlqh5q/wCT/wDWpvnCi4/Ymj5y0hmxWf5wo84UroPYn//R/sj8z/PP+FHmf55/wrO3EcA5o3tQf0/7FdjR8z/PP+FHmf55/wAKzt7Ub2oD2K7Gj5q/5P8A9ajzV/yf/rVnb2pPMPrQHsjS81f8n/61M85ff/P4VQ8xff8AP/61HmL7/n/9agPYmh5wo84Vn+Yvv+f/ANajzF9/z/8ArUB7E0POFHnCs/zF9/z/APrUeYvv+f8A9agPYmh5wo84Vnb/AHo3+9AexNHzhS+ctZu/3o3+9AexP//S/sA8z3o8z3rI+0j1o+0j1rm1P6xtE1/M96XzhWP9pHrSfaR3o1C0TY8z3o8z3rG+1J6Gj7UnoaNRWXY2fM96POX3/wA/hWN9qT0NH2pPQ0wsuxs+cvv/AJ/CjzMnANY32pPQ0ecv97/P5UBZdjY8wepo8z3rH85f73+fypPtK+9LUehseZ9aPM+tY/2lfej7SvvRqO67Gx5ufWm+b/tf5/Osg3PpSfaaECa7H//T/rO+0r70faV96537TR9prj9of1gdF9pX3pv2n3/Suf8AtNH2mj2gHQ/aV9/y/wDr0faV9/y/+vXPfaaPtNHtAOh+0r7/AJf/AF6PtK+/5f8A16537UfQ0faj6Gj2gG/9qX/P/wCuk+1r7/5/GsD7T9aPtP1o9oBv/al9/wA6PtS+/wCdc/8AaW96PtLe9HtAOg+1L7/nR9qX3/Ouf+0t70faW96PaAb/ANp9/wDP50fav85rB+0tR9paj2gH/9T+o77S3rR9pb1rmvti+/8A3z/9lR9sX3/75/8Asq88/q+6OlNyQOtM+1L61zpvc0G9APAzQLnR0guQOjD86PtR/vfrXM/bT6Gj7afQ0Bzo6X7U394fnR9qb+8Pzrmvtp9DR9tPoaA50dIbth3pv2ketc79tPoaPtp9DQHOjovtI9aPtI9a537afQ0v27/Z/wA/nQHOjoftI9aPtI9a5v7cvv8A5/4FSG9GOP8AP/j1A+ZHSfaff/P50faff/P51zf25z93FN+2N7f5/GgXOj//1f6RftL+tH2lvaucN6h7j/P5UfbFH+f/ANdeef1QdF57eoo89vUVzf26P/P/AOql+3JQB0P2lv8AI/8Ar0favcVz325KPtyUAdD9q9xSm4J6Efn/APWrm/t6e/8An8KPt6e/+fwoA6Pz/wDaH50n2ketc79vT3/z+FH28+3+fwoA6H7R/tf5/Kl+0n+9XOfbvp/n8KT7YP8AP/66AOj+0f7X+fyo+0f7X+fyrnPtg/z/APro+2D/AD/+ugDo/tH+1/n8qb9q9zXPfbR7fzpPt3+f8igD/9b9zP8AhLYv7w/z+NN/4S2L+9/n86+XT45tgf8AWp+dH/CdW3/PVf8AvqvJv5H9Me2PqL/hLYv73+fzo/4S2L+9/n86+Xf+E6tv+eq/99Uf8J1bf89V/wC+qL+Qe2PqL/hLYv73+fzo/wCEti/vf5/Ovl3/AITq2/56r/31R/wnVt/z1X/vqi/kHtj6jPixOzD9aT/hK4v7x/Wvl3/hOrb/AJ6r/wB9Uf8ACdW3/PVf++qL+Qe2PqL/AISuL+8f1o/4S2L+9/n86+Xf+E6tv+eq/wDfVM/4Tq3/AOew/Oi/kHtj6l/4S5aT/hK4vUV8t/8ACdW//PYfnS/8JzADzMp/Gi/kHtj6f/4S2L3/AM/jTW8WIfu5H418w/8ACd2//PUfnR/wndv/AM9R+dF/IPbH07/wlo9aUeLQOtfL58dW/eYf99Uv/Cdwf89h/wB90X8g9sf/2Q==",
"texture/wall_ssao.jpg":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/4QB0RXhpZgAATU0AKgAAAAgABAEaAAUAAAABAAAAPgEbAAUAAAABAAAARgEoAAMAAAABAAIAAIdpAAQAAAABAAAATgAAAAAAAAEsAAAAAQAAASwAAAABAAKgAgAEAAAAAQAAAICgAwAEAAAAAQAAAIAAAAAA/+0AOFBob3Rvc2hvcCAzLjAAOEJJTQQEAAAAAAAAOEJJTQQlAAAAAAAQ1B2M2Y8AsgTpgAmY7PhCfv/iD/BJQ0NfUFJPRklMRQABAQAAD+BhcHBsAhAAAG1udHJSR0IgWFlaIAflAAEAAQAIAB8AOWFjc3BBUFBMAAAAAEFQUEwAAAAAAAAAAAAAAAAAAAAAAAD21gABAAAAANMtYXBwbAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEmRlc2MAAAFcAAAAYmRzY20AAAHAAAAEgmNwcnQAAAZEAAAAI3d0cHQAAAZoAAAAFHJYWVoAAAZ8AAAAFGdYWVoAAAaQAAAAFGJYWVoAAAakAAAAFHJUUkMAAAa4AAAIDGFhcmcAAA7EAAAAIHZjZ3QAAA7kAAAAMG5kaW4AAA8UAAAAPmNoYWQAAA9UAAAALG1tb2QAAA+AAAAAKHZjZ3AAAA+oAAAAOGJUUkMAAAa4AAAIDGdUUkMAAAa4AAAIDGFhYmcAAA7EAAAAIGFhZ2cAAA7EAAAAIGRlc2MAAAAAAAAACERpc3BsYXkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABtbHVjAAAAAAAAACYAAAAMaHJIUgAAABQAAAHYa29LUgAAAAwAAAHsbmJOTwAAABIAAAH4aWQAAAAAABIAAAIKaHVIVQAAABQAAAIcY3NDWgAAABYAAAIwZGFESwAAABwAAAJGbmxOTAAAABYAAAJiZmlGSQAAABAAAAJ4aXRJVAAAABQAAAKIZXNFUwAAABIAAAKccm9STwAAABIAAAKcZnJDQQAAABYAAAKuYXIAAAAAABQAAALEdWtVQQAAABwAAALYaGVJTAAAABYAAAL0emhUVwAAAAoAAAMKdmlWTgAAAA4AAAMUc2tTSwAAABYAAAMiemhDTgAAAAoAAAMKcnVSVQAAACQAAAM4ZW5HQgAAABQAAANcZnJGUgAAABYAAANwbXMAAAAAABIAAAOGaGlJTgAAABIAAAOYdGhUSAAAAAwAAAOqY2FFUwAAABgAAAO2ZW5BVQAAABQAAANcZXNYTAAAABIAAAKcZGVERQAAABAAAAPOZW5VUwAAABIAAAPecHRCUgAAABgAAAPwcGxQTAAAABIAAAQIZWxHUgAAACIAAAQac3ZTRQAAABAAAAQ8dHJUUgAAABQAAARMcHRQVAAAABYAAARgamFKUAAAAAwAAAR2AEwAQwBEACAAdQAgAGIAbwBqAGnO7LfsACAATABDAEQARgBhAHIAZwBlAC0ATABDAEQATABDAEQAIABXAGEAcgBuAGEAUwB6AO0AbgBlAHMAIABMAEMARABCAGEAcgBlAHYAbgD9ACAATABDAEQATABDAEQALQBmAGEAcgB2AGUAcwBrAOYAcgBtAEsAbABlAHUAcgBlAG4ALQBMAEMARABWAOQAcgBpAC0ATABDAEQATABDAEQAIABjAG8AbABvAHIAaQBMAEMARAAgAGMAbwBsAG8AcgBBAEMATAAgAGMAbwB1AGwAZQB1AHIgDwBMAEMARAAgBkUGRAZIBkYGKQQaBD4EOwRMBD4EQAQ+BDIEOAQ5ACAATABDAEQgDwBMAEMARAAgBeYF0QXiBdUF4AXZX2mCcgBMAEMARABMAEMARAAgAE0A4AB1AEYAYQByAGUAYgBuAP0AIABMAEMARAQmBDIENQRCBD0EPgQ5ACAEFgQaAC0ENAQ4BEEEPwQ7BDUEOQBDAG8AbABvAHUAcgAgAEwAQwBEAEwAQwBEACAAYwBvAHUAbABlAHUAcgBXAGEAcgBuAGEAIABMAEMARAkwCQIJFwlACSgAIABMAEMARABMAEMARAAgDioONQBMAEMARAAgAGUAbgAgAGMAbwBsAG8AcgBGAGEAcgBiAC0ATABDAEQAQwBvAGwAbwByACAATABDAEQATABDAEQAIABDAG8AbABvAHIAaQBkAG8ASwBvAGwAbwByACAATABDAEQDiAOzA8cDwQPJA7wDtwAgA78DuAPMA70DtwAgAEwAQwBEAEYA5AByAGcALQBMAEMARABSAGUAbgBrAGwAaQAgAEwAQwBEAEwAQwBEACAAYQAgAEMAbwByAGUAczCrMOkw/ABMAEMARAAAdGV4dAAAAABDb3B5cmlnaHQgQXBwbGUgSW5jLiwgMjAyMQAAWFlaIAAAAAAAAPMWAAEAAAABFspYWVogAAAAAAAAgwoAAD1u////vFhZWiAAAAAAAABL+gAAtCEAAArgWFlaIAAAAAAAACfSAAAOcAAAyJFjdXJ2AAAAAAAABAAAAAAFAAoADwAUABkAHgAjACgALQAyADYAOwBAAEUASgBPAFQAWQBeAGMAaABtAHIAdwB8AIEAhgCLAJAAlQCaAJ8AowCoAK0AsgC3ALwAwQDGAMsA0ADVANsA4ADlAOsA8AD2APsBAQEHAQ0BEwEZAR8BJQErATIBOAE+AUUBTAFSAVkBYAFnAW4BdQF8AYMBiwGSAZoBoQGpAbEBuQHBAckB0QHZAeEB6QHyAfoCAwIMAhQCHQImAi8COAJBAksCVAJdAmcCcQJ6AoQCjgKYAqICrAK2AsECywLVAuAC6wL1AwADCwMWAyEDLQM4A0MDTwNaA2YDcgN+A4oDlgOiA64DugPHA9MD4APsA/kEBgQTBCAELQQ7BEgEVQRjBHEEfgSMBJoEqAS2BMQE0wThBPAE/gUNBRwFKwU6BUkFWAVnBXcFhgWWBaYFtQXFBdUF5QX2BgYGFgYnBjcGSAZZBmoGewaMBp0GrwbABtEG4wb1BwcHGQcrBz0HTwdhB3QHhgeZB6wHvwfSB+UH+AgLCB8IMghGCFoIbgiCCJYIqgi+CNII5wj7CRAJJQk6CU8JZAl5CY8JpAm6Cc8J5Qn7ChEKJwo9ClQKagqBCpgKrgrFCtwK8wsLCyILOQtRC2kLgAuYC7ALyAvhC/kMEgwqDEMMXAx1DI4MpwzADNkM8w0NDSYNQA1aDXQNjg2pDcMN3g34DhMOLg5JDmQOfw6bDrYO0g7uDwkPJQ9BD14Peg+WD7MPzw/sEAkQJhBDEGEQfhCbELkQ1xD1ERMRMRFPEW0RjBGqEckR6BIHEiYSRRJkEoQSoxLDEuMTAxMjE0MTYxODE6QTxRPlFAYUJxRJFGoUixStFM4U8BUSFTQVVhV4FZsVvRXgFgMWJhZJFmwWjxayFtYW+hcdF0EXZReJF64X0hf3GBsYQBhlGIoYrxjVGPoZIBlFGWsZkRm3Gd0aBBoqGlEadxqeGsUa7BsUGzsbYxuKG7Ib2hwCHCocUhx7HKMczBz1HR4dRx1wHZkdwx3sHhYeQB5qHpQevh7pHxMfPh9pH5Qfvx/qIBUgQSBsIJggxCDwIRwhSCF1IaEhziH7IiciVSKCIq8i3SMKIzgjZiOUI8Ij8CQfJE0kfCSrJNolCSU4JWgllyXHJfcmJyZXJocmtyboJxgnSSd6J6sn3CgNKD8ocSiiKNQpBik4KWspnSnQKgIqNSpoKpsqzysCKzYraSudK9EsBSw5LG4soizXLQwtQS12Last4S4WLkwugi63Lu4vJC9aL5Evxy/+MDUwbDCkMNsxEjFKMYIxujHyMioyYzKbMtQzDTNGM38zuDPxNCs0ZTSeNNg1EzVNNYc1wjX9Njc2cjauNuk3JDdgN5w31zgUOFA4jDjIOQU5Qjl/Obw5+To2OnQ6sjrvOy07azuqO+g8JzxlPKQ84z0iPWE9oT3gPiA+YD6gPuA/IT9hP6I/4kAjQGRApkDnQSlBakGsQe5CMEJyQrVC90M6Q31DwEQDREdEikTORRJFVUWaRd5GIkZnRqtG8Ec1R3tHwEgFSEtIkUjXSR1JY0mpSfBKN0p9SsRLDEtTS5pL4kwqTHJMuk0CTUpNk03cTiVObk63TwBPSU+TT91QJ1BxULtRBlFQUZtR5lIxUnxSx1MTU19TqlP2VEJUj1TbVShVdVXCVg9WXFapVvdXRFeSV+BYL1h9WMtZGllpWbhaB1pWWqZa9VtFW5Vb5Vw1XIZc1l0nXXhdyV4aXmxevV8PX2Ffs2AFYFdgqmD8YU9homH1YklinGLwY0Njl2PrZEBklGTpZT1lkmXnZj1mkmboZz1nk2fpaD9olmjsaUNpmmnxakhqn2r3a09rp2v/bFdsr20IbWBtuW4SbmtuxG8eb3hv0XArcIZw4HE6cZVx8HJLcqZzAXNdc7h0FHRwdMx1KHWFdeF2Pnabdvh3VnezeBF4bnjMeSp5iXnnekZ6pXsEe2N7wnwhfIF84X1BfaF+AX5ifsJ/I3+Ef+WAR4CogQqBa4HNgjCCkoL0g1eDuoQdhICE44VHhauGDoZyhteHO4efiASIaYjOiTOJmYn+imSKyoswi5aL/IxjjMqNMY2Yjf+OZo7OjzaPnpAGkG6Q1pE/kaiSEZJ6kuOTTZO2lCCUipT0lV+VyZY0lp+XCpd1l+CYTJi4mSSZkJn8mmia1ZtCm6+cHJyJnPedZJ3SnkCerp8dn4uf+qBpoNihR6G2oiailqMGo3aj5qRWpMelOKWpphqmi6b9p26n4KhSqMSpN6mpqhyqj6sCq3Wr6axcrNCtRK24ri2uoa8Wr4uwALB1sOqxYLHWskuywrM4s660JbSctRO1irYBtnm28Ldot+C4WbjRuUq5wro7urW7LrunvCG8m70VvY++Cr6Evv+/er/1wHDA7MFnwePCX8Lbw1jD1MRRxM7FS8XIxkbGw8dBx7/IPci8yTrJuco4yrfLNsu2zDXMtc01zbXONs62zzfPuNA50LrRPNG+0j/SwdNE08bUSdTL1U7V0dZV1tjXXNfg2GTY6Nls2fHadtr724DcBdyK3RDdlt4c3qLfKd+v4DbgveFE4cziU+Lb42Pj6+Rz5PzlhOYN5pbnH+ep6DLovOlG6dDqW+rl63Dr++yG7RHtnO4o7rTvQO/M8Fjw5fFy8f/yjPMZ86f0NPTC9VD13vZt9vv3ivgZ+Kj5OPnH+lf65/t3/Af8mP0p/br+S/7c/23//3BhcmEAAAAAAAMAAAACZmYAAPKnAAANWQAAE9AAAApbdmNndAAAAAAAAAABAAEAAAAAAAAAAQAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAQAAbmRpbgAAAAAAAAA2AACuAAAAUgAAAEPAAACwwAAAJoAAAA2AAABQAAAAVEAAAjMzAAIzMwACMzMAAAAAAAAAAHNmMzIAAAAAAAEMcgAABfj///MdAAAHugAA/XL///ud///9pAAAA9kAAMBxbW1vZAAAAAAAAAYQAACgRAAAAADZk12AAAAAAAAAAAAAAAAAAAAAAHZjZ3AAAAAAAAMAAAACZmYAAwAAAAJmZgADAAAAAmZmAAAAAjMzNAAAAAACMzM0AAAAAAIzMzQA/8AAEQgAgACAAwEiAAIRAQMRAf/EAB8AAAEFAQEBAQEBAAAAAAAAAAABAgMEBQYHCAkKC//EALUQAAIBAwMCBAMFBQQEAAABfQECAwAEEQUSITFBBhNRYQcicRQygZGhCCNCscEVUtHwJDNicoIJChYXGBkaJSYnKCkqNDU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6g4SFhoeIiYqSk5SVlpeYmZqio6Slpqeoqaqys7S1tre4ubrCw8TFxsfIycrS09TV1tfY2drh4uPk5ebn6Onq8fLz9PX29/j5+v/EAB8BAAMBAQEBAQEBAQEAAAAAAAABAgMEBQYHCAkKC//EALURAAIBAgQEAwQHBQQEAAECdwABAgMRBAUhMQYSQVEHYXETIjKBCBRCkaGxwQkjM1LwFWJy0QoWJDThJfEXGBkaJicoKSo1Njc4OTpDREVGR0hJSlNUVVZXWFlaY2RlZmdoaWpzdHV2d3h5eoKDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uLj5OXm5+jp6vLz9PX29/j5+v/bAEMAAQEBAQEBAgEBAgICAgICAwICAgIDBAMDAwMDBAUEBAQEBAQFBQUFBQUFBQYGBgYGBgcHBwcHCAgICAgICAgICP/bAEMBAQEBAgICAwICAwgFBAUICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICP/dAAQACP/aAAwDAQACEQMRAD8A/t+3rRvWs7z89T+tJ53v+tAGlvWjetZvne/60ed7/rQBo+Yvv/n8KPMX3/z+FZ3ne/60nnN6/rQBpeYvv/n8KPMX3/z+FZvnN6/rR5zev60AaXmL7/5/CjzF9/8AP4VmeefWjzz60AafmL7/AOfwo8xff/P4VmeefWjz89TQBp+Yvv8A5/CjzF9/8/hWX5wo84UAanmDt/n9KTzP8/5FZnnCjzhQB//Q/tV85fU/nR5y+p/Osjzmo88igDW873/Wjzvf9ayPtB/z/wDqo+0H/P8A+qgDW8/Hf9aPtA9/8/hWT9oP+f8A9VH2g/5//VQBrfaB7/5/Cj7QPf8Az+FZP2g/5/8A1Uefnqf1oA1vtA9/8/hR9oHv/n8KyPO9/wBaPOPY/rQBr+eDSectZHnN6/rR5zev60Aa/nLSecKyfOb1/Wk88+tAGv5woM2KyPPPrR559aAP/9H+yX7Qf8//AKqPtB/z/wDqrKMuOhzSecfegDW+0H/P/wCqj7Qf8/8A6qyfOPvR5x96ANXzvf8AWjzvf9ayvOPvSeePWgDW873/AFpPtA9/8/hWT5y+p/Ojzl9T+dAGr559aPPPrWV5y+p/Ojzl9T+dAGr559aPPPrWV5y+p/Ojzl9T+dAGr559aPPPrWR5zev60ec3r+tAGv559aTzhWT5zev60ec3r+tAH//S/r1+0Un2msT7SPWj7SPWgDb+00v2kd6w/tI9aT7SO9AG59po+01hfaVo+0rQBu/aaT7QPf8Az+FYf2laPtK0Abn2ge/+fwo8/PSsP7StJ549aANzzz60faCO9Yfnj1pPtK+9AG59pb3o+0t71h/aV96PtK+9AG59pPek+0+/+fzrD+0jtR9poA//0/6vftK+9H2lfeue+00faaAOh+0r70n2n/OK5/7TR9poA6D7SPf8v/r0faR7/l/9euf+00faaAOg+0j3/L/69H2ke/5f/XrnvtR9DR9qPoaAN/7WO3+f1o+1j/P/AOuuf+0/Wj7T9aAN/wC1L7/nR9qX3/Ouf+0t70faW96AOg+1L7/nR9qX3/Ouf+0t70faW96AN/7T7/5/Oj7V/nNYH2k96PtJ7UAf/9T+n77S3rR9pb1rn/tK/wCR/wDXo+0r/kf/AF6AOgNyQM5pv2keorANzmk+0496AOhFzjow/Oj7Uf7361zv2o+ho+1H0NAHQ/am/vD86PtTf3h+dc99qPoaPtR9DQB0Bu2Hem/afesH7UfQ0faj6GgDe+0j1o+0j1rB+1H0NH2r1FAG99pHrR9oHrWB9rH+f/10husj/P8AjQBv/ah60fah61z/ANqPak+1N/k0Af/V/o++0t6ik+0t7Vzn21D0I/z+VJ9tUf5//XQB0fnt6ij7Qw7iub+3L/n/APVR9uX2oA6P7S1H2k+ornPty+1H29fagDo/tJ9RQbgnuPzrm/ty/wCf/wBVH25f8/8A6qAOj8//AGh+dJ9pHrXO/bl/z/8AqpPt30/z+FAHR/afRqPtJ/vCub+3L6ij7cvqPzoA6T7Sf71H2j/armvty+o/Oj7cvqPzoA6T7R/tUn2k+prnPtw9R/Og32Op/wA/lQB//9b9wP8AhKov7wpP+Epi/vf5/OvmA+ObYH/Wp+dJ/wAJ1b/89V/76oA+oP8AhKYv73+fzo/4SmL+9/n86+X/APhOrf8A56r/AN9Uf8J1b/8APVf++qAPqD/hKYv73+fzo/4SmL+9/n86+X/+E6t/+eq/99Uf8J1b/wDPVf8AvqgD6g/4SmLs386P+Eoi/vH9a+X/APhOrf8A56r/AN9Uf8J1b/8APVf++qAPqD/hKIv7x/Wj/hKYv73+fzr5f/4Tq3/56r/31Sf8JxB/z2X86APqH/hK4/Wm/wDCUQ+o/OvmD/hOIP8Ansv50f8ACcwD/lsp/GgD6c/4SqH3/OkPiqP+HP518x/8J1B/z1H/AH1R/wAJ1B/z1H/fVAH03/wlS0o8VJ3r5iPjq37zD/vqk/4Tq3/57D/vugD/2Q==",
"texture/wall_ssao_old.jpg":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEBLAEsAAD/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wAARCACAAIADASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD+33ePQ/p/jRvHof0/xrM8/PU5/wC+qTzh7fkaANTePQ/p/jSeYOw/p/jWZ5w9vyNHnD2/I0Aafme36/8A1qPM9v1/+tWZ5w9vyNJ5v+1+n/1qANTzPb9f/rUeZ7fr/wDWrL83/a/T/wCtR5v+1+n/ANagDU8z2/X/AOtR5nt+v/1qyvO9z+Qo84+/5CgDV8z2/X/61HmAdRj8f/rVledjqSPwWk88f3v/AEGgDV80e3/fQ/wo80e3/fQ/wrK88f3v/QaPPH97/wBBoA1fNHbH55/wpPN91/P/AOvWX54/vf8AoNHnj+9/6DQBl+cv+c/4Uecv+c/4Vkecf7w/M/40eeR/EPzJ/kaANbzh7fkaPOHt+RrI88/3v/QqPPP97/0KgDW872z+B/qRR5/t+n/16yfPP97/ANCo88/3v/QqANbz/b9P/r0ef7fp/wDXrJ88/wB7/wBCo8/PU5/76oA1vP8Ab9P/AK9Hn+36f/XrI84e35GjzvcD8D/XNAGv5/t+n/16PP8Ab9P/AK9Y/m/7X6f/AFqPN/2v0/8ArUAbHn+36f8A16TzvqPwH9SayPN/2v0/+tSecff8hQBsecff8hR5x7Z/ID/Gsfzj7/kKTzx/e/8AQaAMvzz/AHv/AEKjzz/e/wDQqyDP6E/iWP8AhSeef73/AKFQBseef73/AKFR55/vf+hVj+ef73/oVHnn+9/6FQBr+cPb8jR5w9vyNZHnn+9/6FSfaD7/AK//ABVAGx5w9vyNJ5/t+n/16x/P9v0/+vSfaB7fp/8AFUAbHnH3/IUecff8hWP9oHt+n/xVH2ge36f/ABVAGx5x9/yFHnH3/IVj/aB7fp/8VR9oHqP0/wAaANjzj7/kKPOPv+QrG88f3v8A0Gjzx/e/9BoA2fOPv+Qo84+/5Csbzx/e/wDQaPPH97/0GgDH8/0P/oI/xpPtB9R+Y/wrE+0ezfnR9o9m/OgDb+0H1H5j/Cj7Rj0/n/IfzrE+0ezfnSfaD7/r/jQBt/aff/P/AHzR9p9/8/8AfNYn2g+/6/8AxVH2g+/6/wDxVAG39p9/8/8AfNH2n3/z/wB81ifaD7/r/wDFUfaD7/r/APFUAbf2n3/z/wB80faM9/5j+S1ifaD7/wCf+BUnn+36f/XoA2/tA9T+Z/wo+0ehP5sf8Kw/tA9v0/xpPtHsv50Abnnn+9/6FR55/vf+hVh/aPZfzo+0ey/nQBufaD65/P8AqRSfaD7/AK//ABVYf2j6D8R/UGj7QfUfmP8ACgDH+1D0H6/4Ufah6D9f8K5/7QfUfmP8KPtB9R+Y/wAKAOg+0+w/X/Ck+0/T8Qf6AfzrA+0H1H5j/Ck+0+/+f++aAOg+0n/Z/Jv8aPtJ/wBn8m/xrn/tI/vKPqQD+RFH2kf3l/76X/CgDoPtJ/2fyb/Gj7Uf9n8m/wAa577T/tp+Y/xo+0n++n5j/GgDe+1+4H5f1Y0faz6j8h/jWD9pP99PzH+NJ9q/21/KgDf+1n1H5D/Gj7WfUfkP8a5/7SP74/M/40faR/fH5n/GgDoPtZ9R+Q/xo+1n1H5D/Guf+0j++PzP+NH2kf3x+Z/xoA3/ALV7/r/9lR9qP979F/rWB9p/2gfxP9SKT7V6tj8z/ImgDD+0j/a/Jf8AGj7SP9r8l/xrnvtLeoP4f44pPtLf5A/xoA6E3QHc59wo/rSfax/krXOm69/1x/7NR9qPZsf98n+ZNAHRfax/krR9rH+Stc79qP8Af/RKPtR/v/olAHQ/ah6n/voUfah6n/vof41z32o/3/0Sg3R/v/kF/pzQB0H2odj+uf6ij7V75/4Fj+prnftX+235Ufav9tvyoA6L7V/nf/8AWo+1f53/AP1q537V/tsPrgfqaPtXpJ/48o/qaAOi+1f53/8A1qPteP8A9sn+QrnPtR/vj/vsUhu/Vwf+BA/0oA6L7Wf8lv8ACj7Wf8lq5z7UP72PocfyFH2of3z/AN9mgDE+0KOox+Io+0J6fqK5P+1V7sPwY5/r/Kk/tVOzH88/0FAHW/aE9P1FHng9B/X+RFcj/aq/3/50n9qIerA/h/8AWoA6/wA/2/T/AOvR5/t/T9cnFch/aaf3h+X/ANaj+00/vD8v/rUAdd9pHoP++x/hR9pHoP8Avsf4VyP9qJ/fP5tR/ai/3z+bUAdd9pHoP++h/hSfaPZfzrkv7UX++fzak/tKP+9+rUAdd9o9l/Oj7Tjsv5k/yrkf7RX+8v8A32RTf7TX/LGgDr/tQ9B+v+FH2oeg/X/CuP8A7UX0P5t/hR/aqfT6sR/OgDsPtI9h75x/MYpPtI/vL/30v+Fch/aqf3gP+BZ/qKP7UTsw/PH/ALOaAPB/+Eucf8tx+ef5Gk/4S5/+e3869zi/4J0/tP3EUU0dx8NzHNFHKhHi28cbJFDp88OiSRPlSDvikkiYcxyOpDGT/h3H+1F/z3+HH/hV6h/8oaAPCP8AhLn/AOe386P+Evf/AJ7fzr3f/h3H+1F/z3+HH/hV6h/8oaP+Hcf7UX/Pf4cf+FXqH/yhoA8I/wCEuf8A57fzo/4S5/8Ant/Ovd/+Hcf7UX/Pf4cf+FXqH/yho/4dx/tRf89/hx/4Veof/KGgDwn/AIS5u85/U/1FH/CXH/nufyP/AMVXu3/DuP8Aai/57/Dj/wAKvUP/AJQ0f8O4/wBqL/nv8OP/AAq9Q/8AlDQB4T/wlzf89z+R/wAab/wmB/5+B+Z/xr3j/h3H+1F/z3+HH/hV6h/8oaP+Hcf7UX/Pf4cf+FXqH/yhoA8G/wCEvP8Az8f+PN/jR/wl55/0jr/tH/Gvef8Ah3H+1F/z3+HH/hV6h/8AKGj/AIdx/tRf8/Hw4H/c16h/XQTQB4L/AMJcf+fk/wDfRpP+EtJ63Gf+BV71/wAO4v2ov+fj4c/+FXf/APygo/4dxftRf8/Hw5/8Ku//APlBQB4L/wAJbj/l4/Un+QpP+Eux0uCP++v8K97/AOHcX7Ufa4+HP/hV34/9180n/DuL9qP/AJ+Phx/4Vmof/M/QB//Z",
"texture/floor_default.png":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAGUlEQVQokWP89+8fAymAhSTVoxpGNQwpDQB6MwM4l3RPJAAAAABJRU5ErkJggg=="},data_providers:[{type:"image",name:"globe image",guid:"123-rf456-234324",map_projection:"equirectangular",texture_size:256,texture_format:".jpg",priority:0,extent:{latitude_min:-90,latitude_max:90,longitude_min:-180,longitude_max:180,altitude_min:0,altitude_max:0},data_levels:{min:0,max:10},resolution:10,visible_levels:{min:0,
max:19},data_main_path:"",data_servers:[{name:"a",type:"http",url:""},{name:"b",type:"http",url:""},{name:"c",type:"http",url:""}]},{type:"mesh",name:"mesh",guid:"3454-dfgdfg7885",map_projection:"data",texture_size:512,texture_format:".jpg",mesh_format:".agm",mesh_format_version:"1.0",priority:1,extent:{latitude_min:-90,latitude_max:90,longitude_min:-180,longitude_max:180,altitude_min:0,altitude_max:1E3},data_levels:{min:13,max:16},visible_levels:{min:13,max:19},data_main_path:"",data_servers:[{name:"a",
type:"http",url:""},{name:"b",type:"http",url:""},{name:"c",type:"http",url:""}]}],max_texture_upload_pixels_per_frame:393216,max_vertex_upload_count_per_frame:5E3,max_mesh_upload_count_per_frame:64,max_tile_cache:256,statics_per_frame:!0,max_map_levels:19,debug:!1,wire_frame:!1};b.base_relative_path=window.dxMapPath?window.dxMapPath+"map/assets/":"./assets/";b.base_resource_url="";b.download_controller_options={};b.download_controller_options.generic_limit=6;b.download_controller_options.mesh={limit:6};
b.download_controller_options.image={limit:6};b.availble_buffer_count_per_frame=60;b.availble_texture_count_per_frame=20;b.model_layer_life_time_list=[1800,1200,900,600,600,600,600,120,120,90,90];b.device_clear_color=[0.5,0.5,0.5,1];b.RenderFont={faceName:"Calibri",isBold:!0,fontWidth:14,fontHeight:14};b.useWorkerContent=!0;b.worker={count:1,url:window.dxMapPath?window.dxMapPath+"sdk/plugin.rs.js":"sdk/plugin.rs.js"};b.worker.content='/**\r\n * Created by ge.jiang on 2015/1/5.\r\n */\r\n\r\nvar RESOURCE_ERROR_MISS = -2,\r\n    RESOURCE_ERROR = -1,\r\n    RESOURCE_WAITING = 0,\r\n    RESOURCE_PENDING_DISPATCH = 1,\r\n    RESOURCE_LOADING = 2,\r\n    RESOURCE_ABORTING = 3,\r\n    RESOURCE_LOADED = 4,\r\n    RESOURCE_COMPILED = 5,\r\n    RESOURCE_TEXTURES_READY = 6,\r\n    RESOURCE_READY = 7;\r\n    Matrix_create = function () {\r\n        return [1, 0, 0, 0,\r\n            0, 1, 0, 0,\r\n            0, 0, 1, 0,\r\n            0, 0, 0, 1];\r\n    };\r\n    \r\n    var Matrix_rotateAxisX = function (retVal, angel) {\r\n        var cos_angel = Math.cos(angel);\r\n        var sin_angel = Math.sin(angel);\r\n        retVal[0] = 1;\r\n        retVal[1] = 0;\r\n        retVal[2] = 0;\r\n        retVal[3] = 0;\r\n        retVal[4] = 0;\r\n        retVal[5] = cos_angel;\r\n        retVal[6] = sin_angel;\r\n        retVal[7] = 0;\r\n        retVal[8] = 0;\r\n        retVal[9] = -sin_angel;\r\n        retVal[10] = cos_angel;\r\n        retVal[11] = 0;\r\n        retVal[12] = 0;\r\n        retVal[13] = 0;\r\n        retVal[14] = 0;\r\n        retVal[15] = 1;\r\n    };\r\n    \r\n    Matrix_scale = function (retVal, x, y, z) {\r\n        retVal[0] = x;\r\n        retVal[1] = 0;\r\n        retVal[2] = 0;\r\n        retVal[3] = 0;\r\n        retVal[4] = 0;\r\n        retVal[5] = y;\r\n        retVal[6] = 0;\r\n        retVal[7] = 0;\r\n        retVal[8] = 0;\r\n        retVal[9] = 0;\r\n        retVal[10] = z;\r\n        retVal[11] = 0;\r\n        retVal[12] = 0;\r\n        retVal[13] = 0;\r\n        retVal[14] = 0;\r\n        retVal[15] = 1;\r\n    };\r\n    \r\n    // var Matrix_rotateAxisY = function (retVal, angel) {\r\n    //     var cos_angel = Math.cos(angel);\r\n    //     var sin_angel = Math.sin(angel);\r\n    //     retVal[0] = cos_angel;\r\n    //     retVal[1] = 0;\r\n    //     retVal[2] = -sin_angel;\r\n    //     retVal[3] = 0;\r\n    //     retVal[4] = 0;\r\n    //     retVal[5] = 0;\r\n    //     retVal[6] = 0;\r\n    //     retVal[7] = 0;\r\n    //     retVal[8] = sin_angel;\r\n    //     retVal[9] = 0;\r\n    //     retVal[10] = cos_angel;\r\n    //     retVal[11] = 0;\r\n    //     retVal[12] = 0;\r\n    //     retVal[13] = 0;\r\n    //     retVal[14] = 0;\r\n    //     retVal[15] = 1;\r\n    // };\r\n      var Vector3_length = function (vec) {\r\n        return Math.sqrt(vec[0] * vec[0] + vec[1] * vec[1] + vec[2] * vec[2]);\r\n      };\r\n\r\n    var Vector3_normalize = function (retVal, vec) {\r\n        var length = Vector3_length(vec);\r\n        if (length > 0.0) {\r\n          var r = 1 / length;\r\n          retVal[0] = (vec[0] * r);\r\n          retVal[1] = (vec[1] * r);\r\n          retVal[2] = (vec[2] * r);\r\n        }\r\n        return retVal;\r\n      };\r\n    \r\n    var Matrix_rotateAxisZ = function (retVal, angel) {\r\n        var cos_angel = Math.cos(angel);\r\n        var sin_angel = Math.sin(angel);\r\n        retVal[0] = cos_angel;\r\n        retVal[1] = sin_angel;\r\n        retVal[2] = 0;\r\n        retVal[3] = 0;\r\n        retVal[4] = -sin_angel;\r\n        retVal[5] = cos_angel;\r\n        retVal[6] = 0;\r\n        retVal[7] = 0;\r\n        retVal[8] = 0;\r\n        retVal[9] = 0;\r\n        retVal[10] = 1;\r\n        retVal[11] = 0;\r\n        retVal[12] = 0;\r\n        retVal[13] = 0;\r\n        retVal[14] = 0;\r\n        retVal[15] = 1;\r\n    };\r\n    var Quaternion_fromEuler = function (retVal, x, y, z) {\r\n        var c1 = Math.cos(y * 0.5);\r\n        var c2 = Math.cos(z * 0.5);\r\n        var c3 = Math.cos(x * 0.5);\r\n        var s1 = Math.sin(y * 0.5);\r\n        var s2 = Math.sin(z * 0.5);\r\n        var s3 = Math.sin(x * 0.5);\r\n        retVal[3] = c1 * c2 * c3 - s1 * s2 * s3;\r\n        retVal[0] = s1 * s2 * c3 + c1 * c2 * s3;\r\n        retVal[1] = s1 * c2 * c3 + c1 * s2 * s3;\r\n        retVal[2] = c1 * s2 * c3 - s1 * c2 * s3;\r\n    };\r\n\r\n    var Matrix_fromQuaternion = function (retVal, q) {\r\n        var x = q[0], y = q[1], z = q[2], w = q[3];\r\n        var xx = x * x;\r\n        var xy = x * y;\r\n        var xz = x * z;\r\n        var xw = x * w;\r\n    \r\n        var yy = y * y;\r\n        var yz = y * z;\r\n        var yw = y * w;\r\n    \r\n        var zz = z * z;\r\n        var zw = z * w;\r\n    \r\n        retVal[0] = 1 - 2 * ( yy + zz );\r\n        retVal[1] = 2 * ( xy + zw );\r\n        retVal[2] = 2 * ( xz - yw );\r\n    \r\n        retVal[4] = 2 * ( xy - zw );\r\n        retVal[5] = 1 - 2 * ( xx + zz );\r\n        retVal[6] = 2 * ( yz + xw );\r\n    \r\n        retVal[8] = 2 * ( xz + yw );\r\n        retVal[9] = 2 * ( yz - xw );\r\n        retVal[10] = 1 - 2 * ( xx + yy );\r\n    \r\n        retVal[3] = retVal[7] = retVal[11] = retVal[12] = retVal[13] = retVal[14] = 0;\r\n        retVal[15] = 1;\r\n    };\r\n    \r\n    var Matrix_multiply = function (retVal, m1, m2) {\r\n        var M00 = m1[0], M01 = m1[1], M02 = m1[2], M03 = m1[3],\r\n            M10 = m1[4], M11 = m1[5], M12 = m1[6], M13 = m1[7],\r\n            M20 = m1[8], M21 = m1[9], M22 = m1[10], M23 = m1[11],\r\n            M30 = m1[12], M31 = m1[13], M32 = m1[14], M33 = m1[15],\r\n    \r\n            n00 = m2[0], n01 = m2[1], n02 = m2[2], n03 = m2[3],\r\n            n10 = m2[4], n11 = m2[5], n12 = m2[6], n13 = m2[7],\r\n            n20 = m2[8], n21 = m2[9], n22 = m2[10], n23 = m2[11],\r\n            n30 = m2[12], n31 = m2[13], n32 = m2[14], n33 = m2[15];\r\n    \r\n        retVal[0] = M00 * n00 + M01 * n10 + M02 * n20 + M03 * n30;\r\n        retVal[1] = M00 * n01 + M01 * n11 + M02 * n21 + M03 * n31;\r\n        retVal[2] = M00 * n02 + M01 * n12 + M02 * n22 + M03 * n32;\r\n        retVal[3] = M00 * n03 + M01 * n13 + M02 * n23 + M03 * n33;\r\n    \r\n        retVal[4] = M10 * n00 + M11 * n10 + M12 * n20 + M13 * n30;\r\n        retVal[5] = M10 * n01 + M11 * n11 + M12 * n21 + M13 * n31;\r\n        retVal[6] = M10 * n02 + M11 * n12 + M12 * n22 + M13 * n32;\r\n        retVal[7] = M10 * n03 + M11 * n13 + M12 * n23 + M13 * n33;\r\n    \r\n        retVal[8] = M20 * n00 + M21 * n10 + M22 * n20 + M23 * n30;\r\n        retVal[9] = M20 * n01 + M21 * n11 + M22 * n21 + M23 * n31;\r\n        retVal[10] = M20 * n02 + M21 * n12 + M22 * n22 + M23 * n32;\r\n        retVal[11] = M20 * n03 + M21 * n13 + M22 * n23 + M23 * n33;\r\n    \r\n        retVal[12] = M30 * n00 + M31 * n10 + M32 * n20 + M33 * n30;\r\n        retVal[13] = M30 * n01 + M31 * n11 + M32 * n21 + M33 * n31;\r\n        retVal[14] = M30 * n02 + M31 * n12 + M32 * n22 + M33 * n32;\r\n        retVal[15] = M30 * n03 + M31 * n13 + M32 * n23 + M33 * n33;\r\n    };\r\n\r\n    Vector3_dot = function( vec1, vec2 ) {\r\n        return vec1[0] * vec2[0] + vec1[1] * vec2[1] + vec1[2] * vec2[2];\r\n    };\r\n\r\n    Vector3_transformCoords = function (retVal, vec, mat) {\r\n        var vX = vec[0];\r\n        var vY = vec[1];\r\n        var vZ = vec[2];\r\n        var vW = 1.0;\r\n    \r\n        var x = mat[0] * vX + mat[4] * vY + mat[8] * vZ + mat[12] * vW;\r\n        var y = mat[1] * vX + mat[5] * vY + mat[9] * vZ + mat[13] * vW;\r\n        var z = mat[2] * vX + mat[6] * vY + mat[10] * vZ + mat[14] * vW;\r\n        // var w = matrix[3] * vX + matrix[7] * vY + matrix[11] * vZ + matrix[15] * vW;\r\n    \r\n        retVal[0] = x;\r\n        retVal[1] = y;\r\n        retVal[2] = z;\r\n        // result.w = w;\r\n        return retVal;\r\n    };\r\n    \r\n    Vector3_transformNormal = function (retVal, vec, mat) {\r\n        var x = vec[0], y = vec[1], z = vec[2];\r\n        retVal[0] = x * mat[0] + y * mat[4] + z * mat[8];\r\n        retVal[1] = x * mat[1] + y * mat[5] + z * mat[9];\r\n        retVal[2] = x * mat[2] + y * mat[6] + z * mat[10];\r\n    };\r\n\r\nonmessage = function (event) {\r\n    var data = IndoorRSMeshParser.parse(event.data);\r\n    var patchData = createPatch(data);\r\n    postMessage(patchData);\r\n};\r\n\r\n\r\n\r\nvar createPatch = function (data) {\r\n    var _patchs = [];\r\n    var jpeg = null;\r\n    var i, j;\r\n    if (data.qcmsEntry === undefined) {\r\n        return {state: RESOURCE_ERROR};\r\n    }\r\n\r\n    if (data.jpegEntry !== undefined) {\r\n\r\n        jpeg = {buffer: data.jpegEntry.jpegBuffer};\r\n    }\r\n    \r\n    var sizeOfQCMS = data.qcmsEntry.length;\r\n    for (j = 0; j < sizeOfQCMS; j++) {\r\n        var curQCMSEntry = data.qcmsEntry[j];\r\n        if (curQCMSEntry !== undefined && curQCMSEntry !== null) {\r\n            for (i = 0; i < curQCMSEntry.materialCount; i++) {\r\n                var building = curQCMSEntry.buildings[i];\r\n                if(!building) continue;\r\n                var materialName = building.materialName;\r\n                if (materialName === "shadows") {\r\n                    // var patch = new ReccePatch();\r\n                    var patch = {};\r\n                    patch._patchType = 2;\r\n                    patch.building = building;\r\n                    _patchs.push(patch);\r\n                    // patch.initialize(thisObject.framework, building);\r\n                    // thisObject.patchs.push(patch);\r\n\r\n                }\r\n                else if (materialName === "terrain_253" || materialName === "terrain_254" || materialName === "terrain_255" || materialName === "texture/sxh_018.jpg") {\r\n                    // var patch = new ReccePatch();\r\n                    var patch = {};\r\n                    patch._patchType = 1;\r\n                    patch.building = building;\r\n                    _patchs.push(patch);\r\n                    // patch.initialize(thisObject.framework, building);\r\n                    //  thisObject.patchs.push(patch);\r\n                }\r\n                else {\r\n                    var patch = {};\r\n                    patch._patchType = 0;\r\n                    patch.building = building;\r\n                    _patchs.push(patch);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    return {state: RESOURCE_COMPILED, data: _patchs, jpeg: jpeg};\r\n\r\n};\r\n\r\n\r\nvar IndoorRSMeshParser = {};\r\n\r\nIndoorRSMeshParser.TAG_HCFF = 0x48434646;\r\nIndoorRSMeshParser.TAG_GLOW = 0x474C4F57;\r\nIndoorRSMeshParser.TAG_JPEG = 0x4A504547;\r\nIndoorRSMeshParser.TAG_LCMT = 0x4C434D54;\r\nIndoorRSMeshParser.TAG_CMDL = 0x434D444C;\r\nIndoorRSMeshParser.TAG_QCMS = 0x51434D53;\r\nIndoorRSMeshParser.TAG_TREE = 0x54524545;\r\nIndoorRSMeshParser.TAG_ROAD = 0x524F4144;\r\nIndoorRSMeshParser.TAG_RAIL = 0x5241494C;\r\n\r\nIndoorRSMeshParser.parse = function (byteStream, recceLayer) {\r\n    if (byteStream.byteLength === 0){\r\n        return null;\r\n    }\r\n       \r\n    recceLayer = recceLayer || {};\r\n    recceLayer.chunkData = recceLayer.chunkData || {};\r\n    var uint8Stream = new Uint8Array(byteStream);\r\n    /*copy the raw data into b4*/\r\n\r\n    var parseContext = {};\r\n    parseContext.byteStream = byteStream;\r\n    parseContext.dataView = new DataView(byteStream);\r\n\r\n\r\n    parseContext.uint8Stream = uint8Stream;\r\n    parseContext.uint8Cursor = 0;\r\n\r\n    var isContinue = true;\r\n    while (isContinue && (parseContext.uint8Cursor <= byteStream.byteLength - 4)) {\r\n        var tag = parseContext.dataView.getUint32(parseContext.uint8Cursor);\r\n        parseContext.uint8Cursor += 4;\r\n\r\n        switch (tag) {\r\n            case  IndoorRSMeshParser.TAG_HCFF:\r\n                recceLayer.chunkData.hcffEntry = IndoorRSMeshParser.parseHCFF(parseContext);\r\n                break;\r\n            case  IndoorRSMeshParser.TAG_GLOW:\r\n                recceLayer.chunkData.glowEntry = IndoorRSMeshParser.parseGlOW(parseContext);\r\n                break;\r\n            case  IndoorRSMeshParser.TAG_JPEG:\r\n                recceLayer.chunkData.jpegEntry = IndoorRSMeshParser.parseJPEG(parseContext);\r\n                break;\r\n            case  IndoorRSMeshParser.TAG_LCMT:\r\n                recceLayer.chunkData.lcmtEntry = IndoorRSMeshParser.parseLCMT(parseContext);\r\n                break;\r\n            case  IndoorRSMeshParser.TAG_CMDL:\r\n                recceLayer.chunkData.cmdlEntry = IndoorRSMeshParser.parseCMDL(parseContext);\r\n                break;\r\n            case  IndoorRSMeshParser.TAG_QCMS:\r\n                if (recceLayer.chunkData.qcmsEntry === undefined) {\r\n                    recceLayer.chunkData.qcmsEntry = new Array();\r\n                } else {\r\n                    var xxxx = 0;\r\n                }\r\n                var heightOffset = 0.0;\r\n                if (recceLayer.chunkData.roadEntry !== undefined) {\r\n                    heightOffset = 1.0;\r\n                }\r\n                recceLayer.chunkData.qcmsEntry[recceLayer.chunkData.qcmsEntry.length] = IndoorRSMeshParser.parseQCMS(parseContext, heightOffset, recceLayer.chunkData.cmdlEntry);\r\n                break;\r\n            case  IndoorRSMeshParser.TAG_TREE:\r\n                recceLayer.chunkData.treeEntry = IndoorRSMeshParser.parseTREE(parseContext);\r\n                break;\r\n            case  IndoorRSMeshParser.TAG_ROAD:\r\n                recceLayer.chunkData.roadEntry = IndoorRSMeshParser.parseROAD(parseContext);\r\n                break;\r\n            case IndoorRSMeshParser.TAG_RAIL:\r\n                recceLayer.chunkData.railEntry = IndoorRSMeshParser.parseRAIL(parseContext);\r\n                break;\r\n            default:\r\n            {\r\n                isContinue = false;\r\n            }\r\n                break;\r\n        }\r\n    }\r\n    parseContext.dataView = null;\r\n    uint8Stream = null;\r\n\r\n    return recceLayer.chunkData;\r\n};\r\n\r\nvar stringLength = 0;\r\nIndoorRSMeshParser.parseFixedString = function (parseContext) {\r\n    stringLength = parseContext.uint8Stream[parseContext.uint8Cursor++];\r\n    var str = String.fromCharCode.apply(null, [].slice.call(parseContext.uint8Stream, parseContext.uint8Cursor, parseContext.uint8Cursor + stringLength));\r\n    parseContext.uint8Cursor += stringLength;\r\n    return str;\r\n};\r\n\r\nIndoorRSMeshParser.skipAlignmentBytes = function (parseContext) {\r\n    var modeCursor = parseContext.uint8Cursor % 4;\r\n    if (modeCursor != 0) {\r\n        parseContext.uint8Cursor += (4 - modeCursor);\r\n    }\r\n};\r\n\r\nIndoorRSMeshParser.parseHCFF = function (parseContext) {\r\n    var hcffEntry = {};\r\n    //couser = 5;\r\n    var dataView = parseContext.dataView;\r\n    //hcffEntry.tag = dataView.getUint32(parseContext.uint8Cursor);    parseContext.uint8Cursor += 4;\r\n    hcffEntry.tag = IndoorRSMeshParser.TAG_HCFF;\r\n    hcffEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    hcffEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    hcffEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    hcffEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    hcffEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    return hcffEntry;\r\n};\r\n\r\nIndoorRSMeshParser.parseTREE = function (parseContext) {\r\n    var treeEntry = {};\r\n    //couser = 5;\r\n    var dataView = parseContext.dataView;\r\n    //hcffEntry.tag = dataView.getUint32(parseContext.uint8Cursor);    parseContext.uint8Cursor += 4;\r\n    treeEntry.tag = IndoorRSMeshParser.TAG_HCFF;\r\n    treeEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    treeEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    treeEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    treeEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    treeEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    IndoorRSMeshParser.skipAlignmentBytes(parseContext);\r\n    return treeEntry;\r\n};\r\n\r\nIndoorRSMeshParser.parseROAD = function (parseContext) {\r\n    var roadEntry = {};\r\n    //couser = 5;\r\n    var dataView = parseContext.dataView;\r\n    //hcffEntry.tag = dataView.getUint32(parseContext.uint8Cursor);    parseContext.uint8Cursor += 4;\r\n    roadEntry.tag = IndoorRSMeshParser.TAG_ROAD;\r\n    roadEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    roadEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    roadEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    roadEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    roadEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    IndoorRSMeshParser.skipAlignmentBytes(parseContext);\r\n    return roadEntry;\r\n};\r\n\r\nIndoorRSMeshParser.parseRAIL = function (parseContext) {\r\n    var railEntry = {};\r\n    //couser = 5;\r\n    var dataView = parseContext.dataView;\r\n    //hcffEntry.tag = dataView.getUint32(parseContext.uint8Cursor);    parseContext.uint8Cursor += 4;\r\n    railEntry.tag = IndoorRSMeshParser.TAG_RAIL;\r\n    railEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    railEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    railEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    railEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    railEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    IndoorRSMeshParser.skipAlignmentBytes(parseContext);\r\n    return railEntry;\r\n};\r\n\r\n\r\nIndoorRSMeshParser.parseGlOW = function (parseContext) {\r\n    var glowEntry = {};\r\n    //couser = 5;\r\n    var dataView = parseContext.dataView;\r\n    //glowEntry.tag = dataView.getUint32(parseContext.uint8Cursor);    parseContext.uint8Cursor += 4;\r\n    glowEntry.tag = IndoorRSMeshParser.TAG_GLOW;\r\n    glowEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    glowEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    glowEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    glowEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    glowEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    return glowEntry;\r\n};\r\n\r\nIndoorRSMeshParser.parseJPEG = function (parseContext) {\r\n    var jpegEntry = {};\r\n    //couser = 5;\r\n    var dataView = parseContext.dataView;\r\n    //jpegEntry.tag = dataView.getUint32(parseContext.uint8Cursor);    parseContext.uint8Cursor += 4;\r\n    jpegEntry.tag = IndoorRSMeshParser.TAG_JPEG;\r\n    jpegEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    jpegEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    jpegEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    jpegEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    jpegEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    jpegEntry.jpegBuffer = new Uint8Array(parseContext.byteStream, parseContext.uint8Cursor, jpegEntry.bodyLength);\r\n    parseContext.uint8Cursor += jpegEntry.bodyLength;\r\n    return jpegEntry;\r\n};\r\n\r\nIndoorRSMeshParser.parseLCMT = function (parseContext) {\r\n    var lcmtEntry = {};\r\n    var dataView = parseContext.dataView;\r\n    lcmtEntry.tag = IndoorRSMeshParser.TAG_LCMT;\r\n    lcmtEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    lcmtEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    lcmtEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    lcmtEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    lcmtEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n\r\n    IndoorRSMeshParser.skipAlignmentBytes(parseContext);\r\n    return lcmtEntry;\r\n};\r\n\r\n\r\nIndoorRSMeshParser.parseCMDL = function (parseContext) {\r\n    var cmdlEntry = {};\r\n    var dataView = parseContext.dataView;\r\n    //cmdlEntry.tag = dataView.getUint32(parseContext.uint8Cursor);    parseContext.uint8Cursor += 4;\r\n    cmdlEntry.tag = IndoorRSMeshParser.TAG_CMDL;\r\n    cmdlEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    cmdlEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    cmdlEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    cmdlEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    cmdlEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    cmdlEntry.name = IndoorRSMeshParser.parseFixedString(parseContext);\r\n    cmdlEntry.min_x = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    cmdlEntry.min_y = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    cmdlEntry.min_z = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    cmdlEntry.max_x = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    cmdlEntry.max_y = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    cmdlEntry.max_z = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    return cmdlEntry;\r\n};\r\n\r\nIndoorRSMeshParser.parseShadowData = function (shadow, parseContext, positionArray) {\r\n    var dataView = parseContext.dataView;\r\n    //////////////////////////////////////////////////////////////////////////\r\n    var verticesCount = shadow.verticesCount;\r\n    var facesIndexCount = shadow.facesIndexCount;\r\n    shadow.verticesArray = new Uint16Array(verticesCount * 4);\r\n    shadow.noramlArray = new Uint16Array(verticesCount);\r\n    shadow.faceIndices = new Uint16Array(facesIndexCount);\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6Shadow\u4f4d\u7f6e\u7d22\u5f15\r\n    //entry.shadowVerticesCount = 36;\r\n    //entry.shadowFaceIndexCount = 84;\r\n    var verticesArray = shadow.verticesArray;\r\n    //noramlArray =  qcmsEntry.shadows.noramlArray;\r\n    var faceIndices = shadow.faceIndices;\r\n\r\n    var index = 0;\r\n    var ni = 0;\r\n    for (ni = 0; ni < verticesCount; ni++) {\r\n        index += dataView.getInt16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        verticesArray[ni * 4] = positionArray[index * 3];\r\n        verticesArray[ni * 4 + 1] = positionArray[index * 3 + 1];\r\n        verticesArray[ni * 4 + 2] = positionArray[index * 3 + 2];\r\n    }\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6Shadow\u7684\u6cd5\u7ebf\r\n    for (ni = 0; ni < verticesCount; ni++) {\r\n        index = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        verticesArray[4 * ni + 3] = index;\r\n    }\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6Shadow\u9762\u7d22\u5f15\r\n    index = 0;\r\n    for (ni = 0; ni < facesIndexCount; ni++) {\r\n        index += dataView.getInt16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        faceIndices[ni] = index;\r\n    }\r\n};\r\n\r\nIndoorRSMeshParser.parseBuildingData = function (building, parseContext, positionArray) {\r\n    //var positionArray = new Uint16Array(parseContext.byteStream, parseContext.uint8Cursor, positionArrayCount * 3);    parseContext.uint8Cursor += (positionArrayCount * 3 * 2) ;\r\n    var dataView = parseContext.dataView;\r\n    //////////////////////////////////////////////////////////////////////////\r\n    var verticesCount = building.verticesCount;\r\n    var facesIndexCount = building.facesIndexCount;\r\n    building.verticesArray = new Uint16Array(verticesCount * 4);\r\n    //  qcmsEntry.buildings.noramlArray = new Uint16Array(verticesCount);\r\n    building.textureCoordArray = new Uint16Array(verticesCount * 2);\r\n    building.faceIndices = new Uint16Array(facesIndexCount);\r\n    //////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6Building\u7684Vertices\r\n    var verticesArray = building.verticesArray;\r\n    var textureCoordArray = building.textureCoordArray;\r\n    var faceIndices = building.faceIndices;\r\n\r\n    var index = 0;\r\n    var ni = 0;\r\n    for (ni = 0; ni < verticesCount; ni++) {\r\n        index += dataView.getInt16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        verticesArray[ni * 4] = positionArray[index * 3];\r\n        verticesArray[ni * 4 + 1] = positionArray[index * 3 + 1];\r\n        verticesArray[ni * 4 + 2] = positionArray[index * 3 + 2];\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6\u6cd5\u7ebf\r\n    for (ni = 0; ni < verticesCount; ni++) {\r\n        srcNor = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        var nx = (srcNor >> 10 & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n        var ny = (srcNor >> 5 & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n        var nz = (srcNor & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n        if(nz >0){\r\n            srcNor = 16896;\r\n        }\r\n        verticesArray[ni * 4 + 3] = srcNor;// 16895;// 16912;//16896;//srcNor;\r\n\r\n    }\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6\u7eb9\u7406\u5750\u6807\r\n    for (ni = 0; ni < verticesCount; ni++) {\r\n        index = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        textureCoordArray[ni * 2] = index;\r\n        index = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        textureCoordArray[ni * 2 + 1] = index;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6building\u9762\u7d22\u5f15\r\n    index = 0;\r\n    for (ni = 0; ni < facesIndexCount; ni++) {\r\n        index += dataView.getInt16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        faceIndices[ni] = index;\r\n    }\r\n};\r\n\r\nIndoorRSMeshParser.parseBuildingDataUnpack = function (building, parseContext, positionArray, cmdl) {\r\n    //var positionArray = new Uint16Array(parseContext.byteStream, parseContext.uint8Cursor, positionArrayCount * 3);    parseContext.uint8Cursor += (positionArrayCount * 3 * 2) ;\r\n    var dataView = parseContext.dataView;\r\n    //////////////////////////////////////////////////////////////////////////\r\n    var verticesCount = building.verticesCount;\r\n    var facesIndexCount = building.facesIndexCount;\r\n    var verticesStride = 6;\r\n    building.verticesArray = new Float32Array(verticesCount * verticesStride);\r\n    //  qcmsEntry.buildings.noramlArray = new Uint16Array(verticesCount);\r\n    building.textureCoordArray = new Uint16Array(verticesCount * 2);\r\n    building.faceIndices = new Uint32Array(facesIndexCount);\r\n    //////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6Building\u7684Vertices\r\n    var verticesArray = building.verticesArray;\r\n    var textureCoordArray = building.textureCoordArray;\r\n    var faceIndices = building.faceIndices;\r\n\r\n    var widthX = (cmdl.max_x - cmdl.min_x) * ust_zip;\r\n    var widthY = (cmdl.max_y - cmdl.min_y) * ust_zip;\r\n    var widthZ = (cmdl.max_z - cmdl.min_z) * ust_zip;\r\n\r\n    var uvWX = (building.max_u - building.min_u) * ust_zip;\r\n\tvar uvWY = (building.max_v - building.min_v) * ust_zip;\r\n\r\n    var index = 0;\r\n    var ni = 0;\r\n    for (ni = 0; ni < verticesCount; ni++) {\r\n        index += dataView.getInt16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        verticesArray[ni * verticesStride]     = cmdl.min_x + positionArray[index * 3]     * widthX;\r\n        verticesArray[ni * verticesStride + 1] = cmdl.min_y + positionArray[index * 3 + 1] * widthY;\r\n        verticesArray[ni * verticesStride + 2] = cmdl.min_z + positionArray[index * 3 + 2] * widthZ;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6\u6cd5\u7ebf\r\n    if(building.count2 === 0){\r\n        for (ni = 0; ni < verticesCount; ni++) {\r\n            srcNor = dataView.getUint16(parseContext.uint8Cursor, true);\r\n            parseContext.uint8Cursor += 2;\r\n            //0.5, -0.5, 0.70710677\r\n            //verticesArray[ni * verticesStride + 3] = -0.5; //(srcNor >> 10 & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n            //verticesArray[ni * verticesStride + 4] = 0.5; //(srcNor >> 5 & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n            //verticesArray[ni * verticesStride + 5] = -0.70710677; //(srcNor & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n\r\n            verticesArray[ni * verticesStride + 3] = (srcNor >> 10 & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n            verticesArray[ni * verticesStride + 4] = (srcNor >> 5 & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n            verticesArray[ni * verticesStride + 5] = (srcNor & 0x001F) * bt5_zip * 2.0 - 1.0;\r\n        }\r\n    } else if (building.count2 === 1){\r\n        // \u8bfb\u53d6\u6cd5\u7ebf2\r\n        for (ni = 0; ni < verticesCount; ni++) {\r\n            srcNor = dataView.getUint16(parseContext.uint8Cursor, true);\r\n            parseContext.uint8Cursor += 2;\r\n            verticesArray[ni * verticesStride + 3] = (srcNor) * ust_zip * 2.0 - 1.0;\r\n            srcNor = dataView.getUint16(parseContext.uint8Cursor, true);\r\n            parseContext.uint8Cursor += 2;\r\n            verticesArray[ni * verticesStride + 4] = (srcNor) * ust_zip * 2.0 - 1.0;\r\n            srcNor = dataView.getUint16(parseContext.uint8Cursor, true);\r\n            parseContext.uint8Cursor += 2;\r\n            verticesArray[ni * verticesStride + 5] = (srcNor) * ust_zip * 2.0 - 1.0;\r\n\r\n        }\r\n    }\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6\u7eb9\u7406\u5750\u6807\r\n    for (ni = 0; ni < verticesCount; ni++) {\r\n        index = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        textureCoordArray[ni * 2] = index; //building.min_u + index * uvWX ;\r\n        index = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        textureCoordArray[ni * 2 + 1] = index; //building.min_v + index * uvWY;\r\n    }\r\n\r\n\r\n    //////////////////////////////////////////////////////////////////////////\r\n    // \u8bfb\u53d6building\u9762\u7d22\u5f15\r\n    index = 0;\r\n    for (ni = 0; ni < facesIndexCount; ni++) {\r\n        index += dataView.getInt16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        faceIndices[ni] = index;\r\n    }\r\n};\r\n\r\n\r\nIndoorRSMeshParser.parseQCMS = function (parseContext, heightOffset, cmdl) {\r\n    var qcmsEntry = {};\r\n    var dataView = parseContext.dataView;\r\n    var uint8Stream = parseContext.uint8Stream;\r\n    //qcmsEntry.tag = dataView.getUint32(parseContext.uint8Cursor);    parseContext.uint8Cursor += 4;\r\n    qcmsEntry.tag = IndoorRSMeshParser.TAG_QCMS;\r\n    qcmsEntry.headVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    qcmsEntry.bodyVersion = dataView.getInt8(parseContext.uint8Cursor++);\r\n    qcmsEntry.bodyAlignment = dataView.getInt8(parseContext.uint8Cursor++);\r\n    qcmsEntry.numOfChildren = dataView.getInt8(parseContext.uint8Cursor++);\r\n    qcmsEntry.bodyLength = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    IndoorRSMeshParser.skipAlignmentBytes(parseContext);\r\n    \r\n    // parseContext.uint8Cursor = startCursor + qcmsEntry.bodyLength;\r\n    if(qcmsEntry.headVersion === 3 || qcmsEntry.headVersion === 4){\r\n        IndoorRSMeshParser.parseQCMSInstance(parseContext, qcmsEntry, heightOffset, cmdl);\r\n    }else{\r\n        IndoorRSMeshParser.parseQCMSNormal(parseContext, qcmsEntry, heightOffset, cmdl);\r\n    }\r\n\r\n    return qcmsEntry;\r\n};\r\n\r\n\r\nIndoorRSMeshParser.parseQCMSNormal = function(parseContext, qcmsEntry, heightOffset, cmdl){\r\n    var dataView = parseContext.dataView;\r\n    var startCursor = parseContext.uint8Cursor;\r\n    qcmsEntry.materialCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    var allbuildings = new Array(qcmsEntry.materialCount);\r\n\r\n    for (var materialIndex = 0; materialIndex < qcmsEntry.materialCount; materialIndex++) {\r\n        var materialName = IndoorRSMeshParser.parseFixedString(parseContext);\r\n        if (materialName === "shadows") {\r\n            var shadows = IndoorRSMeshParser.parseShadows(parseContext);\r\n            shadows.materialName = materialName;\r\n            allbuildings[materialIndex] = shadows;\r\n        }\r\n        else {\r\n            var building = IndoorRSMeshParser.parseBuildingHead(parseContext);\r\n            building.materialName = materialName;\r\n            allbuildings[materialIndex] = building;\r\n            building.min_y += heightOffset;\r\n            building.max_y += heightOffset;\r\n        }\r\n    }\r\n\r\n    // \u8bfb\u53d6buildingEntry\r\n    for (var materialIndex = 0; materialIndex < qcmsEntry.materialCount; materialIndex++) {\r\n        var building = allbuildings[materialIndex];\r\n        var childCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 4;\r\n        building.entryArray = new Array(childCount);\r\n\r\n        for (var ni = 0; ni < childCount; ni++) {\r\n            building.entryArray[ni] = IndoorRSMeshParser.parseBuildingEntry(parseContext);\r\n        }\r\n    }\r\n\r\n    // Read Position Array\r\n    var positionArrayCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    qcmsEntry.positionArrayCount = positionArrayCount;\r\n    var positionArray = new Uint16Array(positionArrayCount * 3);\r\n    positionArrayCount *= 3;\r\n    for (ni = 0; ni < positionArrayCount; ni++) {\r\n        positionArray[ni] = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n    }\r\n\r\n    for (var materialIndex = 0; materialIndex < qcmsEntry.materialCount; materialIndex++) {\r\n        var building = allbuildings[materialIndex];\r\n        if (building.materialName === "shadows") {\r\n            IndoorRSMeshParser.parseShadowData(building, parseContext, positionArray);\r\n        } else {\r\n            IndoorRSMeshParser.parseBuildingData(building, parseContext, positionArray);\r\n            // IndoorRSMeshParser.parseBuildingDataUnpack(building, parseContext, positionArray, cmdl);\r\n        }\r\n    }\r\n    qcmsEntry.buildings = allbuildings;\r\n\r\n    positionArray = null;\r\n    IndoorRSMeshParser.skipAlignmentBytes(parseContext);\r\n};\r\nIndoorRSMeshParser.parseQCMSInstance = function(parseContext, qcmsEntry, heightOffset, cmdl){\r\n    var dataView = parseContext.dataView;\r\n    qcmsEntry.materialCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    // allbuildings = new Array(qcmsEntry.materialCount);\r\n\r\n    var geometryArray = [];\r\n    var shadowArray = [];\r\n    for (var materialIndex = 0; materialIndex < qcmsEntry.materialCount; materialIndex++) {\r\n        var materialName = IndoorRSMeshParser.parseFixedString(parseContext);\r\n        if (materialName === "shadows") {\r\n            var shadows = IndoorRSMeshParser.parseShadows(parseContext);\r\n            shadows.materialName = materialName;\r\n            shadowArray.push( shadows);\r\n        }\r\n        else {\r\n            var geometry = IndoorRSMeshParser.parseBuildingHead(parseContext);\r\n            geometry.materialName = materialName;\r\n            geometryArray.push(geometry);\r\n            // qcmsEntry.buildings[materialIndex] = building;\r\n            geometry.min_y += heightOffset;\r\n            geometry.max_y += heightOffset;\r\n        }\r\n    }\r\n\r\n    // \u8bfb\u53d6buildingEntry\r\n    for (var i = 0; i < geometryArray.length; i++) {\r\n        var geometry = geometryArray[i];\r\n        var childCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 4;\r\n        geometry.entryArray = new Array(childCount);\r\n\r\n        for (var ni = 0; ni < childCount; ni++) {\r\n            geometry.entryArray[ni] = IndoorRSMeshParser.parseBuildingEntry(parseContext);\r\n        }\r\n    }\r\n\r\n    // Read Position Array\r\n    var positionArrayCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    qcmsEntry.positionArrayCount = positionArrayCount;\r\n    var positionArray = new Uint16Array(positionArrayCount * 3);\r\n    positionArrayCount *= 3;\r\n    for (ni = 0; ni < positionArrayCount; ni++) {\r\n        positionArray[ni] = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n    }\r\n\r\n    \r\n    for (var i = 0; i < geometryArray.length; i++) {\r\n        var geometry = geometryArray[i];\r\n        if (geometry.materialName === "shadows") {\r\n            IndoorRSMeshParser.parseShadowData(geometry, parseContext, positionArray);\r\n        } else {\r\n            IndoorRSMeshParser.parseBuildingDataUnpack(geometry, parseContext, positionArray, cmdl);\r\n        }\r\n    }\r\n\r\n    var instancedGeometryArray = [];\r\n    IndoorRSMeshParser.parseISTCData(parseContext, heightOffset, geometryArray, instancedGeometryArray, cmdl, qcmsEntry.headVersion);\r\n    qcmsEntry.buildings = instancedGeometryArray;\r\n\r\n    positionArray = null;\r\n    IndoorRSMeshParser.skipAlignmentBytes(parseContext);\r\n};\r\n\r\nIndoorRSMeshParser.parseISTCData = function (parseContext, heightOffset, geometryArray, instancedGeometryArray, cmdl, version) {\r\n    var dataView = parseContext.dataView;\r\n    var modelCount = dataView.getInt32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    var elementCount = modelCount * 3;\r\n\r\n    var positionArray = new Array(elementCount);\r\n    var rotationArray = new Array(elementCount);\r\n    var scaleArray = new Array(elementCount);\r\n\r\n    IndoorRSMeshParser.parseISTCPose(parseContext, heightOffset, positionArray, rotationArray, scaleArray, cmdl, version);\r\n\r\n    for(var i = 0; i < geometryArray.length; i++){\r\n        var geometry = geometryArray[i];\r\n        IndoorRSMeshParser.parseISTCGeometry(instancedGeometryArray, geometry, positionArray, rotationArray, scaleArray, cmdl);\r\n    }\r\n};\r\n\r\n\r\n\r\nvar tempPosArray = [];\r\nvar tempRotationArray = [];\r\nvar tempScaleArray = [];\r\nIndoorRSMeshParser.parseISTCGeometrys = function (instancedGeometryArray, geometry, positionArray, rotationArray, scaleArray, cmdl){\r\n    var posCount = positionArray.length / 3;\r\n    var vtxCount = geometry.verticesCount;\r\n    var faceIndexCount = geometry.facesIndexCount;\r\n    // if(geometry.materialName == "texture/xp_027.jpg"){\r\n    //     var xxxxx = 0;\r\n    // }\r\n\r\n    if(vtxCount > 65535){\r\n        console.log("[" + geometry.materialName + "] : more than 65535 vertices!");\r\n        return;\r\n    }\r\n\r\n    if(vtxCount * posCount > 200000){\r\n        console.log("[" + geometry.materialName + "] : has " + vtxCount * posCount + " vertices!");\r\n    }\r\n\r\n    var objectCountPerPatch = parseInt(65535 / vtxCount);\r\n    var currIndex = 0;\r\n    while(currIndex < posCount){\r\n        tempPosArray.length = 0;\r\n        tempRotationArray.length = 0;\r\n        tempScaleArray.length = 0;\r\n        for(var i = 0; i < objectCountPerPatch; i++){\r\n            var index = currIndex * 3\r\n            tempPosArray.push(positionArray[index]);\r\n            tempPosArray.push(positionArray[index + 1]);\r\n            tempPosArray.push(positionArray[index + 2]);\r\n\r\n            tempRotationArray.push(rotationArray[index]);\r\n            tempRotationArray.push(rotationArray[index + 1]);\r\n            tempRotationArray.push(rotationArray[index + 2]);\r\n\r\n            tempScaleArray.push(scaleArray[index]);\r\n            tempScaleArray.push(scaleArray[index + 1]);\r\n            tempScaleArray.push(scaleArray[index + 2]);\r\n            currIndex ++;\r\n            if(currIndex >= posCount){\r\n                break;\r\n            }\r\n        }\r\n\r\n        IndoorRSMeshParser.parseISTCGeometry(instancedGeometryArray, geometry, tempPosArray, tempRotationArray, tempScaleArray, cmdl);\r\n    }\r\n};\r\n\r\nvar transMat = Matrix_create();\r\nvar tempTranslate = [0,0,0];\r\nvar tempScale = [1,1,1];\r\nvar tempRotate = [0,0,0];\r\nvar vertexPosition = [0,0,0];\r\nvar vertexNormal = [0,0,0];\r\nvar minBoundary = [9999999, 9999999, 9999999];\r\nvar maxBoundary = [-9999999, -9999999, -9999999];\r\n\r\nvar uKeyLightDir = [0.5, -0.5, 0.70710677];\r\nvar uBackLightDir = [-0.5, 0.5, -0.70710677];\r\nvar uFillLightDir = [0.0, 0.0, -1.0];\r\nIndoorRSMeshParser.parseISTCGeometry = function (instancedGeometryArray, geometry, positionArray, rotationArray, scaleArray, cmdl) {\r\n    var posCount = positionArray.length / 3;\r\n    var vtxCount = geometry.verticesCount;\r\n    var faceIndexCount = geometry.facesIndexCount;\r\n\r\n    if(vtxCount > 65535){\r\n        console.log("[" + geometry.materialName + "] : is too much vertices!");\r\n    }\r\n\r\n    var instancedGeometry = {};\r\n    if(posCount * vtxCount >65535){\r\n        console.log("[" + geometry.materialName + "] : is too much vertices!");\r\n        // return;\r\n        instancedGeometry.is32BitIndex = true;\r\n    } else{\r\n        instancedGeometry.is32BitIndex = false;\r\n    }\r\n    var vtxSize = posCount * vtxCount * 3;\r\n    var normalSize = posCount * vtxCount * 3;\r\n    var texSize = posCount * vtxCount * 2;\r\n    var newSize = vtxSize + normalSize;\r\n    var dstVtxData = new Float32Array(newSize);\r\n    var dstTexData = new Uint16Array(texSize);\r\n    var dstFaceData = null;\r\n    if(  instancedGeometry.is32BitIndex){\r\n        dstFaceData = new Uint32Array(faceIndexCount*posCount);\r\n    }else{\r\n        dstFaceData = new Uint16Array(faceIndexCount*posCount);\r\n    }\r\n    var dstIndex = 0;\r\n    var dstTexIndex = 0;\r\n    var dstFaceIndex = 0;\r\n\r\n    instancedGeometry.min_x = 9999999;\r\n    instancedGeometry.min_y = 9999999;\r\n    instancedGeometry.min_z = 9999999;\r\n    instancedGeometry.max_x = -9999999;\r\n    instancedGeometry.max_y = -9999999;\r\n    instancedGeometry.max_z = -9999999;\r\n    \r\n\r\n    var currentFaceIndex = 0;\r\n    for(var i = 0; i < posCount; i++){\r\n        var index = i * 3;\r\n        tempTranslate[0] = positionArray[index + 0];\r\n        tempTranslate[1] = positionArray[index + 1];\r\n        tempTranslate[2] = positionArray[index + 2];\r\n        tempRotate [0] = rotationArray[index + 0];\r\n        tempRotate [1] = rotationArray[index + 1];\r\n        tempRotate [2] = rotationArray[index + 2];\r\n        tempScale [0] = scaleArray[index + 0];\r\n        tempScale [1] = scaleArray[index + 1];\r\n        tempScale [2] = scaleArray[index + 2]\r\n        IndoorRSMeshParser.generateMatrix(transMat, tempTranslate, tempRotate, tempScale);\r\n        var srcIndex = 0;\r\n        var srcTexIndex = 0;\r\n        for(var j = 0; j < vtxCount; j++){\r\n            \r\n            vertexPosition[0] = geometry.verticesArray[srcIndex++];\r\n            vertexPosition[1] = geometry.verticesArray[srcIndex++];\r\n            vertexPosition[2] = geometry.verticesArray[srcIndex++];\r\n            vertexNormal[0] = geometry.verticesArray[srcIndex++];\r\n            vertexNormal[1] = geometry.verticesArray[srcIndex++];\r\n            vertexNormal[2] = geometry.verticesArray[srcIndex++];\r\n\r\n            Vector3_transformCoords(vertexPosition, vertexPosition, transMat);\r\n            Vector3_transformNormal(vertexNormal, vertexNormal, transMat);\r\n            Vector3_normalize(vertexNormal, vertexNormal);\r\n            // Position Normal\r\n            dstVtxData[dstIndex++] = vertexPosition[0];\r\n            dstVtxData[dstIndex++] = vertexPosition[1];\r\n            dstVtxData[dstIndex++] = vertexPosition[2];\r\n            if(geometry.count2 === 0){\r\n                dstVtxData[dstIndex++] = vertexNormal[0];\r\n                dstVtxData[dstIndex++] = vertexNormal[1];\r\n                dstVtxData[dstIndex++] = vertexNormal[2];\r\n            }else if(geometry.count2 === 1){\r\n                var lc = Math.max(Vector3_dot(vertexNormal, uKeyLightDir), 0.0);\r\n                var bc = Math.max(Vector3_dot(vertexNormal, uBackLightDir), 0.0);\r\n                var fc = Math.max(Vector3_dot(vertexNormal, uFillLightDir), 0.0);\r\n                dstVtxData[dstIndex++] = lc;\r\n                dstVtxData[dstIndex++] = bc;\r\n                dstVtxData[dstIndex++] = fc;\r\n            }\r\n            \r\n\r\n            instancedGeometry.min_x = Math.min(vertexPosition[0], instancedGeometry.min_x);\r\n            instancedGeometry.min_y = Math.min(vertexPosition[1], instancedGeometry.min_y);\r\n            instancedGeometry.min_z = Math.min(vertexPosition[2], instancedGeometry.min_z);\r\n            instancedGeometry.max_x = Math.max(vertexPosition[0], instancedGeometry.max_x);\r\n            instancedGeometry.max_y = Math.max(vertexPosition[1], instancedGeometry.max_y);\r\n            instancedGeometry.max_z = Math.max(vertexPosition[2], instancedGeometry.max_z);\r\n\r\n            // Texture\r\n            dstTexData[dstTexIndex++] = geometry.textureCoordArray[srcTexIndex++];\r\n            dstTexData[dstTexIndex++] = geometry.textureCoordArray[srcTexIndex++];\r\n        }\r\n        var srcFaceIndex = 0;\r\n        for(var j = 0; j < faceIndexCount; j++){\r\n            dstFaceData[dstFaceIndex++] = geometry.faceIndices[srcFaceIndex++] + currentFaceIndex;\r\n        }\r\n        currentFaceIndex +=  vtxCount;\r\n    }\r\n\r\n\r\n    // Pack Position Normal\r\n    instancedGeometryVertexCount = vtxCount * posCount;\r\n    var dstPackedVtxData = new Uint16Array(instancedGeometryVertexCount * 4);\r\n    var widthX = instancedGeometry.max_x - instancedGeometry.min_x;\r\n    var widthY = instancedGeometry.max_y - instancedGeometry.min_y;\r\n    var widthZ = instancedGeometry.max_z - instancedGeometry.min_z;\r\n    var scaleX = 65535.0 / widthX ;\r\n    var scaleY = 65535.0 / widthY;\r\n    var scaleZ = 65535.0 / widthZ;\r\n    var dstIndex = 0;\r\n    var srcIndex = 0;\r\n    var normal = 0;\r\n    \r\n    for(var  i = 0; i < instancedGeometryVertexCount; i++){\r\n        dstIndex = i *4;\r\n        srcIndex = i *6;\r\n        dstPackedVtxData[dstIndex    ] = parseInt((dstVtxData[srcIndex    ] - instancedGeometry.min_x)* scaleX);\r\n        dstPackedVtxData[dstIndex + 1] = parseInt((dstVtxData[srcIndex + 1] - instancedGeometry.min_y)* scaleY);\r\n        dstPackedVtxData[dstIndex + 2] = parseInt((dstVtxData[srcIndex + 2] - instancedGeometry.min_z)* scaleZ);\r\n        if(geometry.count2 === 0){\r\n            normal = ((parseInt((dstVtxData[srcIndex + 3] + 1.0 ) * 0.5 * 31.0 ) & 0x001F) << 10) |\r\n                    ((parseInt((dstVtxData[srcIndex + 4] + 1.0 ) * 0.5 * 31.0 ) & 0x001F) << 5) | \r\n                    ( parseInt((dstVtxData[srcIndex + 5] + 1.0 ) * 0.5 * 31.0 ) & 0x001F);\r\n            dstPackedVtxData[dstIndex + 3] = normal;\r\n        }else if(geometry.count2 === 1){\r\n            normal = ((parseInt(dstVtxData[srcIndex + 3] * 31.0 ) & 0x001F) << 11) |\r\n                    ((parseInt(dstVtxData[srcIndex + 4] * 31.0 ) & 0x001F) << 6) | \r\n                    ((parseInt(dstVtxData[srcIndex + 5] * 31.0 ) & 0x001F) << 1);\r\n            dstPackedVtxData[dstIndex + 3] = normal;\r\n        }\r\n    }\r\n\r\n    // instancedGeometry.is32BitIndex = true;\r\n    instancedGeometry.min_u = geometry.min_u;\r\n    instancedGeometry.min_v = geometry.min_v;\r\n    instancedGeometry.max_u = geometry.max_u;\r\n    instancedGeometry.max_v = geometry.max_v;\r\n\r\n\r\n    instancedGeometry.materialName = geometry.materialName;\r\n    instancedGeometry.verticesArray = dstPackedVtxData;\r\n    instancedGeometry.textureCoordArray = dstTexData;\r\n    instancedGeometry.faceIndices = dstFaceData;\r\n\r\n    instancedGeometry.vtxCount = vtxCount * posCount;\r\n    instancedGeometry.vtxOffset = 0;\r\n    instancedGeometry.normalOffset = 0;\r\n    instancedGeometry.texOffset = 0;\r\n    instancedGeometry.facesIndexCount = faceIndexCount * posCount;\r\n\r\n    instancedGeometryArray.push(instancedGeometry);\r\n};\r\n\r\nvar ust_zip = 1.0/65535.0;\r\nvar bt5_zip = 1.0/31.0;\r\nvar degreeToRadian = Math.PI / 180;\r\n\r\nIndoorRSMeshParser.parseISTCPose = function (parseContext, heightOffset, positionArray, rotationArray, scaleArray, cmdl, version) {\r\n    var dataView = parseContext.dataView;\r\n    var elementCount = positionArray.length;\r\n    \r\n    // positionArray = new Array(elementCount);\r\n    // rotationArray = new Array(elementCount);\r\n    // scaleArray = new Array(elementCount);\r\n    var widthX = cmdl.max_x - cmdl.min_x;\r\n    var widthY = cmdl.max_y - cmdl.min_y;\r\n    var widthZ = cmdl.max_z - cmdl.min_z;\r\n    for(var i = 0; i < elementCount; i+=3){\r\n        var data = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        positionArray[i] = data * ust_zip * widthX + cmdl.min_x;;\r\n\r\n        var data = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        positionArray[i + 1] = data * ust_zip * widthY + cmdl.min_y;;\r\n\r\n        var data = dataView.getUint16(parseContext.uint8Cursor, true);\r\n        parseContext.uint8Cursor += 2;\r\n        positionArray[i + 2] = data * ust_zip * widthZ + cmdl.min_z;\r\n    }\r\n\r\n    if(version === 4){\r\n        for(var i = 0; i < elementCount; i++){\r\n            var data = dataView.getUint16(parseContext.uint8Cursor, true);\r\n            parseContext.uint8Cursor += 2;\r\n            rotationArray[i] = (data * ust_zip  * 2 - 1) * 180 * degreeToRadian;\r\n        }\r\n\r\n    \r\n        for(var i = 0; i < elementCount; i++){\r\n            var data = dataView.getUint16(parseContext.uint8Cursor, true);\r\n            parseContext.uint8Cursor += 2;\r\n            //scaleArray[i] = data * 100 * ust_zip;\r\n            scaleArray[i] = (data * ust_zip * 2 - 1) * 100;\r\n        }\r\n    }else{\r\n\r\n        for(var i = 0; i < elementCount; i++){\r\n            var data = dataView.getUint16(parseContext.uint8Cursor, true);\r\n            parseContext.uint8Cursor += 2;\r\n            rotationArray[i] = data * degreeToRadian;\r\n        }\r\n\r\n        for(var i = 0; i < elementCount; i++){\r\n            var data = dataView.getUint16(parseContext.uint8Cursor, true);\r\n            parseContext.uint8Cursor += 2;\r\n            scaleArray[i] = data * 100 * ust_zip;\r\n        }\r\n    }\r\n};\r\n\r\nvar tempMatScale = Matrix_create();\r\nvar tempMatRotationZ = Matrix_create();\r\nvar tempMatRotationX = Matrix_create();\r\nvar tempQuaternion = [0,0,0,1];\r\nIndoorRSMeshParser.generateMatrix = function (outMat, translate, ratate, scale) {\r\n    Matrix_scale(tempMatScale, scale[0], scale[1], scale[2]);\r\n    Quaternion_fromEuler(tempQuaternion, ratate[0], ratate[1], ratate[2]);\r\n    Matrix_fromQuaternion(tempMatRotationZ, tempQuaternion);\r\n    Matrix_multiply(outMat, tempMatScale, tempMatRotationZ);\r\n    outMat[12] = translate[0];\r\n    outMat[13] = translate[1];\r\n    outMat[14] = translate[2];\r\n};\r\n\r\nIndoorRSMeshParser.parseBuildingHead = function (parseContext) {\r\n    var buildings = {};\r\n    var dataView = parseContext.dataView;\r\n    //buildings.name = IndoorRSMeshParser.parseFixedString(parseContext);\r\n    buildings.count1 = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.count2 = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.verticesCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.facesIndexCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.min_x = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.min_y = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.min_z = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.max_x = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.max_y = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.max_z = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    //parseContext.uint8Cursor += 16;\r\n    buildings.min_u = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.min_v = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.max_u = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildings.max_v = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    return buildings;\r\n};\r\n\r\nIndoorRSMeshParser.parseBuildingEntry = function (parseContext) {\r\n    var buildingEntry = {};\r\n    var dataView = parseContext.dataView;\r\n    buildingEntry.left = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildingEntry.right = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildingEntry.top = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildingEntry.bottom = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildingEntry.startFace = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildingEntry.endFace = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildingEntry.childCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    buildingEntry.nextLevel = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    return buildingEntry;\r\n};\r\n\r\nIndoorRSMeshParser.parseShadows = function (parseContext) {\r\n    var shadows = {};\r\n    var dataView = parseContext.dataView;\r\n    // shadows.name = IndoorRSMeshParser.parseFixedString(parseContext);\r\n    shadows.count1 = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.count2 = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.verticesCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.facesIndexCount = dataView.getUint32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.min_x = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.min_y = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.min_z = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.max_x = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.max_y = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.max_z = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    shadows.extrusion = dataView.getFloat32(parseContext.uint8Cursor, true);\r\n    parseContext.uint8Cursor += 4;\r\n    return shadows;\r\n};\r\n\r\n\r\n';
b.workerCollision={count:1,url:window.dxMapPath?window.dxMapPath+"sdk/collision.js":"sdk/collision.js"};b.workerCollision.content='onmessage=function(event){var type=event.type;var data=event.data;if(data.type=="collision"){poiOcclusionQuery.collision(data);postMessage(poiOcclusionQuery.retValue)}if(data.type=="click"){var ret=poiOcclusionQuery.getObject(data["clickPoint"]["x"],data["clickPoint"]["y"]);postMessage({"type":"onPoiClick","data":ret})}};var Rect={};Rect.create=function(){return[0,0,0,1]};Rect.make=function(left,top,right,bottom){return[left,top,right,bottom]};Rect.assign=function(retVal,left,top,right,bottom){retVal[0]=left;retVal[1]=top;retVal[2]=right;retVal[3]=bottom};Rect.offset=function(retVal,x,y){retVal[0]+=x;retVal[1]+=y;retVal[2]+=x;retVal[3]+=y};Rect.expand=function(retVal,left,top,right,bottom){retVal[0]-=left;retVal[1]-=top;retVal[2]+=right;retVal[3]+=bottom};Rect.copy=function(retVal,rcIn){retVal[0]=rcIn[0];retVal[1]=rcIn[1];retVal[2]=rcIn[2];retVal[3]=rcIn[3]};Rect.isValid=function(rect1){return rect1[0]<=rect1[2]&&rect1[1]<=rect1[3]};Rect.getWidth=function(rect1){return rect1[2]-rect1[0]};Rect.getHeight=function(rect1){return rect1[3]-rect1[1]};Rect.makeInvalid=function(rect1){rect1[0]=999999999;rect1[1]=999999999;rect1[2]=-999999999;rect1[3]=-999999999};Rect.combine=function(rectOut,rect1,rect2){rectOut[0]=Math.min(rect1[0],rect2[0]);rectOut[1]=Math.min(rect1[1],rect2[1]);rectOut[2]=Math.max(rect1[2],rect2[2]);rectOut[3]=Math.max(rect1[3],rect2[3])};Rect.intersect=function(rect1,rect2){return!(rect1[2]<rect2[0]||rect1[3]<rect2[1]||rect2[2]<rect1[0]||rect2[3]<rect1[1])};Rect.contain=function(rect1,rect2){if(rect1[0]>rect2[0]||rect1[2]<rect2[2]||rect1[1]>rect2[1]||rect1[3]<rect2[3])return false;return true};Rect.containPoint=function(rect1,pt){if(pt[0]<rect1[0]||pt[0]>rect1[2]||pt[1]<rect1[1]||pt[1]>rect1[3])return false;return true};var BUF_SIZE=128;var BUF_BIT_OFFSET=7;var PoiOcclusionQuery=function(){var thisObject=this;thisObject.renderDevice=null;thisObject.buffer=null;thisObject.bufferRect=null;thisObject.indexMap=null;thisObject.aspectWidth=1;thisObject.aspectHeight=1};function compare(a,b){return a.viewDistance-b.viewDistance};PoiOcclusionQuery.prototype.collision=function(renderArgs){this.clear();this.setViewport(renderArgs.view.viewWidth,renderArgs.view.viewHeight);var arraySize=renderArgs.list.length;if(arraySize===0)return;renderArgs.list.sort(compare);var ro=renderArgs.list[0];var maxDistance=ro.viewDistance;var map={};var filterMap={};for(var ii=arraySize-1;ii>=0;ii--){ro=renderArgs.list[ii];var rcWhole=ro.rect;var rank=ro.viewDistance;var testRet=this.isVisible(rcWhole,rank);if(testRet==true){map[ro.id]=ro;if(ro.name==="\u5609\u548c\u4e00\u54c12\u5e97"){}this.updateRect(ro,rcWhole,rank,rcWhole)}else{filterMap[ro.id]=ro}}for(var key in map){var ro=map[key];if(this._lastResultMap.hasOwnProperty(ro.id)){this.retValue.normalResult.push(ro)}else{this.retValue.showResult.push(ro)}}for(var key in filterMap){var ro=filterMap[key];if(this._lastResultMap.hasOwnProperty(ro.id)){if(ro.name==="\u5609\u548c\u4e00\u54c12\u5e97"){console.log("hideResult:"+ro.name)}this.retValue.hideResult.push(ro)}}this._lastResultMap=map};PoiOcclusionQuery.prototype.initialize=function(){var thisObject=this;thisObject.buffer=new Array(BUF_SIZE*BUF_SIZE);thisObject.bufferRect=Rect.make(0,0,BUF_SIZE,BUF_SIZE);thisObject.indexMap={};thisObject._lastResultMap={};thisObject.retValue={type:"collisionResult",hideResult:[],showResult:[],normalResult:[]}};PoiOcclusionQuery.prototype.finalize=function(){};PoiOcclusionQuery.prototype.setViewport=function(cx,cy){var thisObject=this;thisObject.aspectWidth=Math.floor(Math.log(cx>>BUF_BIT_OFFSET)/Math.log(2.0));thisObject.aspectWidth+=1;thisObject.aspectHeight=Math.floor(Math.log(cy>>BUF_BIT_OFFSET)/Math.log(2.0));thisObject.aspectHeight+=1};PoiOcclusionQuery.prototype.clear=function(){var thisObject=this;var totalSize=BUF_SIZE*BUF_SIZE;var m_buffer=thisObject.buffer;for(var i=0;i<totalSize;i++){m_buffer[i]={rank:0,obj:undefined}}thisObject.indexMap={};thisObject.retValue.hideResult.length=0;thisObject.retValue.showResult.length=0;thisObject.retValue.normalResult.length=0};var rcCheck=Rect.create();PoiOcclusionQuery.prototype.isVisible=function(rc,rank){var thisObject=this;var m_buffer=thisObject.buffer;Rect.copy(rcCheck,rc);rcCheck[0]>>=thisObject.aspectWidth;rcCheck[1]>>=thisObject.aspectHeight;rcCheck[2]>>=thisObject.aspectWidth;rcCheck[3]>>=thisObject.aspectHeight;if(!Rect.contain(thisObject.bufferRect,rcCheck))return false;var horizontal_index=rcCheck[0]-thisObject.bufferRect[0];var vertical_index=rcCheck[1]-thisObject.bufferRect[1];var buffer_width=Rect.getWidth(thisObject.bufferRect);var check_width,check_height;check_width=Rect.getWidth(rcCheck);check_height=Rect.getHeight(rcCheck);for(var ni=0;ni<check_height;ni++){var n=horizontal_index+(vertical_index+ni)*buffer_width;for(var nj=0;nj<check_width;nj++){var dot=nj+n;if(rank<m_buffer[dot].rank)return false}}return true};PoiOcclusionQuery.prototype.testRect=function(rc){var thisObject=this;Rect.copy(rcCheck,rc);rcCheck[0]>>=thisObject.aspectWidth;rcCheck[1]>>=thisObject.aspectHeight;rcCheck[2]>>=thisObject.aspectWidth;rcCheck[3]>>=thisObject.aspectHeight;if(!Rect.contain(thisObject.bufferRect,rcCheck)) return false;return true};PoiOcclusionQuery.prototype.updateRect=function(obj,rcTest,rank,rcHot){var thisObject=this;var m_aspect_width=thisObject.aspectWidth;var m_aspect_height=thisObject.aspectHeight;var m_buffer_rect=thisObject.bufferRect;var m_buffer=thisObject.buffer;var rcTest_left=rcTest[0],rcTest_top=rcTest[1],rcTest_right=rcTest[2],rcTest_bottom=rcTest[3];var rcHot_left=rcHot[0],rcHot_top=rcHot[1],rcHot_right=rcHot[2],rcHot_bottom=rcHot[3];var m_buffer_rect_left=m_buffer_rect[0],m_buffer_rect_top=m_buffer_rect[1],m_buffer_rect_right=m_buffer_rect[2],m_buffer_rect_bottom=m_buffer_rect[3];rcTest_left>>=m_aspect_width;rcTest_top>>=m_aspect_height;rcTest_right>>=m_aspect_width;rcTest_bottom>>=m_aspect_height;rcTest_bottom+=1;rcTest_right+=1;rcHot_left>>=m_aspect_width;rcHot_top>>=m_aspect_height;rcHot_right>>=m_aspect_width;rcHot_bottom>>=m_aspect_height;rcHot_bottom+=1;rcHot_right+=1;if(rcTest_left<m_buffer_rect_left)rcTest_left=m_buffer_rect_left;if(rcTest_right>m_buffer_rect_right)rcTest_right=m_buffer_rect_right;if(rcTest_bottom>m_buffer_rect_bottom)rcTest_bottom=m_buffer_rect_bottom;if(rcTest_top<m_buffer_rect_top)rcTest_top=m_buffer_rect_top;if(!(rcTest_left<=rcTest_right&&rcTest_top<=rcTest_bottom))return false;if(rcHot_left<m_buffer_rect_left)rcHot_left=m_buffer_rect_left;if(rcHot_right>m_buffer_rect_right)rcHot_right=m_buffer_rect_right;if(rcHot_bottom>m_buffer_rect_bottom)rcHot_bottom=m_buffer_rect_bottom;if(rcHot_top<m_buffer_rect_top)rcHot_top=m_buffer_rect_top;if(!(rcHot_left<=rcHot_right&&rcHot_top<=rcHot_bottom))return false;var test_x=rcTest_left-m_buffer_rect_left;var test_y=rcTest_top-m_buffer_rect_top;var buffer_width=m_buffer_rect_right-m_buffer_rect_left;var hot_x=rcHot_left-m_buffer_rect_left;var hot_y=rcHot_top-m_buffer_rect_top;var test_width,test_height;test_width=rcTest_right-rcTest_left;test_height=rcTest_bottom-rcTest_top;for(var ni=0;ni<test_height;ni++){for(var nj=0;nj<test_width;nj++){var pos_x=test_x+nj;var pos_y=test_y+ni;var dot=pos_x+pos_y*buffer_width;m_buffer[dot].rank=rank;m_buffer[dot].obj=obj}}return true};PoiOcclusionQuery.prototype.getObject=function(x,y){var thisObject=this;var m_buffer_rect=thisObject.bufferRect;var m_buffer=thisObject.buffer;var m_aspect_width=thisObject.aspectWidth;var m_aspect_height=thisObject.aspectHeight;var horizontal_index,vertical_index;horizontal_index=x>>thisObject.aspectWidth;vertical_index=y>>thisObject.aspectHeight;if(horizontal_index<0||horizontal_index>=BUF_SIZE||vertical_index<0||vertical_index>=BUF_SIZE)return null;var dot=(horizontal_index-m_buffer_rect[0])+(vertical_index-m_buffer_rect[1])*Rect.getWidth(m_buffer_rect);if(m_buffer[dot]&&m_buffer[dot].rank!==0){var itr=m_buffer[dot].obj;if(itr!==undefined){return itr}}return null};var poiOcclusionQuery=new PoiOcclusionQuery();poiOcclusionQuery.initialize();';
b.devicePixelRatio=b.devicePixelRatio="undefined"===typeof _scale?window.devicePixelRatio?window.devicePixelRatio:1:_scale;b.setBasePath=function(a){b.base_relative_path=a+"assets/";b.worker.url=a+"sdk/plugin.rs.js";b.workerCollision.url=a+"sdk/collision.js"};!function(){var a=window.navigator.userAgent;0<a.indexOf("Firefox")?b.RenderFont.fontWidth=b.RenderFont.fontWidth:a.indexOf("WebKit");var d=navigator.userAgent.toLowerCase(),a=/android/i.test(d),d=/iphone/i.test(d);a?(b.phoneType="android",b.fontMarginH=
0,2==b.devicePixelRatio?b.fontMarginH=1:3==b.devicePixelRatio?b.fontMarginH=1:0):(b.phoneType=d?"ios":"web",b.fontMarginH=0)}();return b});
definejs("Renderer/RenderCommand",[],function(){function b(a){for(var c=[],b=0;b<a.length;b++)c.push(a[b]);return c}var a=function(){this.framework=null;this._vertexBufferIDs=[];this._offset=[];this._stride=[];this._indexBufferID=null;this._textureIDs=[];this._renderTechnique=this._shaderProgram=null;this._minVertex=this._baseVertexIndex=this._vertexCount=this._primitiveCount=this._startVertex=this._primitiveType=0;this._matrixUniforms=[];this._vectorUniforms=[];this._floatUniforms=[];this._boolUniforms=
[];this._cubemap=!1;this._frustumUniform=null;this._mustHaveTexture=!0;this.viewDistance=0};a.prototype.initialize=function(a){this.framework=a;this._vertexBufferIDs=Array(2);this._stride=Array(2);this._offset=Array(2);this._textureIDs=Array(2);this._matrixUniforms=Array(3)};a.prototype.finalize=function(){this._boolUniforms=this._floatUniforms=this._vectorUniforms=this._matrixUniforms=this._shaderProgram=this._textureIDs=this._indexBufferID=this._vertexBufferIDs=this.framework=null};a.prototype.shallowClone=
function(){var d=new a;d.framework=this.framework;d._vertexBufferIDs=b(this._vertexBufferIDs);d._offset=b(this._offset);d._stride=b(this._stride);d._indexBufferID=this._indexBufferID;d._textureIDs=b(this._textureIDs);d._shaderProgram=this._shaderProgram;d._renderTechnique=this._renderTechnique;d._primitiveType=this._primitiveType;d._startVertex=this._startVertex;d._primitiveCount=this._primitiveCount;d._vertexCount=this._vertexCount;d._baseVertexIndex=this._baseVertexIndex;d._minVertex=this._minVertex;
d._matrixUniforms=b(this._matrixUniforms);d._vectorUniforms=b(this._vectorUniforms);d._floatUniforms=b(this._floatUniforms);d._boolUniforms=b(this._boolUniforms);d._cubemap=this._cubemap;d._frustumUniform=this._frustumUniform;d._mustHaveTexture=this._mustHaveTexture;d.viewDistance=this.viewDistance;return d};a.prototype.setStreamSource=function(a,c,b,h){this._vertexBufferIDs[a]=c;this._stride[a]=h;this._offset[a]=b};a.prototype.setIndexBuffer=function(a){this._indexBufferID=a};a.prototype.setShaderProgram=
function(a){this._shaderProgram=a};a.prototype.setRenderTechnique=function(a){this._renderTechnique=a};a.prototype.setTexture=function(a,c){this._textureIDs[a]=c};a.prototype.setCubeMap=function(a){this._cubemap=a};a.prototype.setRenderOperation=function(a,c,b,h){this._primitiveType=a;this._startVertex=c;this._vertexCount=b;this._primitiveCount=h};a.prototype.setRenderOperationIndex=function(a,c,b,h,l){this._primitiveType=a;this._baseVertexIndex=c;this._minVertex=b;this._vertexCount=h;this._primitiveCount=
l};a.prototype.render=function(a){if(!1===this._mustHaveTexture){a=this._textureIDs.length;for(var c=0;c<a;c++){var b=this._textureIDs[c];if(void 0!==b&&!b.loaded)return}}this.framework.renderDevice.render(this)};return a});
definejs("Renderer/RenderQueue",[],function(){function b(a,c){return a.viewDistance-c.viewDistance}var a=function(){this.framework=null;this._renderCommands=[]};a.prototype.initialize=function(a){this.framework=a};a.prototype.finalize=function(){this._renderCommands=this.framework=null};a.prototype.render=function(a){!0===this.sortObject&&this._renderCommands.sort(b);for(var c=0;c<this._renderCommands.length;c++)this._renderCommands[c].render(a);this._renderCommands=[];return!0};a.prototype.addRenderObject=
function(a){return this._renderCommands.push(a)};return a});
definejs("Math/Vector3",["Math/Matrix4"],function(b){var a={makeZero:function(a){a[0]=0;a[1]=0;a[2]=0},create:function(){return[0,0,0]},make:function(a,c,b){return[a,c,b]},assign:function(a,c,b,h){a[0]=c;a[1]=b;a[2]=h},copy:function(a){var c=[0,0,0];c[0]=a[0];c[1]=a[1];c[2]=a[2];return c},clone:function(a,c){a[0]=c[0];a[1]=c[1];a[2]=c[2];return a},release:function(){},add:function(a,c,b){a[0]=c[0]+b[0];a[1]=c[1]+b[1];a[2]=c[2]+b[2]},sub:function(a,c,b){a[0]=c[0]-b[0];a[1]=c[1]-b[1];a[2]=c[2]-b[2];
return a},multiply:function(a,c,b){a[0]=c[0]*b[0];a[1]=c[1]*b[1];a[2]=c[2]*b[2]},scale:function(a,c,b){a[0]=c[0]*b;a[1]=c[1]*b;a[2]=c[2]*b;return a},normalize:function(d,c){var b=a.length(c);0<b&&(b=1/b,d[0]=c[0]*b,d[1]=c[1]*b,d[2]=c[2]*b);return d},dot:function(a,c){return a[0]*c[0]+a[1]*c[1]+a[2]*c[2]},cross:function(a,c,b){var h=c[0],l=c[1];c=c[2];var g=b[0],k=b[1];b=b[2];a[0]=l*b-c*k;a[1]=c*g-h*b;a[2]=h*k-l*g;return a},transformCoord:function(a,c,b){var h=c[0],l=c[1];c=c[2];var g=b[1]*h+b[5]*
l+b[9]*c+1*b[13],k=b[2]*h+b[6]*l+b[10]*c+1*b[14];a[0]=b[0]*h+b[4]*l+b[8]*c+1*b[12];a[1]=g;a[2]=k;return a},transformNormal:function(a,c,b){var h=c[0],l=c[1];c=c[2];a[0]=h*b[0]+l*b[4]+c*b[8];a[1]=h*b[1]+l*b[5]+c*b[9];a[2]=h*b[2]+l*b[6]+c*b[10]},length:function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2])},distance:function(a,c){return Math.sqrt((a[0]-c[0])*(a[0]-c[0])+(a[1]-c[1])*(a[1]-c[1])+(a[2]-c[2])*(a[2]-c[2]))},squaredLength:function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]},equalsEpsilon:function(a,
c,b){return a===c||Math.abs(a[0]-c[0])<=b&&Math.abs(a[1]-c[1])<=b&&Math.abs(a[2]-c[2])<=b},negate:function(a,c){a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];return a},abs:function(a,c){a[0]=Math.abs(c[0]);a[1]=Math.abs(c[1]);a[2]=Math.abs(c[2]);return a},mad:function(a,c,b,h){a[0]=c[0]+b[0]*h;a[1]=c[1]+b[1]*h;a[2]=c[2]+b[2]*h},transformCoordEx:function(a,c,b){var h=c[0],l=c[1];c=c[2];var g=1/(b[3]*h+b[7]*l+b[11]*c+b[15]),k=(b[1]*h+b[5]*l+b[9]*c+b[13])*g,n=(b[2]*h+b[6]*l+b[10]*c+b[14])*g;a[0]=(b[0]*h+b[4]*l+b[8]*
c+b[12])*g;a[1]=k;a[2]=n;return a},ZERO:[0,0,0],UNIT_X:[1,0,0],UNIT_Y:[0,1,0],UNIT_Z:[0,0,1]};return a});
definejs("Math/Matrix4",["Math/Vector3"],function(b){return{release:function(){},IDENTITY:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],makeIdentity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1},create:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},makeMatrixStack:function(a){var b=[];b.top=0;return{stack:b,push:function(){var c=this.stack;if(c.top<c.length)return c[c.top++];var b=new a(16);c[c.top]=b;100<++c.top&&console.log("error: matrix stack overflow!");
return b},pop:function(){0>--this.stack.top&&console.log("error: matrix stack underflow")}}},multiply:function(a,b,c){var e=b[0],h=b[1],l=b[2],g=b[3],k=b[4],n=b[5],f=b[6],m=b[7],q=b[8],x=b[9],p=b[10],s=b[11],r=b[12],z=b[13],t=b[14];b=b[15];var w=c[0],u=c[1],v=c[2],A=c[3],F=c[4],M=c[5],C=c[6],J=c[7],O=c[8],E=c[9],H=c[10],P=c[11],B=c[12],I=c[13],y=c[14];c=c[15];a[0]=e*w+h*F+l*O+g*B;a[1]=e*u+h*M+l*E+g*I;a[2]=e*v+h*C+l*H+g*y;a[3]=e*A+h*J+l*P+g*c;a[4]=k*w+n*F+f*O+m*B;a[5]=k*u+n*M+f*E+m*I;a[6]=k*v+n*C+
f*H+m*y;a[7]=k*A+n*J+f*P+m*c;a[8]=q*w+x*F+p*O+s*B;a[9]=q*u+x*M+p*E+s*I;a[10]=q*v+x*C+p*H+s*y;a[11]=q*A+x*J+p*P+s*c;a[12]=r*w+z*F+t*O+b*B;a[13]=r*u+z*M+t*E+b*I;a[14]=r*v+z*C+t*H+b*y;a[15]=r*A+z*J+t*P+b*c},lookatRH:function(a,d,c,e){var h=[0,0,0],l=[0,0,0],g=[0,0,0];b.sub(g,d,c);b.normalize(g,g);b.cross(h,e,g);b.normalize(h,h);b.cross(l,g,h);b.normalize(l,l);a[0]=h[0];a[1]=l[0];a[2]=g[0];a[3]=0;a[4]=h[1];a[5]=l[1];a[6]=g[1];a[7]=0;a[8]=h[2];a[9]=l[2];a[10]=g[2];a[11]=0;a[12]=-b.dot(h,d);a[13]=-b.dot(l,
d);a[14]=-b.dot(g,d);a[15]=1},perspectiveRH:function(a,b,c,e,h){b=1/Math.tan(0.5*b);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(h+e)/(e-h);a[11]=-1;a[12]=0;a[13]=0;a[14]=2*e*h/(e-h);a[15]=0},orthoRH:function(a,b,c,e,h){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2/c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2/(e-h);a[11]=0;a[12]=0;a[13]=0;a[14]=(h+e)/(e-h);a[15]=1},computeOrthographicOffCenter:function(a,b,c,e,h,l,g){var k=1/(b-a),n=1/(e-c),f=1/(l-h);a=-(b+a)*k;c=-(e+c)*n;
h=-(l+h)*f;g[0]=2*k;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*n;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2*f;g[11]=0;g[12]=a;g[13]=c;g[14]=h;g[15]=1;return g},fromTNBP:function(a,b,c,e,h){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=0;a[4]=c[0];a[5]=c[1];a[6]=c[2];a[7]=0;a[8]=e[0];a[9]=e[1];a[10]=e[2];a[11]=0;a[12]=h[0];a[13]=h[1];a[14]=h[2];a[15]=1;return a},translate:function(a,b,c,e){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b;a[13]=c;a[14]=e;a[15]=1},scale:function(a,
b,c,e){a[0]=b;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=e;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1},scaleMatrix:function(a,b,c){var e=c[0],h=c[1];c=c[2];a[0]=b[0]*e;a[1]=b[1]*e;a[2]=b[2]*e;a[3]=b[3]*e;a[4]=b[4]*h;a[5]=b[5]*h;a[6]=b[6]*h;a[7]=b[7]*h;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},rotateAxisX:function(a,b){var c=Math.cos(b),e=Math.sin(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=e;a[7]=0;a[8]=
0;a[9]=-e;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1},rotateAxisY:function(a,b){var c=Math.cos(b),e=Math.sin(b);a[0]=c;a[1]=0;a[2]=-e;a[3]=0;a[4]=0;a[5]=0;a[6]=0;a[7]=0;a[8]=e;a[9]=0;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1},rotateAxisZ:function(a,b){var c=Math.cos(b),e=Math.sin(b);a[0]=c;a[1]=e;a[2]=0;a[3]=0;a[4]=-e;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1},rotateAxis:function(a,b,c,e){},fromQuaternion:function(a,b){var c=b[0],e=b[1],h=b[2],l=
b[3],g=c*c,k=c*e,n=c*h,c=c*l,f=e*e,m=e*h,e=e*l,q=h*h,h=h*l;a[0]=1-2*(f+q);a[1]=2*(k+h);a[2]=2*(n-e);a[4]=2*(k-h);a[5]=1-2*(g+q);a[6]=2*(m+c);a[8]=2*(n+e);a[9]=2*(m-c);a[10]=1-2*(g+f);a[3]=a[7]=a[11]=a[12]=a[13]=a[14]=0;a[15]=1},inverse:function(a,b){var c=b[0],e=b[1],h=b[2],l=b[4],g=b[5],k=b[6],n=b[8],f=b[9],m=b[10],q=b[12],x=b[13],p=b[14];a[0]=c;a[1]=l;a[2]=n;a[3]=0;a[4]=e;a[5]=g;a[6]=f;a[7]=0;a[8]=h;a[9]=k;a[10]=m;a[11]=0;a[12]=-c*q-e*x-h*p;a[13]=-l*q-g*x-k*p;a[14]=-n*q-f*x-m*p;a[15]=1;return a},
transpose:function(a){var b=0,b=a[1];a[1]=a[4];a[4]=b;b=a[2];a[2]=a[8];a[8]=b;b=a[3];a[3]=a[12];a[12]=b;b=a[6];a[6]=a[9];a[9]=b;b=a[7];a[7]=a[13];a[13]=b;b=a[11];a[11]=a[14];a[14]=b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},clone:function(a){return[a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]]},toEulerAnglesZXY:function(a,
b){a[1]=Math.asin(b[6]);if(a[1]<0.5*Math.PI){if(a[1]>0.5*-Math.PI)return a[0]=Math.atan2(-b[4],b[5]),a[2]=Math.atan2(-b[2],b[10]),!0;var c=Math.atan2(b[8],b[0]);a[2]=0;a[0]=a[2]-c;return!1}c=Math.atan2(b[8],b[0]);a[2]=0;a[0]=c-a[2];return!1}}});
definejs("Renderer/TinySDF",[],function(){function b(a,c,b,d,k,n,f){this.fontSize=a||24;this.buffer=void 0===c?3:c;this.cutoff=d||0.25;this.fontFamily=k||"sans-serif";this.fontWeight=n||"normal";this.radius=b||8;a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=a;this.ctx=this.canvas.getContext("2d");this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily;this.ctx.textBaseline="middle";this.ctx.fillStyle="black";
this.gridOuter=new Float64Array(a*a);this.gridInner=new Float64Array(a*a);this.f=new Float64Array(a);this.d=new Float64Array(a);this.z=new Float64Array(a+1);this.v=new Int16Array(a);this.middle=Math.round(a/2*("android"==f?1.2:1))}function a(a,c,b,g,k,n,f){for(var m=0;m<c;m++){for(var q=0;q<b;q++)g[q]=a[q*c+m];d(g,k,n,f,b);for(q=0;q<b;q++)a[q*c+m]=k[q]}for(q=0;q<b;q++){for(m=0;m<c;m++)g[m]=a[q*c+m];d(g,k,n,f,c);for(m=0;m<c;m++)a[q*c+m]=Math.sqrt(k[m])}}function d(a,b,d,g,k){d[0]=0;g[0]=-c;g[1]=+c;
for(var n=1,f=0;n<k;n++){for(var m=(a[n]+n*n-(a[d[f]]+d[f]*d[f]))/(2*n-2*d[f]);m<=g[f];)f--,m=(a[n]+n*n-(a[d[f]]+d[f]*d[f]))/(2*n-2*d[f]);f++;d[f]=n;g[f]=m;g[f+1]=+c}for(f=n=0;n<k;n++){for(;g[f+1]<n;)f++;b[n]=(n-d[f])*(n-d[f])+a[d[f]]}}var c=1E20;b.prototype.draw=function(b){this.ctx.clearRect(0,0,this.size,this.size);this.ctx.fillText(b,this.buffer,this.middle);b=this.ctx.getImageData(0,0,this.size,this.size);for(var d=new Uint8ClampedArray(this.size*this.size),l=0;l<this.size*this.size;l++){var g=
b.data[4*l+3]/255;this.gridOuter[l]=1===g?0:0===g?c:Math.pow(Math.max(0,0.5-g),2);this.gridInner[l]=1===g?c:0===g?0:Math.pow(Math.max(0,g-0.5),2)}a(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z);a(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z);for(l=0;l<this.size*this.size;l++)d[l]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[l]-this.gridInner[l])/this.radius+this.cutoff))));return d};return b});
definejs("Renderer/RenderFont",["Renderer/RenderQueue","Math/Matrix4","Math/Vector3","Framework/ConfigOptions","Renderer/TinySDF"],function(b,a,d,c,e){function h(a,c,b){a=a.createImageData(b,b);b=a.data;for(var f=0;f<c.length;f++)b[4*f+0]=c[f],b[4*f+1]=c[f],b[4*f+2]=c[f],b[4*f+3]=c[f];return a}b=function(){var a=c.RenderFont||{};this.surfaceContext=this.surfaceCanvas=this.renderDevice=this.framework=null;this.charInfos={};this.currentY=this.currentX=0;this.textureHeight=this.textureWidth=512;this.faceName=
a.faceName||"Calibri";this.isBold=a.isBold||!1;this.fontHeight=this.fontWidth=16;this.fontRenderScale=(a.fontWidth||16)/this.fontWidth;this.fontGridWidth=a.fontGridWidth||this.fontWidth+2;this.fontGridHeight=a.fontGridHeight||this.fontHeight+2;this.rcpTextureWidth=1/this.textureWidth;this.rcpTextureHeight=1/this.textureHeight;this.isTextureDirty=!1;this.glyphTexture=null;this.devicePixelScale=1;this.marginV=this.marginH=0;this.outline=!1};b.prototype.initialize=function(a){var b;this.devicePixelScale=
b=c.devicePixelRatio;this.framework=a;this.renderDevice=a.renderDevice;a=this.renderDevice._gl;var d=null;this.textureWidth*=b;this.textureHeight*=b;this.fontWidth*=b;this.fontHeight*=b;this.fontGridHeight*=b;this.currentY*=b;this.marginV*=b;this.marginH*=b;this.textureWidth=parseInt(this.textureWidth);this.textureHeight=parseInt(this.textureHeight);this.fontWidth=parseInt(this.fontWidth);this.fontHeight=parseInt(this.fontHeight);this.fontGridHeight=parseInt(this.fontGridHeight);this.currentY=parseInt(this.currentY);
this.marginV=parseInt(this.marginV);this.marginH=parseInt(this.marginH);this.rcpTextureWidth=1/this.textureWidth;this.rcpTextureHeight=1/this.textureHeight;var f=Math.ceil(1==b?2:3);this.tinySDF=new e(this.fontHeight-2*f,f,1,null,this.faceName,"bold",c.phoneType);try{f="";this.isBold&&(f+="bold ");f+=this.fontWidth+"px "+this.faceName;document.getElementsByTagName("body");var m=document.createElement("canvas");m.width=512*b;m.height=512*b;d=m.getContext("2d");d.fillStyle="#00ffffff";d.textAlign="left";
d.textBaseline="hanging";d.font=f;void 0!==d.imageSmoothingEnabled&&(d.imageSmoothingEnabled=!0);this.surfaceCanvas=m}catch(q){}this.surfaceContext=d;this.glyphTexture=a.createTexture();this.glyphTexture.loaded=!1};b.prototype.finalize=function(){};b.prototype.apply=function(){if(this.isTextureDirty){var a=this.renderDevice._gl;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.bindTexture(a.TEXTURE_2D,this.glyphTexture);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,this.surfaceCanvas);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);this.glyphTexture.loaded=!0;this.isTextureDirty=!1}};b.prototype.renderChar=function(a){var c=this.surfaceContext.measureText(a.char),b=this.tinySDF,f=this.surfaceContext;f.putImageData(h(f,b.draw(a.char),b.size),a.left,a.top);b=this.marginV;a.width=c.width;
a.height=this.fontHeight;a.texcoords_left=(a.left+1.5)*this.rcpTextureWidth;a.texcoords_right=(a.left+a.width+1.5)*this.rcpTextureWidth;a.texcoords_top=(a.top+b)*this.rcpTextureHeight;a.texcoords_bottom=(a.top+a.height+b)*this.rcpTextureHeight;return this.isTextureDirty=!0};var l=function(){this.char="";this.frame=this.height=this.width=this.top=this.left=0};b.prototype.renderCharInFreeSpace=function(a,b){var c=new l;c.char=a;c.left=this.currentX;c.top=this.currentY;if(this.renderChar(c))return c.frame=
b,this.charInfos[a]=c,this.currentX+=c.width,this.textureWidth<this.currentX+c.width&&(this.currentY+=this.fontGridHeight,this.currentX=0),c};b.prototype.getCharInfo=function(a,c,b){b=this.charInfos[a];void 0!==b?b.frame=c:this.currentY+this.fontHeight<=this.textureHeight&&(b=this.renderCharInFreeSpace(a,c));return b};return b});
definejs("Math/Ray",["Math/Vector3"],function(b){var a=function(){this._dir=this._orig=null};a.create=function(){var b=new a;b._orig=[0,0,0];b._dir=[0,0,0];return b};a.make=function(b,c){var e=new a;e._orig=b;e._dir=c;return e};a.transform=function(a,c,e){b.transformCoord(a._orig,c._orig,e);b.transformNormal(a._dir,c._dir,e)};return a});definejs("Math/Sphere",[],function(){return{create:function(){return[0,0,0,1]},make:function(b,a){return[b[0],b[1],b[2],a]}}});
definejs("Math/Ellipsoid",[],function(){var b=function(){};b.Radius=6378137;b.prototype.transfromFromGeographicsToECEF=function(a,b,c,e){};return b});
definejs("Math/AABB",["Math/Vector3"],function(b){var a=function(){this._max=this._min=null};a.create=function(){var b=new a;b._min=[0,0,0];b._max=[0,0,0];return b};a.createInvalid=function(){var b=new a;b._min=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE];b._max=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE];return b};a.make=function(b,c){var e=new a;e._min=b;e._max=c;return e};a.isValid=function(a){return a._max[0]<=a._min[0]&&a._max[1]<=a._min[1]&&a._max[2]<=a._min[2]};a.makeInvalid=
function(a){a._min=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE];a._max=[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE];return a};a.mergePoint=function(a,b,e){a._max[0]=Math.max(b._max[0],e[0]);a._min[0]=Math.min(b._min[0],e[0]);a._max[1]=Math.max(b._max[1],e[1]);a._min[1]=Math.min(b._min[1],e[1]);a._max[2]=Math.max(b._max[2],e[2]);a._min[2]=Math.min(b._min[2],e[2])};a.combine=function(a,b,e){a._max[0]=Math.max(b._max[0],e._max[0]);a._min[0]=Math.min(b._min[0],e._min[0]);a._max[1]=
Math.max(b._max[1],e._max[1]);a._min[1]=Math.min(b._min[1],e._min[1]);a._max[2]=Math.max(b._max[2],e._max[2]);a._min[2]=Math.min(b._min[2],e._min[2])};a.transform=function(a,c,e){b.transformCoord(a._min,c._min,e);b.transformNormal(a._max,c._max,e)};a.getCenter=function(a,b){var e=b._min,h=b._max;a[0]=0.5*(e[0]+h[0]);a[1]=0.5*(e[1]+h[1]);a[2]=0.5*(e[2]+h[2])};a.fromPoints=function(a,b){if(0===b.length)return a;for(var e=b[0],h=e[0],l=e[1],g=e[2],k=e[0],n=e[1],e=e[2],f=b.length,m=1;m<f;m++)var q=b[m],
x=q[0],p=q[1],q=q[2],h=Math.min(x,h),k=Math.max(x,k),l=Math.min(p,l),n=Math.max(p,n),g=Math.min(q,g),e=Math.max(q,e);f=a._min;f[0]=h;f[1]=l;f[2]=g;h=a._max;h[0]=k;h[1]=n;h[2]=e;return a};return a});
definejs("Math/MathUtils","Math/Vector3 Math/Matrix4 Math/Ray Math/Sphere Math/Ellipsoid Math/AABB".split(" "),function(b,a,d,c,e,h){var l={_epsilon:1E-8,_zero_tolerance:1E-14};l.RADIANS_PER_DEGREE=Math.PI/180;l.DEGREE_PER_RADIANS=180/Math.PI;l.TWO_PI=2*Math.PI;l.PI_OVER_TWO=0.5*Math.PI;l.EPSILON2=0.01;l.EPSILON3=0.001;l.EPSILON4=1E-4;l.EPSILON5=1E-5;l.EPSILON6=1E-6;l.EPSILON14=1E-14;l.EPSILON15=1E-15;l.toRadians=function(a){return a*l.RADIANS_PER_DEGREE};l.toDegree=function(a){return a*l.DEGREE_PER_RADIANS};
l.rayCastToEllipsoid=function(a,b){return!0};l.rayCastToEllipsoid=function(a,b){return!0};l.transformGeographicToECEF=function(a,b){var c=b[0],d=b[1],e=b[2],g=e*Math.cos(d);a[0]=g*Math.cos(c);a[1]=g*Math.sin(c);a[2]=e*Math.sin(d)};l.transformECEFToGeographic=function(a,b){var c=b[0],d=b[1],e=b[2],g=Math.sqrt(c*c+d*d+e*e);a[0]=Math.atan2(d,c);a[1]=Math.asin(e/g);a[2]=g};l.matrixECEFToENU=function(c,d){var e=[0,0,0],g=[0,0,0],p=b.copy(d);b.normalize(p,p);b.cross(e,[0,0,1],p);b.normalize(e,e);b.cross(g,
p,e);b.normalize(g,g);a.fromTNBP(c,e,g,p,d);a.inverse(c,c)};l.matrixENUToECEF=function(c,d){var e=[0,0,0],g=[0,0,0],p=b.copy(d);b.normalize(p,p);b.cross(e,[0,0,1],p);b.normalize(e,e);b.cross(g,p,e);b.normalize(g,g);a.fromTNBP(c,e,g,p,d)};l.transformENUToGeographic=function(a,b){return!0};l.transformGeographicToENU=function(a,b){return!0};l.RayIntersectTriangle=function(a,b,c,d){return!0};l.RayIntersectAABB=function(a,b){return!0};l.RayIntersectPlane=function(a,b){return!0};l.RayIntersectSphere=function(a,
c,d){var e=d[3],p=[0,0,0];b.sub(p,c._orig,d);d=b.dot(p,p);var g=d-e*e;if(0>=g)return p=b.dot(p,c._dir),e=Math.sqrt(e*e-(d-p*p)),b.scale(a,c._dir,e-p),b.add(a,c._orig,a),1;e=b.dot(c._dir,p);if(0<=e)return 0;p=e*e-g;if(0>p)return 0;if(p>=l._epsilon)return p=Math.sqrt(p),b.scale(a,c._dir,-e-p),b.add(a,c._orig,a),2;b.scale(a,c._dir,e);b.add(a,c._orig,a);return 1};l.RayIntersectEllipsoid=function(a,b){return!0};l.FrustumIntersectAABB=function(a,b){var c=[0,0,0],d=[0,0,0],e=b._min,g=b._max;c[0]=0.5*(g[0]+
e[0]);c[1]=0.5*(g[1]+e[1]);c[2]=0.5*(g[2]+e[2]);d[0]=0.5*(g[0]-e[0]);d[1]=0.5*(g[1]-e[1]);d[2]=0.5*(g[2]-e[2]);for(var r=g=e=0,r=null,k=0;6>k;k++){r=a._planes[k];g=r[0]*c[0]+r[1]*c[1]+r[2]*c[2]+r[3];r=Math.abs(r[0]*d[0])+Math.abs(r[1]*d[1])+Math.abs(r[2]*d[2]);if(g>r)return 0;g<-r&&e++}return 6===e?1:2};l.UpdateExtentCorner=function(a){a.cornerValue=Array(8);var c=a._north,d=a._south,g=a._east,p=a._west,k=a._minHeight+e.Radius,r=(a._maxHeight+e.Radius)/(k*Math.cos(0.5*(g-p))),h=b.make(p,d,k);l.transformGeographicToECEF(h,
h);a.cornerValue[0]=h;h=b.copy(h);b.scale(h,h,r);a.cornerValue[1]=h;h=b.make(g,d,k);l.transformGeographicToECEF(h,h);a.cornerValue[2]=h;h=b.copy(h);b.scale(h,h,r);a.cornerValue[3]=h;h=b.make(p,c,k);l.transformGeographicToECEF(h,h);a.cornerValue[4]=h;h=b.copy(h);b.scale(h,h,r);a.cornerValue[5]=h;h=b.make(g,c,k);l.transformGeographicToECEF(h,h);a.cornerValue[6]=h;h=b.copy(h);b.scale(h,h,r);a.cornerValue[7]=h};l.FrustumIntersectExtent=function(a,b){for(var c=0;6>c;c++){for(var d=!1,e=0;8>e;e++){var g=
a._planes[c],r=b.cornerValue[e];if(0>=r[0]*g[0]+r[1]*g[1]+r[2]*g[2]+g[3]){d=!0;break}}if(!d)return!1}return!0};l.clamp=function(a,b,c){return a<b?b:a>c?c:a};l.equalsEpsilon=function(a,b,c){return Math.abs(a-b)<=c};l.sign=function(a){return 0<a?1:0>a?-1:0};var g=b.create(),k=b.create(),n=b.create();l.eastNorthUpToFixedFrame=function(a,c){if(l.equalsEpsilon(a[0],0,l.EPSILON14)&&l.equalsEpsilon(a[1],0,l.EPSILON14)){var d=l.sign(a[2]);c[0]=0;c[1]=1;c[2]=0;c[3]=0;c[4]=-d;c[5]=0;c[6]=0;c[7]=0;c[8]=0;c[9]=
0;c[10]=d;c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c}b.normalize(g,a);k[0]=-a[1];k[1]=a[0];k[2]=0;b.normalize(k,k);b.cross(n,g,k);c[0]=k[0];c[1]=k[1];c[2]=k[2];c[3]=0;c[4]=n[0];c[5]=n[1];c[6]=n[2];c[7]=0;c[8]=g[0];c[9]=g[1];c[10]=g[2];c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c};l.getGeodeticCircleRadians=function(a,b,c,d){a=Math.cos(b)*Math.cos(d)*Math.cos(a-c)+Math.sin(b)*Math.sin(d);return Math.abs(Math.acos(a))};l.getGeodeticParallelLength=function(a,b,c){return a*
c*Math.cos(b)};l.ExtentIntersectExtent=function(a,b){return a._north>=b._south&&a._south<=b._north&&a._east>=b._west&&a._west<=b._east};l.isPointInFrustum=function(a,b){for(var c=0;6>c;c++){var d=!1,e=a._planes[c];0>=b[0]*e[0]+b[1]*e[1]+b[2]*e[2]+e[3]&&(d=!0);if(!d)return!1}return!0};return l});
definejs("Math/Vector2",[],function(){var b={makeZero:function(a){a[0]=0;a[1]=0},create:function(){return[0,0]},make:function(a,b){return[a,b]},release:function(){}},a=b.create();b.lengthSquared=function(a){return a[0]*a[0]+a[1]*a[1]};b.length=function(a){return Math.sqrt(b.lengthSquared(a))};b.distance=function(d,c){b.sub(a,d,c);return b.length(a)};b.normalize=function(a,c){var e=b.length(c);a[0]=c[0]/e;a[1]=c[1]/e;return a};b.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]};b.add=function(a,b,e){e[0]=
a[0]+b[0];e[1]=a[1]+b[1];return e};b.sub=function(a,b,e){a[0]=b[0]-e[0];a[1]=b[1]-e[1];return a};b.multiplyByScalar=function(a,b,e){a[0]=b[0]*e;a[1]=b[1]*e;return a};b.divideByScalar=function(a,b,e){a[0]=b[0]/e;a[1]=b[1]/e;return a};b.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];return a};b.abs=function(a,b){a[0]=Math.abs(b[0]);a[1]=Math.abs(b[1]);return a};b.clone=function(a,b){a[0]=b[0];a[1]=b[1];return a};b.equalsEpsilon=function(a,b,e){return a===b||Math.abs(a[0]-b[0])<=e&&Math.abs(a[1]-b[1])<=
e};b.getSignedAngleBetween=function(a,c){var e=[0,0],h=[0,0];b.normalize(e,a);b.normalize(h,c);return Math.atan2(h[1],h[0])-Math.atan2(e[1],e[0])};b.fromElements=function(a,c,e){if(!a)return b.make(c,e);a[0]=c;a[1]=e;return a};return b});
definejs("Math/Rect",[],function(){return{create:function(){return[0,0,0,1]},make:function(b,a,d,c){return[b,a,d,c]},assign:function(b,a,d,c,e){b[0]=a;b[1]=d;b[2]=c;b[3]=e},offset:function(b,a,d){b[0]+=a;b[1]+=d;b[2]+=a;b[3]+=d},expand:function(b,a,d,c,e){b[0]-=a;b[1]-=d;b[2]+=c;b[3]+=e},copy:function(b,a){b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3]},clone:function(b){return[b[0],b[1],b[2],b[3]]},isValid:function(b){return b[0]<=b[2]&&b[1]<=b[3]},getWidth:function(b){return b[2]-b[0]},getHeight:function(b){return b[3]-
b[1]},makeInvalid:function(b){b[0]=999999999;b[1]=999999999;b[2]=-999999999;b[3]=-999999999},combine:function(b,a,d){b[0]=Math.min(a[0],d[0]);b[1]=Math.min(a[1],d[1]);b[2]=Math.max(a[2],d[2]);b[3]=Math.max(a[3],d[3])},intersect:function(b,a){return!(b[2]<a[0]||b[3]<a[1]||a[2]<b[0]||a[3]<b[1])},contain:function(b,a){return b[0]>a[0]||b[2]<a[2]||b[1]>a[1]||b[3]<a[3]?!1:!0},containPoint:function(b,a){return a[0]<b[0]||a[0]>b[2]||a[1]<b[1]||a[1]>b[3]?!1:!0}}});
definejs("Renderer/CanvasMesh2D","Math/Matrix4 Math/Vector3 Math/MathUtils Math/Vector2 Math/Rect Framework/ConfigOptions".split(" "),function(b,a,d,c,e,h){function l(a,b){for(var c=a.length,d=0;d<q.length;++d)a[c+d]=b+q[d]}function g(a,b,c,d,f,m,e,p,q){a.push(d);a.push(f);a.push(m);b.push(p);b.push(q)}function k(a,b,c,d){a.push(c[0]);a.push(c[1]);a.push(c[2]);b.push(d[0]);b.push(d[1])}function n(a,b,c,d,f){b=b[c];a[0]=f[0]+b[0]*h.devicePixelRatio;a[1]=f[1]-b[1]*h.devicePixelRatio;a[2]=f[2]-b[2]*
h.devicePixelRatio}var f=function(){this.vertexNormalData2=this.vertexNormalData=this.indices=this.textureCoords=this.vertexCoords=this.renderCommand=this.texture=this.indexBuffer=this.NormalBuffer2=this.NormalBuffer=this.textureCoordBuffer=this.positionBuffer=this.renderDevice=this.framework=null;this.currentIndex=this.currentVertex=0;this.blendColor=[1,1,1,1];this.lastvertexNormalDataLength2=this.lastvertexNormalDataLength=this.lastIndexBufferLength=this.lastDiffuseBufferLength=this.lastTextureCoordBufferLength=
this.lastPositionBufferLength=0},m=b.create();f.prototype.initialize=function(a){this.framework=a;this.renderDevice=a.renderDevice;a=this.renderDevice._gl;this.vertexCoords=[];this.textureCoords=[];this.diffuseCoords=[];this.indices=[];this.vertexNormalData=[];this.vertexNormalData2=[];this.positionBuffer=a.createBuffer();this.positionBuffer.itemSize=3;this.positionBuffer.type=a.FLOAT;this.positionBuffer.normalized=!1;this.textureCoordBuffer=a.createBuffer();this.textureCoordBuffer.itemSize=2;this.textureCoordBuffer.type=
a.FLOAT;this.textureCoordBuffer.normalized=!1;this.indexBuffer=this.renderDevice.createEmptyIndexBuffer(2);this.texture=null;this.resize();a=this.renderDevice.effectManager.getEffect(0).getTechnique(1);this.renderDevice.createDepthStencilState();var b=this.renderDevice.createRenderCommand();b.setStreamSource(0,this.positionBuffer,0,12);b.setStreamSource(1,this.textureCoordBuffer,0,0);b.setIndexBuffer(this.indexBuffer);b.setRenderTechnique(a);b._matrixUniforms[0]=m;this.renderCommand=b};f.prototype.finalize=
function(){};f.prototype.resize=function(){m[0]=2/this.framework._canvas.width;m[12]=-1;m[5]=-2/this.framework._canvas.height;m[13]=1};f.prototype.beginFrame=function(){this.currentIndex=this.currentVertex=0};f.prototype.endFrame=function(){this.flush();this.clear()};f.prototype.flush=function(a){0!==this.indices.length&&(a=this.renderDevice._gl,a.bindBuffer(a.ARRAY_BUFFER,this.positionBuffer),this.vertexCoords.length>this.lastPositionBufferLength?(a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertexCoords,
0,this.vertexCoords.length),a.DYNAMIC_DRAW),this.lastPositionBufferLength=this.vertexCoords.length):a.bufferSubData(a.ARRAY_BUFFER,0,new Float32Array(this.vertexCoords,0,this.vertexCoords.length)),a.bindBuffer(a.ARRAY_BUFFER,this.textureCoordBuffer),this.textureCoords.length>this.lastTextureCoordBufferLength?(a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.textureCoords,0,this.textureCoords.length),a.DYNAMIC_DRAW),this.lastTextureCoordBufferLength=this.textureCoords.length):a.bufferSubData(a.ARRAY_BUFFER,
0,new Float32Array(this.textureCoords,0,this.textureCoords.length)),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.indices.length>this.lastIndexBufferLength?(a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices,0,this.indices.length),a.DYNAMIC_DRAW),this.lastIndexBufferLength=this.indices.length):a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.indices,0,this.indices.length)),this.renderCommand._vectorUniforms[0]=this.blendColor,this.renderCommand.setTexture(0,
this.texture),this.renderCommand.setRenderOperationIndex(a.TRIANGLES,this.currentIndex,0,this.vertexCoords.length/3,(this.indices.length-this.currentIndex)/3),this.renderDevice.render(this.renderCommand),this.currentIndex=this.currentVertex=0,this.clear())};f.prototype.clear=function(){this.vertexCoords=[];this.textureCoords=[];this.diffuseCoords=[];this.indices=[];this.vertexNormalData=[];this.vertexNormalData2=[]};var q=[0,2,1,2,3,1];f.prototype.setTexture=function(a){this.texture!==a&&(this.flush(),
this.texture=a)};f.prototype.drawChar=function(a,b,c,d,f,m,e){var p=this.vertexCoords,q=this.textureCoords,r=this.diffuseCoords;a=a.getCharInfo(b,0,null);if(void 0!==a){l(this.indices,this.vertexCoords.length/3);b=a.width*e;var k=a.height*e;d-=0.5*(k-a.height);e=c+b;k=d+k;g(p,q,r,c,k,f,m,a.texcoords_left,a.texcoords_bottom);g(p,q,r,c,d,f,m,a.texcoords_left,a.texcoords_top);g(p,q,r,e,k,f,m,a.texcoords_right,a.texcoords_bottom);g(p,q,r,e,d,f,m,a.texcoords_right,a.texcoords_top);return b}return 0};f.prototype.setBlendColor=
function(a){this.blendColor=a};f.prototype.drawText=function(a,b,c,d,f,m){this.setTexture(a.glyphTexture);for(var e=b.length,p=0;p<e;++p){var q=this.drawChar(a,b.charAt(p),c,d,0,f,m);c+=q}return c};f.prototype.calcuTextSize=function(a,b,c,d,f){for(var m=c.length,p=0,q=0;q<m;++q)p+=this.calcuCharSize(b,c.charAt(q),d);a[2]=a[0]+p;a[3]=a[1]+b.fontHeight;"h_center|v_center"==f&&e.offset(a,0.5*-p,0.5*-b.fontHeight)};f.prototype.calcuCharSize=function(a,b,c){a=a.getCharInfo(b,0,null);return void 0!==a?
a.width*c:0};f.prototype.drawTexture=function(a,b,c,d,f,m,e,p){this.setTexture(a);l(this.indices,this.vertexCoords.length/3);a=this.vertexCoords;var q=this.textureCoords,r=this.diffuseCoords,k=0.5*(d+b),h=0.5*(f+c);b=(b-k)*p+k;c=(c-h)*p+h;d=(d-k)*p+k;f=(f-h)*p+h;g(a,q,r,b,f,0,e,m[0],m[3]);g(a,q,r,b,c,0,e,m[0],m[1]);g(a,q,r,d,f,0,e,m[2],m[3]);g(a,q,r,d,c,0,e,m[2],m[1])};f.prototype.drawTextureMultiPart=function(a,b,c,d,f){this.setTexture(a);l(this.indices,this.vertexCoords.length/3);a=this.vertexCoords;
f=this.textureCoords;for(var m=this.diffuseCoords,e=0;e<c.length;e++){var p=c[e],q=b[e];g(a,f,m,q[0],q[3],0,d,p[0],p[3]);g(a,f,m,q[0],q[1],0,d,p[0],p[1]);g(a,f,m,q[2],q[3],0,d,p[2],p[3]);g(a,f,m,q[2],q[1],0,d,p[2],p[1])}};var x=a.create(),p=a.create(),s=a.create(),r=a.create(),z=a.create(),t=a.create(),w=a.create(),u=a.create(),v=a.make(0,0,1),A=a.create(),F=a.create(),M=a.create(),C=a.create(),J=c.make(0,0),O=c.make(0,1),E=c.make(1,0),H=c.make(1,1);f.prototype.drawLine=function(b,c,f,m,e){this.setTexture(b);
b=this.vertexCoords;var q=this.textureCoords,g=this.indices;f*=h.devicePixelRatio;var l=0,D=c.length;if(1!=D){if(2==D)n(x,c,0,m,e),n(p,c,1,m,e),a.sub(u,p,x),a.cross(u,v,u),a.normalize(u,u),a.scale(u,u,f),a.sub(A,x,u),a.add(F,x,u),a.sub(M,p,u),a.add(C,p,u),k(b,q,A,J),k(b,q,F,O),k(b,q,M,E),k(b,q,C,H),g.push(l),g.push(l+1),g.push(l+2),g.push(l+1),g.push(l+3),g.push(l+2);else{for(var Q=0;Q<D-1;Q++)g.push(l),g.push(l+1),g.push(l+2),g.push(l+1),g.push(l+3),g.push(l+2),l+=2;n(x,c,0,m,e);n(p,c,1,m,e);a.sub(u,
p,x);a.cross(u,v,u);a.normalize(u,u);a.scale(u,u,1);a.sub(A,x,u);a.add(F,x,u);k(b,q,A,J);k(b,q,F,O)}for(Q=1;Q<D-1;Q++)n(x,c,Q-1,m,e),n(p,c,Q,m,e),n(s,c,Q+1,m,e),a.sub(z,p,x),a.cross(z,v,z),a.normalize(z,z),a.sub(t,s,p),a.cross(t,v,t),a.normalize(t,t),a.add(r,z,t),a.scale(r,r,0.5),a.normalize(r,r),a.sub(w,x,p),a.normalize(w,w),g=a.dot(w,r),0>g&&(g=-g),Math.acos(g)<25*d.RADIANS_PER_DEGREE||Math.sin(Math.acos(g)),a.scale(r,r,f),a.sub(A,p,r),a.add(F,p,r),k(b,q,A,J),k(b,q,F,O);n(x,c,D-2,m,e);n(p,c,D-1,
m,e);a.sub(r,p,x);a.cross(r,v,r);a.normalize(r,r);a.scale(r,r,f);a.sub(A,p,r);a.add(F,p,r);k(b,q,A,J);k(b,q,F,O)}};return f});
definejs("Renderer/FontRender","Math/Matrix4 Math/Vector3 Math/MathUtils Math/Vector2 Math/Rect Framework/ConfigOptions".split(" "),function(b,a,d,c,e,h){function l(a,b){for(var c=a.length,d=0;d<n.length;++d)a[c+d]=b+n[d]}function g(a,b,c,d,e,g,r,k,h){a.push(d);a.push(e);a.push(g);b.push(k);b.push(h);c.push(r[0]);c.push(r[1]);c.push(r[2]);c.push(r[3])}a=function(){this.vertexNormalData2=this.vertexNormalData=this.indices=this.textureCoords=this.vertexCoords=this.renderCommand=this.texture=this.indexBuffer=
this.diffuseBuffer=this.NormalBuffer2=this.NormalBuffer=this.textureCoordBuffer=this.positionBuffer=this.renderDevice=this.framework=null;this.currentIndex=this.currentVertex=0;this.blendColor=[1,1,1,1];this.fillColor=[0.357,0.357,0.357,1];this.lastvertexNormalDataLength2=this.lastvertexNormalDataLength=this.lastIndexBufferLength=this.lastDiffuseBufferLength=this.lastTextureCoordBufferLength=this.lastPositionBufferLength=0};var k=b.create();a.prototype.initialize=function(a){this.framework=a;this.renderDevice=
a.renderDevice;a=this.renderDevice._gl;this.vertexCoords=[];this.textureCoords=[];this.diffuseCoords=[];this.indices=[];this.vertexNormalData=[];this.vertexNormalData2=[];this.positionBuffer=a.createBuffer();this.positionBuffer.itemSize=3;this.positionBuffer.type=a.FLOAT;this.positionBuffer.normalized=!1;this.textureCoordBuffer=a.createBuffer();this.textureCoordBuffer.itemSize=2;this.textureCoordBuffer.type=a.FLOAT;this.textureCoordBuffer.normalized=!1;this.diffuseBuffer=a.createBuffer();this.diffuseBuffer.itemSize=
4;this.diffuseBuffer.type=a.FLOAT;this.diffuseBuffer.normalized=!1;this.indexBuffer=this.renderDevice.createEmptyIndexBuffer(2);this.texture=null;this.resize();a=this.renderDevice.effectManager.getEffect(0).getTechnique(37);this.renderDevice.createDepthStencilState();var b=this.renderDevice.createRenderCommand();b.setStreamSource(0,this.positionBuffer,0,12);b.setStreamSource(1,this.textureCoordBuffer,0,8);b.setStreamSource(2,this.diffuseBuffer,0,16);b.setIndexBuffer(this.indexBuffer);b.setRenderTechnique(a);
b._matrixUniforms[0]=k;b._boolUniforms[0]=1;this.renderCommand=b;a=this.renderDevice.effectManager.getEffect(0).getTechnique(37);b=this.renderDevice.createRenderCommand();b.setStreamSource(0,this.positionBuffer,0,12);b.setStreamSource(1,this.textureCoordBuffer,0,8);b.setStreamSource(2,this.diffuseBuffer,0,16);b.setIndexBuffer(this.indexBuffer);b.setRenderTechnique(a);b._matrixUniforms[0]=k;b._boolUniforms[0]=0;this.renderCommand2=b};a.prototype.finalize=function(){};a.prototype.resize=function(){k[0]=
2/this.framework._canvas.width;k[12]=-1;k[5]=-2/this.framework._canvas.height;k[13]=1};a.prototype.beginFrame=function(){this.currentIndex=this.currentVertex=0};a.prototype.endFrame=function(){this.flush();this.clear()};a.prototype.flush=function(a){0!==this.indices.length&&(this.texture.loaded&&(a=this.renderDevice._gl,a.bindBuffer(a.ARRAY_BUFFER,this.positionBuffer),this.vertexCoords.length>this.lastPositionBufferLength?(a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.vertexCoords,0,this.vertexCoords.length),
a.DYNAMIC_DRAW),this.lastPositionBufferLength=this.vertexCoords.length):a.bufferSubData(a.ARRAY_BUFFER,0,new Float32Array(this.vertexCoords,0,this.vertexCoords.length)),a.bindBuffer(a.ARRAY_BUFFER,this.diffuseBuffer),this.diffuseCoords.length>this.lastDiffuseBufferLength?(a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.diffuseCoords,0,this.diffuseCoords.length),a.DYNAMIC_DRAW),this.lastDiffuseBufferLength=this.diffuseCoords.length):a.bufferSubData(a.ARRAY_BUFFER,0,new Float32Array(this.diffuseCoords,
0,this.diffuseCoords.length)),a.bindBuffer(a.ARRAY_BUFFER,this.textureCoordBuffer),this.textureCoords.length>this.lastTextureCoordBufferLength?(a.bufferData(a.ARRAY_BUFFER,new Float32Array(this.textureCoords,0,this.textureCoords.length),a.DYNAMIC_DRAW),this.lastTextureCoordBufferLength=this.textureCoords.length):a.bufferSubData(a.ARRAY_BUFFER,0,new Float32Array(this.textureCoords,0,this.textureCoords.length)),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),this.indices.length>this.lastIndexBufferLength?
(a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices,0,this.indices.length),a.DYNAMIC_DRAW),this.lastIndexBufferLength=this.indices.length):a.bufferSubData(a.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.indices,0,this.indices.length)),this.renderCommand._vectorUniforms[0]=this.blendColor,this.renderCommand.setTexture(0,this.texture),this.renderCommand.setRenderOperationIndex(a.TRIANGLES,this.currentIndex,0,this.vertexCoords.length/3,(this.indices.length-this.currentIndex)/3),this.renderDevice.render(this.renderCommand),
this.fillColor[3]=this.blendColor[3],this.renderCommand2._vectorUniforms[0]=this.fillColor,this.renderCommand2.setTexture(0,this.texture),this.renderCommand2.setRenderOperationIndex(a.TRIANGLES,this.currentIndex,0,this.vertexCoords.length/3,(this.indices.length-this.currentIndex)/3),this.renderDevice.render(this.renderCommand2)),this.currentIndex=this.currentVertex=0,this.clear())};a.prototype.clear=function(){this.vertexCoords=[];this.textureCoords=[];this.diffuseCoords=[];this.indices=[];this.vertexNormalData=
[];this.vertexNormalData2=[]};var n=[0,2,1,2,3,1];a.prototype.setTexture=function(a){this.texture!==a&&(this.flush(),this.texture=a)};a.prototype.drawChar=function(a,b,c,d,e,k,r){var h=this.vertexCoords,n=this.textureCoords,w=this.diffuseCoords;null===a&&console.log("xxxx");a=a.getCharInfo(b,0,null);if(void 0!==a){l(this.indices,this.vertexCoords.length/3);b=a.width*r;var u=a.height*r;d-=0.5*(u-a.height);r=c+b;u=d+u;g(h,n,w,c,u,e,k,a.texcoords_left,a.texcoords_bottom);g(h,n,w,c,d,e,k,a.texcoords_left,
a.texcoords_top);g(h,n,w,r,u,e,k,a.texcoords_right,a.texcoords_bottom);g(h,n,w,r,d,e,k,a.texcoords_right,a.texcoords_top);return b}return 0};a.prototype.setBlendColor=function(a){this.blendColor=a};a.prototype.drawText=function(a,b,c,d,e,g){this.setTexture(a.glyphTexture);for(var r=b.length,k=0;k<r;++k){var h=this.drawChar(a,b.charAt(k),c,d,0,e,g);c+=h}return c};a.prototype.calcuTextSize=function(a,b,c,d,e){e=c.length;for(var g=0,k=0;k<e;++k)g+=this.calcuCharSize(b,c.charAt(k),d);a[2]=a[0]+g;a[3]=
a[1]+b.fontHeight*b.fontRenderScale};a.prototype.calcuCharSize=function(a,b,c){null===a&&console.log("xxxx");b=a.getCharInfo(b,0,null);return void 0!==b?b.width*a.fontRenderScale*c:0};a.prototype.drawTexture=function(a,b,c,d,e,k,r,h){this.setTexture(a);l(this.indices,this.vertexCoords.length/3);a=this.vertexCoords;h=this.textureCoords;var n=this.diffuseCoords;g(a,h,n,b,e,0,r,k[0],k[3]);g(a,h,n,b,c,0,r,k[0],k[1]);g(a,h,n,d,e,0,r,k[2],k[3]);g(a,h,n,d,c,0,r,k[2],k[1])};a.prototype.drawTextureMultiPart=
function(a,b,c,d,e){this.setTexture(a);l(this.indices,this.vertexCoords.length/3);a=this.vertexCoords;e=this.textureCoords;for(var k=this.diffuseCoords,r=0;r<c.length;r++){var h=c[r],n=b[r];g(a,e,k,n[0],n[3],0,d,h[0],h[3]);g(a,e,k,n[0],n[1],0,d,h[0],h[1]);g(a,e,k,n[2],n[3],0,d,h[2],h[3]);g(a,e,k,n[2],n[1],0,d,h[2],h[1])}};return a});definejs("Core/defined",[],function(){return function(b){return void 0!==b&&null!==b}});
definejs("Renderer/BlendState",["Renderer/RenderQueue","../Core/defined"],function(b,a){var d=function(a){a=this.glContext=a._gl;this.blendEnable=!1;this.srcBlend=a.SRC_ALPHA;this.destBlend=a.ONE_MINUS_SRC_ALPHA;this.blendOp=a.FUNC_ADD};d.prototype.applyTo=function(b){var d=this.glContext;!b.blendEnable&&this.blendEnable&&d.enable(d.BLEND);if(b.blendEnable&&!this.blendEnable)d.disable(d.BLEND);else return a(this.srcBlendAlpha)&&a(this.destBlendAlpha)?d.blendFuncSeparate(this.srcBlend,this.destBlend,
this.srcBlendAlpha,this.destBlendAlpha):d.blendFunc(this.srcBlend,this.destBlend),!0};d.prototype.apply=function(){var a=this.glContext;this.blendEnable?a.enable(a.BLEND):a.disable(a.BLEND);a.blendFunc(this.srcBlend,this.destBlend);return!0};d.prototype.compare=function(a){return a.blendEnable===this.blendEnable&&a.srcBlend===this.srcBlend&&a.destBlend===this.destBlend&&a.blendOp===this.blendOp?!0:!1};return d});
definejs("Renderer/DepthStencilState",["Renderer/RenderQueue"],function(b){b=function(a){this.glContext=a._gl;this.zEnable=!0;this.zWriteEnable=1};b.prototype.applyTo=function(a){var b=this.glContext;this.zEnable!==a.zEnable&&(this.zEnable?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST));this.zWriteEnable!==a.zWriteEnable&&b.depthMask(this.zWriteEnable)};b.prototype.apply=function(){var a=this.glContext;this.zEnable?a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this.zWriteEnable)};b.prototype.compare=
function(a){return a.zEnable===this.zEnable&&a.zWriteEnable===this.zWriteEnable?!0:!1};return b});
definejs("Renderer/RasterizerState",["Renderer/RenderQueue"],function(b){b=function(a){this.glContext=a._gl;this.cullMode=this.glContext.FRONT};b.prototype.applyTo=function(a){var b=this.glContext;this.cullMode!=a.cullMode&&(a.cullMode===b.NONE?(b.enable(b.CULL_FACE),b.cullFace(this.cullMode)):this.cullMode===b.NONE?b.disable(b.CULL_FACE):b.cullFace(this.cullMode))};b.prototype.apply=function(){var a=this.glContext;this.cullMode===a.NONE?a.disable(a.CULL_FACE):(a.enable(a.CULL_FACE),a.cullFace(this.cullMode))};
b.prototype.compare=function(a){return a.cullMode===this.cullMode?!0:!1};return b});
definejs("Renderer/RenderEffect",[],function(){var b=function(){this.framework=null;this._renderCommands=[];this.shaderCodeDescs={};this.shaderParamters={};this.inputLayouts={};this.techniques=[]};b.prototype.addTechnique=function(a){this.techniques.push(a)};b.prototype.getTechnique=function(a){return this.techniques[a]};b.prototype.addShaderCodeDesc=function(a,b){this.shaderCodeDescs[a]=b};b.prototype.getShaderCodeDesc=function(a){return this.shaderCodeDescs[a]};b.prototype.addShaderParameterDesc=
function(a,b){this.shaderParamters[a]=b};b.prototype.getShaderParameterDesc=function(a){return this.shaderParamters[a]};b.prototype.addInputLayoutDesc=function(a,b){this.inputLayouts[a]=b};b.prototype.getInputLayoutDesc=function(a){return this.inputLayouts[a]};return b});definejs("Renderer/RenderTechnique",[],function(){var b=function(){this.passes=[]};b.prototype.addPass=function(a){this.passes.push(a)};b.prototype.getPass=function(a){return this.passes[a]};return b});
definejs("Framework/shader",[],function(){return{xml:'<Xml>\r\n    <effect name="CommonRender">\r\n        \x3c!--InputLayout--\x3e\r\n        <inputLayout name="FVFXyz">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzDiffuse">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="color" semantic="color" index="0" offset="12"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzTex">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="texcoord" semantic="texcoord" index="0" offset="12"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzTex2">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="texcoord" semantic="texcoord" index="0" offset="12"/>\r\n            <attribute name="texcoord2" semantic="texcoord" index="1" offset="20"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzwTex">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="texcoord" semantic="texcoord" index="0" offset="16"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzwTex2">\r\n            <attribute name="Position" semantic="position" index="0"/>\r\n            <attribute name="UV" semantic="texcoord" index="0" offset="16"/>\r\n            <attribute name="UV2" semantic="texcoord" index="1" offset="24"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzw">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzDiffuseTex">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="color" semantic="color" index="0" offset="12"/>\r\n            <attribute name="texcoord" semantic="texcoord" index="0" offset="16"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzTexDiffuse">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="texcoord" semantic="texcoord" index="0" offset="12"/>\r\n            <attribute name="color" semantic="color" index="0" offset="20"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzNormal">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="normal" semantic="normal" index="0" offset="12"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzNormalTex">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="normal" semantic="normal" index="0" offset="12"/>\r\n            <attribute name="texcoord" semantic="texcoord" index="0" offset="24"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFXyzNormal2Tex">\r\n            <attribute name="position" semantic="position" index="0"/>\r\n            <attribute name="normal" semantic="normal" index="0" offset="12"/>\r\n            <attribute name="normal2" semantic="normal" index="1" offset="24"/>\r\n            <attribute name="texcoord" semantic="texcoord" index="0" offset="36"/>\r\n        </inputLayout>\r\n        <inputLayout name="FVFFontRenderWithBlur">\r\n            <attribute name="a_pos_offset" semantic="position" index="0"/>\r\n            <attribute name="a_data" semantic="normal" index="0" offset="8"/>\r\n            <attribute name="a_halo_color" semantic="normal" index="0" offset="16"/>\r\n            <attribute name="a_projected_pos" semantic="texcoord" index="0" offset="24"/>\r\n            <attribute name="a_fade_opacity" semantic="texcoord" index="0" offset="36"/>\r\n            <attribute name="a_fill_color" semantic="texcoord" index="0" offset="40"/>\r\n            <attribute name="a_halo_width" semantic="texcoord" index="0" offset="48"/>\r\n        </inputLayout>\r\n        \x3c!--Universe Shader--\x3e\r\n        <shaderParameter name="vs_universe">\r\n            <shaderParameter name="vs_model">\r\n                <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n                <parameter name="uPMatrix" type="mat4" count="1"/>\r\n                <parameter name="uFrustum" type="vec4" count="1"/>\r\n            </shaderParameter>\r\n        </shaderParameter>\r\n        <shader name="vs_universe" type="vertex_shader" input="FVFXyz" language="glsl">\r\n            <![CDATA[\r\n                attribute vec3 position;\r\n\r\n                uniform mat4 uMVMatrix;\r\n                uniform mat4 uPMatrix;\r\n                uniform vec4 uFrustum;\r\n\r\n                varying vec3 v_texCoord;\r\n\r\n                void main()\r\n                {\r\n                  gl_Position = uPMatrix * uMVMatrix * vec4(uFrustum.x * position, 1.0);\r\n                  v_texCoord = position.xyz;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_universe">\r\n            <parameter name="uSampler" type="textureCube" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_universe" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform samplerCube uSampler;\r\n        varying vec3 v_texCoord;\r\n\r\n        void main()\r\n        {\r\n            vec3 rgb = normalize(v_texCoord);//vec3 rgb = textureCube(uSampler, normalize(v_texCoord)).rgb;\r\n            gl_FragColor = vec4(rgb, 1.0);\r\n            //gl_FragColor = vec4(1.0,1.0,1.0, 1.0);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--Canvas Shader--\x3e\r\n        <shaderParameter name="vs_canvas">\r\n            <parameter name="uMvpMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_canvas" type="vertex_shader" input="FVFXyzTex" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec2 texcoord;\r\n        //attribute vec4 color;\r\n\r\n        uniform mat4 uMvpMatrix;\r\n\r\n        varying vec2 vTextureCoord;\r\n        //varying vec4 vColor;\r\n\r\n        void main(void) \r\n        {\r\n          gl_Position = uMvpMatrix * vec4(position, 1.0);\r\n          vTextureCoord = texcoord;\r\n          //vColor = color;\r\n        }\r\n       ]]\x3e\r\n        </shader>\r\n\r\n\r\n        <shaderParameter name="ps_canvas">\r\n            <parameter name="vColor" type="vec4" count="1"/>\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_canvas" type="pixel_shader" language="glsl">\r\n             <![CDATA[\r\n                precision mediump float;\r\n                varying vec2 vTextureCoord;\r\n               //varying vec4 vColor;\r\n\r\n                uniform vec4 vColor;\r\n                uniform sampler2D uSampler;\r\n\r\n                void main(void) \r\n                {\r\n                    gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) * vColor;\r\n                }\r\n              ]]\x3e\r\n        </shader>\r\n\r\n     \x3c!--    <shaderParameter name="vs_text_with_blur">\r\n            <parameter name="u_matrix" type="mat4" count="1"/>\r\n            <parameter name="u_label_plane_matrix" type="mat4" count="1"/>\r\n            <parameter name="u_gl_coord_matrix" type="mat4" count="1"/>\r\n\r\n            <parameter name="u_texsize" type="vec2" count="1"/>\r\n\r\n            <parameter name="u_size_t" type="float" count="1"/>\r\n            <parameter name="u_size" type="float" count="1"/>\r\n            <parameter name="u_aspect_ratio" type="float" count="1"/>\r\n            <parameter name="u_camera_to_center_distance" type="float" count="1"/>\r\n\r\n            <parameter name="a_fill_color_t" type="float" count="1"/>\r\n            <parameter name="a_halo_color_t" type="float" count="1"/>\r\n            <parameter name="a_halo_width_t" type="float" count="1"/>\r\n\r\n            <parameter name="u_opacity" type="float" count="1"/>\r\n            <parameter name="u_halo_blur" type="float" count="1"/>\r\n            <parameter name="u_height" type="float" count="1"/>\r\n\r\n            <parameter name="u_fade_change" type="float" count="1"/>\r\n\r\n            <parameter name="u_is_size_zoom_constant" type="bool" count="1"/>\r\n            <parameter name="u_is_size_feature_constant" type="bool" count="1"/>\r\n            <parameter name="u_is_text" type="bool" count="1"/>\r\n            <parameter name="u_pitch_with_map" type="bool" count="1"/>\r\n            <parameter name="u_rotate_symbol" type="bool" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_text_with_blur" type="vertex_shader" input="FVFFontRenderWithBlur" language="glsl">\r\n            <![CDATA[\r\n                #define DEVICE_PIXEL_RATIO 2.0\r\n                #ifdef GL_ES\r\n                precision highp float;\r\n                #else\r\n                 \r\n                #if !defined(lowp)\r\n                #define lowp\r\n                #endif\r\n                 \r\n                #if !defined(mediump)\r\n                #define mediump\r\n                #endif\r\n                 \r\n                #if !defined(highp)\r\n                #define highp\r\n                #endif\r\n                 \r\n                #endif\r\n            \r\n                vec2 unpack_float(const float packedValue) {\r\n                    int packedIntValue = int(packedValue);\r\n                    int v0 = packedIntValue / 256;\r\n                    return vec2(v0, packedIntValue - v0 * 256);\r\n                }\r\n                 \r\n                vec2 unpack_opacity(const float packedOpacity) {\r\n                    int intOpacity = int(packedOpacity) / 2;\r\n                    return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\r\n                }\r\n                 \r\n                vec4 decode_color(const vec2 encodedColor) {\r\n                    return vec4(\r\n                        unpack_float(encodedColor[0]) / 255.0,\r\n                        unpack_float(encodedColor[1]) / 255.0\r\n                    );\r\n                }\r\n                 \r\n                // Unpack a pair of paint values and interpolate between them.\r\n                float unpack_mix_vec2(const vec2 packedValue, const float t) {\r\n                    return mix(packedValue[0], packedValue[1], t);\r\n                }\r\n                 \r\n                // Unpack a pair of paint values and interpolate between them.\r\n                vec4 unpack_mix_vec4(const vec4 packedColors, const float t) {\r\n                    vec4 minColor = decode_color(vec2(packedColors[0], packedColors[1]));\r\n                    vec4 maxColor = decode_color(vec2(packedColors[2], packedColors[3]));\r\n                    return mix(minColor, maxColor, t);\r\n                }\r\n                 \r\n                vec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\r\n                    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\r\n                 \r\n                    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\r\n                    return (tile_units_to_pixels * pos + offset) / pattern_size;\r\n                }\r\n                 \r\n                 \r\n                const float PI = 3.141592653589793;\r\n                 \r\n                attribute vec4 a_pos_offset;\r\n                attribute vec4 a_data;\r\n                attribute vec3 a_projected_pos;\r\n                attribute float a_fade_opacity;\r\n                attribute highp vec4 a_fill_color;\r\n                attribute highp vec4 a_halo_color;\r\n                attribute lowp vec2 a_halo_width;\r\n\r\n\r\n                uniform mat4 u_matrix;  \r\n                uniform mat4 u_label_plane_matrix;\r\n                uniform mat4 u_gl_coord_matrix;\r\n\r\n                uniform vec2 u_texsize;\r\n\r\n                uniform highp float u_size_t; // used to interpolate between zoom stops when size is a composite function\r\n                uniform highp float u_size; // used when size is both zoom and feature constant\r\n                // uniform highp float u_pitch;\r\n                uniform highp float u_aspect_ratio;\r\n                uniform highp float u_camera_to_center_distance;\r\n\r\n                uniform lowp float a_fill_color_t;\r\n                uniform lowp float a_halo_color_t;\r\n                uniform lowp float a_halo_width_t;\r\n\r\n                uniform lowp float u_opacity;\r\n                uniform lowp float u_halo_blur;\r\n                uniform lowp float u_height;\r\n\r\n                uniform float u_fade_change;\r\n\r\n                 \r\n                uniform bool u_is_size_zoom_constant;\r\n                uniform bool u_is_size_feature_constant;\r\n                uniform bool u_is_text;\r\n                uniform bool u_pitch_with_map;\r\n                uniform bool u_rotate_symbol;\r\n\r\n\r\n                varying highp vec4 fill_color;\r\n                varying lowp float halo_width;\r\n                varying highp vec4 halo_color;\r\n                varying vec2 v_data0;\r\n                varying vec3 v_data1;       \r\n                 \r\n\r\n                void main() {\r\n                    fill_color = unpack_mix_vec4(a_fill_color, a_fill_color_t);\r\n                    halo_color = unpack_mix_vec4(a_halo_color, a_halo_color_t);\r\n                    halo_width = unpack_mix_vec2(a_halo_width, a_halo_width_t);\r\n\r\n                    lowp float opacity = u_opacity;\r\n                    lowp float halo_blur = u_halo_blur;\r\n                    lowp float height = u_height;\r\n                  \r\n                    vec2 a_pos = a_pos_offset.xy;\r\n                    vec2 a_offset = a_pos_offset.zw;\r\n                 \r\n                    vec2 a_tex = a_data.xy;\r\n                    vec2 a_size = a_data.zw;\r\n                 \r\n                    highp float segment_angle = -a_projected_pos[2];\r\n                    float size;\r\n                 \r\n                    if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n                        size = mix(a_size[0], a_size[1], u_size_t) / 10.0;\r\n                    } else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {\r\n                        size = a_size[0] / 10.0;\r\n                    } else if (!u_is_size_zoom_constant && u_is_size_feature_constant) {\r\n                        size = u_size;\r\n                    } else {\r\n                        size = u_size;\r\n                    }\r\n                 \r\n                    vec4 projectedPoint = u_matrix * vec4(a_pos, 0, 1);\r\n                    highp float camera_to_anchor_distance = projectedPoint.w;\r\n                    highp float distance_ratio = u_pitch_with_map ?\r\n                        camera_to_anchor_distance / u_camera_to_center_distance :\r\n                        u_camera_to_center_distance / camera_to_anchor_distance;\r\n                    highp float perspective_ratio = 0.5 + 0.5 * distance_ratio;\r\n                 \r\n                    size *= perspective_ratio;\r\n                 \r\n                    float fontScale = u_is_text ? size / 24.0 : size;\r\n                 \r\n                    highp float symbol_rotation = 0.0;\r\n                    if (u_rotate_symbol) {\r\n                        vec4 offsetProjectedPoint = u_matrix * vec4(a_pos + vec2(1, 0), 0, 1);\r\n                 \r\n                        vec2 a = projectedPoint.xy / projectedPoint.w;\r\n                        vec2 b = offsetProjectedPoint.xy / offsetProjectedPoint.w;\r\n                 \r\n                        symbol_rotation = atan((b.y - a.y) / u_aspect_ratio, b.x - a.x);\r\n                    }\r\n                 \r\n                    highp float angle_sin = sin(segment_angle + symbol_rotation);\r\n                    highp float angle_cos = cos(segment_angle + symbol_rotation);\r\n                    mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\r\n                 \r\n                    vec4 projected_pos = u_label_plane_matrix * vec4(a_projected_pos.xy, height, 1.0);\r\n                    //gl_Position = u_gl_coord_matrix * vec4(projected_pos.xy / projected_pos.w + rotation_matrix * (a_offset / 64.0 * fontScale), 0.0, 1.0);\r\n                    gl_Position = u_gl_coord_matrix * vec4(a_pos_offset.xy, 1.0, 1.0);\r\n                    float gamma_scale = gl_Position.w;\r\n                 \r\n                    vec2 tex = a_tex / u_texsize;\r\n                    vec2 fade_opacity = unpack_opacity(a_fade_opacity);\r\n                    float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\r\n                    float interpolated_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\r\n                 \r\n                    v_data0 = vec2(tex.x, tex.y);\r\n                    v_data1 = vec3(gamma_scale, size, interpolated_fade_opacity);\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_text_with_blur">\r\n            <parameter name="u_is_halo" type="bool" count="1"/>\r\n            <parameter name="u_gamma_scale" type="float" count="1"/>\r\n            <parameter name="u_texture" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_text_with_blur" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                #define DEVICE_PIXEL_RATIO 2.0\r\n                #ifdef GL_ES\r\n                precision mediump float;\r\n                #else\r\n                 \r\n                #if !defined(lowp)\r\n                #define lowp\r\n                #endif\r\n                 \r\n                #if !defined(mediump)\r\n                #define mediump\r\n                #endif\r\n                 \r\n                #if !defined(highp)\r\n                #define highp\r\n                #endif\r\n                 \r\n                #endif\r\n                 \r\n                #define SDF_PX 8.0\r\n                #define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\r\n                 \r\n\r\n                varying highp vec4 fill_color;\r\n                varying highp vec4 halo_color;\r\n                varying lowp float halo_width;\r\n                varying vec2 v_data0;\r\n                varying vec3 v_data1;\r\n\r\n                uniform lowp float u_opacity;\r\n                uniform lowp float u_halo_blur;\r\n                uniform lowp float u_height;\r\n\r\n                uniform highp float u_gamma_scale;\r\n\r\n                uniform bool u_is_text;\r\n                uniform bool u_is_halo;\r\n\r\n                uniform sampler2D u_texture;\r\n\r\n                void main() {\r\n                     \r\n                    lowp float opacity = u_opacity;\r\n                    lowp float halo_blur = u_halo_blur;\r\n                    lowp float height = u_height;\r\n\r\n                    vec2 tex = v_data0.xy;\r\n                    float gamma_scale = v_data1.x;\r\n                    float size = v_data1.y;\r\n                    float fade_opacity = v_data1[2];\r\n                 \r\n                    float fontScale = u_is_text ? size / 24.0 : size;\r\n                 \r\n                    lowp vec4 color = fill_color;\r\n                    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\r\n                    lowp float buff = (256.0 - 64.0) / 256.0;\r\n                    if (u_is_halo) {\r\n                        color = halo_color;\r\n                        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\r\n                        buff = (6.0 - halo_width / fontScale) / SDF_PX;\r\n                    }\r\n                 \r\n                    lowp float dist = texture2D(u_texture, tex).a;\r\n                    highp float gamma_scaled = gamma * gamma_scale;\r\n                    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\r\n                 \r\n                    gl_FragColor = color * (alpha * opacity * fade_opacity) + vec4(1,1,1,1);\r\n                     gl_FragColor = vec4(1,1,1,1);\r\n                }\r\n            ]]\x3e\r\n        </shader> --\x3e\r\n\r\n\r\n\r\n\r\n        \x3c!--Compass Shader--\x3e\r\n        <shaderParameter name="vs_compass">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="uLineWidth" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_compass" type="vertex_shader" input="FVFXyzNormal2Tex" language="glsl">\r\n            <![CDATA[\r\n                attribute vec3 position;\r\n                attribute vec3 normal;\r\n                attribute vec3 normal2;\r\n                attribute vec2 texcoord;\r\n\r\n                uniform mat4 uMVMatrix;\r\n                uniform mat4 uPMatrix;\r\n                uniform vec4 uLineWidth;\r\n\r\n                varying vec4 vTextureCoord;\r\n\r\n                void main()\r\n                {\r\n                  if ( texcoord.s < 0.0) {\r\n                      vTextureCoord.t = 1.0;\r\n                  } else {\r\n                      vTextureCoord.t = 0.0;\r\n                  }\r\n\r\n                  vTextureCoord.s = texcoord.t;\r\n\r\n                  vec3 pos = position + normal * texcoord.s * uLineWidth.x;\r\n                  gl_Position = uPMatrix * uMVMatrix * vec4(pos, 1.0);\r\n                  vTextureCoord.p =uLineWidth.z;\r\n                  vTextureCoord.q =uLineWidth.w;\r\n                }\r\n           ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_compass">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_compass" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                varying vec4 vTextureCoord;\r\n\r\n                uniform sampler2D uSampler;\r\n                uniform vec4 uBlendColor;\r\n\r\n                void main(void)\r\n                {\r\n                    if(vTextureCoord.s < vTextureCoord.p || vTextureCoord.s > vTextureCoord.q)\r\n                    {\r\n                            discard;\r\n                    }\r\n                  gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) * uBlendColor;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="vs_text_with_blur">\r\n            <parameter name="uMvpMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_text_with_blur" type="vertex_shader" input="FVFXyzTexDiffuse" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec2 texcoord;\r\n        attribute vec4 color;\r\n\r\n        uniform mat4 uMvpMatrix;\r\n\r\n        //varying vec2 vTextureCoord;\r\n        //varying vec4 vColor;\r\n\r\n        vec2 unpack_opacity(const float packedOpacity) {\r\n            int intOpacity = int(packedOpacity) / 2;\r\n            return vec2(float(intOpacity) / 127.0, mod(packedOpacity, 2.0));\r\n        }\r\n        varying vec2 v_data0;\r\n        varying vec3 v_data1;\r\n        void main(void) \r\n        {\r\n            gl_Position = uMvpMatrix * vec4(position, 1.0);\r\n            //vTextureCoord = texcoord;\r\n\r\n            float a_fade_opacity = 129.0;\r\n            float u_fade_change = 1.167;\r\n            vec2 fade_opacity = unpack_opacity(a_fade_opacity);\r\n\r\n            float gamma_scale = 1.0;\r\n            float size = 13.0;\r\n            float fade_change = fade_opacity[1] > 0.5 ? u_fade_change : -u_fade_change;\r\n            float interpolated_fade_opacity = max(0.0, min(1.0, fade_opacity[0] + fade_change));\r\n                 \r\n            v_data0 = texcoord;//vec2(tex.x, tex.y);\r\n            v_data1 = vec3(color.w, size, interpolated_fade_opacity);\r\n\r\n\r\n\r\n          //vColor = color;\r\n        }\r\n       ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_text_with_blur">\r\n            <parameter name="vColor" type="vec4" count="1"/>\r\n             <parameter name="u_is_halo" type="bool" count="1"/>\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_text_with_blur" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                //varying vec2 vTextureCoord;\r\n               //varying vec4 vColor;\r\n\r\n                uniform vec4 vColor;\r\n                uniform bool u_is_halo;\r\n                uniform sampler2D uSampler;\r\n\r\n                varying vec2 v_data0;\r\n                varying vec3 v_data1;\r\n\r\n                #ifdef GL_ES\r\n                precision highp float;\r\n                #else\r\n                 \r\n                #if !defined(lowp)\r\n                #define lowp\r\n                #endif\r\n                 \r\n                #if !defined(mediump)\r\n                #define mediump\r\n                #endif\r\n                 \r\n                #if !defined(highp)\r\n                #define highp\r\n                #endif\r\n                 \r\n                #endif\r\n                #define DEVICE_PIXEL_RATIO 2.0\r\n                #define SDF_PX 8.0\r\n                #define EDGE_GAMMA 0.105/DEVICE_PIXEL_RATIO\r\n\r\n                void main(void) \r\n                {\r\n                    float size = v_data1.y;\r\n                    float fontScale = size / 24.0;\r\n                    \r\n                    float u_gamma_scale = 1.0;\r\n                    lowp float opacity = v_data1.x;//1.0;\r\n                    lowp float halo_blur = 0.0;\r\n                    lowp float height = 16.0;\r\n\r\n                    vec2 tex = v_data0;\r\n\r\n                    float halo_width = 1.3;//29912.0/65535.0;\r\n\r\n                    vec4 halo_color = vec4(1.0,1.0,1.0,1.0);\r\n                    //vec4 halo_blur  = vec4(1.0,1.0,1.0,1.0); \r\n\r\n                    highp float gamma = EDGE_GAMMA / (fontScale * u_gamma_scale);\r\n                    lowp float buff = (256.0 - 64.0) / 256.0;\r\n\r\n                    float gamma_scale = v_data1.x;\r\n\r\n                    float fade_opacity = v_data1[2];\r\n\r\n\r\n                    //float gamma_scale = 0.01;\r\n\r\n                    lowp vec4 color = vColor;;\r\n                    if (u_is_halo) {\r\n                        color = halo_color;\r\n                        gamma = (halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_gamma_scale);\r\n                        buff = (6.0 - halo_width / fontScale) / SDF_PX;\r\n                    }\r\n                 \r\n                    lowp float dist = texture2D(uSampler, tex).a;\r\n                    highp float gamma_scaled = gamma * gamma_scale;\r\n                    highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\r\n\r\n                 \r\n                    gl_FragColor = color;\r\n                    gl_FragColor.a = color.a * (alpha * opacity * fade_opacity);\r\n                    //gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) * vColor;\r\n                }\r\n              ]]\x3e\r\n        </shader>\r\n\r\n\r\n\r\n\r\n        \r\n\r\n\r\n\r\n\r\n\r\n        \x3c!--SkyFromAtmosphere Shader--\x3e\r\n        <shaderParameter name="vs_sky_atmosphere">\r\n            <parameter name="g_WorldViewProj" type="mat4" count="1"/>\r\n            <parameter name="g_v3CameraPos" type="vec4" count="1"/>\r\n            <parameter name="g_v3LightPos" type="vec4" count="1"/>\r\n            <parameter name="g_cameraHeight" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_sky_atmosphere" type="vertex_shader" input="FVFXyz" language="glsl">\r\n            <![CDATA[\r\n                uniform mat4 g_WorldViewProj;\r\n                uniform vec4 g_v3CameraPos;\r\n                uniform vec4 g_v3LightPos;\r\n                uniform vec4 g_cameraHeight;\r\n\r\n                #define red_wave 5.6020447\r\n                #define green_wave 9.4732844\r\n                #define blue_wave 19.6438026\r\n                #define fInnerRadius 6378137.0\r\n                #define fOuterRadius (fInnerRadius * 1.01)\r\n                #define fOuterRadius2 (fOuterRadius * fOuterRadius)\r\n                #define ESun 20.0\r\n                #define Kr 0.0025\r\n                #define Km 0.0015\r\n                #define fKrESun (Kr*ESun)\r\n                #define fKmESun (Km*ESun)\r\n                #define fKr4PI 0.03141593\r\n                #define fKm4PI 0.0188495573\r\n                #define fScale (1.0/(fOuterRadius - fInnerRadius))\r\n                #define fScaleDepth 0.25\r\n                #define fScaleOverScaleDepth (fScale/fScaleDepth)\r\n                #define nSamples 2\r\n                #define fSamples 2.0\r\n\r\n                attribute vec3 position;\r\n                //attribute vec2 texcoord;\r\n\r\n                //varying vec2 outTexcoord;\r\n                varying vec3 direction;\r\n                varying vec3 outColor;\r\n                varying vec3 secondaryColor;\r\n\r\n                float scale(float fCos)\r\n                {\r\n                  float x = 1.0 - fCos;\r\n                  return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n                }\r\n\r\n                void main()\r\n                {\r\n                  vec3 v3Pos = position.xyz;\r\n                  vec3 cameraPos = g_v3CameraPos.xyz;\r\n                  vec3 light = g_v3LightPos.xyz;\r\n\r\n                  // Get the ray from the camera to the vertex, and its length (which is the far point of the ray passing through the atmosphere)\r\n                  vec3 v3Ray = v3Pos - cameraPos;\r\n                  float fFar = length(v3Ray);\r\n                  v3Ray /= fFar;\r\n\r\n                  // Calculate the ray\'s starting position, then calculate its scattering offset\r\n                  vec3 v3Start = cameraPos;\r\n                  float fHeight = length(v3Start);\r\n                  float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - g_cameraHeight.x));\r\n                  float fStartAngle = dot(v3Ray, v3Start) / fHeight;\r\n                  float fStartOffset = fDepth*scale(fStartAngle);\r\n\r\n                  // Initialize the scattering loop variables\r\n                  //gl_FrontColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n                  float fSampleLength = fFar / fSamples;\r\n                  float fScaledLength = fSampleLength * fScale;\r\n                  vec3 v3SampleRay = v3Ray * fSampleLength;\r\n                  vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\r\n\r\n                  // Now loop through the sample rays\r\n                  vec3 v3InvWavelength = vec3(red_wave, green_wave, blue_wave);\r\n                  vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\r\n                  for(int i=0; i<nSamples; i++)\r\n                  {\r\n                    float fHeight = length(v3SamplePoint);\r\n                    float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\r\n                    float fLightAngle = dot(light, v3SamplePoint) / fHeight;\r\n                    float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\r\n                    float fScatter = (fStartOffset + fDepth*(scale(fLightAngle) - scale(fCameraAngle)));\r\n                    vec3 v3Attenuate = vec3(exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI)));\r\n                    v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\r\n                    v3SamplePoint += v3SampleRay;\r\n                  }\r\n\r\n                  // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\r\n                  gl_Position = g_WorldViewProj * vec4(position, 1.0);\r\n                  //outTexcoord = vec2(texcoord.x,1.0-texcoord.y);\r\n                  gl_Position.z = gl_Position.w * 0.999995;\r\n                  direction = cameraPos - v3Pos;\r\n                  secondaryColor = v3FrontColor * fKmESun;\r\n                  outColor = v3FrontColor * (v3InvWavelength * fKrESun);\r\n                }\r\n              ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_sky_atmosphere">\r\n            <parameter name="g_v3LightPosP" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_sky_atmosphere" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n\r\n        #define g (-0.95)\r\n        #define g2 (g*g)\r\n\r\n        uniform vec4 g_v3LightPosP;\r\n        //uniform sampler2D diffuseSampler;\r\n\r\n        //varying vec2 outTexcoord;\r\n        varying vec3 direction;\r\n        varying vec3 outColor;\r\n        varying vec3 secondaryColor;\r\n\r\n        void main()\r\n        {\r\n          vec3 light = g_v3LightPosP.xyz;\r\n          float fCos = dot(light, direction) / length(direction);\r\n          float fRayleighPhase = 0.75 * (1.0 + fCos*fCos);\r\n          float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos*fCos) / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n          vec3 f = fRayleighPhase * outColor + fMiePhase * secondaryColor;\r\n          vec4 color = vec4(f.x, f.y, f.z, 1.0);\r\n          //vec4 color = vec4(1.0, 1.0, 1.0, 1.0);\r\n          float lum = color.x*0.299 + color.y * 0.587+ color.z*0.114;\r\n          //gl_FragColor = color * mix(vec4(1.0,1.0,1.0,1.0), texture2D(diffuseSampler, outTexcoord), g_v3LightPosP.w);\r\n          gl_FragColor = color;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--SkyFromSpace Shader--\x3e\r\n        <shaderParameter name="vs_sky_space">\r\n            <parameter name="g_WorldViewProj" type="mat4" count="1"/>\r\n            <parameter name="g_v3CameraPos" type="vec4" count="1"/>\r\n            <parameter name="g_v3LightPos" type="vec4" count="1"/>\r\n            <parameter name="g_cameraHeight2" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_sky_space" type="vertex_shader" input="FVFXyz" language="glsl">\r\n            <![CDATA[\r\n        uniform mat4 g_WorldViewProj;\r\n        uniform vec4 g_v3CameraPos;\r\n        uniform vec4 g_v3LightPos;\r\n        uniform vec4 g_cameraHeight2;\r\n\r\n        #define red_wave 5.6020447\r\n        #define green_wave 9.4732844\r\n        #define blue_wave 19.6438026\r\n        #define fInnerRadius 6378137.0\r\n        #define fOuterRadius (fInnerRadius * 1.01)\r\n        #define fOuterRadius2 (fOuterRadius * fOuterRadius)\r\n        #define ESun 20.0\r\n        #define Kr 0.0025\r\n        #define Km 0.0015\r\n        #define fKrESun (Kr*ESun)\r\n        #define fKmESun (Km*ESun)\r\n        #define fKr4PI 0.03141593\r\n        #define fKm4PI 0.0188495573\r\n        #define fScale (1.0/(fOuterRadius - fInnerRadius))\r\n        #define fScaleDepth 0.25\r\n        #define fScaleOverScaleDepth (fScale/fScaleDepth)\r\n        #define nSamples 2\r\n        #define fSamples 2.0\r\n\r\n        attribute vec3 position;\r\n        //attribute vec2 texture;\r\n\r\n        varying vec3 direction;\r\n        varying vec3 outColor;\r\n        varying vec3 secondaryColor;\r\n\r\n\r\n        float scale(float fCos)\r\n        {\r\n            float x = 1.0 - fCos;\r\n            return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n        }\r\n\r\n        void main()\r\n        {\r\n            vec3 v3Pos = position.xyz;\r\n            vec3 cameraPos = g_v3CameraPos.xyz;\r\n            vec3 light = g_v3LightPos.xyz;\r\n\r\n            vec3 v3Ray = v3Pos - cameraPos;\r\n            float fFar = length(v3Ray);\r\n            v3Ray /= fFar;\r\n\r\n            float B = 2.0 * dot(cameraPos, v3Ray);\r\n            float C = g_cameraHeight2.x - fOuterRadius2;\r\n            float fDet = max(0.0, B*B - 4.0 * C);\r\n            float fNear = 0.5 * (-B - sqrt(fDet));\r\n\r\n            // Calculate the ray\'s starting position, then calculate its scattering offset\r\n            vec3 v3Start = cameraPos + v3Ray * fNear;\r\n            fFar -= fNear;\r\n            float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\r\n            float fStartDepth = exp(-1.0 / fScaleDepth);\r\n            float fStartOffset = fStartDepth*scale(fStartAngle);\r\n\r\n            // Initialize the scattering loop variables\r\n            //gl_FrontColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n            float fSampleLength = fFar / fSamples;\r\n            float fScaledLength = fSampleLength * fScale;\r\n            vec3 v3SampleRay = v3Ray * fSampleLength;\r\n            vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\r\n\r\n            // Now loop through the sample rays\r\n            vec3 v3InvWavelength = vec3(red_wave, green_wave, blue_wave);\r\n            vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\r\n            for(int i=0; i<nSamples; i++)\r\n            {\r\n                float fHeight = length(v3SamplePoint);\r\n                float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\r\n                float fLightAngle = dot(light, v3SamplePoint) / fHeight;\r\n                float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\r\n                float fScatter = (fStartOffset + fDepth*(scale(fLightAngle) - scale(fCameraAngle)));\r\n                vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\r\n                v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\r\n                v3SamplePoint += v3SampleRay;\r\n            }\r\n\r\n            // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\r\n            gl_Position = g_WorldViewProj * vec4(position, 1.0);\r\n            //gl_Position.z = gl_Position.w;\r\n            direction = cameraPos - v3Pos;\r\n            secondaryColor = v3FrontColor * fKmESun;\r\n            outColor = v3FrontColor * (v3InvWavelength * fKrESun);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_sky_space">\r\n            <parameter name="g_v3LightPosP" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_sky_space" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 g_v3LightPosP;\r\n\r\n        #define g (-0.95)\r\n        #define g2 (g*g)\r\n\r\n        varying vec3 direction;\r\n        varying vec3 outColor;\r\n        varying vec3 secondaryColor;\r\n\r\n        void main()\r\n        {\r\n          vec3 light = g_v3LightPosP.xyz;\r\n          float fCos = dot(light, direction) / length(direction);\r\n          float fRayleighPhase = 0.75 * (1.0 + fCos*fCos);\r\n          float fMiePhase = 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos*fCos) / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n          vec3 f = fRayleighPhase * outColor + fMiePhase * secondaryColor;\r\n          vec4 color = vec4(f.x, f.y, f.z, 1.0);\r\n          //vec4 color = vec4(1.0, 1.0, 1.0, 1.0);\r\n          float lum = color.x*0.299 + color.y * 0.587+ color.z*0.114;\r\n          gl_FragColor = color;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n\r\n        \x3c!--Terrain Shader--\x3e\r\n        <shaderParameter name="vs_terrain">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            \x3c!--<parameter name="uTexMatrix" type="mat4" count="1"/>--\x3e\r\n            <parameter name="uGlobePos" type="vec4" count="1"/>\r\n            <parameter name="uAtmosphere" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_terrain" type="vertex_shader" input="FVFXyzTex" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec2 texcoord;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n      //  uniform mat4 uTexMatrix;\r\n        uniform vec4 uGlobePos;\r\n        uniform vec4 uAtmosphere;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n        varying float vAtmosphere;\r\n\r\n        void main(void)\r\n        {\r\n              vec3 uGlobePosition = vec3(uGlobePos.x,uGlobePos.y,uGlobePos.z);\r\n              float uAtmosphereRadius = uAtmosphere.x;\r\n              float uAtmosphereScale = uAtmosphere.y;\r\n\r\n              vAtmosphere = 0.0;\r\n              float scale = 10.0 / 6378137.0;\r\n\r\n             vec4 pos = vec4(position, 1.0);\r\n             vec4 cPos4 = uMVMatrix * pos;\r\n             vec3 ray = vec3(cPos4.x * scale,cPos4.y * scale,cPos4.z * scale);\r\n             float c = dot(uGlobePosition,uGlobePosition)-(uAtmosphereRadius*uAtmosphereRadius);\r\n             float a = 2.0*dot(ray,ray);\r\n             float b = 2.0*dot(uGlobePosition,ray);\r\n\r\n\r\n            if (c > 0.0) {\r\n                // outside atmosphere\r\n                float d = b*b - 2.0*a*c;\r\n                if (d < 0.0) {\r\n                    vAtmosphere = 0.0;\r\n                } else {\r\n                    // d = 2.0*sqrt(d)/a; // for outside corona\r\n                    d = (b - sqrt(d))/a;\r\n                    float gradient = (uAtmosphereRadius - length(ray*(1.0+d)*0.5 - uGlobePosition))*uAtmosphereScale;\r\n                    vAtmosphere = length(ray*(1.0-d))*gradient; //0.0001\r\n                }\r\n            } else {\r\n                // inside atmosphere\r\n                float gradient = (uAtmosphereRadius - length(ray*0.5 - uGlobePosition))*uAtmosphereScale;\r\n                vAtmosphere = length(ray)*gradient; //0.0001;\r\n            }\r\n            vAtmosphere = clamp(vAtmosphere*2.0,0.0,1.0);\r\n\r\n          gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);\r\n          //vTextureCoord = aTextureCoord;\r\n          //vec4 texCoord = vec4(texcoord.s, texcoord.t, 1.0, 0.0);\r\n         // texCoord = uTexMatrix * texCoord;\r\n          //vTextureCoord.s = texCoord.x;\r\n          //vTextureCoord.t = texCoord.y;\r\n          //vTextureCoord.s = texcoord.s;\r\n          //vTextureCoord.t = texcoord.t;\r\n          vTextureCoord = texcoord;\r\n\r\n          vLightWeighting = vec3(1.0, 1.0, 1.0);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_terrain_1">\r\n            <parameter name="uTexTransform0" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent0" type="vec4" count="1"/>\r\n            <parameter name="uSampler0" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_terrain_1" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uTexTransform0;\r\n        uniform vec4 uTexExtent0;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n        varying float vAtmosphere;\r\n\r\n        uniform sampler2D uSampler0;\r\n\r\n        vec3 sampleAndBlend(    vec3 previousColor,\r\n                                sampler2D texture,\r\n                                vec2 tileTextureCoordinates,\r\n                                vec4 textureCoordinateExtent,\r\n                                vec4 textureCoordinateTranslationAndScale,\r\n                                float textureAlpha )\r\n                              {\r\n                                vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                alphaMultiplier = step(vec2(0.0,0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n                                vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n                                vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n                                vec4 sample = texture2D(texture, textureCoordinates);\r\n                                vec3 color = sample.rgb;\r\n                                float alpha = sample.a;\r\n                                color = pow(color, vec3(0.78,0.78,0.78));\r\n                                return mix(previousColor, color, alpha * textureAlpha);\r\n                            }\r\n        void main(void)\r\n        {\r\n            vec3 color = vec3(0.0, 0.0, 0.5);\r\n            float textureAlpha = 1.0;\r\n            color = sampleAndBlend( color, uSampler0, clamp(vTextureCoord, 0.0, 1.0),  uTexExtent0,uTexTransform0, textureAlpha );\r\n            gl_FragColor = vec4(color, textureAlpha);\r\n\r\n            float atmo =  vAtmosphere;\r\n            gl_FragColor += (vec4(0.9,0.95,1.0,1.0) - gl_FragColor)*atmo;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_terrain_2">\r\n            <parameter name="uTexTransform0" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent0" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform1" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent1" type="vec4" count="1"/>\r\n            <parameter name="uSampler0" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler1" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_terrain_2" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uTexTransform0;\r\n        uniform vec4 uTexExtent0;\r\n        uniform vec4 uTexTransform1;\r\n        uniform vec4 uTexExtent1;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n\r\n        uniform sampler2D uSampler0;\r\n        uniform sampler2D uSampler1;\r\n         varying float vAtmosphere;\r\n\r\n        vec3 sampleAndBlend(    vec3 previousColor,\r\n                                sampler2D texture,\r\n                                vec2 tileTextureCoordinates,\r\n                                vec4 textureCoordinateExtent,\r\n                                vec4 textureCoordinateTranslationAndScale,\r\n                                float textureAlpha )\r\n                              {\r\n                                vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                alphaMultiplier = step(vec2(0.0,0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n                                vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n                                vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n                                vec4 sample = texture2D(texture, textureCoordinates);\r\n                                vec3 color = sample.rgb;\r\n                                float alpha = sample.a;\r\n                                color = pow(color, vec3(0.78,0.78,0.78));\r\n                                return mix(previousColor, color, alpha * textureAlpha);\r\n                            }\r\n        void main(void)\r\n        {\r\n            vec3 color = vec3(0.0, 0.0, 0.5);\r\n            float textureAlpha = 1.0;\r\n            vec2 texcoords = clamp(vTextureCoord, 0.0, 1.0);\r\n            color = sampleAndBlend( color, uSampler0, texcoords, uTexExtent0,uTexTransform0, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler1, texcoords, uTexExtent1,uTexTransform1, textureAlpha );\r\n            gl_FragColor = vec4(color, textureAlpha);\r\n\r\n            float atmo =  vAtmosphere;\r\n            gl_FragColor += (vec4(0.9,0.95,1.0,1.0) - gl_FragColor)*atmo;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n\r\n        <shaderParameter name="ps_terrain_3">\r\n            <parameter name="uTexTransform0" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent0" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform1" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent1" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform2" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent2" type="vec4" count="1"/>\r\n            <parameter name="uSampler0" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler1" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler2" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_terrain_3" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uTexTransform0;\r\n        uniform vec4 uTexExtent0;\r\n        uniform vec4 uTexTransform1;\r\n        uniform vec4 uTexExtent1;\r\n        uniform vec4 uTexTransform2;\r\n        uniform vec4 uTexExtent2;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n        varying float vAtmosphere;\r\n\r\n        uniform sampler2D uSampler0;\r\n        uniform sampler2D uSampler1;\r\n        uniform sampler2D uSampler2;\r\n\r\n        vec3 sampleAndBlend(    vec3 previousColor,\r\n                                sampler2D texture,\r\n                                vec2 tileTextureCoordinates,\r\n                                vec4 textureCoordinateExtent,\r\n                                vec4 textureCoordinateTranslationAndScale,\r\n                                float textureAlpha )\r\n                              {\r\n                                vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                alphaMultiplier = step(vec2(0.0,0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n                                vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n                                vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n                                vec4 sample = texture2D(texture, textureCoordinates);\r\n                                vec3 color = sample.rgb;\r\n                                float alpha = sample.a;\r\n                                color = pow(color, vec3(0.78,0.78,0.78));\r\n                                return mix(previousColor, color, alpha * textureAlpha);\r\n                            }\r\n        void main(void)\r\n        {\r\n            vec3 color = vec3(0.0, 0.0, 0.5);\r\n            float textureAlpha = 1.0;\r\n            vec2 texcoords = clamp(vTextureCoord, 0.0, 1.0);\r\n            color = sampleAndBlend( color, uSampler0, texcoords, uTexExtent0,uTexTransform0, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler1, texcoords, uTexExtent1,uTexTransform1, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler2, texcoords, uTexExtent2,uTexTransform2, textureAlpha );\r\n            gl_FragColor = vec4(color, textureAlpha);\r\n\r\n            float atmo =  vAtmosphere;\r\n            gl_FragColor += (vec4(0.9,0.95,1.0,1.0) - gl_FragColor)*atmo;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_terrain_4">\r\n            <parameter name="uTexTransform0" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent0" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform1" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent1" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform2" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent2" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform3" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent3" type="vec4" count="1"/>\r\n            <parameter name="uSampler0" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler1" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler2" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler3" type="texture2d" index="3" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_terrain_4" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uTexTransform0;\r\n        uniform vec4 uTexExtent0;\r\n        uniform vec4 uTexTransform1;\r\n        uniform vec4 uTexExtent1;\r\n        uniform vec4 uTexTransform2;\r\n        uniform vec4 uTexExtent2;\r\n        uniform vec4 uTexTransform3;\r\n        uniform vec4 uTexExtent3;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n        varying float vAtmosphere;\r\n\r\n        uniform sampler2D uSampler0;\r\n        uniform sampler2D uSampler1;\r\n        uniform sampler2D uSampler2;\r\n        uniform sampler2D uSampler3;\r\n\r\n        vec3 sampleAndBlend(    vec3 previousColor,\r\n                                sampler2D texture,\r\n                                vec2 tileTextureCoordinates,\r\n                                vec4 textureCoordinateExtent,\r\n                                vec4 textureCoordinateTranslationAndScale,\r\n                                float textureAlpha )\r\n                              {\r\n                                vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                alphaMultiplier = step(vec2(0.0,0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n                                vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n                                vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n                                vec4 sample = texture2D(texture, textureCoordinates);\r\n                                vec3 color = sample.rgb;\r\n                                float alpha = sample.a;\r\n                                color = pow(color, vec3(0.78,0.78,0.78));\r\n                                return mix(previousColor, color, alpha * textureAlpha);\r\n                            }\r\n        void main(void)\r\n        {\r\n            vec3 color = vec3(0.0, 0.0, 0.5);\r\n            float textureAlpha = 1.0;\r\n            vec2 texcoords = clamp(vTextureCoord, 0.0, 1.0);\r\n            color = sampleAndBlend( color, uSampler0, texcoords, uTexExtent0,uTexTransform0, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler1, texcoords, uTexExtent1,uTexTransform1, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler2, texcoords, uTexExtent2,uTexTransform2, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler3, texcoords, uTexExtent3,uTexTransform3, textureAlpha );\r\n            gl_FragColor = vec4(color, textureAlpha);\r\n\r\n            float atmo =  vAtmosphere;\r\n            gl_FragColor += (vec4(0.9,0.95,1.0,1.0) - gl_FragColor)*atmo;\r\n\r\n            /*\r\n            vec3 startDayColor = Computedaycolor(initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\r\n\r\n            vec2 translation = uTexTransform0.xy;\r\n            vec2 scale = vec2(uTexTransform0.z, uTexTransform0.w);\r\n            //translation.y *= uTexTransform0.w;\r\n\r\n            vec2 vTextureCoordinate = vTextureCoord * scale + translation;\r\n\r\n            vec4 textureColor = texture2D(uSampler, vec2(vTextureCoordinate.x, vTextureCoordinate.y));\r\n            gl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\r\n            */\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_terrain_5">\r\n            <parameter name="uTexTransform0" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent0" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform1" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent1" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform2" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent2" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform3" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent3" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform4" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent4" type="vec4" count="1"/>\r\n            <parameter name="uSampler0" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler1" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler2" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler3" type="texture2d" index="3" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler4" type="texture2d" index="4" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_terrain_5" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uTexTransform0;\r\n        uniform vec4 uTexExtent0;\r\n        uniform vec4 uTexTransform1;\r\n        uniform vec4 uTexExtent1;\r\n        uniform vec4 uTexTransform2;\r\n        uniform vec4 uTexExtent2;\r\n        uniform vec4 uTexTransform3;\r\n        uniform vec4 uTexExtent3;\r\n        uniform vec4 uTexTransform4;\r\n        uniform vec4 uTexExtent4;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n        varying float vAtmosphere;\r\n\r\n        uniform sampler2D uSampler0;\r\n        uniform sampler2D uSampler1;\r\n        uniform sampler2D uSampler2;\r\n        uniform sampler2D uSampler3;\r\n        uniform sampler2D uSampler4;\r\n\r\n        vec3 sampleAndBlend(    vec3 previousColor,\r\n                                sampler2D texture,\r\n                                vec2 tileTextureCoordinates,\r\n                                vec4 textureCoordinateExtent,\r\n                                vec4 textureCoordinateTranslationAndScale,\r\n                                float textureAlpha )\r\n                              {\r\n                                vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                alphaMultiplier = step(vec2(0.0,0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n                                vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n                                vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n                                vec4 sample = texture2D(texture, textureCoordinates);\r\n                                vec3 color = sample.rgb;\r\n                                float alpha = sample.a;\r\n                                color = pow(color, vec3(0.78,0.78,0.78));\r\n                                return mix(previousColor, color, alpha * textureAlpha);\r\n                            }\r\n        void main(void)\r\n        {\r\n            vec3 color = vec3(0.0, 0.0, 0.5);\r\n            float textureAlpha = 1.0;\r\n            vec2 texcoords = clamp(vTextureCoord, 0.0, 1.0);\r\n            color = sampleAndBlend( color, uSampler0, texcoords, uTexExtent0,uTexTransform0, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler1, texcoords, uTexExtent1,uTexTransform1, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler2, texcoords, uTexExtent2,uTexTransform2, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler3, texcoords, uTexExtent3,uTexTransform3, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler4, texcoords, uTexExtent4,uTexTransform4, textureAlpha );\r\n            gl_FragColor = vec4(color, textureAlpha);\r\n\r\n            float atmo =  vAtmosphere;\r\n            gl_FragColor += (vec4(0.9,0.95,1.0,1.0) - gl_FragColor)*atmo;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_terrain_6">\r\n            <parameter name="uTexTransform0" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent0" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform1" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent1" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform2" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent2" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform3" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent3" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform4" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent4" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform5" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent5" type="vec4" count="1"/>\r\n            <parameter name="uSampler0" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler1" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler2" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler3" type="texture2d" index="3" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler4" type="texture2d" index="4" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler5" type="texture2d" index="5" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_terrain_6" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uTexTransform0;\r\n        uniform vec4 uTexExtent0;\r\n        uniform vec4 uTexTransform1;\r\n        uniform vec4 uTexExtent1;\r\n        uniform vec4 uTexTransform2;\r\n        uniform vec4 uTexExtent2;\r\n        uniform vec4 uTexTransform3;\r\n        uniform vec4 uTexExtent3;\r\n        uniform vec4 uTexTransform4;\r\n        uniform vec4 uTexExtent4;\r\n        uniform vec4 uTexTransform5;\r\n        uniform vec4 uTexExtent5;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n         varying float vAtmosphere;\r\n\r\n        uniform sampler2D uSampler0;\r\n        uniform sampler2D uSampler1;\r\n        uniform sampler2D uSampler2;\r\n        uniform sampler2D uSampler3;\r\n        uniform sampler2D uSampler4;\r\n        uniform sampler2D uSampler5;\r\n\r\n        vec3 sampleAndBlend(    vec3 previousColor,\r\n                                sampler2D texture,\r\n                                vec2 tileTextureCoordinates,\r\n                                vec4 textureCoordinateExtent,\r\n                                vec4 textureCoordinateTranslationAndScale,\r\n                                float textureAlpha )\r\n                              {\r\n                                vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                alphaMultiplier = step(vec2(0.0,0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n                                vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n                                vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n                                vec4 sample = texture2D(texture, textureCoordinates);\r\n                                vec3 color = sample.rgb;\r\n                                float alpha = sample.a;\r\n                                color = pow(color, vec3(0.78,0.78,0.78));\r\n                                return mix(previousColor, color, alpha * textureAlpha);\r\n                            }\r\n        void main(void)\r\n        {\r\n            vec3 color = vec3(0.0, 0.0, 0.5);\r\n            float textureAlpha = 1.0;\r\n            vec2 texcoords = clamp(vTextureCoord, 0.0, 1.0);\r\n            color = sampleAndBlend( color, uSampler0, texcoords, uTexExtent0,uTexTransform0, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler1, texcoords, uTexExtent1,uTexTransform1, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler2, texcoords, uTexExtent2,uTexTransform2, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler3, texcoords, uTexExtent3,uTexTransform3, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler4, texcoords, uTexExtent4,uTexTransform4, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler5, texcoords, uTexExtent5,uTexTransform5, textureAlpha );\r\n            gl_FragColor = vec4(color, textureAlpha);\r\n\r\n             float atmo =  vAtmosphere;\r\n            gl_FragColor += (vec4(0.9,0.95,1.0,1.0) - gl_FragColor)*atmo;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_terrain_7">\r\n            <parameter name="uTexTransform0" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent0" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform1" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent1" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform2" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent2" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform3" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent3" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform4" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent4" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform5" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent5" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform6" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent6" type="vec4" count="1"/>\r\n            <parameter name="uSampler0" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler1" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler2" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler3" type="texture2d" index="3" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler4" type="texture2d" index="4" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler5" type="texture2d" index="5" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler6" type="texture2d" index="6" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_terrain_7" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uTexTransform0;\r\n        uniform vec4 uTexExtent0;\r\n        uniform vec4 uTexTransform1;\r\n        uniform vec4 uTexExtent1;\r\n        uniform vec4 uTexTransform2;\r\n        uniform vec4 uTexExtent2;\r\n        uniform vec4 uTexTransform3;\r\n        uniform vec4 uTexExtent3;\r\n        uniform vec4 uTexTransform4;\r\n        uniform vec4 uTexExtent4;\r\n        uniform vec4 uTexTransform5;\r\n        uniform vec4 uTexExtent5;\r\n        uniform vec4 uTexTransform6;\r\n        uniform vec4 uTexExtent6;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n         varying float vAtmosphere;\r\n\r\n        uniform sampler2D uSampler0;\r\n        uniform sampler2D uSampler1;\r\n        uniform sampler2D uSampler2;\r\n        uniform sampler2D uSampler3;\r\n        uniform sampler2D uSampler4;\r\n        uniform sampler2D uSampler5;\r\n        uniform sampler2D uSampler6;\r\n\r\n        vec3 sampleAndBlend(    vec3 previousColor,\r\n                                sampler2D texture,\r\n                                vec2 tileTextureCoordinates,\r\n                                vec4 textureCoordinateExtent,\r\n                                vec4 textureCoordinateTranslationAndScale,\r\n                                float textureAlpha )\r\n                              {\r\n                                vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                alphaMultiplier = step(vec2(0.0,0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n                                vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n                                vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n                                vec4 sample = texture2D(texture, textureCoordinates);\r\n                                vec3 color = sample.rgb;\r\n                                float alpha = sample.a;\r\n                                color = pow(color, vec3(0.78,0.78,0.78));\r\n                                return mix(previousColor, color, alpha * textureAlpha);\r\n                            }\r\n        void main(void)\r\n        {\r\n            vec3 color = vec3(0.0, 0.0, 0.5);\r\n            float textureAlpha = 1.0;\r\n            vec2 texcoords = clamp(vTextureCoord, 0.0, 1.0);\r\n            color = sampleAndBlend( color, uSampler0, texcoords, uTexExtent0,uTexTransform0, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler1, texcoords, uTexExtent1,uTexTransform1, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler2, texcoords, uTexExtent2,uTexTransform2, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler3, texcoords, uTexExtent3,uTexTransform3, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler4, texcoords, uTexExtent4,uTexTransform4, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler5, texcoords, uTexExtent5,uTexTransform5, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler6, texcoords, uTexExtent6,uTexTransform6, textureAlpha );\r\n            gl_FragColor = vec4(color, textureAlpha);\r\n\r\n            float atmo =  vAtmosphere;\r\n            gl_FragColor += (vec4(0.9,0.95,1.0,1.0) - gl_FragColor)*atmo;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_terrain_8">\r\n            <parameter name="uTexTransform0" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent0" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform1" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent1" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform2" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent2" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform3" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent3" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform4" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent4" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform5" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent5" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform6" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent6" type="vec4" count="1"/>\r\n            <parameter name="uTexTransform7" type="vec4" count="1"/>\r\n            <parameter name="uTexExtent7" type="vec4" count="1"/>\r\n            <parameter name="uSampler0" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler1" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler2" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler3" type="texture2d" index="3" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler4" type="texture2d" index="4" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler5" type="texture2d" index="5" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler6" type="texture2d" index="6" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler7" type="texture2d" index="7" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_terrain_8" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uTexTransform0;\r\n        uniform vec4 uTexExtent0;\r\n        uniform vec4 uTexTransform1;\r\n        uniform vec4 uTexExtent1;\r\n        uniform vec4 uTexTransform2;\r\n        uniform vec4 uTexExtent2;\r\n        uniform vec4 uTexTransform3;\r\n        uniform vec4 uTexExtent3;\r\n        uniform vec4 uTexTransform4;\r\n        uniform vec4 uTexExtent4;\r\n        uniform vec4 uTexTransform5;\r\n        uniform vec4 uTexExtent5;\r\n        uniform vec4 uTexTransform6;\r\n        uniform vec4 uTexExtent6;\r\n        uniform vec4 uTexTransform7;\r\n        uniform vec4 uTexExtent7;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n        varying float vAtmosphere;\r\n\r\n        uniform sampler2D uSampler0;\r\n        uniform sampler2D uSampler1;\r\n        uniform sampler2D uSampler2;\r\n        uniform sampler2D uSampler3;\r\n        uniform sampler2D uSampler4;\r\n        uniform sampler2D uSampler5;\r\n        uniform sampler2D uSampler6;\r\n        uniform sampler2D uSampler7;\r\n\r\n        vec3 sampleAndBlend(    vec3 previousColor,\r\n                                sampler2D texture,\r\n                                vec2 tileTextureCoordinates,\r\n                                vec4 textureCoordinateExtent,\r\n                                vec4 textureCoordinateTranslationAndScale,\r\n                                float textureAlpha )\r\n                              {\r\n                                vec2 alphaMultiplier = step(textureCoordinateExtent.st, tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                alphaMultiplier = step(vec2(0.0,0.0), textureCoordinateExtent.pq - tileTextureCoordinates);\r\n                                textureAlpha = textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\r\n\r\n                                vec2 translation = textureCoordinateTranslationAndScale.xy;\r\n                                vec2 scale = textureCoordinateTranslationAndScale.zw;\r\n                                vec2 textureCoordinates = tileTextureCoordinates * scale + translation;\r\n                                vec4 sample = texture2D(texture, textureCoordinates);\r\n                                vec3 color = sample.rgb;\r\n                                float alpha = sample.a;\r\n                                color = pow(color, vec3(0.78,0.78,0.78));\r\n                                return mix(previousColor, color, alpha * textureAlpha);\r\n                            }\r\n        void main(void)\r\n        {\r\n            vec3 color = vec3(0.0, 0.0, 0.5);\r\n            float textureAlpha = 1.0;\r\n            vec2 texcoords = clamp(vTextureCoord, 0.0, 1.0);\r\n            color = sampleAndBlend( color, uSampler0, texcoords, uTexExtent0,uTexTransform0, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler1, texcoords, uTexExtent1,uTexTransform1, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler2, texcoords, uTexExtent2,uTexTransform2, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler3, texcoords, uTexExtent3,uTexTransform3, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler4, texcoords, uTexExtent4,uTexTransform4, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler5, texcoords, uTexExtent5,uTexTransform5, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler6, texcoords, uTexExtent6,uTexTransform6, textureAlpha );\r\n            color = sampleAndBlend( color, uSampler7, texcoords, uTexExtent7,uTexTransform7, textureAlpha );\r\n            gl_FragColor = vec4(color, textureAlpha);\r\n\r\n            float atmo =  vAtmosphere;\r\n            gl_FragColor += (vec4(0.9,0.95,1.0,1.0) - gl_FragColor)*atmo;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--Model Shader--\x3e\r\n        <shaderParameter name="vs_model">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_model" type="vertex_shader" input="FVFXyzTex" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec2 texcoord;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n\r\n        void main(void) \r\n        {\r\n          gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);\r\n          vTextureCoord = texcoord;\r\n          vLightWeighting = vec3(1.0, 1.0, 1.0);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_model">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_model" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec3 vLightWeighting;\r\n\r\n        uniform sampler2D uSampler;\r\n\r\n        void main(void)\r\n        {\r\n          vec4 textureColor = texture2D(uSampler, vTextureCoord);\r\n          gl_FragColor = vec4(textureColor.rgb * vLightWeighting, textureColor.a);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--Model Shader--\x3e\r\n        <shaderParameter name="vs_model2">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_model2" type="vertex_shader" input="FVFXyzDiffuse" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec4 color;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n\r\n        varying vec4 vColor;\r\n        varying vec3 vLightWeighting;\r\n\r\n        void main(void)\r\n        {\r\n          gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);\r\n          vColor = color;\r\n          vLightWeighting = vec3(1.0, 1.0, 1.0);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n\r\n        <shaderParameter name="ps_model2">\r\n        </shaderParameter>\r\n        <shader name="ps_model2" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n\r\n        varying vec4 vColor;\r\n        varying vec3 vLightWeighting;\r\n\r\n        //uniform sampler2D uSampler;\r\n\r\n        void main(void)\r\n        {\r\n          //vec4 textureColor = texture2D(uSampler, vTextureCoord);\r\n          gl_FragColor = vec4(vColor.bgr * vLightWeighting, 1.0);\r\n\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--Model Shader--\x3e\r\n        <shaderParameter name="vs_model3">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="minBoundary" type="vec4" count="1"/>\r\n            <parameter name="maxBoundary" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_model3" type="vertex_shader" input="FVFXyzDiffuse" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec4 color;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n\r\n        uniform vec4 minBoundary;\r\n        uniform vec4 maxBoundary;\r\n\r\n        varying vec4 vColor;\r\n        varying vec3 vLightWeighting;\r\n\r\n        void main(void)\r\n        {\r\n          vec4 newPositon = vec4(0.0,0.0,0.0,1.0);\r\n          newPositon.x = (position.x * (maxBoundary.x - minBoundary.x) / 60000.0) + minBoundary.x;\r\n          newPositon.y = (position.y * (maxBoundary.y - minBoundary.y) / 60000.0) + minBoundary.y;\r\n          newPositon.z = (position.z * (maxBoundary.z - minBoundary.z) / 60000.0) + minBoundary.z;\r\n          gl_Position = uPMatrix * uMVMatrix * newPositon;\r\n          vColor = color;\r\n          vLightWeighting = vec3(1.0, 1.0, 1.0);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="vs_model4">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_model4" type="vertex_shader" input="FVFXyzTex2" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec2 texcoord;\r\n        attribute vec2 texcoord2;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec2 vTextureCoord2;\r\n        varying vec3 vLightWeighting;\r\n\r\n        void main(void)\r\n        {\r\n          gl_Position = uPMatrix * uMVMatrix * vec4(position.x, position.y, position.z, 1.0);\r\n          vTextureCoord = texcoord;\r\n          vTextureCoord2 = texcoord2;\r\n          vLightWeighting = vec3(1.0, 1.0, 1.0);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_model4">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_model4" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying vec2 vTextureCoord2;\r\n        varying vec3 vLightWeighting;\r\n\r\n\r\n        uniform sampler2D uSampler;\r\n        uniform sampler2D uSampler2;\r\n\r\n        void main(void)\r\n        {\r\n          vec4 textureColor = texture2D(uSampler, vTextureCoord);\r\n          vec4 textureColor2 = texture2D(uSampler2, vTextureCoord2);\r\n          gl_FragColor = vec4(textureColor.rgb * textureColor2.rgb * vLightWeighting, textureColor.a);\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--&lt;!&ndash;Polyline Shader&ndash;&gt;--\x3e\r\n        \x3c!--<shaderParameter name="vs_polyline">--\x3e\r\n        \x3c!--<parameter name="uMVMatrix" type="mat4" count="1"/>--\x3e\r\n        \x3c!--<parameter name="uPMatrix" type="mat4" count="1"/>--\x3e\r\n        \x3c!--</shaderParameter>--\x3e\r\n        \x3c!--<shader name="vs_polyline"  type="vertex_shader" input="FVFXyz"  language="glsl">--\x3e\r\n        \x3c!--<![CDATA[--\x3e\r\n        \x3c!--attribute vec3 position;--\x3e\r\n\r\n        \x3c!--uniform mat4 uMVMatrix;--\x3e\r\n        \x3c!--uniform mat4 uPMatrix;--\x3e\r\n\r\n\r\n        \x3c!--void main()--\x3e\r\n        \x3c!--{--\x3e\r\n        \x3c!--gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);--\x3e\r\n        \x3c!--}--\x3e\r\n        \x3c!--]]\x3e--\x3e\r\n        \x3c!--</shader>--\x3e\r\n        \x3c!--<shaderParameter name="ps_polyline">--\x3e\r\n        \x3c!--<parameter name="uColor" type="vec4" count="1"/>--\x3e\r\n        \x3c!--</shaderParameter>--\x3e\r\n        \x3c!--<shader name="ps_polyline" type="pixel_shader" language="glsl">--\x3e\r\n        \x3c!--<![CDATA[--\x3e\r\n        \x3c!--precision mediump float;--\x3e\r\n        \x3c!--uniform vec4 uColor;--\x3e\r\n\r\n        \x3c!--void main(void)--\x3e\r\n        \x3c!--{--\x3e\r\n        \x3c!--gl_FragColor = uColor;--\x3e\r\n        \x3c!--}--\x3e\r\n        \x3c!--]]\x3e--\x3e\r\n        \x3c!--</shader>--\x3e\r\n\r\n        \x3c!--Polyline Shader--\x3e\r\n        <shaderParameter name="vs_polyline">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="uLineWidth" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_polyline" type="vertex_shader" input="FVFXyzNormalTex" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec3 normal;\r\n        attribute vec2 texcoord;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n        uniform vec4 uLineWidth;\r\n\r\n        void main()\r\n        {\r\n          vec3 pos = position + normal * texcoord.s * uLineWidth.x;\r\n          gl_Position = uPMatrix * uMVMatrix * vec4(pos, 1.0);\r\n        }\r\n       ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_polyline">\r\n            <parameter name="uColor" type="vec4" count="1"/>\r\n            <parameter name="uBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_polyline" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        uniform vec4 uColor;\r\n        uniform vec4 uBlendColor;\r\n\r\n        void main(void)\r\n        {\r\n           gl_FragColor = uColor * uBlendColor;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--Textured Polyline Shader--\x3e\r\n        <shaderParameter name="vs_textured_polyline">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="uLineWidth" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_textured_polyline" type="vertex_shader" input="FVFXyzNormalTex" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec3 normal;\r\n        attribute vec2 texcoord;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n        uniform vec4 uLineWidth;\r\n\r\n        varying vec2 vTextureCoord;\r\n\r\n        void main()\r\n        {\r\n              vec3 pos = position + normal * texcoord.s * uLineWidth.x;\r\n              gl_Position = uPMatrix * uMVMatrix * vec4(pos, 1.0);\r\n              vTextureCoord.s = (texcoord.t + uLineWidth.x) / uLineWidth.y;\r\n        }\r\n       ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="vs_volume_polyline">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="uLineWidth" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_volume_polyline" type="vertex_shader" input="FVFXyzNormalTex" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec3 normal;\r\n        attribute vec2 texcoord;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n        uniform vec4 uLineWidth;\r\n\r\n        varying vec2 vTextureCoord;\r\n\r\n        void main()\r\n        {\r\n              vec3 pos = position + normal * texcoord.s * uLineWidth.x;\r\n              gl_Position = uPMatrix * uMVMatrix * vec4(pos, 1.0);\r\n              gl_Position.z = gl_Position.z * 0.1;\r\n              vTextureCoord.s = 0.0;\r\n              vTextureCoord.t = texcoord.t;\r\n        }\r\n       ]]\x3e\r\n        </shader>\r\n\r\n\r\n\r\n        \x3c!--Polygon Shader--\x3e\r\n        <shaderParameter name="vs_polygon">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_polygon" type="vertex_shader" input="FVFXyzTex" language="glsl">\r\n            <![CDATA[\r\n                attribute vec3 position;\r\n                attribute vec2 texcoord;\r\n\r\n                uniform mat4 uMVMatrix;\r\n                uniform mat4 uPMatrix;\r\n                varying vec2 vTextureCoord;\r\n\r\n                void main()\r\n                {\r\n                    gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);\r\n                    vTextureCoord = texcoord;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_polygon">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uBlendColor" type="vec4" count="1"/>\r\n             <parameter name="uVisibleAngle" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_polygon" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                uniform sampler2D uSampler;\r\n                uniform vec4 uBlendColor;\r\n                uniform vec4 uVisibleAngle;\r\n                varying vec2 vTextureCoord;\r\n\r\n                float getAngel(vec2 ts)\r\n                {\r\n                    const float PI = 3.14159265;\r\n                    //float angel =0.0;\r\n                    vec3 dir =  vec3(ts.x, ts.y, 0.0) - vec3(0.5, 0.5, 0.0);\r\n                    dir = normalize(dir);\r\n                    float angel = acos(dot(dir, vec3(0.0, -1.0, 0.0)));\r\n                    if(dir.x < 0.0){\r\n                        angel = PI * 2.0 - angel;\r\n                    }\r\n                    return angel;\r\n                }\r\n\r\n                void main(void)\r\n                {\r\n                    gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) * uBlendColor;\r\n                    float angel = getAngel(vTextureCoord);\r\n                    if(angel < uVisibleAngle.x ||  angel > uVisibleAngle.y){\r\n                        gl_FragColor.a = 0.0;\r\n                    }\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n\r\n        \x3c!--TexturedVolume Shader--\x3e\r\n        <shaderParameter name="vs_textured_volume">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_textured_volume" type="vertex_shader" input="FVFXyzNormalTex" language="glsl">\r\n            <![CDATA[\r\n                attribute vec3 position;\r\n                attribute vec3 normal;\r\n                attribute vec2 texcoord;\r\n\r\n                uniform mat4 uMVMatrix;\r\n                uniform mat4 uPMatrix;\r\n                uniform mat4 LightColorMatrix;\r\n                \r\n\r\n                vec3 uKeyLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n                vec3 uBackLightDir = vec3(0.5, -0.5, 0.70710677);\r\n                vec3 uFillLightDir = vec3(0.0, 0.0, -1.0);\r\n\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);\r\n                    vec4 lightResult;\r\n                    lightResult.x = max(dot(normal, uKeyLightDir), 0.0);\r\n                    lightResult.y = max(dot(normal, uBackLightDir), 0.0);\r\n                    lightResult.z = max(dot(normal, uFillLightDir), 0.0);\r\n                    lightResult.w = 1.0;\r\n                    lightColor = vec4((LightColorMatrix * lightResult).xyz,1.0);\r\n                    vTextureCoord = texcoord;\r\n                }\r\n            ]]\x3e\r\n        </shader>        \r\n        <shaderParameter name="ps_textured_volume">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_textured_volume" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                uniform sampler2D texSampler;\r\n                uniform vec4 vBlendColor;\r\n                //vec4 vBlendColor = vec4(1.0, 1.0, 0.0, 1.0);\r\n\r\n                vec4 finalColor;\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    //float c = (vTextureCoord.x <= 0.1 || vTextureCoord.x >=0.9 || vTextureCoord.y <= 0.1 || vTextureCoord.y >= 0.9)? 0.0 : 1.0;\r\n                    //finalColor = vec4(c,c,c,1.0-c);\r\n                    //vec2 delta = vTextureCoord - vec2(0.5,0.5); //delta position from center;\r\n                    //float dist = 0.5 - sqrt(delta.x*delta.x + delta.y*delta.y);\r\n                    //float border = 0.01;\r\n                    //float a = 0.0;\r\n                    //if(dist > border) a = 1.0;\r\n                    //else if(dist > 0.0) a = dist / border;\r\n\r\n\r\n                    //finalColor = vec4(0.0,0.0,0.0,a);\r\n                    vec4 clr = texture2D(texSampler, vTextureCoord);\r\n                    gl_FragColor.rgb = mix(vBlendColor.rgb, clr.rgb * lightColor.rgb * vBlendColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_parametric_color_patch_blend">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_parametric_color_patch_blend" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                uniform sampler2D texSampler;\r\n                uniform vec4 vBlendColor;\r\n                //vec4 vBlendColor = vec4(1.0, 1.0, 0.0, 1.0);\r\n\r\n                vec4 finalColor;\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    //float c = (vTextureCoord.x <= 0.1 || vTextureCoord.x >=0.9 || vTextureCoord.y <= 0.1 || vTextureCoord.y >= 0.9)? 0.0 : 1.0;\r\n                    //finalColor = vec4(c,c,c,1.0-c);\r\n                    //vec2 delta = vTextureCoord - vec2(0.5,0.5); //delta position from center;\r\n                    //float dist = 0.5 - sqrt(delta.x*delta.x + delta.y*delta.y);\r\n                    //float border = 0.01;\r\n                    //float a = 0.0;\r\n                    //if(dist > border) a = 1.0;\r\n                    //else if(dist > 0.0) a = dist / border;\r\n\r\n\r\n                    //finalColor = vec4(0.0,0.0,0.0,a);\r\n                    vec4 clr = texture2D(texSampler, vTextureCoord);\r\n                    gl_FragColor.rgb = mix(vBlendColor.rgb, clr.rgb * lightColor.rgb * vBlendColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--TexturedVolume Shader--\x3e\r\n        <shaderParameter name="vs_textured_volume2">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_textured_volume2" type="vertex_shader" input="FVFXyzNormalTex" language="glsl">\r\n            <![CDATA[\r\n                attribute vec3 position;\r\n                attribute vec3 normal;\r\n                attribute vec2 texcoord;\r\n\r\n                uniform mat4 uMVMatrix;\r\n                uniform mat4 uPMatrix;\r\n                uniform mat4 LightColorMatrix;\r\n                \r\n\r\n                vec3 uKeyLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n                vec3 uBackLightDir = vec3(0.5, -0.5, 0.70710677);\r\n                vec3 uFillLightDir = vec3(0.0, 0.0, -1.0);\r\n\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);\r\n                    vec4 lightResult;\r\n                    lightResult.x = max(dot(normal, uKeyLightDir), 0.0);\r\n                    lightResult.y = max(dot(normal, uBackLightDir), 0.0);\r\n                    lightResult.z = max(dot(normal, uFillLightDir), 0.0);\r\n                    lightResult.w = 1.0;\r\n                    lightColor = vec4((LightColorMatrix * lightResult).xyz,1.0);\r\n                    vTextureCoord = texcoord;\r\n                }\r\n            ]]\x3e\r\n        </shader>        \r\n        <shaderParameter name="ps_textured_volume2">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_textured_volume2" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform vec4 vBlendColor;\r\n                //vec4 vBlendColor = vec4(1.0, 1.0, 0.0, 1.0);\r\n\r\n                vec4 finalColor;\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    //finalColor = vec4(0.0,0.0,0.0,a);\r\n                    vec4 clr = texture2D(texSampler, vTextureCoord);\r\n                    vec4 clr2 = texture2D(texSampler2, vTextureCoord);\r\n\r\n                    gl_FragColor = clr * clr2 * vBlendColor * lightColor;\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                    if(gl_FragColor.a < 0.2){\r\n                        discard;\r\n                    }\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n\r\n        <shaderParameter name="ps_textured_volume_shadow_map_gen">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_textured_volume_shadow_map_gen" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    vec4 clr = texture2D(texSampler, vTextureCoord);\r\n                    gl_FragColor = vec4(0.0,0.0,0.0,clr.a) * lightColor;\r\n                    //gl_FragColor.a = clr.a;\r\n                }\r\n\r\n            ]]\x3e\r\n        </shader>\r\n\r\n\r\n        <shaderParameter name="vs_textured_volume_shadow_map">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n            <parameter name="TexParam" type="vec4"   count="1"/>\r\n            <parameter name="BoundayBox" type="vec4"   count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_textured_volume_shadow_map" type="vertex_shader" input="FVFXyzNormalTex" language="glsl">\r\n            <![CDATA[\r\n                attribute vec3 position;\r\n                attribute vec3 normal;\r\n                attribute vec2 texcoord;\r\n\r\n                uniform mat4 uMVMatrix;\r\n                uniform mat4 uPMatrix;\r\n                uniform mat4 LightColorMatrix;\r\n                uniform vec4 TexParam;\r\n                uniform vec4 BoundayBox;\r\n                \r\n\r\n                vec3 uKeyLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n                vec3 uBackLightDir = vec3(0.5, -0.5, 0.70710677);\r\n                vec3 uFillLightDir = vec3(0.0, 0.0, -1.0);\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);\r\n                    vec4 lightResult;\r\n                    lightResult.x = max(dot(normal, uKeyLightDir), 0.0);\r\n                    lightResult.y = max(dot(normal, uBackLightDir), 0.0);\r\n                    lightResult.z = max(dot(normal, uFillLightDir), 0.0);\r\n                    lightResult.w = 1.0;\r\n                    lightColor = vec4((LightColorMatrix * lightResult).xyz,1.0);\r\n\r\n                    outTexcoord2 = vec2(position.x - BoundayBox.x, position.y-BoundayBox.y);\r\n                    outTexcoord2 = outTexcoord2 * vec2(1.0/(BoundayBox.z-BoundayBox.x), 1.0/(BoundayBox.w-BoundayBox.y));\r\n                    //outTexcoord2 = outTexcoord2*TexParam.xy ;//+ vec2(0.5, position.z/(BoundayBox.y-BoundayBox.x))*TexParam.zw;\r\n                    outTexcoord = texcoord;\r\n                }\r\n            ]]\x3e\r\n        </shader>  \r\n        <shaderParameter name="ps_textured_volume_shadow_map">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_textured_volume_shadow_map" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform vec4 vBlendColor;\r\n\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    gl_FragColor.rgb = mix(vBlendColor.rgb, clr.rgb * clr2.rgb  * lightColor.rgb * vBlendColor.rgb, vBlendColor.a);\r\n                    //gl_FragColor.rgb = clr.rgb * clr2.rgb  * lightColor.rgb * vBlendColor.rgb;\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                }\r\n\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_parametric_color_patch_shadowmap_blend">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_parametric_color_patch_shadowmap_blend" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform vec4 vBlendColor;\r\n\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    gl_FragColor.rgb = mix(vBlendColor.rgb, clr.rgb * clr2.rgb * lightColor.rgb * vBlendColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                }\r\n\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--Polyline Shader--\x3e\r\n        <shaderParameter name="vs_polyline2">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="uLineWidth" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_polyline2" type="vertex_shader" input="FVFXyzNormal2Tex" language="glsl">\r\n            <![CDATA[\r\n        attribute vec3 position;\r\n        attribute vec3 normal;\r\n        attribute vec3 normal2;\r\n        attribute vec2 texcoord;\r\n\r\n        uniform mat4 uMVMatrix;\r\n        uniform mat4 uPMatrix;\r\n        uniform vec4 uLineWidth;\r\n\r\n        varying vec2 vTextureCoord;\r\n        varying highp vec2 greyThreshold;\r\n\r\n        void main()\r\n        {\r\n          if ( texcoord.s < 0.0) {\r\n              vTextureCoord.t = 1.0;\r\n          } else {\r\n              vTextureCoord.t = 0.0;\r\n          }\r\n\r\n          vTextureCoord.s = (texcoord.t + dot(normal,normal2) * uLineWidth.x) / uLineWidth.y;\r\n          greyThreshold.x = uLineWidth.z;\r\n          greyThreshold.y = texcoord.t;\r\n          vec3 pos = position + normal * texcoord.s * uLineWidth.x;\r\n          gl_Position = uPMatrix * uMVMatrix * vec4(pos, 1.0);\r\n        }\r\n       ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_polyline2">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_polyline2" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        varying vec2 vTextureCoord;\r\n        varying highp vec2 greyThreshold;\r\n\r\n        uniform sampler2D uSampler;\r\n        uniform vec4 uBlendColor;\r\n\r\n        void main(void)\r\n        {\r\n            vec4 outColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) * uBlendColor;\r\n            if(greyThreshold.y < greyThreshold.x)\r\n            {\r\n                outColor.x = 0.68;\r\n                outColor.y = 0.68;\r\n                outColor.z = 0.68;\r\n                outColor.a = 0.7;\r\n                //outColor.w *= 0.5\r\n            }\r\n            gl_FragColor = outColor;\r\n          \r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_polyline3">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="uBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_polyline3" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n        varying vec2 vTextureCoord;\r\n\r\n        uniform sampler2D uSampler;\r\n        uniform vec4 uBlendColor;\r\n\r\n        void main(void)\r\n        {\r\n            gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.s, vTextureCoord.t)) * uBlendColor;;\r\n          \r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--ReprojectMercator Shader--\x3e\r\n        <shaderParameter name="vs_reprojectMercator">\r\n            <parameter name="czm_viewportOrthographic" type="mat4" count="1"/>\r\n            <parameter name="u_textureDimensions" type="vec4" count="1"/>\r\n            \x3c!--parameter name="u_textureExtent" type="vec4" count="1"/--\x3e\r\n            <parameter name="u_textureMercatorParam" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_reprojectMercator" type="vertex_shader" input="FVFXyz" language="glsl">\r\n            <![CDATA[\r\n              precision mediump float;\r\n              attribute vec2 position;\r\n\r\n              uniform mat4 czm_viewportOrthographic;\r\n              uniform vec4 u_textureDimensions;\r\n              //uniform vec4 u_textureExtent;\r\n              uniform vec4 u_textureMercatorParam;\r\n\r\n              //uniform float u_northLatitude;\r\n              //uniform float u_southLatitude;\r\n              //uniform float u_southMercatorYHigh;\r\n              //uniform float u_southMercatorYLow;\r\n              //uniform float u_oneOverMercatorHeight;\r\n\r\n              varying vec2 v_textureCoordinates;\r\n\r\n              float czm_latitudeToWebMercatorFraction(float latitude, float southMercatorYLow, float southMercatorYHigh, float oneOverMercatorHeight)\r\n              {\r\n                  float sinLatitude = sin(latitude);\r\n                  float mercatorY = 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\r\n                  //mercatorY - southMercatorY in simulated double precision.\r\n                  float t1 = 0.0 - southMercatorYLow;\r\n                  float e = t1 - 0.0;\r\n                  float t2 = ((-southMercatorYLow - e) + (0.0 - (t1 - e))) + mercatorY - southMercatorYHigh;\r\n                  float highDifference = t1 + t2;\r\n                  float lowDifference = t2 - (highDifference - t1);\r\n                  return highDifference * oneOverMercatorHeight + lowDifference * oneOverMercatorHeight;\r\n              }\r\n\r\n              void main()\r\n              {\r\n                  float currentLatitude = mix(u_textureDimensions.w, u_textureDimensions.z, position.y);\r\n                  float fraction = czm_latitudeToWebMercatorFraction(currentLatitude, u_textureMercatorParam.y, u_textureMercatorParam.x, u_textureMercatorParam.z);\r\n                  v_textureCoordinates = vec2(position.x, fraction);\r\n                  //gl_Position = czm_viewportOrthographic *  vec4(position.x * u_textureDimensions.x, position.y * u_textureDimensions.y, 0.0, 1.0);\r\n                  gl_Position = vec4(position.x * 2.0 - 1.0, position.y * 2.0 - 1.0, 0.0, 1.0);\r\n              }\r\n       ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_reprojectMercator">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_reprojectMercator" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n            precision mediump float;\r\n            uniform sampler2D uSampler;\r\n\r\n            varying vec2 v_textureCoordinates;\r\n\r\n            void main()\r\n            {\r\n                gl_FragColor = texture2D(uSampler, v_textureCoordinates);\r\n            }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="vs_recceGround">\r\n            <parameter name="UnpackModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n            <parameter name="MinUVRange" type="vec4" count="1"/>\r\n            <parameter name="MaxUVRange" type="vec4" count="1"/>\r\n            <parameter name="LightDotUnpack" type="vec4" count="1"/>\r\n            <parameter name="MinPosRange" type="vec4" count="1"/>\r\n            <parameter name="MaxPosRange" type="vec4" count="1"/>\r\n            <parameter name="CameraRelativeModelOrigin" type="vec4" count="1"/>\r\n            <parameter name="WorldUp" type="vec4" count="1"/>\r\n            <parameter name="FogIntensities" type="vec4" count="1"/>\r\n            <parameter name="FogRamp" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_recceGround" type="vertex_shader" input="FVFXyzwTex2" language="glsl">\r\n            <![CDATA[\r\n            attribute mediump vec4 Position;\r\n            attribute lowp vec2 UV;\r\n            attribute lowp vec2 UV2;\r\n\r\n            varying lowp vec4 ColorVarying;\r\n            varying mediump vec2 DestinationUV;\r\n            varying highp vec2 DestinationUV2;\r\n\r\n            uniform highp mat4 UnpackModelViewProjectionMatrix;\r\n            uniform lowp mat4 LightColorMatrix;\r\n            uniform highp vec4 MinUVRange;\r\n            uniform highp vec4 MaxUVRange;\r\n            uniform highp vec4 LightDotUnpack;\r\n            uniform highp vec4 MinPosRange;\r\n            uniform highp vec4 MaxPosRange;\r\n            uniform highp vec4 CameraRelativeModelOrigin;\r\n            uniform lowp vec4 WorldUp;\r\n            uniform lowp vec4 FogIntensities;\r\n            uniform highp vec4 FogRamp;\r\n\r\n            lowp float CalcHeightFogDensity(highp vec3 vertexPos) {\r\n                highp vec3 cameraRelativePos = CameraRelativeModelOrigin.xyz + vertexPos;\r\n                highp vec2 rampParams = vec2(dot(cameraRelativePos, WorldUp.xyz), dot(cameraRelativePos, cameraRelativePos));\r\n                lowp vec2 ramps = smoothstep(FogRamp.yz, FogRamp.xw, rampParams);\r\n                lowp vec2 heightAndDistanceFogParams = vec2(ramps.x*ramps.x, ramps.y);\r\n                return clamp(dot(heightAndDistanceFogParams, FogIntensities.xy), 0.0, 1.0);\r\n            }\r\n            void main(void) {\r\n                DestinationUV = mix(MinUVRange.xy, MaxUVRange.xy, UV);\r\n                DestinationUV2 = UV2;\r\n                mediump vec3 unpackedPosition = mix(MinPosRange.xyz, MaxPosRange.xyz, Position.xyz);\r\n                ColorVarying.rgb = (LightColorMatrix * vec4(fract(Position.w * LightDotUnpack.xyz), 1.0)).rgb;\r\n                ColorVarying.a = CalcHeightFogDensity(unpackedPosition);\r\n                gl_Position = UnpackModelViewProjectionMatrix * vec4(Position.rgb, 1.0);\r\n            }\r\n       ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_recceGround">\r\n            <parameter name="GlowmapParam" type="vec4" count="1"/>\r\n            <parameter name="GlowmapColour" type="vec4" count="1"/>\r\n            <parameter name="AmbientColour" type="vec4" count="1"/>\r\n            <parameter name="FogColour" type="vec4" count="1"/>\r\n            <parameter name="Diffuse" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="Glowmap" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_recceGround" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                varying lowp vec4 ColorVarying;\r\n                varying mediump vec2 DestinationUV;\r\n                varying highp vec2 DestinationUV2;\r\n\r\n                uniform lowp vec4 GlowmapParam;\r\n                uniform lowp vec4 GlowmapColour;\r\n                uniform lowp vec4 AmbientColour;\r\n                uniform lowp vec4 FogColour;\r\n\r\n                uniform sampler2D Diffuse;\r\n                uniform sampler2D Glowmap;\r\n                void main(void) {\r\n                    lowp vec3 diffuse = texture2D(Diffuse,DestinationUV, -1.0).rgb;\r\n                    lowp vec3 dayColour = diffuse * ColorVarying.rgb;\r\n                    lowp float luma = dot(diffuse, vec3(0.3, 0.59, 0.11));\r\n                    lowp vec3 greyscale = vec3(luma, luma, luma);\r\n                    lowp vec3 glow = GlowmapColour.xyz * texture2D(Glowmap,DestinationUV2, -1.0).rgb;\r\n                    lowp vec3 desatDiffuse = mix(greyscale, diffuse, 0.2);\r\n                    lowp vec3 nightColour = desatDiffuse * (glow + AmbientColour.xyz);\r\n                    gl_FragColor.rgb = mix(mix(dayColour, nightColour, GlowmapParam.x), FogColour.rgb, ColorVarying.a);\r\n                }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--ReprojectMercator Shader--\x3e\r\n        <shaderParameter name="vs_recceModel">\r\n            <parameter name="UnpackModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n            <parameter name="MinUVRange" type="vec4" count="1"/>\r\n            <parameter name="MaxUVRange" type="vec4" count="1"/>\r\n            <parameter name="LightDotUnpack" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_recceModel" type="vertex_shader" input="FVFXyzwTex" language="glsl">\r\n            <![CDATA[\r\n          attribute mediump vec4 position;\r\n          attribute lowp vec2 texcoord;\r\n          varying lowp vec4 ColorVarying;\r\n          varying mediump vec2 DestinationUV;\r\n          uniform highp mat4 UnpackModelViewProjectionMatrix;\r\n          uniform lowp mat4 LightColorMatrix;\r\n          uniform highp vec4 MinUVRange;\r\n          uniform highp vec4 MaxUVRange;\r\n          uniform highp vec4 LightDotUnpack;\r\n\r\n        vec3 uKeyLightDir = vec3(0.5, -0.5, 0.70710677);\r\n        vec3 uBackLightDir = vec3(0.5, -0.5, 0.70710677);\r\n        vec3 uFillLightDir = vec3(0.0, 0.0, 1.0);\r\n\r\n          void main(void) {\r\n              DestinationUV = mix(MinUVRange.xy, MaxUVRange.xy, texcoord);\r\n                //vec3 transform_normal = fract(position.w * LightDotUnpack.xyz);\r\n                //vec4 lightResult;\r\n                //lightResult.x = max(dot(transform_normal, uKeyLightDir), 0.0);\r\n                //lightResult.y = max(dot(transform_normal, uBackLightDir), 0.0);\r\n                //lightResult.z = max(dot(transform_normal, uFillLightDir), 0.0);\r\n                //lightResult.w = 1.0;\r\n                //ColorVarying = vec4((LightColorMatrix * lightResult).xyz, 1.0);\r\n              ColorVarying = LightColorMatrix * vec4(fract(position.w * LightDotUnpack.xyz), 1.0);\r\n              gl_Position = UnpackModelViewProjectionMatrix * vec4(position.xyz, 1.0);\r\n          }\r\n       ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_recceModel">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_recceModel" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                varying lowp vec4 ColorVarying;\r\n                varying mediump vec2 DestinationUV;\r\n                uniform sampler2D uSampler;\r\n                uniform mediump vec4 vBlendColor;\r\n\r\n                void main(void) {\r\n                    lowp vec4 textureColor = texture2D(uSampler, DestinationUV, -1.0);\r\n                    gl_FragColor.rgb = mix( vBlendColor.rgb, textureColor.rgb * ColorVarying.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = textureColor.a * vBlendColor.a;\r\n                    if(gl_FragColor.a <= 0.8){\r\n                        discard;\r\n                    }\r\n                }\r\n           ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_recceModel_Transparency">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n             <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_recceModel_Transparency" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                varying lowp vec4 ColorVarying;\r\n                varying mediump vec2 DestinationUV;\r\n                uniform sampler2D uSampler;\r\n                uniform mediump vec4 vBlendColor;\r\n                \r\n                void main(void) {\r\n                    lowp vec4 textureColor = texture2D(uSampler,DestinationUV, -1.0);\r\n                    gl_FragColor.rgb = mix( vBlendColor.rgb, textureColor.rgb * ColorVarying.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = textureColor.a * vBlendColor.a;\r\n                    if(gl_FragColor.a >= 0.8){\r\n                        discard;\r\n                    }\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n            <shaderParameter name="ps_recceModel_Blend">\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n             <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_recceModel_Blend" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                varying lowp vec4 ColorVarying;\r\n                varying mediump vec2 DestinationUV;\r\n                uniform sampler2D uSampler;\r\n                uniform mediump vec4 vBlendColor;\r\n                \r\n                void main(void) {\r\n                    lowp vec4 textureColor = texture2D(uSampler,DestinationUV, -1.0);\r\n                    gl_FragColor.rgb = mix( vBlendColor.rgb, textureColor.rgb * ColorVarying.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = textureColor.a * vBlendColor.a;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n\r\n        \x3c!--GLTF Shader--\x3e\r\n        <shaderParameter name="vs_gltf_model">\r\n            <parameter name="uMVMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="uModelMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_gltf_model" type="vertex_shader" input="FVFXyzNormalTex" language="glsl">\r\n            <![CDATA[\r\n                attribute vec3 position;\r\n                attribute vec3 normal;\r\n                attribute vec2 texcoord;\r\n\r\n                uniform mat4 uMVMatrix;\r\n                uniform mat4 uPMatrix;\r\n                uniform mat4 uModelMatrix;\r\n                uniform mat4 LightColorMatrix;\r\n                \r\n\r\n  \r\n                vec3 uKeyLightDir = vec3(0.5, -0.5, 0.70710677);\r\n                vec3 uBackLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n\r\n                //vec3 uKeyLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n                //vec3 uBackLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n                vec3 uFillLightDir = vec3(0.0, 0.0, -1.0);\r\n\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    gl_Position = uPMatrix * uMVMatrix * vec4(position, 1.0);\r\n                    vec3 transform_normal = normalize((uModelMatrix * vec4(normal, 1.0)).xyz);\r\n                    vec4 lightResult;\r\n                    lightResult.x = max(dot(transform_normal, uKeyLightDir), 0.0);\r\n                    lightResult.y = max(dot(transform_normal, uBackLightDir), 0.0);\r\n                    lightResult.z = max(dot(transform_normal, uFillLightDir), 0.0);\r\n                    lightResult.w = 1.0;\r\n                    lightColor = vec4((LightColorMatrix * lightResult).xyz,1.0);\r\n                    vTextureCoord = texcoord;\r\n                }\r\n            ]]\x3e\r\n        </shader>        \r\n        <shaderParameter name="ps_gltf_model">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_gltf_model" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform vec4 vBlendColor;\r\n                //vec4 vBlendColor = vec4(1.0, 1.0, 0.0, 1.0);\r\n\r\n                vec4 finalColor;\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    //finalColor = vec4(0.0,0.0,0.0,a);\r\n                    vec4 clr = texture2D(texSampler, vTextureCoord);\r\n                    vec4 clr2 = texture2D(texSampler2, vTextureCoord);\r\n\r\n                    gl_FragColor.rgb =  mix( vBlendColor.rgb, clr.rgb * clr2.rgb * lightColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                    if(gl_FragColor.a < 0.8){\r\n                        discard;\r\n                    }\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_gltf_model_transparency">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_gltf_model_transparency" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform vec4 vBlendColor;\r\n                //vec4 vBlendColor = vec4(1.0, 1.0, 0.0, 1.0);\r\n\r\n                vec4 finalColor;\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    //finalColor = vec4(0.0,0.0,0.0,a);\r\n                    vec4 clr = texture2D(texSampler, vTextureCoord);\r\n                    vec4 clr2 = texture2D(texSampler2, vTextureCoord);\r\n\r\n                    gl_FragColor.rgb =  mix( vBlendColor.rgb, clr.rgb * clr2.rgb * lightColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                    if(gl_FragColor.a >= 0.8){\r\n                        discard;\r\n                    }\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_gltf_model_blend">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_gltf_model_blend" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform vec4 vBlendColor;\r\n                //vec4 vBlendColor = vec4(1.0, 1.0, 0.0, 1.0);\r\n\r\n                vec4 finalColor;\r\n                varying vec2 vTextureCoord;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    //finalColor = vec4(0.0,0.0,0.0,a);\r\n                    vec4 clr = texture2D(texSampler, vTextureCoord);\r\n                    vec4 clr2 = texture2D(texSampler2, vTextureCoord);\r\n\r\n                    gl_FragColor.rgb = mix( vBlendColor.rgb, clr.rgb * clr2.rgb * lightColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n        \r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="vs_recceModelShadow">\r\n            <parameter name="ModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="MinVertRange" type="vec4" count="1"/>\r\n            <parameter name="MaxVertRange" type="vec4" count="1"/>\r\n            <parameter name="Up" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_recceModelShadow" type="vertex_shader" input="FVFXyzw" language="glsl">\r\n            <![CDATA[\r\n            attribute mediump vec4 position;\r\n            uniform highp mat4 ModelViewProjectionMatrix;\r\n            uniform mediump vec4 MinVertRange;\r\n            uniform mediump vec4 MaxVertRange;\r\n            uniform mediump vec4 Up;\r\n            void main(void) {\r\n                highp vec4 scaledPos = vec4(mix(MinVertRange.xyz, MaxVertRange.xyz, position.xyz), position.w * MaxVertRange.w);\r\n                highp vec3 truePos = scaledPos.xyz;// + (((-Up.xyz)*scaledPos.w*4.0)*(1.0-Up.w));\r\n                gl_Position = ModelViewProjectionMatrix * vec4(truePos, 1.0);\r\n\r\n            }\r\n       ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="vs_recceModelShadow2">\r\n            <parameter name="ModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="MinVertRange" type="vec4" count="1"/>\r\n            <parameter name="MaxVertRange" type="vec4" count="1"/>\r\n            <parameter name="Up" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_recceModelShadow2" type="vertex_shader" input="FVFXyzw" language="glsl">\r\n            <![CDATA[\r\n            attribute mediump vec4 position;\r\n            uniform highp mat4 ModelViewProjectionMatrix;\r\n            uniform mediump vec4 MinVertRange;\r\n            uniform mediump vec4 MaxVertRange;\r\n            uniform mediump vec4 Up;\r\n            void main(void) {\r\n                //vec3 lightDotUnpack = vec3(1.0,32.0,1024.0);\r\n                vec3 lightDotUnpack = vec3(-0.562500000,0.437500000,-0.750000000);\r\n                //vec3 unpackNormal = fract(position.w * lightDotUnpack.xyz);\r\n                //unpackNormal = normalize(unpackNormal);\r\n                float length = abs(position.w - 0.25806057831692988479438467994202) * 65535.0/(16912.0-7908.0);\r\n                highp vec4 scaledPos = vec4(mix(MinVertRange.xyz, MaxVertRange.xyz, position.xyz), position.w * MaxVertRange.w);\r\n                // highp vec3 truePos = scaledPos.xyz + (((-Up.xyz)*scaledPos.w*4.0)*(1.0-Up.w));\r\n                highp vec3 truePos = scaledPos.xyz + lightDotUnpack * length * 0.0;\r\n                gl_Position = ModelViewProjectionMatrix * vec4(truePos.xyz, 1.0);\r\n\r\n                //vec4 scaledPos = ModelViewProjectionMatrix * vec4(position.xyz, 1.0);\r\n                //gl_Position.xyz = scaledPos.xyz + unpackNormal * MaxVertRange.w;\r\n                //gl_Position.w = 1.0;\r\n            }\r\n       ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_recceModelShadow">\r\n        </shaderParameter>\r\n        <shader name="ps_recceModelShadow" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n           void main(void) {\r\n              gl_FragColor.rgb = vec3(0.0,0.0,0.0);\r\n              gl_FragColor.a = 1.0;\r\n           }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="vs_shadowVolumeFill">\r\n            <parameter name="ModelViewProjectionMatrix" type="mat4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_shadowVolumeFill" type="vertex_shader" input="FVFXyz" language="glsl">\r\n            <![CDATA[\r\n            attribute mediump vec4 position;\r\n            uniform highp mat4 ModelViewProjectionMatrix;\r\n            void main(void) {\r\n                gl_Position = ModelViewProjectionMatrix * vec4(position.xyz, 1.0);\r\n            }\r\n       ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_shadowVolumeFill">\r\n            <parameter name="ColorValue" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_shadowVolumeFill" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n          uniform lowp vec4 ColorValue;\r\n           void main(void) {\r\n              gl_FragColor = ColorValue;\r\n              gl_FragColor.a = 1.0;\r\n           }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--recceModelWater Shader--\x3e\r\n        <shaderParameter name="vs_recceModelWater">\r\n            <parameter name="ModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="ModelViewMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n            <parameter name="AnimatedUVUniform" type="vec4" count="1"/>\r\n            <parameter name="AltitudeEnvMapFade" type="vec4" count="1"/>\r\n            <parameter name="MinVertRange" type="vec4" count="1"/>\r\n            <parameter name="MaxVertRange" type="vec4" count="1"/>\r\n            <parameter name="MinUVRange" type="vec4" count="1"/>\r\n            <parameter name="MaxUVRange" type="vec4" count="1"/>\r\n            <parameter name="CameraRelativeModelOrigin" type="vec4" count="1"/>\r\n            <parameter name="WorldUp" type="vec4" count="1"/>\r\n            <parameter name="FogIntensities" type="vec4" count="1"/>\r\n            <parameter name="FogRamp" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_recceModelWater" type="vertex_shader" input="FVFXyzwTex" language="glsl">\r\n            <![CDATA[\r\n            attribute highp vec4 position;\r\n            attribute highp vec2 texcoord;\r\n            varying highp vec2 DestinationUV;\r\n            varying highp vec4 ColorVarying;\r\n            varying highp vec2\tDestinationUV2;\r\n            varying highp vec4 ReflectVector;\r\n            uniform highp mat4 ModelViewProjectionMatrix;\r\n            uniform highp mat4 ModelViewMatrix;\r\n            uniform highp mat4 LightColorMatrix;\r\n            uniform highp vec4 AnimatedUVUniform;\r\n            uniform highp vec4 AltitudeEnvMapFade;\r\n            uniform highp vec4 MinVertRange;\r\n            uniform highp vec4 MaxVertRange;\r\n            uniform highp vec4 MinUVRange;\r\n            uniform highp vec4 MaxUVRange;\r\n            uniform highp vec4 CameraRelativeModelOrigin;\r\n            uniform lowp vec4 WorldUp;\r\n            uniform lowp vec4 FogIntensities;\r\n            uniform highp vec4 FogRamp;\r\n            lowp float CalcHeightFogDensity(highp vec3 vertexPos) {\r\n                highp vec3 cameraRelativePos = CameraRelativeModelOrigin.xyz + vertexPos;\r\n                highp vec2 rampParams = vec2(dot(cameraRelativePos, WorldUp.xyz), dot(cameraRelativePos, cameraRelativePos));\r\n                lowp vec2 ramps = smoothstep(FogRamp.yz, FogRamp.xw, rampParams);\r\n                lowp vec2 heightAndDistanceFogParams = vec2(ramps.x*ramps.x, ramps.y);\r\n                return clamp(dot(heightAndDistanceFogParams, FogIntensities.xy), 0.0, 1.0);\r\n            }\r\n            void main(void) {\r\n                highp vec2 baseUVOffset = AnimatedUVUniform.xy * AnimatedUVUniform.zw;\r\n                highp vec2 ScaledUV = mix(MinUVRange.xy, MaxUVRange.xy, texcoord).xy;\r\n                DestinationUV = ScaledUV.xy; //baseUVOffset.xy + (ScaledUV.xy);\r\n                highp vec3 dots = fract(vec3(position.w * 1.0, position.w * 32.0, position.w * 1024.0));\r\n                ColorVarying = (LightColorMatrix * vec4(dots, 1.0));\r\n                DestinationUV2 = (ScaledUV * 4.0) + (baseUVOffset * 3.0);\r\n                highp vec3 truePos = mix(MinVertRange.xyz, MaxVertRange.xyz, position.xyz);\r\n                highp vec3 posVS = (ModelViewMatrix * vec4(truePos.xyz, 1.0)).xyz;\r\n                highp vec3 eyeVectorVS = normalize(posVS);\r\n                highp vec3 normal = vec3(0,0,1);\r\n                ReflectVector.xyz = reflect(eyeVectorVS, normal) * 32.0;\r\n                ReflectVector.w = CalcHeightFogDensity(truePos);\r\n                ColorVarying = (ColorVarying * (1.0 - AltitudeEnvMapFade.x)) + (ColorVarying * 0.1);\r\n                ColorVarying.w = AltitudeEnvMapFade.x;\r\n                gl_Position = ModelViewProjectionMatrix * vec4(truePos.xyz, 1.0);\r\n            }\r\n       ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_recceModelWater">\r\n            <parameter name="ReflectionWaveDisplacement" type="vec4" count="1"/>\r\n            <parameter name="FogColour" type="vec4" count="1"/>\r\n            <parameter name="Diffuse" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="NormalMap" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="ReflectionMap" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_recceModelWater" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n            varying highp vec4 ColorVarying;\r\n            varying highp vec2 DestinationUV;\r\n            varying highp vec2\tDestinationUV2;\r\n            varying highp vec4 ReflectVector;\r\n            uniform lowp vec4 ReflectionWaveDisplacement;\r\n            uniform lowp vec4 FogColour;\r\n            uniform sampler2D Diffuse;\r\n            uniform sampler2D NormalMap;\r\n            uniform sampler2D ReflectionMap;\r\n            void main(void) {\r\n                highp vec4 diffuseColor = texture2D(Diffuse, DestinationUV);\r\n                highp vec2 uv2 = fract(DestinationUV2 * 64.0);\r\n                highp vec3 normal = ((2.0 * texture2D(NormalMap, uv2).xyz) - 1.0);\r\n                highp vec3 refl = normalize(ReflectVector.xyz + normal*ReflectionWaveDisplacement.x);\r\n                highp vec2 uv = ((refl.xy * 0.5) + 0.5);\r\n                highp vec4 reflection = texture2D(ReflectionMap, uv);\r\n                lowp vec3 colour = (diffuseColor.xyz * ColorVarying.xyz) + (reflection.xyz * ColorVarying.w);\r\n                gl_FragColor.rgb = mix(colour, FogColour.rgb, ReflectVector.w);\r\n                gl_FragColor.a = 1.0;\r\n                \r\n            }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n\r\n        \x3c!--Model Shader(T23)--\x3e\r\n        <shaderParameter name="vs_json_model_normal">\r\n            <parameter name="modelViewMatrix" type="mat4" count="1"/>\r\n            <parameter name="uPMatrix" type="mat4" count="1"/>\r\n            <parameter name="modelMatrix" type="mat4" count="1"/>\r\n            <parameter name="viewMatrix" type="mat4" count="1"/>\r\n            <parameter name="normalMatrix" type="mat4" count="1"/>\r\n\r\n            <parameter name="offsetRepeat" type="vec4" count="1"/>\r\n            <parameter name="ambient" type="vec4" count="1"/>\r\n            <parameter name="diffuse" type="vec4" count="1"/>\r\n            <parameter name="emissive" type="vec4" count="1"/>\r\n            <parameter name="ambientLightColor" type="vec4" count="1"/>\r\n            <parameter name="directionalLightColor0" type="vec4" count="1"/>\r\n            <parameter name="directionalLightColor1" type="vec4" count="1"/>\r\n            <parameter name="directionalLightDirection0" type="vec4" count="1"/>\r\n            <parameter name="directionalLightDirection1" type="vec4" count="1"/>\r\n            <parameter name="hemisphereLightSkyColor" type="vec4" count="1"/>\r\n            <parameter name="hemisphereLightGroundColor" type="vec4" count="1"/>\r\n            <parameter name="hemisphereLightDirection" type="vec4" count="1"/>\r\n            <parameter name="spotLightColor" type="vec4" count="1"/>\r\n            <parameter name="spotLightPosition" type="vec4" count="1"/>\r\n            <parameter name="spotLightDirection" type="vec4" count="1"/>\r\n            <parameter name="spotLightFloat" type="vec4" count="1"/>\r\n\r\n        </shaderParameter>\r\n        <shader name="vs_json_model_normal" type="vertex_shader" input="FVFXyzNormalTex" language="glsl">\r\n            <![CDATA[\r\n            uniform mat4 modelViewMatrix;\r\n            uniform mat4 uPMatrix;\r\n            uniform mat4 viewMatrix;\r\n            uniform mat4 modelMatrix;\r\n            uniform mat4 normalMatrix;\r\n\r\n            uniform vec4 offsetRepeat;\r\n            uniform vec4 ambient;\r\n            uniform vec4 diffuse;\r\n            uniform vec4 emissive;\r\n\r\n            uniform vec4 ambientLightColor;\r\n\r\n            uniform vec4 directionalLightColor0;\r\n            uniform vec4 directionalLightColor1;\r\n\r\n            uniform vec4 directionalLightDirection0;\r\n            uniform vec4 directionalLightDirection1;\r\n\r\n            uniform vec4 hemisphereLightSkyColor;\r\n            uniform vec4 hemisphereLightGroundColor;\r\n            uniform vec4 hemisphereLightDirection;\r\n\r\n            uniform vec4 spotLightColor;\r\n            uniform vec4 spotLightPosition;\r\n            uniform vec4 spotLightDirection;\r\n\r\n            uniform vec4 spotLightFloat;\r\n\r\n            attribute vec3 position;\r\n            attribute vec3 normal;\r\n            attribute vec2 texcoord;\r\n\r\n            varying vec3 vLightFront;\r\n            varying vec2 vUv;\r\n            void main(void) {\r\n                vUv = texcoord * offsetRepeat.zw + offsetRepeat.xy;\r\n                vec4 worldPosition = modelMatrix * vec4( position, 1.0 );\r\n                vec4 mvPosition;\r\n                mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n                gl_Position = uPMatrix * mvPosition;\r\n                vec4 transformedNormal = normalMatrix * vec4( normal, 0.0);\r\n                vLightFront = vec3( 0.0 );\r\n\r\n\r\n                vec4 lDirection = viewMatrix * directionalLightDirection0;\r\n                vec3 dirVector = normalize( lDirection.xyz );\r\n                float dotProduct = dot( transformedNormal.xyz, dirVector );\r\n                vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\r\n                vLightFront += directionalLightColor0.xyz * directionalLightWeighting;\r\n\r\n                vec4 lDirection1 = viewMatrix * directionalLightDirection1;\r\n                vec3 dirVector1 = normalize( lDirection1.xyz );\r\n                float dotProduct1 = dot( transformedNormal.xyz, dirVector1 );\r\n                vec3 directionalLightWeighting1 = vec3( max( dotProduct1, 0.0 ) );\r\n                vLightFront += directionalLightColor1.xyz * directionalLightWeighting1;\r\n\r\n\r\n                vec4 lPosition = viewMatrix * spotLightPosition;\r\n                vec3 lVector = lPosition.xyz - mvPosition.xyz;\r\n                float spotEffect = dot( spotLightDirection.xyz, normalize( spotLightPosition.xyz - worldPosition.xyz ) );\r\n                float spotLightAngleCos = spotLightFloat.y;\r\n                float spotLightExponent = spotLightFloat.z;\r\n                if ( spotEffect > spotLightAngleCos ) {\r\n                    spotEffect = max( pow( max( spotEffect, 0.0 ), spotLightExponent ), 0.0 );\r\n                    float lDistance = 1.0;\r\n                    float spotLightDistance = spotLightFloat.x;\r\n                    if ( spotLightDistance > 0.0 )\r\n                    lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance ), 1.0 );\r\n                    lVector = normalize( lVector );\r\n                    float dotProduct = dot( transformedNormal.xyz, lVector );\r\n                    vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\r\n                    vLightFront += spotLightColor.xyz * spotLightWeighting * lDistance * spotEffect;\r\n                }\r\n\r\n                lDirection = viewMatrix * hemisphereLightDirection;\r\n                dirVector = normalize( lDirection.xyz );\r\n                dotProduct = dot( transformedNormal.xyz, dirVector );\r\n                float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\r\n                float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\r\n                vLightFront += mix( hemisphereLightGroundColor.xyz, hemisphereLightSkyColor.xyz, hemiDiffuseWeight );\r\n\r\n\r\n                vLightFront = vLightFront * diffuse.xyz + ambient.xyz * ambientLightColor.xyz + emissive.xyz;\r\n\r\n            }\r\n        ]]\x3e\r\n        </shader>\r\n        \x3c!--<shader>--\x3e\r\n\r\n\r\n        \x3c!--</shader>--\x3e\r\n\r\n        <shaderParameter name="ps_json_model_normal">\r\n            <parameter name="opacity" type="vec4" count="1"/>\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_json_model_normal" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n        precision mediump float;\r\n\r\n        varying vec3 vLightFront;\r\n        varying vec2 vUv;\r\n\r\n       // uniform float opacity;\r\n        uniform vec4 opacity;\r\n        uniform sampler2D uSampler;\r\n        void main(void) {\r\n        gl_FragColor = vec4( vec3( 1.0 ), opacity.x );\r\n        vec4 texelColor = texture2D( uSampler, vUv );\r\n        gl_FragColor = gl_FragColor * texelColor;\r\n        //if ( gl_FragColor.a < ALPHATEST ) discard;\r\n        //float specularStrength = 1.0;\r\n        gl_FragColor.xyz *= vLightFront;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--David --\x3e\r\n        <shaderParameter name="vs_flake_line">\r\n            <parameter name="g_WorldViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="g_matViewProj" type="mat4" count="1"/>\r\n            <parameter name="g_viewportScale"             type="vec4"   count="1"/>\r\n        </shaderParameter>\r\n        <shader name="vs_flake_line" type="vertex_shader" input="FVFXyzNormal" language="glsl">\r\n            <![CDATA[\r\n\r\n        uniform mat4 g_WorldViewProjectionMatrix;\r\n        uniform mat4 g_matViewProj;\r\n        uniform vec4 g_viewportScale;\r\n\r\n        attribute vec3  position;\r\n        attribute vec3  normal;\r\n        //attribute vec4  color;\r\n\r\n       // varying vec4 diffuse;\r\n\r\n        void main()\r\n        {\r\n            vec4 pos = g_WorldViewProjectionMatrix * vec4(position,1.0);\r\n            vec4 nor = g_matViewProj * vec4(normal, 0);\r\n            nor = normalize(vec4(cross( vec3(nor.xy, 0), vec3( 0,0,1)), 0));\r\n            gl_Position.xy = pos.xy + nor.xy * pos.w * g_viewportScale.xy ;\r\n            gl_Position.zw = pos.zw;\r\n           // diffuse = color;\r\n        }\r\n      ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_flake_line">\r\n            <parameter name="g_color" type="vec4" count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_flake_line" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n                uniform vec4 g_color;\r\n\r\n                //varying vec4 diffuse;\r\n\r\n                void main()\r\n                {\r\n                    gl_FragColor = g_color;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--RSModel Common --\x3e\r\n        <shaderParameter name="vs_RSModelCommon">\r\n            <parameter name="UnpackModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="UnpackModelMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n            <parameter name="MinUVRange" type="vec4" count="1"/>\r\n            <parameter name="MaxUVRange" type="vec4" count="1"/>\r\n            <parameter name="LightDotUnpack" type="vec4" count="1"/>\r\n            <parameter name="TexParam" type="vec4"   count="1"/>\r\n            <parameter name="BoundayBox" type="vec4"   count="1"/>\r\n\r\n        </shaderParameter>\r\n        <shader name="vs_RSModelCommon" type="vertex_shader" input="FVFXyzwTex" language="glsl">\r\n            <![CDATA[\r\n\r\n                uniform mat4 UnpackModelViewProjectionMatrix;\r\n                uniform mat4 UnpackModelMatrix;\r\n                uniform mat4 LightColorMatrix;\r\n                uniform vec4 MinUVRange;\r\n                uniform vec4 MaxUVRange;\r\n                uniform vec4 LightDotUnpack;\r\n                uniform vec4 TexParam;\r\n                uniform vec4 BoundayBox;\r\n\r\n\r\n                attribute vec4 position;\r\n                attribute vec2 texcoord;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    lightColor = LightColorMatrix * vec4(fract(position.w * LightDotUnpack.xyz), 1.0);\r\n                    gl_Position = UnpackModelViewProjectionMatrix * vec4(position.xyz, 1.0);\r\n                    outTexcoord = mix(MinUVRange.xy, MaxUVRange.xy, texcoord);\r\n                    vec4 positionUnpack = UnpackModelMatrix * vec4(position.xyz, 1.0);\r\n                    outTexcoord = outTexcoord - vec2(0.0,0.01);\r\n                    outTexcoord2 = vec2(positionUnpack.x - BoundayBox.x, positionUnpack.y-BoundayBox.y);\r\n                    outTexcoord2 = outTexcoord2 * vec2(1.0/(BoundayBox.z-BoundayBox.x), 1.0/(BoundayBox.w-BoundayBox.y));\r\n                    outTexcoord2 = outTexcoord2*TexParam.xy + vec2(0.5, positionUnpack.z/(BoundayBox.y-BoundayBox.x))*TexParam.zw;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_RSModelCommon">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4"   count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_RSModelCommon" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform mediump vec4 vBlendColor;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    gl_FragColor.rgb = mix(vBlendColor.rgb, clr.rgb * clr2.rgb * lightColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                    if(gl_FragColor.a < 0.8){\r\n                        discard;\r\n                    }\r\n                }\r\n\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_RSModelCommon_Transparency">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4"   count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_RSModelCommon_Transparency" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform mediump vec4 vBlendColor;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    gl_FragColor.rgb = mix(vBlendColor.rgb, clr.rgb * clr2.rgb * lightColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                    if(gl_FragColor.a >= 0.8){\r\n                        discard;\r\n                    }\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n        \r\n        <shaderParameter name="ps_RSModelCommon_Blend">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4"   count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_RSModelCommon_Blend" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform mediump vec4 vBlendColor;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    gl_FragColor.rgb = mix(vBlendColor.rgb, clr.rgb * clr2.rgb * lightColor.rgb, vBlendColor.a);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--RSModel Common2 --\x3e\r\n        <shaderParameter name="vs_RSModelWithGlow">\r\n            <parameter name="UnpackModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="UnpackModelMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n            <parameter name="MinUVRange" type="vec4" count="1"/>\r\n            <parameter name="MaxUVRange" type="vec4" count="1"/>\r\n            <parameter name="LightDotUnpack" type="vec4" count="1"/>\r\n            <parameter name="TexParam" type="vec4"   count="1"/>\r\n            <parameter name="BoundayBox" type="vec4"   count="1"/>\r\n\r\n        </shaderParameter>\r\n        <shader name="vs_RSModelWithGlow" type="vertex_shader" input="FVFXyzwTex" language="glsl">\r\n            <![CDATA[\r\n\r\n                uniform mat4 UnpackModelViewProjectionMatrix;\r\n                uniform mat4 UnpackModelMatrix;\r\n                uniform mat4 LightColorMatrix;\r\n                uniform vec4 MinUVRange;\r\n                uniform vec4 MaxUVRange;\r\n                uniform vec4 LightDotUnpack;\r\n                uniform vec4 TexParam;\r\n                uniform vec4 BoundayBox;\r\n\r\n\r\n                attribute vec4 position;\r\n                attribute vec2 texcoord;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                vec3 uKeyLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n                vec3 uBackLightDir = vec3(0.5, -0.5, 0.70710677);\r\n                vec3 uFillLightDir = vec3(0.0, 0.0, -1.0);\r\n\r\n                void main()\r\n                {\r\n                    vec3 normal = vec3(fract(position.w * LightDotUnpack.xyz * 2.0)) - vec3(1.0,1.0,1.0);\r\n                    vec4 lightResult;\r\n                    lightResult.x = max(dot(normal, uKeyLightDir), 0.0);\r\n                    lightResult.y = max(dot(normal, uBackLightDir), 0.0);\r\n                    lightResult.z = max(dot(normal, uFillLightDir), 0.0);\r\n                    lightResult.w = 1.0;\r\n                    lightColor = vec4((LightColorMatrix * lightResult).xyz,1.0);\r\n                    //lightColor = LightColorMatrix * vec4(fract(position.w * LightDotUnpack.xyz), 1.0);\r\n                    gl_Position = UnpackModelViewProjectionMatrix * vec4(position.xyz, 1.0);\r\n                    outTexcoord = mix(MinUVRange.xy, MaxUVRange.xy, texcoord);\r\n                    vec4 positionUnpack = UnpackModelMatrix * vec4(position.xyz, 1.0);\r\n                    outTexcoord = outTexcoord - vec2(0.0,0.01);\r\n                    outTexcoord2 = vec2(positionUnpack.x - BoundayBox.x, positionUnpack.y-BoundayBox.y);\r\n                    outTexcoord2 = outTexcoord2 * vec2(1.0/(BoundayBox.z-BoundayBox.x), 1.0/(BoundayBox.w-BoundayBox.y));\r\n                    outTexcoord2 = outTexcoord2*TexParam.xy + vec2(0.5, positionUnpack.z/(BoundayBox.y-BoundayBox.x))*TexParam.zw;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_RSModelWithGlow">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="glowSampler" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n            <parameter name="vBlendColor" type="vec4"   count="1"/>\r\n        </shaderParameter>\r\n        <shader name="ps_RSModelWithGlow" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform sampler2D glowSampler;\r\n                uniform mediump vec4 vBlendColor;\r\n                \r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    //vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    //vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    //gl_FragColor = clr * clr2 * lightColor;\r\n                    //gl_FragColor.a = clr.a;\r\n\r\n                    vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    lowp vec3 diffuse = (clr * clr2).rgb;\r\n                    //lowp vec3 diffuse = texture2D(texSampler,outTexcoord, -1.0).rgb;\r\n                    lowp vec3 dayColour = diffuse * lightColor.rgb;\r\n\r\n                    lowp vec3 glowColor = texture2D(glowSampler,outTexcoord2, -1.0).rgb;\r\n                    lowp vec3 glow = vec3(6.0, 6.0, 6.0) * glowColor;\r\n                    lowp float luma = dot(glowColor, vec3(0.3, 0.59, 0.11));\r\n                    lowp vec3 greyscale = vec3(luma, luma, luma);\r\n                    lowp vec3 desatDiffuse = mix(greyscale, diffuse, 0.3);\r\n                    lowp vec3 nightColour = desatDiffuse * (glow + vec3(0.2, 0.2, 0.2));\r\n                    gl_FragColor.rgb = mix(dayColour, nightColour,  0.4);\r\n                    gl_FragColor.a = clr.a * vBlendColor.a;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--RSWallWithGlow --\x3e\r\n        <shaderParameter name="vs_RSWallWithGlow">\r\n            <parameter name="UnpackModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="UnpackModelMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n            <parameter name="MinUVRange" type="vec4" count="1"/>\r\n            <parameter name="MaxUVRange" type="vec4" count="1"/>\r\n            <parameter name="LightDotUnpack" type="vec4" count="1"/>\r\n            <parameter name="TexParam" type="vec4"   count="1"/>\r\n            <parameter name="BoundayBox" type="vec4"   count="1"/>\r\n\r\n        </shaderParameter>\r\n        <shader name="vs_RSWallWithGlow" type="vertex_shader" input="FVFXyzwTex" language="glsl">\r\n            <![CDATA[\r\n                uniform mat4 UnpackModelViewProjectionMatrix;\r\n                uniform mat4 UnpackModelMatrix;\r\n                uniform mat4 LightColorMatrix;\r\n                uniform vec4 MinUVRange;\r\n                uniform vec4 MaxUVRange;\r\n                uniform vec4 LightDotUnpack;\r\n                uniform vec4 TexParam;\r\n                uniform vec4 BoundayBox;\r\n\r\n\r\n                attribute vec4 position;\r\n                attribute vec2 texcoord;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                vec3 uKeyLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n                vec3 uBackLightDir = vec3(0.5, -0.5, 0.70710677);\r\n                vec3 uFillLightDir = vec3(0.0, 0.0, -1.0);\r\n\r\n                void main()\r\n                {\r\n                    vec3 normal = vec3(fract(position.w * LightDotUnpack.xyz * 2.0)) - vec3(1.0,1.0,1.0);\r\n                    vec4 lightResult;\r\n                    lightResult.x = max(dot(normal, uKeyLightDir), 0.0);\r\n                    lightResult.y = max(dot(normal, uBackLightDir), 0.0);\r\n                    lightResult.z = max(dot(normal, uFillLightDir), 0.0);\r\n                    lightResult.w = 1.0;\r\n                    lightColor = vec4((LightColorMatrix * lightResult).xyz,1.0);\r\n                    //lightColor = LightColorMatrix * vec4(fract(position.w * LightDotUnpack.xyz), 1.0);\r\n                    gl_Position = UnpackModelViewProjectionMatrix * vec4(position.xyz, 1.0);\r\n                    outTexcoord = mix(MinUVRange.xy, MaxUVRange.xy, texcoord);\r\n                    vec4 positionUnpack = UnpackModelMatrix * vec4(position.xyz, 1.0);\r\n                    outTexcoord = outTexcoord - vec2(0.0,0.01);\r\n                    outTexcoord2 = outTexcoord;\r\n                    //outTexcoord2 = vec2(positionUnpack.x - BoundayBox.x, positionUnpack.y-BoundayBox.y);\r\n                    //outTexcoord2 = outTexcoord2 * vec2(1.0/(BoundayBox.z-BoundayBox.x), 1.0/(BoundayBox.w-BoundayBox.y));\r\n                    //outTexcoord2 = outTexcoord2*TexParam.xy + vec2(0.5, positionUnpack.z/(BoundayBox.y-BoundayBox.x))*TexParam.zw;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_RSWallWithGlow">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/>\r\n            <parameter name="glowSampler" type="texture2d" index="2" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_RSWallWithGlow" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                uniform sampler2D texSampler2;\r\n                uniform sampler2D glowSampler;\r\n                \r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n\r\n                void main()\r\n                {\r\n                    //vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    //vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    //gl_FragColor = clr * clr2 * lightColor;\r\n                    //gl_FragColor.a = clr.a;\r\n\r\n                    vec4 clr = texture2D(texSampler, outTexcoord);\r\n                    vec4 clr2 = texture2D(texSampler2, outTexcoord2);\r\n                    vec4 glowColor = texture2D(glowSampler,outTexcoord2);\r\n                    lowp vec3 diffuse = (clr * clr2).rgb;\r\n                    //diffuse = mix(diffuse, glowColor.rgb, glowColor.a);\r\n                    //lowp vec3 diffuse = texture2D(texSampler,outTexcoord, -1.0).rgb;\r\n                    lowp vec3 dayColour = diffuse * lightColor.rgb;\r\n\r\n    \r\n                    lowp vec3 glow = vec3(1.6, 1.6, 1.6) * glowColor.rgb;\r\n                    lowp float luma = dot(glowColor.rgb, vec3(0.3, 0.59, 0.11));\r\n                    lowp vec3 greyscale = vec3(luma, luma, luma);\r\n                    lowp vec3 desatDiffuse = mix(greyscale, diffuse, 0.6); //greyscale * diffuse;\r\n                    lowp vec3 nightColour = desatDiffuse * (glow + vec3(0.2, 0.2, 0.2));\r\n                    gl_FragColor.rgb = mix(dayColour, nightColour.rgb, glowColor.a);\r\n                    gl_FragColor.a = clr.a;\r\n                }\r\n\r\n            ]]\x3e\r\n        </shader>\r\n\r\n\r\n        <shaderParameter name="vs_RSShadowMapGen">\r\n            <parameter name="UnpackModelViewProjectionMatrix" type="mat4" count="1"/>\r\n            <parameter name="UnpackModelMatrix" type="mat4" count="1"/>\r\n            <parameter name="LightColorMatrix" type="mat4" count="1"/>\r\n            <parameter name="MinUVRange" type="vec4" count="1"/>\r\n            <parameter name="MaxUVRange" type="vec4" count="1"/>\r\n            <parameter name="LightDotUnpack" type="vec4" count="1"/>\r\n            <parameter name="TexParam" type="vec4"   count="1"/>\r\n            <parameter name="BoundayBox" type="vec4"   count="1"/>\r\n\r\n        </shaderParameter>\r\n        <shader name="vs_RSShadowMapGen" type="vertex_shader" input="FVFXyzwTex" language="glsl">\r\n            <![CDATA[\r\n\r\n                uniform mat4 UnpackModelViewProjectionMatrix;\r\n                uniform mat4 UnpackModelMatrix;\r\n                uniform mat4 LightColorMatrix;\r\n                uniform vec4 MinUVRange;\r\n                uniform vec4 MaxUVRange;\r\n                uniform vec4 LightDotUnpack;\r\n                uniform vec4 TexParam;\r\n                uniform vec4 BoundayBox;\r\n\r\n                attribute vec4 position;\r\n                attribute vec2 texcoord;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n                varying vec4 unpackPosition;\r\n\r\n                vec3 uKeyLightDir = vec3(-0.5, 0.5, -0.70710677);\r\n                vec3 uBackLightDir = vec3(0.5, -0.5, 0.70710677);\r\n                vec3 uFillLightDir = vec3(0.0, 0.0, -1.0);\r\n\r\n                void main()\r\n                {\r\n                    unpackPosition = UnpackModelMatrix * vec4(position.xyz, 1.0);\r\n                    //vec3 normal = vec3(fract(position.w * LightDotUnpack.xyz * 2.0)) - vec3(1.0,1.0,1.0);\r\n                    //vec4 lightResult;\r\n                    //lightResult.x = max(dot(normal, uKeyLightDir), 0.0);\r\n                    //lightResult.y = max(dot(normal, uBackLightDir), 0.0);\r\n                    //lightResult.z = max(dot(normal, uFillLightDir), 0.0);\r\n                    //lightResult.w = 1.0;\r\n                    //lightColor = vec4((LightColorMatrix * lightResult).xyz,1.0);\r\n                    lightColor = LightColorMatrix * vec4(fract(position.w * LightDotUnpack.xyz), 1.0);\r\n                    gl_Position = UnpackModelViewProjectionMatrix * vec4(position.xyz, 1.0);\r\n                    outTexcoord = mix(MinUVRange.xy, MaxUVRange.xy, texcoord);\r\n                    vec4 positionUnpack = UnpackModelMatrix * vec4(position.xyz, 1.0);\r\n                    outTexcoord = outTexcoord - vec2(0.0,0.01);\r\n                    outTexcoord2 = vec2(positionUnpack.x - BoundayBox.x, positionUnpack.y-BoundayBox.y);\r\n                    outTexcoord2 = outTexcoord2 * vec2(1.0/(BoundayBox.z-BoundayBox.x), 1.0/(BoundayBox.w-BoundayBox.y));\r\n                    outTexcoord2 = outTexcoord2*TexParam.xy + vec2(0.5, positionUnpack.z/(BoundayBox.y-BoundayBox.x))*TexParam.zw;\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n         <shaderParameter name="ps_RSShadowMapGen">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            \x3c!-- <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/> --\x3e\r\n        </shaderParameter>\r\n        <shader name="ps_RSShadowMapGen" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                //uniform sampler2D texSampler2;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n                varying vec4 unpackPosition;\r\n\r\n                void main()\r\n                {\r\n                    if( unpackPosition.z < -1.0 ) {\r\n                        discard;\r\n                    }\r\n                    vec4 clr2 = texture2D(texSampler, outTexcoord);\r\n                    vec4 clr = vec4(0.1, 0.1, 0.1, clr2.a) * lightColor;\r\n                    //vec4 clr = vec4(1.0, 1.0, 1.0, clr2.a) * lightColor;\r\n                    gl_FragColor = clr;\r\n                }\r\n\r\n            ]]\x3e\r\n        </shader>\r\n        <shaderParameter name="ps_RSGlowMapGen">\r\n            <parameter name="texSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n            \x3c!-- <parameter name="texSampler2" type="texture2d" index="1" sampler="samplerTerrainClamp"/> --\x3e\r\n        </shaderParameter>\r\n        <shader name="ps_RSGlowMapGen" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision mediump float;\r\n\r\n                uniform sampler2D texSampler;\r\n                //uniform sampler2D texSampler2;\r\n\r\n                varying vec2 outTexcoord;\r\n                varying vec2 outTexcoord2;\r\n                varying vec4 lightColor;\r\n                varying vec4 unpackPosition;\r\n\r\n                void main()\r\n                {\r\n                    if( unpackPosition.z < -1.0 ) {\r\n                        discard;\r\n                    }\r\n                    vec4 clr2 = texture2D(texSampler, outTexcoord);\r\n                    //vec4 clr = vec4(0.3, 0.1, 0.1, clr2.a) * lightColor;\r\n                    vec4 clr = vec4(1.0, 1.0, 1.0, clr2.a) * lightColor;\r\n                    gl_FragColor = clr;\r\n                }\r\n\r\n            ]]\x3e\r\n        </shader>\r\n\r\n\r\n        \x3c!--blurShadowMap Shader--\x3e\r\n        <shaderParameter name="vs_blurShadowMap">\r\n        </shaderParameter>\r\n        <shader name="vs_blurShadowMap" type="vertex_shader" input="FVFXyz" language="glsl">\r\n            <![CDATA[\r\n              precision mediump float;\r\n              attribute vec2 position;\r\n              varying vec2 vUv;\r\n\r\n              void main()\r\n              {\r\n                  gl_Position = vec4(position.x * 2.0 - 1.0, position.y * 2.0 - 1.0, 0.0, 1.0);\r\n                  vUv = position.xy;\r\n              }\r\n       ]]\x3e\r\n        </shader>\r\n\r\n         <shaderParameter name="ps_blurShadowMap">\r\n            <parameter name="uBlurParam" type="vec4" count="1"/>\r\n            <parameter name="uTextureDimension" type="vec4"   count="1"/>\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_blurShadowMap" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n                precision highp float;\r\n                uniform vec4 uBlurParam;\r\n                uniform vec4 uTextureDimension;\r\n                uniform sampler2D uSampler;\r\n                varying vec2 vUv;\r\n                vec4 blur(int diameter, sampler2D sampler, vec2 texCoord, float width, float height){\r\n                    const float PI = 3.14159265;\r\n                    const int maxBlur = 41;\r\n                    if(mod(float(diameter), 2.0) == 0.0){\r\n                        diameter++;\r\n                    }\r\n                    if(diameter > maxBlur){\r\n                        diameter = maxBlur;\r\n                    }\r\n                    int center = (diameter - 1) / 2;\r\n\r\n                    float sita = pow(float(diameter) / 6.0, 2.0);\r\n                    float radio = sqrt(0.5 / PI / sita);\r\n                    float sum = 0.0;\r\n                    vec4 sumVec4 = vec4(0.0);\r\n\r\n                    for(int i = 0; i < maxBlur; i++) if(i<center + 1){\r\n                        float weight =  radio * exp(-pow(float(i), 2.0) / sita / 2.0);\r\n                        float ii = float(i);\r\n                        if(i == 0){\r\n                            // \u53d6\u4e2d\u5fc3\u70b9\r\n                            vec4 color = texture2D(sampler, texCoord);\r\n                            sumVec4 += color * weight;\r\n                            sum += weight;\r\n                        }else{\r\n                            // \u5de6\u8fb9\r\n                            vec4 left = texture2D(sampler, vec2( texCoord.x - ii/width, texCoord.y));\r\n                            // \u53f3\u8fb9 \r\n                            vec4 right = texture2D(sampler, vec2( texCoord.x + ii/width, texCoord.y));\r\n                            sumVec4 += left * weight;\r\n                            sumVec4 += right * weight;\r\n                            sum += 2.0 * weight;\r\n                        }\r\n                    }\r\n                    return vec4(sumVec4.r/sum, sumVec4.g/sum, sumVec4.b/sum, sumVec4.a/sum);\r\n                }\r\n                void main()\r\n                {\r\n                    gl_FragColor = blur(int(uBlurParam.x), uSampler, vUv + uTextureDimension.xy, uTextureDimension.z, uTextureDimension.w);\r\n                }\r\n            ]]\x3e\r\n        </shader>\r\n\r\n        <shaderParameter name="ps_blurShadowMap2">\r\n            <parameter name="uBlurParam" type="vec4" count="1"/>\r\n            <parameter name="uTextureDimension" type="vec4" count="1"/>\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_blurShadowMap2" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n            precision highp float;\r\n            uniform vec4 uBlurParam;\r\n            uniform vec4 uTextureDimension;\r\n            uniform sampler2D uSampler;\r\n            varying vec2 vUv;\r\n\r\n\r\n            vec4 blur(int diameter, sampler2D sampler, vec2 texCoord, float width,float height)\r\n            {\r\n                const float PI = 3.14159265;\r\n                const int maxBlur = 41;\r\n\r\n                if(mod(float(diameter), 2.0) == 0.0){\r\n                    diameter++;\r\n                }\r\n                if(diameter > maxBlur){\r\n                    diameter = maxBlur;\r\n                }\r\n                int center = (diameter - 1) / 2;\r\n\r\n                float sita = pow(float(diameter) / 6.0, 2.0);\r\n                float radio = sqrt(0.5 / PI / sita);\r\n                float sum = 0.0;\r\n                vec4 sumVec4 = vec4(0.0);\r\n\r\n                for(int i = 0; i < maxBlur; i++) if(i<center + 1){\r\n                    float weight =  radio * exp(-pow(float(i), 2.0) / sita / 2.0);\r\n                    float ii = float(i);\r\n                    if(i == 0){\r\n                        // \u53d6\u4e2d\u5fc3\u70b9\r\n                        vec4 color = texture2D(sampler, texCoord);\r\n                        sumVec4 += color * weight;\r\n                        sum += weight;\r\n                    }else{\r\n                        // \u53d6\u4e0a\r\n                        vec4 left = texture2D(sampler, vec2( texCoord.x, texCoord.y - ii/height));\r\n                        // \u53d6\u4e0b\r\n                        vec4 right = texture2D(sampler, vec2( texCoord.x, texCoord.y + ii/height));\r\n                        sumVec4 += left * weight;\r\n                        sumVec4 += right * weight;\r\n                        sum += 2.0 * weight;\r\n                    }\r\n\r\n                }\r\n                return vec4(sumVec4.r/sum, sumVec4.g/sum, sumVec4.b/sum, sumVec4.a/sum);\r\n            }\r\n            void main()\r\n            {\r\n                gl_FragColor = blur(int(uBlurParam.x), uSampler, vUv + uTextureDimension.xy, uTextureDimension.z, uTextureDimension.w);\r\n            }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n         <shaderParameter name="ps_blurShadowMap3">\r\n            <parameter name="uBlurParam" type="vec4" count="1"/>\r\n            <parameter name="uTextureDimension" type="vec4" count="1"/>\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_blurShadowMap3" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n            precision highp float;\r\n            uniform vec4 uBlurParam;\r\n            uniform vec4 uTextureDimension;\r\n            uniform sampler2D uSampler;\r\n            varying vec2 vUv;\r\n\r\n\r\n            vec4 blur(int diameter, sampler2D sampler, vec2 texCoord, float width,float height)\r\n            {\r\n                const float PI = 3.14159265;\r\n                const int maxBlur = 41;\r\n\r\n                if(mod(float(diameter), 2.0) == 0.0){\r\n                    diameter++;\r\n                }\r\n                if(diameter > maxBlur){\r\n                    diameter = maxBlur;\r\n                }\r\n                int center = (diameter - 1) / 2;\r\n\r\n                float sita = pow(float(diameter) / 6.0, 2.0);\r\n                float radio = sqrt(0.5 / PI / sita);\r\n                float sum = 0.0;\r\n                vec4 sumVec4 = vec4(0.0);\r\n\r\n                for(int i = 0; i < maxBlur; i++) if(i<center + 1){\r\n                    float weight =  radio * exp(-pow(float(i), 2.0) / sita / 2.0);\r\n                    float ii = float(i);\r\n                    if(i == 0){\r\n                        // \u53d6\u4e2d\u5fc3\u70b9\r\n                        vec4 color = texture2D(sampler, texCoord);\r\n                        sumVec4 += color * weight;\r\n                        sum += weight;\r\n                    }else{\r\n                        // \u53d6\u4e0a\r\n                        vec4 left = texture2D(sampler, vec2( texCoord.x - ii/width, texCoord.y - ii/height));\r\n                        // \u53d6\u4e0b\r\n                        vec4 right = texture2D(sampler, vec2( texCoord.x + ii/width, texCoord.y + ii/height));\r\n                        sumVec4 += left * weight;\r\n                        sumVec4 += right * weight;\r\n                        sum += 2.0 * weight;\r\n                    }\r\n\r\n                }\r\n                return vec4(sumVec4.r/sum, sumVec4.g/sum, sumVec4.b/sum, sumVec4.a/sum);\r\n            }\r\n            void main()\r\n            {\r\n                gl_FragColor = blur(int(uBlurParam.x), uSampler, vUv + uTextureDimension.xy, uTextureDimension.z, uTextureDimension.w);\r\n            }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n         <shaderParameter name="ps_blurShadowMap4">\r\n            <parameter name="uBlurParam" type="vec4" count="1"/>\r\n            <parameter name="uTextureDimension" type="vec4" count="1"/>\r\n            <parameter name="uSampler" type="texture2d" index="0" sampler="samplerTerrainClamp"/>\r\n        </shaderParameter>\r\n        <shader name="ps_blurShadowMap4" type="pixel_shader" language="glsl">\r\n            <![CDATA[\r\n            precision highp float;\r\n            uniform vec4 uBlurParam;\r\n            uniform vec4 uTextureDimension;\r\n            uniform sampler2D uSampler;\r\n            varying vec2 vUv;\r\n\r\n\r\n            vec4 blur(int diameter, sampler2D sampler, vec2 texCoord, float width,float height)\r\n            {\r\n                const float PI = 3.14159265;\r\n                const int maxBlur = 41;\r\n\r\n                if(mod(float(diameter), 2.0) == 0.0){\r\n                    diameter++;\r\n                }\r\n                if(diameter > maxBlur){\r\n                    diameter = maxBlur;\r\n                }\r\n                int center = (diameter - 1) / 2;\r\n\r\n                float sita = pow(float(diameter) / 6.0, 2.0);\r\n                float radio = sqrt(0.5 / PI / sita);\r\n                float sum = 0.0;\r\n                vec4 sumVec4 = vec4(0.0);\r\n\r\n                for(int i = 0; i < maxBlur; i++) if(i<center + 1){\r\n                    float weight =  radio * exp(-pow(float(i), 2.0) / sita / 2.0);\r\n                    float ii = float(i);\r\n                    if(i == 0){\r\n                        // \u53d6\u4e2d\u5fc3\u70b9\r\n                        vec4 color = texture2D(sampler, texCoord);\r\n                        sumVec4 += color * weight;\r\n                        sum += weight;\r\n                    }else{\r\n                        // \u53d6\u4e0a\r\n                        vec4 left = texture2D(sampler, vec2( texCoord.x - ii/width, texCoord.y + ii/height));\r\n                        // \u53d6\u4e0b\r\n                        vec4 right = texture2D(sampler, vec2( texCoord.x + ii/width, texCoord.y - ii/height));\r\n                        sumVec4 += left * weight;\r\n                        sumVec4 += right * weight;\r\n                        sum += 2.0 * weight;\r\n                    }\r\n\r\n                }\r\n                return vec4(sumVec4.r/sum, sumVec4.g/sum, sumVec4.b/sum, sumVec4.a/sum);\r\n            }\r\n            void main()\r\n            {\r\n                gl_FragColor = blur(int(uBlurParam.x), uSampler, vUv + uTextureDimension.xy, uTextureDimension.z, uTextureDimension.w);\r\n            }\r\n      ]]\x3e\r\n        </shader>\r\n\r\n        \x3c!--Technique--\x3e\r\n        \x3c!--Universe Technique(T0)--\x3e\r\n        <technique name="OpaqueDepth_Universe">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_universe"/>\r\n                <state name="pixel_shader" value="ps_universe"/>\r\n            </pass>\r\n        </technique>\r\n\r\n\r\n        \x3c!--Technique--\x3e\r\n        \x3c!--Canvas Technique(T1)--\x3e\r\n        <technique name="OpaqueDepth_Canvas">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_canvas"/>\r\n                <state name="pixel_shader" value="ps_canvas"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--SkyFromAtmosphere Technique(T2)--\x3e\r\n        <technique name="OpaqueDepth_SkyFromAtmosphere">\r\n            <pass name="p0">\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="vertex_shader" value="vs_sky_atmosphere"/>\r\n                <state name="pixel_shader" value="ps_sky_atmosphere"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--SkyFromSpace Technique(T3)--\x3e\r\n        <technique name="OpaqueDepth_SkyFromSpace">\r\n            <pass name="p0">\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="vertex_shader" value="vs_sky_space"/>\r\n                <state name="pixel_shader" value="ps_sky_space"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T4)--\x3e\r\n        <technique name="OpaqueDepth_Terrain">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_terrain"/>\r\n                <state name="pixel_shader" value="ps_terrain_1"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T5)--\x3e\r\n        <technique name="OpaqueDepth_Model">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_model"/>\r\n                <state name="pixel_shader" value="ps_model"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T6)--\x3e\r\n        <technique name="OpaqueDepth_Polyline">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_polyline"/>\r\n                <state name="pixel_shader" value="ps_polyline"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T7)--\x3e\r\n        <technique name="OpaqueDepth_Polyline2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_polyline2"/>\r\n                <state name="pixel_shader" value="ps_polyline2"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Reproject Technique(T8)--\x3e\r\n        <technique name="OpaqueDepth_Reproject">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="one"/>\r\n                <state name="dest_blend" value="zero"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_reprojectMercator"/>\r\n                <state name="pixel_shader" value="ps_reprojectMercator"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T9)--\x3e\r\n        <technique name="OpaqueDepth_Terrain2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_terrain"/>\r\n                <state name="pixel_shader" value="ps_terrain_2"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T10)--\x3e\r\n        <technique name="OpaqueDepth_Terrain3">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_terrain"/>\r\n                <state name="pixel_shader" value="ps_terrain_3"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T11)--\x3e\r\n        <technique name="OpaqueDepth_Terrain4">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_terrain"/>\r\n                <state name="pixel_shader" value="ps_terrain_4"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T12)--\x3e\r\n        <technique name="OpaqueDepth_Terrain5">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_terrain"/>\r\n                <state name="pixel_shader" value="ps_terrain_5"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T13)--\x3e\r\n        <technique name="OpaqueDepth_Terrain6">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_terrain"/>\r\n                <state name="pixel_shader" value="ps_terrain_6"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T14)--\x3e\r\n        <technique name="OpaqueDepth_Terrain7">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_terrain"/>\r\n                <state name="pixel_shader" value="ps_terrain_7"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T15)--\x3e\r\n        <technique name="OpaqueDepth_Terrain8">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_terrain"/>\r\n                <state name="pixel_shader" value="ps_terrain_8"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T16)--\x3e\r\n        <technique name="OpaqueDepth_Model2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_model2"/>\r\n                <state name="pixel_shader" value="ps_model2"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T17)--\x3e\r\n        <technique name="OpaqueDepth_Model3">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_model3"/>\r\n                <state name="pixel_shader" value="ps_model2"/>\r\n            </pass>\r\n        </technique>\r\n\r\n\r\n        \x3c!--Terrain Technique(T18)--\x3e\r\n        <technique name="OpaqueDepth_RecceModel">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                \x3c!-- <state name="src_blend" value="one"/>\r\n                <state name="dest_blend" value="zero"/> --\x3e\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_recceModel"/>\r\n                <state name="pixel_shader" value="ps_recceModel"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T19)--\x3e\r\n        <technique name="OpaqueDepth_RecceModel_Shadow">\r\n            <pass name="p0">\r\n                \x3c!--<state name="cull_mode"                 value="none"/>--\x3e\r\n                \x3c!--<state name="depth_enable"              value="true"/>--\x3e\r\n                \x3c!--<state name="depth_write_mask"          value="0"/>--\x3e\r\n                \x3c!--<state name="color_write_mask"          value="0"/>--\x3e\r\n                \x3c!--<state name="stencil_enable"            value="true"/>--\x3e\r\n                \x3c!--<state name="two_sided_stencil_enable"  value="true"/>--\x3e\r\n                \x3c!--<state name="stencil_func"              value="always"/>--\x3e\r\n                \x3c!--<state name="ccw_stencil_func"          value="always"/>--\x3e\r\n                \x3c!--<state name="ccw_stencil_pass_op"       value="incr"/>--\x3e\r\n                \x3c!--<state name="stencil_pass_op"           value="decr"/>--\x3e\r\n                <state name="vertex_shader" value="vs_recceModelShadow"/>\r\n                <state name="pixel_shader" value="ps_recceModelShadow"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T20)--\x3e\r\n        <technique name="OpaqueDepth_ShadowVolumeFill">\r\n            <pass name="p0">\r\n                \x3c!--<state name="blend_enable" value="false"/>--\x3e\r\n                \x3c!--<state name="src_blend" value="src_alpha"/>--\x3e\r\n                \x3c!--<state name="dest_blend" value="inv_src_alpha"/>--\x3e\r\n                \x3c!--<state name="depth_enable" value="true"/>--\x3e\r\n                \x3c!--<state name="depth_write_mask" value="1"/>--\x3e\r\n                \x3c!--<state name="cull_mode" value="none"/>--\x3e\r\n                <state name="vertex_shader" value="vs_shadowVolumeFill"/>\r\n                <state name="pixel_shader" value="ps_shadowVolumeFill"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T21)--\x3e\r\n        <technique name="OpaqueDepth_RecceModelWater">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_recceModelWater"/>\r\n                <state name="pixel_shader" value="ps_recceModelWater"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T22)--\x3e\r\n        <technique name="OpaqueDepth_RecceGround">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="false"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_recceGround"/>\r\n                <state name="pixel_shader" value="ps_recceGround"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T23)--\x3e\r\n        <technique name="OpaqueDepth_Model_normal">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_json_model_normal"/>\r\n                <state name="pixel_shader" value="ps_json_model_normal"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T24)--\x3e\r\n        <technique name="OpaqueDepth_Polyline">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_polyline"/>\r\n                <state name="pixel_shader" value="ps_polyline"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T25)--\x3e\r\n        <technique name="OpaqueDepth_Polyline2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_polyline2"/>\r\n                <state name="pixel_shader" value="ps_polyline2"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T26)--\x3e\r\n        <technique name="OpaqueDepth_RecceModel_Shadow2">\r\n            <pass name="p0">\r\n                \x3c!--<state name="cull_mode"                 value="none"/>--\x3e\r\n                \x3c!--<state name="depth_enable"              value="true"/>--\x3e\r\n                \x3c!--<state name="depth_write_mask"          value="0"/>--\x3e\r\n                \x3c!--<state name="color_write_mask"          value="0"/>--\x3e\r\n                \x3c!--<state name="stencil_enable"            value="true"/>--\x3e\r\n                \x3c!--<state name="two_sided_stencil_enable"  value="true"/>--\x3e\r\n                \x3c!--<state name="stencil_func"              value="always"/>--\x3e\r\n                \x3c!--<state name="ccw_stencil_func"          value="always"/>--\x3e\r\n                \x3c!--<state name="ccw_stencil_pass_op"       value="incr"/>--\x3e\r\n                \x3c!--<state name="stencil_pass_op"           value="decr"/>--\x3e\r\n                <state name="vertex_shader" value="vs_recceModelShadow2"/>\r\n                <state name="pixel_shader" value="ps_recceModelShadow"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T27)--\x3e\r\n        <technique name="OpaqueDepth_Flake_line">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_flake_line"/>\r\n                <state name="pixel_shader" value="ps_flake_line"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T28)--\x3e\r\n        <technique name="OpaqueDepth_Model4">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_model4"/>\r\n                <state name="pixel_shader" value="ps_model4"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T29)--\x3e\r\n        <technique name="OpaqueDepth_Polygon">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_polygon"/>\r\n                <state name="pixel_shader" value="ps_polygon"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T30)--\x3e\r\n        <technique name="OpaqueDepth_Polygon2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_polygon"/>\r\n                <state name="pixel_shader" value="ps_polygon"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T31)--\x3e\r\n        <technique name="OpaqueDepth_RecceModel_Transparency">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                \x3c!-- <state name="src_blend" value="one"/> --\x3e\r\n                \x3c!-- <state name="dest_blend" value="one"/> --\x3e\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_recceModel"/>\r\n                <state name="pixel_shader" value="ps_recceModel_Transparency"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T32)--\x3e\r\n        <technique name="OpaqueDepth_Textured_Polyline">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_textured_polyline"/>\r\n                <state name="pixel_shader" value="ps_polygon"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T33)--\x3e\r\n        <technique name="OpaqueDepth_Textured_Polyline2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_textured_polyline"/>\r\n                <state name="pixel_shader" value="ps_polygon"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T34)--\x3e\r\n        <technique name="OpaqueDepth_Volume_Polyline">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="vertex_shader" value="vs_volume_polyline"/>\r\n                <state name="pixel_shader" value="ps_polyline3"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T35)--\x3e\r\n        <technique name="OpaqueDepth_Compass">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                \x3c!--<state name="depth_write_mask" value="1"/>--\x3e\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_compass"/>\r\n                <state name="pixel_shader" value="ps_compass"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T36)--\x3e\r\n        <technique name="OpaqueDepth_RSModelCommon">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="vertex_shader" value="vs_RSModelCommon"/>\r\n                <state name="pixel_shader" value="ps_RSModelCommon"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T37)--\x3e\r\n\x3c!--         <technique name="OpaqueDepth_FontRenderWisthBlur">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="vertex_shader" value="vs_canvas"/>\r\n                <state name="pixel_shader" value="ps_canvas"/>\r\n            </pass>\r\n        </technique> --\x3e\r\n        <technique name="OpaqueDepth_FontRenderWithBlur">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_text_with_blur"/>\r\n                <state name="pixel_shader" value="ps_text_with_blur"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T38)--\x3e\r\n        <technique name="OpaqueDepth_RSShadowMapGen">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_RSShadowMapGen"/>\r\n                <state name="pixel_shader" value="ps_RSShadowMapGen"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Blur ShadowMap Technique(T39)--\x3e\r\n        <technique name="OpaqueDepth_blurShadowMap">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="one"/>\r\n                <state name="dest_blend" value="zero"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_blurShadowMap"/>\r\n                <state name="pixel_shader" value="ps_blurShadowMap"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Blur ShadowMap2 Technique(T40)--\x3e\r\n        <technique name="OpaqueDepth_blurShadowMap2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="one"/>\r\n                <state name="dest_blend" value="zero"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_blurShadowMap"/>\r\n                <state name="pixel_shader" value="ps_blurShadowMap2"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \r\n        \x3c!--Textured Volume Technique(T41)--\x3e\r\n        <technique name="OpaqueDepth_TexturedVolume">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_textured_volume"/>\r\n                <state name="pixel_shader" value="ps_textured_volume"/>\r\n            </pass>\r\n        </technique>\r\n\r\n\r\n\r\n\r\n        \x3c!--Textured Volume With ShadowMap Technique(T42)--\x3e\r\n        <technique name="OpaqueDepth_TexturedVolumeShadow">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_textured_volume_shadow_map"/>\r\n                <state name="pixel_shader" value="ps_textured_volume_shadow_map"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Textured Volume With ShadowMap Technique(T43)--\x3e\r\n        <technique name="OpaqueDepth_TexturedVolumeShadowGen">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_textured_volume"/>\r\n                <state name="pixel_shader" value="ps_textured_volume_shadow_map_gen"/>\r\n            </pass>\r\n        </technique>\r\n        \r\n        \x3c!--Textured Volume With ShadowMap Technique(T44)--\x3e\r\n        <technique name="OpaqueDepth_VolumePolygonOutline">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_textured_volume"/>\r\n                <state name="pixel_shader" value="ps_textured_volume"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Terrain Technique(T45)--\x3e\r\n        <technique name="OpaqueDepth_RSModelWithGlow">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="vertex_shader" value="vs_RSModelWithGlow"/>\r\n                <state name="pixel_shader" value="ps_RSModelWithGlow"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T46)--\x3e\r\n        <technique name="OpaqueDepth_RSGlowMapGen">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="vertex_shader" value="vs_RSShadowMapGen"/>\r\n                <state name="pixel_shader" value="ps_RSGlowMapGen"/>\r\n            </pass>\r\n        </technique>\r\n        \x3c!--Terrain Technique(T47)--\x3e\r\n        <technique name="OpaqueDepth_RSWallWithGlow">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="vertex_shader" value="vs_RSWallWithGlow"/>\r\n                <state name="pixel_shader" value="ps_RSWallWithGlow"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Textured Volume Technique(T48)--\x3e\r\n        <technique name="OpaqueDepth_TexturedVolume2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_textured_volume2"/>\r\n                <state name="pixel_shader" value="ps_textured_volume2"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Blur ShadowMap3 Technique(T49)--\x3e\r\n        <technique name="OpaqueDepth_blurShadowMap">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="one"/>\r\n                <state name="dest_blend" value="zero"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_blurShadowMap"/>\r\n                <state name="pixel_shader" value="ps_blurShadowMap3"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Blur ShadowMap4 Technique(T50)--\x3e\r\n        <technique name="OpaqueDepth_blurShadowMap2">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="one"/>\r\n                <state name="dest_blend" value="zero"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_blurShadowMap"/>\r\n                <state name="pixel_shader" value="ps_blurShadowMap4"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Gltf Model Opaque Technique(T51)--\x3e\r\n        <technique name="OpaqueDepth_GltfModelOpaque">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_gltf_model"/>\r\n                <state name="pixel_shader" value="ps_gltf_model"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Gltf Model Transparency Technique(T52)--\x3e\r\n        <technique name="OpaqueDepth_GltfModelTransparency">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="false"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="none"/>\r\n                <state name="vertex_shader" value="vs_gltf_model"/>\r\n                <state name="pixel_shader" value="ps_gltf_model_transparency"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Gltf Model Shadow Technique(T53)--\x3e\r\n        <technique name="OpaqueDepth_GltfModelShadow">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_gltf_model"/>\r\n                <state name="pixel_shader" value="ps_textured_volume_shadow_map_gen"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--OpaqueDepth_RSModelCommon_Transparency Technique(T54)--\x3e\r\n        <technique name="OpaqueDepth_RSModelCommon_Transparency">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="0"/>\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="vertex_shader" value="vs_RSModelCommon"/>\r\n                <state name="pixel_shader" value="ps_RSModelCommon_Transparency"/>\r\n            </pass>\r\n        </technique>\r\n        \r\n         \x3c!--OpaqueDepth RSModelCommon Blend Technique(T55)--\x3e\r\n        <technique name="OpaqueDepth_RSModelCommon_Blend">\r\n            <pass name="p0">\r\n       <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="front"/>\r\n                <state name="vertex_shader" value="vs_RSModelCommon"/>\r\n                <state name="pixel_shader" value="ps_RSModelCommon_Blend"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--OpaqueDepth RecceModel Blend Technique(T56)--\x3e\r\n        <technique name="OpaqueDepth_RecceModel_Blend">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                \x3c!-- <state name="src_blend" value="one"/> --\x3e\r\n                \x3c!-- <state name="dest_blend" value="one"/> --\x3e\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_recceModel"/>\r\n                <state name="pixel_shader" value="ps_recceModel_Blend"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--OpaqueDepth Parametric Color Patch Blend Technique(T57)--\x3e\r\n        <technique name="OpaqueDepth_ParametricColorPatch_Blend">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_textured_volume"/>\r\n                <state name="pixel_shader" value="ps_parametric_color_patch_blend"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--OpaqueDepth Parametric Color Patch ShadowMap Blend Technique(T58)--\x3e\r\n        <technique name="OpaqueDepth_ParametricColorPatch_ShadowMap_Blend">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_textured_volume_shadow_map"/>\r\n                <state name="pixel_shader" value="ps_parametric_color_patch_shadowmap_blend"/>\r\n            </pass>\r\n        </technique>\r\n\r\n        \x3c!--Gltf Model Blend Technique(T59)--\x3e\r\n        <technique name="OpaqueDepth_GltfModelBlend">\r\n            <pass name="p0">\r\n                <state name="blend_enable" value="true"/>\r\n                <state name="src_blend" value="src_alpha"/>\r\n                <state name="dest_blend" value="inv_src_alpha"/>\r\n                <state name="depth_enable" value="true"/>\r\n                <state name="depth_write_mask" value="1"/>\r\n                <state name="cull_mode" value="back"/>\r\n                <state name="vertex_shader" value="vs_gltf_model"/>\r\n                <state name="pixel_shader" value="ps_gltf_model_blend"/>\r\n            </pass>\r\n        </technique>\r\n\r\n    </effect>\r\n</Xml>\r\n'}});
definejs("Renderer/RenderEffectManager",["Framework/ConfigOptions","Renderer/RenderEffect","Renderer/RenderTechnique","Framework/shader"],function(b,a,d,c){function e(a,b){null===b.blendState&&(b.blendState=a.createBlendState());return b.blendState}function h(a,b){null===b.depthStencilState&&(b.depthStencilState=a.createDepthStencilState());return b.depthStencilState}function l(a,b,c){if(null===a||void 0===a)return c;a=a.getAttribute(b);return null===a?c:a}function g(a,b){return"zero"===b?a.ZERO:
"one"===b?a.ONE:"src_color"===b?a.SRC_COLOR:"inv_src_color"===b?a.ONE_MINUS_SRC_COLOR:"src_alpha"===b?a.SRC_ALPHA:"inv_src_alpha"===b?a.ONE_MINUS_SRC_ALPHA:"dest_color"===b?a.DST_COLOR:"inv_dest_color"===b?a.ONE_MINUS_DST_COLOR:"dest_alpha"===b?a.DST_ALPHA:"inv_dest_alpha"===b?a.ONE_MINUS_DST_ALPHA:a.ZERO}function k(a,b,c){var d=b.shaderProgram,e=b.matrixUniforms,g=b.vectorUniforms,k=b.floatUniforms,h=b.boolUniforms;b=b.samplerUniforms;for(var l=0;l<c.length;l++){var n=c[l];"mat4"===n.type?e.push(a.getUniformLocation(d,
n.name)):"vec4"===n.type||"float4"===n.type?g.push(a.getUniformLocation(d,n.name)):"float"===n.type?k.push(a.getUniformLocation(d,n.name)):"bool"===n.type?h.push(a.getUniformLocation(d,n.name)):"texture2d"===n.type?b.push(a.getUniformLocation(d,n.name)):"textureCube"===n.type&&b.push(a.getUniformLocation(d,n.name))}}var n=function(){this.effects=[]};n.prototype.addEffect=function(a){this.effects.push(a)};n.prototype.getEffect=function(a){return this.effects[a]};n.prototype.createEffect=function(b){for(var c=
this.effects,d=null,e=0;e<c.length;e++)if(d=c[e],d.name===b)return d;d=new a;d.name=b;c.push(d);return d};n.prototype.loadXML=function(a,b){var c=Base64.decode(effectStringBase64);return XmlStringPrarser(c)};n.prototype.loadXMLFromFile=function(a,d){var e=null,g=!0,p=null!=d;if(b.useWorkerContent&&c)return e=(new DOMParser).parseFromString(c.xml,"text/xml");if(p&&"function"!=typeof d)return null;try{e=new ActiveXObject("Microsoft.XMLDOM")}catch(k){}if(null==e)try{e=document.implementation.createDocument("",
"",null)}catch(r){}if(null==e)return null;if(e.async=p)window.ActiveXObject?e.onreadystatechange=function(){if(4==e.readyState){var a=!1;null!=e.parseError&&(a=0!=e.parseError.errorCode);d(e,a)}}:e.onload=function(){d(e,!1)};try{e.load(a)}catch(h){g=!0,e=null}if(g){var n=new XMLHttpRequest;if(p){n.onreadystatechange=function(){4==n.readyState&&d(n.responseXML,200!=n.status)};n.open("GET",a,!0);try{n.send(null)}catch(l){return d(null,!0),null}return n}n.open("GET",a,!1);n.send(null);e=n.responseXML}return e};
n.prototype.loadEffect=function(a,b){for(var c=this.loadXMLFromFile(b,null),n=c.documentElement.getElementsByTagName("effect")[0].getAttribute("name"),n=this.createEffect(n),p=c.getElementsByTagName("inputLayout"),s=0;s<p.length;s++){for(var r=p[s],z=r.getAttribute("name"),t=[],w=r.getElementsByTagName("attribute"),r=0;r<w.length;r++){var u=w[r].getAttribute("name");t.push(u)}n.addInputLayoutDesc(z,t)}p=c.getElementsByTagName("shaderParameter");for(s=0;s<p.length;s++){z=p[s];t=z.getAttribute("name");
w=[];u=z.getElementsByTagName("parameter");for(r=0;r<u.length;r++){var v=u[r],A={};A.name=v.getAttribute("name");A.type=v.getAttribute("type");w.push(A)}u=z.getElementsByTagName("texture");for(r=0;r<u.length;r++)v=u[r],A={},A.name=v.getAttribute("name"),A.type="texture",w.push(A);n.addShaderParameterDesc(t,w)}r=c.getElementsByTagName("shader");for(s=0;s<r.length;s++)p=r[s],z={},z.name=p.getAttribute("name"),z.type=p.getAttribute("type"),z.code=p.textContent,z.input=l(p,"input",z.name),z.param=l(p,
"param",z.name),z.shader=null,n.addShaderCodeDesc(z.name,z);c=c.getElementsByTagName("technique");for(s=0;s<c.length;s++)for(r=c[s],p=new d,p.name=r.getAttribute("name"),n.addTechnique(p),z=r.getElementsByTagName("pass"),r=0;r<z.length;r++){var F=z[r],t={};t.name=F.getAttribute("name");t.blendState=null;t.depthStencilState=null;t.rasterizerState=null;t.shaderProgram=null;t.vertexAttribute=[];t.matrixUniforms=[];t.vectorUniforms=[];t.floatUniforms=[];t.boolUniforms=[];t.samplerUniforms=[];p.addPass(t);
for(var w=u=v="",M=A=null,C=null,F=F.getElementsByTagName("state"),J=0;J<F.length;J++){var O=F[J],E=O.getAttribute("name"),C=O.getAttribute("value"),H=null;"vertex_shader"===E?(C=n.getShaderCodeDesc(C),void 0!=C&&(null===C.shader&&(C.shader=a.createShader(E,C.code)),A=C.shader,v=l(O,"input",C.input),u=l(O,"param",C.param))):"pixel_shader"===E?(C=n.getShaderCodeDesc(C),void 0!=C&&(null===C.shader&&(C.shader=a.createShader(E,C.code)),M=C.shader,w=l(O,"param",C.param))):"fill_mode"!==E&&("cull_mode"===
E?(O=t,null===O.rasterizerState&&(O.rasterizerState=a.createRasterizerState()),H=O.rasterizerState,H.cullMode="none"===C?a._gl.NONE:"front"===C?a._gl.FRONT:"back"===C?a._gl.BACK:a._gl.NONE):"blend_enable"===E?(H=e(a,t),H.blendEnable="true"===C||"True"===C?!0:!1):"src_blend"===E?(H=e(a,t),H.srcBlend=g(a._gl,C)):"dest_blend"===E?(H=e(a,t),H.destBlend=g(a._gl,C)):"src_blend_alpha"===E?(H=e(a,t),H.srcBlendAlpha=g(a._gl,C)):"dest_blend_alpha"===E?(H=e(a,t),H.destBlendAlpha=g(a._gl,C)):"depth_enable"===
E?(H=h(a,t),H.zEnable="true"===C||"True"===C?!0:!1):"depth_write_mask"===E&&(H=h(a,t),H.zWriteEnable=parseInt(C)))}null!==A&&null!==M&&(t.shaderProgram=a.linkShaderProgram(A,M));A=n.getInputLayoutDesc(v);if(void 0!==A)for(v=a._gl,M=t.shaderProgram,F=t.vertexAttribute,J=0;J<A.length;J++)O=v.getAttribLocation(M,A[J]),F.push(O);u=n.getShaderParameterDesc(u);void 0!==u&&k(a._gl,t,u);u=n.getShaderParameterDesc(w);void 0!==u&&k(a._gl,t,u)}};return n});
definejs("Math/Enumeration",[],function(){var b=function(a,b,c){this.value=a;this.name=b;if(void 0!==c)for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e])};b.prototype.valueOf=function(){return this.value};b.prototype.toString=function(){return this.name};return b});
definejs("Renderer/PixelFormat",["Math/Enumeration"],function(b){var a={DEPTH_COMPONENT:new b(6402,"DEPTH_COMPONENT"),DEPTH_STENCIL:new b(34041,"DEPTH_STENCIL"),ALPHA:new b(6406,"ALPHA"),RGB:new b(6407,"RGB"),RGBA:new b(6408,"RGBA"),LUMINANCE:new b(6409,"LUMINANCE"),LUMINANCE_ALPHA:new b(6410,"LUMINANCE_ALPHA"),validate:function(b){return b===a.DEPTH_COMPONENT||b===a.DEPTH_STENCIL||b===a.ALPHA||b===a.RGB||b===a.RGBA||b===a.LUMINANCE||b===a.LUMINANCE_ALPHA},isColorFormat:function(b){return b===a.ALPHA||
b===a.RGB||b===a.RGBA||b===a.LUMINANCE||b===a.LUMINANCE_ALPHA},isDepthFormat:function(b){return b===a.DEPTH_COMPONENT||b===a.DEPTH_STENCIL}};return a});
definejs("Renderer/FrameBuffer",["Renderer/PixelFormat"],function(b){function a(a,b,c){a._bind();var d=a._gl;c?d.framebufferTexture2D(d.FRAMEBUFFER,b,d.TEXTURE_2D,c,0):d.framebufferTexture2D(d.FRAMEBUFFER,b,d.TEXTURE_2D,null,0);a._unBind()}function d(a,b,c){a._bind();var d=a._gl;c?d.framebufferRenderbuffer(d.FRAMEBUFFER,b,d.RENDERBUFFER,c._getRenderbuffer()):d.framebufferRenderbuffer(d.FRAMEBUFFER,b,d.RENDERBUFFER,null);a._unBind()}function c(a,b){a.destroyAttachments&&b&&b.destroy&&b.destroy()}b=
function(a,b){this._gl=a;this._framebuffer=a.createFramebuffer();this._depthStencilRenderbuffer=this._depthStencilTexture=this._stencilRenderbuffer=this._depthRenderbuffer=this._depthTexture=this._colorRenderbuffer=this._colorTexture=void 0;this.destroyAttachments=!0;b&&(b.colorTexture&&this.setColorTexture(b.colorTexture),b.colorRenderbuffer&&this.setColorRenderbuffer(b.colorRenderbuffer),b.depthTexture&&this.setDepthTexture(b.depthTexture),b.depthRenderbuffer&&this.setDepthRenderbuffer(b.depthRenderbuffer),
b.stencilRenderbuffer&&this.setStencilRenderbuffer(b.stencilRenderbuffer),b.depthStencilTexture&&this.setDepthStencilTexture(b.depthStencilTexture),b.depthStencilRenderbuffer&&this.setDepthStencilRenderbuffer(b.depthStencilRenderbuffer))};b.prototype._bind=function(){var a=this._gl;a.bindFramebuffer(a.FRAMEBUFFER,this._framebuffer)};b.prototype._unBind=function(){var a=this._gl;a.bindFramebuffer(a.FRAMEBUFFER,null)};b.prototype.setColorTexture=function(b){a(this,this._gl.COLOR_ATTACHMENT0,b);c(this,
this._colorTexture);this._colorTexture=b};b.prototype.getColorTexture=function(){return this._colorTexture};b.prototype.setColorRenderbuffer=function(a){d(this,this._gl.COLOR_ATTACHMENT0,a);c(this,this._colorRenderbuffer);this._colorRenderbuffer=a};b.prototype.getColorRenderbuffer=function(){return this._colorRenderbuffer};b.prototype.setDepthTexture=function(b){b&&b.getPixelFormat();a(this,this._gl.DEPTH_ATTACHMENT,b);c(this,this._depthTexture);this._depthTexture=b};b.prototype.getDepthTexture=function(){return this._depthTexture};
b.prototype.setDepthRenderbuffer=function(a){d(this,this._gl.DEPTH_ATTACHMENT,a);c(this,this._depthRenderbuffer);this._depthRenderbuffer=a};b.prototype.getDepthRenderbuffer=function(){return this._depthRenderbuffer};b.prototype.setStencilRenderbuffer=function(a){d(this,this._gl.STENCIL_ATTACHMENT,a);c(this,this._stencilRenderbuffer);this._stencilRenderbuffer=a};b.prototype.getStencilRenderbuffer=function(){return this._stencilRenderbuffer};b.prototype.setDepthStencilTexture=function(b){b&&b.getPixelFormat();
a(this,this._gl.DEPTH_STENCIL_ATTACHMENT,b);c(this,this._depthStencilTexture);this._depthStencilTexture=b};b.prototype.getDepthStencilTexture=function(){return this._depthStencilTexture};b.prototype.setDepthStencilRenderbuffer=function(a){d(this,this._gl.DEPTH_STENCIL_ATTACHMENT,a);c(this,this._depthStencilRenderbuffer);this._depthStencilRenderbuffer=a};b.prototype.getDepthStencilRenderbuffer=function(){return this._depthStencilRenderbuffer};b.prototype.hasDepthAttachment=function(){return!!(this.getDepthTexture()||
this.getDepthRenderbuffer()||this.getDepthStencilTexture()||this.getDepthStencilRenderbuffer())};b.prototype.isDestroyed=function(){return!1};b.prototype.destroy=function(){this.destroyAttachments&&(this._colorTexture=this._colorTexture&&this._colorTexture.destroy&&this._colorTexture.destroy(),this._colorRenderbuffer=this._colorRenderbuffer&&this._colorRenderbuffer.destroy(),this._depthTexture=this._depthTexture&&this._depthTexture.destroy(),this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy(),
this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy());this._gl.deleteFramebuffer(this._framebuffer);return destroyObject(this)};return b});
definejs("Renderer/RenderDevice","Renderer/RenderCommand Renderer/RenderFont Renderer/CanvasMesh2D Renderer/FontRender Renderer/BlendState Renderer/DepthStencilState Renderer/RasterizerState Renderer/RenderEffectManager Renderer/FrameBuffer Framework/ConfigOptions".split(" "),function(b,a,d,c,e,h,l,g,k,n){a=function(){this.effectManager=this.fontRender=this.canvasMesh2D=this.canvas=this.texture=this._gl=this.framework=null;this.shaderPrograms=[];this.blendStates=[];this.depthStencilStates=[];this.rasterizerStates=
[];this.currentShaderProgram=this.currentRasterizerState=this.currentDepthStencilState=this.currentDepthState=this.currentBlendState=null;this.clearColor=n.device_clear_color||[0.7765,0.9373,0.678,1];this.isSupportElementIndexUint=!1};a.prototype.setClearColor=function(a){thisObject.clearColor=a};a.prototype.initialize=function(a){this.framework=a;this.canvas=a._canvas;void 0!=n.device_clear_color&&(this.clearColor=n.device_clear_color);var b=a._canvas,e=null;try{e=a.glContext,e.viewportWidth=b.width,
e.viewportHeight=b.height,e.getContextAttributes()}catch(k){console.log("error",k)}e||alert("Could not initialise WebGL, sorry :-(");this._gl=e;e.getExtension("OES_element_index_uint")&&(this.isSupportElementIndexUint=!0);this.effectManager=new g;b=n.base_relative_path;"/"!=b.slice(b.length-1)&&(b+="/");b=b+"resource/shader.xml?version="+(window.version||"");-1!=window.location.search.indexOf("platform=ios")&&(b="");this.effectManager.loadEffect(this,b);this.canvasMesh2D=new d;this.canvasMesh2D.initialize(a);
this.fontRender=new c;this.fontRender.initialize(a)};a.prototype.finalize=function(){this.currentShaderProgram=this.currentRasterizerState=this.currentDepthStencilState=this.currentDepthState=this.currentBlendState=this.canvas=this.shaderPrograms=this.framework=null};a.prototype.beginFrame=function(){var a=this._gl;a.viewport(0,0,this.canvas.width,this.canvas.height);a.depthMask(1);a.stencilMask(4294967295);a.clear(a.STENCIL_BUFFER_BIT);a.enable(a.CULL_FACE);a.cullFace(a.FRONT);this.currentShaderProgram=
this.currentRasterizerState=this.currentDepthState=this.currentBlendState=null;this.canvasMesh2D.beginFrame();this.fontRender.beginFrame();return!0};a.prototype.endFrame=function(){this.fontRender.endFrame();this.canvasMesh2D.endFrame();return!0};a.prototype.clear=function(){return!0};a.prototype.createVertexBuffer=function(a,b,c){var d=this._gl,e=d.createBuffer();d.bindBuffer(d.ARRAY_BUFFER,e);d.bufferData(d.ARRAY_BUFFER,new Float32Array(a),d.STATIC_DRAW);e.itemSize=b;e.numItems=a.length/b;e.type=
void 0==c?d.FLOAT:c;return e};a.prototype.createEmptyIndexBuffer=function(a){var b=this._gl,c=b.createBuffer();b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,c);2===a?c.elementType=b.UNSIGNED_SHORT:4===a&&(c.elementType=b.UNSIGNED_INT);c.itemSize=a;return c};a.prototype.createIndexBuffer=function(a,b){var c=this._gl,d=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,d);2===b?(c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),c.STATIC_DRAW),d.elementType=c.UNSIGNED_SHORT):4===b&&(c.bufferData(c.ELEMENT_ARRAY_BUFFER,
new Uint32Array(a),c.STATIC_DRAW),d.elementType=c.UNSIGNED_INT);d.itemSize=b;d.numItems=a.length;return d};a.prototype.createFrameBuffer=function(a,b){var c=this._gl,d=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,d);c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),c.STATIC_DRAW);d.itemSize=1;d.numItems=a.length;return d};a.prototype.createFramebuffer=function(a){return new k(this._gl,a)};a.prototype.createTexture=function(a,b,c,d){var e=this._gl,g=e.createTexture();g.loaded=!1;var k=
new Image;b=void 0===b?e.CLAMP_TO_EDGE:e.REPEAT;void 0==c&&(c=!1);k.onload=function(a,f){return function(){e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,c);e.bindTexture(e.TEXTURE_2D,a);e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,f);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,b);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,b);e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,
null);a.width=f.width;a.height=f.height;a.loaded=!0;d&&d()}}(g,k);k.crossOrigin="";k.src=a;return g};a.prototype.createSolidTexture=function(a){var b=this._gl;a=new Uint8Array(a);var c=b.createTexture();b.bindTexture(b.TEXTURE_2D,c);b.texImage2D(b.TEXTURE_2D,0,b.RGBA,1,1,0,b.RGBA,b.UNSIGNED_BYTE,a);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,
b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindTexture(b.TEXTURE_2D,null);c.width=1;c.height=1;c.loaded=!0;return c};a.prototype.createTextureFromPixelArray=function(a,b,c,d){var e=this._gl;a=new Uint8Array(a);var g=e.createTexture();e.bindTexture(e.TEXTURE_2D,g);e.texImage2D(e.TEXTURE_2D,0,b,c,d,0,b,e.UNSIGNED_BYTE,a);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);
e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.generateMipmap(e.TEXTURE_2D);e.bindTexture(e.TEXTURE_2D,null);g.width=c;g.height=d;g.loaded=!0;return g};a.prototype.createTextureFromImage=function(a,b,c){var d=this._gl,e=d.createTexture();e.loaded=!1;b=void 0===b?d.CLAMP_TO_EDGE:d.REPEAT;void 0==c&&(c=!1);d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,c);d.bindTexture(d.TEXTURE_2D,e);d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,a);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,
d.LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR_MIPMAP_LINEAR);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,b);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,b);d.generateMipmap(d.TEXTURE_2D);d.bindTexture(d.TEXTURE_2D,null);e.width=a.width;e.height=a.height;e.loaded=!0;return e};a.prototype.releaseTexture=function(a){null!==a&&this._gl.deleteTexture(a)};a.prototype.createCubeMap=function(a,b){var c=this._gl,d=c.createTexture();d.loaded=!1;d.textueLoadedCount=0;c.bindTexture(c.TEXTURE_CUBE_MAP,
d);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MIN_FILTER,c.LINEAR);c.texParameteri(c.TEXTURE_CUBE_MAP,c.TEXTURE_MAG_FILTER,c.LINEAR);var e={negx:c.TEXTURE_CUBE_MAP_NEGATIVE_X,negy:c.TEXTURE_CUBE_MAP_NEGATIVE_Y,negz:c.TEXTURE_CUBE_MAP_NEGATIVE_Z,posx:c.TEXTURE_CUBE_MAP_POSITIVE_X,posy:c.TEXTURE_CUBE_MAP_POSITIVE_Y,posz:c.TEXTURE_CUBE_MAP_POSITIVE_Z},g;for(g in a){var k=
e[g],h=new Image;h.onload=function(a,d,e){return function(){c.bindTexture(c.TEXTURE_CUBE_MAP,a);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,!1);c.texImage2D(d,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,e);a.textueLoadedCount++;6===a.textueLoadedCount&&(a.loaded=!0);b&&b()}}(d,k,h);h.src=a[g]}return d};a.prototype.createShader=function(a,b){var c=this._gl,d=null;"vertex_shader"===a?d=c.createShader(c.VERTEX_SHADER):"pixel_shader"===a&&(d=c.createShader(c.FRAGMENT_SHADER));
c.shaderSource(d,b);c.compileShader(d);return c.getShaderParameter(d,c.COMPILE_STATUS)?d:(console.log(c.getShaderInfoLog(d)),null)};a.prototype.linkShaderProgram=function(a,b){var c=this._gl,d=c.createProgram();c.attachShader(d,a);c.attachShader(d,b);c.linkProgram(d);return c.getProgramParameter(d,c.LINK_STATUS)?d:(alert("Could not initialise shaders"),null)};a.prototype.createRenderCommand=function(){var a=new b;a.initialize(this.framework);return a};a.prototype.createBlendState=function(){var a=
new e(this);this.blendStates.push(a);return a};a.prototype.createDepthStencilState=function(){var a=new h(this);this.depthStencilStates.push(a);return a};a.prototype.createRasterizerState=function(){var a=new l(this);this.rasterizerStates.push(a);return a};a.prototype.createRenderTechnique=function(){return!0};a.prototype.applyBlendState=function(a){null!==a&&this.currentBlendState!==a&&(null===this.currentBlendState?a.apply():a.applyTo(this.currentBlendState),this.currentBlendState=a)};a.prototype.applyDepthStencilState=
function(a){null!==a&&this.currentDepthState!==a&&(null===this.currentDepthState?a.apply():a.applyTo(this.currentDepthState),this.currentDepthState=a)};a.prototype.applyRasterizerState=function(a){null!==a&&this.currentRasterizerState!==a&&(null===this.currentRasterizerState?a.apply():a.applyTo(this.currentRasterizerState),this.currentRasterizerState=a)};a.prototype.applyShaderProgram=function(a){this.currentShaderProgram!==a&&(this._gl.useProgram(a),this.currentShaderProgram=a)};a.prototype.switchPrograms=
function(a,b){var c=this._gl,d=0;null!==a&&(d=c.getProgramParameter(a,c.ACTIVE_ATTRIBUTES));if(null!==b){var e=c.getProgramParameter(b,c.ACTIVE_ATTRIBUTES);if(e>d)for(var g=d;g<e;g++)c.enableVertexAttribArray(g);else if(e<d)for(g=e;g<d;g++)c.disableVertexAttribArray(g);c.useProgram(b)}};a.prototype.render=function(a){var b=this._gl,c=a._renderTechnique;if(c)try{for(var d=0;d<c.passes.length;d++){var e=c.passes[d],g=e.shaderProgram;this.currentShaderProgram!==g&&(this.switchPrograms(this.currentShaderProgram,
g),this.currentShaderProgram=g);this.applyBlendState(e.blendState);this.applyDepthStencilState(e.depthStencilState);this.applyRasterizerState(e.rasterizerState);for(var k=0;k<e.samplerUniforms.length;k++){b.activeTexture(b.TEXTURE0+k);if(a._cubemap)b.bindTexture(b.TEXTURE_CUBE_MAP,a._textureIDs[k]);else{if(void 0===a._textureIDs[k]||null===a._textureIDs[k]||!(a._textureIDs[k]instanceof WebGLTexture))return;b.bindTexture(b.TEXTURE_2D,a._textureIDs[k])}b.uniform1i(e.samplerUniforms[k],k)}for(k=0;k<
e.matrixUniforms.length;k++)null!==e.matrixUniforms[k]&&b.uniformMatrix4fv(e.matrixUniforms[k],!1,a._matrixUniforms[k]);for(k=0;k<e.vectorUniforms.length;k++)void 0!==a._vectorUniforms[k]&&b.uniform4fv(e.vectorUniforms[k],a._vectorUniforms[k]);for(k=0;k<e.floatUniforms.length;k++)b.uniform1f(e.floatUniforms[k],a._floatUniforms[k]);for(k=0;k<e.boolUniforms.length;k++)b.uniform1i(e.boolUniforms[k],a._boolUniforms[k]);for(k=0;k<e.vertexAttribute.length;k++){var h=e.vertexAttribute[k];-1!==h&&(b.bindBuffer(b.ARRAY_BUFFER,
a._vertexBufferIDs[k]),void 0===a._vertexBufferIDs[k]&&console.log("error"),b.vertexAttribPointer(h,a._vertexBufferIDs[k].itemSize,a._vertexBufferIDs[k].type,a._vertexBufferIDs[k].normalized,a._stride[k],a._offset[k]))}if(null!==a._indexBufferID){b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,a._indexBufferID);var n=b.UNSIGNED_SHORT;a._indexBufferID.elementType&&(n=a._indexBufferID.elementType);b.drawElements(a._primitiveType,3*a._primitiveCount,n,2*a._baseVertexIndex)}else b.drawArrays(a._primitiveType,a._startVertex,
a._vertexCount)}}catch(l){console.log("effect error:"+c.name)}};a.prototype.onResize=function(){if(null!==this.canvasMesh2D){this.canvasMesh2D.resize();var a=this.canvas;this._gl.viewportWidth=a.width;this._gl.viewportHeight=a.height;this.fontRender.resize()}};return a});definejs("Core/defineProperties",["./defined"],function(b){var a;try{a="x"in Object.defineProperty({},"x",{})}catch(d){a=!1}var c=Object.defineProperties;a&&b(c)||(c=function(a){return a});return c});
definejs("Renderer/ContextLimits",["../Core/defineProperties"],function(b){var a={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,
_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};b(a,{maximumCombinedTextureImageUnits:{get:function(){return a._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return a._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return a._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return a._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return a._maximumRenderbufferSize}},
maximumTextureSize:{get:function(){return a._maximumTextureSize}},maximumVaryingVectors:{get:function(){return a._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return a._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return a._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return a._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return a._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return a._maximumAliasedLineWidth}},
minimumAliasedPointSize:{get:function(){return a._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return a._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return a._maximumViewportWidth}},maximumViewportHeight:{get:function(){return a._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return a._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return a._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return a._maximumColorAttachments}},
highpFloatSupported:{get:function(){return a._highpFloatSupported}},highpIntSupported:{get:function(){return a._highpIntSupported}}});return a});
definejs("Renderer/RenderQueueShadow",["Math/Matrix4"],function(b){var a=function(){this.framework=null;this._renderCommands=[];this.renderCommandFill=null};a.prototype.initialize=function(a){this.framework=a;var c=this.framework.renderDevice;a=c._gl;this._positionVertexBuffer=c.createVertexBuffer([-1,-1,0,-1,1,0,1,-1,0,1,1,0],3);this._renderTechnique=c.effectManager.getEffect(0).getTechnique(20);c=c.createRenderCommand();c.setStreamSource(0,this._positionVertexBuffer,0,12);c.setRenderOperation(a.TRIANGLE_STRIP,
0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);c.setRenderTechnique(this._renderTechnique);c._matrixUniforms[0]=b.create();c._vectorUniforms[0]=[0.4509804,0.5686275,0.7058824,1];this.renderCommandFill=c};a.prototype.finalize=function(){this._renderCommands=this.framework=null};a.prototype.render=function(a){if(0!=this._renderCommands.length){var b=a._renderDevice._gl;b.disable(b.CULL_FACE);b.enable(b.STENCIL_TEST);b.enable(b.DEPTH_TEST);b.colorMask(!1,!1,!1,!1);b.depthMask(!1);
b.depthFunc(b.LESS);b.stencilFunc(b.ALWAYS,1,255);b.stencilOpSeparate(b.FRONT,b.KEEP,b.KEEP,b.INCR_WRAP);b.stencilOpSeparate(b.BACK,b.KEEP,b.KEEP,b.DECR_WRAP);for(var e=0;e<this._renderCommands.length;e++)this._renderCommands[e].render(a);this._renderCommands=[];b.enable(b.STENCIL_TEST);b.disable(b.DEPTH_TEST);b.colorMask(!0,!0,!0,!0);b.depthMask(!1);b.depthFunc(b.LESS);b.stencilFunc(b.NOTEQUAL,0,255);b.stencilOpSeparate(b.FRONT_AND_BACK,b.KEEP,b.KEEP,b.KEEP);b.enable(b.BLEND);b.blendFunc(b.DST_COLOR,
b.ZERO);null!==this.renderCommandFill&&this.renderCommandFill.render(a);b.enable(b.CULL_FACE);b.enable(b.DEPTH_TEST);b.disable(b.STENCIL_TEST);b.depthMask(!0);b.depthFunc(b.LEQUAL);b.stencilFunc(b.NEVER,0,255);return!0}};a.prototype.addRenderObject=function(a){return this._renderCommands.push(a)};return a});
definejs("Scene/UserLayer/PoiOcclusionQuery",["Math/Rect"],function(b){var a=function(){this.indexMap=this.bufferRect=this.buffer=this.renderDevice=this.framework=null;this.aspectHeight=this.aspectWidth=1};a.prototype.initialize=function(a){this.framework=a;this.buffer=Array(16384);this.bufferRect=b.make(0,0,128,128);this.indexMap={}};a.prototype.finalize=function(){};a.prototype.setViewport=function(a,b){this.aspectWidth=Math.floor(Math.log(a>>7)/Math.log(2));this.aspectWidth+=1;this.aspectHeight=
Math.floor(Math.log(b>>7)/Math.log(2));this.aspectHeight+=1};a.prototype.clear=function(){for(var a=this.buffer,b=0;16384>b;b++)a[b]={rank:0,obj:void 0};this.indexMap={}};var d=b.create();a.prototype.isVisible=function(a,e){var h=this.buffer;b.copy(d,a);d[0]>>=this.aspectWidth;d[1]>>=this.aspectHeight;d[2]>>=this.aspectWidth;d[3]>>=this.aspectHeight;if(!b.contain(this.bufferRect,d))return!1;var l=d[0]-this.bufferRect[0],g=d[1]-this.bufferRect[1],k=b.getWidth(this.bufferRect),n,f;n=b.getWidth(d);f=
b.getHeight(d);for(var m=0;m<f;m++)for(var q=l+(g+m)*k,x=0;x<n;x++)if(e<h[x+q].rank)return!1;return!0};a.prototype.testRect=function(a){b.copy(d,a);d[0]>>=this.aspectWidth;d[1]>>=this.aspectHeight;d[2]>>=this.aspectWidth;d[3]>>=this.aspectHeight;return b.contain(this.bufferRect,d)?!0:!1};a.prototype.updateRect=function(a,b,d,l){var g=this.aspectWidth,k=this.aspectHeight,n=this.bufferRect,f=this.buffer,m=b[0],q=b[1],x=b[2];b=b[3];var p=l[0],s=l[1],r=l[2],z=l[3];l=n[0];var t=n[1],w=n[2],n=n[3],m=m>>
g,q=q>>k;b=(b>>k)+1;x=(x>>g)+1;p>>=g;s>>=k;z=(z>>k)+1;r=(r>>g)+1;m<l&&(m=l);x>w&&(x=w);b>n&&(b=n);q<t&&(q=t);if(!(m<=x&&q<=b))return!1;p<l&&(p=l);r>w&&(r=w);z>n&&(z=n);s<t&&(s=t);if(!(p<=r&&s<=z))return!1;g=m-l;k=q-t;l=w-l;m=x-m;q=b-q;for(x=0;x<q;x++)for(b=0;b<m;b++)w=g+b+(k+x)*l,f[w].rank=d,f[w].obj=a;return!0};a.prototype.getObject=function(a,d){var h=this.bufferRect,l=this.buffer,g,k;g=a>>this.aspectWidth;k=d>>this.aspectHeight;if(0>g||128<=g||0>k||128<=k)return null;h=g-h[0]+(k-h[1])*b.getWidth(h);
return l[h]&&0!==l[h].rank&&(l=l[h].obj,void 0!==l)?l:null};return a});
definejs("Math/LinearSampler",[],function(){return{create:function(){return[0,0,0,1]},make:function(b,a,d,c){return[b,a,d,c]},assign:function(b,a,d,c,e){b[0]=a;b[1]=d;b[2]=c;b[3]=e},resetKey:function(b,a,d){b[2]=a;b[3]=d},resetKeyRange:function(b,a,d){b[2]=a;b[3]=a+d},getValue:function(b,a){if(b[0]==b[1])return b[1];a=Math.min(a,b[3]);return b[0]+(a-b[2])/(b[3]-b[2])*(b[1]-b[0])},getValueExp:function(b,a){if(b[0]==b[1])return b[1];a=Math.min(a,b[3]);var d=(a-b[2])/(b[3]-b[2]),d=d*d*(b[1]-b[0]);return d+=
b[0]}}});
definejs("Scene/UserLayer/PoiRenderQueue",["Scene/UserLayer/PoiOcclusionQuery","Math/LinearSampler","Math/Rect"],function(b,a,d){function c(a,b){return a.viewDistance-b.viewDistance}function e(a,b){if(null==b)return!1;for(var c=0;c<b.data.length;c++)if(a==b.data[c].id)return!0;return!1}a=function(){this.framework=null;this._renderCommands=[];this.poiOcclusionQuery=null};a.prototype.initialize=function(a){this.framework=a;this.poiOcclusionQuery=new b;this.poiOcclusionQuery.initialize(a)};a.prototype.finalize=
function(){this._renderCommands=this.framework=null};a.prototype.occlusion=function(a){var b=this._renderCommands.length;if(0!==b){var d=this.poiOcclusionQuery,e=a._camera;d.clear();d.setViewport(e._viewportWidth,e._viewportHeight);this._renderCommands.sort(c);e=this._renderCommands[0];for(b-=1;0<=b;b--){e=this._renderCommands[b];e.updateRect();var n=e.wholeRenderRect,f=e.viewDistance;if(!0==d.isVisible(n,f)){e.linearSampler[1]=1;if(!1===e.isVisible)e.onVisible(a._frame_counter);e.isVisible=!0;d.updateRect(e,
n,f,n)}else{e.linearSampler[1]=0;if(!0===e.isVisible)e.onDisable(a._frame_counter);e.isVisible=!1}}}};a.prototype.collision=function(a){var b=this._renderCommands.length;if(0!==b){var c=a._camera;a=a.framework._collisionManager;a.resize(c._viewportWidth,c._viewportHeight);a.clear();for(c=0;c<b;c++){var e=this._renderCommands[c];e.updateRect();e={id:e.id,name:e.text,viewDistance:e.viewDistance,rect:d.clone(e.wholeRenderRect),isVisible:!0};a.add(e)}}};a.prototype.render=function(a){for(var b=a.framework._collisionManager,
c=b.collisionManager,d=b._hideResult,b=b._showResult,n=0;n<this._renderCommands.length;n++){var f=this._renderCommands[n];e(f.id,c)?f.render(a,c.opacity):e(f.id,d)?f.render(a,d.opacity):e(f.id,b)&&f.render(a,b.opacity)}this._renderCommands=[];return!0};a.prototype.addRenderObject=function(a){return this._renderCommands.push(a)};a.prototype.clearRenderQueue=function(){thisObject._renderCommands=[]};return a});
definejs("Scene/Vector/Marker","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/LinearSampler Math/MathUtils Math/Ellipsoid".split(" "),function(b,a,d,c,e,h,l){b=function(){this.labelStyle=this.renderDevice=this.framework=null;this.styles=[];this.hotRect=this.wholeRect=this.positionScreen=this.positionGeographic=null;this.id=this.name="";this.font=null;this.text="";this.textRect=null;this.cameraDistance=this.labelHeight=this.labelWidth=this.maxVisRange=this.minVisRange=0;this.positionWorld=
null;this._bVisible=!1;this.lastPositionScreen=null;this.viewDistance=this.level=0;this.visible=!0;this.highlight=!1;this.state=0;this.linearSampler=null;this.heightOffset=this.currentAlpha=0;this.onCameraChange=this.onMouseOut=this.onMouseOver=this.onClick=null};b.prototype.initialize=function(a){this.framework=a;this.positionGeographic=d.create();this.positionScreen=d.create();this.positionWorld=d.create();this.rect=c.create();this.lastPositionScreen=d.create();this.font=a.getFontManager().createFont("\u5fae\u8f6f\u96c5\u9ed1",
!1,14);this.wholeRect=c.create();this.linearSampler=e.make(0,1,0,60);this.currentAlpha=0};b.prototype.finalize=function(){this.labelStyle=null};b.prototype.setPosition=function(a,b,c){this.positionGeographic[0]=a*h.RADIANS_PER_DEGREE;this.positionGeographic[1]=b*h.RADIANS_PER_DEGREE;this.positionGeographic[2]=c;this.framework._spatialReference.transformGeographicsToWorld(this.positionWorld,this.positionGeographic);this.framework._forceRedraw=!0};b.prototype.setHeightOffset=function(a){this.heightOffset=
a;this.positionGeographic[2]=this.heightOffset};b.prototype.setVisible=function(a){this.visible=a};b.prototype.onVisible=function(a){e.assign(this.linearSampler,this.currentAlpha,1,a,a+60)};b.prototype.onDisable=function(a){e.assign(this.linearSampler,this.currentAlpha,0,a,a+15)};b.prototype.updateRect=function(){var a=this.positionScreen[0],b=this.positionScreen[1];c.assign(this.wholeRect,this.textRect[0]+a,this.textRect[1]+b,this.textRect[2]+a+28,this.textRect[3]+b)};b.prototype.updateTextRect=
function(){null!==this.labelStyle&&""!==this.text&&this.framework.renderDevice.canvasMesh2D.calcuTextSize(this.textRect,this.labelStyle.font,this.text,this.scale)};b.prototype.cull=function(a){var b=a._camera;!1!==this.visible&&(this.cameraDistance=d.distance(this.positionWorld,b._position),0<this.get("maxVisRange")&&(this.cameraDistance<this.get("minVisRange")||this.cameraDistance>this.get("maxVisRange"))||(this.viewDistance=0,b.isVisible(this.positionWorld)?(this._bVisible=!0,1===this.state&&(this.viewDistance=
1E3),b.projectionFromWorld2(this.positionScreen,this.positionGeographic,a._camera._cameraParam.scaleFactor,a._viewProjectionMatrix),a._renderContext._renderQueues[7].addRenderObject(this)):this._bVisible=!1))};b.prototype.intersect=function(a){return this.wholeRenderRect&&c.containPoint(this.wholeRenderRect,a.mousePoint)?!0:!1};var g=[0,16777215],k=[58],n=0.6*devicePixelRatio;b.prototype.render=function(a){if(this.labelStyle.textures[0].loaded){var b=a._renderDevice.canvasMesh2D,c=[[0,0],[0,0]],d=
[[0.2,0.2,0.2,0.8],[1,1,1,1]];void 0!==this.get("textureColor")&&(d=this.get("textureColor"));void 0!==this.get("iconOffset")&&(c=this.get("iconOffset"));b.setBlendColor([1,1,1,1]);this.labelStyle.draw(a,b,c,n,d,this.state,this);""!==this.text&&(a=[-(this.font.fontWidth*this.text.length*0.5+c[this.state][0])*n,-(k[0]+c[this.state][1])*n],b.setBlendColor(d[this.state]),b.drawText(this.font,this.text,this.positionScreen[0]+a[0]/n,this.positionScreen[1]+a[1],g[this.state],1),b.flush())}};return b});
definejs("Scene/Vector/MarkerRenderQueue",["Scene/Vector/Marker"],function(b){function a(a,b){return a.viewDistance-b.viewDistance}b=function(){this.framework=null;this._renderCommands=[];this._markerSets=[]};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){this._markerSets=this._renderCommands=this.framework=null};b.prototype.render=function(b){this._renderCommands.sort(a);this._markerSets=[];for(var c=0;c<this._renderCommands.length;c++)this._renderCommands[c].render(b),
this._markerSets.push(this._renderCommands[c]);this._renderCommands=[];return!0};b.prototype.addRenderObject=function(a){return this._renderCommands.push(a)};b.prototype.getMarker=function(a){for(var b=this._markerSets.length-1;0<=b;b--){var e=this._markerSets[b];if(e.intersect(a))return e}return null};return b});
definejs("Renderer/RenderContext","Core/defined Renderer/RenderQueue Renderer/ContextLimits Renderer/RenderQueueShadow Scene/UserLayer/PoiRenderQueue Scene/Vector/MarkerRenderQueue".split(" "),function(b,a,d,c,e,h){e=function(){this._gl=this.framework=null;this._renderQueues=[];this._shadowCastRenderQueue=null;this._allowTextureFilterAnisotropic=!0};e.prototype.initialize=function(e){this.framework=e;var g=this._gl=e.renderDevice._gl;this.elementIndexUint=g.getExtension("OES_element_index_uint");
d._maximumCombinedTextureImageUnits=g.getParameter(g.MAX_COMBINED_TEXTURE_IMAGE_UNITS);d._maximumCubeMapSize=g.getParameter(g.MAX_CUBE_MAP_TEXTURE_SIZE);d._maximumFragmentUniformVectors=g.getParameter(g.MAX_FRAGMENT_UNIFORM_VECTORS);d._maximumTextureImageUnits=g.getParameter(g.MAX_TEXTURE_IMAGE_UNITS);d._maximumRenderbufferSize=g.getParameter(g.MAX_RENDERBUFFER_SIZE);d._maximumTextureSize=g.getParameter(g.MAX_TEXTURE_SIZE);d._maximumVaryingVectors=g.getParameter(g.MAX_VARYING_VECTORS);d._maximumVertexAttributes=
g.getParameter(g.MAX_VERTEX_ATTRIBS);d._maximumVertexTextureImageUnits=g.getParameter(g.MAX_VERTEX_TEXTURE_IMAGE_UNITS);d._maximumVertexUniformVectors=g.getParameter(g.MAX_VERTEX_UNIFORM_VECTORS);var k=g.getParameter(g.ALIASED_LINE_WIDTH_RANGE);d._minimumAliasedLineWidth=k[0];d._maximumAliasedLineWidth=k[1];k=g.getParameter(g.ALIASED_POINT_SIZE_RANGE);d._minimumAliasedPointSize=k[0];d._maximumAliasedPointSize=k[1];k=g.getParameter(g.MAX_VIEWPORT_DIMS);d._maximumViewportWidth=k[0];d._maximumViewportHeight=
k[1];k=g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_FLOAT);d._highpFloatSupported=0!==k.precision;k=g.getShaderPrecisionFormat(g.FRAGMENT_SHADER,g.HIGH_INT);d._highpIntSupported=0!==k.rangeMax;if(this._allowTextureFilterAnisotropic)a:{for(var k=["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"],n=k.length,f=0;f<n;++f){var m=g.getExtension(k[f]);if(m){k=m;break a}}k=void 0}else k=void 0;d._maximumTextureFilterAnisotropy=b(k)?g.getParameter(k.MAX_TEXTURE_MAX_ANISOTROPY_EXT):
1;this._renderQueues.push(new a);g=new a;g.initialize(e);this._renderQueues.push(g);g=new c;g.initialize(e);this._renderQueues.push(g);this._renderQueues.push(e._collisionManager._poiRenderQueue);g=new h;g.initialize(e);this._renderQueues.push(g);g=new a;g.initialize(e);g.sortObject=!0;this._renderQueues.push(g);g=new a;g.initialize(e);g.sortObject=!0;this._renderQueues.push(g);g=new h;g.initialize(e);this._renderQueues.push(g);this._shadowCastRenderQueue=new a};e.prototype.finalize=function(){this.framework=
null;for(var a=0;a<this._renderQueues.length;a++)this._renderQueues[a]&&this._renderQueues[a].finalize();this._shadowCastRenderQueue=this._renderQueues=null};e.prototype.renderModel=function(a){for(var b=0;3>b;b++)this._renderQueues[b].render(a);return!0};e.prototype.renderOverlay=function(a){for(var b=4;b<this._renderQueues.length;b++)this._renderQueues[b].render(a);return!0};e.prototype.getShadowCastRenderQueue=function(){return this._shadowCastRenderQueue};e.prototype.renderShadowCast=function(a){this._shadowCastRenderQueue.render(a)};
e.prototype.getRenderQueue=function(a){return this._renderQueues[a]};e.prototype.addRenderQueue=function(a){return this._renderQueues.push(a)};return e});
definejs("Math/Plane",["Math/Vector3","Math/MathUtils"],function(b,a){return{create:function(){return[0,0,1,0]},assign:function(a,b,e,h,l){a[0]=b;a[1]=e;a[2]=h;a[3]=l},fromNormalDistance:function(a,b,e){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=e},projection:function(a,c,e){return b.mad(a,c,e,-b.dot(c,e))},intersectRay:function(d,c,e){var h=e._dir;e=e._orig;var l=b.dot(h,c);if(a.equalsEpsilon(l,0,a.EPSILON14))return e[0]*c[0]+e[1]*c[1]+e[2]*c[2]+c[3]<a.EPSILON14?(b.clone(d,e),1):0;c=-(e[0]*c[0]+e[1]*c[1]+
e[2]*c[2]+c[3]);b.mad(d,e,h,c/l);return 1}}});
definejs("Math/Frustum",["Math/Matrix4","Math/Plane","Math/Vector3"],function(b,a,d){var c=function(){this._fovy=0.25*Math.PI;this._near=this._aspect=1;this._far=1E4;this._projectionMatrix=b.create();this._planes=Array(6);this.negativeY=d.create();this.positiveY=d.create();this.nearCenter=d.create();for(var c=0;6>c;c++)this._planes[c]=a.create()};c.prototype.setFovy=function(a){this._fovy=a};c.prototype.setAspect=function(a){this._aspect=a};c.prototype.setNear=function(a){this._near=a};c.prototype.setFar=
function(a){this._far=a};var e=b.create(),h=b.create();c.prototype.update=function(c){b.perspectiveRH(this._projectionMatrix,this._fovy,this._aspect,this._near,this._far);b.multiply(e,c,this._projectionMatrix);b.transpose(e);d.assign(this.positiveY,0,this._near*Math.tan(0.5*this._fovy),this._near);d.assign(this.negativeY,0,-this._near*Math.tan(0.5*this._fovy),this._near);d.assign(this.nearCenter,0,0,this._near);b.inverse(h,c);d.transformCoord(this.positiveY,this.positiveY,h);d.transformCoord(this.negativeY,
this.negativeY,h);d.transformCoord(this.nearCenter,this.nearCenter,h);c=e[0];var g=e[1],k=e[2],n=e[3],f=e[4],m=e[5],q=e[6],x=e[7],p=e[8],s=e[9],r=e[10],z=e[11],t=e[12],w=e[13],u=e[14],v=e[15];a.assign(this._planes[0],-p,-s,-r,-z);a.assign(this._planes[1],p-t,s-w,r-u,z-v);a.assign(this._planes[2],-c-t,-g-w,-k-u,-n-v);a.assign(this._planes[3],c-t,g-w,k-u,n-v);a.assign(this._planes[4],f-t,m-w,q-u,x-v);a.assign(this._planes[5],-f-t,-m-w,-q-u,-x-v)};return c});
definejs("Math/Quaternion",["Math/Vector3","Math/Matrix4"],function(b,a){var d={create:function(){return[0,0,0,1]},release:function(){},assign:function(a,b,c,d,e){a[0]=b;a[1]=c;a[2]=d;a[3]=e},copy:function(a){var b=[0,0,0,1];b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},clone:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},multiply:function(a,b,c){var d=b[0],e=b[1],g=b[2];b=b[3];var p=c[0],h=c[1],r=c[2];c=c[3];a[0]=b*p+d*c+e*r-g*h;a[1]=b*h-d*r+e*c+g*p;a[2]=b*r+d*h-e*p+g*c;a[3]=
b*c-d*p-e*h-g*r;return a},normalize:function(a,b){var c=d.length(b);1E-12<c?(c=1/c,a[0]*=c,a[1]*=c,a[2]*=c,a[3]*=c):(a[0]=0,a[1]=0,a[2]=0,a[3]=0)},length:function(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]+a[3]*a[3])},squaredLength:function(a){return a[0]*a[0]+a[1]*a[1]+a[2]*a[2]+a[3]*a[3]},slerp:function(a,b,c,e){var g=b[0],h=b[1],p=b[2];b=b[3];var l=c[0],r=c[1],z=c[2],t=c[3];c=g*l+h*r+p*z+b*t;0>c&&(c=-c,l=-l,r=-r,z=-z,t=-t);if(0.999>Math.abs(c)){var w=Math.sqrt(1-c*c);c=Math.atan2(w,c);var u=
1/w,w=Math.sin((1-e)*c)*u;e=Math.sin(e*c)*u;a[0]=w*g+e*l;a[1]=w*h+e*r;a[2]=w*p+e*z;a[3]=w*b+e*t}else a[0]=(1-e)*g+e*l,a[1]=(1-e)*h+e*r,a[2]=(1-e)*p+e*z,a[3]=(1-e)*b+e*t,d.normalize(a,a)}},c=a.create();d.fromAxis=function(a,b,e,g){c[0]=b[0];c[1]=b[1];c[2]=b[2];c[4]=e[0];c[5]=e[1];c[6]=e[2];c[8]=g[0];c[9]=g[1];c[10]=g[2];d.fromMatrix(a,c)};var e=b.create(),h=b.create(),l=b.create();d.multiplyVector3=function(a,c,d){l[0]=c[0];l[1]=c[1];l[2]=c[2];b.cross(e,l,d);b.cross(h,l,e);b.scale(e,e,2*c[3]);b.scale(h,
h,2);b.add(a,d,e);b.add(a,a,h)};d.fromMatrix=function(a,b){var c=b[0]+b[5]+b[10],d;if(0<c)d=Math.sqrt(c+1),a[3]=0.5*d,d=0.5/d,a[0]=(b[6]-b[9])*d,a[1]=(b[8]-b[2])*d,a[2]=(b[1]-b[4])*d;else{c=0;b[5]>b[0]&&(c=1);b[10]>b[4*c+c]&&(c=2);d=[1,2,0];var e=d[c],g=d[e];d=Math.sqrt(b[4*c+c]-b[4*e+e]-b[4*g+g]+1);a[c]=0.5*d;d=0.5/d;a[3]=(b[4*e+g]-b[4*g+e])*d;a[e]=(b[4*e+c]+b[4*c+e])*d;a[g]=(b[4*c+g]+b[4*g+c])*d}};d.fromEuler=function(a,b,c,d){var e=Math.cos(0.5*c),g=Math.cos(0.5*d),p=Math.cos(0.5*b);c=Math.sin(0.5*
c);d=Math.sin(0.5*d);b=Math.sin(0.5*b);a[3]=e*g*p-c*d*b;a[0]=c*d*p+e*g*b;a[1]=c*g*p+e*d*b;a[2]=e*d*p-c*g*b};d.toEuler=function(a,b){var c=b[0],d=b[1],e=b[2],g=b[3],p=c*c,h=d*d,r=e*e,l=c*d+e*g;0.499<l?(a[0]=0,a[1]=2*Math.atan2(c,g),a[2]=0.5*Math.PI):-0.499>l?(a[0]=0,a[1]=2*-Math.atan2(c,g),a[2]=0.5*-Math.PI):(a[0]=Math.atan2(2*c*g-2*d*e,1-2*p-2*r),a[1]=Math.atan2(2*d*g-2*c*e,1-2*h-2*r),a[2]=Math.asin(2*c*d+2*e*g))};var g=b.create();d.fromAxisAngle=function(a,c,d){d/=2;var e=Math.sin(d);g=b.normalize(g,
c);c=g[0]*e;var h=g[1]*e,e=g[2]*e;d=Math.cos(d);a[0]=c;a[1]=h;a[2]=e;a[3]=d;return a};d.inverse=function(a,b){var c=d.squaredLength(b);d.conjugate(a,b);return d.multiplyByScalar(a,a,1/c)};d.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};d.multiplyByScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};d.equalsEpsilon=function(a,b,c){return a===b||Math.abs(a[0]-b[0])<=c&&Math.abs(a[1]-b[1])<=c&&Math.abs(a[2]-b[2])<=c&&Math.abs(a[3]-b[3])<=c};
return d});
definejs("Scene/SceneManager",[],function(){var b=function(){this.framework=null;this._scenes=[]};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){this.framework=null;for(var a=0;a<this._scenes.length;a++)this._scenes[a].finalize();this._scenes=null};b.prototype.getScene=function(a){return this._scenes[a]};b.prototype.addScene=function(a){this._scenes.push(a)};b.prototype.removeScene=function(a){for(var b=this._scenes,c=0,e=b.length;c<e;c++)if(b[c]==a){b.splice(c,
1);break}};b.prototype.getCount=function(){return this._scenes.length};return b});
definejs("Renderer/ViewManager",["Renderer/View"],function(b){b=function(){this.framework=null;this._views=[]};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){this.framework=null;for(var a=0;a<this._views.length;a++)this._views[a].finalize();this._views=[]};b.prototype.cull=function(a){for(var b=0;b<this._views.length;b++)this._views[b].cull(a);return!0};b.prototype.render=function(){for(var a=0;a<this._views.length;a++)this._views[a].render();return!0};b.prototype.intersect=
function(a){for(var b=!1,c=0;c<this._views.length;c++)b|=this._views[c].render(a);return b};b.prototype.getView=function(a){return this._views[a]};b.prototype.addView=function(a){this._views.push(a)};b.prototype.getCount=function(){return this._views.length};b.prototype.onResize=function(){for(var a=0;a<this._views.length;a++)this._views[a].onResize()};return b});
definejs("Controller/AnimationControl",["Controller/AnimationManager"],function(b){b=function(){this._animationObject=this._framework=null;this.duration=0;this._start=!1;this._onDone=this._onFrame=this._onStart=this._startTime=null;this._pause=this._stop=!1;this.elapse=0;this._animationManager=this.parameter=null};b.prototype.getAnimationObject=function(){return this._animationObject};b.prototype.setAnimationObject=function(a){this._animationObject=a};b.prototype.update=function(a){if(this._start&&
!this._stop&&!this._pause)return this.elapse=(a.getTime()-this._startTime.getTime())/1E3,null!=this._onFrame&&this._onFrame(this),!0};b.prototype.start=function(){this._start=!0;this._startTime=new Date;null!=this._onStart&&this._onStart(this)};b.prototype.stop=function(){this._stop=!0;null!==this._onDone&&this._onDone(this);null!==this._animationManager&&this._animationManager.removeAnimationControl(this._name)};b.prototype.pause=function(){this._pause=!0};b.prototype.resume=function(){this._pause&&
(this._pause=!1)};b.prototype.setOnAnimationStart=function(a){this._onStart=a};b.prototype.setOnAnimationFrame=function(a){this._onFrame=a};b.prototype.setOnAnimationDone=function(a){this._onDone=a};b.prototype.setDuration=function(a){this.duration=a};b.prototype.setParameter=function(a){this.parameter=a};b.prototype.setName=function(a){this._name=a};b.prototype.setAnimationManager=function(a){this._animationManager=a};return b});
definejs("Controller/Enumeration",[],function(){var b=function(a,b,c){this.value=a;this.name=b;if("undefined"!==typeof c)for(var e in c)c.hasOwnProperty(e)&&(this[e]=c[e])};b.prototype.valueOf=function(){return this.value};b.prototype.toString=function(){return this.name};return b});
definejs("Controller/InputEventType",["Controller/Enumeration"],function(b){return{LEFT_DOWN:new b(0,"LEFT_DOWN"),LEFT_UP:new b(1,"LEFT_UP"),LEFT_CLICK:new b(2,"LEFT_CLICK"),LEFT_DOUBLE_CLICK:new b(3,"LEFT_DOUBLE_CLICK"),RIGHT_DOWN:new b(5,"RIGHT_DOWN"),RIGHT_UP:new b(6,"RIGHT_UP"),RIGHT_CLICK:new b(7,"RIGHT_CLICK"),RIGHT_DOUBLE_CLICK:new b(8,"RIGHT_DOUBLE_CLICK"),MIDDLE_DOWN:new b(10,"MIDDLE_DOWN"),MIDDLE_UP:new b(11,"MIDDLE_UP"),MIDDLE_CLICK:new b(12,"MIDDLE_CLICK"),MIDDLE_DOUBLE_CLICK:new b(13,
"MIDDLE_DOUBLE_CLICK"),MOUSE_MOVE:new b(15,"MOUSE_MOVE"),WHEEL:new b(16,"WHEEL"),TOUCH_PINCH:new b(101,"TOUCH_PINCH"),PINCH_START:new b(102,"PINCH_START"),PINCH_END:new b(103,"PINCH_END"),PINCH_MOVE:new b(104,"PINCH_MOVE"),TOUCH_DOUBLETAP:new b(105,"TOUCH_DOUBLETAP"),TOUCH_LONGTAP:new b(106,"TOUCH_LONGTAP"),TAP_START:new b(107,"TAP_START"),TAP_END:new b(108,"TAP_END"),TOUCH_SCRATCH:new b(109,"TOUCH_SCRATCH"),SCRATCH_START:new b(110,"SCRATCH_START"),SCRATCH_MOVE:new b(111,"SCRATCH_MOVE"),SCRATCH_END:new b(112,
"SCRATCH_END")}});definejs("Controller/InputActionType",["Controller/Enumeration"],function(b){return{MOUSE_LEFTDRAG:new b(0,"MOUSE_LEFTDRAG"),MOUSE_RIGHTDRAG:new b(1,"MOUSE_RIGHTDRAG"),MOUSE_MIDDLEDRAG:new b(2,"MOUSE_MIDDLEDRAG"),MOUSE_WHEEL:new b(3,"MOUSE_WHEEL"),MOUSE_LEFTCLICK:new b(4,"MOUSE_LEFTCLICK"),MOUSE_MOVE:new b(5,"MOUSE_MOVE"),TOUCH_PINCH:new b(6,"TOUCH_PINCH"),TOUCH_DOUBLETAP:new b(7,"TOUCH_DOUBLETAP"),TOUCH_LONGTAP:new b(106,"TOUCH_LONGTAP"),TOUCH_SCRATCH:new b(107,"TOUCH_SCRATCH")}});
definejs("Controller/InputEventHandler",["Controller/InputEventType","Math/Vector2","Framework/ConfigOptions","Controller/InputActionType"],function(b,a,d,c){function e(a,b){var c=a._element.getBoundingClientRect();return[b.clientX-c.left,b.clientY-c.top]}function h(a,b){q=e(a,b);l(q,q);return{identifier:b.identifier,touchX:q[0],touchY:q[1]}}function l(a,b){b=b||[];b[0]=a[0]*d.devicePixelRatio;b[1]=a[1]*d.devicePixelRatio;return b}function g(c,d){var f=d.touches.length;c._seenAnyTouchEvents=!0;var g;
g=e(c,d.touches[0]);l(g,g);a.clone(m.position,g);1===f?(a.clone(q,g),c._lastMouseX=q[0],c._lastMouseY=q[1],c._totalPixels=0,c._leftMouseButtonDown=!0,g=c.getInputAction(b.LEFT_DOWN),"undefined"!==typeof g&&g(m),g=c.getInputAction(b.TAP_START),"undefined"!==typeof g&&g(m)):c._leftMouseButtonDown&&(c._leftMouseButtonDown=!1,g=c.getInputAction(b.LEFT_UP),"undefined"!==typeof g&&g(m));c._lastTouches=[];if(1<f){c._isPinching=!0;for(g=0;g<f;g++)c._lastTouches.push(h(c,d.touches[g]));g=c.getInputAction(b.PINCH_START);
"undefined"!==typeof g&&g(f)}else c._isPinching&&(c.isPinching=!1,g=c.getInputAction(b.PINCH_END),"undefined"!==typeof g&&g());d.cancelable&&!d.defaultPrevented&&c._element.id==d.target.id&&(d.preventDefault&&d.preventDefault(),d.stopPropagation&&d.stopPropagation())}function k(a,c){var d=c.detail?-120*c.detail:c.wheelDelta,e=a.getInputAction(b.WHEEL);"undefined"!==typeof e&&c.cancelable&&(c.preventDefault(),e(d))}function n(f){f._callbacks=[];f._callbacks.push({name:"mousedown",onDoc:!1,action:function(c){var d=
e(f,c);f._lastMouseX=d[0];f._lastMouseY=d[1];f._totalPixels=0;if(!f._seenAnyTouchEvents){var g;0===c.button?(f._leftMouseButtonDown=!0,g=f.getInputAction(b.LEFT_DOWN)):1===c.button?(f._middleMouseButtonDown=!0,g=f.getInputAction(b.MIDDLE_DOWN)):2===c.button&&(f._rightMouseButtonDown=!0,g=f.getInputAction(b.RIGHT_DOWN));"undefined"!==typeof g&&g({position:a.make(d[0],d[1])});c.preventDefault()}}});f._callbacks.push({name:"mouseup",onDoc:!0,action:function(c){var d,g;0===c.button?(f._leftMouseButtonDown=
!1,d=f.getInputAction(b.LEFT_UP),g=f.getInputAction(b.LEFT_CLICK)):1===c.button?(f._middleMouseButtonDown=!1,d=f.getInputAction(b.MIDDLE_UP),g=f.getInputAction(b.MIDDLE_CLICK)):2===c.button&&(f._rightMouseButtonDown=!1,d=f.getInputAction(b.RIGHT_UP),g=f.getInputAction(b.RIGHT_CLICK));c=e(f,c);var p=f._lastMouseX-c[0],m=f._lastMouseY-c[1];f._totalPixels+=Math.sqrt(p*p+m*m);"undefined"!==typeof d&&d({position:a.make(c[0],c[1])});"undefined"!==typeof g&&f._totalPixels<f._clickPixelTolerance&&g({position:a.make(c[0],
c[1])})}});f._callbacks.push({name:"mousemove",onDoc:!0,action:function(c){var d=e(f,c),g=f._lastMouseX-d[0],p=f._lastMouseY-d[1];f._totalPixels+=Math.sqrt(g*g+p*p);d={startPosition:a.make(f._lastMouseX,f._lastMouseY),endPosition:a.make(d[0],d[1]),motion:a.create()};g=f.getInputAction(b.MOUSE_MOVE);"undefined"!==typeof g&&g(d);f._lastMouseX=d.endPosition[0];f._lastMouseY=d.endPosition[1];(c.cancelable&&f._leftMouseButtonDown||f._middleMouseButtonDown||f._rightMouseButtonDown)&&c.preventDefault()}});
f._callbacks.push({name:"dblclick",onDoc:!1,action:function(c){var d,g=e(f,c);0===c.button?d=f.getInputAction(b.LEFT_DOUBLE_CLICK):1===c.button?d=f.getInputAction(b.MIDDLE_DOUBLE_CLICK):2===c.button&&(d=f.getInputAction(b.RIGHT_DOUBLE_CLICK));"undefined"!==typeof d&&d({position:a.create(g[0],g[1])})}});f._callbacks.push({name:"mousewheel",onDoc:!1,action:function(a){k(f,a)}});f._callbacks.push({name:"DOMMouseScroll",onDoc:!1,action:function(a){k(f,a)}});f._callbacks.push({name:"touchstart",onDoc:!1,
action:function(a){g(f,a)}});f._callbacks.push({name:"touchmove",onDoc:!0,action:function(c){var g,m,k;c.cancelable&&!c.defaultPrevented&&(c.preventDefault(),c.stopPropagation());if(f._leftMouseButtonDown&&1===c.touches.length){g=e(f,c.touches[0]);l(g,g);a.clone(p.endPosition,g);c=f._lastMouseX-g[0];var n=f._lastMouseY-g[1];f._totalPixels+=Math.sqrt(c*c+n*n);a.clone(p.startPosition,[f._lastMouseX,f._lastMouseY]);k=f.getInputAction(b.MOUSE_MOVE);"undefined"!==typeof k&&k(p);a.clone(q,p.endPosition);
f._lastMouseX=q[0];f._lastMouseY=q[1]}else if(f._isPinching&&1<c.touches.length){var n=Math.min(f._lastTouches.length,2),t,C;f._currentTouches=[];for(t=0;t<n;t++){a:{k=c.touches;for(C=0;C<k.length;C++)if(k[C].identifier===f._lastTouches[t].identifier){k=C;break a}k=-1}f._currentTouches.push(h(f,c.touches[k]))}k=f.getInputAction(b.PINCH_MOVE);var x,z,E,H,P,B,I=0,y=0,K=0,G=0,L=0,N=0,D=0,Q=1/d.devicePixelRatio;if("undefined"!==typeof k){for(t=0;t<n-1;t++)for(C=t+1;C<n;C++){D++;g=f._currentTouches[t];
m=f._currentTouches[C];x=m.touchX-g.touchX;z=m.touchY-g.touchY;E=0.25*Math.sqrt(x*x+z*z);H=f._lastTouches[C].touchX-f._lastTouches[t].touchX;P=f._lastTouches[C].touchY-f._lastTouches[t].touchY;B=0.25*Math.sqrt(H*H+P*P);g=0.125*(m.touchY+g.touchY);m=0.125*(f._lastTouches[C].touchY+f._lastTouches[t].touchY);x=Math.atan2(z,x);H=Math.atan2(P,H);for(P=2*Math.PI;x>=H+Math.PI;)x-=P;for(;x<H-Math.PI;)x+=P;I+=E;y+=B;K+=g;G+=m;L+=x;N+=H}I/=D;K/=D;G/=D;L/=D;N/=D;a.fromElements(s.distance.startPosition,0,y/D*
Q);a.fromElements(s.distance.endPosition,0,I*Q);a.fromElements(s.angleAndHeight.startPosition,N,G);a.fromElements(s.angleAndHeight.endPosition,L,K);s.touchCount=n;k(s,c)}f._lastTouches=f._currentTouches.slice(0)}}});f._callbacks.push({name:"touchend",onDoc:!0,action:function(d){var p=d.changedTouches.length,m,h,k;if(f._leftMouseButtonDown){f._leftMouseButtonDown=!1;m=f.getInputAction(b.LEFT_UP);h=f.getInputAction(b.LEFT_CLICK);k=f.getInputAction(b.TAP_END);var q=e(f,d.changedTouches[0]);l(q,q);a.clone(x.position,
q);0<p&&(p=f._lastMouseX-q[0],q=f._lastMouseY-q[1],f._totalPixels+=Math.sqrt(p*p+q*q),"undefined"!==typeof k&&k(x),"undefined"!==typeof m&&m(x),"undefined"!==typeof h&&f._totalPixels<f._clickPixelTolerance&&h(x))}f._isPinching&&(f._isPinching=!1,m=f.getInputAction(b.PINCH_END),"undefined"!==typeof m&&m());f._inputActionType===c.TOUCH_PINCH&&0<d.touches.length&&g(f,d);d.cancelable&&!d.defaultPrevented&&f._element.id==d.target.id&&(d.preventDefault(),d.cancelable&&d.stopPropagation())}});for(var m=
0;m<f._callbacks.length;m++){var n=f._callbacks[m];n.onDoc?document.body.addEventListener(n.name,n.action,!1):f._element.addEventListener(n.name,n.action,!1)}}var f=function(a,b){this.initialize(a,b);n(this)};f.prototype.initialize=function(a,c){this._inputEvents={};for(var d in b)b.hasOwnProperty(d)&&(this._inputEvents[d]=void 0);this._rightMouseButtonDown=this._middleMouseButtonDown=this._leftMouseButtonDown=!1;this._inputActionType=c;this._seenAnyTouchEvents=this._isPinching=!1;this._lastMouseY=
this._lastMouseX=0;this._lastTouch2=[0,0];this._touchID2=this._touchID1=this._totalPixels=0;this._clickPixelTolerance=5;this._element=a;this._isScratch=!1;this._lastScratchDistance=0;this._lastTouches=[];this._currentTouches=[]};f.prototype.finalize=function(){if(this._callbacks)for(var a=0,b=this._callbacks.length;a<b;a++){var c=this._callbacks[a];c.onDoc?document.body.removeEventListener(c.name,c.action,!1):this._element.removeEventListener(c.name,c.action,!1)}this.initialize(this._element,this._inputActionType)};
f.prototype.setInputAction=function(a,b){this._inputEvents[b.name]=a};f.prototype.getInputAction=function(a){return this._inputEvents[a.name]};var m={position:a.create()};a.create();a.create();var q=[0,0],x={position:a.create()},p={startPosition:a.create(),endPosition:a.create()},s={distance:{startPosition:a.create(),endPosition:a.create()},angleAndHeight:{startPosition:a.create(),endPosition:a.create()}};return f});
definejs("Controller/InputAction",["Controller/InputEventHandler","Controller/InputEventType","Controller/InputActionType","Math/MathUtils","Math/Vector2"],function(b,a,d,c,e){var h=function(h,g,k){function n(a,b){return{interDistance:a,interTime:b}}this._eventHandler=new b(g,k);this._framework=h;this._doAction=!1;this._movement={};this._lastMovement={};this._isDown=!1;this._eventStartPosition=e.create();this._releaseTime=this._pressTime=null;this._buttonDown=0;var f=this;if(k===d.MOUSE_WHEEL)this._eventHandler.setInputAction(function(a){a=
2*c.toRadians(a);f._doAction?f._movement.endPosition[1]+=a:(f._movement={startPosition:e.create(),endPosition:e.make(0,a),motion:e.create()},f._lastMovement=f._movement,f._doAction=!0);f._pressTime=new Date;f._releaseTime=new Date(f._pressTime.getTime()+5*Math.abs(a))},a.WHEEL);else if(k===d.MOUSE_MOVE)this._eventHandler.setInputAction(function(a){f._isDown=!1;f._pressTime=new Date;f._releaseTime=new Date;f._lastMovement=f._movement;f._movement=a;f._doAction=!0},a.MOUSE_MOVE);else if(k===d.TOUCH_PINCH)f._lastMovement=
f._movement,f._doAction=null,f._isDown=!1,f._eventStartPosition=e.create(),f._pressTime=new Date,f._releaseTime=new Date,f._movement={},f._lastTouchTime=null,f._currentTouchTime=null,f._touchDistance=null,f._touchDisTime=null,f._touchesCount=null,f._movement.distance={startPosition:e.create(),endPosition:e.create()},f._movement.angleAndHeight={startPosition:e.create(),endPosition:e.create()},f._movement.prevAngle=0,f._movement._isBackToGloble=!1,this._eventHandler.setInputAction(function(a){f._buttonDown++;
f._isDown=!0;f._pressTime=new Date;f._lastTouchTime=new Date;f._touchDisTime=[];f._touchesCount=a},a.PINCH_START),this._eventHandler.setInputAction(function(a,b){if(f._isDown){if(f._doAction)e.clone(f._movement.distance.endPosition,a.distance.endPosition),e.clone(f._movement.angleAndHeight.endPosition,a.angleAndHeight.endPosition);else{var c=f._movement;e.clone(c.distance.startPosition,a.distance.startPosition);e.clone(c.distance.endPosition,a.distance.endPosition);e.clone(c.angleAndHeight.startPosition,
a.angleAndHeight.startPosition);e.clone(c.angleAndHeight.endPosition,a.angleAndHeight.endPosition);f._doAction=!0;f._movement.prevAngle=f._movement.angleAndHeight.startPosition[0]}for(var c=f._movement.angleAndHeight.endPosition[0],d=f._movement.prevAngle,m=2*Math.PI;c>=d+Math.PI;)c-=m;for(;c<d-Math.PI;)c+=m;var m=c-d,h=f._movement.distance.endPosition[1]-f._movement.distance.startPosition[1];m&&25<h/m&&(c=d);f._movement.angleAndHeight.endPosition[0]=-c*g.width/12;f._movement.angleAndHeight.startPosition[0]=
-d*g.width/12;f._currentTouchTime=new Date;f._touchDisTime.push(n(h,f._currentTouchTime.getTime()-f._lastTouchTime.getTime()));f._lastTouchTime=f._currentTouchTime}},a.PINCH_MOVE),this._eventHandler.setInputAction(function(){f._buttonDown=Math.max(f._buttonDown,0);f._isDown=!1;f._releaseTime=new Date;if(5===f._touchesCount){var a=f._touchDisTime.length;if(!(2>a)){var b,c,d;b=f._touchDisTime[a-1].interDistance/f._touchDisTime[a-1].interTime;c=f._touchDisTime[a-2].interDistance/f._touchDisTime[a-2].interTime;
2<a&&(d=f._touchDisTime[a-3].interDistance/f._touchDisTime[a-3].interTime);2===a&&0>b&&0>c?-10>b||-10>c?(f._doAction=!0,f._movement._isBackToGloble=!0):(f._doAction=!1,f._movement._isBackToGloble=!1):2<a&&0>b&&0>c&&0>d?-10>b||-10>c||-10>d?(f._doAction=!0,f._movement._isBackToGloble=!0):(f._doAction=!1,f._movement._isBackToGloble=!1):(f._doAction=!1,f._movement._isBackToGloble=!1)}}},a.PINCH_END);else if(k===d.TOUCH_DOUBLETAP)f._doAction=null,f._action=null,f._movement={position:e.create(0,0)},f._tapCount=
null,f._firstTapTime=null,f._lastTapTime=null,f._firstTapPosition=null,f._lastTapPosition=null,f._firstPosition=null,this._eventHandler.setInputAction(function(a){f._movement||(f._movement=a);var b=new Date;null!=f._firstTapTime&&500<b.getTime()-f._firstTapTime.getTime()&&(f._tapCount=0,f._action=!1);f._tapCount++;1===f._tapCount?(f._firstTapTime=new Date,f._firstTapPosition=[a.position[0],a.position[1]],f._action=!1):2===f._tapCount&&(f._lastTapTime=new Date,f._lastTapPosition=[a.position[0],a.position[1]],
500>f._lastTapTime.getTime()-f._firstTapTime.getTime()&&null!=f._firstTapPosition&&50>Math.abs(f._firstTapPosition[0]-f._lastTapPosition[0])&&50>Math.abs(f._firstTapPosition[1]-f._lastTapPosition[1])&&(f._action=!0),f._tapCount=0)},a.TAP_START),this._eventHandler.setInputAction(function(a){f._action?(f._doAction=!0,f._movement={endPosition:a.position}):f._doAction=!1},a.TAP_END);else if(k===d.MOUSE_LEFTCLICK)f._doAction=null,f._action=null,f._movement={position:e.create(0,0)},f._tapCount=null,f._firstTapTime=
null,f._lastTapTime=null,f._firstTapPosition=null,f._lastTapPosition=null,f._firstPosition=null,this._eventHandler.setInputAction(function(a){var b=new Date;null!=f._firstTapTime&&500<b.getTime()-f._firstTapTime.getTime()&&(f._tapCount=0,f._action=!0);f._tapCount++;1===f._tapCount?(f._firstTapTime=new Date,f._firstTapPosition=[a.position[0],a.position[1]],f._action=!0):2===f._tapCount&&(f._lastTapTime=new Date,f._lastTapPosition=[a.position[0],a.position[1]],500>f._lastTapTime.getTime()-f._firstTapTime.getTime()&&
null!=f._firstTapPosition&&50>Math.abs(f._firstTapPosition[0]-f._lastTapPosition[0])&&50>Math.abs(f._firstTapPosition[1]-f._lastTapPosition[1])&&(f._action=!1),f._tapCount=0)},a.TAP_START),this._eventHandler.setInputAction(function(a){e.equalsEpsilon(a.startPosition,a.endPosition,1*window.devicePixelRatio)||(f._action=!1)},a.MOUSE_MOVE),this._eventHandler.setInputAction(function(a){f._action?(f._doAction=!0,f._movement={position:a.position}):f._doAction=!1},a.TAP_END);else{var m,q;k===d.MOUSE_LEFTDRAG?
(m=a.LEFT_DOWN,q=a.LEFT_UP):k===d.MOUSE_RIGHTDRAG?(m=a.RIGHT_DOWN,q=a.RIGHT_UP):k===d.MOUSE_MIDDLEDRAG&&(m=a.MIDDLE_DOWN,q=a.MIDDLE_UP);this._eventHandler.setInputAction(function(a){f._lastMovement=null;f._isDown=!0;f._pressTime=new Date},m);this._eventHandler.setInputAction(function(a){f._isDown=!1;f._releaseTime=new Date;h.forceRedraw()},q);this._eventHandler.setInputAction(function(a){f._movement||(f._movement=a);f._isDown&&(f._doAction?e.clone(f._movement.endPosition,a.endPosition):(f._lastMovement=
f._movement,f._movement=a,f._doAction=!0))},a.MOUSE_MOVE)}};h.prototype.finalize=function(){this._eventHandler.finalize()};h.prototype.isDoAction=function(){return this._doAction&&this._movement};h.prototype.getMovement=function(){return this._movement};h.prototype.getLastMovement=function(){return this._lastMovement};h.prototype.isButtonDown=function(){return this._isDown};h.prototype.getButtonPressTime=function(){return this._pressTime};h.prototype.getButtonReleaseTime=function(){return this._releaseTime};
h.prototype.update=function(){this._doAction=!1};h.prototype.reset=function(){this._movement=null};return h});
definejs("Controller/InputManager",["Controller/InputAction","Controller/InputActionType"],function(b,a){var d=function(a){this._touchDoubleTap=this._touchPinch=this._mouseMove=this._leftClick=this._middleDrag=this._mouseWheel=this._rightDrag=this._leftDrag=this._framework=null};d.prototype.initialize=function(a){this._framework=a};d.prototype.finalize=function(){this._leftDrag&&(this._leftDrag.finalize(),this._rightDrag.finalize(),this._middleDrag.finalize(),this._mouseWheel.finalize(),this._leftClick.finalize(),
this._mouseMove.finalize());this._touchDoubleTap=this._touchPinch=this._mouseMove=this._leftClick=this._middleDrag=this._mouseWheel=this._rightDrag=this._framework=null};d.prototype.isDoAction=function(a){return!1};d.prototype.getActionParameter=function(a){return null};d.prototype.update=function(){};d.prototype.isButtonDown=function(){return!1};d.prototype.resetAction=function(a){};return d});
definejs("Controller/AnimationManager",["Controller/AnimationControl","Controller/InputManager"],function(b,a){var d=function(){this._framework=null;this._animationControls=[];this.bUpdate=!1};d.prototype.initialize=function(a){this._framework=a};d.prototype.finalize=function(){this._animationControls=this._framework=null};d.prototype.update=function(a){a.isButtonDown()&&(a=this._framework.getInteractionManager().getCameraController()._camera,this.removeAnimationControls(a));a=new Date;var b=this._animationControls.length;
this.bUpdate=!1;for(var d=0;d<b;d++)this._animationControls[d].value.update(a)&&(this.bUpdate=!0);return this.bUpdate};d.prototype.addAnimationControl=function(a,b){b.setName(a);b.setAnimationManager(this);this._animationControls.push({keyString:a,value:b})};d.prototype.removeAnimationControl=function(a){for(var b=this._animationControls.length,d=0;d<b;d++)if(this._animationControls[d].keyString===a){this._animationControls.splice(d,1);break}};d.prototype.removeAnimationControls=function(a){for(var b=
0;b<this._animationControls.length;)this._animationControls[b].value.getAnimationObject()===a?this._animationControls.splice(b,1):b++};d.prototype.getAnimationControl=function(a){for(var b=this._animationControls.length,d=0;d<b;d++)if(this._animationControls[d].keyString===a)return this._animationControls[d].value};return d});
definejs("Controller/CameraController","Math/Vector3 Math/MathUtils Math/Matrix4 Math/Quaternion Math/Ellipsoid Controller/InteractionManager Controller/AnimationManager Controller/AnimationControl Math/Ray Math/Sphere Math/Vector2".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){function m(a,e){var f=a._camera,g;if("undefined"!==typeof e){g=d.copy(M,f.transform);d.multiply(f.transform,e,g);var m=f.getInverseTransform();b.transformCoord(f._position,f._position,m);c.fromMatrix(F,m);c.multiply(f._orientation,
F,f._orientation)}return g}function q(a,e){if("undefined"!==typeof e){var f=a._camera;b.transformCoord(f._position,f._position,f.transform);c.fromMatrix(C,f.transform);c.multiply(f._orientation,C,f._orientation);d.copy(f.transform,e);e=f.getInverseTransform();b.transformCoord(f._position,f._position,e);c.fromMatrix(C,e);c.multiply(f._orientation,C,f._orientation)}}function x(b,d,e,f){a.matrixENUToECEF(P,b);c.fromMatrix(f,P);c.fromAxisAngle(B,[0,0,1],a.toRadians(d));c.fromAxisAngle(I,[1,0,0],a.toRadians(e));
c.multiply(f,f,B);c.multiply(f,f,I)}function p(b,d,e){a.matrixENUToECEF(P,b);c.fromMatrix(e,P);c.fromAxisAngle(B,[0,0,1],a.toRadians(d));c.multiply(e,e,B)}function s(b,e,f){a.matrixENUToECEF(P,b);c.fromMatrix(y,P);c.inverse(y,y);c.multiply(y,y,e);d.fromQuaternion(P,y);d.toEulerAnglesZXY(K,P);f[0]=a.toDegree(K[0]);f[1]=a.toDegree(K[1])}function r(c,d,f,g){b.clone(g,[a.toRadians(c),a.toRadians(d),f+e.Radius]);a.transformGeographicToECEF(g,g)}function z(a){var d=a.elapse/a.duration,f=a.parameter,g=a.getAnimationObject();
if(1<d)b.clone(g._position,f.targetLookAtPoint),c.clone(g._orientation,f.targetOrientation),d=g.getDirection(),b.scale(v,d,-f.targetRange),b.add(g._position,v,g._position),a.stop();else{a=f.startLookAtPoint;var m=f.rotateAngle,p=f.rotateAxis,h=m*e.Radius*0.5,k=0,k=0,q=0.5*(f.startRange+f.targetRange);h>Math.max(f.startRange,f.targetRange)&&(k=h);0<k||f.targetRange<f.startRange?0.5>d?(c.fromAxisAngle(N,p,m*d*2),c.multiplyVector3(g._position,N,a),c.slerp(g._orientation,f.startOrientation,f.targetOrientation,
2*d),d*=2,k=f.startRange*(1-d)+(q+k)*d):(b.clone(g._position,f.targetLookAtPoint),c.clone(g._orientation,f.targetOrientation),d=Math.pow(2*(1-d),3),k=f.targetRange*(1-d)+(q+k)*d):(c.fromAxisAngle(N,p,m*d),c.multiplyVector3(g._position,N,a),c.slerp(g._orientation,f.startOrientation,f.targetOrientation,d),k=f.startRange*(1-d)+f.targetRange*d);d=g.getDirection();b.scale(v,d,-k);b.add(g._position,v,g._position)}}function t(a,d,f,g,m,p,h,k){d=0.1;var q=k*e.Radius*0.5,r=0,r=0,n=0.5*(m+p);q>Math.max(m,p)&&
(r=q);if(0<r||p<m)if(c.fromAxisAngle(N,h,k*d*2),c.multiplyVector3(Q,N,a),c.slerp(D,f,g,2*d),d*=2,r=m*(1-d)+(n+r)*d,c.multiplyVector3(X,D,[0,0,-1]),b.scale(v,X,-r),b.add(Q,v,Q),s(Q,D,U),0>U[1])return!1;return!0}function w(a){var c=a.elapse/a.duration,d=a.parameter,e=a.getAnimationObject();1<c?(b.clone(e._position,d.targetPosition),a.stop()):(e._position[0]=d.startPosition[0]*(1-c)+d.targetPosition[0]*c,e._position[1]=d.startPosition[1]*(1-c)+d.targetPosition[1]*c,e._position[2]=d.startPosition[2]*
(1-c)+d.targetPosition[2]*c)}function u(a){var d=a.elapse,e=a.parameter,f=a.getAnimationObject(),g=e.keyPoints,d=e.keyDistances,m=e.keyOrientations,p=200*a.elapse;if(p>d[d.length-1])b.clone(f._position,g[g.length-1]),c.clone(f._orientation,m[m.length-1]),e.animationLoop?a.start():a.stop();else{a=d.length;for(e=0;e<a&&!(d[e]>p);e++);d=(p-d[e-1])/(d[e]-d[e-1]);p=g[e-1];g=g[e];f._position[0]=p[0]*(1-d)+g[0]*d;f._position[1]=p[1]*(1-d)+g[1]*d;f._position[2]=p[2]*(1-d)+g[2]*d;e!==a-1?(c.slerp(na,m[e-1],
m[e],d),c.clone(f._orientation,na)):c.clone(f._orientation,m[e-1])}}h=function(){this.constrainedAxis=this._camera=this.framework=null;this._maxCameraTilt=50;this._minCameraHeight=0;this._maxCameraHeight=1.321136161292912E7;this._zoomCallBack=this._headingCallBack=null;this._lastHeading=this._lastZoomScale=0;this._countryLevelHeight=2666831;this._countryLevelScale=0.25;this._stateLevelHeight=310230;this._stateLevelScale=0.4;this._cityLevelHeight=43601;this._cityLevelScale=0.55;this._streetLevelHeight=
1586;this._streetLevelScale=0.85;this._viewCenter=f.create();this._viewLevel=0;this._viewChangeEvetHandle=[];this._cameraBounds=[-90,90,-180,180];this._centerOffset=0};h.prototype.initialize=function(a,c){this.framework=a;this._camera=c;this.constrainedAxis=void 0;this._originalPosition=b.make(113.9959618825029,22.526009851578408,135);this.setPosition(this._originalPosition[0],this._originalPosition[1],this._originalPosition[2],0,0)};h.prototype.finalize=function(){this._camera=this.framework=null;
this.release(this.constrainedAxis)};var v=b.create();h.prototype.zoom=function(a){var c=this._camera,d=c.getDirection(),c=c._position;b.scale(v,d,a);b.add(c,v,c);this.framework.forceRedraw()};var A=c.create();h.prototype.rotate=function(a,b,d){var e=this._camera;d=m(this,d);c.fromAxisAngle(A,a,-b);c.multiply(e._orientation,A,e._orientation);c.multiplyVector3(e._position,A,e._position);q(this,d)};var F=c.create(),M=d.create(),C=c.create(),J=b.create(),O=b.create(),E=b.create(),H=b.create();h.prototype.rotateRight=
function(a,b){var c=-a;"undefined"!==typeof this.constrainedAxis?this.rotate(this.constrainedAxis,c,b):this.rotate(this._camera.getUp(),c,b)};h.prototype.rotateUp=function(c,d){var e=-c,f=this._camera,g=m(this,d),p=b.normalize(J,f._position);if("undefined"!==typeof this.constrainedAxis){var h=b.equalsEpsilon(p,this.constrainedAxis,a.EPSILON2);b.negate(H,this.constrainedAxis);var k=b.equalsEpsilon(p,H,a.EPSILON2);h||k?(h&&0>e||k&&0<e)&&this.rotate(f.getRight(),e):(f=b.normalize(this.constrainedAxis,
O),h=b.dot(p,f),h=Math.acos(h),0<e&&e>h&&(e=h),h=b.dot(p,H),h=Math.acos(h),0>e&&-e>h&&(e=-h),p=b.cross(E,f,p),this.rotate(p,e))}else this.rotate(f.getRight(),e);q(this,g)};var P=b.create(),B=c.create(),I=c.create(),y=c.create(),K=b.create(),G=c.create(),L=b.create();h.prototype.setPosition=function(a,b,c,d,e){var f=this._camera;r(a,b,c,f._position);x(f._position,d,e,f._orientation)};h.prototype.computeHeadingTiltByDirection=function(a,d,e){var f=[0,0,0],g=[0,0,0];b.normalize(d,d);b.normalize(f,a);
b.cross(g,f,d);b.cross(f,d,g);var m=b.create();c.fromAxis(m,g,f,d);s(a,m,e)};h.prototype.gotoLookAt=function(d,f,g,m,h,k){var q=this._camera;r(d,f,g,W);x(W,m,h,q._orientation);c.multiplyVector3(L,q._orientation,[0,0,1]);b.mad(q._position,W,L,k);0!==this._centerOffset&&(d=this._centerOffset,h=a.toRadians(h),f=b.length(R)-e.Radius,q=Math.tan(h-d*q._frustum._fovy*0.5)*f,h=Math.tan(h)*f,q=Math.abs(h-q),0>d&&(q=-q),p(R,m,G),c.multiplyVector3(L,G,[0,1,0]),b.mad(R,R,L,q),b.mad(W,W,L,q));this.framework.forceRedraw()};
var N=c.create();b.create();b.create();var D=c.create(),Q=b.create(),X=b.create();h.prototype.computeLength=function(a,c,d,e){b.normalize(ia,a);b.normalize(ja,c);return Math.acos(b.dot(ia,ja))*(d+e)*0.5};var $=k.create(),ga=n.make([0,0,0],e.Radius),V=b.create(),ha=b.create();h.prototype.getLookAtPoint=function(d,e,f){$._orig=e;c.multiplyVector3(V,f,[0,0,-1]);b.normalize(V,V);$._dir=V;return 0<a.RayIntersectSphere(d,$,ga)?(b.sub(ha,d,e),b.dot(ha,V)):0};h.prototype.setCenterOffset=function(a){this._centerOffset=
a};var fa=b.create(),R=b.create(),T=c.create(),S=c.create(),U=b.create(),W=b.create(),ba=b.create(),ia=b.create(),ja=b.create();b.create();b.create();h.prototype.flyTo=function(d,f,m,h,k,q){var n=this._camera;k>this._maxCameraTilt&&(k=this._maxCameraTilt);var l=this.getLookAtPoint(fa,n._position,n._orientation);"undefined"===typeof q&&(q=l);1E-5>m&&1E-5>q&&(m=1);c.clone(T,n._orientation);s(n._position,n._orientation,U);var A=k,C=R,F=c.create();r(d,f,m,C);x(C,h,A,F);d=b.create();c.multiplyVector3(d,
F,[0,0,-1]);b.scale(d,d,-q);b.add(C,C,d);x(R,h,k,S);0!==this._centerOffset&&(d=this._centerOffset,f=a.toRadians(k),m=b.length(R)-e.Radius,k=Math.tan(f-d*n._frustum._fovy*0.5)*m,f=Math.tan(f)*m,k=Math.abs(f-k),0>d&&(k=-k),p(R,h,G),c.multiplyVector3(L,G,[0,1,0]),b.mad(R,R,L,k),b.mad(W,W,L,k));h=this.getLookAtPoint(W,R,S);b.equalsEpsilon(n._position,R,0.001)&&c.equalsEpsilon(T,S,0.001)||(k=this.framework.getInteractionManager().getAnimationManager(),d=new g,b.normalize(ia,fa),b.normalize(ja,W),b.cross(ba,
ia,ja),b.normalize(ba,ba),f=b.dot(ia,ja),f=Math.min(f,1),f=Math.max(f,-1),f=Math.acos(f),f>0.5*Math.PI&&!t(fa,W,T,S,l,h,ba,f)&&(f=2*Math.PI-f,b.scale(ba,ba,-1)),d.setAnimationObject(n),d.setDuration(1),d.setParameter({startLookAtPoint:fa,targetLookAtPoint:W,startOrientation:T,targetOrientation:S,startRange:l,targetRange:h,rotateAxis:ba,rotateAngle:f}),d.setOnAnimationFrame(z),k.removeAnimationControls(n),k.addAnimationControl("cameraFlyTo",d),d.start())};h.prototype.flyToLookat=function(d,f,m,h,k,
q,n){var l=this._camera;k>this._maxCameraTilt&&(k=this._maxCameraTilt);"undefined"===typeof n&&(n=0.5);var A=this.getLookAtPoint(fa,l._position,l._orientation);"undefined"===typeof q&&(q=A);1E-5>m&&1E-5>q&&(m=1);c.clone(T,l._orientation);s(l._position,l._orientation,U);r(d,f,m,W);x(W,h,k,S);d=q;c.multiplyVector3(L,G,[0,1,0]);b.mad(R,W,L,-q);0!==this._centerOffset&&(q=this._centerOffset,f=a.toRadians(k),m=b.length(R)-e.Radius,k=Math.tan(f-q*l._frustum._fovy*0.5)*m,f=Math.tan(f)*m,k=Math.abs(f-k),0>
q&&(k=-k),p(R,h,G),c.multiplyVector3(L,G,[0,1,0]),b.mad(R,R,L,k),b.mad(W,W,L,k));b.equalsEpsilon(l._position,R,0.001)&&c.equalsEpsilon(T,S,0.001)||(h=this.framework.getInteractionManager().getAnimationManager(),q=new g,b.normalize(ia,fa),b.normalize(ja,W),b.cross(ba,ia,ja),b.normalize(ba,ba),k=b.dot(ia,ja),k=Math.min(k,1),k=Math.max(k,-1),k=Math.acos(k),k>0.5*Math.PI&&!t(fa,W,T,S,A,d,ba,k)&&(k=2*Math.PI-k,b.scale(ba,ba,-1)),q.setAnimationObject(l),q.setDuration(n),q.setParameter({startLookAtPoint:fa,
targetLookAtPoint:W,startOrientation:T,targetOrientation:S,startRange:A,targetRange:d,rotateAxis:ba,rotateAngle:k}),q.setOnAnimationFrame(z),h.removeAnimationControls(l),h.addAnimationControl("cameraFlyTo",q),q.start())};h.prototype.zoomToPlace=function(c,d,f,g,m){10>this._camera._positionGeographic[2]-f-e.Radius&&r(a.toDegree(this._camera._positionGeographic[0]),a.toDegree(this._camera._positionGeographic[1]),f+10,this._camera._position);this.rotateTo(c,d,f);r(c,d,f,W);c=b.distance(W,this._camera._position);
if(1===g){if(10>c)return;c*=m}else c=-c*m;g=this._camera.getDirection();b.scale(v,g,c);b.add(this._camera._position,v,this._camera._position)};h.prototype.rotateTo=function(a,d,e){if(void 0==e||null==e)e=0;var f=this.getLookAtPoint(fa,this._camera._position,this._camera._orientation);b.normalize(ia,fa);r(a,d,e,W);b.normalize(ja,W);b.cross(ba,ia,ja);b.normalize(ba,ba);a=b.dot(ia,ja);a=Math.min(a,1);a=Math.max(a,-1);a=Math.acos(a);c.fromAxisAngle(N,ba,a);c.multiply(this._camera._orientation,N,this._camera._orientation);
a=this._camera.getDirection();b.scale(v,a,-f);b.add(this._camera._position,v,W);this.applyCamera()};h.prototype.setHeadingCallBack=function(a){this._headingCallBack=a};h.prototype.setTiltCallBack=function(a){this._tiltCallback=a};h.prototype.setZoomCallBack=function(a){this._zoomCallBack=a};h.prototype.getHeading=function(){return this._camera._headingTiltRoll[0]};h.prototype.getTilt=function(){return this._camera._headingTiltRoll[1]};h.prototype.setHeading=function(a){s(this._camera._position,this._camera._orientation,
U);x(this._camera._position,a,U[1],this._camera._orientation)};h.prototype.backToGlobe=function(){this.flyTo(this._originalPosition[0],this._originalPosition[1],this._originalPosition[2],0,0,0)};h.prototype.getZoomScaleFromRange=function(a){a<this._minCameraHeight&&(a=this._minCameraHeight);a>this._maxCameraHeight&&(a=this._maxCameraHeight);if(a<=this._streetLevelHeight)return a=(a-this._streetLevelHeight)/(this._minCameraHeight-this._streetLevelHeight),this._streetLevelScale*(1-a)+1*a;if(a<=this._cityLevelHeight)return a=
(a-this._cityLevelHeight)/(this._streetLevelHeight-this._cityLevelHeight),this._cityLevelScale*(1-a)+this._streetLevelScale*a;if(a<=this._stateLevelHeight)return a=(a-this._stateLevelHeight)/(this._cityLevelHeight-this._stateLevelHeight),this._stateLevelScale*(1-a)+this._cityLevelScale*a;if(a<=this._countryLevelHeight)return a=(a-this._countryLevelHeight)/(this._stateLevelHeight-this._countryLevelHeight),this._countryLevelScale*(1-a)+this._stateLevelScale*a;a=(a-this._maxCameraHeight)/(this._countryLevelHeight-
this._maxCameraHeight);return 0*(1-a)+this._countryLevelScale*a};h.prototype.getRangeFromScale=function(a){0>a&&(a=0);1<a&&(a=1);if(a<=this._countryLevelScale)return a=(a-0)/(this._countryLevelScale-0),this._maxCameraHeight*(1-a)+this._countryLevelHeight*a;if(a<=this._stateLevelScale)return a=(a-this._countryLevelScale)/(this._stateLevelScale-this._countryLevelScale),this._countryLevelHeight*(1-a)+this._stateLevelHeight*a;if(a<=this._cityLevelScale)return a=(a-this._stateLevelScale)/(this._cityLevelScale-
this._stateLevelScale),this._stateLevelHeight*(1-a)+this._cityLevelHeight*a;if(a<=this._streetLevelScale)return a=(a-this._cityLevelScale)/(this._streetLevelScale-this._cityLevelScale),this._cityLevelHeight*(1-a)+this._streetLevelHeight*a;a=(a-this._streetLevelScale)/(1-this._streetLevelScale);return this._streetLevelHeight*(1-a)+this._minCameraHeight*a};h.prototype.flyToScale=function(a){var c=this._camera;if(null!==c){a=this.getRangeFromScale(a);var d=this.getLookAtPoint(Z,this._camera._position,
this._camera._orientation)-a,e=c.getDirection();a=b.create();b.scale(v,e,d);b.add(a,v,c._position);d=this.framework.getInteractionManager().getAnimationManager();e=new g;e.setAnimationObject(c);e.setDuration(1);e.setParameter({startPosition:c._position,targetPosition:a});e.setOnAnimationFrame(w);d.removeAnimationControls(c);d.addAnimationControl("cameraFlyToScale",e);e.start()}};h.prototype.zoomScale=function(a){null!==this._camera&&(a=this.getRangeFromScale(a),a=this.getLookAtPoint(Z,this._camera._position,
this._camera._orientation)-a,this.zoom(a))};var ka=b.create(),pa=d.create(),ca=d.create();h.prototype.adjustTilt=function(){var c=a.eastNorthUpToFixedFrame(this._camera._position,pa),e=b.clone(ka,this._camera.getDirection());d.inverse(ca,c);b.transformNormal(e,e,ca);var f=a.toRadians(this._maxCameraTilt),e=-b.dot(e,[0,0,1]),e=Math.acos(e);e>f&&this.rotateUp(-(e-f),c)};h.prototype.updateMinMaxCameraHeight=function(b,c){b=a.toDegree(b);c=a.toDegree(c);109.64470527515432<b&&109.77346469166194>b&&28.20465583705492<
c&&28.362614011995802>c&&(this._minCameraHeight=300);109.57791002916993<b&&109.62769909097632>b&&27.937199380772324<c&&27.970488683891098>c&&(this._minCameraHeight=400);109.57398431187902<b&&109.61520377745518>b&&28.314819589760262<c&&28.351162649240898>c&&(this._minCameraHeight=250)};var ea=b.create(),na=c.create();c.create();var Z=b.create(),ta=0,Y=0;b.create();h.prototype.applyCamera=function(){a.transformECEFToGeographic(ea,this._camera._position);this.updateMinMaxCameraHeight(ea[0],ea[1]);var c=
this._cameraBounds;if(c[0]>c[1]){var d=this.getLookAtPoint(Z,this._camera._position,this._camera._orientation);a.transformECEFToGeographic(Z,Z);var f=this._camera.getDirection();Z[0]=Z[0]>c[2]?c[2]:Z[0];Z[0]=Z[0]<c[3]?c[3]:Z[0];Z[1]=Z[1]>c[0]?c[0]:Z[1];Z[1]=Z[1]<c[1]?c[1]:Z[1];a.transformGeographicToECEF(Z,Z);b.mad(this._camera._position,Z,f,-d);a.transformECEFToGeographic(ea,this._camera._position)}c=ea[2]-e.Radius;c<this._minCameraHeight&&(ea[2]=this._minCameraHeight+e.Radius);c>this._maxCameraHeight&&
(ea[2]=this._maxCameraHeight+e.Radius);a.transformGeographicToECEF(this._camera._position,ea);s(this._camera._position,this._camera._orientation,U);var f=U[0],g=U[1];g>this._maxCameraTilt&&this.adjustTilt();this._camera.apply();var d=this.getLookAtPoint(Z,this._camera._position,this._camera._orientation),m=this._camera;if(0<d){var p=this.getZoomScaleFromRange(d),k=this.getLevelFromScale(p);a.transformECEFToGeographic(Z,Z);Z[0]=a.toDegree(Z[0]);Z[1]=a.toDegree(Z[1]);if(1E-6<Math.abs(Z[0]-this._viewCenter[0])||
1E-6<Math.abs(Z[1]-this._viewCenter[1])||k!=this._viewLevel||0!==ta&&0.1<Math.abs(ta-c)||0!==Y&&0.1<Math.abs(Y-g))for(this._viewCenter[0]=Z[0],this._viewCenter[1]=Z[1],this._viewLevel=k,d=0.5*Math.tan(m._frustum._fovy)/(0.5*m._viewportHeight)*Math.abs(d),m._viewLevel=parseInt(Math.log(6378137*Math.PI/(256*d))/Math.log(2)),m._viewLevel+=1,d=this._viewChangeEvetHandle.length,m=0;m<d;m++)this._viewChangeEvetHandle[m]({type:"viewChange"});0.1<Math.abs(this._lastTilt-g)&&this._tiltCallback&&(this._lastTilt=
g,this._tiltCallback(g));ta=c;Y=g;1E-6<Math.abs(this._lastZoomScale-p)&&null!==this._zoomCallBack&&(this._lastZoomScale=p,this._zoomCallBack(p))}if(1E-6<Math.abs(this._lastHeading-f)){null!==this._headingCallBack&&this._headingCallBack(f);d=this._viewChangeEvetHandle.length;for(m=0;m<d;m++)this._viewChangeEvetHandle[m]({type:"viewChange"});this._lastHeading=f}};h.prototype.flyAlongPath=function(a){var d=this._camera;if(null!==d&&a&&a.flyPath){for(var e=a.flyPath.split(";"),f=e.length,m=[],p=0;p<f&&
e[p];p++){var k=e[p].split(","),h=parseFloat(k[0]),q=parseFloat(k[1]),k=parseFloat(k[2]),n=b.make(h,q,k);0===m.length?m.push(n):(h=b.distance(n,m[m.length-1]),h>50/11E4&&m.push(n))}for(var f=m.length,e=Array(f),n=Array(f),l=Array(f-1),A=b.create(),C=b.create(),t=b.create(),p=0;p<f;p++)k=m[p],h=k[0],q=k[1],k=k[2],e[p]=b.create(),r(h,q,k,e[p]),0===p?n[p]=0:(h=b.distance(e[p],e[p-1]),n[p]=n[p-1]+h,h=e[p-1],b.sub(A,h,e[p]),b.normalize(A,A),b.normalize(C,h),b.cross(t,C,A),b.cross(C,A,t),h=b.create(),c.fromAxis(h,
t,C,A),l[p-1]=h);f=this.framework.getInteractionManager().getAnimationManager();m=new g;m.setAnimationObject(d);m.setDuration(1);m.setParameter({keyPoints:e,keyDistances:n,keyOrientations:l,animationLoop:a.flyLoop});m.setOnAnimationFrame(u);f.removeAnimationControls(d);f.addAnimationControl("cameraFlyAlongPath",m);m.start()}};h.prototype.getScaleFromLevel=function(b){var c=0;a.clamp(b,3,18);3===b?c=0:3<b&&15>b?c=b/15:15<=b&&(c=(14+0.2*(b-13))/15);return c};h.prototype.getLevelFromScale=function(a){var b=
3;return b=0.266>a?3:0.266<=a&&0.94>=a?parseInt(15*a+0.5):parseInt((a-14.4/15)/0.2*15+15.5)};h.prototype.setViewRange=function(a){if(1E-6<Math.abs(a.lon-this._viewCenter[0])||1E-6<Math.abs(a.lat-this._viewCenter[1])||a.level!=this._viewLevel)this.rotateTo(a.lon,a.lat),a=this.getScaleFromLevel(a.level),this.zoomScale(a)};h.prototype.getViewRange=function(){var a={};a.lon=this._viewCenter[0];a.lat=this._viewCenter[1];a.level=this._viewLevel;return a};h.prototype.setMapRect=function(a,b,c,d){a=this._camera._viewportHeight;
this._centerOffset=(0.5*(b+d)-0.5*a)/(0.5*a)};var ra=b.create(),qa=b.create();h.prototype.getCameraPose=function(){var b=this._camera,c={},d=this.getLookAtPoint(ra,b._position,b._orientation);a.transformECEFToGeographic(ra,ra);a.transformECEFToGeographic(qa,b._position);c.lng=qa[0]*a.DEGREE_PER_RADIANS;c.lat=qa[1]*a.DEGREE_PER_RADIANS;c.alt=qa[2]-e.Radius;c.target_lng=ra[0]*a.DEGREE_PER_RADIANS;c.target_lat=ra[1]*a.DEGREE_PER_RADIANS;c.target_alt=ra[2]-e.Radius;c.heading=b._headingTiltRoll[0];c.tilt=
b._headingTiltRoll[1];c.roll=0;c.range=d;return c};h.prototype.removeEvent=function(a){"viewChange"==a&&(this._viewChangeEvetHandle=[])};h.prototype.registerEvent=function(a,b){"viewChange"==a&&this._viewChangeEvetHandle.push(b)};h.prototype.setCameraBounds=function(b,c,d){if(b){void 0!==c&&(this._maxCameraHeight=c);void 0!==d&&(this._minCameraHeight=d);b=b.split(";");c=a.toRadians(parseFloat(b[0]));d=a.toRadians(parseFloat(b[1]));var e=a.toRadians(parseFloat(b[2]));this._cameraBounds=[a.toRadians(parseFloat(b[3])),
d,e,c]}};h.prototype.setBounds=function(a){if(a){var c=a.split(";");a=parseFloat(c[0]);var d=parseFloat(c[1]),e=parseFloat(c[2]),c=parseFloat(c[3]),f=this._camera;this.rotateTo(0.5*(a+e),0.5*(d+c));this.zoomScale(0);f.apply();if(f.isVisible(a,d,1)&&f.isVisible(e,c,1)){var g=b.create();f.projectionFromGeo(g,a,d,0);g[2]=0;var m=b.create();f.projectionFromGeo(m,e,c,0);m[2]=0;b.distance(g,m);for(var p=0,g=1,k=0;;)if(m=0.5*(p+g),this.zoomScale(m),f.apply(),f.isVisible(a,d,1)&&f.isVisible(e,c,1))if(p=f._positionGeographic[2],
100>Math.abs(k-p))break;else k=p,p=m;else g=m}}};return h});
definejs("Controller/InteractionManager",["Controller/AnimationManager","Controller/InputManager","Controller/CameraController"],function(b,a,d){b=function(){this._camraController=this._inputManager=this._animationManager=this.framework=null;this._inputControls=[]};b.prototype.initialize=function(a){this.framework=a;this._camraController=this._inputManager=this._animationManager=null};b.prototype.finalize=function(){this._inputManager&&(this.stopCameraAnimation(),this._inputManager.finalize());this._camraController=
this._inputManager=this._animationManager=this.framework=null};b.prototype.setCameraController=function(a){this._camraController=a};b.prototype.getCameraController=function(){return this._camraController};b.prototype.setInputManager=function(a){this._inputManager=a};b.prototype.getInputManager=function(){return this._inputManager};b.prototype.AddInputControl=function(a){this._inputControls.push(a)};b.prototype.getInputControl=function(a){for(var b=this._inputControls.length,d=0;d<b;d++){var l=this._inputControls[d];
if(l.type===a)return l}return null};b.prototype.setAnimationManager=function(a){this._animationManager=a};b.prototype.getAnimationManager=function(){return this._animationManager};b.prototype.stopCameraAnimation=function(){if(null!==this._camraController){var a=this._camraController._camera;null!==a&&null!==this._animationManager&&this._animationManager.removeAnimationControls(a)}a=this.getInputControl("CameraInputControl");null!==a&&this._inputManager&&a.stopCameraInertia(this._inputManager)};b.prototype.beginUpdate=
function(){for(var a=this._animationManager.update(this._inputManager),b=this._inputControls.length,d=!1,l=0;l<b;l++)if(this._inputControls[l].beginUpdate(this._inputManager)){d=!0;break}return a||d};b.prototype.endUpdate=function(){for(var a=this._inputControls.length,b=!1,d=0;d<a;d++)b?this._inputControls[d].endUpdate(!1):b=this._inputControls[d].endUpdate(this._inputManager);null!=this._inputManager&&this._inputManager.update()};return b});
definejs("Resource/TileCache",["Framework/AppState"],function(b){var a=function(){this._nextCache=this._currentCache=this._tileLUT=this.framework=null};a.prototype.initialize=function(a){this.framework=a;this._tileLUT={};this._currentCache=[];this._nextCache=[]};a.prototype.finalize=function(){this._nextCache=this._currentCache=this._tileLUT=this.framework=null};a.prototype.clearFlags=function(){for(var a=this._currentCache,b=a.length,e=0;e<b;++e)a[e].used=0};a.prototype.cleanCache=function(a){var c=
this._currentCache,e=c.length,h=this._nextCache;if(e>a){var l=e-a;for(a=0;a<e;a++){var g=c[a];if(0<l){if(2!=g.used){if(void 0!==g.lifeTimeList){var k=g.lifeTimeList[g.level];if(-1===k)continue;if(b.frame_states.frame_counter-g.frameCounter<k)continue}g.removeResource();0==g.used&&(this.removeTile(g.keyString),c[a].isRootTile()||c[a].finalize(),c[a]=null,l--)}}else 0==g.used&&null!==g.patch&&g.isAborted()&&g.removeResource()}for(a=h.length=0;a<e;a++)g=c[a],!g||0!=g.used&&1!=g.used&&2!=g.used||h.push(g);
this._currentCache=h;this._nextCache=c}};a.prototype.findTile=function(a){return this._tileLUT[a]};a.prototype.createTile=function(a,b,e){var h=this._tileLUT,l=h[a];void 0===l&&(l=b(a,e),h[a]=l,this._currentCache.push(l));return l};a.prototype.removeTile=function(a){this._tileLUT[a]=null;delete this._tileLUT[a]};return a});
definejs("Resource/TileCacheManager",["Resource/TileCache"],function(b){b=function(){this.tileCache=null};b.prototype.initialize=function(a){this.tileCache=[]};b.prototype.finalize=function(){for(var a=this.tileCache,b=a.length,c=0;c<b;++c)a[c].clearFlags(),a[c].cleanCache(0);this.tileCache=null};b.prototype.add=function(a){this.tileCache.push(a)};b.prototype.clearFlags=function(){for(var a=this.tileCache,b=a.length,c=0;c<b;++c)a[c].clearFlags()};b.prototype.cleanCaches=function(){for(var a=this.tileCache,
b=a.length,c=0;c<b;++c)a[c].cleanCache(100)};return b});
definejs("Resource/UploadQueue",[],function(){function b(a,b){return b.priority-a.priority}var a=function(){this._resource=this.framework=null};a.prototype.initialize=function(a){this.framework=a;this._resource=[]};a.prototype.finalize=function(){this._resource=this.framework=null};a.prototype.clear=function(){this._resource.length=0};a.prototype.execute=function(a,b){for(var e=0,h=this._resource,l=this.framework,g=h.length;e<g;++e){var k=h[e];k&&(k.isReady()||k.upload(),k.isReady()&&(h[e]=null,l.setNewDataReady(!0)))}};
a.prototype.add=function(a){this._resource.push(a)};a.prototype.sort=function(a){this._resource.sort(b)};return a});
definejs("Resource/BufferPool",[],function(){var b=function(a){this.freedBufferSlots=[];this.allocationSize=this.usedBufferCount=0};b.prototype.initialize=function(a){this._gl=a};b.prototype.finalize=function(){this._gl=null};b.prototype.prepare=function(a){for(var b=this._gl,c=this.freedBufferSlots;c.length<a;){var e=null;try{e=b.createBuffer()}catch(h){e=null}if(null===e){console.log("error: cannot create buffer");break}c.push(e)}};b.prototype.check=function(a){return this.freedBufferSlots.length>=
a};b.prototype.allocate=function(a,b,c,e,h){if(void 0===b)return null;var l=this._gl;this.usedBufferCount++;var g=this.freedBufferSlots;if(0<g.length)g=g.pop();else return console.log("warning: not enough gl buffers in a pool"),null;var k=!1;void 0!==h&&(k=!0);l.bindBuffer(a,g);l.bufferData(a,b,l.STATIC_DRAW);h=0;a===l.ELEMENT_ARRAY_BUFFER?(h=b.length*c,g.itemSize=1,2===c?g.elementType=l.UNSIGNED_SHORT:4===c&&(g.elementType=l.UNSIGNED_INT)):(h=4*b.length,void 0===e?(g.itemSize=c/4,g.type=l.FLOAT,
g.normalized=!1):e===l.UNSIGNED_BYTE?(g.itemSize=c,g.type=l.UNSIGNED_BYTE,g.normalized=!0):e===l.UNSIGNED_SHORT?(g.itemSize=c/2,g.type=l.UNSIGNED_SHORT,g.normalized=k):e===l.UNSIGNED_INT&&(g.itemSize=c/4,g.type=l.UNSIGNED_INT,g.normalized=k));this.allocationSize+=h;g.byteSize=h;g.numItems=b.length;return g};b.prototype.destroy=function(a){if(void 0!==a){var b=this._gl;this.usedBufferCount--;this.allocationSize-=a.byteSize;b.deleteBuffer(a)}};b.prototype.getBuffersCount=function(){return this.usedBufferCount};
b.prototype.getAllocationSize=function(){return this.allocationSize};return b});
definejs("Resource/MeshAllocator",["Framework/ConfigOptions","Resource/BufferPool"],function(b,a){var d=function(){this.meshAllocator=this.framework=null;this._meshUploadPerFrameQuota=this._vertsUploadPerFrameQuota=0};d.prototype.initialize=function(c){this.framework=c;this.max_mesh_upload_count_per_frame=b.max_mesh_upload_count_per_frame;this.max_vertex_upload_count_per_frame=b.max_vertex_upload_count_per_frame;this.meshAllocator=new a;this.meshAllocator.initialize(c.renderDevice._gl)};d.prototype.finalize=
function(){this.meshAllocator=this.framework=null};d.prototype.beginFrame=function(){this.meshAllocator.prepare(b.availble_buffer_count_per_frame);this._vertsUploadPerFrameQuota=b.max_vertex_upload_count_per_frame;this._meshUploadPerFrameQuota=b.max_mesh_upload_count_per_frame};d.prototype.canUpload=function(a,b){var d=this._vertsUploadPerFrameQuota;return 0>=this._meshUploadPerFrameQuota||!this.meshAllocator.check(a)||0>d?!1:!0};d.prototype.notifyUpload=function(a){this._meshUploadPerFrameQuota--;
this._vertsUploadPerFrameQuota-=a};d.prototype.allocateBuffer=function(a,b,d,l,g){return this.meshAllocator.allocate(a,b,d,l,g)};d.prototype.releaseBuffer=function(a){this.meshAllocator.destroy(a)};d.prototype.release=function(){this.meshAllocator.releasePool()};return d});
definejs("Math/Extent",[],function(){var b=function(){this._maxHeight=this._minHeight=this._west=this._east=this._south=this._north=0;this.cornerValue=null;this.radius=0};b.create=function(){return new b};b.createInvalid=function(){var a=new b;a._north=-999999999;a._south=999999999;a._east=-999999999;a._west=999999999;a._minHeight=999999999;a._maxHeight=-999999999;a.radius=0;return a};b.clone=function(a){retVal=new b;retVal._north=a._north;retVal._south=a._south;retVal._east=a._east;retVal._west=
a._west;retVal._minHeight=a._minHeight;retVal._maxHeight=a._maxHeight;return retVal};b.copy=function(a,b){a._north=b._north;a._south=b._south;a._east=b._east;a._west=b._west;a._minHeight=b._minHeight;a._maxHeight=b._maxHeight;return a};b.getCenter=function(a,b){a[0]=0.5*(b._east+b._west);a[1]=0.5*(b._north+b._south);a[2]=0.5*(b._minHeight+b._maxHeight)};b.getWidth=function(a){return a._east-a._west};b.getHeight=function(a){return a._north-a._south};b.makeInvalid=function(a){a._north=-999999999;a._south=
999999999;a._east=-999999999;a._west=999999999;a._minHeight=999999999;a._maxHeight=-999999999;a.radius=0};b.isValid=function(a){return a._south<=a._north&&a._west<=a._east&&a._minHeight<a._maxHeight};b.isValidRect=function(a){return a._south<=a._north&&a._west<=a._east};b.combine=function(a,b,c){a._north=Math.max(b._north,c._north);a._south=Math.min(b._south,c._south);a._east=Math.max(b._east,c._east);a._west=Math.min(b._west,c._west);a._maxHeight=Math.max(b._maxHeight,c._maxHeight);a._minHeight=
Math.min(b._minHeight,c._minHeight)};b.mergePoint=function(a,b,c){a._north=Math.max(b._north,c[1]);a._south=Math.min(b._south,c[1]);a._east=Math.max(b._east,c[0]);a._west=Math.min(b._west,c[0]);a._maxHeight=Math.max(b._maxHeight,c[2]);a._minHeight=Math.min(b._minHeight,c[2])};b.getBoundSphere=function(a,d){b.getCenter(a,d);a[3]=d.radius};return b});
definejs("Resource/ResourceState",[],function(){return{TEXTURE_ERROR:-1,TEXTURE_WAITING:0,TEXTURE_LOADING:1,TEXTURE_ABORTING:2,TEXTURE_LOADED:3,TEXTURE_READY:4,RESOURCE_ERROR_MISS:-2,RESOURCE_ERROR:-1,RESOURCE_WAITING:0,RESOURCE_PENDING_DISPATCH:1,RESOURCE_LOADING:2,RESOURCE_ABORTING:3,RESOURCE_LOADED:4,RESOURCE_COMPILED:5,RESOURCE_TEXTURES_READY:6,RESOURCE_READY:7}});
definejs("Resource/PVRParser",[],function(){var b={RGB_PVRTC_4BPPV1_Format:2100,RGB_PVRTC_2BPPV1_Format:2101,RGBA_PVRTC_4BPPV1_Format:2102,RGBA_PVRTC_2BPPV1_Format:2103,parse:function(a,d){var c=new Uint32Array(a,0,13),e={buffer:a,header:c,loadMipmaps:d};if(55727696===c[0])return b._parseV3(e);if(559044176===c[11])return b._parseV2(e)},_parseV3:function(a){var d=a.header,c,e,h=d[12];c=d[2];var l=d[6],g=d[7],k=d[10],d=d[11];switch(c){case 0:c=2;e=b.RGB_PVRTC_2BPPV1_Format;break;case 1:c=2;e=b.RGBA_PVRTC_2BPPV1_Format;
break;case 2:c=4;e=b.RGB_PVRTC_4BPPV1_Format;break;case 3:c=4;e=b.RGBA_PVRTC_4BPPV1_Format;break;default:throw Error("pvrtc - unsupported PVR format "+c);}a.dataPtr=52+h;a.bpp=c;a.format=e;a.width=g;a.height=l;a.numSurfaces=k;a.numMipmaps=d;a.isCubemap=6===k;return b._extract(a)},_parseV2:function(a){var d=a.header,c=d[0],e=d[1],h=d[2],l=d[3],g=d[6],k=d[12],g=d[4]&255,d=0<d[10];if(25===g)d=d?b.RGBA_PVRTC_4BPPV1_Format:b.RGB_PVRTC_4BPPV1_Format,g=4;else if(24===g)d=d?b.RGBA_PVRTC_2BPPV1_Format:b.RGB_PVRTC_2BPPV1_Format,
g=2;else throw Error("pvrtc - unknown format "+g);a.dataPtr=c;a.bpp=g;a.format=d;a.width=h;a.height=e;a.numSurfaces=k;a.numMipmaps=l+1;a.isCubemap=6===k;return b._extract(a)},_extract:function(a){var b={mipmaps:[],width:a.width,height:a.height,format:a.format,mipmapCount:a.numMipmaps,isCubemap:a.isCubemap},c=a.buffer,e=a.dataPtr,h=a.bpp,l=a.numSurfaces,g=0,k=0,n=0,f=0,m=g=0,n=2===h?8:4,f=4,k=n*f*h/8;b.mipmaps.length=a.numMipmaps*l;for(h=0;h<a.numMipmaps;){var q=a.width>>h,x=a.height>>h,g=q/n,m=x/
f;2>g&&(g=2);2>m&&(m=2);g=g*m*k;for(m=0;m<l;m++){var p={data:new Uint8Array(c,e,g),width:q,height:x};b.mipmaps[m*a.numMipmaps+h]=p;e+=g}h++}return b}};return b});
definejs("Resource/Texture","Framework/AppState Framework/ConfigOptions Math/Extent Renderer/PixelFormat Resource/ResourceState Resource/PVRParser".split(" "),function(b,a,d,c,e,h){function l(){var a=this.texture;a.state!==e.TEXTURE_ABORTING&&(m--,a.state=e.TEXTURE_LOADED,a.upload());a.pendingCounter&&(a.pendingCounter.counter--,a.pendingCounter=null);this.texture=null}function g(){var a=this.texture;a.state=e.TEXTURE_ERROR;m--;a.pendingCounter&&(a.pendingCounter.counter--,a.pendingCounter=null);
this.texture=null}function k(){var a=this.texture;a.state!==e.TEXTURE_ABORTING&&(m--,a.state=e.TEXTURE_LOADED,a.upload());a.pendingCounter&&(a.pendingCounter.counter--,a.pendingCounter=null);this.texture=null;window.URL.revokeObjectURL(this.src)}function n(a){var b=new Image;b.onerror=g;b.onload=k;b.texture=a;b.crossOrigin="Anonymous";var c=a.reqCounter;c.counter++;a.pendingCounter=c;window.URL=window.URL||window.webkitURL;c=new XMLHttpRequest;c.open("GET",a.url,!0);-1===a.url.indexOf(".pvr")?c.responseType=
"blob":c.responseType="arraybuffer";c.onload=function(c){if(4===this.readyState&&(200===this.status||0===this.status||304===this.status)){c=this.response;var d=!0;void 0!==a.checkValid&&(d=a.checkValid(c));-1!==a.url.indexOf(".pvr")?(a.texDatas=h.parse(c,!0),void 0!==a.texDatas?(a.state=e.TEXTURE_LOADED,a.image.naturalWidth=a.texDatas.width,a.image.naturalHeight=a.texDatas.height,a.mipmap=!1,a.upload()):a.state=e.TEXTURE_ERROR):d&&(b.src=window.URL.createObjectURL(c))}};c.send(null);m++;return b}
var f=b.texture_count,m=b.texture_request_count,q=function(a,d){f++;b.texture_count++;this.framework=a;this.allocator=a.textureAllocator;this.name=null;this.dataSource=d;this.url=this.pendingCounter=this.reqCounter=this.textureGL=this.image=null;this.clamp=!1;this.mipmap=!0;this.state=e.TEXTURE_WAITING;this.refCount=this.height=this.width=this.pixelsSize=this.lastFrameUsed=0;this.imageryExtent=null;this._pixelFormat=c.RGB};q.prototype.initialize=function(a,b,c){this.name=b;this.url=c;this.imageryExtent=
new d;this.reqCounter=this.framework.downloadController.getCounter(a)};q.prototype.isReady=function(){return this.state===e.TEXTURE_READY};q.prototype.isError=function(){return this.state===e.TEXTURE_ERROR};q.prototype.isWaiting=function(){return this.state===e.TEXTURE_WAITING};q.prototype.isAborted=function(){return this.state===e.TEXTURE_ABORTING};q.prototype.upload=function(){return this.state===e.TEXTURE_WAITING&&!this.startDownload()||this.state!==e.TEXTURE_LOADED?0:this.dataSource?this.dataSource.upload(this):
q.uploadToDevice(this)};q.uploadToDevice=function(a){var b=a.framework,c=a.image.naturalWidth*a.image.naturalHeight,d=a.allocator;if(!d.canUpload(1,c))return b.forceRedraw(),0;var f=b.renderDevice._gl,g=3*c;a.mipmap&&(g=Math.floor(4*g/3));g=d.allocateTexture(g);if(null===g)return a.allocator.notifyUpload(c),0;void 0==a.flipY&&(a.flipY=!1);try{f.bindTexture(f.TEXTURE_2D,g),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,a.flipY),f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,a.image),f.texParameteri(f.TEXTURE_2D,
f.TEXTURE_MAG_FILTER,f.LINEAR),a.mipmap?f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR_MIPMAP_NEAREST):f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),a.clamp&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.CLAMP_TO_EDGE),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.CLAMP_TO_EDGE)),a.mipmap&&f.generateMipmap(f.TEXTURE_2D),f.bindTexture(f.TEXTURE_2D,null),a.state=e.TEXTURE_READY}catch(m){if(null!==g)return d.releaseTexture(g),d.notifyUpload(c),0}a.width=a.image.naturalWidth;
a.height=a.image.naturalHeight;a.pixelsSize=c;a.image=null;a.textureGL=g;a.textureGL.loaded=!0;d.notifyUpload(c);b.forceRedraw();return c};q.prototype.getPixelFormat=function(){return this._pixelFormat};q.prototype.release=function(){this.refCount--;f--;b.texture_count--;this.dataSource&&this.dataSource.deleteResource(this.name);null!==this.textureGL&&(b.texture_real_release_count++,this.allocator.releaseTexture(this.textureGL),this.textureGL=null);this.pendingCounter&&(this.pendingCounter.counter--,
this.pendingCounter=null);this.state===e.TEXTURE_LOADING?(this.state=e.TEXTURE_ABORTING,this.image.onload=null,this.image.onerror=null,m--):this.state===e.TEXTURE_WAITING&&(this.state=e.TEXTURE_ERROR);null!==this.image&&(this.image=null,delete this.image)};q.prototype.startDownload=function(){var a=!1;void 0!==this.requestByBlob&&(a=this.requestByBlob);if(this.state===e.TEXTURE_WAITING){var b=this.reqCounter;if(b.counter<b.limit)return this.state=e.TEXTURE_LOADING,a?this.image=n(this):(a=new Image,
a.onerror=g,a.onload=l,a.texture=this,a.crossOrigin="Anonymous",b=this.reqCounter,b.counter++,this.pendingCounter=b,a.src=this.url,m++,this.image=a),!0}return!1};return q});
definejs("Resource/TexturePool",[],function(){var b=function(){this._gl=null;this._unusedTextures=[];this._allocationSize=this._usedTextureCount=0};b.prototype.initialize=function(a){this._gl=a};b.prototype.finalize=function(){this._gl=null};b.prototype.prepare=function(a){for(var b=this._gl,c=this._unusedTextures;c.length<a;){var e=null;try{e=b.createTexture()}catch(h){e=null}if(null===e){console.log("error: cannot create texture");break}c.push(e)}};b.prototype.check=function(a){return this._unusedTextures.length>=
a};b.prototype.getAllocationSize=function(){return this._allocationSize};b.prototype.allocate=function(a){this._usedTextureCount++;var b=this._unusedTextures,c=null;0<b.length?(c=b.pop(),c.byteSize=a,this._allocationSize+=a):(console.log("warning: not enough textures in a pool"),c=null);return c};b.prototype.destroy=function(a){var b=this._gl;this._usedTextureCount--;this._allocationSize-=a.byteSize;b.deleteTexture(a)};b.prototype.releasePool=function(){for(var a=this._unusedTextures,b=a.length,c=
0;c<b;++c){var e=a[c];e&&this.destory(e)}a.length=0};return b});
definejs("Resource/TextureAllocator",["Framework/ConfigOptions","Resource/Texture","Resource/TexturePool"],function(b,a,d){var c=function(){this._texturePool=this.framework=null;this._textureUploadPerFrameQuota=this._textureUploadPerFrameLimits=0};c.prototype.initialize=function(a){this.framework=a;this._textureUploadPerFrameLimits=b.max_texture_upload_pixels_per_frame;this._texturePool=new d;this._texturePool.initialize(a.renderDevice._gl)};c.prototype.finalize=function(){this.framework=null};c.prototype.beginFrame=
function(){this._texturePool.prepare(b.availble_texture_count_per_frame);this._textureUploadPerFrameQuota=b.max_texture_upload_pixels_per_frame};c.prototype.canUpload=function(a,b){return!this._texturePool.check(a)||0>this._textureUploadPerFrameQuota?!1:!0};c.prototype.notifyUpload=function(a){this._textureUploadPerFrameQuota-=a};c.prototype.allocateTexture=function(a){return this._texturePool.allocate(a)};c.prototype.releaseTexture=function(a){return this._texturePool.destroy(a)};c.prototype.release=
function(){this._texturePool.releasePool()};c.prototype.createTexture=function(){return new a(this.framework,this)};return c});
definejs("Resource/DownloadController",["Framework/ConfigOptions"],function(b){var a=function(){this.framework=null},d={};a.prototype.initialize=function(a){for(a=0;a<b.data_providers.length;++a){var e=b.data_providers[a];void 0===d[e.type]&&(d[e.type]={next_server:0,request_counters:[]});for(var h=d[e.type].request_counters,l=b.download_controller_options[e.type].limit,g=e.data_servers,k=g.length,n=0;n<k;++n)h.push({main_path:g[n].url+e.data_main_path,name:g[n].name,type:g[n].type,counter:0,limit:l})}};
a.prototype.getCounter=function(a,b){var h=d[a];if(void 0!==h)return h.next_server=(h.next_server+1)%h.request_counters.length,h.request_counters[h.next_server]};a.prototype.finalize=function(){this.framework=null};return a});
definejs("Renderer/RenderFontManager",["Renderer/RenderFont"],function(b){var a=function(){this.framework=null;this._fonts={}};a.prototype.initialize=function(a){this.framework=a};a.prototype.finalize=function(){this.framework=null};a.prototype.flush=function(){for(var a in this._fonts)this._fonts[a].apply()};a.prototype.createFont=function(a,c,e,h){h=void 0==h?!1:h;var l=a+"_"+c+"_"+e,g=this._fonts,k=g[l];void 0===k&&(k=new b,k.faceName=a,k.isBold=c,k.fontWidth=parseInt(e),k.fontHeight=parseInt(e),
k.outline=h,k.initialize(this.framework),g[l]=k);return k};return a});
definejs("Style/LabelStyle","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Renderer/RenderFont Renderer/RenderFontManager Framework/ConfigOptions".split(" "),function(b,a,d,c,e,h,l){b=function(){this.renderDevice=this.framework=null;this.imageUrl="";this.image=void 0;this.fontName="10px Arial";this.srcRect=c.create();this.destRect=c.create();c.assign(this.destRect,0,0,24,24);this.texture=null;this.alignment="h_center|v_center";this.font=null;this.color="ff00ff";this.scale=1;this.backgroundColor=
"000000"};b.prototype.initialize=function(a){this.framework=a;this.faceName=(l.RenderFont||{}).faceName||"Calibri";this.isBold=!1;this.fontHeight=this.fontWidth=16;this.font=a._fontManager.createFont(this.faceName,this.isBold,this.fontHeight,!0);var b=this.imageUrl;0<b.length&&(this.texture="texture/wall_ssao.jpg"===b?a.getTextureManager().createTextureEx(b,l.textureDataURLMap[b]):"texture/floor_default.png"===b?a.getTextureManager().createTextureEx(b,l.textureDataURLMap[b]):a.getTextureManager().createTextureEx(b,
b));void 0!==this.image&&(this.texture=a.getTextureManager().createTextureFromImage(this.image))};b.prototype.finalize=function(){};return b});
definejs("Scene/Vector/MarkerStyle","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Renderer/RenderFont Framework/Framework".split(" "),function(b,a,d,c,e,h){function l(){return(65536*(1+Math.random())|0).toString(16).substring(1)}b=function(){this._framework=null;this.name="";this.type="LabelStyle";this.srcRects=[];this.textures=[];this.imageUrls=[];this.image=[];this.dstRect=c.create()};b.prototype.initialize=function(a){function b(){a.forceRedraw()}this._framework=a;for(var c=0;c<this.imageUrls.length;c++)this.textures[c]=
a.getTextureManager().createTexture(this.imageUrls[c],void 0,void 0,b);for(c=0;c<this.image.length;c++)this.textures[c]=a.getTextureManager().createTextureFromImage(l()+l()+l()+l()+l()+l()+l()+l(),this.image[c])};b.prototype.finalize=function(){for(var a=0;a<this.imageUrls.length;a++)this._framework.getTextureManager().releaseTexture(this.imageUrls[a]),this.textures[a]=null};b.prototype.draw=function(a,b,d,e,m,h,l){a=this.srcRects[h];var p=this.textures[h];if(null!==p&&p.loaded){var s=(a[2]-a[0])*
p.width,r=l.positionScreen;d=d[h];c.assign(this.dstRect,r[0]-s*e*0.5-d[0]*e*0.5,r[1]-((a[3]-a[1])*p.height+d[1])*e,r[0]+(s-d[0])*e*0.5,r[1]-d[1]*e);c.copy(l.wholeRect,this.dstRect);b.drawTexture(p,this.dstRect[0],this.dstRect[1],this.dstRect[2],this.dstRect[3],a,m[h],1)}};return b});
definejs("Math/Color",[],function(){var b={create:function(){return[0,0,0,1]},toArgb:function(a,b,c,e){},parseRGB:function(a){var b=[1,1,1,1];if(void 0===a||6>a.length)return b;for(var c=0;3>c;c++){var e=a.slice(2*c,2*c+2);b[c]=parseInt(e,16)/255}return b},parseRGBA:function(a){var b=[1,1,1,1];if(void 0===a||8>a.length)return b;for(var c=0;4>c;c++){var e=a.slice(2*c,2*c+2);b[c]=parseInt(e,16)/255}return b},parseFromString:function(a){var d=[1,1,1,1];if(void 0===a||0===a.length)return d;/^#/.test(a)&&
(a=a.substr(1));var c=a.length;return 6===c?b.parseRGB(a):8===c?b.parseRGBA(a):d}};return b});
definejs("Scene/Vector/PolylineStyle",["Math/Color","Framework/Framework"],function(b,a){var d=function(){this._framework=null;this.name="";this.type="PolylineStyle";this.color=null;this.width=0;this.imageUrl="";this.textureWrapScale=2};d.prototype.initialize=function(a){this._framework=a;""!==this.imageUrl&&(this.texture=void 0!==this.repeat?a.getTextureManager().createTextureResource(this.imageUrl,this.repeat):a.getTextureManager().createTextureResource(this.imageUrl),this.clamp=!1)};d.prototype.finalize=
function(){this.texture=this._framework=null};return d});
definejs("Scene/Vector/VectorStyleFactory",["Style/LabelStyle","Scene/Vector/MarkerStyle","Math/Rect","Scene/Vector/PolylineStyle","Math/Color"],function(b,a,d,c,e){return{createStyle:function(b,l){if("LabelStyle"===b.type){var g=new a;g.name=b.name;for(var k=0;k<b.icon.length;k++){var n=b.icon[k].url,f=b.icon[k].image;n&&(g.imageUrls[k]=n);f&&(g.image[k]=f);var n=g.srcRects,f=k,m;if(m=b.icon[k].range){var q=m.split(",");m=parseFloat(q[0]);var x=parseFloat(q[1]),p=parseFloat(q[2]),q=parseFloat(q[3]),
s=d.create();d.assign(s,m,x,p+m,q+x);m=s}else m=null;n[f]=m}void 0!==b.scale&&(g.scale=b.scale);g.initialize(l);return g}return"PolylineStyle"===b.type?(g=new c,g.name=b.name,g.color=e.create(),g.color[0]=b.color[0]/255,g.color[1]=b.color[1]/255,g.color[2]=b.color[2]/255,g.color[3]=b.color[3],g.width=b.width,g.repeat=b.repeat,void 0!==b.textureWrapScale&&(g.textureWrapScale=b.textureWrapScale),g.imageUrl=b.imageUrl,g.initialize(l),g):null}}});
definejs("Scene/Vector/MarkerSystem",["Scene/Vector/Marker","Math/MathUtils","Scene/Vector/VectorStyleFactory","Math/Ellipsoid","Math/Vector3"],function(b,a,d,c,e){a=function(){this._framework=null;this._labelStyles=[];this._labels=[]};a.prototype.initialize=function(a){this._framework=a};a.prototype.finalize=function(){this._framework=null;for(var a=this._labelStyles.length,b=0;b<a;b++)this._labelStyles[b]=null;a=this._labels.length;for(b=0;b<a;b++)this._labels[b]=null};a.prototype.createStyle=function(a){for(var b=
this._labelStyles.length,c=0;c<b;c++){var e=this._labelStyles[c];if(e.name===a.name&&e.type===a.type)return e}e=d.createStyle(a,this._framework);return null!==e?(this._labelStyles.push(e),e):null};a.prototype.createLabel=function(a){var c=this.createStyle(a.objectStyle);if(null===c)return null;var d=null;a=a.objectInfo;d=new b;d.initialize(this._framework);if(!a.position)return null;var e=a.position.split(","),n=parseFloat(e[0]),f=parseFloat(e[1]),e=parseFloat(e[2]);d.setPosition(n,f,e);d.labelStyle=
c;d.setText?d.setText(a.text):d.text=a.text;d.level=a.priority||1;d.onClick=a.event[0].click;d.onMouseOver=a.event[1].mouseover;d.onMouseOut=a.event[2].mouseout;d.onCameraChange=a.event[3].camerachange;d.id=a.guid;void 0!==a.scale&&(d.scale=a.scale);this._framework.getSceneManager().getScene(0).addSceneObject(d);this._labels.push(d);return d};a.prototype.deleteLabel=function(a){for(var b=this._framework.getSceneManager().getScene(0),c=this._labels.length,d=0;d<c;d++)if(this._labels[d].id===a){b.removeSceneObject(this._labels[d]);
this._labels.splice(d,1);break}};a.prototype.getCount=function(){return this._labels.length};a.prototype.getLabel=function(a){return this._labels[a]};a.prototype.getLabelById=function(a){for(var b=this._labels.length,c=0;c<b;c++)if(this._labels[c].id===a)return this._labels[c]};return a});
definejs("Scene/Vector/Polyline","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/MathUtils Math/Ellipsoid".split(" "),function(b,a,d,c,e,h){function l(a,b,c,d){b=b[c];a[0]=b[0]*e.RADIANS_PER_DEGREE;a[1]=b[1]*e.RADIANS_PER_DEGREE;a[2]=b[2]+h.Radius+d;e.transformGeographicToECEF(a,a)}function g(a,b,c,d,e,f,g){a.push(d[0]-e[0]);a.push(d[1]-e[1]);a.push(d[2]-e[2]);b.push(f[0]);b.push(f[1]);b.push(f[2]);c.push(g);c.push(g)}b=function(){this.style=this.renderDevice=this.framework=null;this.lines=
[];this.centerPos=this._mvMatrix=null;this.lastLineWidth=0;this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=null;this.visible=!0};b.prototype.setVisible=function(a){this.visible=a};d.create();d.create();d.create();d.create();d.create();var k=d.create(),n=d.create(),f=d.create(),m=d.create(),q=d.create(),x=d.create(),p=d.create();b.prototype.initBuffer=function(a,b){for(var c=this.framework.renderDevice,h=[],w=[],u=[],v=this.lines.length,A=this.centerPos,
F=0;F<v;F++){var M=this.lines[F],C=M.length;if(1!=C){if(2==C)l(k,M,0,b),l(n,M,1,b),d.cross(m,k,n),d.normalize(m,m),g(h,w,u,k,A,m,-1),g(h,w,u,k,A,m,-1),g(h,w,u,k,A,m,1);else{l(k,M,0,b);l(n,M,1,b);d.cross(m,k,n);d.normalize(m,m);g(h,w,u,k,A,m,-1);g(h,w,u,k,A,m,-1);g(h,w,u,k,A,m,1);for(var J=1;J<C-1;J++){l(k,M,J-1,b);l(n,M,J,b);l(f,M,J+1,b);d.cross(q,k,n);d.normalize(q,q);d.cross(x,n,f);d.normalize(x,x);d.add(m,q,x);d.scale(m,m,0.5);d.normalize(m,m);d.sub(p,k,n);d.normalize(p,p);var O=d.dot(p,m);0>O&&
(O=-O);var E=1,E=Math.acos(O)<25*e.RADIANS_PER_DEGREE?1:1/Math.sin(Math.acos(O));g(h,w,u,n,A,m,-E);g(h,w,u,n,A,m,E)}l(k,M,C-2,b);l(n,M,C-1,b);d.cross(m,k,n);d.normalize(m,m)}g(h,w,u,n,A,m,-1);g(h,w,u,n,A,m,1);g(h,w,u,n,A,m,1)}}this._positionVertexBuffer=c.createVertexBuffer(h,3);this._normalVertexBuffer=c.createVertexBuffer(w,3);this._texcoordVertexBuffer=c.createVertexBuffer(u,2)};b.prototype.initialize=function(b){this._mvMatrix=a.create();this.framework=b;var c=this.framework.renderDevice;b=c._gl;
this._positionVertxBuffer=b.createBuffer();this.centerPos=d.create();l(this.centerPos,this.lines[0],0,0);this._modelMatrix=a.create();a.translate(this._modelMatrix,this.centerPos[0],this.centerPos[1],this.centerPos[2]);var e=this.style.width;this.initBuffer(e,0);this.lastLineWidth=e;this._renderTechnique=c.effectManager.getEffect(0).getTechnique(6);c=c.createRenderCommand();c.setStreamSource(0,this._positionVertexBuffer,0,12);c.setStreamSource(1,this._normalVertexBuffer,0,12);c.setStreamSource(2,
this._texcoordVertexBuffer,0,8);c.setStreamSource(3,-1,0,0);c.setRenderTechnique(this._renderTechnique);c.setRenderOperation(b.TRIANGLE_STRIP,0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);this._renderCommand=c};b.prototype.finalize=function(){this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=this._mvMatrix=this._renderCommand=this._renderTechnique=this._indexBuffer=this._positionVertxBuffer=this.style=null};b.prototype.addLine=
function(a){this.lines.push(a)};b.prototype.cull=function(b){if(!b.isCullPoiOnly&&!1!==this.get("visible")){var c=this._renderCommand;c._matrixUniforms[1]=b._camera._projectionMatrix;a.multiply(this._mvMatrix,this._modelMatrix,b._camera._viewMatrix);c._matrixUniforms[0]=this._mvMatrix;var d=b._camera,e=d._frustum._near,f=d._viewportHeight,d=16*(Math.tan(0.5*d._frustum._fovy)*e/f);this.style?(d<this.style.width&&(d=this.style.width),c._vectorUniforms[0]=[d,0,0,0],c._vectorUniforms[1]=this.style.color,
b._renderContext._renderQueues[0].addRenderObject(this)):console.log("Polyline !thisObject.style")}};b.prototype.render=function(a){this._renderCommand.render(a)};return b});
definejs("Scene/Vector/TexturePolyline","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/MathUtils Math/Ellipsoid Resource/Texture".split(" "),function(b,a,d,c,e,h,l){function g(a,b,c,d,f){c=c[d];b[0]=c[0]*e.RADIANS_PER_DEGREE;b[1]=c[1]*e.RADIANS_PER_DEGREE;b[2]=c[2]+f;a.transformGeographicsToWorld(b,b)}function k(a,b,c,d,e,f,g,m,p,k){a.push(e[0]-f[0]);a.push(e[1]-f[1]);a.push(e[2]-f[2]);b.push(g[0]);b.push(g[1]);b.push(g[2]);c.push(m);c.push(p);d.push(k[0]);d.push(k[1]);d.push(k[2])}
b=function(){this.style=this.renderDevice=this.framework=null;this.lines=[];this.centerPosWorld=this._mvMatrix=null;this.lastLineWidth=0;this._texcoordVertexBuffer=this._normalVertexBuffer2=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=null;this._totalLength=0;this.bInit=!1;this.visible=!0;this.isBillboard=!1;this.heightOffset=0};b.prototype.setVisible=function(a){this.visible=a};d.create();d.create();d.create();d.create();d.create();var n=d.create(),f=d.create(),m=d.create(),
q=d.create(),x=d.create(),p=d.create(),s=d.create(),r=d.create(),z=d.create();b.prototype.initBuffer=function(a,b){for(var c=this.framework.renderDevice,h=[],l=[],t=[],w=[],u=this.lines.length,v=this.centerPosWorld,B=this.framework._spatialReference,I=0;I<u;I++){var y=this.lines[I],K=y.length,G=0;if(1!=K){if(2==K){g(B,n,y,0,b);g(B,f,y,1,b);B.cartesianToUp(z,n);d.sub(r,f,n);var L=d.length(r),L=B.getDistanceInMeter(n,f);d.normalize(r,r);d.cross(q,r,z);d.normalize(q,q);k(h,l,t,w,n,v,q,-1,G,r);k(h,l,
t,w,n,v,q,-1,G,r);k(h,l,t,w,n,v,q,1,G,r)}else{g(B,n,y,0,b);g(B,f,y,1,b);B.cartesianToUp(z,n);d.sub(r,n,f);d.length(r);B.getDistanceInMeter(n,f);d.normalize(r,r);d.cross(q,r,z);d.normalize(q,q);k(h,l,t,w,n,v,q,-1,G,r);k(h,l,t,w,n,v,q,-1,G,r);k(h,l,t,w,n,v,q,1,G,r);for(var N=1;N<K-1;N++){g(B,n,y,N-1,b);g(B,f,y,N,b);g(B,m,y,N+1,b);B.cartesianToUp(z,f);d.sub(x,n,f);d.normalize(x,x);d.cross(x,x,z);d.sub(p,f,m);d.normalize(p,p);d.cross(p,p,z);d.add(q,x,p);d.scale(q,q,0.5);d.normalize(q,q);d.sub(s,n,f);
d.normalize(s,s);var L=d.dot(s,q),D=1,D=Math.acos(L)<25*e.RADIANS_PER_DEGREE?1:1/Math.sin(Math.acos(L));d.sub(r,f,n);d.normalize(r,r);d.distance(f,n);L=B.getDistanceInMeter(n,f);G+=L;k(h,l,t,w,f,v,q,-D,G,r);k(h,l,t,w,f,v,q,D,G,r)}g(B,n,y,K-2,b);g(B,f,y,K-1,b);B.cartesianToUp(z,f);d.sub(r,n,f);d.length(r);L=B.getDistanceInMeter(n,f);d.normalize(r,r);d.cross(q,r,z);d.normalize(q,q)}G+=L;k(h,l,t,w,f,v,q,-1,G,r);k(h,l,t,w,f,v,q,1,G,r);k(h,l,t,w,f,v,q,1,G,r)}}this._totalLength=G;this._positionVertexBuffer=
c.createVertexBuffer(h,3);this._normalVertexBuffer=c.createVertexBuffer(l,3);this._texcoordVertexBuffer=c.createVertexBuffer(t,2);this._normalVertexBuffer2=c.createVertexBuffer(w,3)};b.prototype.initBufferBillboard=function(a,b){for(var c=this.framework.renderDevice,h=[],l=[],t=[],w=[],u=this.lines.length,v=this.centerPosWorld,B=this.framework._spatialReference,I=0;I<u;I++){var y=this.lines[I],K=y.length,G=0;if(1!=K){if(2==K){g(B,n,y,0,b);g(B,f,y,1,b);B.cartesianToUp(z,n);d.sub(r,f,n);var L=d.length(r),
L=B.getDistanceInMeter(n,f);d.normalize(r,r);d.cross(q,r,z);d.normalize(q,q);k(h,l,t,w,n,v,q,-1,G,r);k(h,l,t,w,n,v,q,-1,G,r);k(h,l,t,w,n,v,q,1,G,r)}else{g(B,n,y,0,b);g(B,f,y,1,b);B.cartesianToUp(z,n);d.sub(r,n,f);d.length(r);B.getDistanceInMeter(n,f);d.normalize(r,r);d.cross(q,r,z);d.normalize(q,q);k(h,l,t,w,n,v,q,-1,G,r);k(h,l,t,w,n,v,q,-1,G,r);k(h,l,t,w,n,v,q,1,G,r);for(var N=1;N<K-1;N++){g(B,n,y,N-1,b);g(B,f,y,N,b);g(B,m,y,N+1,b);B.cartesianToUp(z,f);d.sub(x,n,f);d.normalize(x,x);d.cross(x,x,z);
d.sub(p,f,m);d.normalize(p,p);d.cross(p,p,z);d.add(q,x,p);d.scale(q,q,0.5);d.normalize(q,q);d.sub(s,n,f);d.normalize(s,s);var L=d.dot(s,q),D=1,D=Math.acos(L)<25*e.RADIANS_PER_DEGREE?1:1/Math.sin(Math.acos(L));d.sub(r,f,n);d.normalize(r,r);d.distance(f,n);L=B.getDistanceInMeter(n,f);G+=L;k(h,l,t,w,f,v,q,-D,G,r);k(h,l,t,w,f,v,q,D,G,r)}g(B,n,y,K-2,b);g(B,f,y,K-1,b);B.cartesianToUp(z,f);d.sub(r,n,f);d.length(r);L=B.getDistanceInMeter(n,f);d.normalize(r,r);d.cross(q,r,z);d.normalize(q,q)}G+=L;k(h,l,t,
w,f,v,q,-1,G,r);k(h,l,t,w,f,v,q,1,G,r);k(h,l,t,w,f,v,q,1,G,r)}}this._totalLength=G;this._positionVertexBuffer=c.createVertexBuffer(h,3);this._normalVertexBuffer=c.createVertexBuffer(l,3);this._texcoordVertexBuffer=c.createVertexBuffer(t,2);this._normalVertexBuffer2=c.createVertexBuffer(w,3)};b.prototype.initialize=function(b){this._mvMatrix=a.create();this.framework=b;b=this.framework.renderDevice;var c=b._gl;this._positionVertxBuffer=c.createBuffer();this.centerPosWorld=d.create();this.centerPos=
d.copy(this.lines[0][0]);this.centerPos[0]*=e.RADIANS_PER_DEGREE;this.centerPos[1]*=e.RADIANS_PER_DEGREE;g(this.framework._spatialReference,this.centerPosWorld,this.lines[0],0,0);this._modelMatrix=a.create();a.translate(this._modelMatrix,this.centerPosWorld[0],this.centerPosWorld[1],this.centerPosWorld[2]);var f=this.style.width;this.initBuffer(f,0);this.lastLineWidth=f;this._renderTechnique=b.effectManager.getEffect(0).getTechnique(7);f=b.createRenderCommand();f.setStreamSource(0,this._positionVertexBuffer,
0,12);f.setStreamSource(1,this._normalVertexBuffer,0,12);f.setStreamSource(2,this._normalVertexBuffer2,0,12);f.setStreamSource(3,this._texcoordVertexBuffer,0,8);f.setStreamSource(4,-1,0,0);f.setRenderTechnique(this._renderTechnique);f.setRenderOperation(c.TRIANGLE_STRIP,0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);this._renderCommand=f;f=b.createRenderCommand();f.setStreamSource(0,this._positionVertexBuffer,0,12);f.setStreamSource(1,this._normalVertexBuffer,0,12);f.setStreamSource(2,
this._normalVertexBuffer2,0,12);f.setStreamSource(3,this._texcoordVertexBuffer,0,8);f.setStreamSource(4,-1,0,0);f.setRenderTechnique(b.effectManager.getEffect(0).getTechnique(25));f.setRenderOperation(c.TRIANGLE_STRIP,0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);this._renderCommand2=f};b.prototype.finalize=function(){this._normalVertexBuffer2=this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=this._mvMatrix=this._renderCommand=
this._renderTechnique=this._indexBuffer=this._positionVertxBuffer=this.style=null};b.prototype.setHeightOffset=function(a){this.heightOffset=a};b.prototype.addLine=function(a){this.lines.push(a)};b.prototype.updateLine=function(a){this.lines=[];this.lines.push(a);this.initialize(this.framework)};a.create();var t=a.create(),w=a.create(),u=a.create(),v=d.create();b.prototype.cull=function(b){if(!b.isCullPoiOnly&&!0===this.visible&&this.style.texture)if(this.style.texture&&4!==this.style.texture.state)this.style.texture.upload();
else{var c=0,e=this.get("grayT");0<e&&(c=e);e=Math.cos(this.centerPos[1]);a.scale(t,e,e,1);a.translate(u,0,0,this.heightOffset);this.framework._spatialReference.matrixWorldToRender2(this._modelMatrix,this.centerPos,b._camera._cameraParam.scaleFactor);a.multiply(this._mvMatrix,w,t);a.multiply(this._mvMatrix,this._mvMatrix,u);a.multiply(this._mvMatrix,this._mvMatrix,this._modelMatrix);a.multiply(this._mvMatrix,this._mvMatrix,b._viewProjectionMatrix);d.transformCoordEx(v,this.centerPos,this._mvMatrix);
var e=1/b._camera._cameraParam.pixelsPerMeter*this.style.width,f=e*this.style.textureWrapScale,g=this._renderCommand;g._matrixUniforms[0]=this._mvMatrix;g._matrixUniforms[1]=w;g._vectorUniforms[0]=[e,f,this._totalLength*c,0];g._vectorUniforms[1]=[1,1,1,1];g.setTexture(0,this.style.texture.textureGL);g.viewDistance=500;var m=b._renderContext._renderQueues[1];m.addRenderObject(g);var p=this._renderCommand2;p._matrixUniforms[0]=this._mvMatrix;p._matrixUniforms[1]=w;p._vectorUniforms[0]=[e,f,this._totalLength*
c,0];p._vectorUniforms[1]=[1,1,1,1];p.setTexture(0,this.style.texture.textureGL);g.viewDistance=500;m=b._renderContext._renderQueues[5];m.addRenderObject(p)}};return b});
definejs("Scene/Vector/TexturePolygon","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/MathUtils Math/Ellipsoid".split(" "),function(b,a,d,c,e,h){function l(a,b,c,d,e){a.push(c[0]);a.push(c[1]);a.push(c[2]);b.push(d);b.push(e)}b=function(){this.style=this.renderDevice=this.framework=null;this.lines=[];this._mvMatrix=null;this.positionGeographic=d.create();this.positionECEF=d.create();this.rotate=d.create();this.scale=[1,1,1];this.lastLineWidth=0;this._texcoordVertexBuffer=this._normalVertexBuffer2=
this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=null;this.bInit=!1;this.visible=this.transprency=!0;this._startHeading=0;this._endHeading=2*Math.PI};d.create();d.create();d.create();d.create();d.create();d.create();d.create();d.create();d.create();d.create();d.create();d.create();d.create();b.prototype.initBuffer=function(){var a=this.framework.renderDevice,b=[],c=[];l(b,c,[-0.5,0.5,0],0,0);l(b,c,[-0.5,-0.5,0],0,1);l(b,c,[0.5,0.5,0],1,0);l(b,c,[0.5,-0.5,0],1,1);this._positionVertexBuffer=
a.createVertexBuffer(b,3);this._texcoordVertexBuffer=a.createVertexBuffer(c,2)};b.prototype.setVisible=function(a){this.visible=a};var g=a.create(),k=a.create();b.prototype.initialize=function(b){this._mvMatrix=a.create();this.framework=b;b=this.framework.renderDevice;var c=b._gl;this._positionVertxBuffer=c.createBuffer();this._modelMatrix=a.create();this.framework._spatialReference.transformGeographicsToWorld(this.positionECEF,this.positionGeographic);this.initBuffer();this._renderTechnique=b.effectManager.getEffect(0).getTechnique(29);
var d=b.createRenderCommand();d.setStreamSource(0,this._positionVertexBuffer,0,12);d.setStreamSource(1,this._texcoordVertexBuffer,0,8);d.setRenderTechnique(this._renderTechnique);d.setRenderOperation(c.TRIANGLE_STRIP,0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);this._renderCommand=d;d=b.createRenderCommand();d.setStreamSource(0,this._positionVertexBuffer,0,12);d.setStreamSource(1,this._texcoordVertexBuffer,0,8);d.setRenderTechnique(b.effectManager.getEffect(0).getTechnique(30));
d.setRenderOperation(c.TRIANGLE_STRIP,0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);this._renderCommand2=d};b.prototype.finalize=function(){this._normalVertexBuffer2=this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=this._mvMatrix=this._renderCommand=this._renderTechnique=this._indexBuffer=this._positionVertxBuffer=this.style=null};b.prototype.addLine=function(a){};b.prototype.setPosition=function(a,b,c){this.positionGeographic[0]=
a*e.RADIANS_PER_DEGREE;this.positionGeographic[1]=b*e.RADIANS_PER_DEGREE;this.positionGeographic[2]=c;this.framework&&this.framework._spatialReference.transformGeographicsToWorld(this.positionECEF,this.positionGeographic)};b.prototype.setRotate=function(a,b,c){this.rotate[0]=a*e.RADIANS_PER_DEGREE;this.rotate[1]=b*e.RADIANS_PER_DEGREE;this.rotate[2]=c*e.RADIANS_PER_DEGREE};b.prototype.setScale=function(a,b,c){this.scale[0]=a;this.scale[1]=b;this.scale[2]=c};b.prototype.cull=function(b){if(!b.isCullPoiOnly&&
!1!==this.visible)if(4!==this.style.texture.state)this.style.texture.upload();else{var c=this.get("interval");if(!(0<c&&0>b._frame_counter%(2*c)-c)){c=this.get("startHeading");void 0==c&&(c=0);var d=this.get("endHeading");void 0==d&&(d=2*Math.PI);var e=b._camera,h=e._position[2]*Math.tan(0.5*e._frustum._fovy)/(0.5*e._viewportHeight),h=this.style.width*h,e=e._projectionMatrix;a.scale(g,h,h,h);a.rotateAxisZ(k,-this.rotate[2]);a.multiply(g,g,k);this.framework._spatialReference.matrixWorldToRender(this._modelMatrix,
this.positionECEF);a.multiply(this._modelMatrix,g,this._modelMatrix);a.multiply(this._mvMatrix,this._modelMatrix,b._camera._viewMatrix);var p=this._renderCommand;p._matrixUniforms[0]=this._mvMatrix;p._matrixUniforms[1]=e;p._vectorUniforms[0]=[1,1,1,1];p._vectorUniforms[1]=[c,d,0,0];p.setTexture(0,this.style.texture.textureGL);var h=1,l=this._renderCommand2;if(!0===this.get("overlap")){var h=6,r=this.get("overlapOrder");0<r?(p.viewDistance=r,l.viewDistance=r):(p.viewDistance=0,l.viewDistance=0)}r=
b._renderContext._renderQueues[h];r.addRenderObject(p);p=0.3;!1===this.transprency&&(p=1);l._matrixUniforms[0]=this._mvMatrix;l._matrixUniforms[1]=e;l._vectorUniforms[0]=[1,1,1,p];l._vectorUniforms[1]=[c,d,0,0];l.setTexture(0,this.style.texture.textureGL);r=b._renderContext._renderQueues[h];r.addRenderObject(l)}}};return b});
definejs("Scene/Vector/PixelPolyline","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/MathUtils Math/Ellipsoid".split(" "),function(b,a,d,c,e,h){function l(a,b,c,d){b=b[c];a[0]=b[0]*e.RADIANS_PER_DEGREE;a[1]=b[1]*e.RADIANS_PER_DEGREE;a[2]=b[2]+h.Radius+d;e.transformGeographicToECEF(a,a)}function g(a,b,c,d,e,f){a.push(c[0]);a.push(c[1]);a.push(c[2]);b.push(e[0]*f);b.push(e[1]*f);b.push(e[2]*f)}b=function(){this.style=this.renderDevice=this.framework=null;this.lines=[];this.centerPos=
this._mvpMatrix=this._mvMatrix=null;this.lastLineWidth=0;this._vertexDiffuseBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=null};d.create();d.create();d.create();d.create();d.create();var k=d.create(),n=d.create(),f=d.create(),m=d.create(),q=d.create(),x=d.create(),p=d.create(),s=d.create();b.prototype.initBuffer=function(a,b,c){a=this.framework.renderDevice;for(var h=[],u=[],v=this.lines.length,A=this.centerPos,F=0;F<v;F++){var M=this.lines[F],C=M.length;if(1!=C){if(2==
C)l(k,M,0,b),l(n,M,1,b),d.transformCoord(k,k,c),d.transformCoord(n,n,c),d.sub(m,n,k),d.normalize(m,m),g(h,u,k,A,m,-1),g(h,u,k,A,m,-1),g(h,u,k,A,m,1);else{l(k,M,0,b);l(n,M,1,b);d.transformCoord(k,k,c);d.transformCoord(n,n,c);d.sub(m,n,k);d.normalize(m,m);g(h,u,k,A,m,-1);g(h,u,k,A,m,-1);g(h,u,k,A,m,1);for(var J=1;J<C-1;J++){l(k,M,J-1,b);l(n,M,J,b);l(f,M,J+1,b);d.transformCoord(k,k,c);d.transformCoord(n,n,c);d.transformCoord(f,f,c);d.cross(q,k,n);d.normalize(q,q);d.cross(x,n,f);d.normalize(x,x);d.add(m,
q,x);d.scale(m,m,0.5);d.normalize(m,m);d.sub(s,k,n);d.normalize(s,s);var O=d.dot(s,m);0>O&&(O=-O);var E=1,E=Math.acos(O)<1*e.RADIANS_PER_DEGREE?1:1/Math.sin(Math.acos(O));d.sub(q,n,k);d.normalize(q,q);d.sub(x,f,n);d.normalize(x,x);d.sub(p,f,k);d.normalize(p,p);g(h,u,n,A,q,-E);g(h,u,n,A,q,E);g(h,u,n,A,p,-E);g(h,u,n,A,p,E);g(h,u,n,A,x,-E);g(h,u,n,A,x,E)}l(k,M,C-2,b);l(n,M,C-1,b);d.transformCoord(k,k,c);d.transformCoord(n,n,c);d.sub(m,n,k);d.normalize(m,m)}g(h,u,n,A,m,-1);g(h,u,n,A,m,1);g(h,u,n,A,m,
1)}}this._positionVertexBuffer=a.createVertexBuffer(h,3);this._normalVertexBuffer=a.createVertexBuffer(u,3)};b.prototype.initialize=function(b){this._mvMatrix=a.create();this._mvpMatrix=a.create();this.framework=b;var c=this.framework.renderDevice;b=c._gl;this._positionVertxBuffer=b.createBuffer();this.centerPos=d.create();l(this.centerPos,this.lines[0],0,0);this._modelMatrix=a.create();e.matrixENUToECEF(this._modelMatrix,this.centerPos);var f=a.create();e.matrixECEFToENU(f,this.centerPos);this.initBuffer([1,
1,1,1],0,f);this._renderTechnique=c.effectManager.getEffect(0).getTechnique(27);c=c.createRenderCommand();c.setStreamSource(0,this._positionVertexBuffer,0,12);c.setStreamSource(1,this._normalVertexBuffer,0,12);c.setStreamSource(3,-1,0,0);c.setRenderTechnique(this._renderTechnique);c.setRenderOperation(b.TRIANGLE_STRIP,0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);this._renderCommand=c};b.prototype.finalize=function(){this._texcoordVertexBuffer=this._normalVertexBuffer=
this._positionVertexBuffer=this._modelMatrix=this._mvMatrix=this._renderCommand=this._renderTechnique=this._indexBuffer=this._positionVertxBuffer=this.style=null};b.prototype.addLine=function(a){this.lines.push(a)};b.prototype.cull=function(b){var c=this._renderCommand;c._matrixUniforms[1]=b._camera._viewProjectionMatrix;var d=a.create();a.create();a.multiply(this._mvMatrix,d,this._modelMatrix);a.multiply(this._mvMatrix,this._mvMatrix,b._camera._viewMatrix);a.multiply(this._mvpMatrix,this._mvMatrix,
b._camera._projectionMatrix);c._matrixUniforms[0]=this._mvpMatrix;var d=b._camera,e=d._frustum._near,f=d._viewportHeight,e=16*(Math.tan(0.5*d._frustum._fovy)*e/f);this.style?(e<this.style.width&&(e=this.style.width),c._vectorUniforms[0]=[e/d._viewportWidth,e/d._viewportHeight,0,0],c._vectorUniforms[1]=this.style.color,b._renderContext._renderQueues[0].addRenderObject(this)):console.log("Polyline !thisObject.style")};b.prototype.render=function(a){this._renderCommand.render(a)};return b});
definejs("Scene/Vector/VolumePolyline","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/MathUtils Math/Ellipsoid Resource/ResourceState".split(" "),function(b,a,d,c,e,h,l){function g(a,b,c,d,f){c=c[d];b[0]=c[0]*e.RADIANS_PER_DEGREE;b[1]=c[1]*e.RADIANS_PER_DEGREE;b[2]=c[2]+f;a.transformGeographicsToWorld(b,b)}function k(a,b,c,d,e,f,g,m){a.push(d[0]-e[0]);a.push(d[1]-e[1]);a.push(d[2]-e[2]);b.push(f[0]);b.push(f[1]);b.push(f[2]);c.push(g);c.push(m)}b=function(){this.style=this.renderDevice=
this.framework=null;this.lines=[];this.centerPosWorld=this._mvMatrix=null;this.lastLineWidth=0;this._indexBuffer=this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=null;this.bInit=!1;this.visible=!0;this._totalLength=0};b.prototype.setVisible=function(a){this.visible=a};d.create();d.create();d.create();d.create();d.create();var n=d.create(),f=d.create(),m=d.create(),q=d.create();d.create();d.create();var x=d.create(),p=d.create(),s=d.create(),r=d.create(),
z=d.create(),t=d.create(),w=d.create(),u=d.create(),v=d.create(),A=0,F=0;b.prototype.generateIndexBufferData=function(a,b){for(var c=F=A=0;c<b-1;c++)A=6*c,F=6*(c+1),a.push(A),a.push(A+1),a.push(F),a.push(A+1),a.push(F+1),a.push(F);F=A=0;a.push(A+2);a.push(A+4);a.push(A+3);a.push(A+3);a.push(A+4);a.push(A+5);for(c=0;c<b-1;c++)A=6*c,F=6*(c+1),a.push(A+2),a.push(F+4),a.push(A+4),a.push(A+2),a.push(F+2),a.push(F+4),a.push(A+3),a.push(A+5),a.push(F+5),a.push(A+3),a.push(F+5),a.push(F+3);c=b;A=6*c;F=6*
(c+1);a.push(A);a.push(A+1);a.push(A+6);a.push(A+2);a.push(A+4);a.push(A+3);a.push(A+4);a.push(A+5);a.push(A+3);a.push(A+3);a.push(A+8);a.push(A+7);a.push(A+3);a.push(A+5);a.push(A+8);a.push(A+2);a.push(A+7);a.push(A+8);a.push(A+2);a.push(A+8);a.push(A+4)};b.prototype.initBuffer=function(a,b){for(var c=this.framework.renderDevice,h=[],l=[],A=[],F=[],B=this.lines.length,I=this.centerPosWorld,y=this.framework._spatialReference,K=0,G=0;G<B;G++){var L=this.lines[G],N=L.length,D=0;if(1!=N){if(2==N)g(y,
n,L,0,b),g(y,f,L,1,b),g(y,x,L,0,0),g(y,p,L,1,0),y.cartesianToUp(v,n),d.sub(u,f,n),d.normalize(u,u),D=d.distance(f,n),d.cross(r,v,u),d.normalize(r,r),d.scale(z,r,2),d.scale(t,u,3.4641),d.mad(q,f,u,0),d.mad(s,p,u,0),K+=D,D=0,k(h,l,A,n,I,r,-1,D),k(h,l,A,n,I,r,1,D),D=0.75,k(h,l,A,n,I,r,-1,D),k(h,l,A,n,I,r,1,D),k(h,l,A,x,I,r,-1,D),k(h,l,A,x,I,r,1,D);else{g(y,n,L,0,b);g(y,f,L,1,b);g(y,x,L,0,0);y.cartesianToUp(v,n);d.sub(u,f,n);d.normalize(u,u);d.cross(r,v,u);d.normalize(r,r);D=0;k(h,l,A,n,I,r,-1,D);k(h,
l,A,n,I,r,1,D);D=0.75;k(h,l,A,n,I,r,-1,D);k(h,l,A,n,I,r,1,D);k(h,l,A,x,I,r,-1,D);k(h,l,A,x,I,r,1,D);for(var Q=1;Q<N-1;Q++){g(y,n,L,Q-1,b);g(y,f,L,Q,b);g(y,m,L,Q+1,b);g(y,p,L,Q,0);y.cartesianToUp(v,f);d.sub(z,n,f);d.normalize(z,z);d.cross(z,z,v);d.sub(t,f,m);d.normalize(t,t);d.cross(t,t,v);d.add(r,z,t);d.scale(r,r,0.5);d.normalize(r,r);d.sub(w,n,f);d.normalize(w,w);D=d.dot(w,r);0>D&&(D=-D);var X=1,X=Math.acos(D)<25*e.RADIANS_PER_DEGREE?1:1/Math.sin(Math.acos(D));d.sub(u,f,n);d.normalize(u,u);D=d.distance(f,
n);K+=D;D=0;k(h,l,A,f,I,r,-X,D);k(h,l,A,f,I,r,X,D);D=0.75;k(h,l,A,f,I,r,-X,D);k(h,l,A,f,I,r,X,D);k(h,l,A,p,I,r,-X,D);k(h,l,A,p,I,r,X,D)}g(y,n,L,N-2,b);g(y,f,L,N-1,b);g(y,p,L,N-1,0);y.cartesianToUp(v,f);d.sub(u,f,n);d.normalize(u,u);D=d.distance(f,n);K+=D;d.cross(r,v,u);d.normalize(r,r);d.scale(z,r,2);d.scale(t,u,3.4641);d.mad(q,f,u,0);d.mad(s,p,u,0)}D=0;k(h,l,A,f,I,r,-1,D);k(h,l,A,f,I,r,1,D);D=0.75;k(h,l,A,f,I,r,-1,D);k(h,l,A,f,I,r,1,D);k(h,l,A,p,I,r,-1,D);k(h,l,A,p,I,r,1,D);D=0;k(h,l,A,f,I,z,-1,
D);k(h,l,A,f,I,z,1,D);D=0.75;k(h,l,A,f,I,z,-1,D);k(h,l,A,f,I,z,1,D);k(h,l,A,p,I,z,-1,D);k(h,l,A,p,I,z,1,D);D=0;k(h,l,A,q,I,t,1,D);D=0.75;k(h,l,A,q,I,t,1,D);k(h,l,A,s,I,t,1,D);this.generateIndexBufferData(F,N)}}this._totalLength=K;this._positionVertexBuffer=c.createVertexBuffer(h,3);this._normalVertexBuffer=c.createVertexBuffer(l,3);this._texcoordVertexBuffer=c.createVertexBuffer(A,2);this._indexBuffer=c.createIndexBuffer(F,2)};b.prototype.initialize=function(b){this._mvMatrix=a.create();this.framework=
b;var c=this.framework.renderDevice;b=c._gl;this._positionVertxBuffer=b.createBuffer();this.centerPosWorld=d.create();var f=this.framework._spatialReference;this.centerPosGeo[0]=this.centerPos[0]*e.RADIANS_PER_DEGREE;this.centerPosGeo[1]=this.centerPos[1]*e.RADIANS_PER_DEGREE;this.centerPosGeo[2]=this.centerPos[2];f.transformGeographicsToWorld(this.centerPosWorld,this.centerPosGeo);g(f,this.centerPosWorld,this.lines[0],0,0);this._modelMatrix=a.create();a.translate(this._modelMatrix,this.centerPosWorld[0],
this.centerPosWorld[1],this.centerPosWorld[2]);f=this.style.width;this.initBuffer(f,0.5);this.lastLineWidth=f;this._renderTechnique=c.effectManager.getEffect(0).getTechnique(34);f=c.createRenderCommand();f.setStreamSource(0,this._positionVertexBuffer,0,12);f.setStreamSource(1,this._normalVertexBuffer,0,12);f.setStreamSource(2,this._texcoordVertexBuffer,0,8);f.setStreamSource(3,-1,0,0);f.setIndexBuffer(this._indexBuffer);f.setTexture(0,this.style.texture.textureGL);f.setRenderTechnique(this._renderTechnique);
f.setRenderOperationIndex(b.TRIANGLES,0,0,this._positionVertexBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand=f;c=c.createRenderCommand();c.setStreamSource(0,this._positionVertexBuffer,0,12);c.setStreamSource(1,this._normalVertexBuffer,0,12);c.setStreamSource(2,this._texcoordVertexBuffer,0,8);c.setStreamSource(3,-1,0,0);c.setIndexBuffer(this._indexBuffer);c.setRenderTechnique(this._renderTechnique);c.setRenderOperationIndex(b.TRIANGLES,0,0,this._positionVertexBuffer.numItems,this._indexBuffer.numItems/
3);this._renderCommand2=c};b.prototype.finalize=function(){this._normalVertexBuffer2=this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=this._mvMatrix=this._renderCommand2=this._renderCommand=this._renderTechnique=this._indexBuffer=this._positionVertxBuffer=this.style=null};b.prototype.addLine=function(a){this.lines.push(a);this.centerPos=this.lines[0]};b.prototype.cull=function(b){if(!b.isCullPoiOnly&&!0===this.visible)if(this.style.texture.state!==l.TEXTURE_READY)this.style.texture.upload();
else{var c=b._camera._projectionMatrix;this.framework._spatialReference.matrixWorldToRender(this._modelMatrix,this.centerPosWorld);a.multiply(this._mvMatrix,this._modelMatrix,b._camera._viewMatrix);var d=b._camera,e=d._position[2]*Math.tan(0.5*d._frustum._fovy)/(0.5*d._viewportHeight),d=this.style.width*e;if(!(60>this._totalLength/e)){var e=d*this.style.textureWrapScale,e=d*this.style.textureWrapScale,f=this._renderCommand;f.setTexture(0,this.style.texture.textureGL);f._matrixUniforms[0]=this._mvMatrix;
f._matrixUniforms[1]=c;f._vectorUniforms[0]=[d,e,0,0];f._vectorUniforms[1]=[1,1,1,1];f.viewDistance=500;var g=b._renderContext._renderQueues[1];g.addRenderObject(f);f=this._renderCommand2;f.setTexture(0,this.style.texture.textureGL);f._matrixUniforms[0]=this._mvMatrix;f._matrixUniforms[1]=c;f._vectorUniforms[0]=[d,e,0,0];f._vectorUniforms[1]=[1,1,1,1];f.viewDistance=500;g=b._renderContext._renderQueues[5];g.addRenderObject(f)}}};b.prototype.render=function(a){if(this.style.texture.loaded){if(!this.bInit){var b=
this.framework.renderDevice._gl;b.bindTexture(b.TEXTURE_2D,this.style.texture);var c=b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");null===c&&b.getExtension("MOZ_EXT_texture_filter_anisotropic");if(null!==c){var d=b.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT);b.texParameterf(b.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY_EXT,d)}b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.bindTexture(b.TEXTURE_2D,null);this.bInit=!0}this._renderCommand.render(a)}};
return b});
definejs("Scene/Vector/Compass","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/MathUtils Math/Ellipsoid".split(" "),function(b,a,d,c,e,h){function l(a,b,c,d){a[0]=b[c][0];a[1]=b[c][1];a[2]=b[c][2]}function g(a,b,c,d,e,f,g,m,p,h){a.push(e[0]-f[0]);a.push(e[1]-f[1]);a.push(e[2]-f[2]);b.push(g[0]);b.push(g[1]);b.push(g[2]);c.push(m);c.push(p);d.push(h[0]);d.push(h[1]);d.push(h[2])}b=function(){this.style=this.renderDevice=this.framework=null;this.lines=[];this._mvMatrix=null;this.positionGeographic=
d.create();this.positionECEF=d.create();this.rotate=d.create();this.scale=[1,1,1];this.lastLineWidth=0;this._texcoordVertexBuffer=this._normalVertexBuffer2=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=null;this.bInit=!1;this.visible=!0};b.prototype.setVisible=function(a){this.visible=a};d.create();d.create();d.create();d.create();d.create();var k=d.create(),n=d.create(),f=d.create(),m=d.create(),q=d.create(),x=d.create(),p=d.create(),s=d.create();b.prototype.initBuffer=function(a,
b){for(var c=this.framework.renderDevice,h=[],A=[],r=[],z=[],C=this.lines.length,J=this.centerPos,O=[0,0,1],E=1/C,H=0;H<C;H++){var P=this.lines[H],B=P.length,E=1/B,I=0;if(1!=B){if(2==B)l(k,P,0,b),l(n,P,1,b),d.sub(s,n,k),d.normalize(s,s),d.cross(m,O,s),d.normalize(m,m),g(h,A,r,z,k,J,m,-1,I,s),g(h,A,r,z,k,J,m,-1,I,s),g(h,A,r,z,k,J,m,1,I,s);else{l(k,P,0,b);l(n,P,1,b);d.sub(s,n,k);d.normalize(s,s);d.cross(m,O,s);d.normalize(m,m);g(h,A,r,z,k,J,m,-1,I,s);g(h,A,r,z,k,J,m,-1,I,s);g(h,A,r,z,k,J,m,1,I,s);for(var y=
1;y<B-1;y++){l(k,P,y-1,b);l(n,P,y,b);l(f,P,y+1,b);d.sub(s,n,k);d.normalize(s,s);d.cross(q,O,s);d.normalize(q,q);d.sub(s,f,n);d.normalize(s,s);d.cross(x,O,s);d.normalize(x,x);d.add(m,q,x);d.scale(m,m,0.5);d.normalize(m,m);d.sub(p,k,n);d.normalize(p,p);var K=d.dot(p,m);0>K&&(K=-K);var G=1,G=Math.acos(K)<25*e.RADIANS_PER_DEGREE?1:1/Math.sin(Math.acos(K));d.sub(s,n,k);d.normalize(s,s);I+=E;g(h,A,r,z,n,J,m,-G,I,s);g(h,A,r,z,n,J,m,G,I,s)}l(k,P,B-2,b);l(n,P,B-1,b);d.sub(s,n,k);d.normalize(s,s);d.cross(m,
O,s);d.normalize(m,m)}I+=E;g(h,A,r,z,n,J,m,-1,I,s);g(h,A,r,z,n,J,m,1,I,s);g(h,A,r,z,n,J,m,1,I,s)}}this._positionVertexBuffer=c.createVertexBuffer(h,3);this._normalVertexBuffer=c.createVertexBuffer(A,3);this._texcoordVertexBuffer=c.createVertexBuffer(r,2);this._normalVertexBuffer2=c.createVertexBuffer(z,3)};var r=a.create(),z=a.create();b.prototype.initialize=function(b){this._mvMatrix=a.create();this.framework=b;b=this.framework.renderDevice;var c=b._gl;this._positionVertxBuffer=c.createBuffer();
this.centerPos=d.create();for(var e=[],f=0;64>f;++f){var g=f*Math.PI*2/64,m=0.5*Math.cos(g),g=0.5*Math.sin(g);e.push([g,m,0])}e.push([e[0][0],e[0][1],0]);this.addLine(e);this._modelMatrix=a.create();a.translate(this._modelMatrix,this.centerPos[0],this.centerPos[1],this.centerPos[2]);e=this.style.width;this.initBuffer(e,0);this.lastLineWidth=e;this._renderTechnique=b.effectManager.getEffect(0).getTechnique(35);e=b.createRenderCommand();e.setStreamSource(0,this._positionVertexBuffer,0,12);e.setStreamSource(1,
this._normalVertexBuffer,0,12);e.setStreamSource(2,this._normalVertexBuffer2,0,12);e.setStreamSource(3,this._texcoordVertexBuffer,0,8);e.setStreamSource(4,-1,0,0);e.setTexture(0,this.style.texture);e.setRenderTechnique(this._renderTechnique);e.setRenderOperation(c.TRIANGLE_STRIP,0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);this._renderCommand=e;e=b.createRenderCommand();e.setStreamSource(0,this._positionVertexBuffer,0,12);e.setStreamSource(1,this._normalVertexBuffer,
0,12);e.setStreamSource(2,this._normalVertexBuffer2,0,12);e.setStreamSource(3,this._texcoordVertexBuffer,0,8);e.setStreamSource(4,-1,0,0);e.setTexture(0,this.style.texture);e.setRenderTechnique(b.effectManager.getEffect(0).getTechnique(35));e.setRenderOperation(c.TRIANGLE_STRIP,0,this._positionVertexBuffer.numItems,this._positionVertexBuffer.numItems-2);this._renderCommand2=e};b.prototype.finalize=function(){this._normalVertexBuffer2=this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=
this._modelMatrix=this._mvMatrix=this._renderCommand=this._renderTechnique=this._indexBuffer=this._positionVertxBuffer=this.style=null};b.prototype.addLine=function(a){this.lines.push(a)};b.prototype.setPosition=function(a,b,c){this.positionGeographic[0]=a*e.RADIANS_PER_DEGREE;this.positionGeographic[1]=b*e.RADIANS_PER_DEGREE;this.positionGeographic[2]=c+6378137;e.transformGeographicToECEF(this.positionECEF,this.positionGeographic)};b.prototype.setRotate=function(a,b,c){this.rotate[0]=a*e.RADIANS_PER_DEGREE;
this.rotate[1]=b*e.RADIANS_PER_DEGREE;this.rotate[2]=c*e.RADIANS_PER_DEGREE};b.prototype.setScale=function(a,b,c){this.scale[0]=a;this.scale[1]=b;this.scale[2]=c};b.prototype.cull=function(b){if(!b.isCullPoiOnly&&!1!==this.get("visible")){var c=b._camera,d=(c._positionGeographic[2]-h.Radius-1)*Math.tan(0.5*c._frustum._fovy)/(0.5*c._viewportHeight),f=4/this.style.width,g=this.style.width*d,d=f*this.style.textureWrapScale,c=c._projectionMatrix;a.scale(r,g,g,g);a.rotateAxisZ(z,-this.rotate[2]);a.multiply(r,
r,z);e.matrixENUToECEF(this._modelMatrix,this.positionECEF);a.multiply(this._modelMatrix,r,this._modelMatrix);a.multiply(this._mvMatrix,this._modelMatrix,b._camera._viewMatrix);var m=[1,0,0,1],g=[1,0,0,0.3],p=this.get("angelOffset");30>Math.abs(p)&&(m=[0,1,0,1],g=[0,1,0,0.3]);var k=0,q=0;0>p?(k=1+p/360,q=1):(k=0,q=p/360);p=this._renderCommand;p._matrixUniforms[0]=this._mvMatrix;p._matrixUniforms[1]=c;p._vectorUniforms[0]=[f,d,k,q];p._vectorUniforms[1]=m;m=b._renderContext._renderQueues[1];m.addRenderObject(p);
p=this._renderCommand2;p._matrixUniforms[0]=this._mvMatrix;p._matrixUniforms[1]=c;p._vectorUniforms[0]=[f,d,k,q];p._vectorUniforms[1]=g;m=b._renderContext._renderQueues[5];m.addRenderObject(p)}};b.prototype.render=function(a){if(this.style.texture.loaded){if(!this.bInit){var b=this.framework.renderDevice._gl;b.bindTexture(b.TEXTURE_2D,this.style.texture);var c=b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");null===c&&b.getExtension("MOZ_EXT_texture_filter_anisotropic");if(null!==c){var d=
b.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT);b.texParameterf(b.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY_EXT,d)}b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.bindTexture(b.TEXTURE_2D,null);this.bInit=!0}this._renderCommand.render(a)}};return b});definejs("Core/defaultValue",[],function(){function b(a,b){return void 0!==a&&null!==a?a:b}b.EMPTY_OBJECT={};return b});
definejs("Math/Earcut",["Math/Vector3"],function(b){function a(a,b,f){f=f||2;var m=b&&b.length,p=m?b[0]*f:a.length,h=d(a,0,p,f,!0),k=[];if(!h||h.next===h.prev)return k;var q,r,t,s;if(m){var w=f,m=[],x,u,v;s=0;for(x=b.length;s<x;s++)u=b[s]*w,v=s<x-1?b[s+1]*w:a.length,u=d(a,u,v,w,!1),u===u.next&&(u.steiner=!0),m.push(n(u));m.sort(l);for(s=0;s<m.length;s++){w=m[s];b=h;if(b=g(w,b))w=z(b,w),c(b,b.next),c(w,w.next);h=c(h,h.next)}}if(a.length>80*f){q=t=a[0];r=m=a[1];for(w=f;w<p;w+=f)s=a[w],b=a[w+1],s<q&&
(q=s),b<r&&(r=b),s>t&&(t=s),b>m&&(m=b);t=Math.max(t-q,m-r);t=0!==t?1/t:0}e(h,k,f,q,r,t);return k}function d(a,b,c,d,e){var f;if(e===0<v(a,b,c,d))for(e=b;e<c;e+=d)f=t(e,a[e],a[e+1],f);else for(e=c-d;e>=b;e-=d)f=t(e,a[e],a[e+1],f);f&&q(f,f.next)&&(w(f),f=f.next);return f}function c(a,b){if(!a)return a;b||(b=a);var c=a,d;do if(d=!1,c.steiner||!q(c,c.next)&&0!==m(c.prev,c,c.next))c=c.next;else{w(c);c=b=c.prev;if(c===c.next)break;d=!0}while(d||c!==b);return b}function e(a,b,d,g,p,l,n){if(a){if(!n&&l){var t=
a,s=t;do null===s.z&&(s.z=k(s.x,s.y,g,p,l)),s.prevZ=s.prev,s=s.nextZ=s.next;while(s!==t);s.prevZ.nextZ=null;s.prevZ=null;var t=s,u,v,y,K,G,L,N=1;do{s=t;y=t=null;for(K=0;s;){K++;v=s;for(u=G=0;u<N&&(G++,v=v.nextZ,v);u++);for(L=N;0<G||0<L&&v;)0!==G&&(0===L||!v||s.z<=v.z)?(u=s,s=s.nextZ,G--):(u=v,v=v.nextZ,L--),y?y.nextZ=u:t=u,u.prevZ=y,y=u;s=v}y.nextZ=null;N*=2}while(1<K)}for(t=a;a.prev!==a.next;){s=a.prev;v=a.next;if(l)y=h(a,g,p,l);else a:if(y=a,K=y.prev,G=y,N=y.next,0<=m(K,G,N))y=!1;else{for(u=y.next.next;u!==
y.prev;){if(f(K.x,K.y,G.x,G.y,N.x,N.y,u.x,u.y)&&0<=m(u.prev,u,u.next)){y=!1;break a}u=u.next}y=!0}if(y)b.push(s.i/d),b.push(a.i/d),b.push(v.i/d),w(a),t=a=v.next;else if(a=v,a===t){if(!n)e(c(a),b,d,g,p,l,1);else if(1===n){a=c(a);n=b;t=d;s=a;do v=s.prev,y=s.next.next,!q(v,y)&&x(v,s,s.next,y)&&r(v,y)&&r(y,v)&&(n.push(v.i/t),n.push(s.i/t),n.push(y.i/t),w(s),w(s.next),s=a=y),s=s.next;while(s!==a);a=c(s);e(a,b,d,g,p,l,2)}else if(2===n)a:{n=a;do{for(t=n.next.next;t!==n.prev;){if(s=n.i!==t.i){s=n;v=t;y=void 0;
if(y=s.next.i!==v.i)if(y=void 0,y=s.prev.i!==v.i){y=y=void 0;b:{y=s;do{if(y.i!==s.i&&y.next.i!==s.i&&y.i!==v.i&&y.next.i!==v.i&&x(y,y.next,s,v)){y=!0;break b}y=y.next}while(y!==s);y=!1}if(y=!y){y=void 0;if(y=r(s,v))if(y=void 0,y=r(v,s)){y=s;K=!1;G=(s.x+v.x)/2;N=(s.y+v.y)/2;do y.y>N!==y.next.y>N&&y.next.y!==y.y&&G<(y.next.x-y.x)*(N-y.y)/(y.next.y-y.y)+y.x&&(K=!K),y=y.next;while(y!==s);y=K&&(m(s.prev,s,v.prev)||m(s,v.prev,v))}y=y||q(s,v)&&0<m(s.prev,s,s.next)&&0<m(v.prev,v,v.next)}}s=y}if(s){a=z(n,
t);n=c(n,n.next);a=c(a,a.next);e(n,b,d,g,p,l);e(a,b,d,g,p,l);break a}t=t.next}n=n.next}while(n!==a)}break}}}}function h(a,b,c,d){var e=a.prev,g=a.next;if(0<=m(e,a,g))return!1;var p=e.x>a.x?e.x>g.x?e.x:g.x:a.x>g.x?a.x:g.x,h=e.y>a.y?e.y>g.y?e.y:g.y:a.y>g.y?a.y:g.y,q=k(e.x<a.x?e.x<g.x?e.x:g.x:a.x<g.x?a.x:g.x,e.y<a.y?e.y<g.y?e.y:g.y:a.y<g.y?a.y:g.y,b,c,d);b=k(p,h,b,c,d);c=a.prevZ;for(d=a.nextZ;c&&c.z>=q&&d&&d.z<=b;){if(c!==a.prev&&c!==a.next&&f(e.x,e.y,a.x,a.y,g.x,g.y,c.x,c.y)&&0<=m(c.prev,c,c.next))return!1;
c=c.prevZ;if(d!==a.prev&&d!==a.next&&f(e.x,e.y,a.x,a.y,g.x,g.y,d.x,d.y)&&0<=m(d.prev,d,d.next))return!1;d=d.nextZ}for(;c&&c.z>=q;){if(c!==a.prev&&c!==a.next&&f(e.x,e.y,a.x,a.y,g.x,g.y,c.x,c.y)&&0<=m(c.prev,c,c.next))return!1;c=c.prevZ}for(;d&&d.z<=b;){if(d!==a.prev&&d!==a.next&&f(e.x,e.y,a.x,a.y,g.x,g.y,d.x,d.y)&&0<=m(d.prev,d,d.next))return!1;d=d.nextZ}return!0}function l(a,b){return a.x-b.x}function g(a,b){var c=b,d=a.x,e=a.y,g=-Infinity,p;do{if(e<=c.y&&e>=c.next.y&&c.next.y!==c.y){var h=c.x+(e-
c.y)*(c.next.x-c.x)/(c.next.y-c.y);if(h<=d&&h>g){g=h;if(h===d){if(e===c.y)return c;if(e===c.next.y)return c.next}p=c.x<c.next.x?c:c.next}}c=c.next}while(c!==b);if(!p)return null;if(d===g)return p;var h=p,k=p.x,q=p.y,l=Infinity,n,c=p;do d>=c.x&&c.x>=k&&d!==c.x&&f(e<q?d:g,e,k,q,e<q?g:d,e,c.x,c.y)&&(n=Math.abs(e-c.y)/(d-c.x),r(c,a)&&(n<l||n===l&&(c.x>p.x||c.x===p.x&&0>m(p.prev,p,c.prev)&&0>m(c.next,p,p.next)))&&(p=c,l=n)),c=c.next;while(c!==h);return p}function k(a,b,c,d,e){a=32767*(a-c)*e;b=32767*(b-
d)*e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;b=(b|b<<8)&16711935;b=(b|b<<4)&252645135;b=(b|b<<2)&858993459;return(a|a<<1)&1431655765|((b|b<<1)&1431655765)<<1}function n(a){var b=a,c=a;do{if(b.x<c.x||b.x===c.x&&b.y<c.y)c=b;b=b.next}while(b!==a);return c}function f(a,b,c,d,e,f,g,p){return 0<=(e-g)*(b-p)-(a-g)*(f-p)&&0<=(a-g)*(d-p)-(c-g)*(b-p)&&0<=(c-g)*(f-p)-(e-g)*(d-p)}function m(a,b,c){return(b.y-a.y)*(c.x-b.x)-(b.x-a.x)*(c.y-b.y)}function q(a,b){return a.x===b.x&&a.y===b.y}
function x(a,b,c,d){var e=s(m(a,b,c)),f=s(m(a,b,d)),g=s(m(c,d,a)),h=s(m(c,d,b));return e!==f&&g!==h||0===e&&p(a,c,b)||0===f&&p(a,d,b)||0===g&&p(c,a,d)||0===h&&p(c,b,d)?!0:!1}function p(a,b,c){return b.x<=Math.max(a.x,c.x)&&b.x>=Math.min(a.x,c.x)&&b.y<=Math.max(a.y,c.y)&&b.y>=Math.min(a.y,c.y)}function s(a){return 0<a?1:0>a?-1:0}function r(a,b){return 0>m(a.prev,a,a.next)?0<=m(a,b,a.next)&&0<=m(a,a.prev,b):0>m(a,b,a.prev)||0>m(a,a.next,b)}function z(a,b){var c=new u(a.i,a.x,a.y),d=new u(b.i,b.x,b.y),
e=a.next,f=b.prev;a.next=b;b.prev=a;c.next=e;e.prev=c;d.next=c;c.prev=d;f.next=d;d.prev=f;return d}function t(a,b,c,d){a=new u(a,b,c);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function w(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function u(a,b,c){this.i=a;this.x=b;this.y=c;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function v(a,b,c,d){for(var e=0,f=c-d;b<c;b+=d)e+=(a[f]-
a[b])*(a[b+1]+a[f+1]),f=b;return e}a.deviation=function(a,b,c,d){var e=b&&b.length,f=Math.abs(v(a,0,e?b[0]*c:a.length,c));if(e)for(var e=0,g=b.length;e<g;e++)f-=Math.abs(v(a,b[e]*c,e<g-1?b[e+1]*c:a.length,c));for(e=b=0;e<d.length;e+=3){var g=d[e]*c,p=d[e+1]*c,m=d[e+2]*c;b+=Math.abs((a[g]-a[m])*(a[p+1]-a[g+1])-(a[g]-a[p])*(a[m+1]-a[g+1]))}return 0===f&&0===b?0:Math.abs((b-f)/f)};a.flatten=function(a){for(var b=a[0][0].length,c={vertices:[],holes:[],dimensions:b},d=0,e=0;e<a.length;e++){for(var f=0;f<
a[e].length;f++)for(var g=0;g<b;g++)c.vertices.push(a[e][f][g]);0<e&&(d+=a[e-1].length,c.holes.push(d))}return c};return a});
definejs("Scene/Vector/VolumePolygon","Core/defaultValue Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/Extent Math/AABB Math/MathUtils Math/Ellipsoid Math/Earcut Resource/ResourceState".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){function m(a,b,c,d,e){c=c[d];b[0]=c[0]*g.RADIANS_PER_DEGREE;b[1]=c[1]*g.RADIANS_PER_DEGREE;b[2]=e;a.transformGeographicsToWorld(b,b)}function q(a,b,c,d,e,f,g,p){a.push(d[0]-e[0]);a.push(d[1]-e[1]);a.push(d[2]-e[2]);b.push(f[0]);b.push(f[1]);b.push(f[2]);c.push(g);
c.push(p)}a=function(){this.style=this.renderDevice=this.framework=null;this.lines=[];this._mvMatrix=null;this.centerPos=c.create();this.centerPosGeo=c.create();this.centerPosWorld=null;this.lastLineWidth=0;this._indexBuffer=this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=null;this._extrudeHight=3;this.color=[[1,1,1,1],[1,0,0,0.8]];this.outlineColor=[[0.2,0.2,0.2,1],[1,0,0,1]];this.state=0;this.bInit=!1;this.visible=!0;this.extent=new h;this._totalLength=
0;this._scaleBuilding=1;this._boundaryBox=l.createInvalid()};a.prototype.setVisible=function(a){this.visible=a};c.create();c.create();c.create();c.create();c.create();var x=c.create(),p=c.create();c.create();c.create();c.create();c.create();var s=c.create(),r=c.create();c.create();var z=c.create();c.create();c.create();c.create();c.create();var t=c.create();a.prototype.generateIndexBufferData=function(a,b,c,d){for(var e=[],f=0;f<c.length;f++)e.push(c[f][0]),e.push(c[f][1]);e=n(e);for(f=0;f<e.length;f++)b.push(e[f]+
4*d);for(f=e=0;f<d;f++)e=4*f,b.push(e),b.push(e+2),b.push(e+1),b.push(e+1),b.push(e+2),b.push(e+3);a._outlineStartIndex=b.length;for(f=0;f<c.length;f++)b.push(f+4*d)};a.prototype.setCenterPos=function(a,b,c){this.centerPos[0]=a;this.centerPos[1]=b;this.centerPos[2]=c};a.prototype.initBuffer=function(a){var b=this,d=b.framework.renderDevice,e=[],f=[],g=[],k=[],n=b.lines.length,w=b.centerPosWorld,u=b.framework._spatialReference,v=0;h.makeInvalid(b.extent);for(var y=0;y<n;y++){var K=b.lines[y],G=K.length,
v=v+G;if(!(3>G)){u.cartesianToUp(t,p);for(var L=0;L<G;L++){var N=L%G;m(u,x,K,N,a);m(u,s,K,N,0);N=(L+1)%G;m(u,p,K,N,a);m(u,r,K,N,0);c.sub(z,s,r);c.normalize(z,z);c.cross(z,z,t);q(e,f,g,x,w,z,0,0);q(e,f,g,s,w,z,0,1);q(e,f,g,p,w,z,0,0);q(e,f,g,r,w,z,0,1);l.mergePoint(b._boundaryBox,b._boundaryBox,[x[0]-w[0],x[1]-w[1],x[2]-w[2]]);l.mergePoint(b._boundaryBox,b._boundaryBox,[s[0]-w[0],s[1]-w[1],s[2]-w[2]]);b=this}for(L=0;L<G;L++)h.mergePoint(b.extent,b.extent,[K[L][0],K[L][1],0]),h.mergePoint(b.extent,
b.extent,[K[L][0],K[L][1],a]),m(u,p,K,L,a),q(e,f,g,p,w,t,0,0);b.generateIndexBufferData(b,k,K,G)}}b._totalLength=0;b._positionVertexBuffer=d.createVertexBuffer(e,3);b._normalVertexBuffer=d.createVertexBuffer(f,3);b._texcoordVertexBuffer=d.createVertexBuffer(g,2);b._indexBuffer=d.createIndexBuffer(k,2);b._totalPointCount=v};a.prototype.setExtrudeHeight=function(a){this._extrudeHight=a};c.create();a.prototype.initialize=function(a){this._mvMatrix=d.create();this.framework=a;var b=this.framework.renderDevice;
a=b._gl;this._positionVertxBuffer=a.createBuffer();this.centerPosWorld=c.create();var e=this.framework._spatialReference;this.centerPosGeo[0]=this.centerPos[0]*g.RADIANS_PER_DEGREE;this.centerPosGeo[1]=this.centerPos[1]*g.RADIANS_PER_DEGREE;this.centerPosGeo[2]=this.centerPos[2];e.transformGeographicsToWorld(this.centerPosWorld,this.centerPosGeo);this._modelMatrix=d.create();d.translate(this._modelMatrix,this.centerPosWorld[0],this.centerPosWorld[1],this.centerPosWorld[2]);d.translate(this._modelMatrix,
0,0,0);this.initBuffer(this._extrudeHight);e=b.createRenderCommand();e.setStreamSource(0,this._positionVertexBuffer,0,12);e.setStreamSource(1,this._normalVertexBuffer,0,12);e.setStreamSource(2,this._texcoordVertexBuffer,0,8);e.setStreamSource(3,-1,0,0);e.setIndexBuffer(this._indexBuffer);e.setRenderOperationIndex(a.TRIANGLES,0,0,this._positionVertexBuffer.numItems,(this._indexBuffer.numItems-this._totalPointCount)/3);this._renderCommand=e;e=b.createRenderCommand();e.setStreamSource(0,this._positionVertexBuffer,
0,12);e.setStreamSource(1,this._normalVertexBuffer,0,12);e.setStreamSource(2,this._texcoordVertexBuffer,0,8);e.setStreamSource(3,-1,0,0);e.setIndexBuffer(this._indexBuffer);e.setRenderOperationIndex(a.TRIANGLES,0,0,this._positionVertexBuffer.numItems,(this._indexBuffer.numItems-this._totalPointCount)/3);this._renderCommand2=e;e=b.createRenderCommand();e.setStreamSource(0,this._positionVertexBuffer,0,12);e.setStreamSource(1,this._normalVertexBuffer,0,12);e.setStreamSource(2,this._texcoordVertexBuffer,
0,8);e.setStreamSource(3,-1,0,0);e.setIndexBuffer(this._indexBuffer);e.setRenderOperationIndex(a.LINE_LOOP,this._outlineStartIndex,0,this._positionVertexBuffer.numItems,this._totalPointCount/3);this._renderCommand3=e;b=b.createRenderCommand();b.setStreamSource(0,this._positionVertexBuffer,0,12);b.setStreamSource(1,this._normalVertexBuffer,0,12);b.setStreamSource(2,this._texcoordVertexBuffer,0,8);b.setStreamSource(3,-1,0,0);b.setIndexBuffer(this._indexBuffer);b.setRenderOperationIndex(a.TRIANGLES,
0,0,this._positionVertexBuffer.numItems,(this._indexBuffer.numItems-this._totalPointCount)/3);this._rcCastShadow=b};a.prototype.finalize=function(){this._normalVertexBuffer2=this._texcoordVertexBuffer=this._normalVertexBuffer=this._positionVertexBuffer=this._modelMatrix=this._mvMatrix=this._rcCastShadow=this._renderCommand2=this._renderCommand=this._renderTechnique=this._indexBuffer=this._positionVertxBuffer=this.style=null};a.prototype.getFloorExtent=function(a){if("floor"===this.type)return h.combine(a,
a,this.extent),!0};a.prototype.getBoundaryBox=function(a,b){var c=this._boundaryBox._min,d=this._boundaryBox._max;a[0]=Math.min(a[0],c[0]);a[1]=Math.min(a[1],c[1]);a[2]=Math.min(a[2],c[2]);b[0]=Math.max(b[0],d[0]);b[1]=Math.max(b[1],d[1]);b[2]=Math.max(b[2],d[2]);return!0};a.prototype.addLine=function(a){this.lines.push(a)};var w=d.create(),u=d.create();a.prototype.renderForCastShadow=function(a){var b=this._rcCastShadow;b.setTexture(0,a.framework._defaultTexture);b._matrixUniforms[0]=a._viewMatrix;
b._matrixUniforms[1]=a._projectionMatrix;b._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];b.viewDistance=500;var c=a.framework.renderDevice.effectManager.getEffect(0).getTechnique(43);b.setRenderTechnique(c);a._renderContext.getShadowCastRenderQueue().addRenderObject(b)};var v=d.create();a.prototype.renderForNormal=function(a){};a.prototype.renderFloorWithShadowMap=function(a){if(!0===this.style.texture.loaded&&null!==a.shadowCastTexture){var b=
this._scaleBuilding;d.scale(u,b,b,b);a.framework._spatialReference.matrixWorldToRender2(w,this.centerPosGeo,a._camera._cameraParam.scaleFactor);d.multiply(this._mvMatrix,this._modelMatrix,u);d.multiply(this._mvMatrix,this._mvMatrix,w);d.multiply(this._mvMatrix,this._mvMatrix,a._viewProjectionMatrix);var b=a.shadowCastTexture._boundaryBox,c=this._renderCommand;c.setTexture(0,this.style.texture);c.setTexture(1,a.shadowCastTexture);c._matrixUniforms[0]=this._mvMatrix;c._matrixUniforms[1]=v;c._matrixUniforms[2]=
[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];c._vectorUniforms[0]=[1,1,0,0];c._vectorUniforms[1]=[b.minBoundary[0],b.minBoundary[1],b.maxBoundary[0],b.maxBoundary[1]];c._vectorUniforms[2]=this.color[0];c.viewDistance=500;var e=a.framework.renderDevice.effectManager.getEffect(0).getTechnique(42);c.setRenderTechnique(e);a._renderContext._renderQueues[1].addRenderObject(c);c=this._renderCommand2;c.setTexture(0,this.style.texture);c.setTexture(1,
a.shadowCastTexture);c._matrixUniforms[0]=this._mvMatrix;c._matrixUniforms[1]=v;c._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];c._vectorUniforms[0]=[1,1,0,0];c._vectorUniforms[1]=[b.minBoundary[0],b.minBoundary[1],b.maxBoundary[0],b.maxBoundary[1]];c._vectorUniforms[2]=this.color[0];c.viewDistance=500;c.setRenderTechnique(e)}};a.prototype.cull=function(a){a.isCullPoiOnly||!0===this.visible&&(b(a._genShadowMapPass,!1)?"shop"===
this.type?this.renderForCastShadow(a):"floor"!==this.type&&this.renderForCastShadow(a):"floor"===this.type?this.renderFloorWithShadowMap(a):this.renderForNormal(a))};a.prototype.render=function(a){if(this.style.texture.loaded){if(!this.bInit){var b=this.framework.renderDevice._gl;b.bindTexture(b.TEXTURE_2D,this.style.texture);var c=b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");null===c&&b.getExtension("MOZ_EXT_texture_filter_anisotropic");if(null!==c){var d=b.getParameter(c.MAX_TEXTURE_MAX_ANISOTROPY_EXT);
b.texParameterf(b.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY_EXT,d)}b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.REPEAT);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.REPEAT);b.bindTexture(b.TEXTURE_2D,null);this.bInit=!0}this._renderCommand.render(a)}};return a});
definejs("Scene/Vector/PolylineSystem","Scene/Vector/Polyline Math/MathUtils Scene/Vector/VectorStyleFactory Math/Ellipsoid Math/Vector3 Scene/Vector/TexturePolyline Scene/Vector/TexturePolygon Scene/Vector/PixelPolyline Scene/Vector/VolumePolyline Scene/Vector/Compass Scene/Vector/VolumePolygon".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){a=function(){this._framework=null;this._polylineStyles=[];this._polylines=[]};a.prototype.initialize=function(a){this._framework=a};a.prototype.finalize=function(){this._framework=
null;for(var a=this._polylineStyles.length,b=0;b<a;b++)this._polylineStyles[b]=null;a=this._polylines.length;for(b=0;b<a;b++)this._polylines[b]=null};a.prototype.createStyle=function(a){for(var b=this._polylineStyles.length,c=0;c<b;c++){var e=this._polylineStyles[c];if(e.name===a.name&&e.type===a.type)return e}e=d.createStyle(a,this._framework);return null!==e?(this._polylineStyles.push(e),e):null};a.prototype.createLine=function(a){return"color"===a.fillType?new b:"texture"===a.fillType?new h:"pixel"===
a.fillType?new g:"volume"===a.fillType?new k:null};a.prototype.createPoly=function(a){return"color"===a.fillType?new b:"texture"===a.fillType?new l:"pixel"===a.fillType?new g:"volume"===a.fillType?new k:"compass"===a.fillType?new n:"block"===a.fillType?new f:null};a.prototype.createPolyline=function(a){var b=this.createStyle(a.objectStyle);if(null===b)return null;var c=a.objectInfo;a=this.createLine(a.objectStyle);if(null===a||!c.position)return null;for(var d=c.position.split(";"),f=d.length,g=[],
h=0;h<f&&d[h];h++){var k=d[h].split(","),l=parseFloat(k[0]),n=parseFloat(k[1]),k=parseFloat(k[2]),l=e.make(l,n,k);g.push(l)}a.addLine(g);a.style=b;a.id=c.guid;a.initialize(this._framework);this._framework.getSceneManager().getScene(0).addSceneObject(a);this._polylines.push(a);return a};a.prototype.createPolygon=function(a){var b=this.createStyle(a.objectStyle);if(null===b)return null;var c=a.objectInfo;a=this.createPoly(a.objectStyle);if(null===a||!c.position)return null;for(var d=c.position.split(";"),
f=d.length,g=[],h=0;h<f&&d[h];h++){var k=d[h].split(","),l=parseFloat(k[0]),n=parseFloat(k[1]),k=parseFloat(k[2]),l=e.make(l,n,k);g.push(l)}d=!0;void 0!==c.transparency&&"false"===c.transparency&&(d=!1);void 0!==c.scale&&(l=c.scale.split(","),f=parseFloat(l[0]),h=parseFloat(l[1]),l=parseFloat(l[2]),a.setScale(f,h,l));void 0!==c.rotate&&(l=c.rotate.split(","),f=parseFloat(l[0]),h=parseFloat(l[1]),l=parseFloat(l[2]),a.setRotate(f,h,l));g=g[0];a.transprency=d;a.setPosition(g[0],g[1],g[2]);a.style=b;
a.id=c.guid;a.initialize(this._framework);this._framework.getSceneManager().getScene(0).addSceneObject(a);this._polylines.push(a);return a};a.prototype.deletePolyline=function(a){for(var b=this._framework.getSceneManager().getScene(0),c=this._polylines.length,d=0;d<c;d++)if(this._polylines[d].id===a){b.removeSceneObject(this._polylines[d]);this._polylines.splice(d,1);break}};a.prototype.updateLine=function(a,b){this._framework.getSceneManager().getScene(0);for(var c=this._polylines.length,d=0;d<c;d++)if(this._polylines[d].id===
a){this._polylines[d].updateLine(b);break}};a.prototype.getCount=function(){return this._polylines.length};a.prototype.getPolyline=function(a){return this._polylines[a]};a.prototype.getPolylineById=function(a){for(var b=this._polylines.length,c=0;c<b;c++)if(this._polylines[c].id===a)return this._polylines[c]};return a});
definejs("Scene/Vector/VectorSystem",["Scene/Vector/MarkerSystem","Scene/Vector/PolylineSystem"],function(b,a){var d=function(){this._polylineSystem=this._labelSystem=this._framework=null};d.prototype.initialize=function(c){this._framework=c;this._labelSystem=new b;this._labelSystem.initialize(c);this._polylineSystem=new a;this._polylineSystem.initialize(c)};d.prototype.finalize=function(){this._polylineSystem=this._labelSystem=this._framework=null};d.prototype.createObject=function(a){return"Label"===
a.objectInfo.type&&null!==this._labelSystem?this._labelSystem.createLabel(a):"Polyline"===a.objectInfo.type&&null!==this._polylineSystem?this._polylineSystem.createPolyline(a):"Polygon"===a.objectInfo.type&&null!==this._polylineSystem||"Polygon"===a.objectInfo.type&&null!==this._polylineSystem?this._polylineSystem.createPolygon(a):null};d.prototype.deleteObject=function(a,b){if("Label"===a&&null!==this._labelSystem)return this._labelSystem.deleteLabel(b);if("Polyline"===a&&null!==this._polylineSystem||
"Polygon"===a&&null!==this._polylineSystem)return this._polylineSystem.deletePolyline(b)};d.prototype.getLabelSystem=function(){return this._labelSystem};return d});
definejs("Resource/ErrorURL",[],function(){return{length:0,keys:{},list:[],maxLength:1E3,add:function(b){if(this.has(b))return!1;this.length++;this.keys[b]=1;this.list.push(b);this.length>this.maxLength&&(b=this.list.pop(),delete this.keys[b],this.length--)},has:function(b){return 1===this.keys[b]},isError:function(b){b=new Uint8Array(b);try{var a=String.fromCharCode.apply(null,[].slice.call(b,0,64));return/<Error>/gi.test(a)}catch(d){return console.log("errorURL error!"),!1}}}});
definejs("Resource/Downloader",["Resource/Texture","Framework/ConfigOptions","Resource/ErrorURL"],function(b,a,d){function c(){if(4===this.readyState){var a=this.dataObject;if(0!==this.status&&200!==this.status&&304!==this.status)a.state=l,--n;else{var b=null;"arraybuffer"==this.responseType&&this.response?b=this.response:this.mozResponseArrayBuffer&&(b=this.mozResponseArrayBuffer);0!==this.status&&--n;null===b?a.state=l:d.isError(b)?(d.add(this.url),a.state=l):(a.state=g,--n,a.onDataLoaded(b))}a.xmlhttp=
null}}function e(){if(4===this.readyState){var a=this.dataObject;if(0===this.status||200===this.status||304===this.status){var b=null;this.response?b=this.response:this.mozResponseArrayBuffer&&(b=this.mozResponseArrayBuffer);var c=window.URL||window.webkitURL;c&&(b=c.createObjectURL(b),a.src=b)}}}function h(){if(4===this.readyState){var a=this.dataObject;if(0!==this.status&&200!==this.status&&304!==this.status)a.state=-1;else{var b=null,b=this.responseXML;a.onDataLoaded(b.documentElement)}a.xmlhttp=
null}}var l=-1,g=4,k={},n=0;k.loadByteStream=function(b,e){a.srcVersion&&(e=-1==e.indexOf("?")?e+("?_t="+a.srcVersion):e+("&_t="+a.srcVersion));if(window.XMLHttpRequest){if(8>=n)++n;else{b.state=0;return}if(d.has(e)){--n;b.state=5;return}try{var g=new XMLHttpRequest;g.timeout=0;g.onreadystatechange=c;g.onerror=function(){--n};g.dataObject=b;b.xmlhttp=g;g.open("GET",e,!0);g.responseType="arraybuffer";g.send(null);g.url=e;b.pendingCounter&&b.pendingCounter.counter++}catch(h){--n,g.xmlhttp=null,b.state=
l}return!0}return!1};k.rawXHR=function(a,b,c,d,e,g,h){var k=!1;window.XMLHttpRequest?k=new XMLHttpRequest:window.ActiveXObject&&(k=new ActiveXObject("Microsoft.XMLHttp"));b=(b||"GET").toUpperCase();var l=a[a.length-1];if("?"==l||"&"==l)a=a.slice(0,-1);l=c;if("GET"==b){var l="",n;for(n in c)l=0==l.length&&-1==a.indexOf("?")?l+"?":l+"&",l+=n+"="+c[n];a+=l;l=null}k.onreadystatechange=function(){if(4==k.readyState)if(200==k.status||304==k.status){var a=k.getResponseHeader("Content-Type");if(-1!=a.indexOf("xml")&&
k.responseXML)g&&g(k.responseXML);else if(-1!=a.indexOf("application/json"))try{g&&g(JSON.parse(k.response))}catch(b){console.log(b),h&&h(b.toString())}else"blob"==a||"arraybuffer"==a?(a=k.response||request.mozResponseArrayBuffer)?g&&g(a):h&&h(k.responseText):(a=k.response,"json"==d&&(a=JSON.parse(a)),g&&g(a))}else 0==k.status?h&&h("\u8bf7\u6c42\u5931\u8d25\u88ab\u62e6\u622a"):h&&h(k.response)};k.open(b,a,e);d&&(k.responseType=d);k.send(l)};k.arraybufferToString=function(a,b,c){a=new Blob([a],{type:"text/plain"});
var d=new FileReader;d.onload=function(a){c(a.target.result)};d.readAsText(a,b)};k.dataURItoBlob=function(a,b){b=b||"application/javascript";for(var c=new ArrayBuffer(a.length),c=new Uint8Array(c),d=0;d<a.length;d++)c[d]=a.charCodeAt(d);return new Blob([c],{type:b})};k.loadImageViaBlob=function(b,c){a.srcVersion&&(c=-1==c.indexOf("?")?c+("?_t="+a.srcVersion):c+("&_t="+a.srcVersion));if(window.XMLHttpRequest){try{var d=new XMLHttpRequest;d.onload=e;d.dataObject=b;d.open("GET",c,!0);d.responseType=
"blob";d.send(null);d.url=c}catch(g){d.xmlhttp=null}return!0}return!1};k.loadXML=function(b,c){a.srcVersion&&(c=-1==c.indexOf("?")?c+("?_t="+a.srcVersion):c+("&_t="+a.srcVersion));if(window.XMLHttpRequest){try{var d=new XMLHttpRequest;d.onreadystatechange=h;d.dataObject=b;b.xmlhttp=d;d.open("GET",c,!0);d.send(null)}catch(e){d.xmlhttp=null,b.state=l}return!0}return!1};k.loadXMLSync=function(b){a.srcVersion&&(b=-1==b.indexOf("?")?b+("?_t="+a.srcVersion):b+("&_t="+a.srcVersion));if(window.XMLHttpRequest)try{var c=
new XMLHttpRequest;c.async=!1;c.open("GET",b,!0);c.send(null);if(0===c.status||200===c.status||304===c.status)return c.responseXML.documentElement}catch(d){}return null};k.getHttpObject=function(){var a=!1;window.XMLHttpRequest?a=new XMLHttpRequest:window.ActiveXObject&&(a=new ActiveXObject("Microsoft.XMLHttp"));return a};k.jsonToUrl=function(a,b){try{if(!b)return a;var c=[],d;for(d in b)if("undefined"!=encodeURIComponent(b[d])&&null!=encodeURIComponent(b[d])&&""!=encodeURIComponent(b[d])&&encodeURIComponent(b[d])){var e=
encodeURIComponent(d),g=encodeURIComponent(b[d]);c.push(e+"="+g)}var h=c.join("&");h&&(-1==a.indexOf("?")?a+="?":a.indexOf("?")!=a.length-1&&(a+="&"),a+=h);return a}catch(k){return""}};k.getData=function(a,b,c,d,e){var g=k.getHttpObject();g.ontimeout=function(){e&&e({errMsg:"TimeOut"})};g.onreadystatechange=function(){if(4==g.readyState)if(200==g.status||304==g.status){var a=g.getResponseHeader("Content-Type");if(-1!=a.indexOf("xml")&&g.responseXML)d&&d(g.responseXML);else if("application/json"===
a)try{d&&d(JSON.parse(g.responseText))}catch(b){e&&e(b.toString())}else a=g.responseText,"json"==c&&(a=JSON.parse(a)),d&&d(a)}else e&&e(g.responseText)};a=k.jsonToUrl(a,b);g.open("GET",a);g.send(null);return g};return k});
definejs("Resource/TextureDataSource",["Resource/Texture","Framework/ConfigOptions"],function(b,a){var d=function(){this._texturePool=this.framework=null;this._textures={};this.dataProvider=this._texturManager=null;this.base_url="";this.dataSourceInfo=null;this.requestType="db"};d.prototype.initialize=function(a){this.framework=a};d.prototype.finalize=function(){this.framework=null};d.prototype.startFrame=function(){this._texturePool.prepare(64)};d.prototype.endFrame=function(){};d.prototype.createResource=
function(c,d){var h=this._textures,l=h[c];-1==d.indexOf("base64")&&a.srcVersion&&(d+="?t="+(a.srcVersion||0));void 0===l&&(l=new b(this.framework,this),l.initialize("image",c,this.base_url+d),h[c]=l);l.refCount++;return l};d.prototype.createResourceFromDataURL=function(a,d){var h=this._textures,l=h[a];void 0===l&&(l=new b(this.framework,this),l.initialize("image",a,d),h[a]=l);l.refCount++;return l};d.prototype.deleteResource=function(a){delete this._textures[a]};d.prototype.upload=function(a){return 0===
a.state&&!a.startDownload()||3!==a.state?0:this.uploadToDevice(a)};d.prototype.uploadToDevice=function(a){var b=this.framework,d=a.image.naturalWidth*a.image.naturalHeight,l=a.allocator;if(!l.canUpload(1,d))return b.forceRedraw(),0;var g=b.renderDevice._gl,k=3*d;a.mipmap&&(k=Math.floor(4*k/3));k=l.allocateTexture(k);if(null===k)return a.allocator.notifyUpload(d),0;void 0==a.flipY&&(a.flipY=!1);try{g.bindTexture(g.TEXTURE_2D,k),g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,a.flipY),g.texImage2D(g.TEXTURE_2D,
0,g.RGBA,g.RGBA,g.UNSIGNED_BYTE,a.image),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,g.LINEAR),a.mipmap?g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR_MIPMAP_NEAREST):g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,g.LINEAR),a.clamp&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,g.CLAMP_TO_EDGE),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,g.CLAMP_TO_EDGE)),a.mipmap&&g.generateMipmap(g.TEXTURE_2D),g.bindTexture(g.TEXTURE_2D,null),a.state=4}catch(n){if(null!==k)return l.releaseTexture(k),
l.notifyUpload(d),0}a.width=a.image.naturalWidth;a.height=a.image.naturalHeight;a.pixelsSize=d;a.image=null;a.textureGL=k;a.textureGL.loaded=!0;l.notifyUpload(d);b.forceRedraw();return d};return d});
definejs("Scene/Indoor/IndoorRSModelNode","Renderer/RenderQueue Math/Matrix4 Math/MathUtils Math/Vector3 Framework/AppState Resource/ResourceState Math/Extent Math/AABB".split(" "),function(b,a,d,c,e,h,l,g){var k=0;b=function(a,b,c,d,e){this.framework=a.framework;this.meshDataSource=a;this.imageDataSource=a.imageDataSource;e&&(this.imageDataSource.base_url=e);this.bufferPool=a.meshAllocator;this.reqCounter=a.framework.downloadController.getCounter("mesh");this.childs=this.parent=this.pendingCounter=
null;this.hasChildData=!0;this.keyString=b;this.refCount=0;this.url=c;this.baseUrl=d;this.imgBaseUrl=e;this.patchCount=0;this.radius=this.center=this.patch=null;this.extent=new l;this.scale=this.tileCenter=null;this.frameCounter=this.used=this.state=0;this.upNormal=[0,0,1];this.mesh=null;this.meshID=k++;this.dataType=0};a.create();b.prototype.initialize=function(){this.mesh=null;this.tileCenterWorld=c.create();this.center=this.tileCenter;this.framework._spatialReference.transformGeographicsToWorld(this.tileCenterWorld,
this.tileCenter);this.boundingBox=g.create();this._unpackModelViewProjectMatrix=a.create()};b.prototype.finalize=function(){a.release(this._unpackModelViewProjectMatrix);this.boundingBox=this.tileCenter=this.meshDataSource=this.mesh=this._unpackModelViewProjectMatrix=null};b.prototype.upload=function(){this.frameCounter=e.frame_states.frame_counter;null===this.mesh&&null!==this.meshDataSource&&(this.mesh=this.meshDataSource.createResource(this.url,this.url,this.dataType,this.baseUrl,this.imgBaseUrl));
null!==this.mesh&&this.mesh.upload();return!0};b.prototype.isError=function(){return null===this.mesh?!1:this.mesh.isError()};b.prototype.isWaiting=function(){return this.state===h.RESOURCE_WAITING};b.prototype.isAborted=function(){return this.state===h.RESOURCE_ABORTING};b.prototype.isReady=function(){return null!==this.mesh&&this.mesh.isReady()?!0:!1};b.prototype.getBoundaryBox=function(a,b,c){this.mesh.getBoundaryBox(a,b,c)};b.prototype.getFloorExtent=function(a,b){this.mesh.getFloorExtent(this,
a,b)};b.prototype.removeResource=function(){this.used=1;null!==this.mesh&&(null!==this.meshDataSource&&this.meshDataSource.deleteResource(this.url),this.mesh=null,this.state=h.RESOURCE_WAITING)};b.prototype.addToRenderQueue=function(a,b){null!==this.mesh&&this.mesh.addToRenderQueue(a,this,b)};b.prototype.reset=function(){};b.prototype.isRootTile=function(){return!0};return b});
definejs("Math/MercatorCoords",["Math/MathUtils"],function(b){function a(a){return h*Math.cos(a*Math.PI/180)}function d(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function c(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}var e=1/6378137;b={sphericalToMercator:function(a,b){var c=b[1],c=1.4835298641951802<c?1.4835298641951802:c,c=Math.sin(-1.4835298641951802>c?-1.4835298641951802:c);a[0]=6378137*b[0];a[1]=3189068.5*Math.log((1+c)/(1-c));a[2]=b[2]},
mercatorToSpherical:function(a,b){a[0]=b[0]*e;a[1]=2*Math.atan(Math.exp(b[1]*e))-0.5*Math.PI;a[2]=b[2]},GetAABBFromRect:function(a,b,c,d){}};var h=1.2742016016E7*Math.PI;b.lngLatAltToMercator=function(b,c){b[0]=(180+c[0])/360;b[1]=d(c[1]);b[2]=c[2]/a(c[1])};b.radiansToMercator=function(b,c){b[0]=(180+180*c[0]/Math.PI)/360;b[1]=d(180*c[1]/Math.PI);b[2]=c[2]/a(180*c[1]/Math.PI)};b.MercatorToLngLatAlt=function(b,d){b[0]=360*d[0]-180;b[1]=c(d[1]);b[2]=d[2]*a(c(d[1]))};return b});
definejs("Resource/MeshUploader",["Resource/Texture","Framework/ConfigOptions","Framework/AppState","Resource/ResourceState","Resource/Downloader"],function(b,a,d,c,e,h,l){var g={upload:function(a){if(a.state===h.RESOURCE_WAITING&&!g.onStateWaiting(a)||a.state===h.RESOURCE_LOADING)return 0;if(a.state===h.RESOURCE_COMPILED||a.state===h.RESOURCE_LOADED){for(var b=!0,c=0;c<a.patchCount;c++){var d=a.patch[c];void 0!==d&&null!==d.texture&&(d.texture.isReady()||d.texture.upload(),d.texture.isReady()||(b=
!1))}!0===b&&(a.state=h.RESOURCE_TEXTURES_READY)}a.state===h.RESOURCE_TEXTURES_READY&&g.uploadToDevice(a)},uploadToDevice:function(a){for(var b=a.framework.renderDevice,c=b._gl,d=a.bufferPool,e=0,g=0,e=0;e<a.patchCount;e++){var p=a.patch[e];void 0!==p&&(g+=p.vertexNumber)}if(!d.canUpload(3*a.patchCount,g))return 0;for(var l=!1,e=0;e<a.patchCount;e++)if(p=a.patch[e],void 0!==p){p.positionBuffer=2===p.dataType?d.allocateBuffer(c.ARRAY_BUFFER,p.positionCoords,6,c.UNSIGNED_SHORT):d.allocateBuffer(c.ARRAY_BUFFER,
p.positionCoords,12);if(null===p.positionBuffer){l=!0;break}if(null!==p.normalCoords&&(p.normalBuffer=d.allocateBuffer(c.ARRAY_BUFFER,p.normalCoords,12),null===p.normalBuffer)){l=!0;break}if(null!==p.textureCoords&&(p.textureCoordBuffer=d.allocateBuffer(c.ARRAY_BUFFER,p.textureCoords,8),null===p.textureCoordBuffer)){l=!0;break}if(null!==p.textureCoords2&&(p.textureCoordBuffer2=d.allocateBuffer(c.ARRAY_BUFFER,p.textureCoords2,8),null===p.textureCoordBuffer2)){l=!0;break}if(null!==p.diffuseCoords&&
(p.diffuseBuffer=d.allocateBuffer(c.ARRAY_BUFFER,p.diffuseCoords,4,c.UNSIGNED_BYTE),null===p.diffuseBuffer)){l=!0;break}l||(p.indexBuffer=d.allocateBuffer(c.ELEMENT_ARRAY_BUFFER,p.indices,2),null===p.indexBuffer&&(l=!0))}if(l){for(e=0;e<a.patchCount;e++)p=a.patch[e],void 0!==p&&(p.positionBuffer&&(d.releaseBuffer(p.positionBuffer),p.positionBuffer=null),p.textureCoordBuffer&&(d.releaseBuffer(p.textureCoordBuffer),p.textureCoordBuffer=null),p.normalBuffer&&(d.releaseBuffer(p.normalBuffer),p.normalBuffer=
null),p.diffuseBuffer&&(d.releaseBuffer(p.diffuseBuffer),p.diffuseBuffer=null),p.indexBuffer&&(d.releaseBuffer(p.indexBuffer),p.indexBuffer=null));return 0}for(e=0;e<a.patchCount;e++)if(p=a.patch[e],void 0!==p){var l=b.createRenderCommand(),r=0;l.setStreamSource(r,p.positionBuffer,0,0);r++;null!==p.normalBuffer&&(l.setStreamSource(r,p.normalBuffer,0,0),r++);null!==p.textureCoordBuffer&&(l.setStreamSource(r,p.textureCoordBuffer,0,0),r++);null!==p.textureCoordBuffer2&&(l.setStreamSource(r,p.textureCoordBuffer2,
0,0),r++);null!==p.diffuseBuffer&&l.setStreamSource(r,p.diffuseBuffer,0,0);0!==p.dataType&&(l._mustHaveTexture=!1);l.setIndexBuffer(p.indexBuffer);null!==p.texture&&l.setTexture(0,p.texture.textureGL);null!==p.texture2&&l.setTexture(1,p.texture2.textureGL);l.setRenderOperationIndex(c.TRIANGLES,0,0,p.vertexNumber,p.faceNumber);p.renderCommand=l;p.positionCoords=null;p.textureCoords=null;p.textureCoords2=null;p.diffuseCoords=null;p.indices=null}a.state=h.RESOURCE_READY;d.notifyUpload(g);return a._vertexCount},
onStateWaiting:function(a){if(a.state===h.RESOURCE_WAITING){var b=a.reqCounter;if(b.counter<b.limit)return b.counter++,a.pendingCounter=b,a.state=h.RESOURCE_LOADING,l.loadByteStream(a,a.url),!0}return!1},releaseResource:function(a){for(var b=0,c="",e=0;e<a.patchCount;e++){var g=a.patch[e];void 0!==g&&(d.texture_release_count++,d.patch_count--,null!==g.renderCommand&&(g.renderCommand.finalize(),g.renderCommand=null),null!==g.positionBuffer&&(a.bufferPool.releaseBuffer(g.positionBuffer),g.positionBuffer=
null),null!==g.textureCoordBuffer&&(a.bufferPool.releaseBuffer(g.textureCoordBuffer),g.textureCoordBuffer=null),null!==g.diffuseBuffer&&(a.bufferPool.releaseBuffer(g.diffuseBuffer),g.diffuseBuffer=null),null!==g.indexBuffer&&(a.bufferPool.releaseBuffer(g.indexBuffer),g.indexBuffer=null),g.positionCoords=null,g.textureCoords=null,g.indices=null,null!==g.texture?(0===e&&(c=g.texture.name,b=g.texture.refCount),g.texture.release(),g.texture=null):console.log("texture if null"),null!==g.texture2?(0===
e&&(c=g.texture2.name,b=g.texture2.refCount),g.texture2.release(),g.texture2=null):console.log("texture if null"))}b!==a.patchCount&&(console.log("patch count in Tile:%d\t",a.patchCount),console.log("texture refCount:%d\t",b),console.log("deleteTexture:%s\t",c),console.log("tile name:%s\t",a.keyString),console.log("curent patch count:%d\n",d.patch_count));a.patchCount=0;a.patch=null;a.state=0}};return g});
definejs("Resource/Mesh","Math/Matrix4 Math/MathUtils Math/Vector3 Resource/ResourceState Resource/Downloader Resource/MeshUploader Resource/Texture".split(" "),function(b,a,d,c,e,h,l){a=function(a,b,d){this.dataSource=a;this.imageDataSource=a.imageDataSource;this.bufferPool=a.meshAllocator;this.reqCounter=a.framework.downloadController.getCounter("mesh");this.pendingCounter=null;this.framework=a.framework;this.url=a.createUrl(b);this.base_url=d||this.url.substring(0,this.url.lastIndexOf("/")+1);
this.renderCommand=null;this.state=c.RESOURCE_WAITING;this.key=b;this.byteStream=null;this.chunkData={}};a.prototype.initialize=function(a){this.framework=a;this.workerManager=a._workerManager};a.prototype.finalize=function(){h.releaseResource(this);this.framework=this.patch=null};a.prototype.upload=function(){if(this.state!==c.RESOURCE_READY&&this.state!==c.RESOURCE_LOADING){this.state===c.RESOURCE_WAITING&&(this.state=c.RESOURCE_LOADING,e.loadByteStream(this,this.url));if(this.state===c.RESOURCE_COMPILED||
this.state===c.RESOURCE_LOADED){for(var a=!0,b=0;b<this.patchCount;b++){var d=this.patch[b];void 0!==d&&(null!==d.texture&&(d.texture.isReady()||d.texture.upload(),d.texture2.isReady()||d.texture2.isError()||(a=!1)),null!==d.texture2&&(d.texture2.isReady()||d.texture2.upload(),d.texture2.isReady()||d.texture2.isError()||(a=!1)))}!0===a&&(this.state=c.RESOURCE_TEXTURES_READY)}this.state===c.RESOURCE_TEXTURES_READY&&h.uploadToDevice(this)}};a.prototype.isReady=function(){return this.state===c.RESOURCE_READY};
a.prototype.isError=function(){return this.state===c.RESOURCE_ERROR};a.prototype.isWaiting=function(){return this.state===c.RESOURCE_WAITING};a.prototype.isAborted=function(){return this.state===c.RESOURCE_ABORTING};a.uploadToDevice=function(a,b){};a.prototype.onDataLoaded=function(a){};a.prototype.addToRenderQueue=function(a,c,d){for(var e=this.patch.length,h=0;h<e;h++){var l=this.patch[h],x=l.renderCommand;b.multiply(l.mvMatrix,c.modelMatrix,a._camera._viewMatrix);x._matrixUniforms[0]=l.mvMatrix;
x._matrixUniforms[1]=a._camera._projectionMatrix;l=c.framework.renderDevice.effectManager.getEffect(0).getTechnique(28);x.setRenderTechnique(l);d.addRenderObject(x)}};return a});
definejs("Scene/Indoor/IndoorRSBuildingNode",[],function(){var b=function(){this.count2=this.count1=0;this.entryArray=null;this.materialName="";this.min_z=this.min_y=this.min_x=this.min_v=this.min_u=this.max_z=this.max_y=this.max_x=this.max_v=this.max_u=0;this.faceIndices=null;this.facesIndexCount=0;this.verticesArray=this.textureCoordArray=null;this.verticesCount=0};b.prototype.initialize=function(a){this.count1=a.count1;this.count2=a.count2;this.entryArray=a.entryArray;this.materialName=a.materialName;
this.max_u=a.max_u;this.max_v=a.max_v;this.max_x=a.max_x;this.max_y=a.max_y;this.max_z=a.max_z;this.min_u=a.min_u;this.min_v=a.min_v;this.min_x=a.min_x;this.min_y=a.min_y;this.min_z=a.min_z;this.faceIndices=a.faceIndices;this.facesIndexCount=a.facesIndexCount;this.textureCoordArray=a.textureCoordArray;this.verticesArray=a.verticesArray;this.verticesCount=a.verticesCount};return b});
definejs("Scene/Indoor/IndoorRSPatch",["Math/Matrix4","Math/MathUtils","Math/Vector3","Math/AABB","Scene/Indoor/IndoorRSBuildingNode"],function(b,a,d,c,e){a=function(){this._building=this.renderCommand=this.framework=null;this._patchType=0};a.prototype.initialize=function(a,c,d,g){this._building=new e;this.framework=a;this._bufferPool=this.framework.meshAllocator;this._renderCommand=this._indexBuffer=this._textureCoordVertxBuffer2=this._textureCoordVertxBuffer=this._positionVertxBuffer=null;this._textures=
[];this._isTransparency=!1;this._is32BitIndex=c.is32BitIndex;this._unpackMatrix=b.create();this._building.initialize(c);a=g.isGenShadowMap;this._materialNames=this._building.materialName.split("|");this._min_u=this._building.min_u;this._min_v=this._building.min_v;this._max_u=this._building.max_u;this._max_v=this._building.max_v;this._mortonKey=d;1<this._materialNames.length?0<=this._materialNames[1].indexOf("floor")?(this._patchType=10,a&&(this._materialNames[1]="texture/floor_default.png")):0<=this._materialNames[0].indexOf("light")?
(d=this._materialNames[0].split("-"),2>d.length?this._patchType=11:(this._patchType=13,a&&(this._materialNames[0]="texture/"+d[1],this._materialNames[2]=d[0]+".png"))):(this._patchType=11,0<=this._materialNames[0].indexOf(".png")&&(this._isTransparency=!0)):1==this._materialNames.length&&(0<=this._materialNames[0].indexOf("light")?(d=this._materialNames[0].split("-"),2>d.length?(this._patchType=12,a&&(this._materialNames[1]="texture/floor_default.png")):(this._patchType=12,0<=d[1].indexOf(".png")&&
(this._isTransparency=!0),a&&(this._materialNames[0]=d[1],this._materialNames[1]="texture/wall_ssao.png",this._materialNames[2]=d[0]))):0<=this._materialNames[0].indexOf(".png")&&(this._isTransparency=!0))};a.prototype.finalize=function(){var a=this._positionVertxBuffer;null!==a&&this._bufferPool.releaseBuffer(a);a=this._textureCoordVertxBuffer;null!==a&&this._bufferPool.releaseBuffer(a);a=this._textureCoordVertxBuffer2;null!==a&&this._bufferPool.releaseBuffer(a);a=this._indexBuffer;null!==a&&this._bufferPool.releaseBuffer(a);
this._shadowCastRenderCommand=this._renderCommand=this._building=this._bufferPool=null;b.release(this._unpackMatrix);this._unpackMatrix=null};var h=b.create(),l=b.create(),g=d.create();d.create();d.create();b.create();d.create();d.create();d.create();c.create();d.create();a.prototype.createRenderCommand=function(a){if(null!==a){var c=this._bufferPool;if(c.canUpload(3,0)){this.minBoundary=[a.min_x,a.min_y,a.min_z];this.maxBoundary=[a.max_x,a.max_y,a.max_z];d.add(g,this.minBoundary,this.maxBoundary);
d.scale(g,g,0.5);b.translate(h,a.min_x,a.min_y,a.min_z);b.scale(l,a.max_x-a.min_x,a.max_y-a.min_y,a.max_z-a.min_z);b.multiply(this._unpackMatrix,l,h);var e=this.framework.renderDevice._gl,m=this.framework.renderDevice;this._positionVertxBuffer=c.allocateBuffer(e.ARRAY_BUFFER,a.verticesArray,8,e.UNSIGNED_SHORT,!0);this._textureCoordVertxBuffer=c.allocateBuffer(e.ARRAY_BUFFER,a.textureCoordArray,4,e.UNSIGNED_SHORT,!0);this._indexBuffer=c.allocateBuffer(e.ELEMENT_ARRAY_BUFFER,a.faceIndices,2);a=m.createRenderCommand();
a.setStreamSource(0,this._positionVertxBuffer,0,8);a.setStreamSource(1,this._textureCoordVertxBuffer,0,4);null!==this._textureCoordVertxBuffer2&&(a.setStreamSource(2,this._textureCoordVertxBuffer2,0,4),a.setStreamSource(3,-1,0,0));a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertxBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand=a;a=m.createRenderCommand();a.setStreamSource(0,this._positionVertxBuffer,0,8);a.setStreamSource(1,this._textureCoordVertxBuffer,
0,4);null!==this._textureCoordVertxBuffer2&&(a.setStreamSource(2,this._textureCoordVertxBuffer2,0,4),a.setStreamSource(3,-1,0,0));a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertxBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand2=a;a=m.createRenderCommand();a.setStreamSource(0,this._positionVertxBuffer,0,8);a.setStreamSource(1,this._textureCoordVertxBuffer,0,4);null!==this._textureCoordVertxBuffer2&&(a.setStreamSource(2,this._textureCoordVertxBuffer2,
0,4),a.setStreamSource(3,-1,0,0));a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertxBuffer.numItems,this._indexBuffer.numItems/3);this._shadowCastRenderCommand=a}else this.framework.forceRedraw()}};a.prototype.createRenderCommandWith32BitIndex=function(a){if(null!==a){var c=this._bufferPool;if(c.canUpload(3,0)){this.minBoundary=[a.min_x,a.min_y,a.min_z];this.maxBoundary=[a.max_x,a.max_y,a.max_z];d.add(g,this.minBoundary,this.maxBoundary);d.scale(g,g,
0.5);b.translate(h,a.min_x,a.min_y,a.min_z);b.scale(l,a.max_x-a.min_x,a.max_y-a.min_y,a.max_z-a.min_z);b.multiply(this._unpackMatrix,l,h);var e=this.framework.renderDevice._gl,m=this.framework.renderDevice;this._positionVertxBuffer=c.allocateBuffer(e.ARRAY_BUFFER,a.verticesArray,8,e.UNSIGNED_SHORT,!0);this._textureCoordVertxBuffer=c.allocateBuffer(e.ARRAY_BUFFER,a.textureCoordArray,4,e.UNSIGNED_SHORT,!0);this._indexBuffer=c.allocateBuffer(e.ELEMENT_ARRAY_BUFFER,a.faceIndices,4,e.UNSIGNED_INT);a=m.createRenderCommand();
a.setStreamSource(0,this._positionVertxBuffer,0,8);a.setStreamSource(1,this._textureCoordVertxBuffer,0,4);null!==this._textureCoordVertxBuffer2&&(a.setStreamSource(2,this._textureCoordVertxBuffer2,0,4),a.setStreamSource(3,-1,0,0));a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertxBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand=a;a=m.createRenderCommand();a.setStreamSource(0,this._positionVertxBuffer,0,8);a.setStreamSource(1,this._textureCoordVertxBuffer,
0,4);null!==this._textureCoordVertxBuffer2&&(a.setStreamSource(2,this._textureCoordVertxBuffer2,0,4),a.setStreamSource(3,-1,0,0));a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertxBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand2=a;a=m.createRenderCommand();a.setStreamSource(0,this._positionVertxBuffer,0,8);a.setStreamSource(1,this._textureCoordVertxBuffer,0,4);null!==this._textureCoordVertxBuffer2&&(a.setStreamSource(2,this._textureCoordVertxBuffer2,
0,4),a.setStreamSource(3,-1,0,0));a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertxBuffer.numItems,this._indexBuffer.numItems/3);this._shadowCastRenderCommand=a}}};a.prototype.upload=function(){null===this._renderCommand&&(!0==this._is32BitIndex?this.createRenderCommandWith32BitIndex(this._building):this.createRenderCommand(this._building))};a.prototype.isReady=function(){return null!==this._renderCommand};return a});
definejs("Scene/Indoor/IndoorRSMesh","Core/defaultValue Math/Matrix4 Math/MathUtils Math/MercatorCoords Math/Vector3 Math/Extent Resource/Downloader Resource/Texture Resource/Mesh Resource/ResourceState Framework/ConfigOptions Scene/Indoor/IndoorRSPatch".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m){function q(b,c,d,f){if(void 0!==f._textures[0]&&null!==f._textures[0]){var g=f._textures[0].textureGL;if(void 0!==g&&null!==g){var h=c.scale[0];e.sub(w,c.tileCenterWorld,b._sceneCenterWorld);a.translate(r,
w[0],w[1],0);a.scale(s,h,h,d.dataSource._scaleHeight);a.multiply(c._unpackModelViewProjectMatrix,f._unpackMatrix,r);a.multiply(c._unpackModelViewProjectMatrix,c._unpackModelViewProjectMatrix,b._viewMatrix);a.multiply(c._unpackModelViewProjectMatrix,c._unpackModelViewProjectMatrix,b._projectionMatrix);d=f._shadowCastRenderCommand;void 0===d._matrixUniforms[0]&&(d._matrixUniforms[0]=a.create());a.copy(d._matrixUniforms[0],c._unpackModelViewProjectMatrix);d._matrixUniforms[1]=f._unpackMatrix;d._matrixUniforms[2]=
[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];d._vectorUniforms[0]=[f._min_u,f._min_v,0,0];d._vectorUniforms[1]=[f._max_u,f._max_v,0,0];d._vectorUniforms[2]=[1,32,1024,0];d.setTexture(0,g);d.setRenderTechnique(b.framework.renderDevice.effectManager.getEffect(0).getTechnique(38));b._renderContext.getShadowCastRenderQueue().addRenderObject(d)}}}d=function(a,b,c,d){k.call(this,a,b,d||c);this.dataSource=a;this.imageDataSource=a.imageDataSource;
this.framework=null;this.url=a.createUrl(b,c);this.shadowCastRenderCommand=this.renderCommand=null;this.state=n.RESOURCE_WAITING;this.mortonKey=b;this.byteStream=null;this.chunkData={};this.patchs=[];this.minBoundary=[99999,99999,99999];this.maxBoundary=[-99999,-99999,-99999]};d.prototype=Object.create(k.prototype);d.prototype.finalize=function(){for(var a=this.patchs.length,b=0;b<a;b++)this.patchs[b].finalize(),this.patchs[b]=null;if(void 0!==this.chunkData.qcmsEntry){for(var c=this.chunkData.qcmsEntry.length,
a=0;a<c;a++){var d=this.chunkData.qcmsEntry[a];if(void 0!==d&&null!==d){for(b=0;b<d.materialCount;b++){var e=d.buildings[b];void 0!==e&&("shadows"===e.materialName?(e.verticesArray=null,e.noramlArray=null):(e.verticesArray=null,e.textureCoordArray=null),e.faceIndices=null,e.entryArray=null)}d.buildings=null}}this.chunkData.qcmsEntry=null}this.framework=this.patchs=null};d.prototype.upload=function(){if(this.state!==n.RESOURCE_READY&&this.state!==n.RESOURCE_LOADING)if(this.state===n.RESOURCE_WAITING)this.state=
n.RESOURCE_LOADING,l.loadByteStream(this,this.url);else if(this.state===n.RESOURCE_LOADED)this.workerManager.executeTask(this);else{if(this.state===n.RESOURCE_COMPILED){for(var a=!0,b=this.patchs.length,c=0;c<b;c++){var d=this.patchs[c];if(0==d._textures.length)for(var e=0;e<d._materialNames.length;e++){var g=d._materialNames[e];if(g&&""!==g&&"texture/"!==g){var h=this.base_url+g;-1!=this.base_url.indexOf("dataType=file")&&(h=this.base_url+encodeURIComponent(g));"texture/wall_ssao.jpg"===g?d._textures[e]=
this.imageDataSource.createResource(h,f.textureDataURLMap[g]):"texture/floor_default.png"===g?d._textures[e]=this.imageDataSource.createResource(h,f.textureDataURLMap[g]):f.textureDataURLMap.hasOwnProperty(g)?d._textures[e]=this.imageDataSource.createResource(h,f.textureDataURLMap[g]):d._textures[e]=this.imageDataSource.createResource(h,h);d._textures[e].flipY=!0;1===e&&(d._textures[e].clamp=!0)}else d._textures[e]=void 0}g=!0;for(e=0;e<d._textures.length;e++)if(h=d._textures[e])h.isReady()||h.upload(),
h.isReady()||h.isError()||(g=!1);!1===g&&(a=!1)}!0===a&&(this.state=n.RESOURCE_TEXTURES_READY)}if(this.state===n.RESOURCE_TEXTURES_READY){a=this.patchs.length;b=!0;for(c=0;c<a;c++)if(d=this.patchs[c],d.upload(),!d.isReady()){b=!1;break}b&&(this.state=n.RESOURCE_READY,this.framework.render(!0))}}};d.prototype.isReady=function(){return this.state===n.RESOURCE_READY};d.prototype.onDataLoaded=function(a){this.byteStream=a;this.workerManager.addTask(this);this.workerManager.executeTask(this)};d.prototype.getFloorExtent=
function(a,b,c){for(var d=this.framework._spatialReference,f=0;f<this.patchs.length;f++){var g=this.patchs[f];g._patchType===c&&(e.assign(u,g._building.min_x,g._building.min_y,g._building.min_z),d.transformLocalToGeographics(u,u,a.tileCenter),h.mergePoint(b,b,u),e.assign(v,g._building.max_x,g._building.max_y,g._building.max_z),d.transformLocalToGeographics(v,v,a.tileCenter),h.mergePoint(b,b,v))}return!0};d.prototype.getBoundaryBox=function(a,b,c){e.assign(a,9999999,9999999,9999999);e.assign(b,-9999999,
-9999999,-9999999);for(var d=0;d<this.patchs.length;d++){var f=this.patchs[d];f._patchType===c&&(a[0]=Math.min(a[0],f._building.min_x),a[1]=Math.min(a[1],f._building.min_y),a[2]=Math.min(a[2],f._building.min_z),b[0]=Math.max(b[0],f._building.max_x),b[1]=Math.max(b[1],f._building.max_y),b[2]=Math.max(b[2],f._building.max_z))}return!0};d.prototype.getAllBoundaryBox=function(a,b){e.assign(a,9999999,9999999,9999999);e.assign(b,-9999999,-9999999,-9999999);for(var c=0;c<this.patchs.length;c++){var d=this.patchs[c];
a[0]=Math.min(a[0],d._building.min_x);a[1]=Math.min(a[1],d._building.min_y);a[2]=Math.min(a[2],d._building.min_z);b[0]=Math.max(b[0],d._building.max_x);b[1]=Math.max(b[1],d._building.max_y);b[2]=Math.max(b[2],d._building.max_z)}return!0};d.prototype.onWorkerFinished=function(a){var b=a.chunkData.data,c=this.dataSource.isGenShadowMap,d=this.framework.renderDevice.isSupportElementIndexUint;if(a.patchs&&0===a.patchs.length&&b){for(var e=0,f=b.length;e<f;e++)if(!0===b[e].building.is32BitIndex&&!1===d)console.log("["+
b[e].building.materialName+" has 32bit indexbuffer, but device is not supported!!!");else{var g=new m;g._patchType=b[e]._patchType;g.initialize(a.framework,b[e].building,a.mortonKey,{isGenShadowMap:c});a.minBoundary[0]=Math.min(a.minBoundary[0],g._building.min_x);a.minBoundary[1]=Math.min(a.minBoundary[1],g._building.min_y);a.minBoundary[2]=Math.min(a.minBoundary[2],g._building.min_z);a.maxBoundary[0]=Math.max(a.maxBoundary[0],g._building.max_x);a.maxBoundary[1]=Math.max(a.maxBoundary[1],g._building.max_y);
a.maxBoundary[2]=Math.max(a.maxBoundary[2],g._building.max_z);a.patchs.push(g)}a.state!=n.RESOURCE_COMPILED&&(a.state=n.RESOURCE_COMPILED,this.upload())}};a.create();e.create();var x=a.create(),p=e.create(),s=a.create(),r=a.create(),z=0,t=a.create();a.create();e.create();var w=e.create(),u=e.create(),v=e.create();e.create();e.create();e.create();d.prototype.addToRenderQueue=function(c,d,f){f=this.patchs.length;for(var g=0;g<f;g++){var h=this.patchs[g],m=h._patchType,l=b(c._genShadowMapPass,!1),k=
b(c._genGlowMapPass,!1);if(l)0===m?q(c,d,this,h):11===m&&q(c,d,this,h);else if(k){if(12===m&&(m=c,l=d,void 0!==h._textures[0]&&null!==h._textures[0]&&(k=h._textures[0].textureGL,void 0!==k&&null!==k))){var n=l.scale[0];e.sub(w,l.tileCenterWorld,m._sceneCenterWorld);a.translate(r,w[0],w[1],0);a.scale(s,n,n,this.dataSource._scaleHeight);a.multiply(l._unpackModelViewProjectMatrix,h._unpackMatrix,s);a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,r);a.multiply(l._unpackModelViewProjectMatrix,
l._unpackModelViewProjectMatrix,m._viewMatrix);a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,m._projectionMatrix);n=h._shadowCastRenderCommand;void 0===n._matrixUniforms[0]&&(n._matrixUniforms[0]=a.create());a.copy(n._matrixUniforms[0],l._unpackModelViewProjectMatrix);n._matrixUniforms[1]=h._unpackMatrix;n._matrixUniforms[2]=[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];n._vectorUniforms[0]=[h._min_u,h._min_v,0,0];n._vectorUniforms[1]=[h._max_u,h._max_v,0,0];n._vectorUniforms[2]=
[1,32,1024,0];n.setTexture(0,k);n.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(46));m._renderContext.getGlowMapRenderQueue().addRenderObject(n)}}else if(0===m){if(m=c,l=d,n=m.framework._spatialReference,void 0!==h._textures[0]&&null!==h._textures[0]&&(k=h._textures[0].textureGL,void 0!==k&&null!==k)){var u=l.scale[0];n.matrixWorldToRender(r,l.tileCenterWorld);a.scale(s,u,u,this.dataSource._scaleHeight);a.translate(t,0,0,m.heightOffset);n.matrixWorldToRender2(r,
l.tileCenter,m._camera._cameraParam.scaleFactor);a.multiply(l._unpackModelViewProjectMatrix,h._unpackMatrix,s);a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,t);a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,r);a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,m._viewProjectionMatrix);n=m.alpha;u=h._renderCommand;1===n&&(void 0===u._matrixUniforms[0]&&(u._matrixUniforms[0]=a.create()),a.copy(u._matrixUniforms[0],l._unpackModelViewProjectMatrix),
u._matrixUniforms[1]=m.defaultLightMatrix,u._vectorUniforms[0]=[h._min_u,h._min_v,0,0],u._vectorUniforms[1]=[h._max_u,h._max_v,0,0],u._vectorUniforms[2]=[1,32,1024,0],u._vectorUniforms[3]=[1,1,1,n],u.setTexture(0,k),u.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(18)),m._renderContext._renderQueues[0].addRenderObject(u));if(1>n||h._isTransparency)u=h._renderCommand2,void 0!==u&&(void 0===u._matrixUniforms[0]&&(u._matrixUniforms[0]=a.create()),a.copy(u._matrixUniforms[0],
l._unpackModelViewProjectMatrix),u._matrixUniforms[1]=m.defaultLightMatrix,u._vectorUniforms[0]=[h._min_u,h._min_v,0,0],u._vectorUniforms[1]=[h._max_u,h._max_v,0,0],u._vectorUniforms[2]=[1,32,1024,0],u._vectorUniforms[3]=[0,0,0,n],u.setTexture(0,k),1>n?u.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(56)):u.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(31)),m._renderContext._renderQueues[1].addRenderObject(u))}}else if(1===
m){var m=c,l=d,v=m.framework._spatialReference;if(void 0!==h._textures[0]&&null!==h._textures[0]&&(k=h._textures[0].textureGL,void 0!==k&&null!==k&&(n=this.dataSource._textures.water_normalmap,void 0!==n&&(u=this.dataSource._textures.water_reflectionmap,void 0!==u)))){var y=l.scale[0];a.scale(s,y,y,this.dataSource._scaleHeight);a.translate(t,0,0,m.heightOffset);v.matrixWorldToRender2(r,l.tileCenter,m._camera._cameraParam.scaleFactor);a.multiply(l._unpackModelViewProjectMatrix,a.IDENTITY,s);a.multiply(l._unpackModelViewProjectMatrix,
l._unpackModelViewProjectMatrix,t);a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,r);a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,m._viewProjectionMatrix);a.multiply(x,l._unpackModelViewProjectMatrix,m._camera._cameraParam.invProjectMatrix);v=h._renderCommand;v.setTexture(0,k);v.setTexture(1,n);v.setTexture(2,u);v.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(21));void 0===v._matrixUniforms[0]&&(v._matrixUniforms[0]=
a.create());void 0===v._matrixUniforms[1]&&(v._matrixUniforms[1]=a.create());a.copy(v._matrixUniforms[0],l._unpackModelViewProjectMatrix);a.copy(v._matrixUniforms[1],x);v._matrixUniforms[2]=[0,0,0,1,0,0,0,1,0,0,0,1,0.6,1,1,1];e.sub(p,m._camera._position,l.tileCenterWorld);z+=1E-5;1<=z&&(z=0);v._vectorUniforms[0]=[z,z,1,1];v._vectorUniforms[1]=[0.4449038,0,0,0];v._vectorUniforms[2]=[h.minBoundary[0],h.minBoundary[1],h.minBoundary[2],0];v._vectorUniforms[3]=[h.maxBoundary[0],h.maxBoundary[1],h.maxBoundary[2],
0];v._vectorUniforms[4]=[h._min_u,h._min_v,0,0];v._vectorUniforms[5]=[h._max_u,h._max_v,0,0];v._vectorUniforms[6]=[p[0],p[1],p[2],0];v._vectorUniforms[7]=[l.upNormal[0],l.upNormal[1],l.upNormal[2],0];v._vectorUniforms[8]=[0,0,0,0];v._vectorUniforms[9]=[-214.6747131,35.3252869,16E4,9E5];v._vectorUniforms[10]=[1,0,0,0];v._vectorUniforms[11]=[0,0,0,1];m._renderContext._renderQueues[0].addRenderObject(v)}}else if(10===m){if(m=c,l=d,void 0!==h._textures[0]&&null!==h._textures[0]&&(k=h._textures[0].textureGL,
void 0!==k&&null!==k&&(n=null,n=null!==this.dataSource.shadowCastTexture?this.dataSource.shadowCastTexture:h._textures[1].textureGL,void 0!==n&&null!==n&&(u=null,null!==this.dataSource.glowMapTexture&&(u=this.dataSource.glowMapTexture),v=l.scale[0],y=m.framework._spatialReference,a.scale(s,v,v,this.dataSource._scaleHeight),a.translate(t,0,0,m.heightOffset),y.matrixWorldToRender2(r,l.tileCenter,m._camera._cameraParam.scaleFactor),a.multiply(l._unpackModelViewProjectMatrix,h._unpackMatrix,s),a.multiply(l._unpackModelViewProjectMatrix,
l._unpackModelViewProjectMatrix,t),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,r),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,m._viewProjectionMatrix),v=m.alpha,y=h._renderCommand,1===v&&(void 0===y._matrixUniforms[0]&&(y._matrixUniforms[0]=a.create()),void 0===y._matrixUniforms[1]&&(y._matrixUniforms[1]=a.create()),a.copy(y._matrixUniforms[0],l._unpackModelViewProjectMatrix),a.copy(y._matrixUniforms[1],h._unpackMatrix),y._matrixUniforms[2]=
m.defaultLightMatrix,y._vectorUniforms[0]=[h._min_u,h._min_v,0,0],y._vectorUniforms[1]=[h._max_u,h._max_v,0,0],y._vectorUniforms[2]=[1,32,1024,0],y._vectorUniforms[3]=[1,1,0,0],y._vectorUniforms[4]=[this.minBoundary[0],this.minBoundary[1],this.maxBoundary[0],this.maxBoundary[1]],y._vectorUniforms[5]=[1,1,1,v],y.setTexture(0,k),y.setTexture(1,n),null!==u?(y.setTexture(2,u),y.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(45))):y.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(36)),
m._renderContext._renderQueues[0].addRenderObject(y)),1>v||h._isTransparency))))y=h._renderCommand2,void 0!==y&&(void 0===y._matrixUniforms[0]&&(y._matrixUniforms[0]=a.create()),void 0===y._matrixUniforms[1]&&(y._matrixUniforms[1]=a.create()),a.copy(y._matrixUniforms[0],l._unpackModelViewProjectMatrix),a.copy(y._matrixUniforms[1],h._unpackMatrix),y._matrixUniforms[2]=m.defaultLightMatrix,y._vectorUniforms[0]=[h._min_u,h._min_v,0,0],y._vectorUniforms[1]=[h._max_u,h._max_v,0,0],y._vectorUniforms[2]=
[1,32,1024,0],y._vectorUniforms[3]=[1,1,0,0],y._vectorUniforms[4]=[this.minBoundary[0],this.minBoundary[1],this.maxBoundary[0],this.maxBoundary[1]],y._vectorUniforms[5]=[0,0,0,v],y.setTexture(0,k),y.setTexture(1,n),null!==u?(y.setTexture(2,u),y.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(45))):1>v?y.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(55)):y.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(54)),
m._renderContext._renderQueues[1].addRenderObject(y))}else if(11===m){if(m=c,l=d,k=h._textures[0].textureGL,void 0!==k&&null!==k&&(n=h._textures[1].textureGL,void 0!==n&&null!==n&&(u=l.scale[0],v=m.framework._spatialReference,v.matrixWorldToRender(r,l.tileCenterWorld),a.scale(s,u,u,u*this.dataSource._scaleHeight),a.translate(t,0,0,m.heightOffset),v.matrixWorldToRender2(r,l.tileCenter,m._camera._cameraParam.scaleFactor),a.multiply(l._unpackModelViewProjectMatrix,h._unpackMatrix,s),a.multiply(l._unpackModelViewProjectMatrix,
l._unpackModelViewProjectMatrix,t),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,r),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,m._viewProjectionMatrix),u=m.alpha,v=h._renderCommand,1===u&&(void 0===v._matrixUniforms[0]&&(v._matrixUniforms[0]=a.create()),void 0===v._matrixUniforms[1]&&(v._matrixUniforms[1]=a.create()),a.copy(v._matrixUniforms[0],l._unpackModelViewProjectMatrix),a.copy(v._matrixUniforms[1],h._unpackMatrix),v._matrixUniforms[2]=
m.defaultLightMatrix,v._vectorUniforms[0]=[h._min_u,h._min_v,0,0],v._vectorUniforms[1]=[h._max_u,h._max_v,0,0],v._vectorUniforms[2]=[1,32,1024,0],v._vectorUniforms[3]=[0,0,1,1],v._vectorUniforms[4]=[this.minBoundary[2],this.maxBoundary[2],0,0],v._vectorUniforms[5]=[1,1,1,u],v.setTexture(0,k),v.setTexture(1,n),v.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(36)),m._renderContext._renderQueues[0].addRenderObject(v)),1>u||h._isTransparency)))v=h._renderCommand2,
void 0!==v&&(void 0===v._matrixUniforms[0]&&(v._matrixUniforms[0]=a.create()),void 0===v._matrixUniforms[1]&&(v._matrixUniforms[1]=a.create()),a.copy(v._matrixUniforms[0],l._unpackModelViewProjectMatrix),a.copy(v._matrixUniforms[1],h._unpackMatrix),v._matrixUniforms[2]=m.defaultLightMatrix,v._vectorUniforms[0]=[h._min_u,h._min_v,0,0],v._vectorUniforms[1]=[h._max_u,h._max_v,0,0],v._vectorUniforms[2]=[1,32,1024,0],v._vectorUniforms[3]=[0,0,1,1],v._vectorUniforms[4]=[this.minBoundary[2],this.maxBoundary[2],
0,0],v._vectorUniforms[5]=[0,0,0,u],v.setTexture(0,k),v.setTexture(1,n),1>u?v.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(55)):v.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(54)),m._renderContext._renderQueues[1].addRenderObject(v))}else 12!==m&&(13===m?(m=c,l=d,void 0!==h._textures[0]&&null!==h._textures[0]&&(k=h._textures[0].textureGL,void 0!==k&&null!==k&&(n=h._textures[1].textureGL,void 0!==n&&null!==n&&(u=h._textures[2].textureGL,
void 0!==u&&null!==u&&(v=l.scale[0],y=m.framework._spatialReference,a.scale(s,v,v,this.dataSource._scaleHeight),a.translate(t,0,0,m.heightOffset),y.matrixWorldToRender2(r,l.tileCenter,m._camera._cameraParam.scaleFactor),a.multiply(l._unpackModelViewProjectMatrix,h._unpackMatrix,s),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,t),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,r),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,
m._viewProjectionMatrix),v=h._renderCommand,void 0===v._matrixUniforms[0]&&(v._matrixUniforms[0]=a.create()),void 0===v._matrixUniforms[1]&&(v._matrixUniforms[1]=a.create()),a.copy(v._matrixUniforms[0],l._unpackModelViewProjectMatrix),a.copy(v._matrixUniforms[1],h._unpackMatrix),v._matrixUniforms[2]=m.defaultLightMatrix,v._vectorUniforms[0]=[h._min_u,h._min_v,0,0],v._vectorUniforms[1]=[h._max_u,h._max_v,0,0],v._vectorUniforms[2]=[1,32,1024,0],v._vectorUniforms[3]=[0,0,1,1],v._vectorUniforms[4]=[this.minBoundary[2],
this.maxBoundary[2],0,0],v.setTexture(0,k),v.setTexture(1,n),v.setTexture(2,u),v.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(47)),m._renderContext._renderQueues[0].addRenderObject(v),v=h._renderCommand2,void 0!==v&&(void 0===v._matrixUniforms[0]&&(v._matrixUniforms[0]=a.create()),void 0===v._matrixUniforms[1]&&(v._matrixUniforms[1]=a.create()),a.copy(v._matrixUniforms[0],l._unpackModelViewProjectMatrix),a.copy(v._matrixUniforms[1],h._unpackMatrix),v._matrixUniforms[2]=
m.defaultLightMatrix,v._vectorUniforms[0]=[h._min_u,h._min_v,0,0],v._vectorUniforms[1]=[h._max_u,h._max_v,0,0],v._vectorUniforms[2]=[1,32,1024,0],v._vectorUniforms[3]=[0,0,1,1],v._vectorUniforms[4]=[this.minBoundary[2],this.maxBoundary[2],0,0],v.setTexture(0,k),v.setTexture(1,n),v.setTexture(2,u),v.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(47)),m._renderContext._renderQueues[1].addRenderObject(v))))))):(m=c,l=d,k=l.scale[0],n=m.framework._spatialReference,
a.scale(s,k,k,this.dataSource._scaleHeight),h._unpackMatrix=a.create(),a.translate(t,0,0,m.heightOffset),n.matrixWorldToRender2(r,l.tileCenter,m._camera._cameraParam.scaleFactor),a.multiply(l._unpackModelViewProjectMatrix,a.IDENTITY,s),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,t),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,r),a.multiply(l._unpackModelViewProjectMatrix,l._unpackModelViewProjectMatrix,m._viewProjectionMatrix),k=h._renderCommand,
k.setRenderTechnique(m.framework.renderDevice.effectManager.getEffect(0).getTechnique(26)),void 0===k._matrixUniforms[0]&&(k._matrixUniforms[0]=a.create()),a.copy(k._matrixUniforms[0],l._unpackModelViewProjectMatrix),k._vectorUniforms[0]=[h.minBoundary[0],h.minBoundary[1],h.minBoundary[2],0],k._vectorUniforms[1]=[h.maxBoundary[0],h.maxBoundary[1],h.maxBoundary[2],12],k._vectorUniforms[2]=[l.upNormal[0],l.upNormal[1],l.upNormal[2],this.dataSource._scaleHeight],m._renderContext._renderQueues[2].addRenderObject(k)))}};
return d});
definejs("Scene/Indoor/IndoorRSMeshManager",["Framework/ConfigOptions"],function(b){var a=function(){this.imageDataSource=this.meshAllocator=this.tileCache=this.dataProvider=this.framework=null;this._meshs={};this.createContext={};this.createContext.dataResource=this;this.createContext.url="";this.isBuilding=!1;this.levelScales=[];this.lifeTimeList=b.model_layer_life_time_list;this._renderTechniques=[];this._bNight=this.isGenShadowMap=!1;this._bLandMark=!0;this._scaleHeight=1;this.glowMapTexture=this.shadowCastTexture=
this._createResourceFunc=null;this._textures=[];this._textureUrls=[]};a.prototype.initialize=function(a){this.framework=a;this.meshAllocator=a.meshAllocator;a=b.base_relative_path;"/"!=a.slice(a.length-1)&&(a+="/");this._textures.water_normalmap=this.framework.getTextureManager().createTexture(a+"resource/water_normalmap.png");this._textureUrls.push(a+"resource/water_normalmap.png");this._textures.water_reflectionmap=this.framework.getTextureManager().createTexture(a+"resource/water_reflectionmap.png");
this._textureUrls.push(a+"resource/water_reflectionmap.png")};a.prototype.setCreateFunction=function(a){this._createResourceFunc=a};a.prototype.finalize=function(){for(var a=0;a<this._textureUrls.length;a++)this.framework.getTextureManager().releaseTexture(this._textureUrls);this._textures=[];this._textureUrls=[];this.framework=null;this.glowMapTexture=this.shadowCastTexture=this._createResourceFunc=this.levelScales=this.createContext=this.createContext.dataResource=null};a.prototype.createUrl=function(a){return a};
a.prototype.createResource=function(a,b,e,h){var l=this._meshs,g=l[a];void 0===g&&this._createResourceFunc&&(g=this._createResourceFunc(this.framework,this,a,b,e,h),l[a]=g);return g};a.prototype.deleteResource=function(a){var b=this._meshs[a];void 0!==b&&(b.finalize(),delete this._meshs[a])};return a});
definejs("Scene/Indoor/IndoorRSModelLayerTessellator","Renderer/RenderQueue Math/MathUtils Math/Matrix4 Math/Ellipsoid Math/Vector3 Framework/AppState".split(" "),function(b,a,d,c,e,h){b={};var l=[],g=Math.PI/32768*16,k=e.create(),n=e.create();b.getBoundaryBox=function(a,b,c,d){e.assign(b,9999999,9999999,9999999);e.assign(c,-9999999,-9999999,-9999999);for(var g=0;g<a.length;g++){var h=a[g];h.isReady()&&(h.getBoundaryBox(k,n,d),b[0]=Math.min(b[0],k[0]),b[1]=Math.min(b[1],k[1]),b[2]=Math.min(b[2],k[2]),
c[0]=Math.max(c[0],n[0]),c[1]=Math.max(c[1],n[1]),c[2]=Math.max(c[2],n[2]))}};b.getFloorExtent=function(b,c,d){for(var e=0;e<b.length;e++){var g=b[e];g.isReady()&&g.getFloorExtent(c,d)}c._west*=a.DEGREE_PER_RADIANS;c._east*=a.DEGREE_PER_RADIANS;c._south*=a.DEGREE_PER_RADIANS;c._north*=a.DEGREE_PER_RADIANS};b.tessellate=function(b,d,e,k){d=b._camera;k=b._renderContext._renderQueues[0];for(var p=b.framework.uploadQueue,n=h.frame_states.frame_counter,r=l.length=0;r<e.length;r++)l.push(e[r]);for(;0<l.length;){r=
l.pop();r.used=1;var z;z=r;var t=d,w=t._aimGeographic,u=z.tileCenter,w=a.getGeodeticCircleRadians(u[0],u[1],w[0],w[1]),u=g/Math.pow(2,z.level),w=w-0.5*u,w=w*c.Radius;z.priority=1E4*(24-z.level)+(1E4-w);z=3E3<w?!1:a.FrustumIntersectExtent(t._frustum,z.extent);z&&(r.used=2,r.frameCounter=n,r.isReady()?r.addToRenderQueue(b,k):(r.isError()&&r.reset(),p.add(r)))}for(r=b=0;r<e.length;r++)e[r].isReady()&&b++;return 0<b&&b===e.length?!0:!1};return b});
definejs("Scene/Indoor/SpatialNode",["Math/Extent","Scene/Indoor/IndoorRSModelLayerTessellator"],function(b,a){var d=function(){this.framework=null;this.nodes=[];this.extent=new b;this.visible=!0};d.prototype.initialize=function(a){this.framework=a};d.prototype.finalize=function(){this.extent=this.framework=null};d.prototype.cull=function(b){!1!==this.visible&&a.tessellate(b,null,this.nodes)};return d});
definejs("Scene/Indoor/IndoorRSModelLayer","Math/Extent Math/Vector3 Math/MathUtils Math/Matrix4 Math/Ellipsoid Resource/Downloader Resource/TileCache Resource/ResourceState Resource/TextureDataSource Scene/Indoor/IndoorRSModelNode Scene/Indoor/IndoorRSMesh Scene/Indoor/IndoorRSMeshManager Scene/Indoor/SpatialNode Scene/Indoor/IndoorRSModelLayerTessellator Framework/ConfigOptions Core/defaultValue".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p,s){function r(a,b,c,d,e,g,h){b=new f(b,d,g,h);b.initialize(a);
return b}function z(a,b){var c=new n(b.dataSource,a,b.url,b.base_url,b.imgbase_url);c.used=2;return c}c=function(){this.framework=null;this.nodes=[];this.state=g.RESOURCE_WAITING;this.base_url=this.url="";this.extent=new b;this.dataSource=this.tileCache=null;this.isBuilding=!1;this.id="";this.createContext={};this.visible=!0;this.isGenShadowMap=!1;this.faded=3;this.zoom16Height=2450;this.zoomHeightMap={12:39248,13:19611,14:9802,15:4900,16:2450};this.defaultLightMatrix=[200/255,200/255,200/255,1,40/
255,40/255,40/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];this.shadowMapParam={shadowMapWidth:512,shadowMapHeight:512,shadowMapPixelOffsetX:0,shadowMapPixelOffsetY:0};this.heightOffset=0;this.opacity=1;this.version=3};c.prototype.initialize=function(a){this.framework=a;var b=new l;b.initialize(a);a.tileCacheManager.add(b);this.tileCache=b;this.dataSource=new m;this.dataSource.initialize(a);this.dataSource.setCreateFunction(r);b=new k;b.base_url=this.base_url;b.initialize(a);this.dataSource.imageDataSource=
b;this.maxHeight=this.zoomHeightMap[this.minLevel]?this.zoomHeightMap[this.minLevel]:this.zoom16Height*Math.pow(2,16-this.minLevel)};c.prototype.finalize=function(){this.extent=this.framework=null;this.isGenShadowMap=!1};c.prototype.createTileImpl=function(a,b,c){this.createContext.url=b;this.createContext.base_url=this.base_url;this.createContext.imgbase_url=c;this.createContext.dataSource=this.dataSource;this.createContext.isBuilding=this.isBuilding;this.createContext.levelScales=this.levelScales;
a=this.tileCache.createTile(a,z,this.createContext);a.refCount++;return a};c.prototype.cull=function(a){if(!a.isCullPoiOnly&&!1!=this.visible&&this.state===g.RESOURCE_READY){var c=1,e=this.framework._isExplodedView;if(this.minLevel<=this.maxLevel){if(a._camera._zoomLevel<this.minLevel||a._camera._zoomLevel>this.maxLevel)return;e||(this.faded&1&&(e=a._camera._zoomLevel-this.minLevel,1>=e&&0<=e&&(c=e)),this.faded&2&&24>this.maxLevel&&(e=this.maxLevel-a._camera._zoomLevel,1>=e&&0<=e&&(c=e)))}c*=this.opacity;
if(!(a._camera._position[2]>this.maxHeight)&&d.FrustumIntersectExtent(a._camera._frustum,this.extent)){a.defaultLightMatrix=this.defaultLightMatrix;a.heightOffset=this.heightOffset;a.alpha=c;c=x.tessellate(a,null,this.nodes);if(!0===this.isGenShadowMap&&c&&null===this.dataSource.shadowCastTexture){e=a.framework._shadowMapRender;b.makeInvalid(w);x.getFloorExtent(this.nodes,w,10);x.getBoundaryBox(this.nodes,t.minBoundary,t.maxBoundary,10);null===this.dataSource.shadowCastTexture&&(this.dataSource.shadowCastTexture=
e.createShadowTexture());var f;f=1==this.version?e.makeShadowCastCullArgsByPosition(a,this.tileCenter,t):e.makeShadowCastCullArgs(a,w,t);x.tessellate(f,null,this.nodes);e.beginScene(this.dataSource.shadowCastTexture);e.renderScene(f);e.endScene()}!0===this.isLightGlow&&c&&null===this.dataSource.glowMapTexture&&(c=a.framework._glowMapRender,b.makeInvalid(w),x.getFloorExtent(this.nodes,w,10),x.getBoundaryBox(this.nodes,t.minBoundary,t.maxBoundary,10),null===this.dataSource.glowMapTexture&&(this.dataSource.glowMapTexture=
c.createGlowTexture()),a=c.makeShadowCastCullArgs(a,w,t),a._genShadowMapPass=!1,a._genGlowMapPass=!0,x.tessellate(a,null,this.nodes),c.beginScene(this.dataSource.glowMapTexture),c.renderScene(a),c.endScene(),this.framework.forceRedraw())}}};var t={minBoundary:a.create(),maxBoundary:a.create()},w=new b;c.prototype.intersect=function(a){return!1};c.prototype.getExtent=function(a){b.combine(a,this.extent,a)};c.prototype.setHeightOffset=function(a){this.heightOffset=a};c.prototype.setOpacity=function(a){this.opacity=
a};var u=a.create(),v=new b;c.prototype.parseJSON=function(c){this.base_url=p.base_resource_url;c.rect.split(",");0===c.shadowMap?this.isUseShadowMap=this.isGenShadowMap=!1:1===c.shadowMap?this.isUseShadowMap=this.isGenShadowMap=!0:2===c.shadowMap&&(this.isGenShadowMap=!1,this.isUseShadowMap=!0);c.lightParam&&(this.defaultLightMatrix=c.lightParam);if(this.dataSource.isGenShadowMap=this.isGenShadowMap){var e=this.shadowMapParam;e.shadowMapWidth=s(c.shadowMapWidth,1024);e.shadowMapHeight=s(c.shadowMapHeight,
1024);e.shadowMapPixelOffsetX=s(c.shadowMapPixelOffsetX,0);e.shadowMapPixelOffsetY=s(c.shadowMapPixelOffsetY,0)}var e=c.features,f=this.extent;b.makeInvalid(f);for(var h=0;h<e.length;h++){var m=e[h],l=m.rect.split(",");v._west=parseFloat(l[0])*d.RADIANS_PER_DEGREE;v._south=parseFloat(l[1])*d.RADIANS_PER_DEGREE;v._east=parseFloat(l[2])*d.RADIANS_PER_DEGREE;v._north=parseFloat(l[3])*d.RADIANS_PER_DEGREE;v._minHeight=0;v._maxHeight=400;b.combine(f,f,v)}this.framework._spatialReference.UpdateExtentCorner(f);
b.getCenter(u,f);u[2]=0;this.base_url+=c.link||"";this.version=s(c.version||3);e=c.features;for(h=0;h<e.length;h++){var m=e[h],k=m.name;if(!k)return;var k=this.base_url+k+(window.version?"?version="+window.version:""),k=this.createTileImpl(k,k,c.imageSourceUrl),l=m.rect.split(","),q=k.extent;q._west=parseFloat(l[0])*d.RADIANS_PER_DEGREE;q._south=parseFloat(l[1])*d.RADIANS_PER_DEGREE;q._east=parseFloat(l[2])*d.RADIANS_PER_DEGREE;q._north=parseFloat(l[3])*d.RADIANS_PER_DEGREE;q._minHeight=f._minHeight;
q._maxHeight=f._maxHeight;l=m.minMaxHeight;void 0!==l&&(q._minHeight=l[0],q._maxHeight=l[1]);this.framework._spatialReference.UpdateExtentCorner(q);l=m.position.split(",");k.tileCenter=a.make(parseFloat(l[0])*d.RADIANS_PER_DEGREE,parseFloat(l[1])*d.RADIANS_PER_DEGREE,q._minHeight);this.tileCenter=k.tileCenter;q=Math.cos(parseFloat(l[1])*d.RADIANS_PER_DEGREE);m=m.scale;void 0===m&&(m=[q,q,1]);k.scale=m;k.initialize(this.framework);this.nodes.push(k)}this.state=g.RESOURCE_READY};return c});
definejs("Scene/Indoor/IndoorScene","Math/Extent Math/Vector3 Math/MathUtils Math/Matrix4 Math/MercatorCoords Math/Ellipsoid Resource/Downloader Resource/TileCache Resource/ResourceState Resource/TextureDataSource Scene/Indoor/IndoorRSModelNode Scene/Indoor/IndoorRSMesh Scene/Indoor/IndoorRSMeshManager Scene/Indoor/SpatialNode Scene/Indoor/IndoorRSModelLayerTessellator Framework/ConfigOptions Core/defaultValue".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p,s,r){c=function(){this.framework=null;
this.name=this.id="";this.distanceToCamera=9999999999999;this.extent=new b;this.visible=!0;this.zoom16Height=2450;this.zoomHeightMap={12:39248,13:19611,14:9802,15:4900,16:2450}};c.prototype.initialize=function(a){this.bdInfo=a;this.minLevel=a.minLevel||14.5;this.maxHeight=this.zoomHeightMap[this.minLevel]?this.zoomHeightMap[this.minLevel]:this.zoom16Height*Math.pow(2,16-this.minLevel)};c.prototype.finalize=function(){this.extent=this.framework=null;this.name=this.id=""};var z=[0,0,0],t=[0,0,0];c.prototype.cull=
function(c){if(!1==this.visible||c._camera._position[2]>this.maxHeight||!d.FrustumIntersectExtent(c._camera._frustum,this.extent))return!1;b.getCenter(z,this.extent);z[2]=0;e.mercatorToSpherical(t,c._camera._position);t[2]=0;this.distanceToCamera=a.distance(z,t);return!0};c.prototype.intersect=function(a){return!1};c.prototype.getExtent=function(a){b.combine(a,this.extent,a)};return c});
definejs("Scene/UserLayer/Label","Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/LinearSampler Math/Color Math/Ellipsoid Math/MathUtils".split(" "),function(b,a,d,c,e,h,l,g){b=function(){this.positionECEF=this.positionGeographic=this.labelStyle=this.renderDevice=this.framework=null;this.address=this.floorName=this.floorId=this.id=this.text="";this.visible=!1;this.linearSampler=this.allRect=this.wholeRect=this.iconRect=this.textRect=this.positionScreen=null;this.viewDistance=this.currentAlpha=
0;this.lookatDistance=300;this.level=0;this.minLevel=17;this.maxLevel=24;this.iconIndex=0;this.scale=1;this.onMouseOut=this.onMouseOver=this.onClick=null};b.prototype.initialize=function(a){this.framework=a;this.spatialReference=a._spatialReference;this.positionGeographic=d.create();this.positionScreen=d.create();this.positionECEF=d.create();this.textRect=c.create();c.assign(this.textRect,0,0,16,16);this.iconRect=c.create();c.assign(this.iconRect,0,0,16,16);this.allRect=c.create();c.assign(this.iconRect,
0,0,16,16);this.iconRenderRect=c.create();this.textRenderRect=c.create();this.wholeRenderRect=c.create();this.linearSampler=e.make(0,1,0,60);this.blendColor=h.create();this.currentAlpha=0};b.prototype.finalize=function(){};b.prototype.setPosition=function(a,b,c){this.lon=a;this.lat=b;this.positionGeographic[0]=a*g.RADIANS_PER_DEGREE;this.positionGeographic[1]=b*g.RADIANS_PER_DEGREE;this.positionGeographic[2]=c;this.spatialReference.transformGeographicsToWorld(this.positionECEF,this.positionGeographic)};
b.prototype.setText=function(a){this.text=a};b.prototype.setId=function(a){this.id=a};b.prototype.setFloorId=function(a){this.floorId=a};b.prototype.setFloorName=function(a){this.floorName=a};b.prototype.setAddress=function(a){this.address=a};b.prototype.setVisible=function(a){this.visible!==a&&(this.visible=a,!0===a?this.framework._collisionManager.add(this):this.framework._collisionManager.remove(this))};b.prototype.getInfo=function(){return{id:this.id,iconIndex:this.iconIndex,floorId:this.floorId,
floorName:this.floorName,text:this.text,address:this.address,lon:this.lon,lat:this.lat}};b.prototype.cull=function(a){a=a._camera;var b=a._zoomLevel;b>this.maxLevel||b<this.minLevel||(a.projectionFromWorld(this.positionScreen,this.positionGeographic),this.viewDistance=0,0>this.positionScreen[2]||1<this.positionScreen[2]||(this.viewDistance=1-this.positionScreen[2]+this.level))};b.prototype.calculateVisible=function(a){var b=a._zoomLevel;if(b>this.maxLevel||b<this.minLevel)return!1;a.projectionFromWorld(this.positionScreen,
this.positionGeographic);this.viewDistance=0;if(0>this.positionScreen[2]||1<this.positionScreen[2])return!1;this.viewDistance=1-this.positionScreen[2]+this.level;return!0};b.prototype.updatePosition=function(a){a.projectionFromWorld(this.positionScreen,this.positionGeographic)};b.prototype.intersect=function(a){return c.containPoint(this.wholeRenderRect,a.mousePoint)?!0:!1};b.prototype.onVisible=function(a){e.assign(this.linearSampler,this.currentAlpha,1,a,a+60)};b.prototype.onDisable=function(a){e.assign(this.linearSampler,
this.currentAlpha,0,a,a+15)};b.prototype.setMinLevel=function(a){this.minLevel=a};b.prototype.setMaxLevel=function(a){this.maxLevel=a};b.prototype.setIconIndex=function(a){this.iconIndex=a};b.prototype.updateRect=function(){var a=this.positionScreen[0],b=this.positionScreen[1];c.assign(this.textRenderRect,this.textRect[0]+a,this.textRect[1]+b,this.textRect[2]+a,this.textRect[3]+b);c.assign(this.iconRenderRect,this.iconRect[0]+a,this.iconRect[1]+b,this.iconRect[2]+a,this.iconRect[3]+b);c.assign(this.wholeRenderRect,
this.allRect[0]+a,this.allRect[1]+b,this.allRect[2]+a,this.allRect[3]+b)};c.create();c.create();b.prototype.performanceLayout=function(){if(this.labelStyle){var a=this.labelStyle.font.fontRenderScale;0<this.text.length&&this.framework.renderDevice.fontRender.calcuTextSize(this.textRect,this.labelStyle.font,this.text,this.scale,this.labelStyle.alignment);0<this.iconIndex&&c.assign(this.iconRect,this.labelStyle.destRect[0]*a,this.labelStyle.destRect[1]*a,this.labelStyle.destRect[2]*a,this.labelStyle.destRect[3]*
a);c.offset(this.textRect,this.iconRect[2]+2,0);0<=this.labelStyle.alignment.indexOf("v_center")?(c.offset(this.iconRect,0,0.5*-this.iconRect[3]),c.offset(this.textRect,0,0.5*-this.textRect[3])):0<=this.labelStyle.alignment.indexOf("v_bottom")?(c.offset(this.iconRect,0,-this.iconRect[3]),c.offset(this.textRect,0,-this.textRect[3])):this.labelStyle.alignment.indexOf("v_top");var b=(0<this.iconIndex?1:0)|(0===this.iconIndex?2:0),d=0;b&1&&(d+=this.iconRect[2]);b&2&&(d+=this.textRect[2]);3===b&&(d+=2);
0<=this.labelStyle.alignment.indexOf("h_center")?(b&1&&c.offset(this.iconRect,0.5*-d,0),b&2&&c.offset(this.textRect,0.5*-d,0)):!(0<=this.labelStyle.alignment.indexOf("h_left"))&&0<=this.labelStyle.alignment.indexOf("h_right")&&(b&1&&c.offset(this.iconRect,-d,0),b&2&&c.offset(this.textRect,-d,0));c.makeInvalid(this.allRect);b&1&&c.combine(this.allRect,this.allRect,this.iconRect);b&2&&c.combine(this.allRect,this.allRect,this.textRect);a*=15;c.expand(this.allRect,a,a,a,a)}};d.create();var k=d.create();
b.prototype.render=function(a,b){if(!1!==this.visible){var c=this.positionScreen[0],e=this.positionScreen[1];this.currentAlpha=b;var g=this.labelStyle,h=d.squaredLength(a._camera._position),s=l.Radius;d.sub(k,a._camera._position,this.positionECEF);var r=d.length(k);Math.abs(r*r+s*s-h);h=this.scale*g.scale;r=[1,1,1,1];s=[1,1,1,b];0<this.iconIndex?this.labelStyle.texture&&this.labelStyle.texture.loaded&&(r=a._renderDevice.canvasMesh2D,h*=window.devicePixelRatio,r.drawTexture(this.labelStyle.texture,
this.iconRect[0]+c,this.iconRect[1]+e,this.iconRect[2]+c,this.iconRect[3]+e,g.srcRect,s,h*this.labelStyle.font.fontRenderScale)):(g=a._renderDevice.fontRender,g.setBlendColor(r),g.drawText(this.labelStyle.font,this.text,this.textRect[0]+c,this.textRect[1]+e,s,h*this.labelStyle.font.fontRenderScale))}};return b});
definejs("Scene/UserLayer/PoiDataSource",["Framework/ConfigOptions","Resource/Downloader"],function(b,a){var d=function(a,b){this._texturePool=this.framework=null;this._textures={};this._dataSourceManager=a;this._url=b;this.isDataExist=!0;this._callbackArray=[]};d.prototype.initialize=function(a){this.framework=a};d.prototype.finalize=function(){this.framework=null};d.prototype.getData=function(b){function d(a){var b=l;if(a){var c=a.centerlon,e=a.centerlat,h=a.data,q;for(q in h)if("object"==typeof h[q]){h[q].floorId=
q;var x=h[q].poi,p;for(p in x){var s=x[p];0===s.icon&&""===s.text?delete x[p]:(s.lon=s.lon/1E6+c,s.lat=s.lat/1E6+e,s.floorId=q,s.id=p)}}}a=b._cachedData=a;l._isLoaddingData=!1;for(var r in l._callbackArray)(b=l._callbackArray[r])&&b(a);l._callbackArray=[]}function h(a){l.isDataExist=!1;for(var b in l._callbackArray)(a=l._callbackArray[b])&&a(null);l._callbackArray=[]}var l=this;0===l._url.length?(l.isDataExist=!1,b&&b(null)):!1===l.isDataExist?b&&b(null):l._cachedData?b&&b(l._cachedData):(l._callbackArray.push(b),
!0!==l._isLoaddingData&&(l._isLoaddingData=!0,b={},window.downloader?window.downloader.getData(l._url,"get",b,"json",d,h):a.getData(l._url,b,"json",d,h)))};return d});
definejs("Scene/UserLayer/PoiLayer","Math/Extent Core/defineProperties Scene/UserLayer/Label Scene/UserLayer/PoiDataSource Style/LabelStyle Framework/ConfigOptions".split(" "),function(b,a,d,c,e,h){function l(a,b,d){b=new c(b,d.url);b.initialize(a);return b}var g=function(a,b){var c=arguments,d="";0<c.length?d=c[0]||"":"";for(var e=1;e<c.length;e++){var g=c[e];"/"!=d.slice(-1)&&(d+="/");g=g.replace("./","");"/"==g[0]&&(g=g.slice(1));d+=g}return d},k=function(){this.framework=null;this.nodes=[];this.extent=
new b;this._visible=!1;this.labelStyle=null;this.styles=[];this.dataSource=null};k.prototype.initialize=function(a){this.framework=a;for(var b=[63,5,4,6,0,1,3,2,7,8,9],c=b.length,d=0;64>d;d++){var l=d<c?b[d]:d-1,p=l%8*64/512,l=64*Math.floor(l/8)/512,k=new e;k.imageUrl=g(h.base_relative_path||"","images/default_pois.png");k.srcRect=[p,l,p+0.125,l+0.125];k.initialize(a);this.styles.push(k)}a=this.framework.getInteractionManager();null!==a&&(a=a.getCameraController(),null!==a&&(this.cameraController=
a))};k.prototype.finalize=function(){this.extent=this.framework=null};k.prototype.cull=function(a){};k.prototype.onClick=function(a){var b=this.framework.getInteractionManager();null!==b&&(b=b.getCameraController(),null!==b&&a&&a.getInfo&&b&&b.notifyEvent("poiClick",a.getInfo()))};k.prototype.noPoiClicked=function(a){this.cameraController&&this.cameraController.notifyEvent("noPoiClicked")};k.prototype.setPanoVisible=function(a){a=this.nodes;for(var b=a.length-1;0<b;b--){var c=a[b];9==c.iconIndex&&
c.setVisible(!c.visible)}};k.prototype.loadData=function(a,b){var c=this,d=a.split("?flid=")[0],e=a.split("?flid=")[1];c.framework.getDataSourceManager().createDataSource({key:d,url:d},l).getData(function(a){c.parseJSON(a.data[e],b)})};k.prototype.parseJSON=function(a,b){if(a){var c=a.poi,e;for(e in c){var g=c[e];if(24!==g.minlevel&&g.text){var h=g.icon||0;h>=this.styles.length&&(h=0);var l=new d;l.initialize(this.framework);l.labelStyle=this.styles[h];l.name=g.id;l.setPosition(g.lon,g.lat,1);l.setText(void 0!=
g.icon?g.text:"");l.setIconIndex(parseInt(g.icon||0));l.setMinLevel(g.minlevel);l.setMaxLevel(g.maxlevel);l.setId(g.id);l.setFloorId(a.floorId);l.setFloorName(a.floorName);l.setAddress(g.address);9==g.icon?l.setVisible(!1):l.setVisible(a.floorId==b);l.performanceLayout();l.onClick=this.onClick;this.nodes.push(l)}}}};a(k.prototype,{visible:{get:function(){return this._visible},set:function(a){if(this._visible!==a){this._visible=a;for(var b=0,c=this.nodes.length;b<c;b++)this.nodes[b].setVisible(a)}}}});
return k});
(function(b){definejs("Core/when",[],function(){function a(a,c,e,f){return b(a).then(c,e,f)}function b(a){var d;a instanceof c||(g(a)?(d=l(),a.then(function(a){d.resolve(a)},function(a){d.reject(a)},function(a){d.progress(a)}),a=d.promise):a=e(a));return a}function c(a){this.then=a}function e(a){return new c(function(c){try{return b(c?c(a):a)}catch(e){return h(e)}})}function h(a){return new c(function(c,e){try{return e?b(e(a)):h(a)}catch(f){return h(f)}})}function l(){function a(b,c,d){return r(b,c,
d)}function e(a){return s(a)}function f(a){return s(h(a))}function g(a){return n(a)}var p,k,q,r,n,s;p=new c(a);p={then:a,resolve:e,reject:f,progress:g,promise:p,resolver:{resolve:e,reject:f,progress:g}};k=[];q=[];r=function(a,b,c){var d,e;d=l();e="function"===typeof c?function(a){try{d.progress(c(a))}catch(b){d.progress(b)}}:function(a){d.progress(a)};k.push(function(c){c.then(a,b).then(d.resolve,d.reject,e)});q.push(e);return d.promise};n=function(a){m(q,a);return a};s=function(a){a=b(a);r=a.then;
s=b;n=x;m(k,a);q=k=z;return a};return p}function g(a){return a&&"function"===typeof a.then}function k(b,c,d,e,f){q(2,arguments);return a(b,function(b){function g(a){s(a)}function h(a){n(a)}var p,m,k,q,r,n,s,t,z,G;z=b.length>>>0;p=Math.max(0,Math.min(c,z));k=[];m=z-p+1;q=[];r=l();if(p)for(t=r.progress,s=function(a){q.push(a);--m||(n=s=x,r.reject(q))},n=function(a){k.push(a);--p||(n=s=x,r.resolve(k))},G=0;G<z;++G)G in b&&a(b[G],h,g,t);else r.resolve(k);return r.then(d,e,f)})}function n(a,b,c,d){q(1,
arguments);return f(a,p).then(b,c,d)}function f(b,c){return a(b,function(b){var d,e,f,g,h,p;f=e=b.length>>>0;d=[];p=l();if(f)for(g=function(b,e){a(b,c).then(function(a){d[e]=a;--f||p.resolve(d)},p.reject)},h=0;h<e;h++)h in b?g(b[h],h):--f;else p.resolve(d);return p.promise})}function m(a,b){for(var c,d=0;c=a[d++];)c(b)}function q(a,b){for(var c,d=b.length;d>a;)if(c=b[--d],null!=c&&"function"!=typeof c)throw Error("arg "+d+" must be a function");}function x(){}function p(a){return a}var s,r,z;a.defer=
l;a.resolve=b;a.reject=function(b){return a(b,h)};a.join=function(){return f(arguments,p)};a.all=n;a.map=f;a.reduce=function(b,c){var d=r.call(arguments,1);return a(b,function(b){var e;e=b.length;d[0]=function(b,d,f){return a(b,function(b){return a(d,function(a){return c(b,a,f,e)})})};return s.apply(b,d)})};a.any=function(a,b,c,d){return k(a,1,function(a){return b?b(a[0]):a[0]},c,d)};a.some=k;a.chain=function(b,c,d){var e=2<arguments.length;return a(b,function(a){a=e?d:a;c.resolve(a);return a},function(a){c.reject(a);
return h(a)},c.progress)};a.isPromise=g;c.prototype={always:function(a,b){return this.then(a,a,b)},otherwise:function(a){return this.then(z,a)},yield:function(a){return this.then(function(){return a})},spread:function(a){return this.then(function(b){return n(b,function(b){return a.apply(z,b)})})}};r=[].slice;s=[].reduce||function(a){var b,c,d,e,f;f=0;b=Object(this);e=b.length>>>0;c=arguments;if(1>=c.length)for(;;){if(f in b){d=b[f++];break}if(++f>=e)throw new TypeError;}else d=c[1];for(;f<e;++f)f in
b&&(d=a(d,b[f],f,b));return d};return a})})("function"==typeof define&&define.amd?define:function(b){"object"===typeof exports?module.exports=b():this.when=b()});
definejs("Scene/UserLayer/VectorDataSource",["Framework/ConfigOptions","Resource/Downloader","Core/when"],function(b,a,d){b=function(a,b){this._texturePool=this.framework=null;this._textures={};this._dataSourceManager=a;this._url=b;this._isDataExist=!0;this._cachedData=null;this._callbackArray=[];this._isLoaddingData=!1};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){this._cachedData=this.framework=null};b.prototype.getData=function(b){function d(a){l._cachedData=
a;l._isLoaddingData=!1;for(var b in l._callbackArray){var c=l._callbackArray[b];c&&c({data:a})}l._callbackArray=[]}function h(a){l.isDataExist=!1;for(var b in l._callbackArray)(a=l._callbackArray[b])&&a(null);l._callbackArray=[]}var l=this;0===l._url.length?(l.isDataExist=!1,b&&b(null)):!1===l.isDataExist?b&&b(null):l._cachedData?b&&b({data:data}):(l._callbackArray.push(b),!0!==l._isLoaddingData&&(l._isLoaddingData=!0,b={_t:(new Date).getTime()},window.downloader?window.downloader.getData(l._url,
"get",b,"json",d,h):a.getData(l._url,b,"json",d,h)))};return b});
definejs("Scene/UserLayer/VectorLayerTessellator","Renderer/RenderQueue Math/MathUtils Math/Matrix4 Math/Ellipsoid Math/Vector3 Framework/AppState".split(" "),function(b,a,d,c,e,h){b={};e.create();e.create();b.getBoundaryBox=function(a,b,c){e.assign(b,9999999,9999999,9999999);e.assign(c,-9999999,-9999999,-9999999);for(var d=0;d<a.length;d++)a[d].getBoundaryBox(b,c)};b.getFloorExtent=function(a,b){for(var c=0;c<a.length;c++)a[c].getFloorExtent(b)};b.tessellate=function(a,b){for(var c=0;c<b.length;c++)b[c].cull(a);
return!0};return b});
definejs("Scene/UserLayer/VectorLayer","Core/defaultValue Math/Extent Math/Vector3 Style/LabelStyle Scene/Vector/VolumePolygon Scene/UserLayer/VectorDataSource Scene/UserLayer/VectorLayerTessellator".split(" "),function(b,a,d,c,e,h,l){function g(a,b,c){b=new h(b,c.url);b.initialize(a);return b}b=function(){this.framework=null;this.nodes=[];this.extent=new a;this.centerPos=d.create();this.visible=!0;this.labelStyle=null;this.styles=[];this.shadowCastTexture=null;this.isGenShadowMap=!0;this.isInited=
!1};b.prototype.initialize=function(a){this.framework=a;for(var b=[22,5,4,6,0,1,3,2,7,8,9,33],d=0,e=b.length;d<e;d++){var g=b[d],h=g%8*64/512,g=64*Math.floor(g/8)/512,l=new c;l.imageUrl="texture/wall_ssao.jpg";l.srcRect=[h,g,h+0.125,g+0.125];l.initialize(a);this.styles.push(l)}};b.prototype.finalize=function(){this.extent=this.framework=null};b.prototype.cull=function(b){if(!b.isCullPoiOnly&&!1!==this.visible&&0!==this.nodes.length){b.shadowCastTexture=this.shadowCastTexture;for(var c=0,e=this.nodes.length;c<
e;c++)this.nodes[c].cull(b);!0===this.isGenShadowMap&&null===this.shadowCastTexture&&(c=b.framework._shadowMapRender,a.makeInvalid(n),l.getFloorExtent(this.nodes,n,10),l.getBoundaryBox(this.nodes,k.minBoundary,k.maxBoundary,10),null===this.shadowCastTexture&&(this.shadowCastTexture=c.createShadowTexture()),this.shadowCastTexture._boundaryBox={minBoundary:d.clone(d.create(),k.minBoundary),maxBoundary:d.clone(d.create(),k.maxBoundary)},b=c.makeShadowCastCullArgs(b,n,k),l.tessellate(b,this.nodes),c.beginScene(this.shadowCastTexture),
c.renderScene(b),c.endScene(),this.framework.forceRedraw())}};var k={minBoundary:d.create(),maxBoundary:d.create()},n=new a;b.prototype.parseColor=function(a){var b=[1,1,1,1];if(void 0===a||6>a.length)return b;for(var c=0;3>c;c++){var d=a.slice(2*c,2*c+2);b[c]=parseInt(d,16)/255}return b};b.prototype.loadData=function(a){var b=this,c=a.split("?name=")[0],d=a.split("?name=")[1];b.framework.getDataSourceManager().createDataSource({key:c,url:c},g).getData(function(a){b.parseJSON(a.data[d])})};b.prototype.parseJSON=
function(b){if(b){b=b.features;a.makeInvalid(this.extent);for(var c in b)for(var d=b[c],d=d.geometry.coordinates[0],g=0;g<d.length;g++)a.mergePoint(this.extent,this.extent,[d[g][0],d[g][1],0]);a.getCenter(this.centerPos,this.extent);for(c in b){d=b[c];g=new e;g.name=d.properties.FT_ID;g.setCenterPos(this.centerPos[0],this.centerPos[1],0);g.type=d.properties.TYPE||"shop";g.addLine(d.geometry.coordinates[0]);g.style=this.styles[11];var h=this.parseColor(d.properties.COLOR),l=this.parseColor(d.properties.OUT_COLOR);
g.color=[h,[1,0,0,0.5]];g.outlineColor=[l,[1,0,0,1]];g._scaleBuilding=Math.cos(this.centerPos[1]/180*Math.PI);g.setExtrudeHeight(parseFloat(d.properties.HEIGHT));g.initialize(this.framework);this.nodes.push(g)}this.isInited=!0}};return b});
definejs("Core/PathDirectory",[],function(){return{joinPath:function(b,a){var d=arguments,c="";0<d.length?c=d[0]||"":"";for(var e=1;e<d.length;e++){var h=d[e];"/"!=c.slice(-1)&&(c+="/");h=h.replace("./","");"/"==h[0]&&(h=h.slice(1));c+=h}return c},getDirPath:function(b){return b.substring(0,b.lastIndexOf("/")+1)}}});
definejs("Scene/ParametricModel/Style/ParametricStyleManager",["Framework/ConfigOptions"],function(b){b=function(){this.framework=null;this.rtti="ParametricStyleManager";this.name="";this.styleMap={}};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){};b.prototype.addStyle=function(a,b){b||console.log("error styleName:",a);this.styleMap[a]=b};b.prototype.getStyle=function(a,b){this.styleMap.hasOwnProperty(a);return this.styleMap[a]};b.prototype.cull=function(a){for(var b in this.styleMap)this.styleMap[b].cull(a)};
b.prototype.commitChange=function(a){for(var b in this.styleMap)this.styleMap[b].commitChange()};return b});
definejs("Scene/ParametricModel/ParametricModelManager",["Framework/ConfigOptions"],function(b){b=function(){this.framework=null;this.rtti="ParametricModelManager";this.name="";this.modelMap={};this.modelArray=[];this._onModelCreated=void 0;this.modelLayer=null};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){};b.prototype.addModel=function(a,b){this.modelMap[a]=b;this.modelArray.push(b);b._modelLayer=this.modelLayer};b.prototype.getModel=function(a,b){return this.modelMap.hasOwnProperty(a)?
this.modelMap[a]:null};b.prototype.cull=function(a){for(var b in this.modelArray)this.modelArray[b].cull(a)};b.prototype.commitChange=function(a){for(var b in this.modelArray)this.modelArray[b].commitChange()};return b});
definejs("Scene/ParametricModel/ParametricPrimitiveManager",["Framework/ConfigOptions"],function(b){b=function(){this.framework=null;this.rtti="ParametricPrimitiveManager";this.name="";this.primitiveMap={};this.primitiveArray=[]};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){};b.prototype.addPrimitive=function(a,b){this.primitiveMap[a]=b;this.primitiveArray.push(b)};b.prototype.getPrimitive=function(a,b){return this.primitiveMap.hasOwnProperty(a)?this.primitiveMap[a]:
null};b.prototype.cull=function(a){for(var b in this.primitiveArray)this.primitiveArray[b].cull(a)};b.prototype.commitChange=function(a){for(var b in this.primitiveArray)this.primitiveArray[b].commitChange()};return b});
definejs("Core/MD5",[],function(){function b(b,g){b[g>>5]|=128<<g%32;b[(g+64>>>9<<4)+14]=g;for(var f=1732584193,h=-271733879,m=-1732584194,k=271733878,q=0;q<b.length;q+=16)var n=f,x=h,F=m,M=k,f=d(f,h,m,k,b[q+0],7,-680876936),k=d(k,f,h,m,b[q+1],12,-389564586),m=d(m,k,f,h,b[q+2],17,606105819),h=d(h,m,k,f,b[q+3],22,-1044525330),f=d(f,h,m,k,b[q+4],7,-176418897),k=d(k,f,h,m,b[q+5],12,1200080426),m=d(m,k,f,h,b[q+6],17,-1473231341),h=d(h,m,k,f,b[q+7],22,-45705983),f=d(f,h,m,k,b[q+8],7,1770035416),k=d(k,
f,h,m,b[q+9],12,-1958414417),m=d(m,k,f,h,b[q+10],17,-42063),h=d(h,m,k,f,b[q+11],22,-1990404162),f=d(f,h,m,k,b[q+12],7,1804603682),k=d(k,f,h,m,b[q+13],12,-40341101),m=d(m,k,f,h,b[q+14],17,-1502002290),h=d(h,m,k,f,b[q+15],22,1236535329),f=c(f,h,m,k,b[q+1],5,-165796510),k=c(k,f,h,m,b[q+6],9,-1069501632),m=c(m,k,f,h,b[q+11],14,643717713),h=c(h,m,k,f,b[q+0],20,-373897302),f=c(f,h,m,k,b[q+5],5,-701558691),k=c(k,f,h,m,b[q+10],9,38016083),m=c(m,k,f,h,b[q+15],14,-660478335),h=c(h,m,k,f,b[q+4],20,-405537848),
f=c(f,h,m,k,b[q+9],5,568446438),k=c(k,f,h,m,b[q+14],9,-1019803690),m=c(m,k,f,h,b[q+3],14,-187363961),h=c(h,m,k,f,b[q+8],20,1163531501),f=c(f,h,m,k,b[q+13],5,-1444681467),k=c(k,f,h,m,b[q+2],9,-51403784),m=c(m,k,f,h,b[q+7],14,1735328473),h=c(h,m,k,f,b[q+12],20,-1926607734),f=a(h^m^k,f,h,b[q+5],4,-378558),k=a(f^h^m,k,f,b[q+8],11,-2022574463),m=a(k^f^h,m,k,b[q+11],16,1839030562),h=a(m^k^f,h,m,b[q+14],23,-35309556),f=a(h^m^k,f,h,b[q+1],4,-1530992060),k=a(f^h^m,k,f,b[q+4],11,1272893353),m=a(k^f^h,m,k,b[q+
7],16,-155497632),h=a(m^k^f,h,m,b[q+10],23,-1094730640),f=a(h^m^k,f,h,b[q+13],4,681279174),k=a(f^h^m,k,f,b[q+0],11,-358537222),m=a(k^f^h,m,k,b[q+3],16,-722521979),h=a(m^k^f,h,m,b[q+6],23,76029189),f=a(h^m^k,f,h,b[q+9],4,-640364487),k=a(f^h^m,k,f,b[q+12],11,-421815835),m=a(k^f^h,m,k,b[q+15],16,530742520),h=a(m^k^f,h,m,b[q+2],23,-995338651),f=e(f,h,m,k,b[q+0],6,-198630844),k=e(k,f,h,m,b[q+7],10,1126891415),m=e(m,k,f,h,b[q+14],15,-1416354905),h=e(h,m,k,f,b[q+5],21,-57434055),f=e(f,h,m,k,b[q+12],6,1700485571),
k=e(k,f,h,m,b[q+3],10,-1894986606),m=e(m,k,f,h,b[q+10],15,-1051523),h=e(h,m,k,f,b[q+1],21,-2054922799),f=e(f,h,m,k,b[q+8],6,1873313359),k=e(k,f,h,m,b[q+15],10,-30611744),m=e(m,k,f,h,b[q+6],15,-1560198380),h=e(h,m,k,f,b[q+13],21,1309151649),f=e(f,h,m,k,b[q+4],6,-145523070),k=e(k,f,h,m,b[q+11],10,-1120210379),m=e(m,k,f,h,b[q+2],15,718787259),h=e(h,m,k,f,b[q+9],21,-343485551),f=l(f,n),h=l(h,x),m=l(m,F),k=l(k,M);return[f,h,m,k]}function a(a,b,c,d,e,f){a=l(l(b,a),l(d,f));return l(a<<e|a>>>32-e,c)}function d(b,
c,d,e,f,g,h){return a(c&d|~c&e,b,c,f,g,h)}function c(b,c,d,e,f,g,h){return a(c&e|d&~e,b,c,f,g,h)}function e(b,c,d,e,f,g,h){return a(d^(c|~e),b,c,f,g,h)}function h(a,c){var d=g(a);16<d.length&&(d=b(d,a.length*x));for(var e=Array(16),f=Array(16),h=0;16>h;h++)e[h]=d[h]^909522486,f[h]=d[h]^1549556828;d=b(e.concat(g(c)),512+c.length*x);return b(f.concat(d),640)}function l(a,b){var c=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(c>>16)<<16|c&65535}function g(a){for(var b=[],c=(1<<x)-1,d=0;d<a.length*x;d+=
x)b[d>>5]|=(a.charCodeAt(d/x)&c)<<d%32;return b}function k(a){for(var b="",c=(1<<x)-1,d=0;d<32*a.length;d+=x)b+=String.fromCharCode(a[d>>5]>>>d%32&c);return b}function n(a){for(var b=m?"0123456789ABCDEF":"0123456789abcdef",c="",d=0;d<4*a.length;d++)c+=b.charAt(a[d>>2]>>d%4*8+4&15)+b.charAt(a[d>>2]>>d%4*8&15);return c}function f(a){for(var b="",c=0;c<4*a.length;c+=3)for(var d=(a[c>>2]>>c%4*8&255)<<16|(a[c+1>>2]>>(c+1)%4*8&255)<<8|a[c+2>>2]>>(c+2)%4*8&255,e=0;4>e;e++)b=8*c+6*e>32*a.length?b+q:b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(d>>
6*(3-e)&63);return b}var m=0,q="",x=8;return{hex_md5:function(a){return n(b(g(a),a.length*x))},b64_md5:function(a){return f(b(g(a),a.length*x))},str_md5:function(a){return k(b(g(a),a.length*x))},hex_hmac_md5:function(a,b){return n(h(a,b))},b64_hmac_md5:function(a,b){return f(h(a,b))},str_hmac_md5:function(a,b){return k(h(a,b))}}});
definejs("Scene/ParametricModel/Style/ParametricTextureStyle",["Framework/ConfigOptions"],function(b){function a(a,d){var h=null;0<d.length&&(h="texture/wall_ssao.jpg"===d?a.getTextureManager().createTextureEx(d,b.textureDataURLMap[d]):"texture/floor_default.png"===d?a.getTextureManager().createTextureEx(d,b.textureDataURLMap[d]):a.getTextureManager().createTextureEx(d,d,1));return h}var d=function(){this.parentLayer=this.framework=null;this.rtti="ParametricTextureStyle";this.imageUrl=this.name="";
this.texture=null;this.scaleV=this.scaleU=-1;this.rotation=this.offsetV=this.offsetU=0};d.prototype.initialize=function(b,d){this.framework=b;this.parentLayer=d;this.texture=a(b,this.imageUrl);this.texture2=a(b,"texture/wall_ssao.jpg")};d.prototype.finalize=function(){};return d});
definejs("Scene/ParametricModel/Style/ParametricColorStyle",["Framework/ConfigOptions"],function(b){function a(a,d){var h=null;0<d.length&&(h="texture/wall_ssao.jpg"===d?a.getTextureManager().createTextureEx(d,b.textureDataURLMap[d]):"texture/floor_default.png"===d?a.getTextureManager().createTextureEx(d,b.textureDataURLMap[d]):a.getTextureManager().createTextureEx(d,d,1));return h}var d=function(){this.parentLayer=this.framework=null;this.rtti="ParametricColorStyle";this.name="";this.color=[1,1,
1,1];this.outColor=[0.2,0.2,0.2,1];this.renderPatchArray=[];this.scaleV=this.scaleU=1;this.rotation=this.offsetV=this.offsetU=0};d.prototype.initialize=function(b,d){this.framework=b;this.parentLayer=d;this.texture=a(b,"texture/wall_ssao.jpg");this.textureFloor=a(b,"texture/floor_default.png")};d.prototype.finalize=function(){};d.prototype.commitChange=function(){};d.prototype.cull=function(a){for(var b=this.renderPatchArray.length,d=0;d<b;d++)this.renderPatchArray[d].cull(a)};return d});
definejs("Core/clone",["./defaultValue"],function(b){function a(d,c){if(null===d||"object"!==typeof d)return d;c=b(c,!1);var e=new d.constructor,h;for(h in d)if(d.hasOwnProperty(h)){var l=d[h];c&&(l=a(l,c));e[h]=l}return e}return a});
definejs("Core/Uri",[],function(){function b(a){a instanceof b?(this.scheme=a.scheme,this.authority=a.authority,this.path=a.path,this.query=a.query,this.fragment=a.fragment):a&&(a=c.exec(a),this.scheme=a[1],this.authority=a[2],this.path=a[3],this.query=a[4],this.fragment=a[5])}function a(a){var b=unescape(a);return h.test(b)?b:a.toUpperCase()}function d(a,b,c,d){return(b||"")+c.toLowerCase()+(d||"")}b.prototype.scheme=null;b.prototype.authority=null;b.prototype.path="";b.prototype.query=null;b.prototype.fragment=
null;var c=/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/;b.prototype.getScheme=function(){return this.scheme};b.prototype.getAuthority=function(){return this.authority};b.prototype.getPath=function(){return this.path};b.prototype.getQuery=function(){return this.query};b.prototype.getFragment=function(){return this.fragment};b.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment};b.prototype.isSameDocumentAs=function(a){return a.scheme==this.scheme&&a.authority==
this.authority&&a.path==this.path&&a.query==this.query};b.prototype.equals=function(a){return this.isSameDocumentAs(a)&&a.fragment==this.fragment};b.prototype.normalize=function(){this.removeDotSegments();this.scheme&&(this.scheme=this.scheme.toLowerCase());this.authority&&(this.authority=this.authority.replace(l,d).replace(e,a));this.path&&(this.path=this.path.replace(e,a));this.query&&(this.query=this.query.replace(e,a));this.fragment&&(this.fragment=this.fragment.replace(e,a))};var e=/%[0-9a-z]{2}/gi,
h=/[a-zA-Z0-9\-\._~]/,l=/(.*@)?([^@:]*)(:.*)?/;b.prototype.resolve=function(a){var c=new b;this.scheme?(c.scheme=this.scheme,c.authority=this.authority,c.path=this.path,c.query=this.query):(c.scheme=a.scheme,this.authority?(c.authority=this.authority,c.path=this.path,c.query=this.query):(c.authority=a.authority,""==this.path?(c.path=a.path,c.query=this.query||a.query):("/"==this.path.charAt(0)?c.path=this.path:c.path=a.authority&&""==a.path?"/"+this.path:a.path.substring(0,a.path.lastIndexOf("/")+
1)+this.path,c.removeDotSegments(),c.query=this.query)));c.fragment=this.fragment;return c};b.prototype.removeDotSegments=function(){var a=this.path.split("/"),b=[],c,d=""==a[0];d&&a.shift();for(""==a[0]&&a.shift();a.length;)c=a.shift(),".."==c?b.pop():"."!=c&&b.push(c);"."!=c&&".."!=c||b.push("");d&&b.unshift("");this.path=b.join("/")};b.prototype.toString=function(){var a="";this.scheme&&(a+=this.scheme+":");this.authority&&(a+="//"+this.authority);a+=this.path;this.query&&(a+="?"+this.query);this.fragment&&
(a+="#"+this.fragment);return a};return b});
definejs("Core/DeveloperError",["./defined"],function(b){function a(a){this.name="DeveloperError";this.message=a;try{throw Error();}catch(b){a=b.stack}this.stack=a}b(Object.create)&&(a.prototype=Object.create(Error.prototype),a.prototype.constructor=a);a.prototype.toString=function(){var a=this.name+": "+this.message;b(this.stack)&&(a+="\n"+this.stack.toString());return a};a.throwInstantiationError=function(){throw new a("This function defines an interface and should not be called directly.");};return a});
definejs("Core/getAbsoluteUri",["./Uri","./defaultValue","./defined","./DeveloperError"],function(b,a,d,c){function e(a,b){var c;"undefined"!==typeof document&&(c=document);return e._implementation(a,b,c)}e._implementation=function(c,e,g){if(!d(e)){if("undefined"===typeof g)return c;e=a(g.baseURI,g.location.href)}e=new b(e);return(new b(c)).resolve(e).toString()};return e});
definejs("Core/createGuid",[],function(){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var a=16*Math.random()|0;return("x"===b?a:a&3|8).toString(16)})}});
definejs("Core/RuntimeError",["./defined"],function(b){function a(a){this.name="RuntimeError";this.message=a;try{throw Error();}catch(b){a=b.stack}this.stack=a}b(Object.create)&&(a.prototype=Object.create(Error.prototype),a.prototype.constructor=a);a.prototype.toString=function(){var a=this.name+": "+this.message;b(this.stack)&&(a+="\n"+this.stack.toString());return a};return a});
definejs("Core/getStringFromTypedArray",["./defaultValue","./defined","./DeveloperError","./RuntimeError"],function(b,a,d,c){function e(a,c,d){c=b(c,0);d=b(d,a.byteLength-c);a=a.subarray(c,c+d);return e.decode(a)}e.decodeWithTextDecoder=function(a){return(new TextDecoder("utf-8")).decode(a)};e.decodeWithFromCharCode=function(a){for(var b="",d=0,e=0,n=0,f=128,m=191,q=[],x=a.length,p=0;p<x;++p){var s=a[p];if(0===n){if(0<=s&&127>=s){q.push(s);continue}if(194<=s&&223>=s){n=1;d=s&31;continue}if(224<=s&&
239>=s){224===s&&(f=160);237===s&&(m=159);n=2;d=s&15;continue}if(240<=s&&244>=s){240===s&&(f=144);244===s&&(m=143);n=3;d=s&7;continue}throw new c("String decoding failed.");}f<=s&&s<=m?(f=128,m=191,d=d<<6|s&63,++e,e===n&&(q.push(d),d=n=e=0)):(d=n=e=0,f=128,m=191,--p)}a=q.length;for(d=0;d<a;++d)e=q[d],65535>=e?b+=String.fromCharCode(e):(e-=65536,b+=String.fromCharCode((e>>10)+55296,(e&1023)+56320));return b};e.decode="undefined"!==typeof TextDecoder?e.decodeWithTextDecoder:e.decodeWithFromCharCode;
return e});definejs("Core/getMagic",["./defaultValue","./getStringFromTypedArray"],function(b,a){return function(d,c){c=b(c,0);return a(d,c,Math.min(4,d.length))}});
definejs("Core/Check",["./defined","./DeveloperError"],function(b,a){function d(a,b,c){return"Expected "+c+" to be typeof "+b+", actual typeof was "+a}var c={typeOf:{},defined:function(c,d){if(!b(d))throw new a(c+" is required, actual value was undefined");}};c.typeOf.func=function(b,c){if("function"!==typeof c)throw new a(d(typeof c,"function",b));};c.typeOf.string=function(b,c){if("string"!==typeof c)throw new a(d(typeof c,"string",b));};c.typeOf.number=function(b,c){if("number"!==typeof c)throw new a(d(typeof c,
"number",b));};c.typeOf.number.lessThan=function(b,d,l){c.typeOf.number(b,d);if(d>=l)throw new a("Expected "+b+" to be less than "+l+", actual value was "+d);};c.typeOf.number.lessThanOrEquals=function(b,d,l){c.typeOf.number(b,d);if(d>l)throw new a("Expected "+b+" to be less than or equal to "+l+", actual value was "+d);};c.typeOf.number.greaterThan=function(b,d,l){c.typeOf.number(b,d);if(d<=l)throw new a("Expected "+b+" to be greater than "+l+", actual value was "+d);};c.typeOf.number.greaterThanOrEquals=
function(b,d,l){c.typeOf.number(b,d);if(d<l)throw new a("Expected "+b+" to be greater than or equal to"+l+", actual value was "+d);};c.typeOf.object=function(b,c){if("object"!==typeof c)throw new a(d(typeof c,"object",b));};c.typeOf.bool=function(b,c){if("boolean"!==typeof c)throw new a(d(typeof c,"boolean",b));};c.typeOf.number.equals=function(b,d,l,g){c.typeOf.number(b,l);c.typeOf.number(d,g);if(l!==g)throw new a(b+" must be equal to "+d+", the actual values are "+l+" and "+g);};return c});
definejs("Core/Fullscreen",["./defined","./defineProperties"],function(b,a){var d,c={requestFullscreen:void 0,exitFullscreen:void 0,fullscreenEnabled:void 0,fullscreenElement:void 0,fullscreenchange:void 0,fullscreenerror:void 0},e={};a(e,{element:{get:function(){return e.supportsFullscreen()?document[c.fullscreenElement]:void 0}},changeEventName:{get:function(){return e.supportsFullscreen()?c.fullscreenchange:void 0}},errorEventName:{get:function(){return e.supportsFullscreen()?c.fullscreenerror:
void 0}},enabled:{get:function(){return e.supportsFullscreen()?document[c.fullscreenEnabled]:void 0}},fullscreen:{get:function(){return e.supportsFullscreen()?null!==e.element:void 0}}});e.supportsFullscreen=function(){if(b(d))return d;d=!1;var a=document.body;if("function"===typeof a.requestFullscreen)return c.requestFullscreen="requestFullscreen",c.exitFullscreen="exitFullscreen",c.fullscreenEnabled="fullscreenEnabled",c.fullscreenElement="fullscreenElement",c.fullscreenchange="fullscreenchange",
c.fullscreenerror="fullscreenerror",d=!0;for(var e=["webkit","moz","o","ms","khtml"],g,k=0,n=e.length;k<n;++k){var f=e[k];g=f+"RequestFullscreen";"function"===typeof a[g]?(c.requestFullscreen=g,d=!0):(g=f+"RequestFullScreen","function"===typeof a[g]&&(c.requestFullscreen=g,d=!0));g=f+"ExitFullscreen";"function"===typeof document[g]?c.exitFullscreen=g:(g=f+"CancelFullScreen","function"===typeof document[g]&&(c.exitFullscreen=g));g=f+"FullscreenEnabled";void 0!==document[g]?c.fullscreenEnabled=g:(g=
f+"FullScreenEnabled",void 0!==document[g]&&(c.fullscreenEnabled=g));g=f+"FullscreenElement";void 0!==document[g]?c.fullscreenElement=g:(g=f+"FullScreenElement",void 0!==document[g]&&(c.fullscreenElement=g));g=f+"fullscreenchange";void 0!==document["on"+g]&&("ms"===f&&(g="MSFullscreenChange"),c.fullscreenchange=g);g=f+"fullscreenerror";void 0!==document["on"+g]&&("ms"===f&&(g="MSFullscreenError"),c.fullscreenerror=g)}return d};e.requestFullscreen=function(a,b){if(e.supportsFullscreen())a[c.requestFullscreen]({vrDisplay:b})};
e.exitFullscreen=function(){if(e.supportsFullscreen())document[c.exitFullscreen]()};e._names=c;return e});
definejs("Core/FeatureDetection","./defaultValue ./defined ./defineProperties ./DeveloperError ./Fullscreen ./when".split(" "),function(b,a,d,c,e,h){function l(a){a=a.split(".");for(var b=0,c=a.length;b<c;++b)a[b]=parseInt(a[b],10);return a}function g(){if(!a(r)&&(r=!1,!m())){var b=/ Chrome\/([\.0-9]+)/.exec(s.userAgent);null!==b&&(r=!0,z=l(b[1]))}return r}function k(){if(!a(t)&&(t=!1,!g()&&!m()&&/ Safari\/[\.0-9]+/.test(s.userAgent))){var b=/ Version\/([\.0-9]+)/.exec(s.userAgent);null!==b&&(t=!0,
w=l(b[1]))}return t}function n(){if(!a(u)){u=!1;var b=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(s.userAgent);null!==b&&(u=!0,v=l(b[1]),v.isNightly=!!b[2])}return u}function f(){if(!a(A)){A=!1;var b;"Microsoft Internet Explorer"===s.appName?(b=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(s.userAgent),null!==b&&(A=!0,F=l(b[1]))):"Netscape"===s.appName&&(b=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(s.userAgent),null!==b&&(A=!0,F=l(b[1])))}return A}function m(){if(!a(M)){M=!1;var b=/ Edge\/([\.0-9]+)/.exec(s.userAgent);
null!==b&&(M=!0,C=l(b[1]))}return M}function q(){if(!a(J)){J=!1;var b=/Firefox\/([\.0-9]+)/.exec(s.userAgent);null!==b&&(J=!0,O=l(b[1]))}return J}function x(){if(!a(B)){var b=document.createElement("canvas");b.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");b=b.style.imageRendering;(B=a(b)&&""!==b)&&(P=b)}return B}function p(){return p._result}var s;s="undefined"!==typeof navigator?navigator:{};var r,z,t,w,u,v,A,F,M,C,J,O,E,H,P,B;p._promise=void 0;p._result=void 0;
p.initialize=function(){if(a(p._promise))return p._promise;var b=h.defer();p._promise=b.promise;if(m())return p._result=!1,b.resolve(p._result),b.promise;var c=new Image;c.onload=function(){p._result=0<c.width&&0<c.height;b.resolve(p._result)};c.onerror=function(){p._result=!1;b.resolve(p._result)};c.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA";return b.promise};d(p,{initialized:{get:function(){return a(p._result)}}});d=[];"undefined"!==typeof ArrayBuffer&&
(d.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!==typeof Uint8ClampedArray&&d.push(Uint8ClampedArray),"undefined"!==typeof CanvasPixelArray&&d.push(CanvasPixelArray));var I={isChrome:g,chromeVersion:function(){return g()&&z},isSafari:k,safariVersion:function(){return k()&&w},isWebkit:n,webkitVersion:function(){return n()&&v},isInternetExplorer:f,internetExplorerVersion:function(){return f()&&F},isEdge:m,edgeVersion:function(){return m()&&
C},isFirefox:q,firefoxVersion:function(){return q()&&O},isWindows:function(){a(E)||(E=/Windows/i.test(s.appVersion));return E},hardwareConcurrency:b(s.hardwareConcurrency,3),supportsPointerEvents:function(){a(H)||(H=!q()&&"undefined"!==typeof PointerEvent&&(!a(s.pointerEnabled)||s.pointerEnabled));return H},supportsImageRenderingPixelated:x,supportsWebP:p,imageRenderingValue:function(){return x()?P:void 0},typedArrayTypes:d,supportsFullscreen:function(){return e.supportsFullscreen()},supportsTypedArrays:function(){return"undefined"!==
typeof ArrayBuffer},supportsWebWorkers:function(){return"undefined"!==typeof Worker},supportsWebAssembly:function(){return"undefined"!==typeof WebAssembly&&!I.isEdge()}};return I});definejs("Core/appendForwardSlash",[],function(){return function(b){if(0===b.length||"/"!==b[b.length-1])b+="/";return b}});
definejs("Core/combine",["./defaultValue","./defined"],function(b,a){function d(c,e,h){h=b(h,!1);var l={},g=a(c),k=a(e),n,f;if(g)for(n in c)c.hasOwnProperty(n)&&(g=c[n],k&&h&&"object"===typeof g&&e.hasOwnProperty(n)?(f=e[n],l[n]="object"===typeof f?d(g,f,h):g):l[n]=g);if(k)for(n in e)e.hasOwnProperty(n)&&!l.hasOwnProperty(n)&&(f=e[n],l[n]=f);return l}return d});definejs("Core/freezeObject",["./defined"],function(b){var a=Object.freeze;b(a)||(a=function(a){return a});return a});
definejs("Core/getBaseUri",["./Uri","./defined","./DeveloperError"],function(b,a,d){return function(c,d){var h="",l=c.lastIndexOf("/");-1!==l&&(h=c.substring(0,l+1));if(!d)return h;c=new b(c);a(c.query)&&(h+="?"+c.query);a(c.fragment)&&(h+="#"+c.fragment);return h}});
definejs("Core/getExtensionFromUri",["./Uri","./defined","./DeveloperError"],function(b,a,d){return function(a){a=new b(a);a.normalize();a=a.path;var d=a.lastIndexOf("/");-1!==d&&(a=a.substr(d+1));d=a.lastIndexOf(".");return a=-1===d?"":a.substr(d+1)}});definejs("Core/isBlobUri",["./Check"],function(b){var a=/^blob:/i;return function(b){return a.test(b)}});
definejs("Core/isCrossOriginUrl",["./defined"],function(b){var a;return function(d){b(a)||(a=document.createElement("a"));a.href=window.location.href;var c=a.host,e=a.protocol;a.href=d;a.href=a.href;return e!==a.protocol||c!==a.host}});definejs("Core/isDataUri",["./Check"],function(b){var a=/^data:/i;return function(b){return a.test(b)}});
definejs("Core/loadAndExecuteScript",["./when"],function(b){return function(a){var d=b.defer(),c=document.createElement("script");c.async=!0;c.src=a;var e=document.getElementsByTagName("head")[0];c.onload=function(){c.onload=void 0;e.removeChild(c);d.resolve()};c.onerror=function(a){d.reject(a)};e.appendChild(c);return d.promise}});definejs("Core/isArray",["./defined"],function(b){var a=Array.isArray;b(a)||(a=function(a){return"[object Array]"===Object.prototype.toString.call(a)});return a});
definejs("Core/objectToQuery",["./defined","./DeveloperError","./isArray"],function(b,a,d){return function(a){var b="",h;for(h in a)if(a.hasOwnProperty(h)){var l=a[h],g=encodeURIComponent(h)+"=";if(d(l))for(var k=0,n=l.length;k<n;++k)b+=g+encodeURIComponent(l[k])+"&";else b+=g+encodeURIComponent(l)+"&"}return b=b.slice(0,-1)}});
definejs("Core/queryToObject",["./defined","./DeveloperError","./isArray"],function(b,a,d){return function(a){var e={};if(""===a)return e;a=a.replace(/\+/g,"%20").split(/[&;]/);for(var h=0,l=a.length;h<l;++h){var g=a[h].split("="),k=decodeURIComponent(g[0]),g=g[1],g=b(g)?decodeURIComponent(g):"",n=e[k];"string"===typeof n?e[k]=[n,g]:d(n)?n.push(g):e[k]=g}return e}});definejs("Core/RequestState",["../Core/freezeObject"],function(b){return b({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5})});
definejs("Core/RequestType",["./freezeObject"],function(b){return b({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3})});
definejs("Core/Request",["./defaultValue","./defined","./RequestState","./RequestType"],function(b,a,d,c){function e(a){a=b(a,b.EMPTY_OBJECT);var e=b(a.throttleByServer,!1),g=b(a.throttle,!1);this.url=a.url;this.requestFunction=a.requestFunction;this.cancelFunction=a.cancelFunction;this.priorityFunction=a.priorityFunction;this.priority=b(a.priority,0);this.throttle=g;this.throttleByServer=e;this.type=b(a.type,c.OTHER);this.serverKey=void 0;this.state=d.UNISSUED;this.deferred=void 0;this.cancelled=
!1}e.prototype.cancel=function(){this.cancelled=!0};e.prototype.clone=function(b){if(!a(b))return new e(this);b.url=this.url;b.requestFunction=this.requestFunction;b.cancelFunction=this.cancelFunction;b.priorityFunction=this.priorityFunction;b.priority=this.priority;b.throttle=this.throttle;b.throttleByServer=this.throttleByServer;b.type=this.type;b.serverKey=this.serverKey;b.state=this.RequestState.UNISSUED;b.deferred=void 0;b.cancelled=!1;return b};return e});
definejs("Core/parseResponseHeaders",[],function(){return function(b){var a={};if(!b)return a;b=b.split("\r\n");for(var d=0;d<b.length;++d){var c=b[d],e=c.indexOf(": ");if(0<e){var h=c.substring(0,e),c=c.substring(e+2);a[h]=c}}return a}});
definejs("Core/RequestErrorEvent",["./defined","./parseResponseHeaders"],function(b,a){function d(b,d,h){this.statusCode=b;this.response=d;this.responseHeaders=h;"string"===typeof this.responseHeaders&&(this.responseHeaders=a(this.responseHeaders))}d.prototype.toString=function(){var a="Request has failed.";b(this.statusCode)&&(a+=" Status Code: "+this.statusCode);return a};return d});
definejs("Core/Event",["./Check","./defined","./defineProperties"],function(b,a,d){function c(){this._listeners=[];this._scopes=[];this._toRemove=[];this._insideRaiseEvent=!1}function e(a,b){return b-a}d(c.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}});c.prototype.addEventListener=function(a,b){this._listeners.push(a);this._scopes.push(b);var c=this;return function(){c.removeEventListener(a,b)}};c.prototype.removeEventListener=function(a,b){for(var c=
this._listeners,d=this._scopes,e=-1,f=0;f<c.length;f++)if(c[f]===a&&d[f]===b){e=f;break}return-1!==e?(this._insideRaiseEvent?(this._toRemove.push(e),c[e]=void 0,d[e]=void 0):(c.splice(e,1),d.splice(e,1)),!0):!1};c.prototype.raiseEvent=function(){this._insideRaiseEvent=!0;var b,c=this._listeners,d=this._scopes,k=c.length;for(b=0;b<k;b++)a(c[b])&&c[b].apply(d[b],arguments);var n=this._toRemove,k=n.length;if(0<k){n.sort(e);for(b=0;b<k;b++){var f=n[b];c.splice(f,1);d.splice(f,1)}n.length=0}this._insideRaiseEvent=
!1};return c});
definejs("Core/Heap",["./Check","./defaultValue","./defined","./defineProperties"],function(b,a,d,c){function e(a){this._comparator=a.comparator;this._array=[];this._length=0;this._maximumLength=void 0}function h(a,b,c){var d=a[b];a[b]=a[c];a[c]=d}c(e.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(a){this._maximumLength=a;this._length>a&&0<a&&(this._length=a,this._array.length=
a)}},comparator:{get:function(){return this._comparator}}});e.prototype.reserve=function(b){b=a(b,this._length);this._array.length=b};e.prototype.heapify=function(b){b=a(b,0);for(var c=this._length,d=this._comparator,e=this._array,f=-1,m=!0;m;){var q=2*(b+1),f=q-1,f=f<c&&0>d(e[f],e[b])?f:b;q<c&&0>d(e[q],e[f])&&(f=q);f!==b?(h(e,f,b),b=f):m=!1}};e.prototype.resort=function(){for(var a=Math.ceil(this._length/2);0<=a;--a)this.heapify(a)};e.prototype.insert=function(a){var b=this._array,c=this._comparator,
e=this._maximumLength,f=this._length++;for(f<b.length?b[f]=a:b.push(a);0!==f;)if(a=Math.floor((f-1)/2),0>c(b[f],b[a]))h(b,f,a),f=a;else break;var m;d(e)&&this._length>e&&(m=b[e],this._length=e);return m};e.prototype.pop=function(b){b=a(b,0);if(0!==this._length){var c=this._array,d=c[b];h(c,b,--this._length);this.heapify(b);return d}};return e});
definejs("Core/RequestScheduler","./Uri ./when ./Check ./defaultValue ./defined ./defineProperties ./Event ./Heap ./isBlobUri ./isDataUri ./RequestState".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){function m(){}function q(a){var b=c(m.requestsByServer[a],m.maximumRequestsPerServer);return A[a]<b}function x(b){b.state===f.UNISSUED&&(b.state=f.ISSUED,b.deferred=a.defer());return b.deferred.promise}function p(a){return function(b){a.state!==f.CANCELLED&&(--t.numberOfActiveRequests,--A[a.serverKey],M.raiseEvent(),
a.state=f.RECEIVED,a.deferred.resolve(b))}}function s(a){return function(b){a.state!==f.CANCELLED&&(++t.numberOfFailedRequests,--t.numberOfActiveRequests,--A[a.serverKey],M.raiseEvent(b),a.state=f.FAILED,a.deferred.reject(b))}}function r(a){var b=x(a);a.state=f.ACTIVE;v.push(a);++t.numberOfActiveRequests;++t.numberOfActiveRequestsEver;++A[a.serverKey];a.requestFunction().then(p(a)).otherwise(s(a));return b}function z(a){var b=a.state===f.ACTIVE;a.state=f.CANCELLED;++t.numberOfCancelledRequests;a.deferred.reject();
b&&(--t.numberOfActiveRequests,--A[a.serverKey],++t.numberOfCancelledActiveRequests);e(a.cancelFunction)&&a.cancelFunction()}var t={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0},w=20,u=new g({comparator:function(a,b){return a.priority-b.priority}});u.maximumLength=w;u.reserve(w);var v=[],A={},F="undefined"!==typeof document?new b(document.location.href):
new b,M=new l;m.maximumRequests=50;m.maximumRequestsPerServer=6;m.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18};m.throttleRequests=!0;m.debugShowStatistics=!1;m.requestCompletedEvent=M;h(m,{statistics:{get:function(){return t}},priorityHeapLength:{get:function(){return w},set:function(a){if(a<w)for(;u.length>a;){var b=u.pop();z(b)}w=a;u.maximumLength=a;u.reserve(a)}}});m.update=function(){var a,b,c=0,d=v.length;for(a=0;a<d;++a)b=v[a],b.cancelled&&z(b),b.state!==f.ACTIVE?++c:
0<c&&(v[a-c]=b);v.length-=c;b=u.internalArray;c=u.length;for(a=0;a<c;++a)d=b[a],e(d.priorityFunction)&&(d.priority=d.priorityFunction());u.resort();a=Math.max(m.maximumRequests-v.length,0);for(c=0;c<a&&0<u.length;)b=u.pop(),b.cancelled?z(b):b.throttleByServer&&!q(b.serverKey)?z(b):(r(b),++c);m.debugShowStatistics&&(0===t.numberOfActiveRequests&&0<t.lastNumberOfActiveRequests&&(0<t.numberOfAttemptedRequests&&(console.log("Number of attempted requests: "+t.numberOfAttemptedRequests),t.numberOfAttemptedRequests=
0),0<t.numberOfCancelledRequests&&(console.log("Number of cancelled requests: "+t.numberOfCancelledRequests),t.numberOfCancelledRequests=0),0<t.numberOfCancelledActiveRequests&&(console.log("Number of cancelled active requests: "+t.numberOfCancelledActiveRequests),t.numberOfCancelledActiveRequests=0),0<t.numberOfFailedRequests&&(console.log("Number of failed requests: "+t.numberOfFailedRequests),t.numberOfFailedRequests=0)),t.lastNumberOfActiveRequests=t.numberOfActiveRequests)};m.getServerKey=function(a){a=
(new b(a)).resolve(F);a.normalize();var c=a.authority;/:/.test(c)||(c=c+":"+("https"===a.scheme?"443":"80"));e(A[c])||(A[c]=0);return c};m.request=function(a){if(n(a.url)||k(a.url))return M.raiseEvent(),a.state=f.RECEIVED,a.requestFunction();++t.numberOfAttemptedRequests;e(a.serverKey)||(a.serverKey=m.getServerKey(a.url));if(!a.throttleByServer||q(a.serverKey)){if(!m.throttleRequests||!a.throttle)return r(a);if(!(v.length>=m.maximumRequests)){e(a.priorityFunction)&&(a.priority=a.priorityFunction());
var b=u.insert(a);if(e(b)){if(b===a)return;z(b)}return x(a)}}};m.clearForSpecs=function(){for(;0<u.length;){var a=u.pop();z(a)}for(var a=v.length,b=0;b<a;++b)z(v[b]);v.length=0;A={};t.numberOfAttemptedRequests=0;t.numberOfActiveRequests=0;t.numberOfCancelledRequests=0;t.numberOfCancelledActiveRequests=0;t.numberOfFailedRequests=0;t.numberOfActiveRequestsEver=0;t.lastNumberOfActiveRequests=0};m.numberOfActiveRequestsByServer=function(a){return A[a]};m.requestHeap=u;return m});
definejs("Core/TrustedServers",["./Uri","./defined","./DeveloperError"],function(b,a,d){d={};var c={};d.add=function(b,d){var l=b.toLowerCase()+":"+d;a(c[l])||(c[l]=!0)};d.remove=function(b,d){var l=b.toLowerCase()+":"+d;a(c[l])&&delete c[l]};d.contains=function(d){a:{var h=new b(d);h.normalize();d=h.getAuthority();if(a(d)){if(-1!==d.indexOf("@")&&(d=d.split("@")[1]),-1===d.indexOf(":"))if(h=h.getScheme(),a(h)||(h=window.location.protocol,h=h.substring(0,h.length-1)),"http"===h)d+=":80";else if("https"===
h)d+=":443";else{d=void 0;break a}}else d=void 0}return a(d)&&a(c[d])?!0:!1};d.clear=function(){c={}};return d});
definejs("Resource/Resource","Core/Uri Core/when Core/appendForwardSlash Core/Check Core/clone Core/combine Core/defaultValue Core/defined Core/defineProperties Core/DeveloperError Core/freezeObject Core/getAbsoluteUri Core/getBaseUri Core/getExtensionFromUri Core/isBlobUri Core/isCrossOriginUrl Core/isDataUri Core/loadAndExecuteScript Core/objectToQuery Core/queryToObject Core/Request Core/RequestErrorEvent Core/RequestScheduler Core/RequestState Core/RuntimeError Core/TrustedServers".split(" "),function(b,
a,d,c,e,h,l,g,k,n,f,m,q,x,p,s,r,z,t,w,u,v,A,F,M,C){function J(a,b,c,d){var e=a.query;if(!g(e)||0===e.length)return{};if(-1===e.indexOf("=")){var f={};f[e]=void 0;e=f}else e=w(e);b._queryParameters=c?P(e,b._queryParameters,d):e;a.query=void 0}function O(a,b){var c=b._queryParameters,d=Object.keys(c);1!==d.length||g(c[d[0]])?a.query=t(c):a.query=d[0]}function E(a,b){return g(a)?g(a.clone)?a.clone():e(a):b}function H(a){if(a.state===F.ISSUED||a.state===F.ACTIVE)throw new M("The Resource is already being fetched.");
a.state=F.UNISSUED;a.deferred=void 0}function P(a,b,c){if(!c)return h(a,b);a=e(a,!0);for(var d in b)if(b.hasOwnProperty(d)){c=a[d];var f=b[d];g(c)?(Array.isArray(c)||(c=a[d]=[c]),a[d]=c.concat(f)):a[d]=Array.isArray(f)?f.slice():f}return a}function B(a){a=l(a,l.EMPTY_OBJECT);"string"===typeof a&&(a={url:a});this._url=void 0;this._templateValues=E(a.templateValues,{});this._queryParameters=E(a.queryParameters,{});this.headers=E(a.headers,{});this.request=l(a.request,new u);this.proxy=a.proxy;this.retryCallback=
a.retryCallback;this.retryAttempts=l(a.retryAttempts,0);this._retryCount=0;a=new b(a.url);J(a,this,!0,!0);a.fragment=void 0;this._url=a.toString()}function I(b){var c=b.resource,d=b.flipY,e=b.preferImageBitmap,f=c.request;f.url=c.url;f.requestFunction=function(){var b=c.url,f=!1;c.isDataUri||c.isBlobUri||(f=c.isCrossOriginUrl);var g=a.defer();B._Implementations.createImage(b,f,g,d,e);return g.promise};b=A.request(f);if(g(b))return b.otherwise(function(b){return f.state!==F.FAILED?a.reject(b):c.retryOnError(b).then(function(g){return g?
(f.state=F.UNISSUED,f.deferred=void 0,I({resource:c,flipY:d,preferImageBitmap:e})):a.reject(b)})})}function y(b,c,d){var e={};e[c]=d;b.setQueryParameters(e);var f=b.request;f.url=b.url;f.requestFunction=function(){var c=a.defer();window[d]=function(a){c.resolve(a);try{delete window[d]}catch(b){window[d]=void 0}};B._Implementations.loadAndExecuteScript(b.url,d,c);return c.promise};e=A.request(f);if(g(e))return e.otherwise(function(e){return f.state!==F.FAILED?a.reject(e):b.retryOnError(e).then(function(g){return g?
(f.state=F.UNISSUED,f.deferred=void 0,y(b,c,d)):a.reject(e)})})}function K(a,b){var c=decodeURIComponent(b);return a?atob(c):c}function G(a,b){for(var c=K(a,b),d=new ArrayBuffer(c.length),e=new Uint8Array(d),f=0;f<c.length;f++)e[f]=c.charCodeAt(f);return d}function L(a,b){b=l(b,"");var c=a[1],d=!!a[2],e=a[3];switch(b){case "":case "text":return K(d,e);case "arraybuffer":return G(d,e);case "blob":return d=G(d,e),new Blob([d],{type:c});case "document":return(new DOMParser).parseFromString(K(d,e),c);
case "json":return JSON.parse(K(d,e))}}function N(a,b,c){var d=new Image;d.onload=function(){c.resolve(d)};d.onerror=function(a){c.reject(a)};b&&(C.contains(a)?d.crossOrigin="use-credentials":d.crossOrigin="");d.src=a}function D(a,b){switch(b){case "text":return a.toString("utf8");case "json":return JSON.parse(a.toString("utf8"));default:return(new Uint8Array(a)).buffer}}function Q(a,b,c,d,e,f,g){a=noderequirejs("url").parse(a);d="https:"===a.protocol?noderequirejs("https"):noderequirejs("http");
var h=noderequirejs("zlib");d.request({protocol:a.protocol,hostname:a.hostname,port:a.port,path:a.path,query:a.query,method:c,headers:e}).on("response",function(a){if(200>a.statusCode||300<=a.statusCode)f.reject(new v(a.statusCode,a,a.headers));else{var c=[];a.on("data",function(a){c.push(a)});a.on("end",function(){var d=Buffer.concat(c);"gzip"===a.headers["content-encoding"]?h.gunzip(d,function(a,c){a?f.reject(new M("Error decompressing response.")):f.resolve(D(c,b))}):f.resolve(D(d,b))})}}).on("error",
function(a){f.reject(new v)}).end()}var X=function(){try{var a=new XMLHttpRequest;a.open("GET","#",!0);a.responseType="blob";return"blob"===a.responseType}catch(b){return!1}}();B.createIfNeeded=function(a){return a instanceof B?a.getDerivedResource({request:a.request}):"string"!==typeof a?a:new B({url:a})};var $;B.supportsImageBitmapOptions=function(){return g($)?$:"function"!==typeof createImageBitmap?$=a.resolve(!1):$=B.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg=="}).then(function(a){return createImageBitmap(a,
{imageOrientation:"flipY",premultiplyAlpha:"none"})}).then(function(a){return!0}).otherwise(function(){return!1})};k(B,{isBlobSupported:{get:function(){return X}}});k(B.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(a){a=new b(a);J(a,this,!1);a.fragment=void 0;this._url=a.toString()}},extension:{get:function(){return x(this._url)}},isDataUri:{get:function(){return r(this._url)}},
isBlobUri:{get:function(){return p(this._url)}},isCrossOriginUrl:{get:function(){return s(this._url)}},hasHeaders:{get:function(){return 0<Object.keys(this.headers).length}}});B.prototype.getUrlComponent=function(a,c){if(this.isDataUri)return this._url;var d=new b(this._url);a&&O(d,this);var d=d.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),e=this._templateValues,d=d.replace(/{(.*?)}/g,function(a,b){var c=e[b];return g(c)?encodeURIComponent(c):a});c&&g(this.proxy)&&(d=this.proxy.getURL(d));return d};
B.prototype.setQueryParameters=function(a,b){this._queryParameters=b?P(this._queryParameters,a,!1):P(a,this._queryParameters,!1)};B.prototype.appendQueryParameters=function(a){this._queryParameters=P(a,this._queryParameters,!0)};B.prototype.setTemplateValues=function(a,b){this._templateValues=b?h(this._templateValues,a):h(a,this._templateValues)};B.prototype.getDerivedResource=function(a){var c=this.clone();c._retryCount=0;if(g(a.url)){var d=new b(a.url),e=l(a.preserveQueryParameters,!1);J(d,c,!0,
e);d.fragment=void 0;c._url=d.resolve(new b(m(this._url))).toString()}g(a.queryParameters)&&(c._queryParameters=h(a.queryParameters,c._queryParameters));g(a.templateValues)&&(c._templateValues=h(a.templateValues,c.templateValues));g(a.headers)&&(c.headers=h(a.headers,c.headers));g(a.proxy)&&(c.proxy=a.proxy);g(a.request)&&(c.request=a.request);g(a.retryCallback)&&(c.retryCallback=a.retryCallback);g(a.retryAttempts)&&(c.retryAttempts=a.retryAttempts);return c};B.prototype.retryOnError=function(b){var c=
this.retryCallback;if("function"!==typeof c||this._retryCount>=this.retryAttempts)return a(!1);var d=this;return a(c(this,b)).then(function(a){++d._retryCount;return a})};B.prototype.clone=function(a){g(a)||(a=new B({url:this._url}));a._url=this._url;a._queryParameters=e(this._queryParameters);a._templateValues=e(this._templateValues);a.headers=e(this.headers);a.proxy=this.proxy;a.retryCallback=this.retryCallback;a.retryAttempts=this.retryAttempts;a._retryCount=0;a.request=this.request.clone();return a};
B.prototype.getBaseUri=function(a){return q(this.getUrlComponent(a),a)};B.prototype.appendForwardSlash=function(){this._url=d(this._url)};B.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})};B.fetchArrayBuffer=function(a){return(new B(a)).fetchArrayBuffer()};B.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})};B.fetchBlob=function(a){return(new B(a)).fetchBlob()};B.prototype.fetchImage=function(b){b=l(b,l.EMPTY_OBJECT);var c=l(b.preferImageBitmap,
!1),d=l(b.preferBlob,!1),e=l(b.flipY,!1);H(this.request);if(!X||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!d)return I({resource:this,flipY:e,preferImageBitmap:c});var f=this.fetchBlob();if(g(f)){var h,m,k,p;return B.supportsImageBitmapOptions().then(function(a){m=(h=a)&&c;return f}).then(function(a){if(g(a)){p=a;if(m)return B.createImageBitmapFromBlob(a,{flipY:e,premultiplyAlpha:!1});a=window.URL.createObjectURL(a);k=new B({url:a});return I({resource:k,flipY:e,preferImageBitmap:!1})}}).then(function(a){if(g(a)){a.blob=
p;if(m)return a;!0!==window.GEOWORLD_INSPECT_WEBGL&&window.URL.revokeObjectURL(k.url);return a}}).otherwise(function(b){g(k)&&window.URL.revokeObjectURL(k.url);b.blob=p;return a.reject(b)})}};B.fetchImage=function(a){return(new B(a)).fetchImage({flipY:a.flipY,preferBlob:a.preferBlob,preferImageBitmap:a.preferImageBitmap})};B.prototype.fetchText=function(){return this.fetch({responseType:"text"})};B.fetchText=function(a){return(new B(a)).fetchText()};B.prototype.fetchJson=function(){var a=this.fetch({responseType:"text",
headers:{Accept:"application/json,*/*;q=0.01"}});return g(a)?a.then(function(a){if(g(a))return JSON.parse(a)}):void 0};B.fetchJson=function(a){return(new B(a)).fetchJson()};B.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})};B.fetchXML=function(a){return(new B(a)).fetchXML()};B.prototype.fetchJsonp=function(a){a=l(a,"callback");H(this.request);var b;do b="loadJsonp"+Math.random().toString().substring(2,8);while(g(window[b]));return y(this,a,b)};
B.fetchJsonp=function(a){return(new B(a)).fetchJsonp(a.callbackParameterName)};B.prototype._makeRequest=function(b){var c=this;H(c.request);var d=c.request;d.url=c.url;d.requestFunction=function(){var e=b.responseType,f=h(b.headers,c.headers),m=b.overrideMimeType,k=b.method,p=b.data,l=a.defer(),q=B._Implementations.loadWithXhr(c.url,e,k,p,f,l,m);g(q)&&g(q.abort)&&(d.cancelFunction=function(){q.abort()});return l.promise};var e=A.request(d);if(g(e))return e.then(function(a){return a}).otherwise(function(e){return d.state!==
F.FAILED?a.reject(e):c.retryOnError(e).then(function(f){return f?(d.state=F.UNISSUED,d.deferred=void 0,c.fetch(b)):a.reject(e)})})};var ga=/^data:(.*?)(;base64)?,(.*)$/;B.prototype.fetch=function(a){a=E(a,{});a.method="GET";return this._makeRequest(a)};B.fetch=function(a){return(new B(a)).fetch({responseType:a.responseType,overrideMimeType:a.overrideMimeType})};B.prototype.delete=function(a){a=E(a,{});a.method="DELETE";return this._makeRequest(a)};B.delete=function(a){return(new B(a)).delete({responseType:a.responseType,
overrideMimeType:a.overrideMimeType,data:a.data})};B.prototype.head=function(a){a=E(a,{});a.method="HEAD";return this._makeRequest(a)};B.head=function(a){return(new B(a)).head({responseType:a.responseType,overrideMimeType:a.overrideMimeType})};B.prototype.options=function(a){a=E(a,{});a.method="OPTIONS";return this._makeRequest(a)};B.options=function(a){return(new B(a)).options({responseType:a.responseType,overrideMimeType:a.overrideMimeType})};B.prototype.post=function(a,b){c.defined("data",a);b=
E(b,{});b.method="POST";b.data=a;return this._makeRequest(b)};B.post=function(a){return(new B(a)).post(a.data,{responseType:a.responseType,overrideMimeType:a.overrideMimeType})};B.prototype.put=function(a,b){c.defined("data",a);b=E(b,{});b.method="PUT";b.data=a;return this._makeRequest(b)};B.put=function(a){return(new B(a)).put(a.data,{responseType:a.responseType,overrideMimeType:a.overrideMimeType})};B.prototype.patch=function(a,b){c.defined("data",a);b=E(b,{});b.method="PATCH";b.data=a;return this._makeRequest(b)};
B.patch=function(a){return(new B(a)).patch(a.data,{responseType:a.responseType,overrideMimeType:a.overrideMimeType})};B._Implementations={};B._Implementations.createImage=function(a,b,c,d,e){B.supportsImageBitmapOptions().then(function(f){if(f&&e)return B.fetchBlob({url:a}).then(function(b){if(g(b))return B.createImageBitmapFromBlob(b,{flipY:d,premultiplyAlpha:!1});c.reject(new M("Successfully retrieved "+a+" but it contained no content."))}).then(c.resolve);N(a,b,c)}).otherwise(c.reject)};B.createImageBitmapFromBlob=
function(a,b){c.defined("options",b);c.typeOf.bool("options.flipY",b.flipY);c.typeOf.bool("options.premultiplyAlpha",b.premultiplyAlpha);return createImageBitmap(a,{imageOrientation:b.flipY?"flipY":"none",premultiplyAlpha:b.premultiplyAlpha?"premultiply":"none"})};var V="undefined"===typeof XMLHttpRequest;B._Implementations.loadWithXhr=function(a,b,c,d,e,f,h){var m=ga.exec(a);if(null!==m)f.resolve(L(m,b));else if(V)Q(a,b,c,d,e,f,h);else{var k=new XMLHttpRequest;C.contains(a)&&(k.withCredentials=!0);
k.open(c,a,!0);g(h)&&g(k.overrideMimeType)&&k.overrideMimeType(h);if(g(e))for(var p in e)e.hasOwnProperty(p)&&k.setRequestHeader(p,e[p]);g(b)&&(k.responseType=b);var l=!1;"string"===typeof a&&(l=0===a.indexOf("file://")||"undefined"!==typeof window&&"file://"===window.location.origin);k.onload=function(){if(!(200>k.status||300<=k.status)||l&&0===k.status){var a=k.response,d=k.responseType;if("HEAD"===c||"OPTIONS"===c){var e={};k.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(function(a){a=
a.split(": ");var b=a.shift();e[b]=a.join(": ")});f.resolve(e)}else if(204===k.status)f.resolve();else if(!g(a)||g(b)&&d!==b)if("json"===b&&"string"===typeof a)try{f.resolve(JSON.parse(a))}catch(h){f.reject(h)}else(""===d||"document"===d)&&g(k.responseXML)&&k.responseXML.hasChildNodes()?f.resolve(k.responseXML):""!==d&&"text"!==d||!g(k.responseText)?f.reject(new M("Invalid XMLHttpRequest response type.")):f.resolve(k.responseText);else f.resolve(a)}else f.reject(new v(k.status,k.response,k.getAllResponseHeaders()))};
k.onerror=function(a){f.reject(new v)};k.send(d);return k}};B._Implementations.loadAndExecuteScript=function(a,b,c){return z(a,b).otherwise(c.reject)};B._DefaultImplementations={};B._DefaultImplementations.createImage=B._Implementations.createImage;B._DefaultImplementations.loadWithXhr=B._Implementations.loadWithXhr;B._DefaultImplementations.loadAndExecuteScript=B._Implementations.loadAndExecuteScript;B.DEFAULT=f(new B({url:"undefined"===typeof document?"":document.location.href.split("?")[0]}));
return B});
definejs("Core/loadImageFromTypedArray","./when ./Check ./defined ./defaultValue ./FeatureDetection Resource/Resource".split(" "),function(b,a,d,c,e,h){return function(a){var e=a.uint8Array,k=a.format,n=a.request,f=c(a.flipY,!1),m=new Blob([e],{type:k}),q;return h.supportsImageBitmapOptions().then(function(a){if(a)return b(h.createImageBitmapFromBlob(m,{flipY:f,premultiplyAlpha:!1}));q=window.URL.createObjectURL(m);return(new h({url:q,request:n})).fetchImage({flipY:f})}).then(function(a){d(q)&&window.URL.revokeObjectURL(q);
return a}).otherwise(function(a){d(q)&&window.URL.revokeObjectURL(q);return b.reject(a)})}});
definejs("Core/WebGLConstants",["./freezeObject"],function(b){return b({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,
FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,
FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,
STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,
SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,
ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,
ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,
TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,
TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34E3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,
BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,
HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,
FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,
INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,
HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33E3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,
TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,
DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,
FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,
TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,
RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,
UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,
UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,
COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,
COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,
UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,
OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,
TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047})});
definejs("Core/GeoworldMath",["./Check","./defaultValue","./defined","./DeveloperError"],function(b,a,d,c){return{isPowerOfTwo:function(a){return 0!==a&&0===(a&a-1)},nextPowerOfTwo:function(a){--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;++a;return a},SIXTY_FOUR_KILOBYTES:65536}});
definejs("Core/IndexDatatype",["./defined","./DeveloperError","./freezeObject","./WebGLConstants"],function(b,a,d,c){var e={UNSIGNED_BYTE:c.UNSIGNED_BYTE,UNSIGNED_SHORT:c.UNSIGNED_SHORT,UNSIGNED_INT:c.UNSIGNED_INT,getSizeInBytes:function(a){switch(a){case e.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case e.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case e.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}},fromSizeInBytes:function(a){switch(a){case 2:return e.UNSIGNED_SHORT;case 4:return e.UNSIGNED_INT;
case 1:return e.UNSIGNED_BYTE}},validate:function(a){return b(a)&&(a===e.UNSIGNED_BYTE||a===e.UNSIGNED_SHORT||a===e.UNSIGNED_INT)},createTypedArray:function(a,b){return 65536<=a?new Uint32Array(b):new Uint16Array(b)},createTypedArrayFromArrayBuffer:function(a,b,c,d){return 65536<=a?new Uint32Array(b,c,d):new Uint16Array(b,c,d)}};return d(e)});
definejs("Core/PrimitiveType",["./freezeObject","./WebGLConstants"],function(b,a){var d={POINTS:a.POINTS,LINES:a.LINES,LINE_LOOP:a.LINE_LOOP,LINE_STRIP:a.LINE_STRIP,TRIANGLES:a.TRIANGLES,TRIANGLE_STRIP:a.TRIANGLE_STRIP,TRIANGLE_FAN:a.TRIANGLE_FAN,validate:function(a){return a===d.POINTS||a===d.LINES||a===d.LINE_LOOP||a===d.LINE_STRIP||a===d.TRIANGLES||a===d.TRIANGLE_STRIP||a===d.TRIANGLE_FAN}};return b(d)});
definejs("Core/addToArray",["./defaultValue"],function(b){return function(a,d,c){if(c=b(c,!1))if(c=a.indexOf(d),-1<c)return c;a.push(d);return a.length-1}});definejs("ThirdParty/GltfPipeline/hasExtension",["../../Core/defined"],function(b){return function(a,d){return b(a.extensionsUsed)&&0<=a.extensionsUsed.indexOf(d)}});
definejs("ThirdParty/GltfPipeline/ForEach",["./hasExtension","../../Core/defined","../../Core/isArray"],function(b,a,d){function c(){}c.objectLegacy=function(b,c){if(a(b))for(var d in b)if(b.hasOwnProperty(d)){var g=c(b[d],d);if(a(g))return g}};c.object=function(b,c){if(a(b))for(var d=b.length,g=0;g<d;g++){var k=c(b[g],g);if(a(k))return k}};c.topLevel=function(b,h,l){b=b[h];return a(b)&&!d(b)?c.objectLegacy(b,l):c.object(b,l)};c.accessor=function(a,b){return c.topLevel(a,"accessors",b)};c.accessorWithSemantic=
function(b,d,l){var g={};return c.mesh(b,function(b){return c.meshPrimitive(b,function(b){var e=c.meshPrimitiveAttribute(b,function(b,c){if(0===c.indexOf(d)&&!a(g[b])&&(g[b]=!0,e=l(b),a(e)))return e});return a(e)?e:c.meshPrimitiveTarget(b,function(b){return c.meshPrimitiveTargetAttribute(b,function(b,c){if(0===c.indexOf(d)&&!a(g[b])&&(g[b]=!0,e=l(b),a(e)))return e})})})})};c.accessorContainingVertexAttributeData=function(b,d){var l={};return c.mesh(b,function(b){return c.meshPrimitive(b,function(b){var e=
c.meshPrimitiveAttribute(b,function(b){if(!a(l[b])&&(l[b]=!0,e=d(b),a(e)))return e});return a(e)?e:c.meshPrimitiveTarget(b,function(b){return c.meshPrimitiveTargetAttribute(b,function(b){if(!a(l[b])&&(l[b]=!0,e=d(b),a(e)))return e})})})})};c.accessorContainingIndexData=function(b,d){var l={};return c.mesh(b,function(b){return c.meshPrimitive(b,function(b){b=b.indices;if(a(b)&&!a(l[b])&&(l[b]=!0,b=d(b),a(b)))return b})})};c.animation=function(a,b){return c.topLevel(a,"animations",b)};c.animationChannel=
function(a,b){return c.object(a.channels,b)};c.animationSampler=function(a,b){return c.object(a.samplers,b)};c.buffer=function(a,b){return c.topLevel(a,"buffers",b)};c.bufferView=function(a,b){return c.topLevel(a,"bufferViews",b)};c.camera=function(a,b){return c.topLevel(a,"cameras",b)};c.image=function(a,b){return c.topLevel(a,"images",b)};c.compressedImage=function(b,c){if(a(b.extras)){var d=b.extras.compressedImage3DTiles,g;for(g in d)if(d.hasOwnProperty(g)){var k=c(d[g],g);if(a(k))return k}}};
c.material=function(a,b){return c.topLevel(a,"materials",b)};c.materialValue=function(b,c){var d=b.values;a(b.extensions)&&a(b.extensions.KHR_techniques_webgl)&&(d=b.extensions.KHR_techniques_webgl.values);for(var g in d)if(d.hasOwnProperty(g)){var k=c(d[g],g);if(a(k))return k}};c.mesh=function(a,b){return c.topLevel(a,"meshes",b)};c.meshPrimitive=function(b,c){var d=b.primitives;if(a(d))for(var g=d.length,k=0;k<g;k++){var n=c(d[k],k);if(a(n))return n}};c.meshPrimitiveAttribute=function(b,c){var d=
b.attributes,g;for(g in d)if(d.hasOwnProperty(g)){var k=c(d[g],g);if(a(k))return k}};c.meshPrimitiveTarget=function(b,c){var d=b.targets;if(a(d))for(var g=d.length,k=0;k<g;++k){var n=c(d[k],k);if(a(n))return n}};c.meshPrimitiveTargetAttribute=function(b,c){for(var d in b)if(b.hasOwnProperty(d)){var g=c(b[d],d);if(a(g))return g}};c.node=function(a,b){return c.topLevel(a,"nodes",b)};c.nodeInTree=function(b,d,l){var g=b.nodes;if(a(g))for(var k=d.length,n=0;n<k;n++){var f=d[n],m=g[f];if(a(m)){f=l(m,f);
if(a(f))return f;m=m.children;if(a(m)&&(f=c.nodeInTree(b,m,l),a(f)))return f}}};c.nodeInScene=function(b,d,l){d=d.nodes;if(a(d))return c.nodeInTree(b,d,l)};c.program=function(a,d){return b(a,"KHR_techniques_webgl")?c.object(a.extensions.KHR_techniques_webgl.programs,d):c.topLevel(a,"programs",d)};c.sampler=function(a,b){return c.topLevel(a,"samplers",b)};c.scene=function(a,b){return c.topLevel(a,"scenes",b)};c.shader=function(a,d){return b(a,"KHR_techniques_webgl")?c.object(a.extensions.KHR_techniques_webgl.shaders,
d):c.topLevel(a,"shaders",d)};c.skin=function(a,b){return c.topLevel(a,"skins",b)};c.techniqueAttribute=function(b,c){var d=b.attributes,g;for(g in d)if(d.hasOwnProperty(g)){var k=c(d[g],g);if(a(k))return k}};c.techniqueUniform=function(b,c){var d=b.uniforms,g;for(g in d)if(d.hasOwnProperty(g)){var k=c(d[g],g);if(a(k))return k}};c.techniqueParameter=function(b,c){var d=b.parameters,g;for(g in d)if(d.hasOwnProperty(g)){var k=c(d[g],g);if(a(k))return k}};c.technique=function(a,d){return b(a,"KHR_techniques_webgl")?
c.object(a.extensions.KHR_techniques_webgl.techniques,d):c.topLevel(a,"techniques",d)};c.texture=function(a,b){return c.topLevel(a,"textures",b)};return c});definejs("Core/numberOfComponentsForType",[],function(){return function(b){switch(b){case "SCALAR":return 1;case "VEC2":return 2;case "VEC3":return 3;case "VEC4":case "MAT2":return 4;case "MAT3":return 9;case "MAT4":return 16}}});
definejs("Core/ComponentDatatype",["./defaultValue","./defined","./DeveloperError","./freezeObject","./WebGLConstants"],function(b,a,d,c,e){var h={BYTE:e.BYTE,UNSIGNED_BYTE:e.UNSIGNED_BYTE,SHORT:e.SHORT,UNSIGNED_SHORT:e.UNSIGNED_SHORT,INT:e.INT,UNSIGNED_INT:e.UNSIGNED_INT,FLOAT:e.FLOAT,DOUBLE:e.DOUBLE,getSizeInBytes:function(a){switch(a){case h.BYTE:return Int8Array.BYTES_PER_ELEMENT;case h.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case h.SHORT:return Int16Array.BYTES_PER_ELEMENT;case h.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;
case h.INT:return Int32Array.BYTES_PER_ELEMENT;case h.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case h.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case h.DOUBLE:return Float64Array.BYTES_PER_ELEMENT}},fromTypedArray:function(a){if(a instanceof Int8Array)return h.BYTE;if(a instanceof Uint8Array)return h.UNSIGNED_BYTE;if(a instanceof Int16Array)return h.SHORT;if(a instanceof Uint16Array)return h.UNSIGNED_SHORT;if(a instanceof Int32Array)return h.INT;if(a instanceof Uint32Array)return h.UNSIGNED_INT;
if(a instanceof Float32Array)return h.FLOAT;if(a instanceof Float64Array)return h.DOUBLE},validate:function(b){return a(b)&&(b===h.BYTE||b===h.UNSIGNED_BYTE||b===h.SHORT||b===h.UNSIGNED_SHORT||b===h.INT||b===h.UNSIGNED_INT||b===h.FLOAT||b===h.DOUBLE)},createTypedArray:function(a,b){switch(a){case h.BYTE:return new Int8Array(b);case h.UNSIGNED_BYTE:return new Uint8Array(b);case h.SHORT:return new Int16Array(b);case h.UNSIGNED_SHORT:return new Uint16Array(b);case h.INT:return new Int32Array(b);case h.UNSIGNED_INT:return new Uint32Array(b);
case h.FLOAT:return new Float32Array(b);case h.DOUBLE:return new Float64Array(b)}},createArrayBufferView:function(a,c,d,e){d=b(d,0);e=b(e,(c.byteLength-d)/h.getSizeInBytes(a));switch(a){case h.BYTE:return new Int8Array(c,d,e);case h.UNSIGNED_BYTE:return new Uint8Array(c,d,e);case h.SHORT:return new Int16Array(c,d,e);case h.UNSIGNED_SHORT:return new Uint16Array(c,d,e);case h.INT:return new Int32Array(c,d,e);case h.UNSIGNED_INT:return new Uint32Array(c,d,e);case h.FLOAT:return new Float32Array(c,d,
e);case h.DOUBLE:return new Float64Array(c,d,e)}},fromName:function(a){switch(a){case "BYTE":return h.BYTE;case "UNSIGNED_BYTE":return h.UNSIGNED_BYTE;case "SHORT":return h.SHORT;case "UNSIGNED_SHORT":return h.UNSIGNED_SHORT;case "INT":return h.INT;case "UNSIGNED_INT":return h.UNSIGNED_INT;case "FLOAT":return h.FLOAT;case "DOUBLE":return h.DOUBLE}}};return c(h)});
definejs("Core/getAccessorByteStride",["./numberOfComponentsForType","./ComponentDatatype","./defined"],function(b,a,d){return function(c,e){var h=e.bufferView;return d(h)&&(h=c.bufferViews[h],d(h.byteStride)&&0<h.byteStride)?h.byteStride:a.getSizeInBytes(e.componentType)*b(e.type)}});
definejs("Core/addDefaults","./addToArray ThirdParty/GltfPipeline/ForEach ./getAccessorByteStride ./defaultValue ./defined ./WebGLConstants".split(" "),function(b,a,d,c,e,h){function l(b){var c={};a.animation(b,function(b){a.animationChannel(b,function(a){var b=a.target;a=b.node;b=b.path;if("translation"===b||"rotation"===b||"scale"===b)c[a]=!0})});return c}function g(a){e(a)&&(a.texCoord=c(a.texCoord,0))}return function(k){a.accessor(k,function(a){e(a.bufferView)&&(a.byteOffset=c(a.byteOffset,0))});
a.bufferView(k,function(a){e(a.buffer)&&(a.byteOffset=c(a.byteOffset,0))});a.mesh(k,function(d){a.meshPrimitive(d,function(a){a.mode=c(a.mode,h.TRIANGLES);e(a.material)||(e(k.materials)||(k.materials=[]),a.material=b(k.materials,{name:"default"}))})});a.accessorContainingVertexAttributeData(k,function(a){a=k.accessors[a];var b=a.bufferView;a.normalized=c(a.normalized,!1);e(b)&&(b=k.bufferViews[b],b.byteStride=d(k,a),b.target=h.ARRAY_BUFFER)});a.accessorContainingIndexData(k,function(a){a=k.accessors[a].bufferView;
e(a)&&(k.bufferViews[a].target=h.ELEMENT_ARRAY_BUFFER)});a.material(k,function(b){var d=c(b.extensions,c.EMPTY_OBJECT),h=d.KHR_materials_common;e(h)?(d=h.technique,b=e(h.values)?h.values:{},h.values=b,b.ambient=e(b.ambient)?b.ambient:[0,0,0,1],b.emission=e(b.emission)?b.emission:[0,0,0,1],b.transparency=c(b.transparency,1),b.transparent=c(b.transparent,!1),b.doubleSided=c(b.doubleSided,!1),"CONSTANT"!==d&&(b.diffuse=e(b.diffuse)?b.diffuse:[0,0,0,1],"LAMBERT"!==d&&(b.specular=e(b.specular)?b.specular:
[0,0,0,1],b.shininess=c(b.shininess,0)))):(b.emissiveFactor=c(b.emissiveFactor,[0,0,0]),b.alphaMode=c(b.alphaMode,"OPAQUE"),b.doubleSided=c(b.doubleSided,!1),"MASK"===b.alphaMode&&(b.alphaCutoff=c(b.alphaCutoff,0.5)),e(d.KHR_techniques_webgl)&&a.materialValue(b,function(a){e(a.index)&&g(a)}),g(b.emissiveTexture),g(b.normalTexture),g(b.occlusionTexture),h=b.pbrMetallicRoughness,e(h)&&(h.baseColorFactor=c(h.baseColorFactor,[1,1,1,1]),h.metallicFactor=c(h.metallicFactor,1),h.roughnessFactor=c(h.roughnessFactor,
1),g(h.baseColorTexture),g(h.metallicRoughnessTexture)),h=d.pbrSpecularGlossiness,e(h)&&(h.diffuseFactor=c(h.diffuseFactor,[1,1,1,1]),h.specularFactor=c(h.specularFactor,[1,1,1]),h.glossinessFactor=c(h.glossinessFactor,1),g(h.specularGlossinessTexture)))});a.animation(k,function(b){a.animationSampler(b,function(a){a.interpolation=c(a.interpolation,"LINEAR")})});var n=l(k);a.node(k,function(a,b){e(n[b])||e(a.translation)||e(a.rotation)||e(a.scale)?(a.translation=c(a.translation,[0,0,0]),a.rotation=
c(a.rotation,[0,0,0,1]),a.scale=c(a.scale,[1,1,1])):a.matrix=c(a.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])});a.sampler(k,function(a){a.wrapS=c(a.wrapS,h.REPEAT);a.wrapT=c(a.wrapT,h.REPEAT)});e(k.scenes)&&!e(k.scene)&&(k.scene=0);return k}});
definejs("Resource/ModelUtility",["Core/defined","../ThirdParty/GltfPipeline/ForEach"],function(b,a){var d={ModelState:{NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},getFailedLoadFunction:function(a,e,h){return function(l){a._state=d.ModelState.FAILED;var g="Failed to load "+e+": "+h;b(l)&&(g+="\n"+l.message);a._readyPromise.reject(new RuntimeError(g))}},parseBuffers:function(c,e){var h=c._loadResources;a.buffer(c.gltf,function(a,g){if(b(a.extras)&&b(a.extras._pipeline.source))h.buffers[g]=a.extras._pipeline.source;
else if(b(e)){var k=c._resource.getDerivedResource({url:a.uri});++h.pendingBufferLoads;k.fetchArrayBuffer().then(e(c,g)).otherwise(d.getFailedLoadFunction(c,"buffer",k.url))}})}};return d});
definejs("Resource/MeshPatch",["Math/Extent","Math/Matrix4","Framework/AppState"],function(b,a,d){var c=function(){d.patch_count++;this.extent=new b;this.center=[0,0,0];this.tileCenter=[0,0,0];this.minBoundary=[0,0,0];this.maxBoundary=[0,0,0];this.faceNumber=this.vertexNumber=this.textureIndex=0;this.texture2=this.texture=this.normalBuffer=this.indexBuffer=this.diffuseBuffer=this.textureCoordBuffer2=this.textureCoordBuffer=this.positionBuffer=this.indices=this.normalCoords=this.diffuseCoords=this.textureCoords=
this.positionCoords=null;this.subNodeName=this.textureName="";this.renderCommand=null;this.dataType=0;this.modelMatrix=a.create();this.mvMatrix=a.create()};c.prototype.upload=function(){null===this._renderCommand&&(!0==this._bufferPool.is32BitIndex?this.createRenderCommandWith32BitIndex(this._building):this.createRenderCommand(this._building))};c.prototype.isReady=function(){return null!==this._renderCommand};return c});
definejs("Resource/ModelMesh",["../Core/defineProperties","Resource/Mesh","Resource/MeshPatch","Resource/ResourceState","ThirdParty/GltfPipeline/ForEach"],function(b,a,d,c,e){function h(a,b,c){for(var d=[],e=a.primitives,h=e.length,q=0;q<h;++q)d[q]=b[e[q].material];this._name=a.name;this._id=c;this._materials=d}b(h.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}});return h});
definejs("Core/Queue",["./defineProperties"],function(b){function a(){this._array=[];this._length=this._offset=0}b(a.prototype,{length:{get:function(){return this._length}}});a.prototype.enqueue=function(a){this._array.push(a);this._length++};a.prototype.dequeue=function(){if(0!==this._length){var a=this._array,b=this._offset,e=a[b];a[b]=void 0;b++;10<b&&2*b>a.length&&(this._array=a.slice(b),b=0);this._offset=b;this._length--;return e}};a.prototype.peek=function(){return 0===this._length?void 0:this._array[this._offset]};
a.prototype.contains=function(a){return-1!==this._array.indexOf(a)};a.prototype.clear=function(){this._array.length=this._offset=this._length=0};a.prototype.sort=function(a){0<this._offset&&(this._array=this._array.slice(this._offset),this._offset=0);this._array.sort(a)};return a});
definejs("Resource/ModelLoadResources",["Core/Queue"],function(b){function a(){this.resourcesParsed=this.initialized=!1;this.vertexBuffersToCreate=new b;this.indexBuffersToCreate=new b;this.buffers={};this.pendingBufferLoads=0;this.programsToCreate=new b;this.shaders={};this.pendingShaderLoads=0;this.texturesToCreate=new b;this.pendingTextureLoads=0;this.texturesToCreateFromBufferView=new b;this.pendingBufferViewToImage=0;this.createRuntimeNodes=this.createUniformMaps=this.createRenderStates=this.createVertexArrays=
this.createRuntimeAnimations=this.createSkins=this.createSamplers=!0;this.createdBufferViews={};this.primitivesToDecode=new b;this.activeDecodingTasks=0;this.pendingDecodingCache=!1;this.skinnedNodesIds=[]}a.prototype.getBuffer=function(a){return this.buffers[a.buffer].subarray(a.byteOffset,a.byteOffset+a.byteLength)};a.prototype.finishedPendingBufferLoads=function(){return 0===this.pendingBufferLoads};a.prototype.finishedBuffersCreation=function(){return 0===this.pendingBufferLoads&&0===this.vertexBuffersToCreate.length&&
0===this.indexBuffersToCreate.length};a.prototype.finishedProgramCreation=function(){return 0===this.pendingShaderLoads&&0===this.programsToCreate.length};a.prototype.finishedTextureCreation=function(){var a=0===this.texturesToCreate.length&&0===this.texturesToCreateFromBufferView.length;return 0===this.pendingTextureLoads&&a};a.prototype.finishedEverythingButTextureCreation=function(){var a=0===this.pendingBufferLoads&&0===this.pendingShaderLoads,b=0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length&&
0===this.programsToCreate.length&&0===this.pendingBufferViewToImage;return this.finishedDecoding()&&a&&b};a.prototype.finishedDecoding=function(){return 0===this.primitivesToDecode.length&&0===this.activeDecodingTasks&&!this.pendingDecodingCache};a.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()};return a});
definejs("Core/destroyObject",["./defaultValue","./DeveloperError"],function(b,a){function d(){return!0}return function(a,e){function h(){}e=b(e,"This object was destroyed, i.e., destroy() was called.");for(var l in a)"function"===typeof a[l]&&(a[l]=h);a.isDestroyed=d}});
definejs("Renderer/BufferUsage",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var d={STREAM_DRAW:a.STREAM_DRAW,STATIC_DRAW:a.STATIC_DRAW,DYNAMIC_DRAW:a.DYNAMIC_DRAW,validate:function(a){return a===d.STREAM_DRAW||a===d.STATIC_DRAW||a===d.DYNAMIC_DRAW}};return b(d)});
definejs("Renderer/Buffer","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/IndexDatatype ../Core/WebGLConstants ./BufferUsage".split(" "),function(b,a,d,c,e,h,l,g,k){function n(b){b=a(b,a.EMPTY_OBJECT);var c=b.context._gl,e=b.bufferTarget,g=b.typedArray,h=b.sizeInBytes,k=b.usage,l=d(g);l&&(h=g.byteLength);var n=c.createBuffer();c.bindBuffer(e,n);c.bufferData(e,l?g:h,k);c.bindBuffer(e,null);this._gl=c;this._webgl2=b.context._webgl2;
this._bufferTarget=e;this._sizeInBytes=h;this._usage=k;this._buffer=n;this.vertexArrayDestroyable=!0}n.createVertexBuffer=function(a){return new n({context:a.context,bufferTarget:g.ARRAY_BUFFER,typedArray:a.typedArray,sizeInBytes:a.sizeInBytes,usage:a.usage})};n.createIndexBuffer=function(a){var b=a.context,d=a.indexDatatype,e=l.getSizeInBytes(d);a=new n({context:b,bufferTarget:g.ELEMENT_ARRAY_BUFFER,typedArray:a.typedArray,sizeInBytes:a.sizeInBytes,usage:a.usage});var h=a.sizeInBytes/e;c(a,{indexDatatype:{get:function(){return d}},
bytesPerIndex:{get:function(){return e}},numberOfIndices:{get:function(){return h}}});return a};c(n.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});n.prototype._getBuffer=function(){return this._buffer};n.prototype.copyFromArrayView=function(b,c){c=a(c,0);var d=this._gl,e=this._bufferTarget;d.bindBuffer(e,this._buffer);d.bufferSubData(e,c,b);d.bindBuffer(e,null)};n.prototype.copyFromBuffer=function(a,b,c,d){var e=g.COPY_READ_BUFFER,h=
g.COPY_WRITE_BUFFER,k=this._gl;k.bindBuffer(h,this._buffer);k.bindBuffer(e,a._buffer);k.copyBufferSubData(e,h,b,c,d);k.bindBuffer(h,null);k.bindBuffer(e,null)};n.prototype.getBufferData=function(b,c,d,e){c=a(c,0);d=a(d,0);var h=this._gl,k=g.COPY_READ_BUFFER;h.bindBuffer(k,this._buffer);h.getBufferSubData(k,c,b,d,e);h.bindBuffer(k,null)};n.prototype.isDestroyed=function(){return!1};n.prototype.destroy=function(){this._gl.deleteBuffer(this._buffer);return e(this)};return n});
definejs("Renderer/VertexArray","../Core/Check ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/IndexDatatype ../Core/RuntimeError ./Buffer ./BufferUsage ./ContextLimits".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m){function q(b,e,f,g){var h=c(e.vertexBuffer),m=c(e.value),k=e.value?e.value.length:e.componentsPerAttribute;e={index:d(e.index,f),enabled:d(e.enabled,!0),vertexBuffer:e.vertexBuffer,value:m?e.value.slice(0):
void 0,componentsPerAttribute:k,componentDatatype:d(e.componentDatatype,a.FLOAT),normalize:d(e.normalize,!1),offsetInBytes:d(e.offsetInBytes,0),strideInBytes:d(e.strideInBytes,0),instanceDivisor:d(e.instanceDivisor,0)};if(h)e.vertexAttrib=function(a){var b=this.index;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer._getBuffer());a.vertexAttribPointer(b,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes);a.enableVertexAttribArray(b);0<this.instanceDivisor&&
(g.glVertexAttribDivisor(b,this.instanceDivisor),g._vertexAttribDivisors[b]=this.instanceDivisor,g._previousDrawInstanced=!0)},e.disableVertexAttribArray=function(a){a.disableVertexAttribArray(this.index);0<this.instanceDivisor&&g.glVertexAttribDivisor(f,0)};else{switch(e.componentsPerAttribute){case 1:e.vertexAttrib=function(a){a.vertexAttrib1fv(this.index,this.value)};break;case 2:e.vertexAttrib=function(a){a.vertexAttrib2fv(this.index,this.value)};break;case 3:e.vertexAttrib=function(a){a.vertexAttrib3fv(this.index,
this.value)};break;case 4:e.vertexAttrib=function(a){a.vertexAttrib4fv(this.index,this.value)}}e.disableVertexAttribArray=function(a){}}b.push(e)}function x(a,b,d){for(var e=0;e<b.length;++e){var f=b[e];f.enabled&&f.vertexAttrib(a)}c(d)&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,d._getBuffer())}function p(b){b=d(b,d.EMPTY_OBJECT);var e=b.context,f=e._gl,g=b.attributes;b=b.indexBuffer;var h,m=[],k=1,p=!1,l=!1,n=g.length;for(h=0;h<n;++h)q(m,g[h],h,e);n=m.length;for(h=0;h<n;++h)if(g=m[h],c(g.vertexBuffer)&&
0===g.instanceDivisor){h=g.strideInBytes||g.componentsPerAttribute*a.getSizeInBytes(g.componentDatatype);k=g.vertexBuffer.sizeInBytes/h;break}for(h=0;h<n;++h)0<m[h].instanceDivisor&&(p=!0),c(m[h].value)&&(l=!0);var C;e.vertexArrayObject&&(C=e.glCreateVertexArray(),e.glBindVertexArray(C),x(f,m,b),e.glBindVertexArray(null));this._numberOfVertices=k;this._hasInstancedAttributes=p;this._hasConstantAttributes=l;this._context=e;this._gl=f;this._vao=C;this._attributes=m;this._indexBuffer=b}e(p.prototype,
{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}});p.prototype.getAttribute=function(a){return this._attributes[a]};p.prototype._bind=function(){if(c(this._vao)){this._context.glBindVertexArray(this._vao);if(this._context.instancedArrays){var a=this._context,b=this._hasInstancedAttributes;if(b||a._previousDrawInstanced){a._previousDrawInstanced=b;var d=a._vertexAttribDivisors,
e=this._attributes,f=m.maximumVertexAttributes;if(b)for(f=e.length,b=0;b<f;++b){var g=e[b];if(g.enabled){var h=g.instanceDivisor,g=g.index;h!==d[g]&&(a.glVertexAttribDivisor(g,h),d[g]=h)}}else for(b=0;b<f;++b)0<d[b]&&(a.glVertexAttribDivisor(b,0),d[b]=0)}}if(this._hasConstantAttributes)for(a=this._gl,d=this._attributes,e=d.length,b=0;b<e;++b)f=d[b],f.enabled&&c(f.value)&&f.vertexAttrib(a)}else x(this._gl,this._attributes,this._indexBuffer)};p.prototype._unBind=function(){if(c(this._vao))this._context.glBindVertexArray(null);
else{for(var a=this._attributes,b=this._gl,d=0;d<a.length;++d){var e=a[d];e.enabled&&e.disableVertexAttribArray(b)}this._indexBuffer&&b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,null)}};p.prototype.isDestroyed=function(){return!1};p.prototype.destroy=function(){for(var a=this._attributes,b=0;b<a.length;++b){var d=a[b].vertexBuffer;c(d)&&!d.isDestroyed()&&d.vertexArrayDestroyable&&d.destroy()}a=this._indexBuffer;c(a)&&!a.isDestroyed()&&a.vertexArrayDestroyable&&a.destroy();c(this._vao)&&this._context.glDeleteVertexArray(this._vao);
return h(this)};return p});definejs("Renderer/TextureMagnificationFilter",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var d={NEAREST:a.NEAREST,LINEAR:a.LINEAR,validate:function(a){return a===d.NEAREST||a===d.LINEAR}};return b(d)});
definejs("Renderer/TextureMinificationFilter",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var d={NEAREST:a.NEAREST,LINEAR:a.LINEAR,NEAREST_MIPMAP_NEAREST:a.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:a.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:a.LINEAR_MIPMAP_LINEAR,validate:function(a){return a===d.NEAREST||a===d.LINEAR||a===d.NEAREST_MIPMAP_NEAREST||a===d.LINEAR_MIPMAP_NEAREST||a===d.NEAREST_MIPMAP_LINEAR||a===d.LINEAR_MIPMAP_LINEAR}};
return b(d)});definejs("Renderer/TextureWrap",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var d={CLAMP_TO_EDGE:a.CLAMP_TO_EDGE,REPEAT:a.REPEAT,MIRRORED_REPEAT:a.MIRRORED_REPEAT,validate:function(a){return a===d.CLAMP_TO_EDGE||a===d.REPEAT||a===d.MIRRORED_REPEAT}};return b(d)});
definejs("Renderer/Sampler","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ./TextureMagnificationFilter ./TextureMinificationFilter ./TextureWrap".split(" "),function(b,a,d,c,e,h,l,g){function k(b){b=a(b,a.EMPTY_OBJECT);var c=a(b.wrapS,g.CLAMP_TO_EDGE),e=a(b.wrapT,g.CLAMP_TO_EDGE),k=a(b.minificationFilter,l.LINEAR),x=a(b.magnificationFilter,h.LINEAR);b=d(b.maximumAnisotropy)?b.maximumAnisotropy:1;this._wrapS=c;this._wrapT=e;this._minificationFilter=
k;this._magnificationFilter=x;this._maximumAnisotropy=b}c(k.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}});k.equals=function(a,b){return a===b||d(a)&&d(b)&&a._wrapS===b._wrapS&&a._wrapT===b._wrapT&&a._minificationFilter===b._minificationFilter&&
a._magnificationFilter===b._magnificationFilter&&a._maximumAnisotropy===b._maximumAnisotropy};return k});
definejs("Renderer/PixelDatatype",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var d={UNSIGNED_BYTE:a.UNSIGNED_BYTE,UNSIGNED_SHORT:a.UNSIGNED_SHORT,UNSIGNED_INT:a.UNSIGNED_INT,FLOAT:a.FLOAT,HALF_FLOAT:a.HALF_FLOAT_OES,UNSIGNED_INT_24_8:a.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:a.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:a.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:a.UNSIGNED_SHORT_5_6_5,isPacked:function(a){return a===d.UNSIGNED_INT_24_8||a===d.UNSIGNED_SHORT_4_4_4_4||a===
d.UNSIGNED_SHORT_5_5_5_1||a===d.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(a){switch(a){case d.UNSIGNED_BYTE:return 1;case d.UNSIGNED_SHORT:case d.UNSIGNED_SHORT_4_4_4_4:case d.UNSIGNED_SHORT_5_5_5_1:case d.UNSIGNED_SHORT_5_6_5:case d.HALF_FLOAT:return 2;case d.UNSIGNED_INT:case d.FLOAT:case d.UNSIGNED_INT_24_8:return 4}},validate:function(a){return a===d.UNSIGNED_BYTE||a===d.UNSIGNED_SHORT||a===d.UNSIGNED_INT||a===d.FLOAT||a===d.HALF_FLOAT||a===d.UNSIGNED_INT_24_8||a===d.UNSIGNED_SHORT_4_4_4_4||
a===d.UNSIGNED_SHORT_5_5_5_1||a===d.UNSIGNED_SHORT_5_6_5}};return b(d)});
definejs("Core/PixelFormat",["../Renderer/PixelDatatype","./freezeObject","./WebGLConstants"],function(b,a,d){var c={DEPTH_COMPONENT:d.DEPTH_COMPONENT,DEPTH_STENCIL:d.DEPTH_STENCIL,ALPHA:d.ALPHA,RGB:d.RGB,RGBA:d.RGBA,LUMINANCE:d.LUMINANCE,LUMINANCE_ALPHA:d.LUMINANCE_ALPHA,RGB_DXT1:d.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:d.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:d.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:d.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:d.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:d.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,
RGBA_PVRTC_4BPPV1:d.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:d.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:d.COMPRESSED_RGB_ETC1_WEBGL,componentsLength:function(a){switch(a){case c.RGB:return 3;case c.RGBA:return 4;case c.LUMINANCE_ALPHA:return 2;case c.ALPHA:case c.LUMINANCE:return 1;default:return 1}},validate:function(a){return a===c.DEPTH_COMPONENT||a===c.DEPTH_STENCIL||a===c.ALPHA||a===c.RGB||a===c.RGBA||a===c.LUMINANCE||a===c.LUMINANCE_ALPHA||a===c.RGB_DXT1||a===c.RGBA_DXT1||a===c.RGBA_DXT3||
a===c.RGBA_DXT5||a===c.RGB_PVRTC_4BPPV1||a===c.RGB_PVRTC_2BPPV1||a===c.RGBA_PVRTC_4BPPV1||a===c.RGBA_PVRTC_2BPPV1||a===c.RGB_ETC1},isColorFormat:function(a){return a===c.ALPHA||a===c.RGB||a===c.RGBA||a===c.LUMINANCE||a===c.LUMINANCE_ALPHA},isDepthFormat:function(a){return a===c.DEPTH_COMPONENT||a===c.DEPTH_STENCIL},isCompressedFormat:function(a){return a===c.RGB_DXT1||a===c.RGBA_DXT1||a===c.RGBA_DXT3||a===c.RGBA_DXT5||a===c.RGB_PVRTC_4BPPV1||a===c.RGB_PVRTC_2BPPV1||a===c.RGBA_PVRTC_4BPPV1||a===c.RGBA_PVRTC_2BPPV1||
a===c.RGB_ETC1},isDXTFormat:function(a){return a===c.RGB_DXT1||a===c.RGBA_DXT1||a===c.RGBA_DXT3||a===c.RGBA_DXT5},isPVRTCFormat:function(a){return a===c.RGB_PVRTC_4BPPV1||a===c.RGB_PVRTC_2BPPV1||a===c.RGBA_PVRTC_4BPPV1||a===c.RGBA_PVRTC_2BPPV1},isETC1Format:function(a){return a===c.RGB_ETC1},compressedTextureSizeInBytes:function(a,b,d){switch(a){case c.RGB_DXT1:case c.RGBA_DXT1:case c.RGB_ETC1:return Math.floor((b+3)/4)*Math.floor((d+3)/4)*8;case c.RGBA_DXT3:case c.RGBA_DXT5:return Math.floor((b+
3)/4)*Math.floor((d+3)/4)*16;case c.RGB_PVRTC_4BPPV1:case c.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(b,8)*Math.max(d,8)*4+7)/8);case c.RGB_PVRTC_2BPPV1:case c.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(b,16)*Math.max(d,8)*2+7)/8);default:return 0}},textureSizeInBytes:function(a,d,l,g){a=c.componentsLength(a);b.isPacked(d)&&(a=1);return a*b.sizeInBytes(d)*l*g},alignmentInBytes:function(a,b,d){a=c.textureSizeInBytes(a,b,d,1)%4;return 0===a?4:2===a?2:1},createTypedArray:function(a,d,l,g){var k=
b.sizeInBytes(d);d=k===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:k===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:k===Float32Array.BYTES_PER_ELEMENT&&d===b.FLOAT?Float32Array:Uint32Array;a=c.componentsLength(a)*l*g;return new d(a)},flipY:function(a,b,d,g,k){if(1===k)return a;d=c.createTypedArray(b,d,g,k);b=c.componentsLength(b);g*=b;for(var n=0;n<k;++n)for(var f=n*k*b,m=(k-n-1)*k*b,q=0;q<g;++q)d[m+q]=a[f+q];return d}};return a(c)});
definejs("Renderer/MipmapHint",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var d={DONT_CARE:a.DONT_CARE,FASTEST:a.FASTEST,NICEST:a.NICEST,validate:function(a){return a===d.DONT_CARE||a===d.FASTEST||a===d.NICEST}};return b(d)});
definejs("Renderer/Texture","../Core/Check ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/GeoworldMath ../Core/PixelFormat ../Core/WebGLConstants ./ContextLimits ./MipmapHint ./PixelDatatype ./Sampler ./TextureMagnificationFilter ./TextureMinificationFilter".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p,s){function r(b){b=d(b,d.EMPTY_OBJECT);var e=b.context,f=b.width,g=b.height,h=b.source;c(h)&&(c(f)||(f=d(h.videoWidth,
h.width)),c(g)||(g=d(h.videoHeight,h.height)));var m=d(b.pixelFormat,k.RGBA),p=d(b.pixelDatatype,q.UNSIGNED_BYTE),l=m,r=k.isCompressedFormat(l);if(e.webgl2)if(m===k.DEPTH_STENCIL?l=n.DEPTH24_STENCIL8:m===k.DEPTH_COMPONENT&&(p===q.UNSIGNED_SHORT?l=n.DEPTH_COMPONENT16:p===q.UNSIGNED_INT&&(l=n.DEPTH_COMPONENT24)),p===q.FLOAT)switch(m){case k.RGBA:l=n.RGBA32F;break;case k.RGB:l=n.RGB32F;break;case k.RG:l=n.RG32F;break;case k.R:l=n.R32F}else if(p===q.HALF_FLOAT)switch(m){case k.RGBA:l=n.RGBA16F;break;
case k.RGB:l=n.RGB16F;break;case k.RG:l=n.RG16F;break;case k.R:l=n.R16F}var s=b.preMultiplyAlpha||m===k.RGB||m===k.LUMINANCE,O=d(b.flipY,!0),E=!0,H=e._gl,P=H.TEXTURE_2D,B=H.createTexture();H.activeTexture(H.TEXTURE0);H.bindTexture(P,B);var I=4;c(h)&&c(h.arrayBufferView)&&!r&&(I=k.alignmentInBytes(m,p,f));H.pixelStorei(H.UNPACK_ALIGNMENT,I);c(h)?c(h.arrayBufferView)?(H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),H.pixelStorei(H.UNPACK_FLIP_Y_WEBGL,!1),h=h.arrayBufferView,r?H.compressedTexImage2D(P,
0,l,f,g,0,h):(O&&(h=k.flipY(h,m,p,f,g)),H.texImage2D(P,0,l,f,g,0,m,p,h))):c(h.framebuffer)?(H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),H.pixelStorei(H.UNPACK_FLIP_Y_WEBGL,!1),h.framebuffer!==e.defaultFramebuffer&&h.framebuffer._bind(),H.copyTexImage2D(P,0,l,h.xOffset,h.yOffset,f,g,0),h.framebuffer!==e.defaultFramebuffer&&h.framebuffer._unBind()):(H.pixelStorei(H.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),H.pixelStorei(H.UNPACK_FLIP_Y_WEBGL,O),H.texImage2D(P,0,l,m,p,h)):(H.texImage2D(P,0,l,f,g,0,m,
p,null),E=!1);H.bindTexture(P,null);l=r?k.compressedTextureSizeInBytes(m,f,g):k.textureSizeInBytes(m,p,f,g);this._id=a();this._context=e;this._textureFilterAnisotropic=e._textureFilterAnisotropic;this._textureTarget=P;this._texture=B;this._pixelFormat=m;this._pixelDatatype=p;this._width=f;this._height=g;this._dimensions=[f,g];this._hasMipmap=!1;this._sizeInBytes=l;this._preMultiplyAlpha=s;this._flipY=O;this._initialized=E;this._sampler=void 0;this.sampler=c(b.sampler)?b.sampler:new x}r.create=function(a){return new r(a)};
r.fromFramebuffer=function(a){a=d(a,d.EMPTY_OBJECT);var b=a.context,e=b._gl,f=d(a.pixelFormat,k.RGB),g=d(a.framebufferXOffset,0),h=d(a.framebufferYOffset,0),m=d(a.width,e.drawingBufferWidth),e=d(a.height,e.drawingBufferHeight);a=a.framebuffer;return new r({context:b,width:m,height:e,pixelFormat:f,source:{framebuffer:c(a)?a:b.defaultFramebuffer,xOffset:g,yOffset:h,width:m,height:e}})};e(r.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(a){var b=
a.minificationFilter,d=a.magnificationFilter,e=b===s.NEAREST_MIPMAP_NEAREST||b===s.NEAREST_MIPMAP_LINEAR||b===s.LINEAR_MIPMAP_NEAREST||b===s.LINEAR_MIPMAP_LINEAR,f=this._context,g=this._pixelDatatype;if(g===q.FLOAT&&!f.textureFloatLinear||g===q.HALF_FLOAT&&!f.textureHalfFloatLinear)b=e?s.NEAREST_MIPMAP_NEAREST:s.NEAREST,d=p.NEAREST;e=f._gl;f=this._textureTarget;e.activeTexture(e.TEXTURE0);e.bindTexture(f,this._texture);e.texParameteri(f,e.TEXTURE_MIN_FILTER,b);e.texParameteri(f,e.TEXTURE_MAG_FILTER,
d);e.texParameteri(f,e.TEXTURE_WRAP_S,a.wrapS);e.texParameteri(f,e.TEXTURE_WRAP_T,a.wrapT);c(this._textureFilterAnisotropic)&&e.texParameteri(f,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.maximumAnisotropy);e.bindTexture(f,null);this._sampler=a}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},
width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}});r.prototype.copyFrom=function(a,b,e){b=d(b,0);e=d(e,0);var f=this._context._gl,g=this._textureTarget;f.activeTexture(f.TEXTURE0);f.bindTexture(g,this._texture);var h=a.width,m=a.height,p=a.arrayBufferView,l=this._width,q=this._height,n=this._pixelFormat,
r=this._pixelDatatype,s=this._preMultiplyAlpha,x=this._flipY,B=4;c(p)&&(B=k.alignmentInBytes(n,r,h));f.pixelStorei(f.UNPACK_ALIGNMENT,B);B=!1;if(!this._initialized){if(0===b&&0===e&&h===l&&m===q)c(p)?(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),x&&(p=k.flipY(p,n,r,l,q)),f.texImage2D(g,0,n,l,q,0,n,r,p)):(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,x),f.texImage2D(g,0,n,n,r,a)),B=!0;else{f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!1);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);var I=k.createTypedArray(n,r,l,q);f.texImage2D(g,0,n,l,q,0,n,r,I)}this._initialized=!0}B||(c(p)?(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),x&&(p=k.flipY(p,n,r,h,m)),f.texSubImage2D(g,0,b,e,h,m,n,r,p)):(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,x),f.texSubImage2D(g,0,b,e,n,r,a)));f.bindTexture(g,null)};r.prototype.copyFromFramebuffer=function(a,b,c,e,f,g){a=d(a,0);
b=d(b,0);c=d(c,0);e=d(e,0);f=d(f,this._width);g=d(g,this._height);var h=this._context._gl,m=this._textureTarget;h.activeTexture(h.TEXTURE0);h.bindTexture(m,this._texture);h.copyTexSubImage2D(m,0,a,b,c,e,f,g);h.bindTexture(m,null);this._initialized=!0};r.prototype.generateMipmap=function(a){a=d(a,m.DONT_CARE);this._hasMipmap=!0;var b=this._context._gl,c=this._textureTarget;b.hint(b.GENERATE_MIPMAP_HINT,a);b.activeTexture(b.TEXTURE0);b.bindTexture(c,this._texture);b.generateMipmap(c);b.bindTexture(c,
null)};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){this._context._gl.deleteTexture(this._texture);return h(this)};return r});
definejs("ThirdParty/GltfPipeline/addPipelineExtras",["./ForEach","../../Core/defined"],function(b,a){function d(b){b.extras=a(b.extras)?b.extras:{};b.extras._pipeline=a(b.extras._pipeline)?b.extras._pipeline:{}}return function(a){b.shader(a,function(a){d(a)});b.buffer(a,function(a){d(a)});b.image(a,function(a){d(a);b.compressedImage(a,function(a){d(a)})});d(a);return a}});
definejs("ThirdParty/GltfPipeline/numberOfComponentsForType",[],function(){return function(b){switch(b){case "SCALAR":return 1;case "VEC2":return 2;case "VEC3":return 3;case "VEC4":case "MAT2":return 4;case "MAT3":return 9;case "MAT4":return 16}}});
definejs("ThirdParty/GltfPipeline/getAccessorByteStride",["./numberOfComponentsForType","../../Core/ComponentDatatype","../../Core/defined"],function(b,a,d){return function(c,e){var h=e.bufferView;return d(h)&&(h=c.bufferViews[h],d(h.byteStride)&&0<h.byteStride)?h.byteStride:a.getSizeInBytes(e.componentType)*b(e.type)}});
definejs("Resource/Model","Core/defaultValue Core/defined Core/defineProperties Core/clone Core/getAbsoluteUri Core/createGuid Core/getMagic Core/getStringFromTypedArray Core/loadImageFromTypedArray Core/WebGLConstants Core/GeoworldMath Core/IndexDatatype Core/PrimitiveType Core/addDefaults Math/Extent Math/Matrix4 Resource/Resource Resource/ModelUtility Resource/ModelMesh Resource/ModelLoadResources Renderer/Buffer Renderer/BufferUsage Renderer/VertexArray Renderer/Sampler Renderer/Texture Renderer/TextureWrap Renderer/TextureMinificationFilter Renderer/TextureMagnificationFilter ThirdParty/GltfPipeline/ForEach ThirdParty/GltfPipeline/addPipelineExtras ThirdParty/GltfPipeline/getAccessorByteStride ThirdParty/GltfPipeline/numberOfComponentsForType Framework/AppState".split(" "),function(b,
a,d,c,e,h,l,g,k,n,f,m,q,x,p,s,r,z,t,w,u,v,A,F,M,C,J,O,E,H,P,B,I){function y(a){this._gltf=a.gltf;this.ready=a.ready;this.modelsToLoad=[];this.count=0}function K(a){var b=a._loadResources;E.buffer(a.gltf,function(a,c){b.buffers[c]=a.extras._pipeline.source})}function G(a,b){return function(c){var d=a._loadResources;c=new Uint8Array(c);--d.pendingBufferLoads;a.gltf.buffers[b].extras._pipeline.source=c}}function L(b){var c=b.gltf.bufferViews,d=b._loadResources.vertexBuffersToCreate;E.bufferView(b.gltf,
function(a,b){a.target===n.ARRAY_BUFFER&&d.enqueue(b)});var e=b._loadResources.indexBuffersToCreate,f={};E.accessor(b.gltf,function(b){var d=b.bufferView;a(d)&&c[d].target===n.ELEMENT_ARRAY_BUFFER&&!a(f[d])&&(f[d]=!0,e.enqueue({id:d,componentType:b.componentType}))})}function N(a,b){return function(c){var d=a._loadResources;--d.pendingTextureLoads;d.texturesToCreate.enqueue({id:b,image:c,bufferView:c.bufferView,width:c.width,height:c.height,internalFormat:c.internalFormat})}}function D(b,c,d){var e=
b.gltf,f=e.images,g;E.texture(e,function(e,h){var m=e.source;a(e.extensions)&&a(e.extensions.EXT_texture_webp)&&d&&(m=e.extensions.EXT_texture_webp.source);var k=f[m],p=k.extras,l=k.bufferView,q=k.mimeType;g=k.uri;if(a(p)&&a(p.compressedImage3DTiles)){var k=p.compressedImage3DTiles.crunch,n=p.compressedImage3DTiles.s3tc,r=p.compressedImage3DTiles.pvrtc1,p=p.compressedImage3DTiles.etc1;c.s3tc&&a(k)?(q=k.mimeType,a(k.bufferView)?l=k.bufferView:g=k.uri):c.s3tc&&a(n)?(q=n.mimeType,a(n.bufferView)?l=n.bufferView:
g=n.uri):c.pvrtc&&a(r)?(q=r.mimeType,a(r.bufferView)?l=r.bufferView:g=r.uri):c.etc1&&a(p)&&(q=p.mimeType,a(p.bufferView)?l=p.bufferView:g=p.uri)}a(l)?b._loadResources.texturesToCreateFromBufferView.enqueue({id:h,image:void 0,bufferView:l,mimeType:q}):(++b._loadResources.pendingTextureLoads,l=b._resource.getDerivedResource({url:g}),(ba.test(g)?loadKTX(l):ia.test(g)?loadCRN(l):ja.test(g)?loadDDS(l):l.fetchImage()).then(N(b,h,m)).otherwise(z.getFailedLoadFunction(b,"image",l.url)))})}function Q(a){var b=
{},c={};E.material(a.gltf,function(a,d){var e={textureId:a.pbrMetallicRoughness.baseColorTexture.index};b[a.name]=e;c[d]=e});a._runtime.materialsByName=b;a._runtime.materialsById=c}function X(a){var b={},c=a._runtime.materialsById;E.mesh(a.gltf,function(a,d){b[a.name]=new t(a,c,d)});a._runtime.meshesByName=b}function $(b,c,d){var e=c._loadResources,f=c.gltf.bufferViews[b];a(f)||(f=e.createdBufferViews[b]);e.getBuffer(f);d=u.createVertexBuffer({context:d,typedArray:e.getBuffer(f),usage:v.STATIC_DRAW});
d.vertexArrayDestroyable=!1;c._rendererResources.buffers[b]=d;c._geometryByteLength+=d.sizeInBytes;d._buffer.type=n.FLOAT;d._buffer.itemSize=f.byteStride/4;d._buffer.numItems=d.sizeInBytes/f.byteStride;d._buffer.normalized=!1}function ga(b,c,d,e){var f=d._loadResources,g=d.gltf.bufferViews[b];a(g)||(g=f.createdBufferViews[b]);c=u.createIndexBuffer({context:e,typedArray:f.getBuffer(g),usage:v.STATIC_DRAW,indexDatatype:c});c.vertexArrayDestroyable=!1;d._rendererResources.buffers[b]=c;d._geometryByteLength+=
c.sizeInBytes}function V(a,b){return function(c){a.texturesToCreate.enqueue({id:b.id,image:c,bufferView:void 0});--a.pendingBufferViewToImage}}function ha(b,c,d){var e=c.gltf.textures[b.id],g=c._rendererResources.samplers[e.sampler];a(g)||(g=new F({wrapS:C.REPEAT,wrapT:C.REPEAT}));for(var h=!1,m=c.gltf.materials,k=m.length,p=0;p<k;++p){var l=m[p];if(a(l.extensions)&&a(l.extensions.KHR_techniques_webgl)){var l=l.extensions.KHR_techniques_webgl.values,q;for(q in l)if(l.hasOwnProperty(q)&&-1!==q.indexOf("Texture")){var n=
l[q];if(n.index===b.id&&a(n.extensions)&&a(n.extensions.KHR_texture_transform)){h=!0;break}}}if(h)break}k=g.wrapS;p=g.wrapT;q=g.minificationFilter;h&&q!==J.LINEAR&&q!==J.NEAREST&&(q=q===J.NEAREST_MIPMAP_NEAREST||q===J.NEAREST_MIPMAP_LINEAR?J.NEAREST:J.LINEAR,g=new F({wrapS:g.wrapS,wrapT:g.wrapT,textureMinificationFilter:q,textureMagnificationFilter:g.magnificationFilter}));var m=b.internalFormat,p=(h=!(a(m)&&PixelFormat.isCompressedFormat(m))&&(q===J.NEAREST_MIPMAP_NEAREST||q===J.NEAREST_MIPMAP_LINEAR||
q===J.LINEAR_MIPMAP_NEAREST||q===J.LINEAR_MIPMAP_LINEAR))||k===C.REPEAT||k===C.MIRRORED_REPEAT||p===C.REPEAT||p===C.MIRRORED_REPEAT,r,k=b.image;a(m)?r=new M({context:d,source:{arrayBufferView:b.bufferView},width:b.width,height:b.height,pixelFormat:m,sampler:g}):a(k)&&(r=!f.isPowerOfTwo(k.width)||!f.isPowerOfTwo(k.height),p&&r&&(r=document.createElement("canvas"),r.width=f.nextPowerOfTwo(k.width),r.height=f.nextPowerOfTwo(k.height),r.getContext("2d").drawImage(k,0,0,k.width,k.height,0,0,r.width,r.height),
k=r),r=new M({context:d,source:k,pixelFormat:e.internalFormat,pixelDatatype:e.type,sampler:g,flipY:!1}),h&&r.generateMipmap());a(r)&&(c._rendererResources.textures[b.id]=r,c._texturesByteLength+=r.sizeInBytes)}function fa(b,c){var d=b._loadResources;if(d.finishedBuffersCreation()&&d.finishedProgramCreation()&&d.createVertexArrays){d.createVertexArrays=!1;var e=b._rendererResources.buffers,f=b._rendererResources.vertexArrays,g=b.gltf,h=g.accessors;E.mesh(g,function(d,m){E.meshPrimitive(d,function(d,
k){var p=[],l,q=R(b,d),n=b._decodedData[m+".primitive."+k];E.meshPrimitiveAttribute(d,function(b,c){l=q[c];if(a(l)){if(a(n)){var d=n.attributes;if(d.hasOwnProperty(c)){d=d[c];p.push({index:l,vertexBuffer:e[d.bufferView],componentsPerAttribute:d.componentsPerAttribute,componentDatatype:d.componentDatatype,normalize:d.normalized,offsetInBytes:d.byteOffset,strideInBytes:d.byteStride});return}}var d=h[b],f=a(d.normalized)&&d.normalized;p.push({index:l,vertexBuffer:e[d.bufferView],componentsPerAttribute:B(d.type),
componentDatatype:d.componentType,normalize:f,offsetInBytes:d.byteOffset,strideInBytes:P(g,d)})}});var r,s,t=b._precreatedAttributes;if(a(t))for(s in t)t.hasOwnProperty(s)&&(l=q[s],a(l)&&(r=t[s],r.index=l,p.push(r)));var x;a(d.indices)&&(r=h[d.indices].bufferView,a(n)&&(r=n.bufferView),x=e[r]);f[m+".primitive."+k]=new A({context:c,attributes:p,indexBuffer:x})})})}}function R(b,c){var d={};if(!a(b._runtime.materialsById[c.material]))return d;d.POSITION=0;d.NORMAL=1;d.TEXCOORD_0=2;return d}var T=z.ModelState;
d(y.prototype,{gltf:{set:function(a){this._gltf=a},get:function(){return this._gltf}}});y.prototype.makeReady=function(a){this.gltf=a;a=this.modelsToLoad;for(var b=a.length,c=0;c<b;++c){var d=a[c];d.isDestroyed()||(d._cachedGltf=this)}this.modelsToLoad=void 0;this.ready=!0};var S={},U={},W=function(c){c=b(c,b.EMPTY_OBJECT);var d=c.cacheKey;this._cacheKey=d;this._cachedGltf=void 0;this._releaseGltfJson=b(c.releaseGltfJson,!1);var e;if(a(d)&&a(S[d])&&S[d].ready)e=S[d],++e.count;else{var f=c.gltf;a(f)&&
(f instanceof ArrayBuffer&&(f=new Uint8Array(f)),f instanceof Uint8Array?(e=parseGlb(f),e=new y({gltf:e,ready:!0})):e=new y({gltf:c.gltf,ready:!0}),e.count=1,a(d)&&(S[d]=e))}this._cachedGltf=e;d=b(c.basePath,"");this._resource=r.createIfNeeded(d);this.show=b(c.show,!0);this.silhouetteSize=b(c.silhouetteSize,0);this.modelMatrix=s.clone(b(c.modelMatrix,s.IDENTITY));this._modelMatrix=s.clone(this.modelMatrix);this._clampedModelMatrix=void 0;this._scale=this.scale=b(c.scale,1);this._minimumPixelSize=
this.minimumPixelSize=b(c.minimumPixelSize,0);this._state=T.NEEDS_LOAD;this._asynchronous=!1;this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}};this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0};this._decodedData={};
this._mvMatrix=s.create();this._nodeCommands=[];this._nodeCommands2=[];this._trianglesLength=0};d(W.prototype,{gltf:{get:function(){return a(this._cachedGltf)?this._cachedGltf.gltf:void 0}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){var b=this.modelMatrix;this.heightReference!==HeightReference.NONE&&this._clampedModelMatrix&&(b=this._clampedModelMatrix);
var b=s.getScale(b,boundingSphereCartesian3Scratch),c=a(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;Cartesian3.multiplyByScalar(b,c,b);c=this._scaledBoundingSphere;c.center=Cartesian3.multiplyComponents(this._boundingSphere.center,b,c.center);c.radius=Cartesian3.maximumComponent(b)*this._initialRadius;a(this._rtcCenter)&&Cartesian3.add(this._rtcCenter,c.center,c.center);return c}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},
asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}}});W.fromGltf=function(d){var f=d.url;d=c(d);var f=r.createIfNeeded(f),m=b(d.basePath,f.clone()),k=r.createIfNeeded(m),m=b(d.cacheKey,U[e(f.url)]);a(m)||(m=h(),U[e(f.url)]=m);a(d.basePath)&&!a(d.cacheKey)&&(m+=k.url);d.cacheKey=m;d.basePath=k;d=new W(d);var p=S[m];a(p)?p.ready||(++p.count,p.modelsToLoad.push(d)):(p=new y({ready:!1}),p.count=1,p.modelsToLoad.push(d),d._cachedGltf=p,S[m]=
p,a(f.headers.Accept)||(f.headers.Accept="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01"),f.fetchArrayBuffer().then(function(a){a=new Uint8Array(a);"glTF"===l(a)?(a=parseGlb(a),p.makeReady(a)):(a=g(a),p.makeReady(JSON.parse(a)))}).otherwise(z.getFailedLoadFunction(d,"model",f.url)));return d};W._gltfCache=S;W.prototype.getNode=function(b){b=this._runtime.nodesByName[b];return a(b)?b.publicNode:void 0};W.prototype.getMesh=function(a){return this._runtime.meshesByName[a]};
W.prototype.getMaterial=function(a){return this._runtime.materialsByName[a]};var ba=/(^data:image\/ktx)|(\.ktx$)/i,ia=/(^data:image\/crn)|(\.crn$)/i,ja=/(^data:image\/dds)|(\.dds$)/i;d=function(){this.context=this.model=this.id=void 0};d.prototype.set=function(a,b,c){this.id=a;this.model=b;this.context=c};d.prototype.execute=function(){$(this.id,this.model,this.context)};p=function(){this.context=this.model=this.componentType=this.id=void 0};p.prototype.set=function(a,b,c,d){this.id=a;this.componentType=
b;this.model=c;this.context=d};p.prototype.execute=function(){ga(this.id,this.componentType,this.model,this.context)};var ka=new d,pa=new p;d=function(){this.context=this.model=this.gltfTexture=void 0};d.prototype.set=function(a,b,c){this.gltfTexture=a;this.model=b;this.context=c};d.prototype.execute=function(){ha(this.gltfTexture,this.model,this.context)};var ca=new d;W.prototype.isDestroyed=function(){return!1};W.prototype.upload=function(b){var c=b._frameState;this._state===T.NEEDS_LOAD&&a(this.gltf)&&
(x(this.gltf),this._state=T.LOADING,this._state!==T.FAILED&&(H(this.gltf),this._loadResources=new w,this._loadRendererResourcesFromCache||z.parseBuffers(this,G)));if(this._state===T.LOADING){var d=this._loadResources;if(0===d.pendingBufferLoads&&(d.initialized||(K(this),this._loadRendererResourcesFromCache||(L(this),D(this,null,!1)),Q(this),X(this),d.initialized=!0),d.finishedDecoding()&&(d.resourcesParsed=!0),d.resourcesParsed&&0===d.pendingShaderLoads)){var e=c.context,f=this._loadResources;if(0===
f.pendingBufferLoads){var g=c.context,h=f.vertexBuffersToCreate,f=f.indexBuffersToCreate;if(this.asynchronous){for(;0<h.length;){ka.set(h.peek(),this,g);if(!c.jobScheduler.execute(ka,JobType.BUFFER))break;h.dequeue()}for(;0<f.length;){h=f.peek();pa.set(h.id,h.componentType,this,g);if(!c.jobScheduler.execute(pa,JobType.BUFFER))break;f.dequeue()}}else{for(;0<h.length;)$(h.dequeue(),this,g);for(;0<f.length;)h=f.dequeue(),ga(h.id,h.componentType,this,g)}}g=this._loadResources;if(0===g.pendingBufferLoads)for(;0<
g.texturesToCreateFromBufferView.length;){var h=g.texturesToCreateFromBufferView.dequeue(),p=this.gltf,f=p.bufferViews[h.bufferView],l=p.textures[h.id].source,p=z.getFailedLoadFunction(this,"image","id: "+h.id+", bufferView: "+h.bufferView);"image/ktx"===h.mimeType?(loadKTX(g.getBuffer(f)).then(N(this,h.id,l)).otherwise(p),++this._loadResources.pendingTextureLoads):"image/crn"===h.mimeType?(loadCRN(g.getBuffer(f)).then(N(this,h.id,l)).otherwise(p),++this._loadResources.pendingTextureLoads):(l=V(g,
h),k({uint8Array:g.getBuffer(f),format:h.mimeType,flipY:!1}).then(l).otherwise(p),++g.pendingBufferViewToImage)}g=c.context;h=this._loadResources.texturesToCreate;if(this.asynchronous)for(;0<h.length;){ca.set(h.peek(),this,g);if(!c.jobScheduler.execute(ca,JobType.TEXTURE))break;h.dequeue()}else for(;0<h.length;)ha(h.dequeue(),this,g);fa(this,e)}if(d.finished()){this._state=T.LOADED;for(var r in this.gltf.nodes)a:if(p=this.gltf.nodes[r],c=b,d=c.framework.renderDevice,e=c.framework.renderDevice.effectManager.getEffect(0).getTechnique(51),
g=c.framework.renderDevice.effectManager.getEffect(0).getTechnique(52),h=this._rendererResources.vertexArrays,l=this.gltf,f=l.accessors,l=l.meshes,p=p.mesh,a(p))for(var l=l[p].primitives,s=l.length,t=0;t<s;++t){var u=l[t],v=f[u.indices],C=this._runtime.materialsById[u.material],A=h[p+".primitive."+t];if(3>A._attributes.length)break a;var y;a(v)?(y=v.count,v=v.byteOffset/m.getSizeInBytes(v.componentType)):(y=f[u.attributes.POSITION].count,v=0);b:switch(u.mode){case q.TRIANGLES:u=y/3;break b;case q.TRIANGLE_STRIP:case q.TRIANGLE_FAN:u=
Math.max(y-2,0);break b;default:u=0}this._trianglesLength+=u;y=d.createRenderCommand();var E=A._attributes,F;for(F in E){var B=E[F];y.setStreamSource(B.index,B.vertexBuffer._buffer,B.offsetInBytes,B.strideInBytes)}E=A._indexBuffer;y.setIndexBuffer(E._buffer);E=C.textureId;E=this._rendererResources.textures[E];y.setTexture(0,E._texture);y.setTexture(1,c.framework._defaultTexture);y._matrixUniforms[0]=c._mvMatrix;y._matrixUniforms[1]=na;y._matrixUniforms[2]=c._mvMatrix;y._matrixUniforms[3]=[200/255,
200/255,200/255,1,40/255,40/255,40/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];y._vectorUniforms[0]=[1,1,1,1];y.viewDistance=500;y.setRenderTechnique(e);y.setRenderOperationIndex(n.TRIANGLES,v,0,A._numberOfVertices,u);this._nodeCommands.push(y);y=d.createRenderCommand();E=A._attributes;for(F in E)B=E[F],y.setStreamSource(B.index,B.vertexBuffer._buffer,B.offsetInBytes,B.strideInBytes);E=A._indexBuffer;y.setIndexBuffer(E._buffer);E=C.textureId;E=this._rendererResources.textures[E];y.setTexture(0,
E._texture);y.setTexture(1,c.framework._defaultTexture);y._matrixUniforms[0]=c._mvMatrix;y._matrixUniforms[1]=na;y._matrixUniforms[2]=c._mvMatrix;y._matrixUniforms[3]=[200/255,200/255,200/255,1,40/255,40/255,40/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];y._vectorUniforms[0]=[1,1,1,1];y.viewDistance=500;y.setRenderTechnique(g);y.setRenderOperationIndex(n.TRIANGLES,v,0,A._numberOfVertices,u);this._nodeCommands2.push(y);if(this._modelLayer)this._modelLayer.onModelCreated()}}}};s.create();
var ea=s.create(),na=s.create();W.prototype.cull=function(a){this.upload(a);if(this._state===T.LOADED){this._scaleBuilding=1;s.scale(ea,this._scaleBuilding,this._scaleBuilding,this._scaleBuilding);s.multiply(a._mvMatrix,this._modelMatrix,ea);s.multiply(a._mvMatrix,a._mvMatrix,a._transMat);s.multiply(a._mvMatrix,a._mvMatrix,a._viewProjectionMatrix);var b=a._renderContext._renderQueues[1],c=this._renderCommand;c._matrixUniforms[0]=a._mvMatrix;b.addRenderObject(c);c=this._renderCommand2;c._matrixUniforms[0]=
a._mvMatrix;b.addRenderObject(c);c=this._renderCommand3;c._matrixUniforms[0]=a._mvMatrix;b.addRenderObject(c)}};return W});
definejs("Scene/ParametricModel/Style/ParametricSymbolStyle",["Framework/ConfigOptions","Resource/Model"],function(b,a){var d=function(){this.parentLayer=this.framework=null;this.rtti="ParametricSymbolStyle";this.modelUrl=this.name="";this.model=null;this.translate=[0,0,0];this.rotation=[0,0,0,0];this.scale=[0,0,0,0];this.pivot=[0,0,0];this.model=null};d.prototype.initialize=function(b,d){this.framework=b;this.parentLayer=d;this.model=this.parentLayer.modelManager.getModel(this.modelUrl);null==this.model&&
(this.model=a.fromGltf({url:this.modelUrl,scale:1}),this.parentLayer.modelManager.addModel(this.modelUrl,this.model))};d.prototype.finalize=function(){};return d});
definejs("Scene/ParametricModel/Style/ParametricAnnoStyle",["Framework/ConfigOptions"],function(b){var a=function(){this.parentLayer=this.framework=null;this.rtti="ParametricAnnoStyle";this.name="";this.texture=null;this.charHeight=this.charWidth=3;this.rotation=this.offsetV=this.offsetU=this.charInterval=0;this.faceName="Arial";this.isBold=!0;this.fontHeight=48};a.prototype.initialize=function(a,c){this.framework=a;this.parentLayer=c;this.font=a._fontManager.createFont(this.faceName,this.isBold,
this.fontHeight,!0);this.texture=a._defaultTexture;var e=null;this.texture2=e=a.getTextureManager().createTextureEx("texture/wall_ssao.jpg",b.textureDataURLMap["texture/wall_ssao.jpg"])};a.prototype.finalize=function(){};return a});
definejs("Scene/ParametricModel/ParametricModelLayerTessellator","Renderer/RenderQueue Math/MathUtils Math/Matrix4 Math/Ellipsoid Math/Vector3 Framework/AppState".split(" "),function(b,a,d,c,e,h){b={};e.create();e.create();b.getBoundaryBox=function(a,b,c){e.assign(b,9999999,9999999,9999999);e.assign(c,-9999999,-9999999,-9999999);for(var d=0;d<a.length;d++)a[d].getBoundaryBox(b,c)};b.getFloorExtent=function(a,b){for(var c=0;c<a.length;c++)a[c].getFloorExtent(b)};b.tessellate=function(a,b){for(var c=
0;c<b.length;c++)b[c].cull(a);return!0};return b});
definejs("Scene/ParametricModel/ParametricHelper","Core/defaultValue Math/Extent Math/Vector3 Math/Matrix4 Math/MathUtils Scene/UserLayer/VectorDataSource Scene/ParametricModel/ParametricModelLayerTessellator".split(" "),function(b,a,d,c,e,h,l){b={};b.maxVertexCount=Number.MAX_VALUE;b.getPoint=function(a,b,c,d,f){c=c[d];b[0]=c[0]*e.RADIANS_PER_DEGREE;b[1]=c[1]*e.RADIANS_PER_DEGREE;b[2]=f;a.transformGeographicsToWorld(b,b)};var g=d.create();b.getUV=function(a,b,c,e,f){d.sub(g,a,b);d.sub(g,g,c);d.transformCoord(g,
g,e);f[0]=g[0];f[1]=g[1]};var k=c.create(),n=c.create(),f=c.create(),m=c.create(),q=c.create(),x=c.create();b.getUVMatrix=function(a,b){c.translate(x,b.offsetU,b.offsetV,0);var d=b.scaleU;0===d&&(d=a._max[0]-a._min[0]);var e=b.scaleV;0===e&&(e=a._max[1]-a._min[1]);c.translate(q,0.5,0.5,0);c.scale(f,1/b.scaleU,-1/b.scaleV,1);c.scale(f,1/d,-1/e,1);c.rotateAxisZ(n,Math.PI*b.rotation/180);c.multiply(k,m,f);c.multiply(k,k,n);c.multiply(k,k,q);c.multiply(k,k,x);return k};b.pushTriStripPointXYZNormalTexture=
function(a,b,c,d,e,f,g,h){a.push(d[0]-e[0]);a.push(d[1]-e[1]);a.push(d[2]-e[2]);b.push(f[0]);b.push(f[1]);b.push(f[2]);c.push(g);c.push(h)};return b});
definejs("Scene/ParametricModel/ParametricFloor","Core/defaultValue Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/Extent Math/AABB Math/MathUtils Math/Ellipsoid Math/Earcut Resource/ResourceState Scene/ParametricModel/ParametricHelper".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m){b=function(){this.id="";this.style=this.renderPatch=this.renderDevice=this.framework=null;this.geometry=[];this.propertise=null;this.visible=!0;this.renderCommand=null;this.extent=h.create();this.aabb=l.createInvalid();
this.centerPos=c.create();this.centerPosGeo=c.create();this._height=0};b.prototype.setVisible=function(a){this.visible=a};var q=c.create(),x=c.create(),p=c.create(),s=c.create(),r=c.create();b.prototype.setCenterPos=function(a,b,c){this.centerPos[0]=a;this.centerPos[1]=b;this.centerPos[2]=c};b.prototype.setHeight=function(a){this._height=a};c.create();b.prototype.initialize=function(a,b){this.framework=a;this.parentLayer=b;this.centerPosWorld=c.create();var d=this.framework._spatialReference;this.centerPosGeo[0]=
this.centerPos[0]*g.RADIANS_PER_DEGREE;this.centerPosGeo[1]=this.centerPos[1]*g.RADIANS_PER_DEGREE;this.centerPosGeo[2]=this.centerPos[2];d.transformGeographicsToWorld(this.centerPosWorld,this.centerPosGeo);var e=this._height,d=[],f=[],k=[],F=[],M=this.geometry.length,C=this.centerPosWorld,J=this.framework._spatialReference,O=0;h.makeInvalid(this.extent);for(var E=0;E<M;E++)for(var H=this.geometry[E],P=H.length,B=0;B<P;B++){var I=H[B],y=I.length;if(!(3>y)){J.cartesianToUp(p,x);for(var K=0;K<y;K++)h.mergePoint(this.extent,
this.extent,[I[K][0],I[K][1],0]),h.mergePoint(this.extent,this.extent,[I[K][0],I[K][1],e]),m.getPoint(J,q,I,K,e),l.mergePoint(this.aabb,this.aabb,[q[0]-C[0],q[1]-C[1],q[2]-C[2]-e]),l.mergePoint(this.aabb,this.aabb,[q[0]-C[0],q[1]-C[1],q[2]-C[2]])}}if(this.style){var G=m.getUVMatrix(this.aabb,this.style);l.getCenter(r,this.aabb);for(E=0;E<M;E++){for(var H=this.geometry[E],P=H.length,L=[],N=[],B=0;B<P;B++)if(I=H[B],y=I.length,O+=y,!(3>y))for(0<B&&N.push(L.length),J.cartesianToUp(p,x),K=0;K<y;K++)L.push(I[K]),
m.getPoint(J,q,I,K,e),m.getUV(q,C,r,G,s),m.pushTriStripPointXYZNormalTexture(d,f,k,q,C,p,s[0],s[1]);H=F;P=N;B=[];for(N=0;N<L.length;N++)B.push(L[N][0]),B.push(L[N][1]);0==P.length&&(P=void 0);L=n(B,P);for(N=0;N<L.length;N++)H.push(L[N])}e=this.style.texture;"ParametricColorStyle"===this.style.rtti&&(e=this.style.textureFloor);this.renderPatch=this.parentLayer.appendToRenderPatch({name:"floor_"+this.style.md5,type:"floor",styleType:this.style.rtti,style:this.style,extent:this.extent,aabb:this.aabb,
vertexPositionData:d,vertexNormalData:f,vertexTextureData:k,indexBufferData:F,verticesCount:O,primitiveCount:F.length/3,textures:[e,this.style.texture2]})}else console.log("Floor style ",this.style)};b.prototype.finalize=function(){this.style=null};b.prototype.addGeometry=function(a){this.geometry.push(a)};b.prototype.cull=function(a){};return b});
definejs("Scene/ParametricModel/ParametricBlock","Core/defaultValue Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/Extent Math/AABB Math/MathUtils Math/Earcut Resource/ResourceState Scene/ParametricModel/ParametricHelper".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){b=function(){this.id="";this.style=this.outlineRenderPatch=this.renderPatch=this.renderDevice=this.framework=null;this.geometry=[];this.propertise=null;this.visible=!0;this.renderCommand=null;this.extent=h.create();this.aabb=
l.createInvalid();this.centerPos=c.create();this.centerPosGeo=c.create();this._minHeight=this._maxHeight=0};b.prototype.setVisible=function(a){this.visible=a};var m=c.create(),q=c.create(),x=c.create(),p=c.create(),s=c.create();c.create();var r=c.create();c.create();b.prototype.setCenterPos=function(a,b,c){this.centerPos[0]=a;this.centerPos[1]=b;this.centerPos[2]=c};b.prototype.setMinHeight=function(a){this._minHeight=a};b.prototype.setMaxHeight=function(a){this._maxHeight=a};c.create();b.prototype.initialize=
function(a,b){this.framework=a;this.parentLayer=b;this.centerPosWorld=c.create();var d=this.framework._spatialReference;this.centerPosGeo[0]=this.centerPos[0]*g.RADIANS_PER_DEGREE;this.centerPosGeo[1]=this.centerPos[1]*g.RADIANS_PER_DEGREE;this.centerPosGeo[2]=this.centerPos[2];d.transformGeographicsToWorld(this.centerPosWorld,this.centerPosGeo);var d=this._minHeight,e=this._maxHeight,n=[],A=[],F=[],M=[],C=this.geometry.length,J=this.centerPosWorld,O=this.framework._spatialReference,E=0;h.makeInvalid(this.extent);
for(var H=0;H<C;H++){for(var P=this.geometry[H],B=P.length,I=[],y=[],K=0;K<B;K++){var G=P[K],L=G.length,N=0;if(!(3>L)){E+=L;O.cartesianToUp(s,q);y.push(L);for(var D=0;D<L;D++)I.push(G[D]),h.mergePoint(this.extent,this.extent,[G[D][0],G[D][1],d]),h.mergePoint(this.extent,this.extent,[G[D][0],G[D][1],e]),f.getPoint(O,q,G,D,e),f.pushTriStripPointXYZNormalTexture(n,A,F,q,J,s,0,0)}}for(K=0;K<B;K++)if(G=P[K],L=G.length,N=0,!(3>L))for(O.cartesianToUp(s,q),D=0;D<L;D++){var Q=D%L;f.getPoint(O,m,G,Q,e);f.getPoint(O,
x,G,Q,d);Q=(D+1)%L;f.getPoint(O,q,G,Q,e);f.getPoint(O,p,G,Q,d);c.sub(r,x,p);c.normalize(r,r);c.cross(r,r,s);f.pushTriStripPointXYZNormalTexture(n,A,F,m,J,r,N,0);f.pushTriStripPointXYZNormalTexture(n,A,F,x,J,r,N,1);f.pushTriStripPointXYZNormalTexture(n,A,F,q,J,r,N,0);f.pushTriStripPointXYZNormalTexture(n,A,F,p,J,r,N,1);l.mergePoint(this.aabb,this.aabb,[m[0]-J[0],m[1]-J[1],m[2]-J[2]]);l.mergePoint(this.aabb,this.aabb,[x[0]-J[0],x[1]-J[1],x[2]-J[2]])}P=M;B=E;L=[];for(K=0;K<I.length;K++)L.push(I[K][0]),
L.push(I[K][1]);K=void 0;I=y.length;if(1<I)for(K=[],N=0,G=1;G<I;G++)N+=y[G-1],K.push(N);G=k(L,K);for(K=0;K<G.length;K++)P.push(G[K]);for(G=L=0;G<I;G++){N=y[G];for(K=0;K<N;K++)L=4*K+B,P.push(L),P.push(L+2),P.push(L+1),P.push(L+1),P.push(L+2),P.push(L+3);B+=4*N}}this._totalPointCount=E;this.renderPatch=this.parentLayer.appendToRenderPatch({name:"block_"+this.style.md5,type:"shop",styleType:this.style.rtti,style:this.style,extent:this.extent,aabb:this.aabb,vertexPositionData:n,vertexNormalData:A,vertexTextureData:F,
indexBufferData:M,verticesCount:n.length/3,primitiveCount:M.length/3,textures:[this.style.texture,this.style.texture2]})};b.prototype.finalize=function(){this.style=null};b.prototype.addGeometry=function(a){this.geometry.push(a)};b.prototype.cull=function(a){};return b});
definejs("Scene/ParametricModel/ParametricWall","Core/defaultValue Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/Extent Math/AABB Math/MathUtils Math/Ellipsoid Math/Earcut Resource/ResourceState".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){function m(a,b,c,d,e){c=c[d];b[0]=c[0]*g.RADIANS_PER_DEGREE;b[1]=c[1]*g.RADIANS_PER_DEGREE;b[2]=e;a.transformGeographicsToWorld(b,b)}function q(a,b,d,e,f,g,h,m,p,k,l){c.mad(x,e,g,h);a.push(x[0]-f[0]);a.push(x[1]-f[1]);a.push(x[2]-f[2]);b.push(m[0]*
p);b.push(m[1]*p);b.push(m[2]*p);d.push(l);d.push(k)}b=function(){this.id="";this.style=this.renderPatch=this.renderDevice=this.framework=null;this.geometry=[];this.propertise=null;this.visible=!0;this.renderCommand=null;this.extent=h.create();this.aabb=l.createInvalid();this.centerPos=c.create();this.centerPosGeo=c.create();this._maxHeight=3;this._minHeight=0;this._thickness=0.2};b.prototype.setVisible=function(a){this.visible=a};var x=c.create();c.create();c.create();c.create();c.create();c.create();
var p=c.create(),s=c.create(),r=c.create();c.create();c.create();c.create();var z=c.create(),t=c.create();c.create();var w=c.create(),u=c.create(),v=c.create(),A=c.create(),F=c.create(),M=c.create(),C=0,J=0;b.prototype.generateIndexBufferData=function(a,b){for(var c=J=C=0;c<b-1;c++)C=12*c,J=6*(2*c+1),a.push(C),a.push(C+1),a.push(J),a.push(C+1),a.push(J+1),a.push(J);J=C=0;a.push(C+2);a.push(C+4);a.push(C+3);a.push(C+3);a.push(C+4);a.push(C+5);for(c=0;c<b-1;c++)C=12*c,J=6*(2*c+1),a.push(C+2),a.push(J+
4),a.push(C+4),a.push(C+2),a.push(J+2),a.push(J+4),a.push(C+3),a.push(C+5),a.push(J+5),a.push(C+3),a.push(J+5),a.push(J+3);C=J;a.push(C+2);a.push(C+3);a.push(C+4);a.push(C+3);a.push(C+5);a.push(C+4)};b.prototype.setCenterPos=function(a,b,c){this.centerPos[0]=a;this.centerPos[1]=b;this.centerPos[2]=c};b.prototype.setMinHeight=function(a){this._minHeight=a};b.prototype.setMaxHeight=function(a){this._maxHeight=a};b.prototype.setThickness=function(a){this._thickness=a};c.create();b.prototype.initialize=
function(a,b){this.framework=a;this.parentLayer=b;this.centerPosWorld=c.create();var d=this.framework._spatialReference;this.centerPosGeo[0]=this.centerPos[0]*g.RADIANS_PER_DEGREE;this.centerPosGeo[1]=this.centerPos[1]*g.RADIANS_PER_DEGREE;this.centerPosGeo[2]=this.centerPos[2];d.transformGeographicsToWorld(this.centerPosWorld,this.centerPosGeo);var d=this._minHeight,e=this._maxHeight,f=this.style,k=[],n=[],x=[],C=[],J=0.5*this._thickness,N=this.geometry.length,D=this.centerPosWorld,Q=this.framework._spatialReference,
X=0,$=0;h.makeInvalid(this.extent);for(var ga=0;ga<N;ga++){var V=this.geometry[ga],ha=V.length;if(1!=ha){if(2==ha){$+=ha;h.mergePoint(this.extent,this.extent,[V[0][0],V[0][1],d]);h.mergePoint(this.extent,this.extent,[V[0][0],V[0][1],e]);h.mergePoint(this.extent,this.extent,[V[1][0],V[1][1],d]);h.mergePoint(this.extent,this.extent,[V[1][0],V[1][1],e]);m(Q,p,V,0,e);m(Q,s,V,1,e);m(Q,z,V,0,d);m(Q,t,V,1,d);Q.cartesianToUp(M,p);c.sub(F,s,p);c.normalize(F,F);var fa=c.distance(s,p);c.cross(w,M,F);c.normalize(w,
w);var R=f.offsetU,T=f.offsetV,S=1*J,U=1,R=0.05;q(k,n,x,p,D,w,S,M,U,R,T);q(k,n,x,p,D,w,-S,M,U,R,T);q(k,n,x,p,D,w,S,w,U,R,T);q(k,n,x,p,D,w,-S,w,-U,R,T);R=1;q(k,n,x,z,D,w,S,w,U,R,T);q(k,n,x,z,D,w,-S,w,-U,R,T);X+=fa;R=0.05;T=0>=f.scaleV?f.offsetV+1:f.offsetV+X/f.scaleV;q(k,n,x,s,D,w,S,M,U,R,T);q(k,n,x,s,D,w,-S,M,U,R,T);q(k,n,x,s,D,w,S,w,U,R,T);q(k,n,x,s,D,w,-S,w,-U,R,T);R=1;q(k,n,x,t,D,w,S,w,U,R,T);q(k,n,x,t,D,w,-S,w,-U,R,T);l.mergePoint(this.aabb,this.aabb,[p[0]-D[0],p[1]-D[1],p[2]-D[2]]);l.mergePoint(this.aabb,
this.aabb,[z[0]-D[0],z[1]-D[1],z[2]-D[2]])}else{$+=ha;h.mergePoint(this.extent,this.extent,[V[0][0],V[0][1],d]);h.mergePoint(this.extent,this.extent,[V[0][0],V[0][1],e]);m(Q,p,V,0,e);m(Q,s,V,1,e);m(Q,z,V,0,d);Q.cartesianToUp(M,p);c.sub(F,s,p);c.normalize(F,F);c.cross(w,M,F);c.normalize(w,w);X=0;R=0.05;T=X;S=1*J;U=1;q(k,n,x,p,D,w,S,M,U,R,T);q(k,n,x,p,D,w,-S,M,U,R,T);q(k,n,x,p,D,w,S,w,U,R,T);q(k,n,x,p,D,w,-S,w,-U,R,T);R=1;q(k,n,x,z,D,w,S,w,U,R,T);q(k,n,x,z,D,w,-S,w,-U,R,T);for(var W=1;W<ha-1;W++)h.mergePoint(this.extent,
this.extent,[V[W][0],V[W][1],d]),h.mergePoint(this.extent,this.extent,[V[W][0],V[W][1],e]),m(Q,p,V,W-1,e),m(Q,s,V,W,e),m(Q,r,V,W+1,e),m(Q,t,V,W,d),Q.cartesianToUp(M,s),c.sub(u,p,s),c.normalize(u,u),c.cross(u,u,M),c.sub(v,s,r),c.normalize(v,v),c.cross(v,v,M),c.add(w,u,v),c.scale(w,w,0.5),c.normalize(w,w),c.sub(A,p,s),c.normalize(A,A),fa=c.dot(A,w),0>fa&&(fa=-fa),S=Math.acos(fa)<25*g.RADIANS_PER_DEGREE?1:1/Math.sin(Math.acos(fa)),c.sub(F,s,p),c.normalize(F,F),fa=c.distance(s,p),X+=fa,R=0.05,T=X,S*=
J,U=1,q(k,n,x,s,D,w,S,M,U,R,T),q(k,n,x,s,D,w,-S,M,U,R,T),q(k,n,x,s,D,w,S,u,U,R,T),q(k,n,x,s,D,w,-S,u,-U,R,T),R=1,q(k,n,x,t,D,w,S,u,U,R,T),q(k,n,x,t,D,w,-S,u,-U,R,T),R=0.05,q(k,n,x,s,D,w,S,M,U,R,T),q(k,n,x,s,D,w,-S,M,U,R,T),q(k,n,x,s,D,w,S,v,U,R,T),q(k,n,x,s,D,w,-S,v,-U,R,T),R=1,q(k,n,x,t,D,w,S,v,U,R,T),q(k,n,x,t,D,w,-S,v,-U,R,T),l.mergePoint(this.aabb,this.aabb,[p[0]-D[0],p[1]-D[1],p[2]-D[2]]),l.mergePoint(this.aabb,this.aabb,[z[0]-D[0],z[1]-D[1],z[2]-D[2]]);h.mergePoint(this.extent,this.extent,[V[ha-
1][0],V[ha-1][1],d]);h.mergePoint(this.extent,this.extent,[V[ha-1][0],V[ha-1][1],e]);m(Q,p,V,ha-2,e);m(Q,s,V,ha-1,e);m(Q,t,V,ha-1,d);Q.cartesianToUp(M,s);c.sub(F,s,p);c.normalize(F,F);fa=c.distance(s,p);X+=fa;c.cross(w,M,F);c.normalize(w,w);R=0.05;T=X;S=J;U=1;q(k,n,x,s,D,w,S,M,U,R,T);q(k,n,x,s,D,w,-S,M,U,R,T);q(k,n,x,s,D,w,S,w,U,R,T);q(k,n,x,s,D,w,-S,w,-U,R,T);R=1;q(k,n,x,t,D,w,S,w,U,R,T);q(k,n,x,t,D,w,-S,w,-U,R,T);l.mergePoint(this.aabb,this.aabb,[s[0]-D[0],s[1]-D[1],s[2]-D[2]]);l.mergePoint(this.aabb,
this.aabb,[t[0]-D[0],t[1]-D[1],t[2]-D[2]])}this.generateIndexBufferData(C,ha)}}this._totalLength=X;this._totalPointCount=$;0!==this._totalPointCount&&(this.renderPatch=this.parentLayer.appendToRenderPatch({name:"wall_"+this.style.md5,type:"wall",styleType:this.style.rtti,extent:this.extent,aabb:this.aabb,vertexPositionData:k,vertexNormalData:n,vertexTextureData:x,indexBufferData:C,verticesCount:k.length/3,primitiveCount:C.length/3,textures:[this.style.texture,this.style.texture2]}))};b.prototype.finalize=
function(){this.style=null};b.prototype.cull=function(a){};b.prototype.addGeometry=function(a){this.geometry.push(a)};return b});
definejs("Scene/ParametricModel/ParametricSymbol","Core/defaultValue Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/Extent Math/AABB Math/MathUtils Math/Ellipsoid Math/Earcut Resource/ResourceState Resource/ModelUtility Resource/Resource Resource/Model Scene/ParametricModel/ParametricHelper".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p){var s=m.ModelState;a=function(){this.id="";this.model=this.style=this.renderPatch=this.renderDevice=this.framework=null;this.geometry=[];this.propertise=
null;this.visible=!0;this.renderCommand=null;this.extent=h.create();this.aabb=l.createInvalid();this.centerPos=c.create();this.centerPosGeo=c.create();this.tileCenterWorld=c.create();this._height=0;this._localTransMatrix=d.create();this._transMat=d.create();this._mvMatrix=d.create();this._shadowCastMvMatrix=d.create();this._nodeCommands=[];this._nodeCommands2=[];this._nodeCommands3=[];this._text=""};a.prototype.setVisible=function(a){this.visible=a};a.prototype.setCenterPos=function(a,b,c){this.centerPos[0]=
a;this.centerPos[1]=b;this.centerPos[2]=c;this.centerPosGeo[0]=this.centerPos[0]*g.RADIANS_PER_DEGREE;this.centerPosGeo[1]=this.centerPos[1]*g.RADIANS_PER_DEGREE;this.centerPosGeo[2]=this.centerPos[2]};a.prototype.setRotation=function(a){this._rotation=a/180*Math.PI};a.prototype.getRotation=function(a){return this._rotation/Math.PI*180};a.prototype.setTranslation=function(a){this._translation=a};a.prototype.setScale=function(a){this._scale=a};a.prototype.setText=function(a){this._text=a};a.prototype.setUrl=
function(a){this._url=a};c.create();a.prototype.initialize=function(a,b){this.framework=a;this.parentLayer=b;this.centerPosWorld=c.create();this.framework._spatialReference.transformGeographicsToWorld(this.centerPosWorld,this.centerPosGeo);this.model=this.parentLayer.modelManager.getModel(this.style.modelUrl)};a.prototype.finalize=function(){this.style=null};a.prototype.addGeometry=function(a){this.geometry.push(a);this.centerPosGeo[0]=a[0]*g.RADIANS_PER_DEGREE;this.centerPosGeo[1]=a[1]*g.RADIANS_PER_DEGREE;
this.centerPosGeo[2]=0};var r=d.create(),z=d.create(),t=d.create();d.create();var w=c.create();a.prototype.renderForCastShadow=function(a){this._scaleBuilding=1;var b=1/Math.cos(this.centerPosGeo[1]);this.framework._spatialReference.transformGeographicsToWorld(this.tileCenterWorld,this.centerPosGeo);c.sub(w,this.tileCenterWorld,a._sceneCenterWorld);d.translate(t,this._translation[0],this._translation[1],this._translation[2]+a.heightOffset);d.scale(r,this._scale[0]*b,this._scale[1]*b,this._scale[2]*
b);d.rotateAxisZ(z,this._rotation);d.translate(this._transMat,w[0],w[1],w[2]);d.multiply(this._transMat,t,this._transMat);d.multiply(this._transMat,z,this._transMat);d.multiply(this._transMat,r,this._transMat);d.multiply(this._shadowCastMvMatrix,this._transMat,a._viewMatrix);for(var b=a.framework.renderDevice.effectManager.getEffect(0).getTechnique(53),e=a._renderContext.getShadowCastRenderQueue(),f=this._nodeCommands3.length,g=0;g<f;++g){var h=this._nodeCommands3[g];h.setTexture(0,a.framework._defaultTexture);
h._matrixUniforms[0]=this._shadowCastMvMatrix;h._matrixUniforms[1]=a._projectionMatrix;h._matrixUniforms[2]=this._transMat;h.viewDistance=500;h.setRenderTechnique(b);e.addRenderObject(h)}};a.prototype.renderForNormal=function(a){this._scaleBuilding=1;d.translate(t,this._translation[0],this._translation[1],this._translation[2]+a.heightOffset);d.scale(r,this._scale[0],this._scale[1],this._scale[2]*Math.cos(this.centerPosGeo[1]));d.rotateAxisZ(z,this._rotation);a.framework._spatialReference.matrixWorldToRender2(this._transMat,
this.centerPosGeo,a._camera._cameraParam.scaleFactor);d.makeIdentity(this._localTransMatrix);d.multiply(this._localTransMatrix,t,this._localTransMatrix);d.multiply(this._localTransMatrix,z,this._localTransMatrix);d.multiply(this._localTransMatrix,r,this._localTransMatrix);d.multiply(this._transMat,this._localTransMatrix,this._transMat);d.multiply(this._mvMatrix,this._transMat,a._viewProjectionMatrix);var b=a.alpha;if(1===b){for(var c=a._renderContext._renderQueues[0],e=this._nodeCommands.length,f=
0;f<e;++f){var g=this._nodeCommands[f];g._matrixUniforms[0]=this._mvMatrix;g._matrixUniforms[2]=this._localTransMatrix;g._vectorUniforms[0]=[1,1,1,1];c.addRenderObject(g)}c=a._renderContext._renderQueues[1];e=this._nodeCommands2.length;for(f=0;f<e;++f)g=this._nodeCommands2[f],g._matrixUniforms[0]=this._mvMatrix,g._matrixUniforms[2]=this._localTransMatrix,g._vectorUniforms[0]=[0,0,0,b],g.setRenderTechnique(a.framework.renderDevice.effectManager.getEffect(0).getTechnique(52)),c.addRenderObject(g)}else for(c=
a._renderContext._renderQueues[1],e=this._nodeCommands2.length,f=0;f<e;++f)g=this._nodeCommands2[f],g._matrixUniforms[0]=this._mvMatrix,g._matrixUniforms[2]=this._localTransMatrix,g._vectorUniforms[0]=[0,0,0,b],g.setRenderTechnique(a.framework.renderDevice.effectManager.getEffect(0).getTechnique(59)),c.addRenderObject(g)};a.prototype.cull=function(a){if(!a.isCullPoiOnly&&this.model&&(this.model.upload(a),this.model._state===s.LOADED)){if(0==this._nodeCommands.length){var c;c=this.model._nodeCommands;
for(var d=c.length,e=[],f=0;f<d;++f)e.push(c[f]);c=e;d=c.length;for(e=0;e<d;++e)f=c[e].shallowClone(),this._nodeCommands.push(f),f=c[e].shallowClone(),this._nodeCommands3.push(f)}if(0==this._nodeCommands2.length){c=this.model._nodeCommands2;d=c.length;e=[];for(f=0;f<d;++f)e.push(c[f]);c=e;d=c.length;for(e=0;e<d;++e)f=c[e].shallowClone(),this._nodeCommands2.push(f)}b(a._genShadowMapPass,!1)?"shop"===this.type?this.renderForCastShadow(a):"floor"!==this.type&&this.renderForCastShadow(a):"floor"!==this.type&&
this.renderForNormal(a)}};return a});
definejs("Scene/ParametricModel/ParametricAnno","Core/defaultValue Renderer/RenderQueue Math/Matrix4 Math/Vector3 Math/Rect Math/Extent Math/AABB Math/MathUtils Math/Ellipsoid Math/Earcut Resource/ResourceState Scene/ParametricModel/ParametricHelper".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m){b=function(){this.id="";this.style=this.renderPatch=this.renderDevice=this.framework=null;this.geometry=[];this.propertise=null;this.visible=!0;this.extent=h.create();this.aabb=l.createInvalid();this.centerPos=
c.create();this.centerPosGeo=c.create();this._text="";this._height=0.3};b.prototype.setVisible=function(a){this.visible=a};c.create();c.create();c.create();c.create();c.create();c.create();var q=c.create();c.create();c.create();c.create();c.create();c.create();c.create();c.create();c.create();c.create();c.create();c.create();c.create();c.create();c.create();var x=c.create(),p=c.create(),s=c.create(),r=d.create(),z=d.create(),t=d.create(),w=d.create(),u=0;b.prototype.generateIndexBufferData=function(a,
b){for(var c=u=0;c<b;c++)u=4*c,a.push(u),a.push(u+1),a.push(u+2),a.push(u+1),a.push(u+3),a.push(u+2)};b.prototype.setCenterPos=function(a,b,c){this.centerPos[0]=a;this.centerPos[1]=b;this.centerPos[2]=c};b.prototype.setRotation=function(a){this._rotation=a/180*Math.PI};b.prototype.getRotation=function(a){return this._rotation/Math.PI*180};b.prototype.setTranslation=function(a){this._translation=a};b.prototype.setScale=function(a){this._scale=a};b.prototype.setText=function(a){this._text=a};c.create();
b.prototype.initialize=function(a,b){this.framework=a;this.parentLayer=b;this.centerPosWorld=c.create();var e=this.framework._spatialReference;this.centerPosGeo[0]=this.centerPos[0]*g.RADIANS_PER_DEGREE;this.centerPosGeo[1]=this.centerPos[1]*g.RADIANS_PER_DEGREE;this.centerPosGeo[2]=this.centerPos[2];e.transformGeographicsToWorld(this.centerPosWorld,this.centerPosGeo);var e=this._text,f=this._height,k=this.style,n=[],u=[],E=[],H=[],P=this.centerPosWorld,B=this.framework._spatialReference,I=0;h.makeInvalid(this.extent);
var y=e.length,K=this.geometry[0];q[0]=K[0]*g.RADIANS_PER_DEGREE;q[1]=K[1]*g.RADIANS_PER_DEGREE;q[2]=f;B.transformGeographicsToWorld(q,q);B.cartesianToUp(x,q);var B=k.charWidth,K=k.charInterval,G=k.font,L=0.5*(y*B+(y-1)*K),k=0.5*k.charHeight;this.generateIndexBufferData(H,y);c.sub(p,q,P);d.rotateAxisZ(r,-this._rotation+0.5*Math.PI);d.translate(z,p[0],p[1],p[2]);d.translate(t,-p[0],-p[1],-p[2]);d.multiply(w,t,r);d.multiply(w,w,z);for(var N=0;N<y;N++){var D=G.getCharInfo(e[N],0,null),Q=q[0]-L+(N-1)*
K,X=[Q+N*B,q[1]-k,f],$=[Q+(N+1)*B,q[1]-k,f],ga=[Q+N*B,q[1]+k,f],Q=[Q+(N+1)*B,q[1]+k,f];c.sub(X,X,P);c.sub($,$,P);c.sub(ga,ga,P);c.sub(Q,Q,P);c.transformCoord(X,X,w);c.transformCoord($,$,w);c.transformCoord(ga,ga,w);c.transformCoord(Q,Q,w);m.pushTriStripPointXYZNormalTexture(n,u,E,X,s,x,D.texcoords_left,D.texcoords_bottom);m.pushTriStripPointXYZNormalTexture(n,u,E,$,s,x,D.texcoords_right,D.texcoords_bottom);m.pushTriStripPointXYZNormalTexture(n,u,E,ga,s,x,D.texcoords_left,D.texcoords_top);m.pushTriStripPointXYZNormalTexture(n,
u,E,Q,s,x,D.texcoords_right,D.texcoords_top);l.mergePoint(this.aabb,this.aabb,X);l.mergePoint(this.aabb,this.aabb,$);l.mergePoint(this.aabb,this.aabb,ga);l.mergePoint(this.aabb,this.aabb,Q);I+=4}this._totalPointCount=I;0!==this._totalPointCount&&(this.renderPatch=this.parentLayer.appendToRenderPatch({name:"anno_"+this.style.md5,type:"anno",styleType:this.style.rtti,extent:this.extent,aabb:this.aabb,vertexPositionData:n,vertexNormalData:u,vertexTextureData:E,indexBufferData:H,verticesCount:n.length/
3,primitiveCount:H.length/3,textures:[this.style.font.glyphTexture,this.style.texture2]}))};b.prototype.finalize=function(){this.style=null};b.prototype.cull=function(a){};b.prototype.addGeometry=function(a){this.geometry.push(a)};return b});
definejs("Scene/ParametricModel/ParametricModelParser","Core/defaultValue Core/defined Core/MD5 Math/Extent Math/MathUtils Math/Color Scene/ParametricModel/Style/ParametricTextureStyle Scene/ParametricModel/Style/ParametricColorStyle Scene/ParametricModel/Style/ParametricSymbolStyle Scene/ParametricModel/Style/ParametricAnnoStyle Scene/ParametricModel/ParametricFloor Scene/ParametricModel/ParametricBlock Scene/ParametricModel/ParametricWall Scene/ParametricModel/ParametricSymbol Scene/ParametricModel/ParametricAnno Scene/UserLayer/VectorDataSource Scene/ParametricModel/ParametricModelLayerTessellator".split(" "),function(b,
a,d,c,e,h,l,g,k,n,f,m,q,x,p,s,r){var z={parseStyle:function(a,c){if(c)for(var e=0,f=c.length;e<f;e++){var m=c[e],p=m.type;if("texture"===p){var p=new l,q=m.name;p.name=q;m=m.materials[0];p.imageUrl=a.basePath+m.imageUrl;p.scaleU=b(m.scaleU,1);p.scaleV=b(m.scaleV,1);p.offsetU=b(m.offsetU,0);p.offsetV=b(m.offsetV,0);p.rotation=b(m.rotation,0);p.md5=d.hex_md5(p.imageUrl);p.initialize(a.framework,a);a.styleManager.addStyle(q,p)}else"color"===p?(p=new g,q=m.name,m=m.materials[0],p.color=h.parseFromString(b(m.color,
"FFFFFF")),p.outColor=h.parseFromString(b(m.outColor,"FFFFFF")),p.md5=d.hex_md5(q),p.initialize(a.framework,a),a.styleManager.addStyle(q,p)):"symbol"===p?(p=new k,q=m.name,p.modelUrl=a.basePath+m.modelUrl,p.originSize=b(m.originSize,1,1,1),p.pivot=b(m.pivot,[0,0,0]),p.translate=b(m.translate,[0,0,0]),p.rotation=b(m.rotation,[0,0,0,1]),p.md5=d.hex_md5(p.modelUrl),p.initialize(a.framework,a),a.styleManager.addStyle(q,p)):"anno"===p?(p=new n,q=m.name,m=m.materials[0],p.charWidth=m.charWidth||1,p.charHeight=
m.charHeight||1,p.charInterval=m.charInterval||0,p.offsetU=m.offsetU||0,p.offsetV=m.offsetV||0,p.rotation=m.rotation||0,p.fontHeight=m.fontSize||48,p.md5=d.hex_md5(q),p.initialize(a.framework,a),a.styleManager.addStyle(q,p)):console.log("\u6570\u636e\u9519\u8bef:",m)}},parseVector3:function(b,c){if(!a(b))return c;var d=b.split(",");return 3!==d.length?c:[parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2])]},parseQuaternion4:function(b,c){if(!a(b))return c;var d=b.split(",");return 4!==d.length?c:[parseFloat(d[0]),
parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3])]},parseData:function(a,d){if(d){c.makeInvalid(a.extent);if(d.floor&&d.floor.features){var g=d.floor.features,h;for(h in g)for(var k=g[h],k=k.geometry.coordinates[0],l=0;l<k.length;l++)c.mergePoint(a.extent,a.extent,[k[l][0],k[l][1],0])}if(!c.isValidRect(a.extent)){if(d.wall&&d.wall.features)for(h in g=d.wall.features,g)for(k=g[h],k=k.geometry.coordinates,l=0;l<k.length;l++)c.mergePoint(a.extent,a.extent,[k[l][0],k[l][1],0]);if(d.block&&d.block.features)for(h in g=
d.block.features,g)for(k=g[h],k=k.geometry.coordinates[0],l=0;l<k.length;l++)c.mergePoint(a.extent,a.extent,[k[l][0],k[l][1],0]);if(d.symbol&&d.symbol.features)for(h in g=d.symbol.features,g)k=g[h],k=k.geometry.coordinates,c.mergePoint(a.extent,a.extent,[k[0],k[1],0]);if(d.anno&&d.anno.features)for(h in g=d.anno.features,g)k=g[h],k=k.geometry.coordinates,c.mergePoint(a.extent,a.extent,[k[0],k[1],0])}if(c.isValidRect(a.extent)){c.getCenter(a.centerPos,a.extent);a.centerPosGeo[0]=a.centerPos[0]*e.RADIANS_PER_DEGREE;
a.centerPosGeo[1]=a.centerPos[1]*e.RADIANS_PER_DEGREE;a.centerPosGeo[2]=a.centerPos[2];g=a.centerPos;if(d.floor&&d.floor.features){var n=d.floor.features;for(h in n){var k=n[h],r=k.properties,s=b(r.style,"default_color"),l=a.styleManager.getStyle(s);if(null!==l){var s=b(r.id,"floor_"+h),O=b(r.type,"floor"),E=parseFloat(r.height),r=new f;r.name=s;r.type=O;r.style=l;r.setCenterPos(g[0],g[1],0);r.addGeometry(k.geometry.coordinates);r.setHeight(E);r.initialize(a.framework,a);a.nodes.push(r)}}}if(d.wall&&
d.wall.features)for(h in n=d.wall.features,n)if(k=n[h],r=k.properties,s=b(r.style,"default_color"),l=a.styleManager.getStyle(s),null===l)console.log("featureId:"+h+" style null",k);else if(void 0===l)console.log("featureId:"+h+" styleName \u6ca1\u6709\u5bf9\u5e94\u503c:",s,k);else{var s=b(r.id,"wall_"+h),O=b(r.type,"shop"),E=b(r.min_height,0),H=b(r.max_height,0),P=parseFloat(b(r.thickness,r.width)),r=new q;r.name=s;r.type=O;r.style=l;r.setCenterPos(g[0],g[1],0);r.addGeometry(k.geometry.coordinates);
r.setThickness(P);r.setMinHeight(E);r.setMaxHeight(H);r.initialize(a.framework,a);a.nodes.push(r)}if(d.block&&d.block.features)for(h in n=d.block.features,n)k=n[h],r=k.properties,s=b(r.style,"default_color"),l=a.styleManager.getStyle(s),null!==l&&(s=b(r.id,"block_"+h),O=b(r.type,"shop"),E=b(r.min_height,0),H=b(r.max_height,0),r=new m,r.name=s,r.type=O,r.style=l,r.setCenterPos(g[0],g[1],0),r.addGeometry(k.geometry.coordinates),r.setMinHeight(E),r.setMaxHeight(H),r.initialize(a.framework,a),a.nodes.push(r));
if(d.symbol&&d.symbol.features)for(h in E=d.symbol.features,E)if(k=E[h],r=k.properties,s=b(r.style,""),l=a.styleManager.getStyle(s),null!==l){var s=b(r.id,"symbol_"+h),O=b(r.type,"symbol"),n=parseFloat(b(r.rotation,0)),B=z.parseVector3(r.scale,[1,1,1]),I=z.parseVector3(r.trans,[0,0,0]),r=new x;r.name=s;r.type=O;r.style=l;r.setCenterPos(g[0],g[1],0);r.setRotation(n);r.setTranslation(I);r.setScale(B);r.addGeometry(k.geometry.coordinates);r.initialize(a.framework,a);a.nodes.push(r)}if(d.anno&&d.anno.features)for(h in E=
d.anno.features,E)k=E[h],r=k.properties,s=b(r.style,""),l=a.styleManager.getStyle(s),null!==l&&(s=b(r.id,"anno_"+h),O=b(r.type,"anno"),n=parseFloat(b(r.rotation,0)),H=b(r.text,"anno"),r=new p,r.name=s,r.type=O,r.style=l,r.setText(H),r.setCenterPos(g[0],g[1],0),r.setRotation(n),r.setTranslation(I),r.setScale(B),r.addGeometry(k.geometry.coordinates),r.initialize(a.framework,a),a.nodes.push(r));a.isInited=!0}}}};return z});
definejs("Scene/ParametricModel/Patch/ParametricPatch","Core/defaultValue Math/Matrix4 Math/MathUtils Math/Vector3 Math/AABB Math/Extent Scene/Indoor/IndoorRSBuildingNode".split(" "),function(b,a,d,c,e,h,l){d=function(){this._renderCommand=this._framework=null;this._subsetArray=[];this._vertexPositionDataArray=[];this._vertexNormalDatarArray=[];this._vertexTextureCoordsDataArray=[];this._indexBufferData=[];this._extent=h.createInvalid();this._aabb=e.createInvalid()};d.prototype.initialize=function(b,
c){this._framework=b;this._primitive=c;this._parentLayer=c.parentLayer;this._centerPosGeo=this._parentLayer.centerPosGeo;this._scaleBuilding=Math.cos(this._centerPosGeo[1]);this._bufferPool=this._framework.meshAllocator;this._indexBuffer=this._textureCoordVertxBuffer2=this._textureCoordVertxBuffer=this._positionVertxBuffer=null;this._textures=[];this._primitiveCount=this._verticesCount=this._indicesOffset=this._verticesOffset=0;this._modelMatrix=a.create();this._mvMatrix=a.create();this._renderCommand=
null;this._unpackMatrix=a.create()};d.prototype.finalize=function(){var b=this._positionVertxBuffer;null!==b&&this._bufferPool.releaseBuffer(b);b=this._textureCoordVertxBuffer;null!==b&&this._bufferPool.releaseBuffer(b);b=this._textureCoordVertxBuffer2;null!==b&&this._bufferPool.releaseBuffer(b);b=this._indexBuffer;null!==b&&this._bufferPool.releaseBuffer(b);this._shadowCastRenderCommand=this._renderCommand=this._bufferPool=null;a.release(this._unpackMatrix);this._unpackMatrix=null};d.prototype.addSubset=
function(a){if(65535<this._verticesCount+a.verticesCount)return!1;this._subsetArray.push({name:a.name,extent:a.extent,verticesOffset:this._verticesOffset,indicesOffset:this._indicesOffset,verticesCount:a.verticesCount,primitiveCount:a.primitiveCount});e.combine(this._aabb,this._aabb,a.aabb);h.combine(this._extent,this._extent,a.extent);this._vertexPositionDataArray.push(a.vertexPositionData);this._vertexNormalDatarArray.push(a.vertexNormalData);this._vertexTextureCoordsDataArray.push(a.vertexTextureData);
for(var b=a.indexBufferData.length,c=0;c<b;c++)this._indexBufferData.push(a.indexBufferData[c]+this._verticesCount);this._verticesOffset+=a.vertexPositionData.length;this._indicesOffset+=a.indexBufferData.length;this._verticesCount+=a.verticesCount;this._primitiveCount+=a.primitiveCount;return!0};d.prototype.commitChange=function(){var a=[].concat.apply([],this._vertexPositionDataArray),b=[].concat.apply([],this._vertexNormalDatarArray),c=[].concat.apply([],this._vertexTextureCoordsDataArray),d=this._framework.renderDevice,
e=this._framework.renderDevice._gl;this._positionVertexBuffer=d.createVertexBuffer(a,3);this._normalVertexBuffer=d.createVertexBuffer(b,3);this._texcoordVertexBuffer=d.createVertexBuffer(c,2);this._indexBuffer=d.createIndexBuffer(this._indexBufferData,2);a=d.createRenderCommand();a.setStreamSource(0,this._positionVertexBuffer,0,12);a.setStreamSource(1,this._normalVertexBuffer,0,12);a.setStreamSource(2,this._texcoordVertexBuffer,0,8);a.setStreamSource(3,-1,0,0);a.setIndexBuffer(this._indexBuffer);
a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertexBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand=a;a=d.createRenderCommand();a.setStreamSource(0,this._positionVertexBuffer,0,12);a.setStreamSource(1,this._normalVertexBuffer,0,12);a.setStreamSource(2,this._texcoordVertexBuffer,0,8);a.setStreamSource(3,-1,0,0);a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertexBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand2=
a;d=d.createRenderCommand();d.setStreamSource(0,this._positionVertexBuffer,0,12);d.setStreamSource(1,this._normalVertexBuffer,0,12);d.setStreamSource(2,this._texcoordVertexBuffer,0,8);d.setStreamSource(3,-1,0,0);d.setIndexBuffer(this._indexBuffer);d.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertexBuffer.numItems,this._indexBuffer.numItems/3);this._rcCastShadow=d};d.prototype.drawSubset=function(a){};var g=a.create(),k=a.create(),n=a.create(),f=a.create();d.prototype.cull=function(a){a.isCullPoiOnly||
(b(a._genShadowMapPass,!1)?"shop"===this.type?this.renderForCastShadow(a):"floor"!==this.type&&this.renderForCastShadow(a):"floor"===this.type?this.renderFloorWithShadowMap(a):this.renderForNormal(a))};d.prototype.getFloorExtent=function(a){if("floor"===this.type)return h.combine(a,a,this._extent),!0};d.prototype.getBoundaryBox=function(a,b){var c=this._aabb._min,d=this._aabb._max;a[0]=Math.min(a[0],c[0]);a[1]=Math.min(a[1],c[1]);a[2]=Math.min(a[2],c[2]);b[0]=Math.max(b[0],d[0]);b[1]=Math.max(b[1],
d[1]);b[2]=Math.max(b[2],d[2]);return!0};d.prototype.renderForNormal=function(b){if(!this._primitive.texture||!0===this._primitive.texture.loaded)if(!this._primitive.texture2||!0===this._primitive.texture2.loaded){a.scale(n,this._scaleBuilding,this._scaleBuilding,this._scaleBuilding);a.translate(g,0,0,b.heightOffset);b.framework._spatialReference.matrixWorldToRender2(k,this._centerPosGeo,b._camera._cameraParam.scaleFactor);a.multiply(this._mvMatrix,this._modelMatrix,n);a.multiply(this._mvMatrix,this._mvMatrix,
g);a.multiply(this._mvMatrix,this._mvMatrix,k);a.multiply(this._mvMatrix,this._mvMatrix,b._viewProjectionMatrix);var c=b.alpha;if(1===c){var d=this._renderCommand;d.setTexture(0,this._primitive.texture);d.setTexture(1,this._primitive.texture2);d._matrixUniforms[0]=this._mvMatrix;d._matrixUniforms[1]=f;d._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];d._vectorUniforms[0]=[1,1,1,1];d.viewDistance=500;var e=b.framework.renderDevice.effectManager.getEffect(0).getTechnique(48);
d.setRenderTechnique(e);e=b._renderContext._renderQueues[0];e.addRenderObject(d)}if(1>c||this._isTransparency)e=[1,1,1,c],1>c&&(e=[0.3,0.3,0.3,c]),d=this._renderCommand,d.setTexture(0,this._primitive.texture),d.setTexture(1,this._primitive.texture2),d._matrixUniforms[0]=this._mvMatrix,d._matrixUniforms[1]=f,d._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1],d._vectorUniforms[0]=e,d.viewDistance=500,e=b.framework.renderDevice.effectManager.getEffect(0).getTechnique(48),
d.setRenderTechnique(e),e=b._renderContext._renderQueues[1],e.addRenderObject(d)}};d.prototype.renderFloorWithShadowMap=function(b){if(!0===this._primitive.texture.loaded&&null!==b.shadowCastTexture){a.scale(n,this._scaleBuilding,this._scaleBuilding,this._scaleBuilding);a.translate(g,0,0,b.heightOffset);b.framework._spatialReference.matrixWorldToRender2(k,this._centerPosGeo,b._camera._cameraParam.scaleFactor);a.multiply(this._mvMatrix,this._modelMatrix,n);a.multiply(this._mvMatrix,this._mvMatrix,
g);a.multiply(this._mvMatrix,this._mvMatrix,k);a.multiply(this._mvMatrix,this._mvMatrix,b._viewProjectionMatrix);var c=b.shadowCastTexture._boundaryBox,d=this._renderCommand;d.setTexture(0,this._primitive.texture);d.setTexture(1,b.shadowCastTexture);d._matrixUniforms[0]=this._mvMatrix;d._matrixUniforms[1]=f;d._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];d._vectorUniforms[0]=[1,1,0,0];d._vectorUniforms[1]=[c.minBoundary[0],
c.minBoundary[1],c.maxBoundary[0],c.maxBoundary[1]];d._vectorUniforms[2]=[1,1,1,1];d.viewDistance=500;var e=b.framework.renderDevice.effectManager.getEffect(0).getTechnique(42);d.setRenderTechnique(e);b._renderContext._renderQueues[1].addRenderObject(d);d=this._renderCommand2;d.setTexture(0,this._primitive.texture);d.setTexture(1,b.shadowCastTexture);d._matrixUniforms[0]=this._mvMatrix;d._matrixUniforms[1]=f;d._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/
255,1,127/255,127/255,127/255,1];d._vectorUniforms[0]=[1,1,0,0];d._vectorUniforms[1]=[c.minBoundary[0],c.minBoundary[1],c.maxBoundary[0],c.maxBoundary[1]];d._vectorUniforms[2]=[1,1,1,1];d.viewDistance=500;d.setRenderTechnique(e)}};d.prototype.renderForCastShadow=function(a){var b=this._rcCastShadow;b.setTexture(0,a.framework._defaultTexture);b._matrixUniforms[0]=a._viewMatrix;b._matrixUniforms[1]=a._projectionMatrix;b._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,
15/255,15/255,1,127/255,127/255,127/255,1];b.viewDistance=500;var c=a.framework.renderDevice.effectManager.getEffect(0).getTechnique(43);b.setRenderTechnique(c);a._renderContext.getShadowCastRenderQueue().addRenderObject(b)};d.prototype.isReady=function(){return null!==this._renderCommand};return d});
definejs("Scene/ParametricModel/Patch/ParametricColorPatch","Core/defaultValue Math/Matrix4 Math/MathUtils Math/Vector3 Math/AABB Math/Extent Scene/Indoor/IndoorRSBuildingNode".split(" "),function(b,a,d,c,e,h,l){d=function(){this._renderCommand=this._framework=null;this._subsetArray=[];this._vertexPositionDataArray=[];this._vertexNormalDatarArray=[];this._vertexTextureCoordsDataArray=[];this._indexBufferData=[];this._extent=h.createInvalid();this._aabb=e.createInvalid();this._color=[[1,1,1,1],[1,
0,0,1]];this._state=0};d.prototype.initialize=function(b,c){this._framework=b;this._primitive=c;this._parentLayer=c.parentLayer;this._centerPosGeo=this._parentLayer.centerPosGeo;this._scaleBuilding=Math.cos(this._centerPosGeo[1]);this._bufferPool=this._framework.meshAllocator;this._indexBuffer=this._textureCoordVertxBuffer2=this._textureCoordVertxBuffer=this._positionVertxBuffer=null;this._textures=[];this._primitiveCount=this._verticesCount=this._indicesOffset=this._verticesOffset=0;this._modelMatrix=
a.create();this._mvMatrix=a.create();this._renderCommand=null;this._unpackMatrix=a.create()};d.prototype.finalize=function(){var b=this._positionVertxBuffer;null!==b&&this._bufferPool.releaseBuffer(b);b=this._textureCoordVertxBuffer;null!==b&&this._bufferPool.releaseBuffer(b);b=this._textureCoordVertxBuffer2;null!==b&&this._bufferPool.releaseBuffer(b);b=this._indexBuffer;null!==b&&this._bufferPool.releaseBuffer(b);this._shadowCastRenderCommand=this._renderCommand=this._bufferPool=null;a.release(this._unpackMatrix);
this._unpackMatrix=null};d.prototype.addSubset=function(a){if(65535<this._verticesCount+a.verticesCount)return!1;if(a.style){this._subsetArray.push({name:a.name,extent:a.extent,verticesOffset:this._verticesOffset,indicesOffset:this._indicesOffset,verticesCount:a.verticesCount,primitiveCount:a.primitiveCount});e.combine(this._aabb,this._aabb,a.aabb);h.combine(this._extent,this._extent,a.extent);this._vertexPositionDataArray.push(a.vertexPositionData);this._vertexNormalDatarArray.push(a.vertexNormalData);
this._vertexTextureCoordsDataArray.push(a.vertexTextureData);for(var b=a.indexBufferData.length,c=0;c<b;c++)this._indexBufferData.push(a.indexBufferData[c]+this._verticesCount);this._verticesOffset+=a.vertexPositionData.length;this._indicesOffset+=a.indexBufferData.length;this._verticesCount+=a.verticesCount;this._primitiveCount+=a.primitiveCount;this._color[0]=a.style.color;return!0}console.log("Color Patch !thisObject.style")};d.prototype.commitChange=function(){var a=[].concat.apply([],this._vertexPositionDataArray),
b=[].concat.apply([],this._vertexNormalDatarArray),c=[].concat.apply([],this._vertexTextureCoordsDataArray),d=this._framework.renderDevice,e=this._framework.renderDevice._gl;this._positionVertexBuffer=d.createVertexBuffer(a,3);this._normalVertexBuffer=d.createVertexBuffer(b,3);this._texcoordVertexBuffer=d.createVertexBuffer(c,2);this._indexBuffer=d.createIndexBuffer(this._indexBufferData,2);a=d.createRenderCommand();a.setStreamSource(0,this._positionVertexBuffer,0,12);a.setStreamSource(1,this._normalVertexBuffer,
0,12);a.setStreamSource(2,this._texcoordVertexBuffer,0,8);a.setStreamSource(3,-1,0,0);a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertexBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand=a;a=d.createRenderCommand();a.setStreamSource(0,this._positionVertexBuffer,0,12);a.setStreamSource(1,this._normalVertexBuffer,0,12);a.setStreamSource(2,this._texcoordVertexBuffer,0,8);a.setStreamSource(3,-1,0,0);a.setIndexBuffer(this._indexBuffer);a.setRenderOperationIndex(e.TRIANGLES,
0,0,this._positionVertexBuffer.numItems,this._indexBuffer.numItems/3);this._renderCommand2=a;d=d.createRenderCommand();d.setStreamSource(0,this._positionVertexBuffer,0,12);d.setStreamSource(1,this._normalVertexBuffer,0,12);d.setStreamSource(2,this._texcoordVertexBuffer,0,8);d.setStreamSource(3,-1,0,0);d.setIndexBuffer(this._indexBuffer);d.setRenderOperationIndex(e.TRIANGLES,0,0,this._positionVertexBuffer.numItems,this._indexBuffer.numItems/3);this._rcCastShadow=d};d.prototype.drawSubset=function(a){};
var g=a.create(),k=a.create(),n=a.create(),f=a.create();d.prototype.cull=function(a){a.isCullPoiOnly||(b(a._genShadowMapPass,!1)?"shop"===this.type?this.renderForCastShadow(a):"floor"!==this.type&&this.renderForCastShadow(a):"floor"===this.type?this.renderFloorWithShadowMap(a):this.renderForNormal(a))};d.prototype.getFloorExtent=function(a){if("floor"===this.type)return h.combine(a,a,this._extent),!0};d.prototype.getBoundaryBox=function(a,b){var c=this._aabb._min,d=this._aabb._max;a[0]=Math.min(a[0],
c[0]);a[1]=Math.min(a[1],c[1]);a[2]=Math.min(a[2],c[2]);b[0]=Math.max(b[0],d[0]);b[1]=Math.max(b[1],d[1]);b[2]=Math.max(b[2],d[2]);return!0};d.prototype.renderForNormal=function(b){if(!this._primitive.texture||!0===this._primitive.texture.loaded)if(!this._primitive.texture2||!0===this._primitive.texture2.loaded){a.scale(n,this._scaleBuilding,this._scaleBuilding,this._scaleBuilding);a.translate(g,0,0,b.heightOffset);b.framework._spatialReference.matrixWorldToRender2(k,this._centerPosGeo,b._camera._cameraParam.scaleFactor);
a.multiply(this._mvMatrix,this._modelMatrix,n);a.multiply(this._mvMatrix,this._mvMatrix,g);a.multiply(this._mvMatrix,this._mvMatrix,k);a.multiply(this._mvMatrix,this._mvMatrix,b._viewProjectionMatrix);var c=b.alpha;if(1===c){var d=this._renderCommand;d.setTexture(0,this._primitive.texture);d._matrixUniforms[0]=this._mvMatrix;d._matrixUniforms[1]=f;d._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];d._vectorUniforms[0]=this._color[0];
d.viewDistance=500;var e=b.framework.renderDevice.effectManager.getEffect(0).getTechnique(41);d.setRenderTechnique(e);e=b._renderContext._renderQueues[0];e.addRenderObject(d)}1>c&&(d=this._renderCommand2,d.setTexture(0,this._primitive.texture),e=[0.3,0.3,0.3,1],d._matrixUniforms[0]=this._mvMatrix,d._matrixUniforms[1]=f,d._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1],d._vectorUniforms[0]=[e[0],e[1],e[2],e[3]*c],d.viewDistance=
500,e=b.framework.renderDevice.effectManager.getEffect(0).getTechnique(57),d.setRenderTechnique(e),e=b._renderContext._renderQueues[1],e.addRenderObject(d))}};d.prototype.renderFloorWithShadowMap=function(b){if(!0===this._primitive.texture.loaded&&null!==b.shadowCastTexture){a.scale(n,this._scaleBuilding,this._scaleBuilding,this._scaleBuilding);a.translate(g,0,0,b.heightOffset);b.framework._spatialReference.matrixWorldToRender2(k,this._centerPosGeo,b._camera._cameraParam.scaleFactor);a.multiply(this._mvMatrix,
this._modelMatrix,n);a.multiply(this._mvMatrix,this._mvMatrix,g);a.multiply(this._mvMatrix,this._mvMatrix,k);a.multiply(this._mvMatrix,this._mvMatrix,b._viewProjectionMatrix);var c=b.shadowCastTexture._boundaryBox,d=b.alpha;if(1===d){var e=this._renderCommand;e.setTexture(0,this._primitive.texture);e.setTexture(1,b.shadowCastTexture);e._matrixUniforms[0]=this._mvMatrix;e._matrixUniforms[1]=f;e._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/
255,127/255,1];e._vectorUniforms[0]=[1,1,0,0];e._vectorUniforms[1]=[c.minBoundary[0],c.minBoundary[1],c.maxBoundary[0],c.maxBoundary[1]];e._vectorUniforms[2]=this._color[0];e.viewDistance=500;var h=b.framework.renderDevice.effectManager.getEffect(0).getTechnique(42);e.setRenderTechnique(h);h=b._renderContext._renderQueues[0];h.addRenderObject(e)}1>d&&(h=[0.3,0.3,0.3,1],e=this._renderCommand2,e.setTexture(0,this._primitive.texture),e.setTexture(1,b.shadowCastTexture),e._matrixUniforms[0]=this._mvMatrix,
e._matrixUniforms[1]=f,e._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1],e._vectorUniforms[0]=[1,1,0,0],e._vectorUniforms[1]=[c.minBoundary[0],c.minBoundary[1],c.maxBoundary[0],c.maxBoundary[1]],e._vectorUniforms[2]=[h[0],h[1],h[2],h[3]*d],e.viewDistance=500,h=b.framework.renderDevice.effectManager.getEffect(0).getTechnique(58),e.setRenderTechnique(h),h=b._renderContext._renderQueues[1],h.addRenderObject(e))}};d.prototype.renderForCastShadow=
function(a){var b=this._rcCastShadow;b.setTexture(0,a.framework._defaultTexture);b._matrixUniforms[0]=a._viewMatrix;b._matrixUniforms[1]=a._projectionMatrix;b._matrixUniforms[2]=[180/255,180/255,180/255,1,193/255,193/255,193/255,1,15/255,15/255,15/255,1,127/255,127/255,127/255,1];b.viewDistance=500;var c=a.framework.renderDevice.effectManager.getEffect(0).getTechnique(43);b.setRenderTechnique(c);a._renderContext.getShadowCastRenderQueue().addRenderObject(b)};d.prototype.isReady=function(){return null!==
this._renderCommand};return d});
definejs("Scene/ParametricModel/ParametricPrimitive",["Framework/ConfigOptions","Scene/ParametricModel/Patch/ParametricPatch","Scene/ParametricModel/Patch/ParametricColorPatch"],function(b,a,d){function c(b){var c=null,c="ParametricTextureStyle"==b.styleType?new a:"ParametricAnnoStyle"==b.styleType?new a:new d;c.type=b.type;return c}b=function(){this.parentLayer=this.framework=null;this.rtti="ParametricPrimitive";this.type=this.name="";this.texture2=this.texture=null;this.renderPatchArray=[]};b.prototype.initialize=
function(a,b){this.framework=a;this.parentLayer=b};b.prototype.finalize=function(){};b.prototype.appendToRenderPatch=function(a){0==this.renderPatchArray.length&&(b=c(a),b.initialize(this.framework,this),this.renderPatchArray.push(b));var b=this.renderPatchArray[this.renderPatchArray.length-1];b.addSubset(a)||(b=c(a),b.initialize(this.framework,this),this.renderPatchArray.push(b),b.addSubset(a));return b};b.prototype.commitChange=function(){for(var a=this.renderPatchArray.length,b=0;b<a;b++)this.renderPatchArray[b].commitChange()};
b.prototype.cull=function(a){for(var b=this.renderPatchArray.length,c=0;c<b;c++)this.renderPatchArray[c].cull(a)};b.prototype.getFloorExtent=function(a){if("floor"===this.type){for(var b=this.renderPatchArray.length,c=0;c<b;c++)this.renderPatchArray[c].getFloorExtent(a);return!0}};b.prototype.getBoundaryBox=function(a,b){for(var c=this.renderPatchArray.length,d=0;d<c;d++)this.renderPatchArray[d].getBoundaryBox(a,b);return!0};return b});
definejs("Scene/ParametricModel/ParametricModelLayer","Core/defaultValue Core/PathDirectory Math/Extent Math/Vector3 Scene/ParametricModel/Style/ParametricStyleManager Scene/ParametricModel/ParametricModelManager Scene/ParametricModel/ParametricPrimitiveManager Scene/ParametricModel/ParametricModelParser Scene/ParametricModel/ParametricPrimitive Scene/UserLayer/VectorDataSource Scene/ParametricModel/ParametricModelLayerTessellator".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){function m(a,b){var e=
b.framework._shadowMapRender;d.makeInvalid(s);f.getFloorExtent(a.primitiveManager.primitiveArray,s,10);f.getBoundaryBox(a.primitiveManager.primitiveArray,p.minBoundary,p.maxBoundary,10);null===a.shadowCastTexture&&(a.shadowCastTexture=e.createShadowTexture());a.shadowCastTexture._boundaryBox={minBoundary:c.clone(c.create(),p.minBoundary),maxBoundary:c.clone(c.create(),p.maxBoundary)};var g=e.makeShadowCastCullArgs(b,s,p);f.tessellate(g,a.nodes);f.tessellate(g,a.primitiveManager.primitiveArray);e.beginScene(a.shadowCastTexture);
e.renderScene(g);e.endScene()}function q(a,b,c){b=new n(b,c.url);b.initialize(a);return b}b=function(){this.framework=null;this.nodes=[];this.extent=d.createInvalid();this.centerPos=c.create();this.centerPosGeo=c.create();this.visible=!0;this.labelStyle=null;this.styles=[];this.shadowCastTexture=null;this.isInited=this.isGenShadowMap=!1;this.modelManager=this.primitiveManager=this.styleManager=null;this.basePath="";this.heightOffset=0;this.reGenShadowMap=!1;this.minLevel=17;this.maxLevel=28;this.opacity=
1;this.faded=3};b.prototype.initialize=function(a){this.framework=a;this.styleManager=new e;this.styleManager.initialize(a);this.primitiveManager=new l;this.primitiveManager.initialize(a);this.modelManager=new h;this.modelManager.modelLayer=this;this.modelManager.initialize(a)};b.prototype.finalize=function(){this.styleManager&&(this.styleManager.finalize(),this.styleManager=null);this.primitiveManager&&(this.primitiveManager.finalize(),this.primitiveManager=null);this.modelManager&&(this.modelManager.finalize(),
this.modelManager=null);this.extent=this.framework=null};var x={minBoundary:[0,0,0],maxBoundary:[1,1,1]};b.prototype.cull=function(a){if(!a.isCullPoiOnly&&!1!==this.visible){var b=this.framework._isExplodedView,c=1;if(this.minLevel<=this.maxLevel){if(a._camera._zoomLevel<this.minLevel||a._camera._zoomLevel>this.maxLevel)return;b||(this.faded&1&&(b=a._camera._zoomLevel-this.minLevel,1>=b&&0<=b&&(c=b)),this.faded&2&&24>this.maxLevel&&(b=this.maxLevel-a._camera._zoomLevel,1>=b&&0<=b&&(c=b)))}c*=this.opacity;
if(0!==this.nodes.length){this.isUseShadowMap?this.isGenShadowMap&&(a.shadowCastTexture=this.shadowCastTexture):(a.shadowCastTexture=this.framework._defaultTexture,a.shadowCastTexture._boundaryBox=x);a.heightOffset=this.heightOffset;a.alpha=c;for(var c=this.nodes,b=0,d=c.length;b<d;b++)c[b].cull(a);c=this.primitiveManager.primitiveArray;b=0;for(d=c.length;b<d;b++)c[b].cull(a);!0===this.isGenShadowMap&&null===this.shadowCastTexture?(m(this,a),this.framework.forceRedraw()):!0===this.isGenShadowMap&&
!0===this.reGenShadowMap&&(m(this,a),this.framework.forceRedraw(),this.reGenShadowMap=!1)}}};var p={minBoundary:c.create(),maxBoundary:c.create()},s=new d;b.prototype.onModelCreated=function(){this.reGenShadowMap=!0};b.prototype.commitChange=function(){};b.prototype.setShadowMapType=function(a){0===a?this.isUseShadowMap=this.isGenShadowMap=!1:1===a?this.isUseShadowMap=this.isGenShadowMap=!0:2===a&&(this.isGenShadowMap=!1,this.isUseShadowMap=!0)};b.prototype.loadData=function(b){var c=this;b=b.split("?name=");
var d=b[0],e=b[1].split("&")[0];c.basePath=a.getDirPath(d);c.framework.getDataSourceManager().createDataSource({key:d,url:d},q).getData(function(a){if(a)try{var b=a.data;g.parseStyle(c,b.styles);g.parseData(c,b.data[e]);c.primitiveManager.commitChange();c.framework.forceRedraw()}catch(d){console.log(d)}})};b.prototype.setHeightOffset=function(a){this.heightOffset=a};b.prototype.setOpacity=function(a){this.opacity=a};b.prototype.appendToRenderPatch=function(a){var b=this.primitiveManager.getPrimitive(a.name);
b||(b=new k,b.texture=a.textures[0],1<a.textures.length&&(b.texture2=a.textures[1]),b.type=a.type,b.initialize(this.framework,this),this.primitiveManager.addPrimitive(a.name,b));return b.appendToRenderPatch(a)};return b});
definejs("Scene/Indoor/IndoorSceneSystem","Scene/Indoor/IndoorRSModelLayer Scene/Indoor/IndoorScene Scene/UserLayer/PoiLayer Scene/UserLayer/VectorLayer Scene/ParametricModel/ParametricModelLayer Math/MathUtils".split(" "),function(b,a,d,c,e,h){function l(a,b){for(var c=n.length=0;c<a._indoorScenes.length;c++){var d=a._indoorScenes[c];d.cull(b)&&n.push(d)}c=n.length;if(0===c)return null;1<c&&n.sort(function(a,b){a.distanceToCamera>b.distanceToCamera});return n[0]}var g=function(a,b){var c=[1,1,1,
1];if(void 0===a||6!=a.length)return c;for(var d=0;3>d;d++){var e=a.slice(2*d,2*d+2);c[d]=parseInt(e,16)/255}b&&(c[3]=b);return c},k=function(){this._indoorBuildingActiveCallback=this._framework=null};k.prototype.initialize=function(a){this._framework=a;this._userLayers=[];this._indoorScenes=[];this._nearestScene=null};k.prototype.finalize=function(){this._nearestScene=this._userLayers=this._framework=null};k.prototype.createIndoorScene=function(b,c,d,e){var g=new a;g.id=b;g.name=c;b=d.split(",");
c=g.extent;c._west=parseFloat(b[0])*h.RADIANS_PER_DEGREE;c._south=parseFloat(b[1])*h.RADIANS_PER_DEGREE;c._east=parseFloat(b[2])*h.RADIANS_PER_DEGREE;c._north=parseFloat(b[3])*h.RADIANS_PER_DEGREE;c._minHeight=0;c._maxHeight=400;this._framework._spatialReference.UpdateExtentCorner(c);g.initialize(c,e);this._indoorScenes.push(g);return g};k.prototype.removeIndoorScene=function(a){for(var b=0;b<this._indoorScenes.length;b++)this._indoorScenes[b].id===a&&this._indoorScenes.splice(b,1)};k.prototype.setIndoorSceneVisible=
function(a,b){for(var c=0;c<this._indoorScenes.length;c++)this._indoorScenes[c].id==a&&(this._indoorScenes[c].visible=b)};k.prototype.setOnIndoorBuildingActive=function(a){this._indoorBuildingActiveCallback=a};var n=[];k.prototype.cull=function(a){a=l(this,a);this._nearestScene!=a&&(this._nearestScene=a,this._indoorBuildingActiveCallback&&this._indoorBuildingActiveCallback(null===a?"":a.id))};k.prototype.createModelLayer=function(){var a=new b;this._userLayers.push(a);return a};k.prototype.createPoiLayer=
function(){var a=new d;this._userLayers.push(a);return a};k.prototype.createVectorLayer=function(){var a=new c;this._userLayers.push(a);return a};k.prototype.createParametricModelLayer=function(){var a=new e;this._userLayers.push(a);return a};k.prototype.getExtent=function(a){for(var c=0;c<this._userLayers.length;c++){var d=this._userLayers[c];d instanceof b&&!0===d.visible&&d.getExtent(a)}};k.prototype.getVectorObject=function(a){for(var b=0;b<this._userLayers.length;b++){var d=this._userLayers[b];
if(d instanceof c)for(var e=0;e<d.nodes.length;e++)if(d.nodes[e].name===a)return d.nodes[e]}return null};k.prototype.setVectorColor=function(a,b,c,d){a=this.getVectorObject(a);null!==a&&(a.color[0]=g(b,d),a.outlineColor[0]=g(c));return a};k.prototype.setObjectVisible=function(a){var b=a.parentID;a=a.childIndex;for(var c=0;c<this._userLayers.length;c++){var d=this._userLayers[c];if(d.id===b&&!(a>=d.nodes.length))for(var e=0;e<d.nodes.length;e++)d.nodes[e].visible=a!==e?!1:!0}this._framework.forceRedraw()};
k.prototype.setObjectVisibleEx=function(a,b){for(var c=0;c<this._userLayers.length;c++){var d=this._userLayers[c];d.id===a&&(d.visible=b)}this._framework.forceRedraw()};k.prototype.setObjectAttribute=function(a){var b=a.parentID,c=a.childIndex;a=a.visible;for(var d=0;d<this._userLayers.length;d++){var e=this._userLayers[d];if(e.id===b&&!(c>=e.nodes.length))for(var g=0;g<e.nodes.length;g++)e.nodes[g].visible=a}};k.prototype.getObjectAttribute=function(a,b){for(var c=0;c<this._userLayers.length;c++){var d=
this._userLayers[c];if(d.id===a&&"id"==b)return d.id}};k.prototype.deleteObject=function(a,b){};k.prototype.removeLayer=function(a){for(var b=0;b<thisObject._userLayers.length;b++)if(thisObject._userLayers[b].id==a){thisObject._userLayers.splice(b,1);break}};return k});
definejs("Resource/TextureManager",["Resource/Texture","Framework/ConfigOptions"],function(b,a){var d=function(){this.framework=null;this._textures={};this._textureResources={}};d.prototype.initialize=function(a){this.framework=a};d.prototype.finalize=function(){this.framework=null};d.prototype.createTexture=function(a,b,d,l){var g=this._textures,k=g[a];void 0===k&&(k=this.framework.renderDevice.createTexture(a,b,d,l),k.refCount=0,g[a]=k);k.refCount++;return k};d.prototype.createTextureEx=function(b,
d,h,l,g){var k=this._textures,n=k[b];-1==d.indexOf("base64")&&a.srcVersion&&(d+="?t="+(a.srcVersion||0));void 0===n&&(n=this.framework.renderDevice.createTexture(d,h,l,g),n.refCount=0,k[b]=n);n.refCount++;return n};d.prototype.createTextureFromImage=function(a,b,d,l){var g=this._textures,k=g[a];void 0===k&&(k=this.framework.renderDevice.createTextureFromImage(b,d,l),k.refCount=0,g[a]=k);k.refCount++;return k};d.prototype.releaseTexture=function(a){var b=this._textures[a];void 0!==b&&(b.refCount--,
0===b.refCount&&delete this._textures[a])};d.prototype.createTextureResource=function(a,d,h){d=this._textureResources;h=d[a];void 0===h&&(h=new b(this.framework),h.initialize("image",a,a),d[a]=h);h.refCount++;return h};d.prototype.releaseTextureResource=function(a){};return d});
definejs("Renderer/ShadowMapRender","Math/Extent Math/Vector3 Math/MathUtils Math/Matrix4 Math/Ellipsoid Resource/Downloader Resource/TileCache Resource/ResourceState Resource/TextureDataSource Scene/Indoor/IndoorRSModelNode Scene/Indoor/IndoorRSMesh Scene/Indoor/IndoorRSMeshManager Scene/Indoor/SpatialNode Scene/Indoor/IndoorRSModelLayerTessellator Framework/ConfigOptions Core/defaultValue".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p,s){var r=function(){this.framework=null;this._renderCommands=
[];this.bluredShadowCastTextureGL=this.bluredFramebuffer=this.framebuffer=null;this.shadowMapHeight=this.shadowMapWidth=1024;this.shadowMapPixelOffsetY=this.shadowMapPixelOffsetX=0};r.prototype.initialize=function(a){a=this.framework=a;var b=a.renderDevice._gl;this.framebuffer=a.renderDevice.createFramebuffer();this.bluredFramebuffer=a.renderDevice.createFramebuffer();this.bluredshadowCastTextureGL=b.createTexture();b.bindTexture(b.TEXTURE_2D,this.bluredshadowCastTextureGL);b.texImage2D(b.TEXTURE_2D,
0,b.RGBA,this.shadowMapWidth,this.shadowMapHeight,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindTexture(b.TEXTURE_2D,null);var c=this.framework;a=c.renderDevice._gl;for(var b=c.renderDevice,d=c.renderDevice.createRenderCommand(),c=Array(32),e=d=0;4>e;++e)for(var f=e/3,g=0;4>g;++g){var h=g/3;c[d++]=h;c[d++]=f}d=new Uint16Array(54);
for(g=f=e=0;3>g;++g){for(h=0;3>h;++h){var k=e,p=k+4,l=p+1,m=k+1;d[f++]=k;d[f++]=p;d[f++]=m;d[f++]=m;d[f++]=p;d[f++]=l;++e}++e}c=b.createVertexBuffer(c,2);e=b.createIndexBuffer(d,2);d=b.createRenderCommand();d.setStreamSource(0,c,0,0);d.setIndexBuffer(e);d.setRenderOperationIndex(a.TRIANGLES,0,0,c.numItems,e.numItems/3);d._vectorUniforms[0]=[10,0,0,0];d._vectorUniforms[1]=[this.shadowMapPixelOffsetX/this.shadowMapWidth,this.shadowMapPixelOffsetY/this.shadowMapHeight,this.shadowMapWidth,this.shadowMapHeight];
this.blurRenderCommand=d};r.prototype.finalize=function(){var a=this.framework.renderDevice;null!==this.bluredShadowCastTextureGL&&(a.releaseTexture(this.bluredShadowCastTextureGL),this.bluredShadowCastTextureGL=null)};var z=a.create();a.create();a.create();var t=a.create(),w=a.create();c.create();var u=[1,1,1,1];r.prototype.makeShadowCastCullArgsByPosition=function(b,d,e){var f={framework:b.framework,heightOffset:0,_frameState:b._frameState,_renderDevice:b.framework.renderDevice,_renderContext:b._renderContext,
_camera:b._camera,_viewMatrix:c.create(),_projectionMatrix:c.create(),_viewProjectionMatrix:c.create(),_updateQueue:b._updateQueue,_frame_counter:b._frame_counter,_genShadowMapPass:!0},g=e.minBoundary;e=e.maxBoundary;a.assign(w,d[0],d[1],0);b.framework._spatialReference.transformGeographicsToWorld(t,w);f._sceneCenterWorld=t;c.lookatRH(f._viewMatrix,[z[0],z[1],100],z,[0,1,0]);c.computeOrthographicOffCenter(g[0],e[0],g[1],e[1],0.1,2E3,f._projectionMatrix);return f};var v=a.create();r.prototype.makeShadowCastCullArgs=
function(b,c,e){a.assign(v,0.5*(c._west+c._east),0.5*(c._south+c._north),0);v[0]*=d.RADIANS_PER_DEGREE;v[1]*=d.RADIANS_PER_DEGREE;return r.prototype.makeShadowCastCullArgsByPosition(b,v,e)};r.prototype.createShadowTexture=function(){var a=this.framework.renderDevice._gl,b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.shadowMapWidth,this.shadowMapHeight,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);this.framebuffer.setColorTexture(b);this.framebuffer._bind();a.clearColor(u[0],u[1],u[2],u[3]);a.clear(16384);this.framebuffer._unBind();return b};r.prototype.beginScene=function(a){this.shadowCastTextureGL=a};r.prototype.endScene=function(){};r.prototype.renderScene=function(a){var b=this.framework.renderDevice,c=this.framework.renderDevice._gl;this.framebuffer.setColorTexture(this.shadowCastTextureGL);
this.framebuffer._bind();c.clearColor(u[0],u[1],u[2],u[3]);c.clear(16384);c.viewport(0,0,this.shadowMapWidth,this.shadowMapHeight);var d={};d.framework=a.framework;d._renderContext=a._renderContext;d._renderDevice=a._renderDevice;d._camera=a._camera;d._viewMatrix=a._viewMatrix;d._projectionMatrix=a._projectionMatrix;d._frame_counter=0;d._renderContext.renderShadowCast(d);this.framebuffer._unBind();this.bluredFramebuffer.setColorTexture(this.bluredshadowCastTextureGL);this.bluredFramebuffer._bind();
c.clearColor(u[0],u[1],u[2],u[3]);c.clear(16384);c.viewport(0,0,this.shadowMapWidth,this.shadowMapHeight);a=this.blurRenderCommand;d=b.effectManager.getEffect(0).getTechnique(39);a.setRenderTechnique(d);a.setTexture(0,this.shadowCastTextureGL);this.framework.renderDevice.render(a);this.bluredFramebuffer._unBind();this.bluredFramebuffer.setColorTexture(this.shadowCastTextureGL);this.bluredFramebuffer._bind();c.clearColor(u[0],u[1],u[2],u[3]);c.clear(16384);c.viewport(0,0,this.shadowMapWidth,this.shadowMapHeight);
a=this.blurRenderCommand;d=b.effectManager.getEffect(0).getTechnique(40);a.setRenderTechnique(d);a.setTexture(0,this.bluredshadowCastTextureGL);this.framework.renderDevice.render(a);this.bluredFramebuffer._unBind();this.bluredFramebuffer.setColorTexture(this.bluredshadowCastTextureGL);this.bluredFramebuffer._bind();c.clearColor(u[0],u[1],u[2],u[3]);c.clear(16384);c.viewport(0,0,this.shadowMapWidth,this.shadowMapHeight);a=this.blurRenderCommand;d=b.effectManager.getEffect(0).getTechnique(49);a.setRenderTechnique(d);
a.setTexture(0,this.shadowCastTextureGL);this.framework.renderDevice.render(a);this.bluredFramebuffer._unBind();this.bluredFramebuffer.setColorTexture(this.shadowCastTextureGL);this.bluredFramebuffer._bind();c.clearColor(u[0],u[1],u[2],u[3]);c.clear(16384);c.viewport(0,0,this.shadowMapWidth,this.shadowMapHeight);a=this.blurRenderCommand;d=b.effectManager.getEffect(0).getTechnique(50);a.setRenderTechnique(d);a.setTexture(0,this.bluredshadowCastTextureGL);this.framework.renderDevice.render(a);this.bluredFramebuffer._unBind()};
return r});
definejs("Renderer/GlowMapRender","Math/Extent Math/Vector3 Math/MathUtils Math/Matrix4 Math/Ellipsoid Resource/Downloader Resource/TileCache Resource/ResourceState Resource/TextureDataSource Scene/Indoor/IndoorRSModelNode Scene/Indoor/IndoorRSMesh Scene/Indoor/IndoorRSMeshManager Scene/Indoor/SpatialNode Scene/Indoor/IndoorRSModelLayerTessellator Framework/ConfigOptions Core/defaultValue".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p,s){b=function(){this.framework=null;this._renderCommands=[];
this.bluredShadowCastTextureGL=this.bluredFramebuffer=this.framebuffer=null;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMapPixelOffsetY=this.shadowMapPixelOffsetX=0};b.prototype.initialize=function(a){a=this.framework=a;var b=a.renderDevice._gl;this.framebuffer=a.renderDevice.createFramebuffer();this.bluredFramebuffer=a.renderDevice.createFramebuffer();this.bluredshadowCastTextureGL=b.createTexture();b.bindTexture(b.TEXTURE_2D,this.bluredshadowCastTextureGL);b.texImage2D(b.TEXTURE_2D,
0,b.RGBA,this.shadowMapWidth,this.shadowMapHeight,0,b.RGBA,b.UNSIGNED_BYTE,null);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE);b.bindTexture(b.TEXTURE_2D,null);var c=this.framework;a=c.renderDevice._gl;for(var b=c.renderDevice,d=c.renderDevice.createRenderCommand(),c=Array(32),e=d=0;4>e;++e)for(var f=e/3,g=0;4>g;++g){var h=g/3;c[d++]=h;c[d++]=f}d=new Uint16Array(54);
for(g=f=e=0;3>g;++g){for(h=0;3>h;++h){var k=e,p=k+4,l=p+1,m=k+1;d[f++]=k;d[f++]=p;d[f++]=m;d[f++]=m;d[f++]=p;d[f++]=l;++e}++e}c=b.createVertexBuffer(c,2);e=b.createIndexBuffer(d,2);d=b.createRenderCommand();d.setStreamSource(0,c,0,0);d.setIndexBuffer(e);d.setRenderOperationIndex(a.TRIANGLES,0,0,c.numItems,e.numItems/3);d._vectorUniforms[0]=[10,0,0,0];d._vectorUniforms[1]=[this.shadowMapPixelOffsetX/this.shadowMapWidth,this.shadowMapPixelOffsetY/this.shadowMapHeight,this.shadowMapWidth,this.shadowMapHeight];
this.blurRenderCommand=d};b.prototype.finalize=function(){var a=this.framework.renderDevice;null!==this.bluredShadowCastTextureGL&&(a.releaseTexture(this.bluredShadowCastTextureGL),this.bluredShadowCastTextureGL=null)};var r=a.create();a.create();a.create();var z=a.create(),t=a.create();c.create();var w=[0.1,0.1,0.1,1];b.prototype.makeShadowCastCullArgs=function(b,e,f){var g={framework:b.framework,_frameState:b._frameState,_renderDevice:b.framework.renderDevice,_renderContext:b._renderContext,_camera:b._camera,
_viewMatrix:c.create(),_projectionMatrix:c.create(),_viewProjectionMatrix:c.create(),_updateQueue:b._updateQueue,_frame_counter:b._frame_counter,_genShadowMapPass:!0},h=f.minBoundary;f=f.maxBoundary;a.assign(t,0.5*(e._west+e._east),0.5*(e._south+e._north),0);t[0]*=d.RADIANS_PER_DEGREE;t[1]*=d.RADIANS_PER_DEGREE;b.framework._spatialReference.transformGeographicsToWorld(z,t);g._sceneCenterWorld=z;c.lookatRH(g._viewMatrix,[0,0,100],r,[0,1,0]);c.computeOrthographicOffCenter(h[0],f[0],h[1],f[1],0.1,2E3,
g._projectionMatrix);return g};b.prototype.createGlowTexture=function(){var a=this.framework.renderDevice._gl,b=a.createTexture();a.bindTexture(a.TEXTURE_2D,b);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,this.shadowMapWidth,this.shadowMapHeight,0,a.RGBA,a.UNSIGNED_BYTE,null);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.bindTexture(a.TEXTURE_2D,null);this.framebuffer.setColorTexture(b);
this.framebuffer._bind();a.clearColor(w[0],w[1],w[2],w[3]);a.clear(16384);this.framebuffer._unBind();return b};b.prototype.beginScene=function(a){this.shadowCastTextureGL=a};b.prototype.endScene=function(){};b.prototype.renderScene=function(a){var b=this.framework.renderDevice,c=this.framework.renderDevice._gl;this.framebuffer.setColorTexture(this.shadowCastTextureGL);this.framebuffer._bind();c.clearColor(w[0],w[1],w[2],w[3]);c.clear(16384);c.viewport(0,0,this.shadowMapWidth,this.shadowMapHeight);
var d={};d.framework=a.framework;d._renderContext=a._renderContext;d._renderDevice=a._renderDevice;d._camera=a._camera;d._viewMatrix=a._viewMatrix;d._projectionMatrix=a._projectionMatrix;d._frame_counter=0;d._renderContext.renderGlowMap(d);this.framebuffer._unBind();this.bluredFramebuffer.setColorTexture(this.bluredshadowCastTextureGL);this.bluredFramebuffer._bind();c.clearColor(w[0],w[1],w[2],w[3]);c.clear(16384);c.viewport(0,0,this.shadowMapWidth,this.shadowMapHeight);a=this.blurRenderCommand;d=
b.effectManager.getEffect(0).getTechnique(39);a.setRenderTechnique(d);a.setTexture(0,this.shadowCastTextureGL);this.framework.renderDevice.render(a);this.bluredFramebuffer._unBind();this.bluredFramebuffer.setColorTexture(this.shadowCastTextureGL);this.bluredFramebuffer._bind();c.clearColor(w[0],w[1],w[2],w[3]);c.clear(16384);c.viewport(0,0,this.shadowMapWidth,this.shadowMapHeight);a=this.blurRenderCommand;d=b.effectManager.getEffect(0).getTechnique(40);a.setRenderTechnique(d);a.setTexture(0,this.bluredshadowCastTextureGL);
this.framework.renderDevice.render(a);this.bluredFramebuffer._unBind()};return b});
definejs("Math/SpatialReference",["Math/Matrix4","Math/MercatorCoords","Math/Plane","Math/Vector3","Math/MathUtils"],function(b,a,d,c,e){var h=function(){this._originPos=[0,0,0]};h.prototype.initialize=function(a){this._framework=a};h.prototype.finalize=function(){this._framework=void 0};h.prototype.matrixWorldToRender=function(a,c){var d=this._originPos;b.translate(a,c[0]-d[0],c[1]-d[1],c[2]-d[2])};h.prototype.transformRenderToWorld=function(a,b){c.add(a,b,this._originPos)};h.prototype.transformWorldToRender=
function(a,b){c.sub(a,b,this._originPos)};h.prototype.transformGeographicsToWorld=function(b,c){a.sphericalToMercator(b,c)};h.prototype.transformWorldToGeographics=function(b,c){a.mercatorToSpherical(b,c)};var l=c.create(),g=c.create(),k=b.create();h.prototype.transformLocalToGeographics=function(a,b,d){e.transformGeographicToECEF(l,[d[0],d[1],d[2]+6378137]);e.matrixENUToECEF(k,l);c.transformCoord(g,b,k);e.transformECEFToGeographic(a,g);a[2]-=6378137};h.prototype.transformGeographicsToLocal=function(a,
b,d){e.transformGeographicToECEF(l,[d[0],d[1],d[2]+6378137]);e.transformGeographicToECEF(g,[b[0],b[1],b[2]+6378137]);e.matrixECEFToENU(k,l);c.transformCoord(a,g,k)};h.prototype.setOriginPos=function(b){c.clone(this._originPos,b);a.sphericalToMercator(this._originPos,this._originPos)};h.prototype.getRenderPosition=function(a,b){c.sub(a,b,this._originPos)};h.prototype.getExtentWidthInWorld=function(a){return c.distance(a.cornerValue[0],a.cornerValue[2])};h.prototype.getExtentHeightInWorld=function(a){return c.distance(a.cornerValue[0],
a.cornerValue[4])};var n=c.create(),f=c.create();h.prototype.getDistanceInMeter=function(b,c){a.mercatorToSpherical(n,b);a.mercatorToSpherical(f,c);var d=6378137*e.getGeodeticCircleRadians(n[0],n[1],f[0],f[1]);isNaN(d)&&(d=0);return d};h.prototype.UpdateExtentCorner=function(b){b.cornerValue=Array(8);var d=b._north,e=b._south,f=b._east,g=b._west,h=b._minHeight,k=b._maxHeight,l=c.make(g,e,h);a.sphericalToMercator(l,l);b.cornerValue[0]=l;l=c.make(g,e,k);a.sphericalToMercator(l,l);b.cornerValue[1]=l;
l=c.make(f,e,h);a.sphericalToMercator(l,l);b.cornerValue[2]=l;l=c.make(f,e,k);a.sphericalToMercator(l,l);b.cornerValue[3]=l;l=c.make(g,d,h);a.sphericalToMercator(l,l);b.cornerValue[4]=l;l=c.make(g,d,k);a.sphericalToMercator(l,l);b.cornerValue[5]=l;l=c.make(f,d,h);a.sphericalToMercator(l,l);b.cornerValue[6]=l;l=c.make(f,d,k);a.sphericalToMercator(l,l);b.cornerValue[7]=l;b.radius=c.distance(b.cornerValue[7],b.cornerValue[0])*Math.cos(0.5*(e+d))};h.prototype.cartesianToUp=function(a,b){c.clone(a,c.UNIT_Z)};
h.prototype.FrustumIntersectExtent=function(a,b){for(var c=0;6>c;c++){for(var d=!1,e=0;8>e;e++){var f=a._planes[c],g=b.cornerValue[e];if(0>=g[0]*f[0]+g[1]*f[1]+g[2]*f[2]+f[3]){d=!0;break}}if(!d)return!1}return!0};var m=d.create();d.fromNormalDistance(m,c.UNIT_Z,0);h.prototype.intersectRay=function(a,b){return d.intersectRay(a,m,b)};return h});
definejs("Math/MapBoxSpatialReference",["Math/Matrix4","Math/MercatorCoords","Math/Plane","Math/Vector3","Math/MathUtils"],function(b,a,d,c,e){var h=function(){this._originPos=[0,0,0];this._viewProjectMatrix=b.create()};h.prototype.updateMatrix=function(a){b.copy(this._viewProjectMatrix,a.matrix)};h.prototype.initialize=function(a){this._framework=a};h.prototype.finalize=function(){this._framework=void 0};h.prototype.matrixWorldToRender=function(a,c){var d=this._originPos;b.translate(a,c[0]-d[0],
c[1]-d[1],c[2]-d[2])};var l=c.create();h.prototype.matrixWorldToRender2=function(c,d,e){a.radiansToMercator(l,d);b.translate(c,l[0],l[1],l[2]);b.scaleMatrix(c,c,e)};h.prototype.transformRenderToWorld=function(a,b){c.add(a,b,this._originPos)};h.prototype.transformWorldToRender=function(a,b){c.sub(a,b,this._originPos)};h.prototype.transformGeographicsToWorld=function(b,c){a.sphericalToMercator(b,c)};h.prototype.transformWorldToGeographics=function(b,c){a.mercatorToSpherical(b,c)};var g=c.create(),k=
c.create(),n=b.create();h.prototype.transformLocalToGeographics=function(a,b,d){e.transformGeographicToECEF(g,[d[0],d[1],d[2]+6378137]);e.matrixENUToECEF(n,g);c.transformCoord(k,b,n);e.transformECEFToGeographic(a,k);a[2]-=6378137};h.prototype.transformGeographicsToLocal=function(a,b,d){e.transformGeographicToECEF(g,[d[0],d[1],d[2]+6378137]);e.transformGeographicToECEF(k,[b[0],b[1],b[2]+6378137]);e.matrixECEFToENU(n,g);c.transformCoord(a,k,n)};h.prototype.setOriginPos=function(a){};h.prototype.getRenderPosition=
function(a,b){c.sub(a,b,this._originPos)};h.prototype.getRenderPositionBySpherical=function(b,c){a.radiansToMercator(b,c)};h.prototype.getExtentWidthInWorld=function(a){return c.distance(a.cornerValue[0],a.cornerValue[2])};h.prototype.getExtentHeightInWorld=function(a){return c.distance(a.cornerValue[0],a.cornerValue[4])};c.create();c.create();h.prototype.getDistanceInMeter=function(a,b){return c.distance(a,b)};h.prototype.UpdateExtentCorner=function(b){b.cornerValue=Array(8);var d=b._north,e=b._south,
f=b._east,g=b._west,h=b._minHeight,k=b._maxHeight,l=c.make(g,e,h);a.sphericalToMercator(l,l);b.cornerValue[0]=l;l=c.make(g,e,k);a.sphericalToMercator(l,l);b.cornerValue[1]=l;l=c.make(f,e,h);a.sphericalToMercator(l,l);b.cornerValue[2]=l;l=c.make(f,e,k);a.sphericalToMercator(l,l);b.cornerValue[3]=l;l=c.make(g,d,h);a.sphericalToMercator(l,l);b.cornerValue[4]=l;l=c.make(g,d,k);a.sphericalToMercator(l,l);b.cornerValue[5]=l;l=c.make(f,d,h);a.sphericalToMercator(l,l);b.cornerValue[6]=l;l=c.make(f,d,k);a.sphericalToMercator(l,
l);b.cornerValue[7]=l;b.radius=c.distance(b.cornerValue[7],b.cornerValue[0])*Math.cos(0.5*(e+d))};h.prototype.cartesianToUp=function(a,b){c.clone(a,c.UNIT_Z)};h.prototype.FrustumIntersectExtent=function(a,b){for(var c=0;6>c;c++){for(var d=!1,e=0;8>e;e++){var f=a._planes[c],g=b.cornerValue[e];if(0>=g[0]*f[0]+g[1]*f[1]+g[2]*f[2]+f[3]){d=!0;break}}if(!d)return!1}return!0};var f=d.create();d.fromNormalDistance(f,c.UNIT_Z,0);h.prototype.intersectRay=function(a,b){return d.intersectRay(a,f,b)};return h});
definejs("Renderer/CollisionManager",["Scene/UserLayer/PoiRenderQueue","Resource/Downloader","Framework/ConfigOptions","Math/Rect"],function(b,a,d,c){function e(a){a=new Blob([a],{type:"text/javascript"});a=URL.createObjectURL(a);return new Worker(a)}function h(a,b){if(typeof a!=typeof b)return!1;if("object"==typeof a){if(a.constructor!=b.constructor||JSON.stringify(a)!=JSON.stringify(b))return!1}else if(a!==b)return!1;return!0}var l=null,g=function(a){function b(a,c){return a.viewDistance-c.viewDistance}
var d={collisionList:[],visit:function(){d.collisionList.length=0;var e=a._framework._viewManager._views[0]._camera,g;for(g in a._collisionObjectMap){var h=a._collisionObjectMap[g];(9!=h.iconIndex||a._framework._panoVisible)&&h.calculateVisible(e)&&(h.updateRect(),h={id:h.id,name:h.text,viewDistance:h.viewDistance,rect:c.clone(h.wholeRenderRect),isVisible:!0},d.collisionList.push(h))}d.collisionList.sort(b)}};return d};b=function(){this._framework=null;this._options={};this._collisionList=[];this._collisionObjectMap=
{};this._updateQueue=[];this._callback=this._normalResult=this._hideResult=this._showResult=this._updateTimer=this._worker=null;this._step=0;this._collisionVisitor=null;l=this};b.prototype.initialize=function(b,c){var h=this;h._framework=b;h._options=c;h._collisionVisitor=g(h);h._step=1/Math.floor(c.animateDuration/16);d.useWorkerContent?h._worker=e(d.workerCollision.content):a.rawXHR(d.workerCollision.url,"GET",{},"application/javascript",!1,function(b){b=a.dataURItoBlob(b);b=URL.createObjectURL(b);
h._worker=new Worker(b)},function(a){console.log(a)});h._worker.onmessage=h._onMessage;h.resize();return!0};b.prototype.getStep=function(){return this._step};b.prototype._frameUpdate=function(){if(0!==l._updateQueue.length){var a=l._updateQueue.shift();k(l,a)}else l._stopFrameUpdate()};b.prototype._startFrameUpdate=function(){if(!this._updateTimer){this._frameUpdate();var a=Math.max(this._options.collisionDuration,this._options.animateDuration);this._updateTimer=window.setInterval(this._frameUpdate,
a)}};b.prototype._stopFrameUpdate=function(){this._updateTimer&&(clearInterval(this._updateTimer),delete this._updateTimer)};b.prototype._onMessage=function(a){a=a.data;var b=l;if("collisionResult"===a.type){var c=a.hideResult,d=a.showResult,e=a.normalResult;c||console.log("hideResult is undefined");var g=!1;b._hideResult&&h(b._hideResult.data,c)||(g=!0);b._showResult&&h(b._showResult.data,d)||(g=!0);b._normalResult&&h(b._normalResult.data,e)||(g=!0);b._hideResult={data:c,opacity:1};b._showResult=
{data:d,opacity:0};b._normalResult={data:e,opacity:1};b._callback&&b._callback(a,g)}"onPoiClick"===a.type&&b.clickPoiCallBack&&b.clickPoiCallBack(a.data)};b.prototype.setCallback=function(a){this._callback=a};b.prototype.getHideResult=function(){return this._hideResult};b.prototype.getShowResult=function(){return this._showResult};b.prototype.getNormalResult=function(){return this._normalResult};b.prototype.isNeedCollisionRender=function(){return this._hideResult||this._showResult};b.prototype.updateFadeResult=
function(){if(this._showResult&&(this._showResult.opacity+=this._step,1<=this._showResult.opacity)){for(var a in this._showResult.data)this._normalResult.data.push(this._showResult.data[a]);delete this._showResult}this._hideResult&&(this._hideResult.opacity-=this._step,0>=this._hideResult.opacity&&delete this._hideResult)};b.prototype.add=function(a){this._collisionObjectMap[a.id]=a};b.prototype.remove=function(a){this._collisionObjectMap.hasOwnProperty(a.id)&&delete this._collisionObjectMap[a.id]};
b.prototype.clear=function(a){this._collisionObjectMap={}};b.prototype.update=function(a){this._collisionVisitor.visit();this._collisionList=this._collisionVisitor.collisionList;a?(this._updateQueue.length=0,k(this,!0)):(0===this._updateQueue.length&&this._updateQueue.push(!1),this._startFrameUpdate())};var k=function(a,b){a._worker.postMessage({type:"collision",isForce:!0,view:{viewWidth:a._options.viewWidth,viewHeight:a._options.viewHeight},list:a._collisionList})};b.prototype.getPoiObject=function(a,
b,c){this._worker.postMessage({type:"click",clickPoint:{x:a,y:b}});this.clickPoiCallBack=c};b.prototype.destory=function(){this._worker.terminate();this.clear()};b.prototype.resize=function(a,b){this._options.viewWidth=this._framework._canvas.width;this._options.viewHeight=this._framework._canvas.height};b.prototype.getObject=function(a,b){var d=this._framework.getViewManager().getView(0)._camera;if(this._normalResult)for(var e in this._normalResult.data){var g=this._normalResult.data[e];if(this._collisionObjectMap.hasOwnProperty(g.id)&&
(g=this._collisionObjectMap[g.id],g.updatePosition(d),g.updateRect(),c.containPoint(g.wholeRenderRect,[a,b])))return g}return null};b.prototype.render=function(a){if(this._normalResult)for(var b in this._normalResult.data){var c=this._normalResult.data[b];this._collisionObjectMap.hasOwnProperty(c.id)&&(c=this._collisionObjectMap[c.id],c.updatePosition(a._camera),c.updateRect(),c.render(a,this._normalResult.opacity))}if(this._hideResult)for(b in this._hideResult.data)c=this._hideResult.data[b],this._collisionObjectMap.hasOwnProperty(c.id)&&
(c=this._collisionObjectMap[c.id],c.updatePosition(a._camera),c.updateRect(),c.render(a,this._hideResult.opacity));if(this._showResult)for(b in this._showResult.data)c=this._showResult.data[b],this._collisionObjectMap.hasOwnProperty(c.id)&&(c=this._collisionObjectMap[c.id],c.updatePosition(a._camera),c.updateRect(),c.render(a,this._showResult.opacity))};return b});
definejs("Resource/DataSourceManager",["Framework/ConfigOptions"],function(b){b=function(){this.framework=null;this._textures={};this._dataResources={}};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){this.framework=null};b.prototype.createDataSource=function(a,b){var c=this._dataResources,e=c[a.key];if(void 0===e){if(!b)return null;e=b(this.framework,this,a);c[a.key]=e}e.refCount++;return e};b.prototype.releaseDataSource=function(a){};return b});
definejs("Framework/Framework","Framework/AppState Renderer/RenderDevice Scene/SceneManager Renderer/ViewManager Controller/InteractionManager Resource/TileCacheManager Resource/UploadQueue Resource/MeshAllocator Resource/TextureAllocator Resource/DownloadController Math/Matrix4 Scene/Vector/VectorSystem Scene/Indoor/IndoorSceneSystem Resource/TextureManager Renderer/RenderFontManager Renderer/ShadowMapRender Renderer/GlowMapRender Framework/ConfigOptions Math/SpatialReference Math/MapBoxSpatialReference Renderer/CollisionManager Resource/DataSourceManager".split(" "),
function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p,s,r,z,t,w,u,v){var A=function(a){var b=[];b.remove=function(a){if(isNaN(a)||a>this.length)return!1;this.splice(a,1)};b.clear=function(){for(var a=0;a<b.length;a++)b[a].f&&b.remove(a)};__eventId=a;this._addEventHandler=function(a){if(a instanceof Function){for(var c=0;c<b.length;c++)if(b[c].f==a)return;b.push({o:null,f:a})}};this._removeEventHandler=function(a){for(var c=0;c<b.length;c++)b[c].f==a&&b.remove(c)};this._clearEventHandler=function(){b.clear()};this._notifyEvent=
function(a,c){for(var d=0;d<b.length;d++)b[d].f(a,c)};this.addEventHandler=function(a){this._addEventHandler(a)};this.removeEventHandler=function(a){this._removeEventHandler(a)};this.clearEventHandler=function(){this._clearEventHandler()};this.notifyEvent=function(a,b){this._notifyEvent(a,b)}};t=function(){this.uploadQueue=this.downloadController=this.textureAllocator=this.meshAllocator=this.tileCacheManager=this.renderDevice=this._interactionManager=this._viewManager=this._sceneManager=null;this._isNewDataReady=
!1;this._matrixStack32=this._canvas=this._dataSourceManager=this._renderArgs=null;this._forceRedraw=!1;this._indoorSceneSystem=this._rsLayerManager=this._recceLayerManager=this._fontManager=this._textureManager=this._vectorSystem=this.textureUploadController=this._surfaceCanvas=null;this._isNeedUpdateCollision=!1;this._collisionManager=null;this._isExplodedView=this._panoVisible=!1;this.reRenderEvent=new A("reRenderEvent")};t.prototype.initialize=function(t,z,A){this._canvas=t;this._surfaceCanvas=
z;this.glContext=A;this.renderDevice=new a;this.renderDevice.initialize(this);this._sceneManager=new d;this._sceneManager.initialize(this);this._viewManager=new c;this._viewManager.initialize(this);this._interactionManager=new e;this._interactionManager.initialize(this);this.tileCacheManager=new h;this.tileCacheManager.initialize(this);this.meshAllocator=new g;this.meshAllocator.initialize(this);this.textureAllocator=new k;this.textureAllocator.initialize(this);this.uploadQueue=new l;this.uploadQueue.initialize(this);
this.downloadController=new n;this.downloadController.initialize(this);this._matrixStack32=f.makeMatrixStack(Float32Array);this.frameState=b.frame_states;this._vectorSystem=new m;this._vectorSystem.initialize(this);this._indoorSceneSystem=new q;this._indoorSceneSystem.initialize(this);this._textureManager=new x;this._textureManager.initialize(this);this._fontManager=new p;this._fontManager.initialize(this);this._spatialReference=new w;this._spatialReference.initialize(this);this._shadowMapRender=
new s;this._shadowMapRender.initialize(this);this._glowMapRender=new r;this._glowMapRender.initialize(this);this._collisionManager=new u;this._collisionManager.initialize(this,{viewWidth:1080,viewHeight:1920,animateDuration:300,collisionDuration:600});this._collisionManager.setCallback(this.onCollisionChanged);this._defaultTexture=this.renderDevice.createSolidTexture([255,255,255,255]);this._dataSourceManager=new v;this._dataSourceManager.initialize(this)};t.prototype.setPanoVisible=function(a){this._panoVisible=
a;this.updateCollision()};t.prototype.finalize=function(){this.tileCacheManager.finalize();this.tileCacheManager=null;this._interactionManager.finalize();this._interactionManager=null;this._viewManager.finalize();this._viewManager=null;this._sceneManager.finalize();this._sceneManager=null;this.renderDevice.releaseTexture(this._defaultTexture);this.renderDevice.finalize();this.renderDevice=null;this.meshAllocator.finalize();this.meshAllocator=null;this.textureAllocator.finalize();this.textureAllocator=
null;this.downloadController.finalize();this.downloadController=null;this._vectorSystem.finalize();this._vectorSystem=null;this._indoorSceneSystem.finalize();this._indoorSceneSystem=null;this._textureManager.finalize();this._textureManager=null;this._fontManager.finalize();this._fontManager=null;this._shadowMapRender.finalize();this._shadowMapRender=null;this._glowMapRender.finalize();this._rsLayerManager=this._recceLayerManager=this._glowMapRender=null;this._dataSourceManager.finalize();this._matrixStack32=
this._dataSourceManager=null;this._forceRedraw=!1;this._frameState=null;this.renderDevice.releaseTexture(this._defaultTexture);this._defaultTexture=null};t.prototype.updateCanvas=function(a,b){var c=this._canvas,d,e;e=getComputedStyle(c.parentNode);d=a||c.parentNode.clientWidth||parseInt(e.width);e=b||c.parentNode.clientHeight||parseInt(e.height);if(!d||!e){if(c.width&&c.height)return;d=window.innerWidth;e=window.innerHeight}c.width=d*z.devicePixelRatio;c.height=e*z.devicePixelRatio;c.style.width=
d+"px";c.style.height=e+"px"};t.prototype.onResize=function(a,b){this.updateCanvas(a,b);var c=this._interactionManager;null!=c&&(c=c.getCameraController(),null!=c&&(c.onResize(),this._viewManager.onResize(),this.renderDevice.onResize(),this._collisionManager.resize(a,b),this._forceRedraw=!0))};t.prototype.onLostDevice=function(){this.renderDevice.onLostDevice()};t.prototype.onResetDevice=function(){this.renderDevice.onResetDevice()};t.prototype.getRenderDevice=function(){return this.renderDevice};
t.prototype.getSceneManager=function(){return this._sceneManager};t.prototype.getViewManager=function(){return this._viewManager};t.prototype.getInteractionManager=function(){return this._interactionManager};t.prototype.getTileCacheManager=function(){return this.tileCacheManager};t.prototype.getMeshUploadController=function(){return this.meshAllocator};t.prototype.getTextureUploadController=function(){return this.textureUploadController};t.prototype.getDownloadController=function(){return this.downloadController};
t.prototype.getDataSourceManager=function(){return this._dataSourceManager};t.prototype.getVectorSystem=function(){return this._vectorSystem};t.prototype.getTextureManager=function(){return this._textureManager};t.prototype.getFontManager=function(){return this._fontManager};t.prototype.getIndoorSceneSystem=function(){return this._indoorSceneSystem};t.prototype.getCollisionManager=function(){return this._collisionManager};t.prototype.setNewDataReady=function(a){this._isNewDataReady=a};t.prototype.isNewDataReady=
function(){return this._isNewDataReady};t.prototype.beginRender=function(){return null===this._interactionManager?!1:this._interactionManager.beginUpdate()};t.prototype.endRender=function(){this._isNeedUpdateCollision=!1;return null===this._interactionManager?!1:this._interactionManager.endUpdate()};t.prototype.renderTimer=null;t.prototype.render=function(a){var b=this.frameState,c=this.uploadQueue,d=this.meshAllocator,e=this.textureAllocator;if(a||this._isNewDataReady||this._forceRedraw)d.beginFrame(),
e.beginFrame(),c.clear(),this._viewManager.cull(!1),this._viewManager.render(),this._fontManager.flush(),c.sort();this._isNewDataReady=this._forceRedraw=!1;c.execute(b.frame_start_tick,b.frame_timer)};var F=!0;t.prototype.renderFrame=function(a){a=this._canvas;var b,c=getComputedStyle(a.parentNode);b=a.clientWidth||a.parentNode.clientWidth||parseInt(c.width);a=a.clientHeight||a.parentNode.clientHeight||parseInt(c.height);b&&a&&(b=this.frameState,b.frame_start_tick=Date.now(),b.triangles_per_frame=
0,b.mesh_per_frame=0,b.texels_per_frame=0,b.textures_per_frame=0,b.frame_counter++,a=(b=this.beginRender())||F||this._forceRedraw,b&&F&&(F=!1),this.render(a),this.endRender())};t.prototype.firstLoaded=function(){F=!1};t.prototype.renderInfo=function(){var a=this._2dCanvas.getContext("2d");a.font="1em sans-serif";a.fillStyle="rgb(255,0,0)";a.fillText("xxxxxxx",10,10)};t.prototype.forceRedraw=function(a){this._forceRedraw=!0;a&&this.updateCollision(!0);var b=this;this.forceRenderTimer&&clearTimeout(this.forceRenderTimer);
this.forceRenderTimer=setTimeout(function(){b._forceRedraw=!0;b.reRenderEvent.notifyEvent(!0)},500)};t.prototype.updateCollision=function(a){this._isNeedUpdateCollision=!0};t.prototype.onCollisionChanged=function(a,b){this._framework.forceRedraw(b)};t.prototype.setOriginPos=function(a){this._spatialReference.setOriginPos(a);a=this._interactionManager.getCameraController();null!=a&&a.applyCamera()};t.prototype.setOnIndoorBuildingActive=function(a){this._indoorSceneSystem&&this._indoorSceneSystem.setOnIndoorBuildingActive(a)};
t.prototype.setExplodedView=function(a){this._isExplodedView=a};return t});
definejs("Scene/Camera","Math/Vector3 Math/Vector2 Math/Matrix4 Math/Frustum Math/Quaternion Math/Ellipsoid Framework/Framework Renderer/View Math/MathUtils Math/Ray Math/Sphere".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){a=function(){this._viewProjectionMatrix=this._projectionMatrix=this._viewMatrix=this._frustum=this._orientation=this._aimGeographic=this._aim=this._positionGeographic=this._position=this._view=this.framework=null;this._viewportHeight=this._viewportWidth=1;this._headingTiltRoll=null;
this._viewLevel=0};a.prototype.initialize=function(a){this.framework=a;this._position=b.create();this._positionGeographic=b.create();this._aim=b.create();this._aimGeographic=b.create();this._orientation=e.create();this._headingTiltRoll=b.create();this._viewMatrix=d.create();this._frustum=new c;this._projectionMatrix=this._frustum._projectionMatrix;this._viewProjectionMatrix=d.create();this.onResize();a=this.framework._canvas.width;var f=this.framework._canvas.height;this._viewportWidth=a;this._viewportHeight=
f;this._frustum.setAspect(a/f);this._frustum.setNear(0.1);this._frustum.setFar(100);this._frustum.setFovy(0.6435011087932844);this.transform=d.create()};a.prototype.setView=function(a){this._view=a};var m=b.create(),q=b.create(),x=b.create(),p=b.create();e.create();e.create();var s=e.create(),r=b.create();b.create();b.create();e.create();a.prototype.apply=function(){e.multiplyVector3(m,this._orientation,[1,0,0]);e.multiplyVector3(q,this._orientation,[0,1,0]);e.multiplyVector3(x,this._orientation,
[0,0,1]);b.normalize(m,m);b.normalize(q,q);b.normalize(x,x);this._viewMatrix[0]=m[0];this._viewMatrix[1]=q[0];this._viewMatrix[2]=x[0];this._viewMatrix[3]=0;this._viewMatrix[4]=m[1];this._viewMatrix[5]=q[1];this._viewMatrix[6]=x[1];this._viewMatrix[7]=0;this._viewMatrix[8]=m[2];this._viewMatrix[9]=q[2];this._viewMatrix[10]=x[2];this._viewMatrix[11]=0;this._viewMatrix[12]=-b.dot(m,this._position);this._viewMatrix[13]=-b.dot(q,this._position);this._viewMatrix[14]=-b.dot(x,this._position);this._viewMatrix[15]=
1;var a=b.length(this._position),c=h.Radius,f=0.1*(a-c),g=Math.sqrt(a*a-c*c);1500>a-c&&(f=g/2E4);this._frustum.setNear(f);this._frustum.setFar(g);this._frustum.update(this._viewMatrix);k.transformECEFToGeographic(this._positionGeographic,this._position);d.multiply(this._viewProjectionMatrix,this._viewMatrix,this._projectionMatrix);this.getAim();a=this._orientation;c=this._headingTiltRoll;k.matrixENUToECEF(p,this._position);e.fromMatrix(s,p);e.inverse(s,s);e.multiply(s,s,a);d.fromQuaternion(p,s);d.toEulerAnglesZXY(r,
p);c[0]=k.toDegree(r[0]);c[1]=k.toDegree(r[1])};var z=b.create(),t=b.create(),w=b.create();a.prototype.getPickRay=function(a,c){var d=this.framework._canvas.width,e=this.framework._canvas.height,f=Math.tan(0.5*this._frustum._fovy),g=this._frustum._aspect*f,h=this._frustum._near,d=2/d*a[0]-1,e=2/e*(e-a[1])-1;b.clone(c._orig,this._position);var k=this.getRight(),l=this.getUp(),p=this.getDirection();b.scale(z,p,h);b.add(z,this._position,z);b.scale(t,k,d*h*g);b.scale(w,l,e*h*f);b.add(c._dir,z,t);b.add(c._dir,
c._dir,w);b.sub(c._dir,c._dir,this._position);b.normalize(c._dir,c._dir);return c};var u=b.create();a.prototype.getRight=function(){e.multiplyVector3(u,this._orientation,[1,0,0]);return u};var v=b.create();a.prototype.getUp=function(){e.multiplyVector3(v,this._orientation,[0,1,0]);return v};var A=b.create();a.prototype.getDirection=function(){e.multiplyVector3(A,this._orientation,[0,0,-1]);return A};var F=d.create();a.prototype.getInverseTransform=function(){d.inverse(F,this.transform);return F};
a.prototype.finalize=function(){this._frustum=this._scene=this.framework=null;b.release(this._position);e.release(this._orientation);d.release(this._viewMatrix)};a.prototype.onResize=function(){var a=this.framework._canvas.width,b=this.framework._canvas.height;this._viewportWidth=a;this._viewportHeight=b;this._frustum.setAspect(a/b)};var M=b.create(),C=b.create(),J=b.create(),O=n.create(),E=f.make([0,0,0],h.Radius);b.create();var H=b.create();a.prototype.screenToGeo=function(a,b){this.getPickRay([a,
b],O);return 0<k.RayIntersectSphere(H,O,E)?(k.transformECEFToGeographic(H,H),H[0]=k.toDegree(H[0]),H[1]=k.toDegree(H[1]),H[2]-=h.Radius,H):null};b.create();var P=b.create(),B=b.create(),I=b.create();a.prototype.getAim=function(){var a=this.getDirection();b.scale(M,this._position,-1);b.normalize(C,M);var c=Math.acos(b.dot(C,a));if(c>Math.PI)this._aimGeographic=this._positionGeographic,this._aimGeographic[2]=20+h.Radius,k.transformGeographicToECEF(this._aim,this._aimGeographic);else{if(c<0.25*Math.PI)c=
Math.cos(c),c=(b.length(this._position)-20-h.Radius)/c,b.mad(this._aim,this._position,a,c);else{a=b.dot(this.getUp(),C);b.clone(P,this._frustum.nearCenter);0>a?(b.clone(B,this._frustum.negativeY),a=[0,0,0],b.sub(a,P,B),b.scale(a,a,1/3),b.add(a,B,a)):(b.clone(I,this._frustum.positiveY),a=[0,0,0],b.sub(a,P,I),b.scale(a,a,1/3),b.add(a,I,a));b.sub(a,a,P);b.scale(a,a,(c-0.25*Math.PI)/(0.25*Math.PI));b.sub(J,P,a);b.sub(J,J,this._position);b.normalize(J,J);var c=b.dot(J,this._position),a=b.length(this._position),
d=20+h.Radius,a=Math.sqrt(d*d-a*a+c*c);b.mad(this._aim,this._position,J,-(c-a))}k.transformECEFToGeographic(this._aimGeographic,this._aim)}};a.prototype.projectionFromECEF=function(a,c){b.transformCoordEx(a,c,this._viewProjectionMatrix);a[0]=(a[0]+1)*this._viewportWidth/2;a[1]=(a[1]-1)*this._viewportHeight/-2;a[2]=a[2]};a.prototype.projectionFromGeo=function(a,b,c,d){b=k.toRadians(b);c=k.toRadians(c);d+=h.Radius;k.transformGeographicToECEF(a,[b,c,d]);this.projectionFromECEF(a,a)};a.prototype.isObscuredByEarth=
function(a){var c=b.create(),d=n.create();b.clone(d._orig,this._position);b.sub(d._dir,a,this._position);b.normalize(d._dir,d._dir);if(0==k.RayIntersectSphere(c,d,E))return!1;a=b.distance(a,this._position);return 0<=b.distance(c,this._position)-a?!1:!0};a.prototype.isVisible=function(a,c,d){a=k.toRadians(a);c=k.toRadians(c);d+=h.Radius;var e=b.create();k.transformGeographicToECEF(e,[a,c,d]);return this.isObscuredByEarth(e)||!k.isPointInFrustum(this._frustum,e)?!1:!0};a.prototype.isVisibleECEF=function(a){return k.isPointInFrustum(this._frustum,
a)?!0:!1};return a});definejs("Scene/SceneMode",["../Core/freezeObject"],function(b){var a={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(b){return b===a.SCENE3D?1:b===a.MORPHING?void 0:0}};return b(a)});definejs("Scene/FrameState",["./SceneMode"],function(b){return function(a,b){this.context=a;this.jobScheduler=b}});
definejs("Core/getTimestamp",[],function(){return"undefined"!==typeof performance&&"function"===typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()}});definejs("Scene/JobType",["../Core/freezeObject"],function(b){return b({TEXTURE:0,PROGRAM:1,BUFFER:2,NUMBER_OF_JOB_TYPES:3})});
definejs("Scene/JobScheduler",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/getTimestamp","./JobType"],function(b,a,d,c,e){function h(a){this._total=a;this.stolenFromMeThisFrame=this.usedThisFrame=0;this.starvedLastFrame=this.starvedThisFrame=!1}function l(a){var c=Array(e.NUMBER_OF_JOB_TYPES);c[e.TEXTURE]=new h(b(a)?a[e.TEXTURE]:10);c[e.PROGRAM]=new h(b(a)?a[e.PROGRAM]:10);c[e.BUFFER]=new h(b(a)?a[e.BUFFER]:30);a=c.length;var d,f=0;for(d=0;d<a;++d)f+=c[d].total;
var l=Array(a);for(d=0;d<a;++d)l[d]=!1;this._totalBudget=f;this._totalUsedThisFrame=0;this._budgets=c;this._executedThisFrame=l}a(h.prototype,{total:{get:function(){return this._total}}});l.getTimestamp=c;a(l.prototype,{totalBudget:{get:function(){return this._totalBudget}}});l.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget};l.prototype.resetBudgets=function(){for(var a=this._budgets,b=a.length,c=0;c<b;++c){var d=a[c];d.starvedLastFrame=d.starvedThisFrame;d.starvedThisFrame=
!1;d.usedThisFrame=0;d.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0};l.prototype.execute=function(a,b){var c=this._budgets,d=c[b],e=this._executedThisFrame[b];if(this._totalUsedThisFrame>=this._totalBudget&&e)return d.starvedThisFrame=!0,!1;var h;if(d.usedThisFrame+d.stolenFromMeThisFrame>=d.total){var x=c.length,p;for(p=0;p<x&&(h=c[p],!(h.usedThisFrame+h.stolenFromMeThisFrame<h.total)||h.starvedLastFrame);++p);if(p===x&&e)return!1;e&&(d.starvedThisFrame=!0)}c=l.getTimestamp();a.execute();c=
l.getTimestamp()-c;this._totalUsedThisFrame+=c;h?h.stolenFromMeThisFrame+=c:d.usedThisFrame+=c;return this._executedThisFrame[b]=!0};return l});
definejs("Renderer/View","Renderer/RenderContext Renderer/RenderFont Scene/Camera Scene/FrameState Scene/JobScheduler Math/MathUtils".split(" "),function(b,a,d,c,e,h){a=function(){this._renderArgs=this._cullArgs=this._camera=this._scene=this._renderContext=this.framework=null;this._frame_counter=0;this._jobScheduler=this._frameState=null};a.prototype.initialize=function(a){this.framework=a;this._renderContext=new b;this._renderContext.initialize(a);this._jobScheduler=new e;this._cullArgs={};this._renderArgs=
{};this._frameState=new c(this._renderContext,this._jobScheduler)};a.prototype.finalize=function(){this.framework=null;this._renderContext.finalize();this._renderArgs=this._cullArgs=this._camera=this._scene=this._renderContext=null};a.prototype.setScene=function(a){this._scene=a};a.prototype.setCamera=function(a){this._camera=a;this._camera.setView(this)};a.prototype.cull=function(a){var b=this._cullArgs;b.framework=this.framework;b._renderContext=this._renderContext;b._camera=this._camera;b._viewMatrix=
this._camera._viewMatrix;b._projectionMatrix=this._camera._projectionMatrix;b._viewProjectionMatrix=this._camera._cameraParam.matrix;b._updateQueue=this.framework.uploadQueue;b._frame_counter=this._frame_counter;b.isCullPoiOnly=a;b._frameState=this._frameState;this.framework._indoorSceneSystem.cull(b);this._scene.cull(b)};a.prototype.render=function(){var a=this._renderArgs;a.framework=this.framework;a._renderContext=this._renderContext;a._renderDevice=this.framework.renderDevice;a._camera=this._camera;
a._viewMatrix=this._camera._viewMatrix;a._projectionMatrix=this._camera._projectionMatrix;a._viewProjectionMatrix=this._camera._cameraParam.matrix;a._frame_counter=this._frame_counter;this._frame_counter++;a.framework._collisionManager.updateFadeResult();a._renderDevice.beginFrame();a._renderContext.renderModel(a);a.framework._collisionManager.render(a);a._renderContext.renderOverlay(a);a._renderDevice.endFrame();return!0};a.prototype.intersect=function(a){return this._scene.intersect(a)};a.prototype.getRenderContext=
function(){return this._renderContext};a.prototype.onResize=function(){this._camera.onResize()};return a});definejs("Renderer/RendererExtension",["Renderer/RenderDevice","Renderer/View","Renderer/RenderQueue"],function(b,a,d){b=function(){};b.prototype.launch=function(b){b=b.framework;var d=new a;d.initialize(b);b._viewManager.addView(d)};b.prototype.shutdown=function(){this.framework._viewManager.finalize();this.framework=null};return b});
definejs("Scene/Scene",[],function(){var b=function(){this.framework=null;this._visible=!0;this._sceneObjects=[];this._isNewData=!0};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){this.framework=null;for(var a=0;a<this._sceneObjects.length;a++)this._sceneObjects[a].finalize();this._sceneObjects=null};b.prototype.cull=function(a){for(var b=0;b<this._sceneObjects.length;b++)this._sceneObjects[b].cull(a);return!0};b.prototype.intersect=function(a){for(var b=!1,c=
0;c<this._sceneObjects.length;c++)b|=this._sceneObjects[c].intersect(a);return b};b.prototype.addSceneObject=function(a){this._sceneObjects.push(a)};b.prototype.removeSceneObject=function(a){for(var b=this._sceneObjects.length,c=0;c<b;c++)if(this._sceneObjects[c]===a){this._sceneObjects.splice(c,1);break}};b.prototype.getSceneObject=function(a){return this._sceneObjects[a]};b.prototype.getSceneObjectByName=function(a){return this._sceneObjects[a]};b.prototype.render=function(a){};return b});
definejs("Math/MercatorTransform",[],function(){var b=function(){};b.prototype.getTileExtent=function(a,b){};b.prototype.getExtentSize=function(a){};b.prototype.getLevelXY=function(a,b){};return b});
definejs("Framework/PlaneCamera","Core/defineProperties Math/Vector3 Math/Vector2 Math/Matrix4 Math/Extent Math/Frustum Math/Quaternion Math/Ellipsoid Math/MercatorCoords Framework/Framework Renderer/View Math/MathUtils Math/Ray Math/Sphere Math/MercatorTransform Framework/ConfigOptions".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p,s){d=function(){this._orientation=this._aimGeographic=this._aim=this._positionGeographic=this._positionRender=this._position=this._view=this._spatialTransform=this.framework=
null;this._dir;this._viewProjectionMatrix=this._projectionMatrix=this._viewMatrix=this._frustum=null;this._viewportHeight=this._viewportWidth=1;this._headingTiltRoll=null;this._zoomLevel=this._viewLevel=21;this._far=7E4;this._near=5;this._cameraParam={};this._cameraScale=1};d.prototype.initialize=function(b){this.framework=b;this._spatialReference=b._spatialReference;this._position=a.create();this._positionRender=a.create();this._positionGeographic=a.create();this._aim=a.create();this._aimGeographic=
a.create();this._orientation=l.create();this._headingTiltRoll=a.create();this._viewMatrix=c.create();this._frustum=new h;this._projectionMatrix=this._frustum._projectionMatrix;this._viewProjectionMatrix=c.create();b=this.framework._canvas.width;var d=this.framework._canvas.height;this._viewportWidth=b;this._viewportHeight=d;this._frustum.setAspect(b/d);this._frustum.setNear(0.1);this._frustum.setFar(100);this._frustum.setFovy(0.6435011087932844);this.transform=c.create();this._spatialTransform=new p};
var r=a.create(),z=a.create(),t=a.create();a.create();var w=a.create();a.create();d.prototype.setView=function(a){this._view=a};a.create();a.create();l.create();new e;d.prototype.apply=function(){this.framework._spatialReference.getRenderPosition(this._positionRender,this._position);l.multiplyVector3(r,this._orientation,[1,0,0]);l.multiplyVector3(z,this._orientation,[0,1,0]);l.multiplyVector3(t,this._orientation,[0,0,1]);a.normalize(r,r);a.normalize(z,z);a.normalize(t,t);this._viewMatrix[0]=r[0];
this._viewMatrix[1]=z[0];this._viewMatrix[2]=t[0];this._viewMatrix[3]=0;this._viewMatrix[4]=r[1];this._viewMatrix[5]=z[1];this._viewMatrix[6]=t[1];this._viewMatrix[7]=0;this._viewMatrix[8]=r[2];this._viewMatrix[9]=z[2];this._viewMatrix[10]=t[2];this._viewMatrix[11]=0;this._viewMatrix[12]=-a.dot(r,this._position);this._viewMatrix[13]=-a.dot(z,this._position);this._viewMatrix[14]=-a.dot(t,this._position);this._viewMatrix[15]=1;var b=this.framework.renderDevice._gl;c.perspectiveRH(this._projectionMatrix,
this._frustum._fovy,b.viewportWidth/b.viewportHeight,this._near,this._far);this._frustum.setNear(this._near);this._frustum.setFar(this._far);this._frustum.update(this._viewMatrix);this._viewMatrix[12]=-a.dot(r,this._positionRender);this._viewMatrix[13]=-a.dot(z,this._positionRender);this._viewMatrix[14]=-a.dot(t,this._positionRender);c.multiply(this._viewProjectionMatrix,this._viewMatrix,this._projectionMatrix)};d.prototype.applyMatrix=function(a){this._cameraParam=a;this._zoomLevel=this._cameraParam.zoomLevel;
this._cameraScale=this._cameraParam.pixelsPerMeter/this._cameraParam.worldSize;this.framework._spatialReference.updateMatrix(this._cameraParam)};d.prototype.getPixelsPerMeter=function(){return this._cameraParam.pixelsPerMeter};c.create();a.create();var u=a.create(),v=a.create(),A=a.create();d.prototype.getPickRay=function(b,c){var d=this.framework._canvas.width,e=this.framework._canvas.height,f=Math.tan(0.5*this._frustum._fovy),g=this._frustum._aspect*f,h=this._frustum._near,d=2/d*b[0]-1,e=2/e*(e-
b[1])-1;a.clone(c._orig,this._positionRender);var k=this.right,l=this.up;a.scale(u,this.direction,h);a.add(u,this._positionRender,u);a.scale(v,k,d*h*g);a.scale(A,l,e*h*f);a.add(c._dir,u,v);a.add(c._dir,c._dir,A);a.sub(c._dir,c._dir,this._positionRender);a.normalize(c._dir,c._dir);return c};var w=a.create(),F=a.create(),M=a.create(),C=c.create();b(d.prototype,{position:{get:function(){return this._position},set:function(a){this._position=a}},right:{get:function(){l.multiplyVector3(w,this._orientation,
[1,0,0]);return w}},up:{get:function(){l.multiplyVector3(F,this._orientation,[0,1,0]);return F}},direction:{get:function(){l.multiplyVector3(M,this._orientation,[0,0,-1]);return M}},headingTiltRoll:{get:function(){return this._headingTiltRoll}},inverseTransform:{get:function(){c.inverse(C,this.transform);return C}}});d.prototype.finalize=function(){this._frustum=this._scene=this.framework=null;a.release(this._position);l.release(this._orientation);c.release(this._viewMatrix)};d.prototype.onResize=
function(a,b){a=a||this.framework._canvas.width;b=b||this.framework._canvas.height;this._viewportWidth=a;this._viewportHeight=b;this._frustum.setAspect(a/b);this._frustum.setNear(0.1);this._frustum.setFar(100);this._frustum.setFovy(0.6435011087932844);this.transform=c.create();this._spatialTransform=new p};d.prototype.projectionFromWorld=function(b,c){this._cameraParam.matrix&&(this._spatialReference.getRenderPosition(b,c),a.transformCoordEx(b,b,this._viewProjectionMatrix),b[0]=(b[0]+1)*this._viewportWidth/
2,b[1]=(b[1]-1)*this._viewportHeight/-2,b[2]=b[2])};var J=a.create();d.prototype.projectionFromWorld2=function(b,d,e,f){this._cameraParam.matrix&&(this.framework._spatialReference.matrixWorldToRender2(J,d,e),c.multiply(J,J,f),a.transformCoordEx(b,[0,0,0],J),b[0]=(b[0]+1)*this._viewportWidth/2,b[1]=(b[1]-1)*this._viewportHeight/-2,b[2]=b[2])};d.prototype.geoToScreen=function(a,b,c){var d=[0,0,0],e=[0,0,0];this.framework._spatialReference.transformGeographicsToWorld(e,[a*m.RADIANS_PER_DEGREE,b*m.RADIANS_PER_DEGREE,
c]);this.projectionFromWorld(d,e);a=1/s.devicePixelRatio;d[0]*=a;d[1]*=a;return d};d.prototype.screenToGeo=function(b,c){var d=[b,c,0],e=q.create();this.getPickRay(d,e);var f=this.framework._spatialReference;if(0==f.intersectRay(d,e))return!1;e=a.create();f.transformRenderToWorld(d,d);this.framework._spatialReference.transformWorldToGeographics(e,d);d=m.toDegree(e[0]);f=m.toDegree(e[1]);return[d,f]};d.prototype.isVisible=function(a){return m.isPointInFrustum(this._frustum,a)?!0:!1};return d});
definejs("Resource/WorkerManager",["Framework/ConfigOptions","Resource/Downloader"],function(b,a){function d(a){a=new Blob([a],{type:"text/javascript"});a=URL.createObjectURL(a);return new Worker(a)}var c=function(){this.workerNum=b.worker&&b.worker.count||2;this._taskArray={};this.workers=[];var c=this,h=window.location.pathname.replace(/\/\w*\.html/,"");this.workerURL=b.worker&&b.worker.url||h+"/map/sdk/IndoorRSWorker.js";for(var l=0;l<this.workerNum;l++)b.useWorkerContent?(h=d(b.worker.content),
this.workers[l]=h,this.workers[l].status=1):a.rawXHR(this.workerURL,"GET",{},"application/javascript",!1,function(b){b=a.dataURItoBlob(b);b=URL.createObjectURL(b);c.workers[l]=new Worker(b);c.workers[l].status=1},function(a){console.log(a)})};c.prototype.addTask=function(a){this._taskArray[a.url]=a};c.prototype.getFreeWorker=function(){for(var a=null,b=0;b<this.workerNum;b++)if(1==this.workers[b].status){a=this.workers[b];break}return a};c.prototype.executeTask=function(a){var b=this,c=null,d=null,
c=b._taskArray[a.url],k;for(k in b._taskArray)null===b._taskArray[k].patchs&&delete b._taskArray[k];c?(d=b.getFreeWorker(),null!==d&&(d.content=c,d.postMessage(c.byteStream),d.status=2,d.onmessage=function(c){this.content.chunkData=c.data;if(-1===c.data.state)this.content.state=-1;else{if(this.content.onWorkerFinished)this.content.onWorkerFinished(a);delete b._taskArray[a.url]}this.status=1;this.content=null})):this.addTask(a)};c.prototype.finalize=function(){for(var a=0;a<this.workerNum;a++)delete this.workers[a]};
return c});definejs("Scene/SceneExtension",["Scene/Scene","Framework/PlaneCamera","Math/MathUtils","Resource/WorkerManager"],function(b,a,d,c){d=function(){};d.prototype.launch=function(d){var h=d.framework;this.framework=h;var l=h._viewManager.getView(0),g=new a;g.initialize(h);l.setCamera(g);d._camera=g;h._workerManager=new c;d=new b;d.initialize(h);l.setScene(d);h._sceneManager.addScene(d)};d.prototype.shutdown=function(){this.framework._workerManager.finalize()};return d});
definejs("Controller/CameraInputControl","Math/Vector3 Math/MathUtils Math/Ray Math/Ellipsoid Math/Sphere Math/Vector2 Math/Matrix4 Controller/InputActionType".split(" "),function(b,a,d,c,e,h,l,g){function k(a,b,c){a._camera.getPickRay(b,z);a=a.framework._spatialReference;if(0<a.intersectRay(c,z))return a.transformRenderToWorld(c,c),c}function n(a,c,d){var e=a._cameraController;c=k(a,c,t);a=k(a,d,w);"undefined"!==typeof c&&"undefined"!==typeof a&&(b.sub(u,c,a),e.move(u))}function f(a,d,e,f,g,h,k){var p=
a._cameraController,m=p.constrainedAxis;"undefined"!==typeof g&&(p.constrainedAxis=g);"undefined"===typeof k&&(k=c.Radius);a._rotateFactor=1/k;a._rotateRateRangeAdjustment=k;k=2;k>a._maximumRotateRate&&(k=a._maximumRotateRate);k<a._minimumRotateRate&&(k=a._minimumRotateRate);var q=(d[0]-e[0])/a.framework._canvas.width;d=(d[1]-e[1])/a.framework._canvas.height;q=Math.min(q,a.maximumMovementRatio);d=Math.min(d,a.maximumMovementRatio);a=k*d*Math.PI;p.rotateRight(k*q*Math.PI*2,f);p.rotateUp(a,f);"undefined"!==
typeof h&&(a=b.clone(v,p._camera.direction),l.inverse(A,f),b.transformNormal(a,a,A),g=-b.dot(a,g),g=Math.acos(g),g>h&&p.rotateUp(-(g-h),f));p.constrainedAxis=m}function m(b,c,d){var e=b._cameraController._camera._position[2],f=1*b.minimumZoomDistance,g=b.maximumZoomDistance,h=b._zoomFactor*(e-f),h=a.clamp(h,b._minimumZoomRate,b._maximumZoomRate);c=(d[1]-c[1])/b.framework._canvas.clientHeight;c=Math.min(c,b.maximumMovementRatio);h=h*c*1.5;0<h&&1>Math.abs(e-f)||0>h&&1>Math.abs(e-g)||(e-h<f?h=e-f-1:
e-h>g&&(h=e-g),b._cameraController.zoom(h))}function q(a,b,c){"undefined"!==typeof k(a,b,M)?n(a,b,c):f(a,b,c)}function x(c,d,e){var g=c._cameraController,h=c._cameraController._camera;if(!(h._position[2]-0.25*c.minimumZoomDistance-1<a.EPSILON3&&0>e[1]-d[1])){var p=C;p[0]=c.framework._canvas.width/2;p[1]=c.framework._canvas.height/2;var h=h._position,p=k(c,p,J),m=b.create();b.sub(m,h,p);b.length(m);h=l.create();l.translate(h,p[0],p[1],p[2]);g=a.toRadians(g._maxCameraTilt);f(c,d,e,h,b.UNIT_Z,g,1)}}
function p(b,c,d,e,f){if(!b||h.equalsEpsilon(b.startPosition,b.endPosition,a.EPSILON3))return!1;var g=b.pressTime,k=b.releaseTime,l=g&&k&&(k.getTime()-g.getTime())/1E3,p=new Date,p=k&&(p.getTime()-k.getTime())/1E3;if(g&&k&&l<O){c=0>p?0:Math.exp(-(45*(1-c))*p);"undefined"===typeof e[f]?(g=0.5*(b.endPosition[0]-b.startPosition[0]),k=0.5*(b.endPosition[1]-b.startPosition[1]),e[f]={startPosition:h.make(b.startPosition[0],b.startPosition[1]),endPosition:h.make(b.startPosition[0]+g*c,b.startPosition[1]+
k*c),motion:h.make(g,k)}):e[f]={startPosition:h.make(e[f].endPosition[0],e[f].endPosition[1]),endPosition:h.make(e[f].endPosition[0]+e[f].motion[0]*c,e[f].endPosition[1]+e[f].motion[1]*c),motion:h.create()};if(isNaN(e[f].endPosition[0])||isNaN(e[f].endPosition[1])||h.equalsEpsilon(e[f].startPosition,e[f].endPosition,a.EPSILON3))return e[f]=void 0,!1;d(e,e[f].startPosition,e[f].endPosition);return!0}e[f]=void 0;return!1}function s(a,b,c,d,e,f,h,k){a._lastInertiaSpinMovement=void 0;a._lastInertiaTiltMovement=
void 0;a._lastInertiaZoomMovement=void 0;a._lastInertiaWheelZoomMovement=void 0;a._lastInertiaTouchZoomMovement=void 0;a._lastInertiaTouchTiltMovement=void 0;c||b.resetAction(g.MOUSE_LEFTDRAG);d||b.resetAction(g.MOUSE_MIDDLEDRAG);e||b.resetAction(g.MOUSE_RIGHTDRAG);f||b.resetAction(g.MOUSE_WHEEL)}var r=function(){this._cameraController=this._camera=this.framework=null;this.minimumZoomDistance=20;this.maximumZoomDistance=Number.POSITIVE_INFINITY;this._minimumZoomRate=20;this._maximumZoomRate=5906376272E3;
this.maximumMovementRatio=0.5;var a=c.Radius;this._zoomFactor=10;this._rotateFactor=1/a;this._rotateRateRangeAdjustment=a;this._maximumRotateRate=3.54;this._minimumRotateRate=2E-4;this.inertiaSpin=0.93;this._lastInertiaTouchTiltMovement=this._lastInertiaTouchZoomMovement=this._lastInertiaWheelZoomMovement=this._lastInertiaZoomMovement=this._lastInertiaTiltMovement=this._lastInertiaSpinMovement=void 0;this.inertiaZoom=0.8;this.type="CameraInputControl";this.onCameraPinchEvent=this.onCameraRotateEvent=
this.onCameraScaleEvent=this.onCameraSpinEvent=null;this._count=0};r.prototype.initialize=function(a,b){this.framework=a;this._cameraController=b;this._camera=this._cameraController._camera};r.prototype.finalize=function(){this._cameraController=this._camera=this.framework=null};var z=d.create();e.make([0,0,0],c.Radius);var t=b.create(),w=b.create(),u=b.create();r.prototype.screenToGeographics=function(a,b){if("undefined"===typeof k(this,a,a))return!1;this.framework._spatialReference.transformWorldToGeographics(b,
a);return!0};r.prototype.pan=function(b){var c=h.create();c[0]=0.5*this._camera._viewportWidth;c[1]=0.5*this._camera._viewportHeight;var d=h.create();b=a.toRadians(b);d[0]=c[0]-20*Math.sin(b);d[1]=c[1]+20*Math.cos(b);n(this,c,d)};var v=b.create(),A=l.create();b.create();b.create();var F=b.create(),M=b.create(),C=h.create();d.create();b.create();var J=b.create();l.create();r.prototype.tiltUp=function(){var a=h.create();a[0]=0.5*this._camera._viewportWidth;a[1]=0.5*this._camera._viewportHeight;var b=
h.create();b[0]=a[0];b[1]=a[1]-5;x(this,a,b)};r.prototype.tiltDown=function(){var a=h.create();a[0]=0.5*this._camera._viewportWidth;a[1]=0.5*this._camera._viewportHeight;var b=h.create();b[0]=a[0];b[1]=a[1]+5;x(this,a,b)};var O=0.8;r.prototype.stopCameraInertia=function(a){s(this,a,!1,!1,!1,!1,!1)};r.prototype.beginUpdate=function(b){var c=b.isDoAction(g.MOUSE_MIDDLEDRAG),d=b.isDoAction(g.MOUSE_LEFTDRAG),e=b.isDoAction(g.MOUSE_RIGHTDRAG),f=b.isDoAction(g.MOUSE_WHEEL),h=b.isDoAction(g.TOUCH_PINCH),
l=b.isDoAction(g.TOUCH_DOUBLETAP),n=b.isDoAction(g.TOUCH_SCRATCH),r=d||c||e||f||h||l||n;(b.isButtonDown()||r)&&s(this,b,d,c,e,f,h,l);var t=this.framework.getInteractionManager().getAnimationManager();r?t.removeAnimationControls(this._camera):t.bUpdate&&s(this,b,!1,!1,!1,!1,!1);var t=b.getActionParameter(g.MOUSE_LEFTDRAG),z=b.getActionParameter(g.MOUSE_MIDDLEDRAG),u=b.getActionParameter(g.MOUSE_RIGHTDRAG),v=b.getActionParameter(g.MOUSE_WHEEL);if(d&&(q(this,t.startPosition,t.endPosition),this.onCameraSpinEvent))this.onCameraSpinEvent();
c&&x(this,z.startPosition,z.endPosition);if(e)m(this,u.startPosition,u.endPosition);else if(f&&(m(this,v.startPosition,v.endPosition),this.onCameraScaleEvent))this.onCameraScaleEvent();c=b.getActionParameter(g.TOUCH_PINCH);d=b.getActionParameter(g.TOUCH_DOUBLETAP);b=b.getActionParameter(g.TOUCH_SCRATCH);var w,C;l&&(l=k(this,d.endPosition,F),"undefined"!==typeof l&&(this.framework._spatialReference.transformWorldToGeographics(l,l),d=0.7*this._cameraController._camera.position[2],30>d&&(d=30),this._cameraController.flyToLookat(a.toDegree(l[0]),
a.toDegree(l[1]),0,void 0,void 0,d)));if(h)if(h=c.movement,h._isBackToGloble)h._isBackToGloble=!1,this._cameraController.backToGlobe();else{if(this.onCameraPinchEvent)this.onCameraPinchEvent();"undefined"!==typeof h.distance&&(w=h.distance,w={startPosition:w.startPosition,endPosition:w.endPosition,pressTime:c.pressTime,releaseTime:c.releaseTime},m(this,w.startPosition,w.endPosition));"undefined"!==typeof h.angleAndHeight&&(C=h.angleAndHeight,C={startPosition:C.startPosition,endPosition:C.endPosition,
pressTime:c.pressTime,releaseTime:c.releaseTime},x(this,C.startPosition,C.endPosition))}n&&(h=b.movement,"undefined"!==typeof h.distance&&(w=h.distance,w={startPosition:w.startPosition,endPosition:w.endPosition,pressTime:b.pressTime,releaseTime:b.releaseTime},h._isBackToGloble?this._cameraController.backToGlobe():m(this,w.startPosition,w.endPosition)));n=!1;r||(n=(n=(n=(n=(n=(n=n||p(t,this.inertiaSpin,q,this,"_lastInertiaSpinMovement"))||p(z,this.inertiaSpin,x,this,"_lastInertiaTiltMovement"))||p(u,
this.inertiaZoom,m,this,"_lastInertiaZoomMovement"))||p(v,this.inertiaZoom,m,this,"_lastInertiaWheelZoomMovement"))||p(w,this.inertiaZoom,m,this,"_lastInertiaTouchZoomMovement"))||p(C,this.inertiaSpin,x,this,"_lastInertiaTouchTiltMovement"));return n||r};r.prototype.endUpdate=function(a){};return r});
definejs("Math/PlaneTransform",["Math/Vector3","Math/Matrix4","Math/Quaternion","Math/MathUtils","Math/Plane"],function(b,a,d,c,e){var h=function(){this._position=b.create();this._rotation=b.create();this._direction=b.create();this._up=b.create();this._target=b.create();this._range=1},l=d.create(),g=a.create();h.prototype.CreateFromCart=function(c,e,f){b.assign(this._position,c[0],c[1],c[2]);b.assign(this._rotation,e[0],e[1],e[2]);this._range=f;d.fromEuler(l,e[0],e[1],e[2]);d.normalize(l,l);a.fromQuaternion(g,
l);b.transformNormal(this._direction,b.UNIT_Y,g);b.normalize(this._direction,this._direction);b.transformNormal(this._up,b.UNIT_Z,g);b.normalize(this._up,this._up);b.mad(this._target,c,this._direction,f)};h.prototype.CreateFromTargetCart=function(c,e,f){b.assign(this._target,c[0],c[1],c[2]);b.assign(this._rotation,e[0],e[1],e[2]);this._range=f;d.fromEuler(l,e[0],e[1],e[2]);d.normalize(l,l);a.fromQuaternion(g,l);b.transformNormal(this._direction,b.UNIT_Y,g);b.normalize(this._direction,this._direction);
b.transformNormal(this._up,b.UNIT_Z,g);b.normalize(this._up,this._up);b.mad(this._position,c,this._direction,-f)};h.prototype.CreateFromCart2=function(a,c,d,e){b.assign(this._position,a[0],a[1],a[2]);b.assign(this._direction,c[0],c[1],c[2]);b.assign(this._up,d[0],d[1],d[2]);b.mad(this._target,a,this._direction,e);this.CalculateEuler()};h.prototype.CreateFromTargetCart2=function(a,c,d,e){b.assign(this._target,a[0],a[1],a[2]);b.assign(this._direction,c[0],c[1],c[2]);b.assign(this._up,d[0],d[1],d[2]);
b.mad(this._position,a,this._direction,-e);this.CalculateEuler()};var k=e.create(),n=b.create(),f=b.create(),m=b.create();h.prototype.CalculateEuler=function(){var a=c.PI_OVER_TWO-Math.acos(b.dot(b.UNIT_Z,this._direction)),d=0.5*c.DEGREE_PER_RADIANS;e.assign(k,0,0,1,0);c.equal(a,c.PI_OVER_TWO,d)||c.equal(a,-c.PI_OVER_TWO,d)?b.assign(f,this._up):b.assign(f,this._direction);e.projection(n,f,k);b.normalize(n,n);d=Math.acos(b.dot(b.UNIT_Y,n));b.cross(m,b.UNIT_Y,n);0>b.dot(b.UNIT_Z,m)&&(d=c.TWO_PI-d,Math.abs(d-
c.TWO_PI)<c.EPSILON6&&(d=0));e.fromeNormalDistance(k,this._direction,0);e.projection(n,b.UNIT_Z,k);b.normalize(n,n);var g=Math.acos(b.dot(n,b.UNIT_Z));0>b.dot(this._up,n)&&(a=-a);b.assign(this._rotation,a,g,d)};return h});
definejs("Controller/PlaneCameraController","Core/defineProperties Math/Vector3 Math/MathUtils Math/Matrix4 Math/Quaternion Math/Ellipsoid Controller/InteractionManager Controller/AnimationManager Controller/AnimationControl Math/Ray Math/Sphere Math/Vector2 Math/PlaneTransform Math/MercatorCoords Math/Plane".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x,p){function s(b,d){var f=b._camera,g;if("undefined"!==typeof d){g=c.copy(I,f.transform);c.multiply(f.transform,d,g);var h=f.inverseTransform;a.transformCoord(f._position,
f._position,h);e.fromMatrix(B,h);e.multiply(f._orientation,B,f._orientation)}return g}function r(b,d){if("undefined"!==typeof d){var f=b._camera;a.transformCoord(f._position,f._position,f.transform);e.fromMatrix(y,f.transform);e.multiply(f._orientation,y,f._orientation);c.copy(f.transform,d);d=f.inverseTransform;a.transformCoord(f._position,f._position,d);e.fromMatrix(y,d);e.multiply(f._orientation,y,f._orientation)}}function z(a,b,c,f){0>c?console.log("tilt must be > 0"):(e.fromAxisAngle(G,[0,0,
1],d.toRadians(b)),e.fromAxisAngle(L,[1,0,0],d.toRadians(c)),e.multiply(f,G,L))}function t(a,b,e){c.fromQuaternion(N,b);c.toEulerAnglesZXY(D,N);e[0]=d.toDegree(D[0]);a=d.toDegree(D[1]);0<=a?e[1]=a:console.log("tilt can't be <0")}function w(b,c,e,f,g){g._lon=b;g._lat=c;a.assign(f,d.toRadians(b),d.toRadians(c),e);x.sphericalToMercator(f,f)}function u(b){var c=b.elapse/b.duration,d=b.parameter,f=b.getAnimationObject();if(1<c)e.clone(f._orientation,d.targetOrientation),a.mad(f._position,d.targetLookAtPoint,
f.direction,-d.targetRange),b.stop();else{b=d.startLookAtPoint;var g=d.targetLookAtPoint,k=d.rotateAngle*h.Radius*0.5,l=0,l=0,p=0.5*(d.startRange+d.targetRange);k>Math.max(d.startRange,d.targetRange)&&(l=k);0<l||d.targetRange<d.startRange?0.5>c?(a.sub(V,g,b),a.mad(ha,b,V,2*c),e.slerp(f._orientation,d.startOrientation,d.targetOrientation,2*c),c*=2,l=d.startRange*(1-c)+(p+l)*c):(a.clone(ha,d.targetLookAtPoint),e.clone(f._orientation,d.targetOrientation),c=Math.pow(2*(1-c),3),l=d.targetRange*(1-c)+(p+
l)*c):(a.sub(V,g,b),a.mad(ha,b,V,c),e.slerp(f._orientation,d.startOrientation,d.targetOrientation,c),l=d.startRange*(1-c)+d.targetRange*c);a.mad(f._position,ha,f.direction,-l)}}function v(b,c,d,f,g,k,l,p){c=0.1;var m=p*h.Radius*0.5,n=0,n=0,q=0.5*(g+k);m>Math.max(g,k)&&(n=m);if(0<n||k<g)if(e.fromAxisAngle(ga,l,p*c*2),e.multiplyVector3(R,ga,b),e.slerp(fa,d,f,2*c),c*=2,n=g*(1-c)+(q+n)*c,e.multiplyVector3(T,fa,[0,0,-1]),a.scale(O,T,-n),a.add(R,O,R),t(R,fa,pa),0>pa[1])return!1;return!0}function A(b,c,
f,g,h){var k=0;0!==b&&(k=d.toRadians(c),c=Math.tan(k-b)*f,f*=Math.tan(k),k=Math.abs(f-c),0>b&&(k=-k),e.multiplyVector3(h,g,[0,1,0]),p.projection(h,h,J),a.normalize(h,h));a.scale(h,h,k);return k}function F(b,c,d,e,f){0!==b&&(A(b,c,e[2],d,Y),a.sub(e,e,Y),f&&a.sub(f,f,Y))}function M(b,c,d,e,f){0!==b&&(A(b,c,e[2],d,Y),a.add(e,e,Y),f&&a.add(f,f,Y))}function C(b){var c=b.elapse/b.duration,d=b.parameter,e=b.getAnimationObject();1<c?(a.clone(e._position,d.targetPosition),b.stop()):(e._position[0]=d.startPosition[0]*
(1-c)+d.targetPosition[0]*c,e._position[1]=d.startPosition[1]*(1-c)+d.targetPosition[1]*c,e._position[2]=d.startPosition[2]*(1-c)+d.targetPosition[2]*c)}b=function(a){this.constrainedAxis=this._camera=this.framework=null;this._minCameraHeight=this._maxCameraTilt=50;this._maxCameraHeight=1100;this._zoomCallBack=this._headingCallBack=null;this._lastTilt=this._lastHeading=this._lastZoomScale=0;a&&(this._maxCameraTilt=a.maxtTitl||this._maxCameraTilt,this._minCameraHeight=a.nearDistance||this._minCameraHeight,
this._maxCameraHeight=a.farDistance||this._maxCameraHeight,this._lon=a.defaultPosition&&a.defaultPosition[0]||0,this._lat=a.defaultPosition&&a.defaultPosition[1]||0);this._countryLevelHeight=2666831;this._countryLevelScale=0.25;this._stateLevelHeight=310230;this._stateLevelScale=0.4;this._cityLevelHeight=43601;this._cityLevelScale=0.55;this._streetLevelHeight=1586;this._streetLevelScale=0.85;this._viewCenter=m.create();this._viewLevel=0;this._viewChangeEvetHandle=[];this._poiClickEventHandle=[];this._noPoiClickEventHandle=
[];this._cameraBounds=[-90,90,-180,180];this._centerOffset=0;this._commandExcutant=null;this._maxCameraHeightPlane=p.create();this._minCameraHeightPlane=p.create();this._bottom=this._top=this._right=this._left=0};var J=p.create();b.prototype.initialize=function(b,c,d,e){this.framework=b;this._camera=c;this.constrainedAxis=void 0;this.spatialTransform=new q;p.fromNormalDistance(this._maxCameraHeightPlane,[0,0,-1],this._maxCameraHeight);p.fromNormalDistance(this._minCameraHeightPlane,[0,0,1],-this._minCameraHeight);
b=this.getCameraPose();this._originalPosition=a.make(b.lng||this._lon||113.9959618825029,b.lat||this._lat||22.526009851578408,b.alt||135);this.setPosition(this._originalPosition[0],this._originalPosition[1],this._originalPosition[2],~~(b.heading||this._lastHeading||0),~~(b.tilt||this._lastTilt||0))};b.prototype.onResize=function(){this.setMapRect();this.initialize(this.framework,this._camera)};b.prototype.finalize=function(){this._camera=this.framework=null;this.release(this.constrainedAxis)};var O=
a.create(),E=n.create(),H=a.create();b.prototype.zoom=function(b){var c=this._camera,d=c.direction,c=c._position;a.scale(O,d,b);a.add(H,O,c);if(H[2]>this._maxCameraHeight&&(a.scale(E._dir,d,-1),E._orig=c,b=p.intersectRay(H,this._maxCameraHeightPlane,E),0===b)||H[2]<this._minCameraHeight&&(a.scale(E._dir,d,1),E._orig=c,b=p.intersectRay(H,this._minCameraHeightPlane,E),0===b))return;a.clone(c,H);this.framework.forceRedraw();this.framework.updateCollision(!1)};var P=e.create();b.prototype.rotate=function(a,
b,c){var d=this._camera;c=s(this,c);e.fromAxisAngle(P,a,-b);e.multiply(d._orientation,P,d._orientation);e.multiplyVector3(d._position,P,d._position);r(this,c);this.framework.updateCollision(!1)};b.prototype.move=function(b){var c=this._camera;a.add(c._position,c._position,b);this.framework.updateCollision(!1)};var B=e.create(),I=c.create(),y=e.create();a.create();a.create();a.create();var K=a.create();b.prototype.rotateRight=function(a,b){var c=-a;"undefined"!==typeof this.constrainedAxis?this.rotate(this.constrainedAxis,
c,b):this.rotate(this._camera.getUp(),c,b)};b.prototype.rotateUp=function(b,c){var e=-b,f=this._camera,g=s(this,c),h=f.direction;"undefined"!==typeof this.constrainedAxis&&(a.negate(K,this.constrainedAxis),h=Math.acos(a.dot(h,K)),h-e<d.EPSILON2||this.rotate(f.right,e));r(this,g)};var G=e.create(),L=e.create(),N=a.create(),D=a.create();b.prototype.setPosition=function(b,c,d,f,g){var h=this._camera;"undefined"===typeof f&&(f=this.getHeading());"undefined"===typeof g&&(g=this.getTilt());a.clone(X,h._position);
e.clone($,h._orientation);w(b,c,d,h._position,this);z(h._position,f,g,h._orientation);this.getLookAtPoint(ca,h._position,h._orientation);M(this.getCenterOffset(),g,h._orientation,h._position);a.equalsEpsilon(h._position,X,0.001)&&e.equalsEpsilon(h._orientation,$,1E-5)||(this.applyCamera(),this.framework.updateCollision(!0),this.framework.forceRedraw())};b.prototype.computeHeadingTiltByDirection=function(a,b,c){debugger};var Q=a.create(),X=a.create(),$=a.create();b.prototype.gotoLookAt=function(b,
c,d,f,g,h){var k=this._camera;"undefined"===typeof f&&(f=this.getHeading());"undefined"===typeof g&&(g=this.getTilt());"undefined"===typeof h&&(h=this.getLookAtPoint(ba,k._position,k._orientation));a.clone(X,k._position);e.clone($,k._orientation);w(b,c,d,ca,this);z(ca,f,g,k._orientation);e.multiplyVector3(Q,k._orientation,[0,0,-1]);a.mad(k._position,ca,Q,-h);M(this.getCenterOffset(),g,k._orientation,k._position,ca);a.equalsEpsilon(k._position,X,0.001)&&e.equalsEpsilon(k._orientation,$,1E-5)||(this.applyCamera(),
this.framework.forceRedraw(),this.framework.updateCollision(!0))};var ga=e.create(),V=a.create(),ha=a.create(),fa=e.create(),R=a.create(),T=a.create();b.prototype.computeLength=function(b,c,d,e){a.normalize(na,b);a.normalize(Z,c);return Math.acos(a.dot(na,Z))*(d+e)*0.5};var S=n.create();f.make([0,0,0],h.Radius);var U=a.create(),W=a.create();b.prototype.getLookAtPoint=function(b,c,d){S._orig=c;e.multiplyVector3(U,d,[0,0,-1]);a.normalize(U,U);S._dir=U;return 0<this.framework._spatialReference.intersectRay(b,
S)?(a.sub(W,b,c),a.dot(W,U)):0};b.prototype.setCenterOffset=function(a){this._centerOffset=a};b.prototype.getCenterOffset=function(){return this._centerOffset};var ba=a.create(),ia=a.create(),ja=e.create(),ka=e.create(),pa=a.create(),ca=a.create(),ea=a.create(),na=a.create(),Z=a.create();a.create();a.create();b.prototype.flyTo=function(b,c,d,f,g,h,l){var p=this._camera;"undefined"===typeof f&&(f=this.getHeading());"undefined"===typeof g&&(g=this.getTilt());"undefined"===typeof l&&(l=0.5);"undefined"===
typeof h&&(h=0);1E-5>d&&1E-5>h&&(d=0);g>this._maxCameraTilt&&(g=this._maxCameraTilt);h=this.getLookAtPoint(ba,p._position,p._orientation);e.clone(ja,p._orientation);w(b,c,d,ia,this);z(ia,f,g,ka);t(ia,ka,pa);b=this.getLookAtPoint(ca,ia,ka);M(this.getCenterOffset(),pa[1],ka,ia,ca);a.equalsEpsilon(p._position,ia,0.001)&&e.equalsEpsilon(ja,ka,0.001)||(a.normalize(na,ba),a.normalize(Z,ca),a.cross(ea,na,Z),a.normalize(ea,ea),c=a.dot(na,Z),c=Math.min(c,1),c=Math.max(c,-1),c=Math.acos(c),c>0.5*Math.PI&&!v(ba,
ca,ja,ka,h,b,ea,c)&&(c=2*Math.PI-c,a.scale(ea,ea,-1)),d=this.framework.getInteractionManager().getAnimationManager(),f=new k,f.setAnimationObject(p),f.setDuration(l),f.setParameter({startLookAtPoint:ba,targetLookAtPoint:ca,startOrientation:ja,targetOrientation:ka,startRange:h,targetRange:b,rotateAxis:ea,rotateAngle:c}),f.setOnAnimationFrame(u),d.removeAnimationControls(p),d.addAnimationControl("cameraFlyTo",f),f.start())};var Q=a.create(),ta=a.create(),Y=a.create();b.prototype.flyToLookat=function(b,
c,d,f,g,h,l){var m=this,n=m._camera;"undefined"===typeof f&&(f=m.getHeading());"undefined"===typeof g&&(g=m.getTilt());"undefined"===typeof l&&(l=0.5);var q=m.getLookAtPoint(ba,n._position,n._orientation);h&&"undefined"!==typeof h||(h=q);1E-5>d&&1E-5>h&&(d=0);g>m._maxCameraTilt&&(g=m._maxCameraTilt);w(b,c,d,ca,m);z(ca,f,g,ka);e.multiplyVector3(ta,ka,[0,0,-1]);a.mad(H,ca,ta,-h);if(H[2]>m._maxCameraHeight){a.scale(E._dir,n.direction,-1);E._orig=ca;b=p.intersectRay(H,m._maxCameraHeightPlane,E);if(0===
b)return;h=a.distance(H,ca)}if(H[2]<m._minCameraHeight){a.scale(E._dir,n.direction,1);E._orig=ca;b=p.intersectRay(H,m._minCameraHeightPlane,E);if(0===b)return;h=a.distance(H,ca)}a.clone(ia,H);M(m.getCenterOffset(),g,ka,ia,ca);a.equalsEpsilon(n._position,ia,0.001)&&e.equalsEpsilon(n._orientation,ka,0.001)||(e.clone(ja,n._orientation),g=h,a.normalize(na,ba),a.normalize(Z,ca),a.cross(ea,na,Z),a.normalize(ea,ea),b=a.dot(na,Z),b=Math.min(b,1),b=Math.max(b,-1),b=Math.acos(b),b>0.5*Math.PI&&!v(ba,ca,ja,
ka,q,g,ea,b)&&(b=2*Math.PI-b,a.scale(ea,ea,-1)),c=m.framework.getInteractionManager().getAnimationManager(),d=new k,d.setAnimationObject(n),d.setDuration(l),d.setParameter({startLookAtPoint:ba,targetLookAtPoint:ca,startOrientation:ja,targetOrientation:ka,startRange:q,targetRange:g,rotateAxis:ea,rotateAngle:b}),d.setOnAnimationFrame(u),d.setOnAnimationDone(function(a){m.framework.forceRedraw(!0);m.notifyEvent("viewChange",{})}),c.removeAnimationControls(n),c.addAnimationControl("cameraFlyTo",d),d.start())};
b.prototype.zoomToPlace=function(b,c,e,f,g){10>this._camera._positionGeographic[2]-e-h.Radius&&w(d.toDegree(this._camera._positionGeographic[0],this),d.toDegree(this._camera._positionGeographic[1]),e+10,this._camera._position);this.rotateTo(b,c,e);w(b,c,e,ca);b=a.distance(ca,this._camera._position);if(1===f){if(10>b)return;b*=g}else b=-b*g;a.scale(O,this._camera.direciton,b);a.add(this._camera._position,O,this._camera._position)};b.prototype.rotateTo=function(b,c,d){if(void 0==d||null==d)d=0;var f=
this.getLookAtPoint(ba,this._camera._position,this._camera._orientation);a.normalize(na,ba);w(b,c,d,ca,this);a.normalize(Z,ca);a.cross(ea,na,Z);a.normalize(ea,ea);b=a.dot(na,Z);b=Math.min(b,1);b=Math.max(b,-1);b=Math.acos(b);e.fromAxisAngle(ga,ea,b);e.multiply(this._camera._orientation,ga,this._camera._orientation);a.scale(O,this._camera.direction,-f);a.add(this._camera._position,O,ca);this.applyCamera()};b.prototype.setHeadingCallBack=function(a){this._headingCallBack=a};b.prototype.setTiltCallBack=
function(a){this._tiltCallback=a};b.prototype.setZoomCallBack=function(a){this._zoomCallBack=a};b.prototype.getHeading=function(){return this._camera._headingTiltRoll[0]};b.prototype.getTilt=function(){return this._camera._headingTiltRoll[1]};b.prototype.setHeading=function(a){t(this._camera._position,this._camera._orientation,pa);z(this._camera._position,a,pa[1],this._camera._orientation)};b.prototype.backToGlobe=function(){this.flyTo(this._originalPosition[0],this._originalPosition[1],this._originalPosition[2],
0,0,0)};b.prototype.getZoomScaleFromRange=function(a){a<this._minCameraHeight&&(a=this._minCameraHeight);a>this._maxCameraHeight&&(a=this._maxCameraHeight);if(a<=this._streetLevelHeight)return a=(a-this._streetLevelHeight)/(this._minCameraHeight-this._streetLevelHeight),this._streetLevelScale*(1-a)+1*a;if(a<=this._cityLevelHeight)return a=(a-this._cityLevelHeight)/(this._streetLevelHeight-this._cityLevelHeight),this._cityLevelScale*(1-a)+this._streetLevelScale*a;if(a<=this._stateLevelHeight)return a=
(a-this._stateLevelHeight)/(this._cityLevelHeight-this._stateLevelHeight),this._stateLevelScale*(1-a)+this._cityLevelScale*a;if(a<=this._countryLevelHeight)return a=(a-this._countryLevelHeight)/(this._stateLevelHeight-this._countryLevelHeight),this._countryLevelScale*(1-a)+this._stateLevelScale*a;a=(a-this._maxCameraHeight)/(this._countryLevelHeight-this._maxCameraHeight);return 0*(1-a)+this._countryLevelScale*a};b.prototype.getRangeFromScale=function(a){0>a&&(a=0);1<a&&(a=1);if(a<=this._countryLevelScale)return a=
(a-0)/(this._countryLevelScale-0),this._maxCameraHeight*(1-a)+this._countryLevelHeight*a;if(a<=this._stateLevelScale)return a=(a-this._countryLevelScale)/(this._stateLevelScale-this._countryLevelScale),this._countryLevelHeight*(1-a)+this._stateLevelHeight*a;if(a<=this._cityLevelScale)return a=(a-this._stateLevelScale)/(this._cityLevelScale-this._stateLevelScale),this._stateLevelHeight*(1-a)+this._cityLevelHeight*a;if(a<=this._streetLevelScale)return a=(a-this._cityLevelScale)/(this._streetLevelScale-
this._cityLevelScale),this._cityLevelHeight*(1-a)+this._streetLevelHeight*a;a=(a-this._streetLevelScale)/(1-this._streetLevelScale);return this._streetLevelHeight*(1-a)+this._minCameraHeight*a};b.prototype.flyToScale=function(b){var c=this._camera;if(null!==c){b=this.getRangeFromScale(b);var d=this.getLookAtPoint(sa,this._camera._position,this._camera._orientation)-b,e=c.didrection;b=a.create();a.scale(O,e,d);a.add(b,O,c._position);d=this.framework.getInteractionManager().getAnimationManager();e=
new k;e.setAnimationObject(c);e.setDuration(1);e.setParameter({startPosition:c._position,targetPosition:b});e.setOnAnimationFrame(C);d.removeAnimationControls(c);d.addAnimationControl("cameraFlyToScale",e);e.start()}};b.prototype.zoomScale=function(b){var c=this._camera;if(null!==c){var e=this.framework._spatialReference,f=this.getLookAtPoint(la,c._position,c._orientation);a.clone(ma,c._position);F(this.getCenterOffset(),c._headingTiltRoll[1],c._orientation,ma,la);e.transformWorldToGeographics(la,
la);this.flyToLookat(d.toDegree(la[0]),d.toDegree(la[1]),la[2],void 0,void 0,f*b)}};var ra=a.create(),qa=c.create(),aa=c.create();b.prototype.adjustTilt=function(){var b=d.eastNorthUpToFixedFrame(this._camera._position,qa),e=a.clone(ra,this._camera.direction);c.inverse(aa,b);a.transformNormal(e,e,aa);var f=d.toRadians(this._maxCameraTilt),e=-a.dot(e,[0,0,1]),e=Math.acos(e);e>f&&this.rotateUp(-(e-f),b)};b.prototype.updateMinMaxCameraHeight=function(a,b){a=d.toDegree(a);b=d.toDegree(b);109.64470527515432<
a&&109.77346469166194>a&&28.20465583705492<b&&28.362614011995802>b&&(this._minCameraHeight=300);109.57791002916993<a&&109.62769909097632>a&&27.937199380772324<b&&27.970488683891098>b&&(this._minCameraHeight=400);109.57398431187902<a&&109.61520377745518>a&&28.314819589760262<b&&28.351162649240898>b&&(this._minCameraHeight=250)};var da=a.create();e.create();e.create();var sa=a.create();a.create();b.prototype.setViewProjectMatrix=function(a){this._camera.applyMatrix(a)};b.prototype.getPixelsPerMeter=
function(){return this._camera.getPixelsPerMeter()};b.prototype.applyCamera=function(){var a=this._camera;t(a._position,a._orientation,a._headingTiltRoll);var b=a._headingTiltRoll[0],c=a._headingTiltRoll[1];a.apply();var d=a._position[2],d=0.5*Math.tan(a._frustum._fovy)/(0.5*a._viewportHeight)*Math.abs(d);a._viewLevel=parseInt(Math.log(6378137*Math.PI/(256*d))/Math.log(2));a._viewLevel+=1;this.getLookAtPoint(sa,this._camera._position,this._camera._orientation);a=this._cameraBounds;a[0]>a[1]&&(da[0]=
da[0]>a[2]?a[2]:da[0],da[0]=da[0]<a[3]?a[3]:da[0],da[1]=da[1]>a[0]?a[0]:da[1],da[1]=da[1]<a[1]?a[1]:da[1]);0.1<Math.abs(this._lastTilt-c)&&this._tiltCallback&&(this._lastTilt=c,this._tiltCallback(c));this._lastTilt=c;if(1E-6<Math.abs(this._lastHeading-b)){null!==this._headingCallBack&&this._headingCallBack(b);c=this._viewChangeEvetHandle.length;for(a=0;a<c;a++)this._viewChangeEvetHandle[a]({type:"viewChange"});this._lastHeading=b}};b.prototype.getScaleFromLevel=function(a){var b=0;d.clamp(a,3,18);
3===a?b=0:3<a&&15>a?b=a/15:15<=a&&(b=(14+0.2*(a-13))/15);return b};b.prototype.getLevelFromScale=function(a){var b=3;return b=0.266>a?3:0.266<=a&&0.94>=a?parseInt(15*a+0.5):parseInt((a-14.4/15)/0.2*15+15.5)};b.prototype.setViewRange=function(a){if(1E-6<Math.abs(a.lon-this._viewCenter[0])||1E-6<Math.abs(a.lat-this._viewCenter[1])||a.level!=this._viewLevel)this.rotateTo(a.lon,a.lat),a=this.getScaleFromLevel(a.level),this.zoomScale(a)};b.prototype.getViewRange=function(){var a={};a.lon=this._viewCenter[0];
a.lat=this._viewCenter[1];a.level=this._viewLevel;return a};b.prototype.setMapRect=function(a,b,c,d){var e=this._camera._viewportHeight,f=0.5*e;void 0==a||(this._left=a);void 0==b?b=this._top:this._top=b;void 0==c||(this._right=c);void 0==d?d=this._bottom:this._bottom=d;this.setCenterOffset((0.5*(b+(e-d))-f)/f*this._camera._frustum._fovy*0.5)};var la=a.create(),ma=a.create();b.prototype.getCameraPose=function(){var b=this._camera,c=this.framework._spatialReference,e={},f=this.getLookAtPoint(la,b._position,
b._orientation);a.clone(ma,b._position);F(this.getCenterOffset(),b._headingTiltRoll[1],b._orientation,ma,la);c.transformWorldToGeographics(la,la);c.transformWorldToGeographics(ma,ma);e.lng=ma[0]*d.DEGREE_PER_RADIANS;e.lat=ma[1]*d.DEGREE_PER_RADIANS;e.alt=ma[2];e.target_lng=la[0]*d.DEGREE_PER_RADIANS;e.target_lat=la[1]*d.DEGREE_PER_RADIANS;e.target_alt=la[2]-h.Radius;e.heading=b._headingTiltRoll[0];e.tilt=b._headingTiltRoll[1];e.roll=0;e.range=f;return e};b.prototype.removeEvent=function(a){"viewChange"==
a?this._viewChangeEvetHandle=[]:"poiClick"==a?this._poiClickEventHandle=[]:"noPoiClicked"==a&&(this._noPoiClickEventHandle=[])};b.prototype.registerEvent=function(a,b){"viewChange"==a?this._viewChangeEvetHandle.push(b):"poiClick"==a?this._poiClickEventHandle.push(b):"noPoiClicked"==a&&this._noPoiClickEventHandle.push(b)};b.prototype.notifyEvent=function(a,b){"viewChange"==a?this._viewChangeEvetHandle.forEach(function(a,c){a&&a(b)}):"poiClick"==a?this._poiClickEventHandle.forEach(function(a,c){a&&
a(b)}):"noPoiClicked"==a&&this._noPoiClickEventHandle.forEach(function(a){a&&a()})};b.prototype.setCameraBounds=function(a,b,c){if(a){void 0!==b&&(this._maxCameraHeight=b);void 0!==c&&(this._minCameraHeight=c);a=a.split(";");b=d.toRadians(parseFloat(a[0]));c=d.toRadians(parseFloat(a[1]));var e=d.toRadians(parseFloat(a[2]));this._cameraBounds=[d.toRadians(parseFloat(a[3])),c,e,b]}};b.prototype.setBounds=function(b){if(b){var c=b.split(";");b=parseFloat(c[0]);var d=parseFloat(c[1]),e=parseFloat(c[2]),
c=parseFloat(c[3]),f=this._camera;this.rotateTo(0.5*(b+e),0.5*(d+c));this.zoomScale(0);f.apply();if(f.isVisible(b,d,1)&&f.isVisible(e,c,1)){var g=a.create();f.projectionFromGeo(g,b,d,0);g[2]=0;var h=a.create();f.projectionFromGeo(h,e,c,0);h[2]=0;a.distance(g,h);for(var k=0,g=1,l=0;;)if(h=0.5*(k+g),this.zoomScale(h),f.apply(),f.isVisible(b,d,1)&&f.isVisible(e,c,1))if(k=f._positionGeographic[2],100>Math.abs(l-k))break;else l=k,k=h;else g=h}}};return b});
definejs("Controller/ExplodedViewInputControl","Controller/CameraController Scene/Camera Math/Quaternion Math/Vector3 Math/MathUtils Math/Ray Math/Ellipsoid Math/Sphere Controller/InputManager Math/Vector2 Math/Matrix4 Controller/AnimationManager Controller/InteractionManager Controller/InputActionType".split(" "),function(b,a,d,c,e,h,l,g,k,n,f,m,q,x){function p(a,b,c){a._camera.getPickRay(b,u);a=a.framework._spatialReference;if(0<a.intersectRay(c,u))return a.transformRenderToWorld(c,c),c}function s(a,
b,c){console.log("zoom3D")}function r(a,b,c){console.log("spin3D")}function z(a,b,c){console.log("tilt3D")}function t(a,b,c,d,f){if(!a||n.equalsEpsilon(a.startPosition,a.endPosition,e.EPSILON3))return!1;var g=a.pressTime,h=a.releaseTime,k=g&&h&&(h.getTime()-g.getTime())/1E3,l=new Date,l=h&&(l.getTime()-h.getTime())/1E3;if(g&&h&&k<M){b=0>l?0:Math.exp(-(45*(1-b))*l);"undefined"===typeof d[f]?(g=0.5*(a.endPosition[0]-a.startPosition[0]),h=0.5*(a.endPosition[1]-a.startPosition[1]),d[f]={startPosition:n.make(a.startPosition[0],
a.startPosition[1]),endPosition:n.make(a.startPosition[0]+g*b,a.startPosition[1]+h*b),motion:n.make(g,h)}):d[f]={startPosition:n.make(d[f].endPosition[0],d[f].endPosition[1]),endPosition:n.make(d[f].endPosition[0]+d[f].motion[0]*b,d[f].endPosition[1]+d[f].motion[1]*b),motion:n.create()};if(isNaN(d[f].endPosition[0])||isNaN(d[f].endPosition[1])||n.equalsEpsilon(d[f].startPosition,d[f].endPosition,e.EPSILON3))return d[f]=void 0,!1;c(d,d[f].startPosition,d[f].endPosition);return!0}d[f]=void 0;return!1}
function w(a,b,c,d,e,f,g,h){a._lastInertiaSpinMovement=void 0;a._lastInertiaTiltMovement=void 0;a._lastInertiaZoomMovement=void 0;a._lastInertiaWheelZoomMovement=void 0;a._lastInertiaTouchZoomMovement=void 0;a._lastInertiaTouchTiltMovement=void 0;c||b.resetAction(x.MOUSE_LEFTDRAG);d||b.resetAction(x.MOUSE_MIDDLEDRAG);e||b.resetAction(x.MOUSE_RIGHTDRAG);f||b.resetAction(x.MOUSE_WHEEL)}b=function(){this._cameraController=this._camera=this.framework=null;this.minimumZoomDistance=20;this.maximumZoomDistance=
Number.POSITIVE_INFINITY;this._minimumZoomRate=20;this._maximumZoomRate=5906376272E3;this.maximumMovementRatio=0.5;var a=l.Radius;this._zoomFactor=10;this._rotateFactor=1/a;this._rotateRateRangeAdjustment=a;this._maximumRotateRate=3.54;this._minimumRotateRate=2E-4;this.inertiaSpin=0.93;this._lastInertiaTouchTiltMovement=this._lastInertiaTouchZoomMovement=this._lastInertiaWheelZoomMovement=this._lastInertiaZoomMovement=this._lastInertiaTiltMovement=this._lastInertiaSpinMovement=void 0;this.inertiaZoom=
0.8;this.type="ExplodedViewInputControl";this.onCameraPinchEvent=this.onCameraRotateEvent=this.onCameraScaleEvent=this.onCameraSpinEvent=null;this._count=0};b.prototype.initialize=function(a,b){this.framework=a;this._cameraController=b;this._camera=this._cameraController._camera};b.prototype.finalize=function(){this._cameraController=this._camera=this.framework=null};var u=h.create();g.make([0,0,0],l.Radius);var v=c.create(),A=c.create(),F=c.create();b.prototype.screenToGeographics=function(a,b){if("undefined"===
typeof p(this,a,a))return!1;this.framework._spatialReference.transformWorldToGeographics(b,a);return!0};b.prototype.pan=function(a){var b=n.create();b[0]=0.5*this._camera._viewportWidth;b[1]=0.5*this._camera._viewportHeight;var d=n.create();a=e.toRadians(a);d[0]=b[0]-20*Math.sin(a);d[1]=b[1]+20*Math.cos(a);a=this._cameraController;b=p(this,b,v);d=p(this,d,A);"undefined"!==typeof b&&"undefined"!==typeof d&&(c.sub(F,b,d),a.move(F))};c.create();f.create();c.create();c.create();c.create();c.create();
n.create();h.create();c.create();c.create();f.create();b.prototype.tiltUp=function(){var a=n.create();a[0]=0.5*this._camera._viewportWidth;a[1]=0.5*this._camera._viewportHeight;var b=n.create();b[0]=a[0];b[1]=a[1]-5;z(this,a,b)};b.prototype.tiltDown=function(){var a=n.create();a[0]=0.5*this._camera._viewportWidth;a[1]=0.5*this._camera._viewportHeight;var b=n.create();b[0]=a[0];b[1]=a[1]+5;z(this,a,b)};var M=0.8;b.prototype.stopCameraInertia=function(a){w(this,a,!1,!1,!1,!1,!1)};b.prototype.beginUpdate=
function(a){var b=a.isDoAction(x.MOUSE_MIDDLEDRAG),c=a.isDoAction(x.MOUSE_LEFTDRAG),d=a.isDoAction(x.MOUSE_RIGHTDRAG),e=a.isDoAction(x.MOUSE_WHEEL),f=a.isDoAction(x.TOUCH_PINCH),g=a.isDoAction(x.TOUCH_DOUBLETAP),h=a.isDoAction(x.TOUCH_SCRATCH),k=c||b||d||e||f||g||h;(a.isButtonDown()||k)&&w(this,a,c,b,d,e,f,g);var l=this.framework.getInteractionManager().getAnimationManager();k?l.removeAnimationControls(this._camera):l.bUpdate&&w(this,a,!1,!1,!1,!1,!1);var l=a.getActionParameter(x.MOUSE_LEFTDRAG),
p=a.getActionParameter(x.MOUSE_MIDDLEDRAG),m=a.getActionParameter(x.MOUSE_RIGHTDRAG),n=a.getActionParameter(x.MOUSE_WHEEL);if(c&&(console.log("spin"),this.onCameraSpinEvent))this.onCameraSpinEvent(c);if(b&&(console.log("spin"),this.onCameraRotateEvent))this.onCameraRotateEvent(b);d?console.log("zoom"):e&&console.log("wheelZooming");a.getActionParameter(x.TOUCH_PINCH);a.getActionParameter(x.TOUCH_DOUBLETAP);a.getActionParameter(x.TOUCH_SCRATCH);g&&console.log("doubleTapZooming");f&&console.log("pinching");
h&&console.log("scratching");a=!1;k||(a=(a=(a=(a=(a=(a=a||t(l,this.inertiaSpin,r,this,"_lastInertiaSpinMovement"))||t(p,this.inertiaSpin,z,this,"_lastInertiaTiltMovement"))||t(m,this.inertiaZoom,s,this,"_lastInertiaZoomMovement"))||t(n,this.inertiaZoom,s,this,"_lastInertiaWheelZoomMovement"))||t(void 0,this.inertiaZoom,s,this,"_lastInertiaTouchZoomMovement"))||t(void 0,this.inertiaSpin,z,this,"_lastInertiaTouchTiltMovement"));return a||k};b.prototype.endUpdate=function(a){};return b});
definejs("Controller/LabelInputControl","Controller/InputManager Scene/UserLayer/Label Controller/InputAction Controller/InputActionType Controller/CameraController Math/MathUtils Framework/ConfigOptions".split(" "),function(b,a,d,c,e,h,l){b=function(){this.framework=null;this.type="LabelInputControl";this.selectLabel=null;this.mouseY=this.mouseX=0};b.prototype.initialize=function(a){this.framework=a};b.prototype.finalize=function(){this.framework=null};var g=null;b.prototype.beginUpdate=function(a){var b=
!1,d=a.isDoAction(c.MOUSE_LEFTCLICK);a.isDoAction(c.MOUSE_MOVE);a.isDoAction(c.TOUCH_PINCH);d&&(a=a.getActionParameter(c.MOUSE_LEFTCLICK),g={x:a.position[0],y:a.position[1]},b=this.framework._isNeedUpdateCollision=!0);return b};b.prototype.endUpdate=function(a){a=!1;if(null!==g){var b=this.framework.getCollisionManager().getObject(g.x,g.y);null!==b?null!==b.onClick&&(b.onClick(b),a=!0):this.framework._interactionManager._camraController.notifyEvent("noPoiClicked");g=null}return a};return b});
definejs("Controller/MarkerInputControl","Controller/InputManager Scene/Vector/Marker Scene/Vector/MarkerRenderQueue Controller/InputAction Controller/InputActionType Controller/CameraController Math/MathUtils Math/Vector3 Math/Quaternion Scene/Vector/MarkerSystem".split(" "),function(b,a,d,c,e,h,l,g,k,n){b=function(){this._markerRenderQueue=this._framework=null;this.type="LabelInputControl2";this._cameraPosition=g.create();this._cameraOrientation=k.create();this._labelSystem=this.selectLabel=null;
this._enable=!0;this._processDrag=!1};b.prototype.initialize=function(a){this._framework=a;this._labelSystem=a.getVectorSystem().getLabelSystem();this._markerRenderQueue=a.getViewManager().getView(0).getRenderContext().getRenderQueue(7);a=a.getInteractionManager().getCameraController()._camera;g.clone(this._cameraPosition,a._position);g.clone(this._cameraOrientation,a._orientation)};b.prototype.finalize=function(){this._labelSystem=this._cameraController=this._markerRenderQueue=this._framework=null};
b.prototype.highlightMarkerById=function(a){var b=this._labelSystem.getCount();if("-1"===a)null!==this.selectLabel&&(this.selectLabel.state=0),this.selectLabel=null,this._framework.forceRedraw();else for(var c=0;c<b;c++){var d=this._labelSystem.getLabel(c);!1!==d.get("visible")&&d.id===a&&(null!==this.selectLabel&&(this.selectLabel.state=0),this.selectLabel=d,this.selectLabel.state=1,this._framework.forceRedraw())}};g.create();g.create();b.prototype.beginUpdate=function(a){if(!1!==this._enable){var b=
!1;this._framework.getInteractionManager().getCameraController();var c=a.isDoAction(e.MOUSE_LEFTCLICK),d=a.isDoAction(e.MOUSE_MOVE);if(c){for(var c=a.getActionParameter(e.MOUSE_LEFTCLICK),g=this._markerRenderQueue._markerSets.length,h=null,k=0;k<g;k++){var l=this._markerRenderQueue._markerSets[k];if(null!==l.onClick&&l.intersect({mousePoint:c.position})){b=!0;h=l;break}}null!==h&&this.selectLabel!==h&&(null!==this.selectLabel&&(this.selectLabel.state=0),this.selectLabel=h,this.selectLabel.state=1,
this.selectLabel.onClick(this.selectLabel.id),this._framework.forceRedraw())}if(!1!==this._processDrag){if(d&&(a=a.getActionParameter(e.MOUSE_MOVE),l=this._markerRenderQueue.getMarker({mousePoint:a.endPosition}),this.selectLabel!==l)){if(null!==this.selectLabel){if(null!==this.selectLabel.onMouseOut)this.selectLabel.onMouseOut(this.selectLabel.id);this.selectLabel.state=0;this.selectLabel=null}if(null!==l){if(null!==l.onMouseOver)l.onMouseOver(l.id);this.selectLabel=l;this.selectLabel.state=1}}return b}}};
b.prototype.endUpdate=function(a){};return b});
definejs("Controller/VectorInputControl","Controller/InputManager Scene/Vector/Marker Scene/Vector/MarkerRenderQueue Controller/InputAction Controller/InputActionType Controller/CameraController Math/MathUtils Math/Vector3 Math/Quaternion Scene/Vector/MarkerSystem".split(" "),function(b,a,d,c,e,h,l,g,k,n){b=function(){this._markerRenderQueue=this._framework=null;this.type="VectorInputControl";this._cameraPosition=g.create();this._cameraOrientation=k.create();this._labelSystem=this.selectObject=null;
this._enable=!0;this._processDrag=!1};b.prototype.initialize=function(a){this._framework=a;this._labelSystem=a.getVectorSystem().getLabelSystem();this._markerRenderQueue=a.getViewManager().getView(0).getRenderContext().getRenderQueue(7);a=a.getInteractionManager().getCameraController()._camera;g.clone(this._cameraPosition,a._position);g.clone(this._cameraOrientation,a._orientation)};b.prototype.finalize=function(){this._labelSystem=this._cameraController=this._markerRenderQueue=this._framework=null};
b.prototype.highlightObjectById=function(a,b,c,d){var e=this._framework.getIndoorSceneSystem();null!==e&&(""===a?null!==this.selectObject&&(this.selectObject.state=0,this.selectObject=null):(null!==this.selectObject&&(this.selectObject.state=0,this.selectObject=null),2==arguments.length&&"function"==typeof b?(e=e.getVectorObject(a),d=b):e=e.setVectorColor(a,b,c),null!==e&&(this.selectObject=e,this.selectObject.state=1,d&&d({obj:e,center:e.centerPos}))),this._framework.forceRedraw())};g.create();g.create();
b.prototype.beginUpdate=function(a){if(!1!==this._enable){var b=!1;this._framework.getInteractionManager().getCameraController();var c=a.isDoAction(e.MOUSE_LEFTCLICK),d=a.isDoAction(e.MOUSE_MOVE);if(c){for(var c=a.getActionParameter(e.MOUSE_LEFTCLICK),g=this._markerRenderQueue._markerSets.length,h=null,k=0;k<g;k++){var l=this._markerRenderQueue._markerSets[k];if(null!==l.onClick&&l.intersect({mousePoint:c.position})){b=!0;h=l;break}}null!==h&&this.selectLabel!==h&&(null!==this.selectLabel&&(this.selectLabel.state=
0),this.selectLabel=h,this.selectLabel.state=1,this.selectLabel.onClick(this.selectLabel.id),this._framework.forceRedraw())}if(!1!==this._processDrag){if(d&&(a=a.getActionParameter(e.MOUSE_MOVE),l=this._markerRenderQueue.getMarker({mousePoint:a.endPosition}),this.selectLabel!==l)){if(null!==this.selectLabel){if(null!==this.selectLabel.onMouseOut)this.selectLabel.onMouseOut(this.selectLabel.id);this.selectLabel.state=0;this.selectLabel=null}if(null!==l){if(null!==l.onMouseOver)l.onMouseOver(l.id);
this.selectLabel=l;this.selectLabel.state=1}}return b}}};b.prototype.endUpdate=function(a){};return b});
definejs("Controller/ControllerExtension","Controller/CameraInputControl Controller/AnimationManager Framework/Framework Controller/InteractionManager Controller/PlaneCameraController Controller/ExplodedViewInputControl Controller/InputManager Controller/LabelInputControl Controller/MarkerInputControl Controller/VectorInputControl".split(" "),function(b,a,d,c,e,h,l,g,k,n){b=function(){};b.prototype.launch=function(b,c){this.initializeContext=b;var d=b.framework,g=d.getInteractionManager(),k=new a;
k.initialize(d);g.setAnimationManager(k);k=new l;k.initialize(d);g.setInputManager(k);var n=b._camera,k=new e(c);k.initialize(d,n);g.setCameraController(k);n=new h;n.initialize(d,k);g.AddInputControl(n)};b.prototype.shutdown=function(){this.initializeContext.framework.getInteractionManager().finalize()};return b});
definejs("Framework/Stats",[],function(){return{context:null,begin:function(){},end:function(){},initialize:function(b,a,d){this.start=function(){b.call(d||this)};this.end=function(){a.call(d||this)}}}});
definejs("Framework/RenderWindow",["Framework/Framework","Framework/Application","Framework/Stats"],function(b,a,d){function c(a){h.renderFrame(a);window.renderFrame(c)}var e=function(){this.framework=null;this._renderQueue=[]};e.prototype.initialize=function(a){h=this.framework=a};e.prototype.finalize=function(){this.removeRAF();this.framework=null;this._renderQueue=[]};e.prototype.setRenderEnable=function(a){!0===a&&e.prototype.registerRAF(this.framework._canvas)};var h=null;e.prototype.onResize=
function(){window.stopRenderFrame(c);h.onResize()};window.renderFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a,b){h.animationFrame=window.setTimeout(a,1E3/60)}}();window.stopRenderFrame=function(a){return window.cancelAnimationFrame||window.mozCancelAnimationFrame||function(){window.clearTimeout(h.animationFrame)}}();e.prototype.registerRAF=function(a){window.renderFrame(c)};
e.prototype.removeRAF=function(){window.stopRenderFrame(c)};e.prototype.render=function(){h.renderFrame()};return e});
definejs("Framework/FrameworkExtension",["Framework/Framework","Framework/RenderWindow","Renderer/RenderFont"],function(b,a,d){d=function(){this._renderWindow=this.framework=null};d.prototype.launch=function(c){this.initializeContext=c;var d=new b;d.initialize(c._canvas,c._surfaceCanvas,c.glContext);var h=new a;h.initialize(d);this.framework=d;this._renderWindow=h;c.framework=d;c._application.registerResize(h.onResize);c._application.framework=d};d.prototype.shutdown=function(){this.initializeContext._application.removeResizeListener(this._renderWindow.onResize);
this.framework.finalize();this.framework=null;this._renderWindow.finalize();this._renderWindow=null};return d});definejs("Resource/ResourceExtension",[],function(){var b=function(){};b.prototype.launch=function(a){};b.prototype.shutdown=function(){};return b});
definejs("Framework/Application","Framework/AppState Framework/ConfigOptions Renderer/RendererExtension Scene/SceneExtension Controller/ControllerExtension Framework/FrameworkExtension Resource/ResourceExtension Math/Vector3 Core/defaultValue Framework/Stats Scene/UserLayer/PoiDataSource".split(" "),function(b,a,d,c,e,h,l,g,k,n,f){var m=[],q={createRAF:function(a){q.requestAnimationFrame=window.requestAnimationFrame},registerResize:function(a){window.addEventListener("resize",a,!1)},removeResizeListener:function(a){window.removeEventListener("resize",
a,!1)},getDataSourceManager:function(){if(q.framework)return q.framework.getDataSourceManager()},createDataSourceManager:function(a,b,c){q.framework&&q.framework.getDataSourceManager().createDataSource({key:a,url:b},function(a,b,c){b=new f(b,c.url);b.initialize(a);return b}).getData(c)},setOnIndoorBuildingActive:function(a){q.framework&&q.framework.setOnIndoorBuildingActive(a)},createIndoorScene:function(a,b,c){return q.framework._indoorSceneSystem.createIndoorScene(a,b,c)},removeIndoorScene:function(a){q.framework._indoorSceneSystem.removeIndoorScene(a)},
setIndoorSceneVisible:function(a,b){q.framework._indoorSceneSystem.setIndoorSceneVisible(a,b)},Create:function(b,c){q.reset();if(q.framework){q.shutdown();var d=q.framework.getInteractionManager();d&&d.stopCameraAnimation()}if(c){a.device_clear_color=c.device_clear_color||a.device_clear_color;a.srcVersion=c.srcVersion||"";a.RenderFont=a.RenderFont=c.RenderFont||"";a.setBasePath(c.baseMapPath||"./");for(var e in c)q.getConfigOptions(e)&&q.setConfigOptions(e,c[e])}q.launch(document.getElementById(b),
document.getElementById("2d_canvas"),c)},setMapBgColor:function(b){b&&(a.device_clear_color=b,q.framework.renderDevice.setClearColor(b))},reset:function(){if(q.framework){q.shutdown();var a=q.framework.getInteractionManager();a&&a.stopCameraAnimation()}},launch:function(a,b,f){if(!q.checkCapabilities())return!1;a.oncontextmenu=function(){return!1};var g={};g._application=q;g._canvas=a;g._surfaceCanvas=b;g.glContext=q.getGlContext(a);a=new h;a.launch(g);m.push(a);a=new d;a.launch(g);m.push(a);a=new l;
a.launch(g);m.push(a);a=new c;a.launch(g);m.push(a);a=new e;a.launch(g,f);m.push(a);return!0},shutdown:function(){for(var a=m.length-1;0<=a;a--)m[a].shutdown();m=[]},checkWebGL:function(){for(var a=document.getElementsByTagName("body")[0],b=a.appendChild(document.createElement("canvas")),c=null,d="webgl2 experimental-webgl2 webgl experimental-webgl moz-webgl webkit-3d".split(" "),e=0;e<d.length;e++)try{if(c=b.getContext(d[e]))break}catch(f){return console.log(f),!1}if(null===c)return!1;a.removeChild(b);
return!0},getGlContext:function(a){for(var b="webgl2 experimental-webgl2 webgl experimental-webgl moz-webgl webkit-3d".split(" "),c=0;c<b.length;c++)try{var d=a.getContext(b[c]);if(d)return d}catch(e){return console.log(e),!1}},checkCORS:function(){return"crossOrigin"in new Image?!0:!1},checkCapabilities:function(){return q.checkCORS()&&q.checkWebGL()?!0:!1},backToGlobe:function(){if(null!=q.framework){var a=q.framework.getInteractionManager();null!=a&&(a=a.getCameraController(),null!=a&&a.backToGlobe())}},
setConfigOptions:function(b,c){if(a[b]&&"object"==typeof c)for(var d in c)a[b][d]=c[d];else a[b]=c},getConfigOptions:function(b){return a[b]},onResize:function(a,b){if(null!=q.framework)q.framework.onResize(a,b)},setExplodedView:function(a){null!=q.framework&&q.framework.setExplodedView(a)},getCameraPose:function(){var a=q.framework.getInteractionManager();if(null!==a&&(a=a.getCameraController(),null!==a))return a.getCameraPose()},setCameraPose:function(a,b,c,d,e){var f=q.framework.getInteractionManager();
if(null!==f&&(f.stopCameraAnimation(),f=f.getCameraController(),null!==f))return f.setPosition(a,b,c,d,e)},flyTo:function(a,b,c,d,e,f,g){if(null!=q.framework){var h=q.framework.getInteractionManager();null!=h&&(h=h.getCameraController(),null!=h&&h.flyTo(a,b,c,d,e,f,g))}},setPosition:function(a,b,c,d,e){var f=q.framework.getInteractionManager();if(null!==f&&(f=f.getCameraController(),null!==f))return f.setPosition(a,b,c,d,e)},setLookat:function(a,b,c,d,e,f){var g=q.framework.getInteractionManager();
if(null!==g&&(g=g.getCameraController(),null!==g))return g.gotoLookAt(a,b,c,d,e,f)},flyToLookat:function(a,b,c,d,e,f,g){if(null!=q.framework){var h=q.framework.getInteractionManager();null!=h&&(h=h.getCameraController(),null!=h&&h.flyToLookat(a,b,c,d,e,f,g))}},getHeading:function(a){a=q.framework.getInteractionManager();if(null===a)return 0;a=a.getCameraController();return null===a?0:a.getHeading()},setHeadingCallBack:function(a){var b=q.framework.getInteractionManager();if(null===b)return 0;b=b.getCameraController();
return null===b?0:b.setHeadingCallBack(a)},setTiltCallBack:function(a){var b=q.framework.getInteractionManager();if(null===b)return 0;b=b.getCameraController();return null===b?0:b.setTiltCallBack(a)},getTilt:function(a){a=q.framework.getInteractionManager();if(null===a)return 0;a=a.getCameraController();return null===a?0:a.getTilt()},setHeading:function(a){var b=q.framework.getInteractionManager();null!==b&&(b.stopCameraAnimation(),b=b.getCameraController(),null!==b&&b.setHeading(a))},tiltUp:function(){var a=
q.framework.getInteractionManager();null!==a&&a.getInputControl("CameraInputControl").tiltUp()},tiltDown:function(){var a=q.framework.getInteractionManager();null!==a&&(a.stopCameraAnimation(),a.getInputControl("CameraInputControl").tiltDown())},forceRedraw:function(){q.framework.forceRedraw()},firstLoaded:function(){q.framework.firstLoaded()},pan:function(a){var b=q.framework.getInteractionManager();null!==b&&(q.framework._forceRedraw=!0,null!==b.getCameraController()&&b.getInputControl("CameraInputControl").pan(a))},
getZoomScale:function(a){var b=q.framework.getInteractionManager();if(null!==b&&(b=b.getCameraController(),null!==b))return null!=a&&b.setZoomCallBack(a),b._lastZoomScale},zoomToPlace:function(a,b,c,d,e){var f=q.framework.getInteractionManager();null!==f&&(f=f.getCameraController(),null!==f&&f.zoomToPlace(a,b,c,d,e))},setZoomScale:function(a){var b=q.framework.getInteractionManager();null!==b&&(b=b.getCameraController(),null!==b&&b.zoomScale(a))},flyToScale:function(a){var b=q.framework.getInteractionManager();
null!==b&&(b=b.getCameraController(),null!==b&&b.flyToScale(a))},setBaseUrl:function(b){a.base_resource_url=b},createModelLayer:function(a,b,c){var d=q.framework,e=d._indoorSceneSystem.createModelLayer(),f=parseInt(k(c.shadowMap,1));c.shadowMap=f;e.guid=a;e.name=b;e.minLevel=parseInt(k(c.minlevel,17));e.maxLevel=parseInt(k(c.maxlevel,28));e.initialize(d);e.parseJSON(c);q.framework.getSceneManager().getScene(0).addSceneObject(e);return e},removeLayer:function(a){q.framework.getSceneManager().getScene(0).removeSceneObject(a)},
createPoiLayer:function(a,b,c){var d=q.framework,e=d._indoorSceneSystem.createPoiLayer();e.guid=a;e.name=b;e.initialize(d);c.data?e.parseJSON(c.data):c.url&&e.loadData(c.url,c.currFloorId);q.framework.getSceneManager().getScene(0).addSceneObject(e);return e},createVectorLayer:function(a,b,c){var d=q.framework,e=d._indoorSceneSystem.createVectorLayer();e.guid=a;e.name=b;e.initialize(d);c.data?e.parseJSON(c.data):c.url&&e.loadData(c.url);q.framework.getSceneManager().getScene(0).addSceneObject(e);return e},
createPMLayer:function(a,b,c){var d=q.framework,e=d._indoorSceneSystem.createParametricModelLayer(),f=parseInt(k(c.shadowMap,0));e.guid=a;e.name=b;e.setShadowMapType(f);e.minLevel=parseInt(k(c.minlevel,17));e.maxLevel=parseInt(k(c.maxlevel,28));e.initialize(d);c.data?e.parseJSON(c.data):c.url&&e.loadData(c.url);q.framework.getSceneManager().getScene(0).addSceneObject(e);return e},deleteLayer:function(a){q.framework.getSceneManager().getScene(0).removeSceneObject(a)},createObject:function(a){var b=
q.framework.getVectorSystem();if(null!==b)return a=b.createObject(a),a.attribute_table={},a.set=function(a){for(var b in a)this.attribute_table[b]=a[b]},a.get=function(a){return void 0===a?this.attribute_table:this.attribute_table[a]},a.setVisible=a.setVisible||a.setVisible,a.setPosition=a.setPosition||a.setPosition,a.setScale=a.setScale||a.setScale,a.setRotate=a.setRotate||a.setRotate,a.setHeightOffset=a.setHeightOffset||a.setHeightOffset,a.set=a.set||a.set,a.get=a.get||a.get,a},createObjectEx:function(a){var b=
q.framework.getVectorSystem();if(null!==b)return a=b.createObject(a),a.attribute_table={},a.set=function(a){for(var b in a)this.attribute_table[b]=a[b]},a.get=function(a){return void 0===a?this.attribute_table:this.attribute_table[a]},a.setVisible=a.setVisible||a.setVisible,a.setPosition=a.setPosition||a.setPosition,a.setScale=a.setScale||a.setScale,a.setRotate=a.setRotate||a.setRotate,a.set=a.set||a.set,a.get=a.get||a.get,a},setObjectVisible:function(a){var b=q.framework.getIndoorSceneSystem();null!==
b&&b.setObjectVisible(a)},setObjectVisibleEx:function(a,b){var c=q.framework.getIndoorSceneSystem();null!==c&&c.setObjectVisibleEx(a,b)},setRenderEnable:function(a){m[0]._renderWindow.setRenderEnable(a)},render:function(){m[0]._renderWindow.render()},setViewProjectMatrix:function(a){var b=q.framework.getInteractionManager();if(null!==b&&(b=b.getCameraController(),null!==b))return b.setViewProjectMatrix(a)},setObjectAttribute:function(a,b,c){"id"==b?a.id=c:"visible"==b?a.visible=c:"heightOffset"==
b?a.setHeightOffset(c):"panoVisible"==b?a.setPanoVisible(c):"opacity"==b&&a.setOpacity(c)},setPanoVisible:function(a){q.framework.setPanoVisible(a)},getObjectAttribute:function(a,b){if("id"==b)return a.id;if("visible"==b)return a.visible}},x={objectStyle:{type:"PolylineStyle",name:"PolylineStyle1",color:[255,0,0,0.5],width:15,fillType:"color",imageUrl:""},objectInfo:{type:"Polyline",name:"beijing",guid:"AABBBB",position:"116.287169,39.791031,100;116.507166,39.975638,100"}};document.addEventListener("keydown",
function(a){13===a.keyCode&&q.createObject(x)},!1);q.deleteObject=function(a,b){var c=q.framework.getVectorSystem();if(null!==c)return c.deleteObject(a,b)};q.updateLine=function(a,b){var c=q.framework.getVectorSystem();if(null!==c)return c.updateLine(a,b)};q.screenToGeo=function(a,b){var c=q.framework.getInteractionManager();if(null!==c&&(c=c.getCameraController(),null!==c))return c._camera.screenToGeo(a,b)};g.create();q.geoToScreen=function(a,b,c){var d=q.framework.getInteractionManager();if(null!==
d&&(d=d.getCameraController(),null!==d)){var d=d._camera,e=g.create();return e=d.geoToScreen(a,b,c)}};q.getCanvasSize=function(){var a=q.framework._canvas;return[a.width,a.height,0]};q.rotateTo=function(a,b,c){var d=q.framework.getInteractionManager();if(null!==d&&(d.stopCameraAnimation(),d=d.getCameraController(),null!==d))return d.rotateTo(a,b,c)};q.isVisible=function(a,b,c){var d=q.framework.getInteractionManager();if(null!==d&&(d=d.getCameraController(),null!==d))return d._camera.isVisible(a,
b,c)};q.flyAlongPath=function(a,b){void 0==b&&(b=!1);var c=q.framework.getInteractionManager();if(null!==c&&(c.stopCameraAnimation(),c=c.getCameraController(),null!==c))return c.flyAlongPath({flyPath:a,flyLoop:b})};q.setBounds=function(a){var b=q.framework.getInteractionManager();if(null!==b&&(b.stopCameraAnimation(),b=b.getCameraController(),null!==b))return b.setBounds(a)};q.setMapRect=function(a,b,c,d){var e=q.framework.getInteractionManager();if(null!==e&&(e=e.getCameraController(),null!==e))return e.setMapRect(a,
b,c,d)};q.setCenterOffset=function(a){var b=q.framework.getInteractionManager();if(null!==b&&(b=b.getCameraController(),null!==b))return b.setCenterOffset(a)};q.setCameraBounds=function(a,b,c){var d=q.framework.getInteractionManager();if(null!==d&&(d.stopCameraAnimation(),d=d.getCameraController(),null!==d))return d.setCameraBounds(a,b,c)};q.setCameraSpinEvent=function(a){var b=q.framework.getInteractionManager();null!==b&&(b.getInputControl("ExplodedViewInputControl").onCameraSpinEvent=a)};q.setCameraRotateEvent=
function(a){var b=q.framework.getInteractionManager();null!==b&&(b.getInputControl("ExplodedViewInputControl").onCameraRotateEvent=a)};q.setCameraScaleEvent=function(a){var b=q.framework.getInteractionManager();null!==b&&(b.getInputControl("CameraInputControl").onCameraScaleEvent=a)};q.setCameraPinchEvent=function(a){var b=q.framework.getInteractionManager();null!==b&&(b.getInputControl("CameraInputControl").onCameraPinchEvent=a)};q.setViewRange=function(a){var b=q.framework.getInteractionManager();
if(null!==b&&(b.stopCameraAnimation(),b=b.getCameraController(),null!==b))return b.setViewRange(a)};q.getViewRange=function(){var a=q.framework.getInteractionManager();if(null!==a&&(a=a.getCameraController(),null!==a))return a.getViewRange()};q.changeHeight=function(a,b){var c=q.framework._recceLayerManager;if(null!==c)return c.changeHeight(a,b)};q.changeTexture=function(){var a=q.framework._recceLayerManager;if(null!==a)return a.changeTexture()};q.registerEvent=function(a,b){var c=q.framework.getInteractionManager();
if(null!==c&&(c=c.getCameraController(),null!==c))return c.registerEvent(a,b)};q.removeEvent=function(a){var b=q.framework.getInteractionManager();if(null!==b&&(b=b.getCameraController(),null!==b))return b.removeEvent(a)};q.setDevicePixelRatio=function(b){a.devicePixelRatio=b};q.FPS=function(a,b,c){n.initialize(a,b,c)};q.setMarkerEventEnable=function(a){var b=q.framework.getInteractionManager();null!==b&&(b=b.getInputControl("LabelInputControl2"),null!==b&&(console.log(b._enable),b._enable=a))};q.highlightMarkerById=
function(a){var b=q.framework.getInteractionManager();null!==b&&(b=b.getInputControl("LabelInputControl2"),null!==b&&b.highlightMarkerById(a))};q.highlightVectorById=function(a,b,c,d){c=q.framework.getInteractionManager();null!==c&&(c=c.getInputControl("VectorInputControl"),null!==c&&c.highlightObjectById(a,b))};q.setVectorColor=function(a,b,c,d){var e=q.framework.getIndoorSceneSystem();if(null!==e)return e.setVectorColor(a,b,c,d)};q.setOriginPos=function(a){q.framework.setOriginPos(a)};q.screenToGeographics=
function(a,b){var c=q.framework.getInteractionManager();if(null===c)return!1;c=c.getInputControl("LabelInputControl2");return null===c?!1:c.screenToGeographics(a,b)};q.projectScreenToGeographicsVerticalPlane=function(a,b){var c=q.framework.getInteractionManager();if(null!==c&&(c=c.getCameraController(),null!==c))return c.projectScreenToGeographicsVerticalPlane(a,b)};q.getPixelsPerMeter=function(){var a=q.framework.getInteractionManager();if(null!==a&&(a=a.getCameraController(),null!==a))return a.getPixelsPerMeter()};
q.computeHeadingTilt=function(a,b,c){var d=q.framework.getInteractionManager();null!==d&&d.getCameraController().computeHeadingTiltByDirection(a,b,c)};q.registMapEvent=function(a){a&&a.onForceRedraw&&q.framework.reRenderEvent.addEventHandler(a.onForceRedraw)};q.framework=null;return q});definejs("IndexMain",["Framework/Application"],function(b){navigator.userAgent.indexOf("UCBrowser");if(window.onMapCreateReady)window.onMapCreateReady(b);return b});
var baseUrl=window.dxMapPath?window.dxMapPath+"/map_js_src/Source/":"./map_js_src/Source/";requirejs({baseUrl:baseUrl,paths:{domReady:"../ThirdParty/requirejs-2.1.6/domReady"}},["IndexMain"],function(){});definejs("index",function(){});
